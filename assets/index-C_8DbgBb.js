(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function dp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const tt={},Ji=[],os=()=>{},BE=()=>!1,nh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),fp=n=>n.startsWith("onUpdate:"),en=Object.assign,pp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},OR=Object.prototype.hasOwnProperty,Ge=(n,e)=>OR.call(n,e),Ie=Array.isArray,Zi=n=>Ml(n)==="[object Map]",sh=n=>Ml(n)==="[object Set]",o_=n=>Ml(n)==="[object Date]",Ae=n=>typeof n=="function",It=n=>typeof n=="string",zn=n=>typeof n=="symbol",st=n=>n!==null&&typeof n=="object",$E=n=>(st(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),qE=Object.prototype.toString,Ml=n=>qE.call(n),VR=n=>Ml(n).slice(8,-1),jE=n=>Ml(n)==="[object Object]",mp=n=>It(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Oa=dp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),rh=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},MR=/-\w/g,Dn=rh(n=>n.replace(MR,e=>e.slice(1).toUpperCase())),LR=/\B([A-Z])/g,wi=rh(n=>n.replace(LR,"-$1").toLowerCase()),ih=rh(n=>n.charAt(0).toUpperCase()+n.slice(1)),fd=rh(n=>n?`on${ih(n)}`:""),dr=(n,e)=>!Object.is(n,e),Nc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},KE=(n,e,t,s=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:s,value:t})},gp=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let a_;const oh=()=>a_||(a_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ah(n){if(Ie(n)){const e={};for(let t=0;t<n.length;t++){const s=n[t],r=It(s)?$R(s):ah(s);if(r)for(const i in r)e[i]=r[i]}return e}else if(It(n)||st(n))return n}const FR=/;(?![^(]*\))/g,UR=/:([^]+)/,BR=/\/\*[^]*?\*\//g;function $R(n){const e={};return n.replace(BR,"").split(FR).forEach(t=>{if(t){const s=t.split(UR);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function ho(n){let e="";if(It(n))e=n;else if(Ie(n))for(let t=0;t<n.length;t++){const s=ho(n[t]);s&&(e+=s+" ")}else if(st(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const qR="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",jR=dp(qR);function GE(n){return!!n||n===""}function KR(n,e){if(n.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<n.length;s++)t=fo(n[s],e[s]);return t}function fo(n,e){if(n===e)return!0;let t=o_(n),s=o_(e);if(t||s)return t&&s?n.getTime()===e.getTime():!1;if(t=zn(n),s=zn(e),t||s)return n===e;if(t=Ie(n),s=Ie(e),t||s)return t&&s?KR(n,e):!1;if(t=st(n),s=st(e),t||s){if(!t||!s)return!1;const r=Object.keys(n).length,i=Object.keys(e).length;if(r!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!fo(n[o],e[o]))return!1}}return String(n)===String(e)}function HE(n,e){return n.findIndex(t=>fo(t,e))}const zE=n=>!!(n&&n.__v_isRef===!0),ye=n=>It(n)?n:n==null?"":Ie(n)||st(n)&&(n.toString===qE||!Ae(n.toString))?zE(n)?ye(n.value):JSON.stringify(n,WE,2):String(n),WE=(n,e)=>zE(e)?WE(n,e.value):Zi(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,r],i)=>(t[pd(s,i)+" =>"]=r,t),{})}:sh(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>pd(t))}:zn(e)?pd(e):st(e)&&!Ie(e)&&!jE(e)?String(e):e,pd=(n,e="")=>{var t;return zn(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let Gt;class GR{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Gt,!e&&Gt&&(this.index=(Gt.scopes||(Gt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Gt;try{return Gt=this,e()}finally{Gt=t}}}on(){++this._on===1&&(this.prevScope=Gt,Gt=this)}off(){this._on>0&&--this._on===0&&(Gt=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function HR(){return Gt}function zR(n,e=!1){Gt&&Gt.cleanups.push(n)}let it;const md=new WeakSet;class QE{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Gt&&Gt.active&&Gt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,md.has(this)&&(md.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||XE(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,l_(this),JE(this);const e=it,t=qn;it=this,qn=!0;try{return this.fn()}finally{ZE(this),it=e,qn=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)vp(e);this.deps=this.depsTail=void 0,l_(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?md.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Yd(this)&&this.run()}get dirty(){return Yd(this)}}let YE=0,Va,Ma;function XE(n,e=!1){if(n.flags|=8,e){n.next=Ma,Ma=n;return}n.next=Va,Va=n}function _p(){YE++}function yp(){if(--YE>0)return;if(Ma){let e=Ma;for(Ma=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Va;){let e=Va;for(Va=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){n||(n=s)}e=t}}if(n)throw n}function JE(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function ZE(n){let e,t=n.depsTail,s=t;for(;s;){const r=s.prevDep;s.version===-1?(s===t&&(t=r),vp(s),WR(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=r}n.deps=e,n.depsTail=t}function Yd(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(eI(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function eI(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===sl)||(n.globalVersion=sl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Yd(n))))return;n.flags|=2;const e=n.dep,t=it,s=qn;it=n,qn=!0;try{JE(n);const r=n.fn(n._value);(e.version===0||dr(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{it=t,qn=s,ZE(n),n.flags&=-3}}function vp(n,e=!1){const{dep:t,prevSub:s,nextSub:r}=n;if(s&&(s.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=s,n.nextSub=void 0),t.subs===n&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)vp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function WR(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let qn=!0;const tI=[];function ks(){tI.push(qn),qn=!1}function xs(){const n=tI.pop();qn=n===void 0?!0:n}function l_(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=it;it=void 0;try{e()}finally{it=t}}}let sl=0;class QR{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ep{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!it||!qn||it===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==it)t=this.activeLink=new QR(it,this),it.deps?(t.prevDep=it.depsTail,it.depsTail.nextDep=t,it.depsTail=t):it.deps=it.depsTail=t,nI(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=it.depsTail,t.nextDep=void 0,it.depsTail.nextDep=t,it.depsTail=t,it.deps===t&&(it.deps=s)}return t}trigger(e){this.version++,sl++,this.notify(e)}notify(e){_p();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{yp()}}}function nI(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)nI(s)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Xd=new WeakMap,ti=Symbol(""),Jd=Symbol(""),rl=Symbol("");function zt(n,e,t){if(qn&&it){let s=Xd.get(n);s||Xd.set(n,s=new Map);let r=s.get(t);r||(s.set(t,r=new Ep),r.map=s,r.key=t),r.track()}}function Es(n,e,t,s,r,i){const o=Xd.get(n);if(!o){sl++;return}const a=l=>{l&&l.trigger()};if(_p(),e==="clear")o.forEach(a);else{const l=Ie(n),u=l&&mp(t);if(l&&t==="length"){const h=Number(s);o.forEach((d,p)=>{(p==="length"||p===rl||!zn(p)&&p>=h)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(rl)),e){case"add":l?u&&a(o.get("length")):(a(o.get(ti)),Zi(n)&&a(o.get(Jd)));break;case"delete":l||(a(o.get(ti)),Zi(n)&&a(o.get(Jd)));break;case"set":Zi(n)&&a(o.get(ti));break}}yp()}function Vi(n){const e=Ke(n);return e===n?e:(zt(e,"iterate",rl),kn(n)?e:e.map(Wn))}function lh(n){return zt(n=Ke(n),"iterate",rl),n}function nr(n,e){return Ds(n)?ni(n)?po(Wn(e)):po(e):Wn(e)}const YR={__proto__:null,[Symbol.iterator](){return gd(this,Symbol.iterator,n=>nr(this,n))},concat(...n){return Vi(this).concat(...n.map(e=>Ie(e)?Vi(e):e))},entries(){return gd(this,"entries",n=>(n[1]=nr(this,n[1]),n))},every(n,e){return _s(this,"every",n,e,void 0,arguments)},filter(n,e){return _s(this,"filter",n,e,t=>t.map(s=>nr(this,s)),arguments)},find(n,e){return _s(this,"find",n,e,t=>nr(this,t),arguments)},findIndex(n,e){return _s(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return _s(this,"findLast",n,e,t=>nr(this,t),arguments)},findLastIndex(n,e){return _s(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return _s(this,"forEach",n,e,void 0,arguments)},includes(...n){return _d(this,"includes",n)},indexOf(...n){return _d(this,"indexOf",n)},join(n){return Vi(this).join(n)},lastIndexOf(...n){return _d(this,"lastIndexOf",n)},map(n,e){return _s(this,"map",n,e,void 0,arguments)},pop(){return ha(this,"pop")},push(...n){return ha(this,"push",n)},reduce(n,...e){return c_(this,"reduce",n,e)},reduceRight(n,...e){return c_(this,"reduceRight",n,e)},shift(){return ha(this,"shift")},some(n,e){return _s(this,"some",n,e,void 0,arguments)},splice(...n){return ha(this,"splice",n)},toReversed(){return Vi(this).toReversed()},toSorted(n){return Vi(this).toSorted(n)},toSpliced(...n){return Vi(this).toSpliced(...n)},unshift(...n){return ha(this,"unshift",n)},values(){return gd(this,"values",n=>nr(this,n))}};function gd(n,e,t){const s=lh(n),r=s[e]();return s!==n&&!kn(n)&&(r._next=r.next,r.next=()=>{const i=r._next();return i.done||(i.value=t(i.value)),i}),r}const XR=Array.prototype;function _s(n,e,t,s,r,i){const o=lh(n),a=o!==n&&!kn(n),l=o[e];if(l!==XR[e]){const d=l.apply(n,i);return a?Wn(d):d}let u=t;o!==n&&(a?u=function(d,p){return t.call(this,nr(n,d),p,n)}:t.length>2&&(u=function(d,p){return t.call(this,d,p,n)}));const h=l.call(o,u,s);return a&&r?r(h):h}function c_(n,e,t,s){const r=lh(n);let i=t;return r!==n&&(kn(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,nr(n,a),l,n)}),r[e](i,...s)}function _d(n,e,t){const s=Ke(n);zt(s,"iterate",rl);const r=s[e](...t);return(r===-1||r===!1)&&wp(t[0])?(t[0]=Ke(t[0]),s[e](...t)):r}function ha(n,e,t=[]){ks(),_p();const s=Ke(n)[e].apply(n,t);return yp(),xs(),s}const JR=dp("__proto__,__v_isRef,__isVue"),sI=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(zn));function ZR(n){zn(n)||(n=String(n));const e=Ke(this);return zt(e,"has",n),e.hasOwnProperty(n)}class rI{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return i;if(t==="__v_raw")return s===(r?i?cC:lI:i?aI:oI).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=Ie(e);if(!r){let l;if(o&&(l=YR[t]))return l;if(t==="hasOwnProperty")return ZR}const a=Reflect.get(e,t,Xt(e)?e:s);if((zn(t)?sI.has(t):JR(t))||(r||zt(e,"get",t),i))return a;if(Xt(a)){const l=o&&mp(t)?a:a.value;return r&&st(l)?ef(l):l}return st(a)?r?ef(a):ch(a):a}}class iI extends rI{constructor(e=!1){super(!1,e)}set(e,t,s,r){let i=e[t];const o=Ie(e)&&mp(t);if(!this._isShallow){const u=Ds(i);if(!kn(s)&&!Ds(s)&&(i=Ke(i),s=Ke(s)),!o&&Xt(i)&&!Xt(s))return u||(i.value=s),!0}const a=o?Number(t)<e.length:Ge(e,t),l=Reflect.set(e,t,s,Xt(e)?e:r);return e===Ke(r)&&(a?dr(s,i)&&Es(e,"set",t,s):Es(e,"add",t,s)),l}deleteProperty(e,t){const s=Ge(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&Es(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(!zn(t)||!sI.has(t))&&zt(e,"has",t),s}ownKeys(e){return zt(e,"iterate",Ie(e)?"length":ti),Reflect.ownKeys(e)}}class eC extends rI{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const tC=new iI,nC=new eC,sC=new iI(!0);const Zd=n=>n,gc=n=>Reflect.getPrototypeOf(n);function rC(n,e,t){return function(...s){const r=this.__v_raw,i=Ke(r),o=Zi(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=r[n](...s),h=t?Zd:e?po:Wn;return!e&&zt(i,"iterate",l?Jd:ti),{next(){const{value:d,done:p}=u.next();return p?{value:d,done:p}:{value:a?[h(d[0]),h(d[1])]:h(d),done:p}},[Symbol.iterator](){return this}}}}function _c(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function iC(n,e){const t={get(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);n||(dr(r,a)&&zt(o,"get",r),zt(o,"get",a));const{has:l}=gc(o),u=e?Zd:n?po:Wn;if(l.call(o,r))return u(i.get(r));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(r)},get size(){const r=this.__v_raw;return!n&&zt(Ke(r),"iterate",ti),r.size},has(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);return n||(dr(r,a)&&zt(o,"has",r),zt(o,"has",a)),r===a?i.has(r):i.has(r)||i.has(a)},forEach(r,i){const o=this,a=o.__v_raw,l=Ke(a),u=e?Zd:n?po:Wn;return!n&&zt(l,"iterate",ti),a.forEach((h,d)=>r.call(i,u(h),u(d),o))}};return en(t,n?{add:_c("add"),set:_c("set"),delete:_c("delete"),clear:_c("clear")}:{add(r){!e&&!kn(r)&&!Ds(r)&&(r=Ke(r));const i=Ke(this);return gc(i).has.call(i,r)||(i.add(r),Es(i,"add",r,r)),this},set(r,i){!e&&!kn(i)&&!Ds(i)&&(i=Ke(i));const o=Ke(this),{has:a,get:l}=gc(o);let u=a.call(o,r);u||(r=Ke(r),u=a.call(o,r));const h=l.call(o,r);return o.set(r,i),u?dr(i,h)&&Es(o,"set",r,i):Es(o,"add",r,i),this},delete(r){const i=Ke(this),{has:o,get:a}=gc(i);let l=o.call(i,r);l||(r=Ke(r),l=o.call(i,r)),a&&a.call(i,r);const u=i.delete(r);return l&&Es(i,"delete",r,void 0),u},clear(){const r=Ke(this),i=r.size!==0,o=r.clear();return i&&Es(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=rC(r,n,e)}),t}function Ip(n,e){const t=iC(n,e);return(s,r,i)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?s:Reflect.get(Ge(t,r)&&r in s?t:s,r,i)}const oC={get:Ip(!1,!1)},aC={get:Ip(!1,!0)},lC={get:Ip(!0,!1)};const oI=new WeakMap,aI=new WeakMap,lI=new WeakMap,cC=new WeakMap;function uC(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hC(n){return n.__v_skip||!Object.isExtensible(n)?0:uC(VR(n))}function ch(n){return Ds(n)?n:Tp(n,!1,tC,oC,oI)}function cI(n){return Tp(n,!1,sC,aC,aI)}function ef(n){return Tp(n,!0,nC,lC,lI)}function Tp(n,e,t,s,r){if(!st(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=hC(n);if(i===0)return n;const o=r.get(n);if(o)return o;const a=new Proxy(n,i===2?s:t);return r.set(n,a),a}function ni(n){return Ds(n)?ni(n.__v_raw):!!(n&&n.__v_isReactive)}function Ds(n){return!!(n&&n.__v_isReadonly)}function kn(n){return!!(n&&n.__v_isShallow)}function wp(n){return n?!!n.__v_raw:!1}function Ke(n){const e=n&&n.__v_raw;return e?Ke(e):n}function dC(n){return!Ge(n,"__v_skip")&&Object.isExtensible(n)&&KE(n,"__v_skip",!0),n}const Wn=n=>st(n)?ch(n):n,po=n=>st(n)?ef(n):n;function Xt(n){return n?n.__v_isRef===!0:!1}function Se(n){return uI(n,!1)}function fC(n){return uI(n,!0)}function uI(n,e){return Xt(n)?n:new pC(n,e)}class pC{constructor(e,t){this.dep=new Ep,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ke(e),this._value=t?e:Wn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||kn(e)||Ds(e);e=s?e:Ke(e),dr(e,t)&&(this._rawValue=e,this._value=s?e:Wn(e),this.dep.trigger())}}function He(n){return Xt(n)?n.value:n}const mC={get:(n,e,t)=>e==="__v_raw"?n:He(Reflect.get(n,e,t)),set:(n,e,t,s)=>{const r=n[e];return Xt(r)&&!Xt(t)?(r.value=t,!0):Reflect.set(n,e,t,s)}};function hI(n){return ni(n)?n:new Proxy(n,mC)}class gC{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Ep(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=sl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&it!==this)return XE(this,!0),!0}get value(){const e=this.dep.track();return eI(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function _C(n,e,t=!1){let s,r;return Ae(n)?s=n:(s=n.get,r=n.set),new gC(s,r,t)}const yc={},nu=new WeakMap;let $r;function yC(n,e=!1,t=$r){if(t){let s=nu.get(t);s||nu.set(t,s=[]),s.push(n)}}function vC(n,e,t=tt){const{immediate:s,deep:r,once:i,scheduler:o,augmentJob:a,call:l}=t,u=P=>r?P:kn(P)||r===!1||r===0?Is(P,1):Is(P);let h,d,p,g,b=!1,C=!1;if(Xt(n)?(d=()=>n.value,b=kn(n)):ni(n)?(d=()=>u(n),b=!0):Ie(n)?(C=!0,b=n.some(P=>ni(P)||kn(P)),d=()=>n.map(P=>{if(Xt(P))return P.value;if(ni(P))return u(P);if(Ae(P))return l?l(P,2):P()})):Ae(n)?e?d=l?()=>l(n,2):n:d=()=>{if(p){ks();try{p()}finally{xs()}}const P=$r;$r=h;try{return l?l(n,3,[g]):n(g)}finally{$r=P}}:d=os,e&&r){const P=d,q=r===!0?1/0:r;d=()=>Is(P(),q)}const V=HR(),L=()=>{h.stop(),V&&V.active&&pp(V.effects,h)};if(i&&e){const P=e;e=(...q)=>{P(...q),L()}}let F=C?new Array(n.length).fill(yc):yc;const D=P=>{if(!(!(h.flags&1)||!h.dirty&&!P))if(e){const q=h.run();if(r||b||(C?q.some((Y,I)=>dr(Y,F[I])):dr(q,F))){p&&p();const Y=$r;$r=h;try{const I=[q,F===yc?void 0:C&&F[0]===yc?[]:F,g];F=q,l?l(e,3,I):e(...I)}finally{$r=Y}}}else h.run()};return a&&a(D),h=new QE(d),h.scheduler=o?()=>o(D,!1):D,g=P=>yC(P,!1,h),p=h.onStop=()=>{const P=nu.get(h);if(P){if(l)l(P,4);else for(const q of P)q();nu.delete(h)}},e?s?D(!0):F=h.run():o?o(D.bind(null,!0),!0):h.run(),L.pause=h.pause.bind(h),L.resume=h.resume.bind(h),L.stop=L,L}function Is(n,e=1/0,t){if(e<=0||!st(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,Xt(n))Is(n.value,e,t);else if(Ie(n))for(let s=0;s<n.length;s++)Is(n[s],e,t);else if(sh(n)||Zi(n))n.forEach(s=>{Is(s,e,t)});else if(jE(n)){for(const s in n)Is(n[s],e,t);for(const s of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,s)&&Is(n[s],e,t)}return n}function Ll(n,e,t,s){try{return s?n(...s):n()}catch(r){uh(r,e,t)}}function fs(n,e,t,s){if(Ae(n)){const r=Ll(n,e,t,s);return r&&$E(r)&&r.catch(i=>{uh(i,e,t)}),r}if(Ie(n)){const r=[];for(let i=0;i<n.length;i++)r.push(fs(n[i],e,t,s));return r}}function uh(n,e,t,s=!0){const r=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||tt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let d=0;d<h.length;d++)if(h[d](n,l,u)===!1)return}a=a.parent}if(i){ks(),Ll(i,null,10,[n,l,u]),xs();return}}EC(n,t,r,s,o)}function EC(n,e,t,s=!0,r=!1){if(r)throw n;console.error(n)}const an=[];let es=-1;const eo=[];let sr=null,ji=0;const dI=Promise.resolve();let su=null;function fI(n){const e=su||dI;return n?e.then(this?n.bind(this):n):e}function IC(n){let e=es+1,t=an.length;for(;e<t;){const s=e+t>>>1,r=an[s],i=il(r);i<n||i===n&&r.flags&2?e=s+1:t=s}return e}function bp(n){if(!(n.flags&1)){const e=il(n),t=an[an.length-1];!t||!(n.flags&2)&&e>=il(t)?an.push(n):an.splice(IC(e),0,n),n.flags|=1,pI()}}function pI(){su||(su=dI.then(gI))}function TC(n){Ie(n)?eo.push(...n):sr&&n.id===-1?sr.splice(ji+1,0,n):n.flags&1||(eo.push(n),n.flags|=1),pI()}function u_(n,e,t=es+1){for(;t<an.length;t++){const s=an[t];if(s&&s.flags&2){if(n&&s.id!==n.uid)continue;an.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function mI(n){if(eo.length){const e=[...new Set(eo)].sort((t,s)=>il(t)-il(s));if(eo.length=0,sr){sr.push(...e);return}for(sr=e,ji=0;ji<sr.length;ji++){const t=sr[ji];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}sr=null,ji=0}}const il=n=>n.id==null?n.flags&2?-1:1/0:n.id;function gI(n){try{for(es=0;es<an.length;es++){const e=an[es];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Ll(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;es<an.length;es++){const e=an[es];e&&(e.flags&=-2)}es=-1,an.length=0,mI(),su=null,(an.length||eo.length)&&gI()}}let Ut=null,_I=null;function ru(n){const e=Ut;return Ut=n,_I=n&&n.type.__scopeId||null,e}function Vn(n,e=Ut,t){if(!e||n._n)return n;const s=(...r)=>{s._d&&au(-1);const i=ru(e);let o;try{o=n(...r)}finally{ru(i),s._d&&au(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function da(n,e){if(Ut===null)return n;const t=ph(Ut),s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[i,o,a,l=tt]=e[r];i&&(Ae(i)&&(i={mounted:i,updated:i}),i.deep&&Is(o),s.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Fr(n,e,t,s){const r=n.dirs,i=e&&e.dirs;for(let o=0;o<r.length;o++){const a=r[o];i&&(a.oldValue=i[o].value);let l=a.dir[s];l&&(ks(),fs(l,t,8,[n.el,a,n,e]),xs())}}function kc(n,e){if(Yt){let t=Yt.provides;const s=Yt.parent&&Yt.parent.provides;s===t&&(t=Yt.provides=Object.create(s)),t[n]=e}}function jn(n,e,t=!1){const s=I0();if(s||no){let r=no?no._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&Ae(e)?e.call(s&&s.proxy):e}}const wC=Symbol.for("v-scx"),bC=()=>jn(wC);function La(n,e){return Ap(n,null,e)}function as(n,e,t){return Ap(n,e,t)}function Ap(n,e,t=tt){const{immediate:s,deep:r,flush:i,once:o}=t,a=en({},t),l=e&&s||!e&&i!=="post";let u;if(cl){if(i==="sync"){const g=bC();u=g.__watcherHandles||(g.__watcherHandles=[])}else if(!l){const g=()=>{};return g.stop=os,g.resume=os,g.pause=os,g}}const h=Yt;a.call=(g,b,C)=>fs(g,h,b,C);let d=!1;i==="post"?a.scheduler=g=>{vn(g,h&&h.suspense)}:i!=="sync"&&(d=!0,a.scheduler=(g,b)=>{b?g():bp(g)}),a.augmentJob=g=>{e&&(g.flags|=4),d&&(g.flags|=2,h&&(g.id=h.uid,g.i=h))};const p=vC(n,e,a);return cl&&(u?u.push(p):l&&p()),p}function AC(n,e,t){const s=this.proxy,r=It(n)?n.includes(".")?yI(s,n):()=>s[n]:n.bind(s,s);let i;Ae(e)?i=e:(i=e.handler,t=e);const o=Fl(this),a=Ap(r,i.bind(s),t);return o(),a}function yI(n,e){const t=e.split(".");return()=>{let s=n;for(let r=0;r<t.length&&s;r++)s=s[t[r]];return s}}const SC=Symbol("_vte"),RC=n=>n.__isTeleport,CC=Symbol("_leaveCb");function Sp(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Sp(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function vI(n,e){return Ae(n)?en({name:n.name},e,{setup:n}):n}function EI(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const iu=new WeakMap;function Fa(n,e,t,s,r=!1){if(Ie(n)){n.forEach((b,C)=>Fa(b,e&&(Ie(e)?e[C]:e),t,s,r));return}if(to(s)&&!r){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Fa(n,e,t,s.component.subTree);return}const i=s.shapeFlag&4?ph(s.component):s.el,o=r?null:i,{i:a,r:l}=n,u=e&&e.r,h=a.refs===tt?a.refs={}:a.refs,d=a.setupState,p=Ke(d),g=d===tt?BE:b=>Ge(p,b);if(u!=null&&u!==l){if(h_(e),It(u))h[u]=null,g(u)&&(d[u]=null);else if(Xt(u)){u.value=null;const b=e;b.k&&(h[b.k]=null)}}if(Ae(l))Ll(l,a,12,[o,h]);else{const b=It(l),C=Xt(l);if(b||C){const V=()=>{if(n.f){const L=b?g(l)?d[l]:h[l]:l.value;if(r)Ie(L)&&pp(L,i);else if(Ie(L))L.includes(i)||L.push(i);else if(b)h[l]=[i],g(l)&&(d[l]=h[l]);else{const F=[i];l.value=F,n.k&&(h[n.k]=F)}}else b?(h[l]=o,g(l)&&(d[l]=o)):C&&(l.value=o,n.k&&(h[n.k]=o))};if(o){const L=()=>{V(),iu.delete(n)};L.id=-1,iu.set(n,L),vn(L,t)}else h_(n),V()}}}function h_(n){const e=iu.get(n);e&&(e.flags|=8,iu.delete(n))}oh().requestIdleCallback;oh().cancelIdleCallback;const to=n=>!!n.type.__asyncLoader,II=n=>n.type.__isKeepAlive;function PC(n,e){TI(n,"a",e)}function NC(n,e){TI(n,"da",e)}function TI(n,e,t=Yt){const s=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(hh(e,s,t),t){let r=t.parent;for(;r&&r.parent;)II(r.parent.vnode)&&kC(s,e,t,r),r=r.parent}}function kC(n,e,t,s){const r=hh(e,n,s,!0);bI(()=>{pp(s[e],r)},t)}function hh(n,e,t=Yt,s=!1){if(t){const r=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ks();const a=Fl(t),l=fs(e,t,n,o);return a(),xs(),l});return s?r.unshift(i):r.push(i),i}}const Bs=n=>(e,t=Yt)=>{(!cl||n==="sp")&&hh(n,(...s)=>e(...s),t)},xC=Bs("bm"),Rp=Bs("m"),DC=Bs("bu"),OC=Bs("u"),wI=Bs("bum"),bI=Bs("um"),VC=Bs("sp"),MC=Bs("rtg"),LC=Bs("rtc");function FC(n,e=Yt){hh("ec",n,e)}const UC="components";function ol(n,e){return $C(UC,n,!0,e)||n}const BC=Symbol.for("v-ndc");function $C(n,e,t=!0,s=!1){const r=Ut||Yt;if(r){const i=r.type;{const a=S0(i,!1);if(a&&(a===e||a===Dn(e)||a===ih(Dn(e))))return i}const o=d_(r[n]||i[n],e)||d_(r.appContext[n],e);return!o&&s?i:o}}function d_(n,e){return n&&(n[e]||n[Dn(e)]||n[ih(Dn(e))])}function Bt(n,e,t,s){let r;const i=t,o=Ie(n);if(o||It(n)){const a=o&&ni(n);let l=!1,u=!1;a&&(l=!kn(n),u=Ds(n),n=lh(n)),r=new Array(n.length);for(let h=0,d=n.length;h<d;h++)r[h]=e(l?u?po(Wn(n[h])):Wn(n[h]):n[h],h,void 0,i)}else if(typeof n=="number"){r=new Array(n);for(let a=0;a<n;a++)r[a]=e(a+1,a,void 0,i)}else if(st(n))if(n[Symbol.iterator])r=Array.from(n,(a,l)=>e(a,l,void 0,i));else{const a=Object.keys(n);r=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const h=a[l];r[l]=e(n[h],h,l,i)}}else r=[];return r}function f_(n,e,t={},s,r){if(Ut.ce||Ut.parent&&to(Ut.parent)&&Ut.parent.ce){const u=Object.keys(t).length>0;return e!=="default"&&(t.name=e),W(),mo($e,null,[ze("slot",t,s)],u?-2:64)}let i=n[e];i&&i._c&&(i._d=!1),W();const o=i&&AI(i(t)),a=t.key||o&&o.key,l=mo($e,{key:(a&&!zn(a)?a:`_${e}`)+(!o&&s?"_fb":"")},o||[],o&&n._===1?64:-2);return i&&i._c&&(i._d=!0),l}function AI(n){return n.some(e=>ll(e)?!(e.type===Os||e.type===$e&&!AI(e.children)):!0)?n:null}const tf=n=>n?KI(n)?ph(n):tf(n.parent):null,Ua=en(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>tf(n.parent),$root:n=>tf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>RI(n),$forceUpdate:n=>n.f||(n.f=()=>{bp(n.update)}),$nextTick:n=>n.n||(n.n=fI.bind(n.proxy)),$watch:n=>AC.bind(n)}),yd=(n,e)=>n!==tt&&!n.__isScriptSetup&&Ge(n,e),qC={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:r,props:i,accessCache:o,type:a,appContext:l}=n;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return s[e];case 2:return r[e];case 4:return t[e];case 3:return i[e]}else{if(yd(s,e))return o[e]=1,s[e];if(r!==tt&&Ge(r,e))return o[e]=2,r[e];if(Ge(i,e))return o[e]=3,i[e];if(t!==tt&&Ge(t,e))return o[e]=4,t[e];nf&&(o[e]=0)}}const u=Ua[e];let h,d;if(u)return e==="$attrs"&&zt(n.attrs,"get",""),u(n);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==tt&&Ge(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,Ge(d,e))return d[e]},set({_:n},e,t){const{data:s,setupState:r,ctx:i}=n;return yd(r,e)?(r[e]=t,!0):s!==tt&&Ge(s,e)?(s[e]=t,!0):Ge(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:s,appContext:r,props:i,type:o}},a){let l;return!!(t[a]||n!==tt&&a[0]!=="$"&&Ge(n,a)||yd(e,a)||Ge(i,a)||Ge(s,a)||Ge(Ua,a)||Ge(r.config.globalProperties,a)||(l=o.__cssModules)&&l[a])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Ge(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function p_(n){return Ie(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let nf=!0;function jC(n){const e=RI(n),t=n.proxy,s=n.ctx;nf=!1,e.beforeCreate&&m_(e.beforeCreate,n,"bc");const{data:r,computed:i,methods:o,watch:a,provide:l,inject:u,created:h,beforeMount:d,mounted:p,beforeUpdate:g,updated:b,activated:C,deactivated:V,beforeDestroy:L,beforeUnmount:F,destroyed:D,unmounted:P,render:q,renderTracked:Y,renderTriggered:I,errorCaptured:v,serverPrefetch:w,expose:R,inheritAttrs:S,components:N,directives:T,filters:he}=e;if(u&&KC(u,s,null),o)for(const Be in o){const Ne=o[Be];Ae(Ne)&&(s[Be]=Ne.bind(t))}if(r){const Be=r.call(t,t);st(Be)&&(n.data=ch(Be))}if(nf=!0,i)for(const Be in i){const Ne=i[Be],Vt=Ae(Ne)?Ne.bind(t,t):Ae(Ne.get)?Ne.get.bind(t,t):os,Sn=!Ae(Ne)&&Ae(Ne.set)?Ne.set.bind(t):os,tn=me({get:Vt,set:Sn});Object.defineProperty(s,Be,{enumerable:!0,configurable:!0,get:()=>tn.value,set:wt=>tn.value=wt})}if(a)for(const Be in a)SI(a[Be],s,t,Be);if(l){const Be=Ae(l)?l.call(t):l;Reflect.ownKeys(Be).forEach(Ne=>{kc(Ne,Be[Ne])})}h&&m_(h,n,"c");function Fe(Be,Ne){Ie(Ne)?Ne.forEach(Vt=>Be(Vt.bind(t))):Ne&&Be(Ne.bind(t))}if(Fe(xC,d),Fe(Rp,p),Fe(DC,g),Fe(OC,b),Fe(PC,C),Fe(NC,V),Fe(FC,v),Fe(LC,Y),Fe(MC,I),Fe(wI,F),Fe(bI,P),Fe(VC,w),Ie(R))if(R.length){const Be=n.exposed||(n.exposed={});R.forEach(Ne=>{Object.defineProperty(Be,Ne,{get:()=>t[Ne],set:Vt=>t[Ne]=Vt,enumerable:!0})})}else n.exposed||(n.exposed={});q&&n.render===os&&(n.render=q),S!=null&&(n.inheritAttrs=S),N&&(n.components=N),T&&(n.directives=T),w&&EI(n)}function KC(n,e,t=os){Ie(n)&&(n=sf(n));for(const s in n){const r=n[s];let i;st(r)?"default"in r?i=jn(r.from||s,r.default,!0):i=jn(r.from||s):i=jn(r),Xt(i)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[s]=i}}function m_(n,e,t){fs(Ie(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,t)}function SI(n,e,t,s){let r=s.includes(".")?yI(t,s):()=>t[s];if(It(n)){const i=e[n];Ae(i)&&as(r,i)}else if(Ae(n))as(r,n.bind(t));else if(st(n))if(Ie(n))n.forEach(i=>SI(i,e,t,s));else{const i=Ae(n.handler)?n.handler.bind(t):e[n.handler];Ae(i)&&as(r,i,n)}}function RI(n){const e=n.type,{mixins:t,extends:s}=e,{mixins:r,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!r.length&&!t&&!s?l=e:(l={},r.length&&r.forEach(u=>ou(l,u,o,!0)),ou(l,e,o)),st(e)&&i.set(e,l),l}function ou(n,e,t,s=!1){const{mixins:r,extends:i}=e;i&&ou(n,i,t,!0),r&&r.forEach(o=>ou(n,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=GC[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const GC={data:g_,props:__,emits:__,methods:Ra,computed:Ra,beforeCreate:sn,created:sn,beforeMount:sn,mounted:sn,beforeUpdate:sn,updated:sn,beforeDestroy:sn,beforeUnmount:sn,destroyed:sn,unmounted:sn,activated:sn,deactivated:sn,errorCaptured:sn,serverPrefetch:sn,components:Ra,directives:Ra,watch:zC,provide:g_,inject:HC};function g_(n,e){return e?n?function(){return en(Ae(n)?n.call(this,this):n,Ae(e)?e.call(this,this):e)}:e:n}function HC(n,e){return Ra(sf(n),sf(e))}function sf(n){if(Ie(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function sn(n,e){return n?[...new Set([].concat(n,e))]:e}function Ra(n,e){return n?en(Object.create(null),n,e):e}function __(n,e){return n?Ie(n)&&Ie(e)?[...new Set([...n,...e])]:en(Object.create(null),p_(n),p_(e??{})):e}function zC(n,e){if(!n)return e;if(!e)return n;const t=en(Object.create(null),n);for(const s in e)t[s]=sn(n[s],e[s]);return t}function CI(){return{app:null,config:{isNativeTag:BE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let WC=0;function QC(n,e){return function(s,r=null){Ae(s)||(s=en({},s)),r!=null&&!st(r)&&(r=null);const i=CI(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:WC++,_component:s,_props:r,_container:null,_context:i,_instance:null,version:C0,get config(){return i.config},set config(h){},use(h,...d){return o.has(h)||(h&&Ae(h.install)?(o.add(h),h.install(u,...d)):Ae(h)&&(o.add(h),h(u,...d))),u},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),u},component(h,d){return d?(i.components[h]=d,u):i.components[h]},directive(h,d){return d?(i.directives[h]=d,u):i.directives[h]},mount(h,d,p){if(!l){const g=u._ceVNode||ze(s,r);return g.appContext=i,p===!0?p="svg":p===!1&&(p=void 0),n(g,h,p),l=!0,u._container=h,h.__vue_app__=u,ph(g.component)}},onUnmount(h){a.push(h)},unmount(){l&&(fs(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(h,d){return i.provides[h]=d,u},runWithContext(h){const d=no;no=u;try{return h()}finally{no=d}}};return u}}let no=null;const YC=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Dn(e)}Modifiers`]||n[`${wi(e)}Modifiers`];function XC(n,e,...t){if(n.isUnmounted)return;const s=n.vnode.props||tt;let r=t;const i=e.startsWith("update:"),o=i&&YC(s,e.slice(7));o&&(o.trim&&(r=t.map(h=>It(h)?h.trim():h)),o.number&&(r=t.map(gp)));let a,l=s[a=fd(e)]||s[a=fd(Dn(e))];!l&&i&&(l=s[a=fd(wi(e))]),l&&fs(l,n,6,r);const u=s[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,fs(u,n,6,r)}}const JC=new WeakMap;function PI(n,e,t=!1){const s=t?JC:e.emitsCache,r=s.get(n);if(r!==void 0)return r;const i=n.emits;let o={},a=!1;if(!Ae(n)){const l=u=>{const h=PI(u,e,!0);h&&(a=!0,en(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(st(n)&&s.set(n,null),null):(Ie(i)?i.forEach(l=>o[l]=null):en(o,i),st(n)&&s.set(n,o),o)}function dh(n,e){return!n||!nh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ge(n,e[0].toLowerCase()+e.slice(1))||Ge(n,wi(e))||Ge(n,e))}function y_(n){const{type:e,vnode:t,proxy:s,withProxy:r,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:h,props:d,data:p,setupState:g,ctx:b,inheritAttrs:C}=n,V=ru(n);let L,F;try{if(t.shapeFlag&4){const P=r||s,q=P;L=ns(u.call(q,P,h,d,g,p,b)),F=a}else{const P=e;L=ns(P.length>1?P(d,{attrs:a,slots:o,emit:l}):P(d,null)),F=e.props?a:ZC(a)}}catch(P){Ba.length=0,uh(P,n,1),L=ze(Os)}let D=L;if(F&&C!==!1){const P=Object.keys(F),{shapeFlag:q}=D;P.length&&q&7&&(i&&P.some(fp)&&(F=e0(F,i)),D=go(D,F,!1,!0))}return t.dirs&&(D=go(D,null,!1,!0),D.dirs=D.dirs?D.dirs.concat(t.dirs):t.dirs),t.transition&&Sp(D,t.transition),L=D,ru(V),L}const ZC=n=>{let e;for(const t in n)(t==="class"||t==="style"||nh(t))&&((e||(e={}))[t]=n[t]);return e},e0=(n,e)=>{const t={};for(const s in n)(!fp(s)||!(s.slice(9)in e))&&(t[s]=n[s]);return t};function t0(n,e,t){const{props:s,children:r,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?v_(s,o,u):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const p=h[d];if(o[p]!==s[p]&&!dh(u,p))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?v_(s,o,u):!0:!!o;return!1}function v_(n,e,t){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let r=0;r<s.length;r++){const i=s[r];if(e[i]!==n[i]&&!dh(t,i))return!0}return!1}function n0({vnode:n,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=e.vnode).el=t,e=e.parent;else break}}const NI={},kI=()=>Object.create(NI),xI=n=>Object.getPrototypeOf(n)===NI;function s0(n,e,t,s=!1){const r={},i=kI();n.propsDefaults=Object.create(null),DI(n,e,r,i);for(const o in n.propsOptions[0])o in r||(r[o]=void 0);t?n.props=s?r:cI(r):n.type.props?n.props=r:n.props=i,n.attrs=i}function r0(n,e,t,s){const{props:r,attrs:i,vnode:{patchFlag:o}}=n,a=Ke(r),[l]=n.propsOptions;let u=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let p=h[d];if(dh(n.emitsOptions,p))continue;const g=e[p];if(l)if(Ge(i,p))g!==i[p]&&(i[p]=g,u=!0);else{const b=Dn(p);r[b]=rf(l,a,b,g,n,!1)}else g!==i[p]&&(i[p]=g,u=!0)}}}else{DI(n,e,r,i)&&(u=!0);let h;for(const d in a)(!e||!Ge(e,d)&&((h=wi(d))===d||!Ge(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(r[d]=rf(l,a,d,void 0,n,!0)):delete r[d]);if(i!==a)for(const d in i)(!e||!Ge(e,d))&&(delete i[d],u=!0)}u&&Es(n.attrs,"set","")}function DI(n,e,t,s){const[r,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Oa(l))continue;const u=e[l];let h;r&&Ge(r,h=Dn(l))?!i||!i.includes(h)?t[h]=u:(a||(a={}))[h]=u:dh(n.emitsOptions,l)||(!(l in s)||u!==s[l])&&(s[l]=u,o=!0)}if(i){const l=Ke(t),u=a||tt;for(let h=0;h<i.length;h++){const d=i[h];t[d]=rf(r,l,d,u[d],n,!Ge(u,d))}}return o}function rf(n,e,t,s,r,i){const o=n[t];if(o!=null){const a=Ge(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ae(l)){const{propsDefaults:u}=r;if(t in u)s=u[t];else{const h=Fl(r);s=u[t]=l.call(null,e),h()}}else s=l;r.ce&&r.ce._setProp(t,s)}o[0]&&(i&&!a?s=!1:o[1]&&(s===""||s===wi(t))&&(s=!0))}return s}const i0=new WeakMap;function OI(n,e,t=!1){const s=t?i0:e.propsCache,r=s.get(n);if(r)return r;const i=n.props,o={},a=[];let l=!1;if(!Ae(n)){const h=d=>{l=!0;const[p,g]=OI(d,e,!0);en(o,p),g&&a.push(...g)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return st(n)&&s.set(n,Ji),Ji;if(Ie(i))for(let h=0;h<i.length;h++){const d=Dn(i[h]);E_(d)&&(o[d]=tt)}else if(i)for(const h in i){const d=Dn(h);if(E_(d)){const p=i[h],g=o[d]=Ie(p)||Ae(p)?{type:p}:en({},p),b=g.type;let C=!1,V=!0;if(Ie(b))for(let L=0;L<b.length;++L){const F=b[L],D=Ae(F)&&F.name;if(D==="Boolean"){C=!0;break}else D==="String"&&(V=!1)}else C=Ae(b)&&b.name==="Boolean";g[0]=C,g[1]=V,(C||Ge(g,"default"))&&a.push(d)}}const u=[o,a];return st(n)&&s.set(n,u),u}function E_(n){return n[0]!=="$"&&!Oa(n)}const Cp=n=>n==="_"||n==="_ctx"||n==="$stable",Pp=n=>Ie(n)?n.map(ns):[ns(n)],o0=(n,e,t)=>{if(e._n)return e;const s=Vn((...r)=>Pp(e(...r)),t);return s._c=!1,s},VI=(n,e,t)=>{const s=n._ctx;for(const r in n){if(Cp(r))continue;const i=n[r];if(Ae(i))e[r]=o0(r,i,s);else if(i!=null){const o=Pp(i);e[r]=()=>o}}},MI=(n,e)=>{const t=Pp(e);n.slots.default=()=>t},LI=(n,e,t)=>{for(const s in e)(t||!Cp(s))&&(n[s]=e[s])},a0=(n,e,t)=>{const s=n.slots=kI();if(n.vnode.shapeFlag&32){const r=e._;r?(LI(s,e,t),t&&KE(s,"_",r,!0)):VI(e,s)}else e&&MI(n,e)},l0=(n,e,t)=>{const{vnode:s,slots:r}=n;let i=!0,o=tt;if(s.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:LI(r,e,t):(i=!e.$stable,VI(e,r)),o=e}else e&&(MI(n,e),o={default:1});if(i)for(const a in r)!Cp(a)&&o[a]==null&&delete r[a]},vn=f0;function c0(n){return u0(n)}function u0(n,e){const t=oh();t.__VUE__=!0;const{insert:s,remove:r,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:h,parentNode:d,nextSibling:p,setScopeId:g=os,insertStaticContent:b}=n,C=(E,A,k,U=null,K=null,B=null,te=void 0,z=null,H=!!A.dynamicChildren)=>{if(E===A)return;E&&!fa(E,A)&&(U=$(E),wt(E,K,B,!0),E=null),A.patchFlag===-2&&(H=!1,A.dynamicChildren=null);const{type:G,ref:_e,shapeFlag:ie}=A;switch(G){case fh:V(E,A,k,U);break;case Os:L(E,A,k,U);break;case xc:E==null&&F(A,k,U,te);break;case $e:N(E,A,k,U,K,B,te,z,H);break;default:ie&1?q(E,A,k,U,K,B,te,z,H):ie&6?T(E,A,k,U,K,B,te,z,H):(ie&64||ie&128)&&G.process(E,A,k,U,K,B,te,z,H,fe)}_e!=null&&K?Fa(_e,E&&E.ref,B,A||E,!A):_e==null&&E&&E.ref!=null&&Fa(E.ref,null,B,E,!0)},V=(E,A,k,U)=>{if(E==null)s(A.el=a(A.children),k,U);else{const K=A.el=E.el;A.children!==E.children&&u(K,A.children)}},L=(E,A,k,U)=>{E==null?s(A.el=l(A.children||""),k,U):A.el=E.el},F=(E,A,k,U)=>{[E.el,E.anchor]=b(E.children,A,k,U,E.el,E.anchor)},D=({el:E,anchor:A},k,U)=>{let K;for(;E&&E!==A;)K=p(E),s(E,k,U),E=K;s(A,k,U)},P=({el:E,anchor:A})=>{let k;for(;E&&E!==A;)k=p(E),r(E),E=k;r(A)},q=(E,A,k,U,K,B,te,z,H)=>{if(A.type==="svg"?te="svg":A.type==="math"&&(te="mathml"),E==null)Y(A,k,U,K,B,te,z,H);else{const G=E.el&&E.el._isVueCE?E.el:null;try{G&&G._beginPatch(),w(E,A,K,B,te,z,H)}finally{G&&G._endPatch()}}},Y=(E,A,k,U,K,B,te,z)=>{let H,G;const{props:_e,shapeFlag:ie,transition:pe,dirs:ve}=E;if(H=E.el=o(E.type,B,_e&&_e.is,_e),ie&8?h(H,E.children):ie&16&&v(E.children,H,null,U,K,vd(E,B),te,z),ve&&Fr(E,null,U,"created"),I(H,E,E.scopeId,te,U),_e){for(const We in _e)We!=="value"&&!Oa(We)&&i(H,We,null,_e[We],B,U);"value"in _e&&i(H,"value",null,_e.value,B),(G=_e.onVnodeBeforeMount)&&Zn(G,U,E)}ve&&Fr(E,null,U,"beforeMount");const ke=h0(K,pe);ke&&pe.beforeEnter(H),s(H,A,k),((G=_e&&_e.onVnodeMounted)||ke||ve)&&vn(()=>{G&&Zn(G,U,E),ke&&pe.enter(H),ve&&Fr(E,null,U,"mounted")},K)},I=(E,A,k,U,K)=>{if(k&&g(E,k),U)for(let B=0;B<U.length;B++)g(E,U[B]);if(K){let B=K.subTree;if(A===B||$I(B.type)&&(B.ssContent===A||B.ssFallback===A)){const te=K.vnode;I(E,te,te.scopeId,te.slotScopeIds,K.parent)}}},v=(E,A,k,U,K,B,te,z,H=0)=>{for(let G=H;G<E.length;G++){const _e=E[G]=z?rr(E[G]):ns(E[G]);C(null,_e,A,k,U,K,B,te,z)}},w=(E,A,k,U,K,B,te)=>{const z=A.el=E.el;let{patchFlag:H,dynamicChildren:G,dirs:_e}=A;H|=E.patchFlag&16;const ie=E.props||tt,pe=A.props||tt;let ve;if(k&&Ur(k,!1),(ve=pe.onVnodeBeforeUpdate)&&Zn(ve,k,A,E),_e&&Fr(A,E,k,"beforeUpdate"),k&&Ur(k,!0),(ie.innerHTML&&pe.innerHTML==null||ie.textContent&&pe.textContent==null)&&h(z,""),G?R(E.dynamicChildren,G,z,k,U,vd(A,K),B):te||Ne(E,A,z,null,k,U,vd(A,K),B,!1),H>0){if(H&16)S(z,ie,pe,k,K);else if(H&2&&ie.class!==pe.class&&i(z,"class",null,pe.class,K),H&4&&i(z,"style",ie.style,pe.style,K),H&8){const ke=A.dynamicProps;for(let We=0;We<ke.length;We++){const Ue=ke[We],qt=ie[Ue],jt=pe[Ue];(jt!==qt||Ue==="value")&&i(z,Ue,qt,jt,K,k)}}H&1&&E.children!==A.children&&h(z,A.children)}else!te&&G==null&&S(z,ie,pe,k,K);((ve=pe.onVnodeUpdated)||_e)&&vn(()=>{ve&&Zn(ve,k,A,E),_e&&Fr(A,E,k,"updated")},U)},R=(E,A,k,U,K,B,te)=>{for(let z=0;z<A.length;z++){const H=E[z],G=A[z],_e=H.el&&(H.type===$e||!fa(H,G)||H.shapeFlag&198)?d(H.el):k;C(H,G,_e,null,U,K,B,te,!0)}},S=(E,A,k,U,K)=>{if(A!==k){if(A!==tt)for(const B in A)!Oa(B)&&!(B in k)&&i(E,B,A[B],null,K,U);for(const B in k){if(Oa(B))continue;const te=k[B],z=A[B];te!==z&&B!=="value"&&i(E,B,z,te,K,U)}"value"in k&&i(E,"value",A.value,k.value,K)}},N=(E,A,k,U,K,B,te,z,H)=>{const G=A.el=E?E.el:a(""),_e=A.anchor=E?E.anchor:a("");let{patchFlag:ie,dynamicChildren:pe,slotScopeIds:ve}=A;ve&&(z=z?z.concat(ve):ve),E==null?(s(G,k,U),s(_e,k,U),v(A.children||[],k,_e,K,B,te,z,H)):ie>0&&ie&64&&pe&&E.dynamicChildren&&E.dynamicChildren.length===pe.length?(R(E.dynamicChildren,pe,k,K,B,te,z),(A.key!=null||K&&A===K.subTree)&&FI(E,A,!0)):Ne(E,A,k,_e,K,B,te,z,H)},T=(E,A,k,U,K,B,te,z,H)=>{A.slotScopeIds=z,E==null?A.shapeFlag&512?K.ctx.activate(A,k,U,te,H):he(A,k,U,K,B,te,H):ae(E,A,H)},he=(E,A,k,U,K,B,te)=>{const z=E.component=E0(E,U,K);if(II(E)&&(z.ctx.renderer=fe),T0(z,!1,te),z.asyncDep){if(K&&K.registerDep(z,Fe,te),!E.el){const H=z.subTree=ze(Os);L(null,H,A,k),E.placeholder=H.el}}else Fe(z,E,A,k,K,B,te)},ae=(E,A,k)=>{const U=A.component=E.component;if(t0(E,A,k))if(U.asyncDep&&!U.asyncResolved){Be(U,A,k);return}else U.next=A,U.update();else A.el=E.el,U.vnode=A},Fe=(E,A,k,U,K,B,te)=>{const z=()=>{if(E.isMounted){let{next:ie,bu:pe,u:ve,parent:ke,vnode:We}=E;{const _n=UI(E);if(_n){ie&&(ie.el=We.el,Be(E,ie,te)),_n.asyncDep.then(()=>{E.isUnmounted||z()});return}}let Ue=ie,qt;Ur(E,!1),ie?(ie.el=We.el,Be(E,ie,te)):ie=We,pe&&Nc(pe),(qt=ie.props&&ie.props.onVnodeBeforeUpdate)&&Zn(qt,ke,ie,We),Ur(E,!0);const jt=y_(E),gn=E.subTree;E.subTree=jt,C(gn,jt,d(gn.el),$(gn),E,K,B),ie.el=jt.el,Ue===null&&n0(E,jt.el),ve&&vn(ve,K),(qt=ie.props&&ie.props.onVnodeUpdated)&&vn(()=>Zn(qt,ke,ie,We),K)}else{let ie;const{el:pe,props:ve}=A,{bm:ke,m:We,parent:Ue,root:qt,type:jt}=E,gn=to(A);Ur(E,!1),ke&&Nc(ke),!gn&&(ie=ve&&ve.onVnodeBeforeMount)&&Zn(ie,Ue,A),Ur(E,!0);{qt.ce&&qt.ce._def.shadowRoot!==!1&&qt.ce._injectChildStyle(jt);const _n=E.subTree=y_(E);C(null,_n,k,U,E,K,B),A.el=_n.el}if(We&&vn(We,K),!gn&&(ie=ve&&ve.onVnodeMounted)){const _n=A;vn(()=>Zn(ie,Ue,_n),K)}(A.shapeFlag&256||Ue&&to(Ue.vnode)&&Ue.vnode.shapeFlag&256)&&E.a&&vn(E.a,K),E.isMounted=!0,A=k=U=null}};E.scope.on();const H=E.effect=new QE(z);E.scope.off();const G=E.update=H.run.bind(H),_e=E.job=H.runIfDirty.bind(H);_e.i=E,_e.id=E.uid,H.scheduler=()=>bp(_e),Ur(E,!0),G()},Be=(E,A,k)=>{A.component=E;const U=E.vnode.props;E.vnode=A,E.next=null,r0(E,A.props,U,k),l0(E,A.children,k),ks(),u_(E),xs()},Ne=(E,A,k,U,K,B,te,z,H=!1)=>{const G=E&&E.children,_e=E?E.shapeFlag:0,ie=A.children,{patchFlag:pe,shapeFlag:ve}=A;if(pe>0){if(pe&128){Sn(G,ie,k,U,K,B,te,z,H);return}else if(pe&256){Vt(G,ie,k,U,K,B,te,z,H);return}}ve&8?(_e&16&&Xe(G,K,B),ie!==G&&h(k,ie)):_e&16?ve&16?Sn(G,ie,k,U,K,B,te,z,H):Xe(G,K,B,!0):(_e&8&&h(k,""),ve&16&&v(ie,k,U,K,B,te,z,H))},Vt=(E,A,k,U,K,B,te,z,H)=>{E=E||Ji,A=A||Ji;const G=E.length,_e=A.length,ie=Math.min(G,_e);let pe;for(pe=0;pe<ie;pe++){const ve=A[pe]=H?rr(A[pe]):ns(A[pe]);C(E[pe],ve,k,null,K,B,te,z,H)}G>_e?Xe(E,K,B,!0,!1,ie):v(A,k,U,K,B,te,z,H,ie)},Sn=(E,A,k,U,K,B,te,z,H)=>{let G=0;const _e=A.length;let ie=E.length-1,pe=_e-1;for(;G<=ie&&G<=pe;){const ve=E[G],ke=A[G]=H?rr(A[G]):ns(A[G]);if(fa(ve,ke))C(ve,ke,k,null,K,B,te,z,H);else break;G++}for(;G<=ie&&G<=pe;){const ve=E[ie],ke=A[pe]=H?rr(A[pe]):ns(A[pe]);if(fa(ve,ke))C(ve,ke,k,null,K,B,te,z,H);else break;ie--,pe--}if(G>ie){if(G<=pe){const ve=pe+1,ke=ve<_e?A[ve].el:U;for(;G<=pe;)C(null,A[G]=H?rr(A[G]):ns(A[G]),k,ke,K,B,te,z,H),G++}}else if(G>pe)for(;G<=ie;)wt(E[G],K,B,!0),G++;else{const ve=G,ke=G,We=new Map;for(G=ke;G<=pe;G++){const Mt=A[G]=H?rr(A[G]):ns(A[G]);Mt.key!=null&&We.set(Mt.key,G)}let Ue,qt=0;const jt=pe-ke+1;let gn=!1,_n=0;const On=new Array(jt);for(G=0;G<jt;G++)On[G]=0;for(G=ve;G<=ie;G++){const Mt=E[G];if(qt>=jt){wt(Mt,K,B,!0);continue}let Nt;if(Mt.key!=null)Nt=We.get(Mt.key);else for(Ue=ke;Ue<=pe;Ue++)if(On[Ue-ke]===0&&fa(Mt,A[Ue])){Nt=Ue;break}Nt===void 0?wt(Mt,K,B,!0):(On[Nt-ke]=G+1,Nt>=_n?_n=Nt:gn=!0,C(Mt,A[Nt],k,null,K,B,te,z,H),qt++)}const ki=gn?d0(On):Ji;for(Ue=ki.length-1,G=jt-1;G>=0;G--){const Mt=ke+G,Nt=A[Mt],Yo=A[Mt+1],Dr=Mt+1<_e?Yo.el||BI(Yo):U;On[G]===0?C(null,Nt,k,Dr,K,B,te,z,H):gn&&(Ue<0||G!==ki[Ue]?tn(Nt,k,Dr,2):Ue--)}}},tn=(E,A,k,U,K=null)=>{const{el:B,type:te,transition:z,children:H,shapeFlag:G}=E;if(G&6){tn(E.component.subTree,A,k,U);return}if(G&128){E.suspense.move(A,k,U);return}if(G&64){te.move(E,A,k,fe);return}if(te===$e){s(B,A,k);for(let ie=0;ie<H.length;ie++)tn(H[ie],A,k,U);s(E.anchor,A,k);return}if(te===xc){D(E,A,k);return}if(U!==2&&G&1&&z)if(U===0)z.beforeEnter(B),s(B,A,k),vn(()=>z.enter(B),K);else{const{leave:ie,delayLeave:pe,afterLeave:ve}=z,ke=()=>{E.ctx.isUnmounted?r(B):s(B,A,k)},We=()=>{B._isLeaving&&B[CC](!0),ie(B,()=>{ke(),ve&&ve()})};pe?pe(B,ke,We):We()}else s(B,A,k)},wt=(E,A,k,U=!1,K=!1)=>{const{type:B,props:te,ref:z,children:H,dynamicChildren:G,shapeFlag:_e,patchFlag:ie,dirs:pe,cacheIndex:ve}=E;if(ie===-2&&(K=!1),z!=null&&(ks(),Fa(z,null,k,E,!0),xs()),ve!=null&&(A.renderCache[ve]=void 0),_e&256){A.ctx.deactivate(E);return}const ke=_e&1&&pe,We=!to(E);let Ue;if(We&&(Ue=te&&te.onVnodeBeforeUnmount)&&Zn(Ue,A,E),_e&6)re(E.component,k,U);else{if(_e&128){E.suspense.unmount(k,U);return}ke&&Fr(E,null,A,"beforeUnmount"),_e&64?E.type.remove(E,A,k,fe,U):G&&!G.hasOnce&&(B!==$e||ie>0&&ie&64)?Xe(G,A,k,!1,!0):(B===$e&&ie&384||!K&&_e&16)&&Xe(H,A,k),U&&oe(E)}(We&&(Ue=te&&te.onVnodeUnmounted)||ke)&&vn(()=>{Ue&&Zn(Ue,A,E),ke&&Fr(E,null,A,"unmounted")},k)},oe=E=>{const{type:A,el:k,anchor:U,transition:K}=E;if(A===$e){ee(k,U);return}if(A===xc){P(E);return}const B=()=>{r(k),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(E.shapeFlag&1&&K&&!K.persisted){const{leave:te,delayLeave:z}=K,H=()=>te(k,B);z?z(E.el,B,H):H()}else B()},ee=(E,A)=>{let k;for(;E!==A;)k=p(E),r(E),E=k;r(A)},re=(E,A,k)=>{const{bum:U,scope:K,job:B,subTree:te,um:z,m:H,a:G}=E;I_(H),I_(G),U&&Nc(U),K.stop(),B&&(B.flags|=8,wt(te,E,A,k)),z&&vn(z,A),vn(()=>{E.isUnmounted=!0},A)},Xe=(E,A,k,U=!1,K=!1,B=0)=>{for(let te=B;te<E.length;te++)wt(E[te],A,k,U,K)},$=E=>{if(E.shapeFlag&6)return $(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const A=p(E.anchor||E.el),k=A&&A[SC];return k?p(k):A};let ce=!1;const ne=(E,A,k)=>{let U;E==null?A._vnode&&(wt(A._vnode,null,null,!0),U=A._vnode.component):C(A._vnode||null,E,A,null,null,null,k),A._vnode=E,ce||(ce=!0,u_(U),mI(),ce=!1)},fe={p:C,um:wt,m:tn,r:oe,mt:he,mc:v,pc:Ne,pbc:R,n:$,o:n};return{render:ne,hydrate:void 0,createApp:QC(ne)}}function vd({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ur({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function h0(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function FI(n,e,t=!1){const s=n.children,r=e.children;if(Ie(s)&&Ie(r))for(let i=0;i<s.length;i++){const o=s[i];let a=r[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[i]=rr(r[i]),a.el=o.el),!t&&a.patchFlag!==-2&&FI(o,a)),a.type===fh&&(a.patchFlag!==-1?a.el=o.el:a.__elIndex=i+(n.type===$e?1:0)),a.type===Os&&!a.el&&(a.el=o.el)}}function d0(n){const e=n.slice(),t=[0];let s,r,i,o,a;const l=n.length;for(s=0;s<l;s++){const u=n[s];if(u!==0){if(r=t[t.length-1],n[r]<u){e[s]=r,t.push(s);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[s]=t[i-1]),t[i]=s)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function UI(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:UI(e)}function I_(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}function BI(n){if(n.placeholder)return n.placeholder;const e=n.component;return e?BI(e.subTree):null}const $I=n=>n.__isSuspense;function f0(n,e){e&&e.pendingBranch?Ie(n)?e.effects.push(...n):e.effects.push(n):TC(n)}const $e=Symbol.for("v-fgt"),fh=Symbol.for("v-txt"),Os=Symbol.for("v-cmt"),xc=Symbol.for("v-stc"),Ba=[];let Tn=null;function W(n=!1){Ba.push(Tn=n?null:[])}function p0(){Ba.pop(),Tn=Ba[Ba.length-1]||null}let al=1;function au(n,e=!1){al+=n,n<0&&Tn&&e&&(Tn.hasOnce=!0)}function qI(n){return n.dynamicChildren=al>0?Tn||Ji:null,p0(),al>0&&Tn&&Tn.push(n),n}function X(n,e,t,s,r,i){return qI(_(n,e,t,s,r,i,!0))}function mo(n,e,t,s,r){return qI(ze(n,e,t,s,r,!0))}function ll(n){return n?n.__v_isVNode===!0:!1}function fa(n,e){return n.type===e.type&&n.key===e.key}const jI=({key:n})=>n??null,Dc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?It(n)||Xt(n)||Ae(n)?{i:Ut,r:n,k:e,f:!!t}:n:null);function _(n,e=null,t=null,s=0,r=null,i=n===$e?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&jI(e),ref:e&&Dc(e),scopeId:_I,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Ut};return a?(Np(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=It(t)?8:16),al>0&&!o&&Tn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Tn.push(l),l}const ze=m0;function m0(n,e=null,t=null,s=0,r=null,i=!1){if((!n||n===BC)&&(n=Os),ll(n)){const a=go(n,e,!0);return t&&Np(a,t),al>0&&!i&&Tn&&(a.shapeFlag&6?Tn[Tn.indexOf(n)]=a:Tn.push(a)),a.patchFlag=-2,a}if(R0(n)&&(n=n.__vccOpts),e){e=g0(e);let{class:a,style:l}=e;a&&!It(a)&&(e.class=ho(a)),st(l)&&(wp(l)&&!Ie(l)&&(l=en({},l)),e.style=ah(l))}const o=It(n)?1:$I(n)?128:RC(n)?64:st(n)?4:Ae(n)?2:0;return _(n,e,t,s,r,o,i,!0)}function g0(n){return n?wp(n)||xI(n)?en({},n):n:null}function go(n,e,t=!1,s=!1){const{props:r,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?_0(r||{},e):r,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&jI(u),ref:e&&e.ref?t&&i?Ie(i)?i.concat(Dc(e)):[i,Dc(e)]:Dc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==$e?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&go(n.ssContent),ssFallback:n.ssFallback&&go(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&Sp(h,l.clone(h)),h}function Ft(n=" ",e=0){return ze(fh,null,n,e)}function Kn(n,e){const t=ze(xc,null,n);return t.staticCount=e,t}function _t(n="",e=!1){return e?(W(),mo(Os,null,n)):ze(Os,null,n)}function ns(n){return n==null||typeof n=="boolean"?ze(Os):Ie(n)?ze($e,null,n.slice()):ll(n)?rr(n):ze(fh,null,String(n))}function rr(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:go(n)}function Np(n,e){let t=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(Ie(e))t=16;else if(typeof e=="object")if(s&65){const r=e.default;r&&(r._c&&(r._d=!1),Np(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!xI(e)?e._ctx=Ut:r===3&&Ut&&(Ut.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ae(e)?(e={default:e,_ctx:Ut},t=32):(e=String(e),s&64?(t=16,e=[Ft(e)]):t=8);n.children=e,n.shapeFlag|=t}function _0(...n){const e={};for(let t=0;t<n.length;t++){const s=n[t];for(const r in s)if(r==="class")e.class!==s.class&&(e.class=ho([e.class,s.class]));else if(r==="style")e.style=ah([e.style,s.style]);else if(nh(r)){const i=e[r],o=s[r];o&&i!==o&&!(Ie(i)&&i.includes(o))&&(e[r]=i?[].concat(i,o):o)}else r!==""&&(e[r]=s[r])}return e}function Zn(n,e,t,s=null){fs(n,e,7,[t,s])}const y0=CI();let v0=0;function E0(n,e,t){const s=n.type,r=(e?e.appContext:n.appContext)||y0,i={uid:v0++,vnode:n,type:s,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new GR(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:OI(s,r),emitsOptions:PI(s,r),emit:null,emitted:null,propsDefaults:tt,inheritAttrs:s.inheritAttrs,ctx:tt,data:tt,props:tt,attrs:tt,slots:tt,refs:tt,setupState:tt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=XC.bind(null,i),n.ce&&n.ce(i),i}let Yt=null;const I0=()=>Yt||Ut;let lu,of;{const n=oh(),e=(t,s)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(s),i=>{r.length>1?r.forEach(o=>o(i)):r[0](i)}};lu=e("__VUE_INSTANCE_SETTERS__",t=>Yt=t),of=e("__VUE_SSR_SETTERS__",t=>cl=t)}const Fl=n=>{const e=Yt;return lu(n),n.scope.on(),()=>{n.scope.off(),lu(e)}},T_=()=>{Yt&&Yt.scope.off(),lu(null)};function KI(n){return n.vnode.shapeFlag&4}let cl=!1;function T0(n,e=!1,t=!1){e&&of(e);const{props:s,children:r}=n.vnode,i=KI(n);s0(n,s,i,e),a0(n,r,t||e);const o=i?w0(n,e):void 0;return e&&of(!1),o}function w0(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,qC);const{setup:s}=t;if(s){ks();const r=n.setupContext=s.length>1?A0(n):null,i=Fl(n),o=Ll(s,n,0,[n.props,r]),a=$E(o);if(xs(),i(),(a||n.sp)&&!to(n)&&EI(n),a){if(o.then(T_,T_),e)return o.then(l=>{w_(n,l)}).catch(l=>{uh(l,n,0)});n.asyncDep=o}else w_(n,o)}else GI(n)}function w_(n,e,t){Ae(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:st(e)&&(n.setupState=hI(e)),GI(n)}function GI(n,e,t){const s=n.type;n.render||(n.render=s.render||os);{const r=Fl(n);ks();try{jC(n)}finally{xs(),r()}}}const b0={get(n,e){return zt(n,"get",""),n[e]}};function A0(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,b0),slots:n.slots,emit:n.emit,expose:e}}function ph(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(hI(dC(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ua)return Ua[t](n)},has(e,t){return t in e||t in Ua}})):n.proxy}function S0(n,e=!0){return Ae(n)?n.displayName||n.name:n.name||e&&n.__name}function R0(n){return Ae(n)&&"__vccOpts"in n}const me=(n,e)=>_C(n,e,cl);function HI(n,e,t){try{au(-1);const s=arguments.length;return s===2?st(e)&&!Ie(e)?ll(e)?ze(n,null,[e]):ze(n,e):ze(n,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&ll(t)&&(t=[t]),ze(n,e,t))}finally{au(1)}}const C0="3.5.26";let af;const b_=typeof window<"u"&&window.trustedTypes;if(b_)try{af=b_.createPolicy("vue",{createHTML:n=>n})}catch{}const zI=af?n=>af.createHTML(n):n=>n,P0="http://www.w3.org/2000/svg",N0="http://www.w3.org/1998/Math/MathML",vs=typeof document<"u"?document:null,A_=vs&&vs.createElement("template"),k0={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,s)=>{const r=e==="svg"?vs.createElementNS(P0,n):e==="mathml"?vs.createElementNS(N0,n):t?vs.createElement(n,{is:t}):vs.createElement(n);return n==="select"&&s&&s.multiple!=null&&r.setAttribute("multiple",s.multiple),r},createText:n=>vs.createTextNode(n),createComment:n=>vs.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>vs.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,s,r,i){const o=t?t.previousSibling:e.lastChild;if(r&&(r===i||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===i||!(r=r.nextSibling)););else{A_.innerHTML=zI(s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n);const a=A_.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},x0=Symbol("_vtc");function D0(n,e,t){const s=n[x0];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const S_=Symbol("_vod"),O0=Symbol("_vsh"),V0=Symbol(""),M0=/(?:^|;)\s*display\s*:/;function L0(n,e,t){const s=n.style,r=It(t);let i=!1;if(t&&!r){if(e)if(It(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Oc(s,a,"")}else for(const o in e)t[o]==null&&Oc(s,o,"");for(const o in t)o==="display"&&(i=!0),Oc(s,o,t[o])}else if(r){if(e!==t){const o=s[V0];o&&(t+=";"+o),s.cssText=t,i=M0.test(t)}}else e&&n.removeAttribute("style");S_ in n&&(n[S_]=i?s.display:"",n[O0]&&(s.display="none"))}const R_=/\s*!important$/;function Oc(n,e,t){if(Ie(t))t.forEach(s=>Oc(n,e,s));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const s=F0(n,e);R_.test(t)?n.setProperty(wi(s),t.replace(R_,""),"important"):n[s]=t}}const C_=["Webkit","Moz","ms"],Ed={};function F0(n,e){const t=Ed[e];if(t)return t;let s=Dn(e);if(s!=="filter"&&s in n)return Ed[e]=s;s=ih(s);for(let r=0;r<C_.length;r++){const i=C_[r]+s;if(i in n)return Ed[e]=i}return e}const P_="http://www.w3.org/1999/xlink";function N_(n,e,t,s,r,i=jR(e)){s&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(P_,e.slice(6,e.length)):n.setAttributeNS(P_,e,t):t==null||i&&!GE(t)?n.removeAttribute(e):n.setAttribute(e,i?"":zn(t)?String(t):t)}function k_(n,e,t,s,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?zI(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=GE(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(r||e)}function or(n,e,t,s){n.addEventListener(e,t,s)}function U0(n,e,t,s){n.removeEventListener(e,t,s)}const x_=Symbol("_vei");function B0(n,e,t,s,r=null){const i=n[x_]||(n[x_]={}),o=i[e];if(s&&o)o.value=s;else{const[a,l]=$0(e);if(s){const u=i[e]=K0(s,r);or(n,a,u,l)}else o&&(U0(n,a,o,l),i[e]=void 0)}}const D_=/(?:Once|Passive|Capture)$/;function $0(n){let e;if(D_.test(n)){e={};let s;for(;s=n.match(D_);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):wi(n.slice(2)),e]}let Id=0;const q0=Promise.resolve(),j0=()=>Id||(q0.then(()=>Id=0),Id=Date.now());function K0(n,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;fs(G0(s,t.value),e,5,[s])};return t.value=n,t.attached=j0(),t}function G0(n,e){if(Ie(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(s=>r=>!r._stopped&&s&&s(r))}else return e}const O_=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,H0=(n,e,t,s,r,i)=>{const o=r==="svg";e==="class"?D0(n,s,o):e==="style"?L0(n,t,s):nh(e)?fp(e)||B0(n,e,t,s,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):z0(n,e,s,o))?(k_(n,e,s),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&N_(n,e,s,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!It(s))?k_(n,Dn(e),s,i,e):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),N_(n,e,s,o))};function z0(n,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in n&&O_(e)&&Ae(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return O_(e)&&It(t)?!1:e in n}const _o=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ie(e)?t=>Nc(e,t):e};function W0(n){n.target.composing=!0}function V_(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Rs=Symbol("_assign");function M_(n,e,t){return e&&(n=n.trim()),t&&(n=gp(n)),n}const Q0={created(n,{modifiers:{lazy:e,trim:t,number:s}},r){n[Rs]=_o(r);const i=s||r.props&&r.props.type==="number";or(n,e?"change":"input",o=>{o.target.composing||n[Rs](M_(n.value,t,i))}),(t||i)&&or(n,"change",()=>{n.value=M_(n.value,t,i)}),e||(or(n,"compositionstart",W0),or(n,"compositionend",V_),or(n,"change",V_))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:s,trim:r,number:i}},o){if(n[Rs]=_o(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?gp(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(s&&e===t||r&&n.value.trim()===l)||(n.value=l))}},Y0={deep:!0,created(n,e,t){n[Rs]=_o(t),or(n,"change",()=>{const s=n._modelValue,r=WI(n),i=n.checked,o=n[Rs];if(Ie(s)){const a=HE(s,r),l=a!==-1;if(i&&!l)o(s.concat(r));else if(!i&&l){const u=[...s];u.splice(a,1),o(u)}}else if(sh(s)){const a=new Set(s);i?a.add(r):a.delete(r),o(a)}else o(QI(n,i))})},mounted:L_,beforeUpdate(n,e,t){n[Rs]=_o(t),L_(n,e,t)}};function L_(n,{value:e,oldValue:t},s){n._modelValue=e;let r;if(Ie(e))r=HE(e,s.props.value)>-1;else if(sh(e))r=e.has(s.props.value);else{if(e===t)return;r=fo(e,QI(n,!0))}n.checked!==r&&(n.checked=r)}const Td={created(n,{value:e},t){n.checked=fo(e,t.props.value),n[Rs]=_o(t),or(n,"change",()=>{n[Rs](WI(n))})},beforeUpdate(n,{value:e,oldValue:t},s){n[Rs]=_o(s),e!==t&&(n.checked=fo(e,s.props.value))}};function WI(n){return"_value"in n?n._value:n.value}function QI(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const X0=["ctrl","shift","alt","meta"],J0={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>X0.some(t=>n[`${t}Key`]&&!e.includes(t))},YI=(n,e)=>{const t=n._withMods||(n._withMods={}),s=e.join(".");return t[s]||(t[s]=((r,...i)=>{for(let o=0;o<e.length;o++){const a=J0[e[o]];if(a&&a(r,e))return}return n(r,...i)}))},Z0=en({patchProp:H0},k0);let F_;function eP(){return F_||(F_=c0(Z0))}const tP=((...n)=>{const e=eP().createApp(...n),{mount:t}=e;return e.mount=s=>{const r=sP(s);if(!r)return;const i=e._component;!Ae(i)&&!i.render&&!i.template&&(i.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=t(r,!1,nP(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},e});function nP(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function sP(n){return It(n)?document.querySelector(n):n}const rP=()=>{};var U_={};const XI={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const J=function(n,e){if(!n)throw Bo(e)},Bo=function(n){return new Error("Firebase Database ("+XI.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const JI=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},iP=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},kp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,g=u&63;l||(g=64,o||(p=64)),s.push(t[h],t[d],t[p],t[g])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(JI(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):iP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const d=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||d==null)throw new oP;const p=i<<2|a>>4;if(s.push(p),u!==64){const g=a<<4&240|u>>2;if(s.push(g),d!==64){const b=u<<6&192|d;s.push(b)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class oP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ZI=function(n){const e=JI(n);return kp.encodeByteArray(e,!0)},cu=function(n){return ZI(n).replace(/\./g,"")},uu=function(n){try{return kp.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function aP(n){return eT(void 0,n)}function eT(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!lP(t)||(n[t]=eT(n[t],e[t]));return n}function lP(n){return n!=="__proto__"}function tT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const cP=()=>tT().__FIREBASE_DEFAULTS__,uP=()=>{if(typeof process>"u"||typeof U_>"u")return;const n=U_.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},hP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&uu(n[1]);return e&&JSON.parse(e)},mh=()=>{try{return rP()||cP()||uP()||hP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},nT=n=>mh()?.emulatorHosts?.[n],dP=n=>{const e=nT(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},sT=()=>mh()?.config,rT=n=>mh()?.[`_${n}`];class xp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Rr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Dp(n){return(await fetch(n,{credentials:"include"})).ok}function fP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[cu(JSON.stringify(t)),cu(JSON.stringify(o)),""].join(".")}const $a={};function pP(){const n={prod:[],emulator:[]};for(const e of Object.keys($a))$a[e]?n.emulator.push(e):n.prod.push(e);return n}function mP(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let B_=!1;function iT(n,e){if(typeof window>"u"||typeof document>"u"||!Rr(window.location.host)||$a[n]===e||$a[n]||B_)return;$a[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",i=pP().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,g){p.setAttribute("width","24"),p.setAttribute("id",g),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{B_=!0,o()},p}function h(p,g){p.setAttribute("id",g),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function d(){const p=mP(s),g=t("text"),b=document.getElementById(g)||document.createElement("span"),C=t("learnmore"),V=document.getElementById(C)||document.createElement("a"),L=t("preprendIcon"),F=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const D=p.element;a(D),h(V,C);const P=u();l(F,L),D.append(F,b,V,P),document.body.appendChild(D)}i?(b.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function Ct(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Op(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ct())}function oT(){const n=mh()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function gP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function _P(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function aT(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function yP(){const n=Ct();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function vP(){return XI.NODE_ADMIN===!0}function lT(){return!oT()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cT(){return!oT()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function uT(){try{return typeof indexedDB=="object"}catch{return!1}}function EP(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const IP="FirebaseError";class $s extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=IP,Object.setPrototypeOf(this,$s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ul.prototype.create)}}class Ul{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?TP(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new $s(r,a,s)}}function TP(n,e){return n.replace(wP,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const wP=/\{\$([^}]+)}/g;function ul(n){return JSON.parse(n)}function Ot(n){return JSON.stringify(n)}const hT=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=ul(uu(i[0])||""),t=ul(uu(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},bP=function(n){const e=hT(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},AP=function(n){const e=hT(n).claims;return typeof e=="object"&&e.admin===!0};function qs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function yo(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function lf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function hu(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function vr(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if($_(i)&&$_(o)){if(!vr(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function $_(n){return n!==null&&typeof n=="object"}function $o(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class SP{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)s[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const p=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(p<<1|p>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let d=0;d<80;d++){d<40?d<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):d<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(r<<5|r>>>27)+u+l+h+s[d]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=p}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function RP(n,e){const t=new CP(n,e);return t.subscribe.bind(t)}class CP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");PP(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=wd),r.error===void 0&&(r.error=wd),r.complete===void 0&&(r.complete=wd);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function PP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wd(){}function dT(n,e){return`${n} failed: ${e} argument `}const NP=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,J(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},gh=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function $t(n){return n&&n._delegate?n._delegate:n}class Er{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const qr="[DEFAULT]";class kP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new xp;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(DP(e))try{this.getOrInitializeService({instanceIdentifier:qr})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=qr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qr){return this.instances.has(e)}getOptions(e=qr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:xP(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=qr){return this.component?this.component.multipleInstances?e:qr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xP(n){return n===qr?void 0:n}function DP(n){return n.instantiationMode==="EAGER"}class OP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new kP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var xe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(xe||(xe={}));const VP={debug:xe.DEBUG,verbose:xe.VERBOSE,info:xe.INFO,warn:xe.WARN,error:xe.ERROR,silent:xe.SILENT},MP=xe.INFO,LP={[xe.DEBUG]:"log",[xe.VERBOSE]:"log",[xe.INFO]:"info",[xe.WARN]:"warn",[xe.ERROR]:"error"},FP=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=LP[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _h{constructor(e){this.name=e,this._logLevel=MP,this._logHandler=FP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?VP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xe.DEBUG,...e),this._logHandler(this,xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xe.VERBOSE,...e),this._logHandler(this,xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xe.INFO,...e),this._logHandler(this,xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xe.WARN,...e),this._logHandler(this,xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xe.ERROR,...e),this._logHandler(this,xe.ERROR,...e)}}const UP=(n,e)=>e.some(t=>n instanceof t);let q_,j_;function BP(){return q_||(q_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $P(){return j_||(j_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fT=new WeakMap,cf=new WeakMap,pT=new WeakMap,bd=new WeakMap,Vp=new WeakMap;function qP(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(fr(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&fT.set(t,n)}).catch(()=>{}),Vp.set(e,n),e}function jP(n){if(cf.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});cf.set(n,e)}let uf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return cf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||pT.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return fr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function KP(n){uf=n(uf)}function GP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Ad(this),e,...t);return pT.set(s,e.sort?e.sort():[e]),fr(s)}:$P().includes(n)?function(...e){return n.apply(Ad(this),e),fr(fT.get(this))}:function(...e){return fr(n.apply(Ad(this),e))}}function HP(n){return typeof n=="function"?GP(n):(n instanceof IDBTransaction&&jP(n),UP(n,BP())?new Proxy(n,uf):n)}function fr(n){if(n instanceof IDBRequest)return qP(n);if(bd.has(n))return bd.get(n);const e=HP(n);return e!==n&&(bd.set(n,e),Vp.set(e,n)),e}const Ad=n=>Vp.get(n);function zP(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=fr(o);return s&&o.addEventListener("upgradeneeded",l=>{s(fr(o.result),l.oldVersion,l.newVersion,fr(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const WP=["get","getKey","getAll","getAllKeys","count"],QP=["put","add","delete","clear"],Sd=new Map;function K_(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sd.get(e))return Sd.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=QP.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||WP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return Sd.set(e,i),i}KP(n=>({...n,get:(e,t,s)=>K_(e,t)||n.get(e,t,s),has:(e,t)=>!!K_(e,t)||n.has(e,t)}));class YP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(XP(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function XP(n){return n.getComponent()?.type==="VERSION"}const hf="@firebase/app",G_="0.14.6";const Vs=new _h("@firebase/app"),JP="@firebase/app-compat",ZP="@firebase/analytics-compat",e1="@firebase/analytics",t1="@firebase/app-check-compat",n1="@firebase/app-check",s1="@firebase/auth",r1="@firebase/auth-compat",i1="@firebase/database",o1="@firebase/data-connect",a1="@firebase/database-compat",l1="@firebase/functions",c1="@firebase/functions-compat",u1="@firebase/installations",h1="@firebase/installations-compat",d1="@firebase/messaging",f1="@firebase/messaging-compat",p1="@firebase/performance",m1="@firebase/performance-compat",g1="@firebase/remote-config",_1="@firebase/remote-config-compat",y1="@firebase/storage",v1="@firebase/storage-compat",E1="@firebase/firestore",I1="@firebase/ai",T1="@firebase/firestore-compat",w1="firebase",b1="12.6.0";const df="[DEFAULT]",A1={[hf]:"fire-core",[JP]:"fire-core-compat",[e1]:"fire-analytics",[ZP]:"fire-analytics-compat",[n1]:"fire-app-check",[t1]:"fire-app-check-compat",[s1]:"fire-auth",[r1]:"fire-auth-compat",[i1]:"fire-rtdb",[o1]:"fire-data-connect",[a1]:"fire-rtdb-compat",[l1]:"fire-fn",[c1]:"fire-fn-compat",[u1]:"fire-iid",[h1]:"fire-iid-compat",[d1]:"fire-fcm",[f1]:"fire-fcm-compat",[p1]:"fire-perf",[m1]:"fire-perf-compat",[g1]:"fire-rc",[_1]:"fire-rc-compat",[y1]:"fire-gcs",[v1]:"fire-gcs-compat",[E1]:"fire-fst",[T1]:"fire-fst-compat",[I1]:"fire-vertex","fire-js":"fire-js",[w1]:"fire-js-all"};const du=new Map,S1=new Map,ff=new Map;function H_(n,e){try{n.container.addComponent(e)}catch(t){Vs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ci(n){const e=n.name;if(ff.has(e))return Vs.debug(`There were multiple attempts to register component ${e}.`),!1;ff.set(e,n);for(const t of du.values())H_(t,n);for(const t of S1.values())H_(t,n);return!0}function yh(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Rn(n){return n==null?!1:n.settings!==void 0}const R1={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pr=new Ul("app","Firebase",R1);class C1{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Er("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pr.create("app-deleted",{appName:this._name})}}const bi=b1;function mT(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:df,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw pr.create("bad-app-name",{appName:String(r)});if(t||(t=sT()),!t)throw pr.create("no-options");const i=du.get(r);if(i){if(vr(t,i.options)&&vr(s,i.config))return i;throw pr.create("duplicate-app",{appName:r})}const o=new OP(r);for(const l of ff.values())o.addComponent(l);const a=new C1(t,s,o);return du.set(r,a),a}function gT(n=df){const e=du.get(n);if(!e&&n===df&&sT())return mT();if(!e)throw pr.create("no-app",{appName:n});return e}function ls(n,e,t){let s=A1[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Vs.warn(o.join(" "));return}ci(new Er(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const P1="firebase-heartbeat-database",N1=1,hl="firebase-heartbeat-store";let Rd=null;function _T(){return Rd||(Rd=zP(P1,N1,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(hl)}catch(t){console.warn(t)}}}}).catch(n=>{throw pr.create("idb-open",{originalErrorMessage:n.message})})),Rd}async function k1(n){try{const t=(await _T()).transaction(hl),s=await t.objectStore(hl).get(yT(n));return await t.done,s}catch(e){if(e instanceof $s)Vs.warn(e.message);else{const t=pr.create("idb-get",{originalErrorMessage:e?.message});Vs.warn(t.message)}}}async function z_(n,e){try{const s=(await _T()).transaction(hl,"readwrite");await s.objectStore(hl).put(e,yT(n)),await s.done}catch(t){if(t instanceof $s)Vs.warn(t.message);else{const s=pr.create("idb-set",{originalErrorMessage:t?.message});Vs.warn(s.message)}}}function yT(n){return`${n.name}!${n.options.appId}`}const x1=1024,D1=30;class O1{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new M1(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=W_();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>D1){const r=L1(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Vs.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=W_(),{heartbeatsToSend:t,unsentEntries:s}=V1(this._heartbeatsCache.heartbeats),r=cu(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Vs.warn(e),""}}}function W_(){return new Date().toISOString().substring(0,10)}function V1(n,e=x1){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),Q_(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Q_(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class M1{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return uT()?EP().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await k1(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return z_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return z_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Q_(n){return cu(JSON.stringify({version:2,heartbeats:n})).length}function L1(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function F1(n){ci(new Er("platform-logger",e=>new YP(e),"PRIVATE")),ci(new Er("heartbeat",e=>new O1(e),"PRIVATE")),ls(hf,G_,n),ls(hf,G_,"esm2020"),ls("fire-js","")}F1("");function vT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const U1=vT,ET=new Ul("auth","Firebase",vT());const fu=new _h("@firebase/auth");function B1(n,...e){fu.logLevel<=xe.WARN&&fu.warn(`Auth (${bi}): ${n}`,...e)}function Vc(n,...e){fu.logLevel<=xe.ERROR&&fu.error(`Auth (${bi}): ${n}`,...e)}function ps(n,...e){throw Lp(n,...e)}function Gn(n,...e){return Lp(n,...e)}function Mp(n,e,t){const s={...U1(),[e]:t};return new Ul("auth","Firebase",s).create(e,{appName:n.name})}function si(n){return Mp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $1(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&ps(n,"argument-error"),Mp(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Lp(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return ET.create(n,...e)}function Te(n,e,...t){if(!n)throw Lp(e,...t)}function ws(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Vc(e),new Error(e)}function Ms(n,e){n||ws(e)}function pf(){return typeof self<"u"&&self.location?.href||""}function q1(){return Y_()==="http:"||Y_()==="https:"}function Y_(){return typeof self<"u"&&self.location?.protocol||null}function j1(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(q1()||_P()||"connection"in navigator)?navigator.onLine:!0}function K1(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Bl{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ms(t>e,"Short delay should be less than long delay!"),this.isMobile=Op()||aT()}get(){return j1()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Fp(n,e){Ms(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class IT{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ws("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ws("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ws("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const G1={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const H1=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],z1=new Bl(3e4,6e4);function Up(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function qo(n,e,t,s,r={}){return TT(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=$o({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return gP()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Rr(n.emulatorConfig.host)&&(u.credentials="include"),IT.fetch()(await wT(n,n.config.apiHost,t,a),u)})}async function TT(n,e,t){n._canInitEmulator=!1;const s={...G1,...e};try{const r=new Q1(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw vc(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw vc(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw vc(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw vc(n,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Mp(n,h,u);ps(n,h)}}catch(r){if(r instanceof $s)throw r;ps(n,"network-request-failed",{message:String(r)})}}async function W1(n,e,t,s,r={}){const i=await qo(n,e,t,s,r);return"mfaPendingCredential"in i&&ps(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function wT(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?Fp(n.config,r):`${n.config.apiScheme}://${r}`;return H1.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class Q1{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Gn(this.auth,"network-request-failed")),z1.get())})}}function vc(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=Gn(n,e,s);return r.customData._tokenResponse=t,r}async function Y1(n,e){return qo(n,"POST","/v1/accounts:delete",e)}async function pu(n,e){return qo(n,"POST","/v1/accounts:lookup",e)}function qa(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function X1(n,e=!1){const t=$t(n),s=await t.getIdToken(e),r=Bp(s);Te(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:qa(Cd(r.auth_time)),issuedAtTime:qa(Cd(r.iat)),expirationTime:qa(Cd(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Cd(n){return Number(n)*1e3}function Bp(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Vc("JWT malformed, contained fewer than 3 sections"),null;try{const r=uu(t);return r?JSON.parse(r):(Vc("Failed to decode base64 JWT payload"),null)}catch(r){return Vc("Caught error parsing JWT payload as JSON",r?.toString()),null}}function X_(n){const e=Bp(n);return Te(e,"internal-error"),Te(typeof e.exp<"u","internal-error"),Te(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function dl(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof $s&&J1(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function J1({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Z1{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class mf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=qa(this.lastLoginAt),this.creationTime=qa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mu(n){const e=n.auth,t=await n.getIdToken(),s=await dl(n,pu(e,{idToken:t}));Te(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?bT(r.providerUserInfo):[],o=tN(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!o?.length,u=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new mf(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function eN(n){const e=$t(n);await mu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function tN(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function bT(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function nN(n,e){const t=await TT(n,{},async()=>{const s=$o({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await wT(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&Rr(n.emulatorConfig.host)&&(l.credentials="include"),IT.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function sN(n,e){return qo(n,"POST","/v2/accounts:revokeToken",Up(n,e))}class so{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Te(e.idToken,"internal-error"),Te(typeof e.idToken<"u","internal-error"),Te(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):X_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Te(e.length!==0,"internal-error");const t=X_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Te(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await nN(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new so;return s&&(Te(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(Te(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(Te(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new so,this.toJSON())}_performRefresh(){return ws("not implemented")}}function Ys(n,e){Te(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Un{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new Z1(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new mf(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await dl(this,this.stsTokenManager.getToken(this.auth,e));return Te(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return X1(this,e)}reload(){return eN(this)}_assign(e){this!==e&&(Te(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Un({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Te(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await mu(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rn(this.auth.app))return Promise.reject(si(this.auth));const e=await this.getIdToken();return await dl(this,Y1(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:d,emailVerified:p,isAnonymous:g,providerData:b,stsTokenManager:C}=t;Te(d&&C,e,"internal-error");const V=so.fromJSON(this.name,C);Te(typeof d=="string",e,"internal-error"),Ys(s,e.name),Ys(r,e.name),Te(typeof p=="boolean",e,"internal-error"),Te(typeof g=="boolean",e,"internal-error"),Ys(i,e.name),Ys(o,e.name),Ys(a,e.name),Ys(l,e.name),Ys(u,e.name),Ys(h,e.name);const L=new Un({uid:d,auth:e,email:r,emailVerified:p,displayName:s,isAnonymous:g,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:V,createdAt:u,lastLoginAt:h});return b&&Array.isArray(b)&&(L.providerData=b.map(F=>({...F}))),l&&(L._redirectEventId=l),L}static async _fromIdTokenResponse(e,t,s=!1){const r=new so;r.updateFromServerResponse(t);const i=new Un({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await mu(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];Te(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?bT(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!i?.length,a=new so;a.updateFromIdToken(s);const l=new Un({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new mf(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,u),l}}const J_=new Map;function bs(n){Ms(n instanceof Function,"Expected a class definition");let e=J_.get(n);return e?(Ms(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,J_.set(n,e),e)}class AT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}AT.type="NONE";const Z_=AT;function Mc(n,e,t){return`firebase:${n}:${e}:${t}`}class ro{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Mc(this.userKey,r.apiKey,i),this.fullPersistenceKey=Mc("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await pu(this.auth,{idToken:e}).catch(()=>{});return t?Un._fromGetAccountInfoResponse(this.auth,t,e):null}return Un._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new ro(bs(Z_),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||bs(Z_);const o=Mc(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let d;if(typeof h=="string"){const p=await pu(e,{idToken:h}).catch(()=>{});if(!p)break;d=await Un._fromGetAccountInfoResponse(e,p,h)}else d=Un._fromJSON(e,h);u!==i&&(a=d),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ro(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new ro(i,e,s))}}function ey(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(PT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ST(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kT(e))return"Blackberry";if(xT(e))return"Webos";if(RT(e))return"Safari";if((e.includes("chrome/")||CT(e))&&!e.includes("edge/"))return"Chrome";if(NT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function ST(n=Ct()){return/firefox\//i.test(n)}function RT(n=Ct()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function CT(n=Ct()){return/crios\//i.test(n)}function PT(n=Ct()){return/iemobile/i.test(n)}function NT(n=Ct()){return/android/i.test(n)}function kT(n=Ct()){return/blackberry/i.test(n)}function xT(n=Ct()){return/webos/i.test(n)}function $p(n=Ct()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function rN(n=Ct()){return $p(n)&&!!window.navigator?.standalone}function iN(){return yP()&&document.documentMode===10}function DT(n=Ct()){return $p(n)||NT(n)||xT(n)||kT(n)||/windows phone/i.test(n)||PT(n)}function OT(n,e=[]){let t;switch(n){case"Browser":t=ey(Ct());break;case"Worker":t=`${ey(Ct())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${bi}/${s}`}class oN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function aN(n,e={}){return qo(n,"GET","/v2/passwordPolicy",Up(n,e))}const lN=6;class cN{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??lN,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class uN{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ty(this),this.idTokenSubscription=new ty(this),this.beforeStateQueue=new oN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ET,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=bs(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ro.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await pu(this,{idToken:e}),s=await Un._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Rn(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Te(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mu(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=K1()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Rn(this.app))return Promise.reject(si(this));const t=e?$t(e):null;return t&&Te(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Te(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Rn(this.app)?Promise.reject(si(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Rn(this.app)?Promise.reject(si(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(bs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aN(this),t=new cN(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ul("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await sN(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&bs(e)||this._popupRedirectResolver;Te(t,this,"argument-error"),this.redirectPersistenceManager=await ro.create(this,[bs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Te(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Te(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=OT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(Rn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&B1(`Error while retrieving App Check token: ${e.error}`),e?.token}}function vh(n){return $t(n)}class ty{constructor(e){this.auth=e,this.observer=null,this.addObserver=RP(t=>this.observer=t)}get next(){return Te(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let qp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hN(n){qp=n}function dN(n){return qp.loadJS(n)}function fN(){return qp.gapiScript}function pN(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function mN(n,e){const t=yh(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(vr(i,e??{}))return r;ps(r,"already-initialized")}return t.initialize({options:e})}function gN(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(bs);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function _N(n,e,t){const s=vh(n);Te(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=VT(e),{host:o,port:a}=yN(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){Te(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),Te(vr(u,s.config.emulator)&&vr(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Rr(o)?(Dp(`${i}//${o}${l}`),iT("Auth",!0)):vN()}function VT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yN(n){const e=VT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:ny(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:ny(o)}}}function ny(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function vN(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class MT{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ws("not implemented")}_getIdTokenResponse(e){return ws("not implemented")}_linkToIdToken(e,t){return ws("not implemented")}_getReauthenticationResolver(e){return ws("not implemented")}}async function io(n,e){return W1(n,"POST","/v1/accounts:signInWithIdp",Up(n,e))}const EN="http://localhost";class ui extends MT{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ui(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ps("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new ui(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return io(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,io(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,io(e,t)}buildRequest(){const e={requestUri:EN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=$o(t)}return e}}class jp{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class $l extends jp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ar extends $l{constructor(){super("facebook.com")}static credential(e){return ui._fromParams({providerId:ar.PROVIDER_ID,signInMethod:ar.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ar.credentialFromTaggedObject(e)}static credentialFromError(e){return ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ar.credential(e.oauthAccessToken)}catch{return null}}}ar.FACEBOOK_SIGN_IN_METHOD="facebook.com";ar.PROVIDER_ID="facebook.com";class Ts extends $l{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ui._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Ts.credential(t,s)}catch{return null}}}Ts.GOOGLE_SIGN_IN_METHOD="google.com";Ts.PROVIDER_ID="google.com";class lr extends $l{constructor(){super("github.com")}static credential(e){return ui._fromParams({providerId:lr.PROVIDER_ID,signInMethod:lr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lr.credentialFromTaggedObject(e)}static credentialFromError(e){return lr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lr.credential(e.oauthAccessToken)}catch{return null}}}lr.GITHUB_SIGN_IN_METHOD="github.com";lr.PROVIDER_ID="github.com";class cr extends $l{constructor(){super("twitter.com")}static credential(e,t){return ui._fromParams({providerId:cr.PROVIDER_ID,signInMethod:cr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cr.credentialFromTaggedObject(e)}static credentialFromError(e){return cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return cr.credential(t,s)}catch{return null}}}cr.TWITTER_SIGN_IN_METHOD="twitter.com";cr.PROVIDER_ID="twitter.com";class vo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Un._fromIdTokenResponse(e,s,r),o=sy(s);return new vo({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=sy(s);return new vo({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function sy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class gu extends $s{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,gu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new gu(e,t,s,r)}}function LT(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?gu._fromErrorAndOperation(n,i,e,s):i})}async function IN(n,e,t=!1){const s=await dl(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return vo._forOperation(n,"link",s)}async function TN(n,e,t=!1){const{auth:s}=n;if(Rn(s.app))return Promise.reject(si(s));const r="reauthenticate";try{const i=await dl(n,LT(s,r,e,n),t);Te(i.idToken,s,"internal-error");const o=Bp(i.idToken);Te(o,s,"internal-error");const{sub:a}=o;return Te(n.uid===a,s,"user-mismatch"),vo._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&ps(s,"user-mismatch"),i}}async function wN(n,e,t=!1){if(Rn(n.app))return Promise.reject(si(n));const s="signIn",r=await LT(n,s,e),i=await vo._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}function bN(n,e,t,s){return $t(n).onIdTokenChanged(e,t,s)}function AN(n,e,t){return $t(n).beforeAuthStateChanged(e,t)}function SN(n,e,t,s){return $t(n).onAuthStateChanged(e,t,s)}function RN(n){return $t(n).signOut()}const _u="__sak";class FT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_u,"1"),this.storage.removeItem(_u),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const CN=1e3,PN=10;class UT extends FT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=DT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);iN()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,PN):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},CN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}UT.type="LOCAL";const NN=UT;class BT extends FT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}BT.type="SESSION";const $T=BT;function kN(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Eh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Eh(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await kN(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Eh.receivers=[];function Kp(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class xN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Kp("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const p=d;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function cs(){return window}function DN(n){cs().location.href=n}function qT(){return typeof cs().WorkerGlobalScope<"u"&&typeof cs().importScripts=="function"}async function ON(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function VN(){return navigator?.serviceWorker?.controller||null}function MN(){return qT()?self:null}const jT="firebaseLocalStorageDb",LN=1,yu="firebaseLocalStorage",KT="fbase_key";class ql{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ih(n,e){return n.transaction([yu],e?"readwrite":"readonly").objectStore(yu)}function FN(){const n=indexedDB.deleteDatabase(jT);return new ql(n).toPromise()}function gf(){const n=indexedDB.open(jT,LN);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(yu,{keyPath:KT})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(yu)?e(s):(s.close(),await FN(),e(await gf()))})})}async function ry(n,e,t){const s=Ih(n,!0).put({[KT]:e,value:t});return new ql(s).toPromise()}async function UN(n,e){const t=Ih(n,!1).get(e),s=await new ql(t).toPromise();return s===void 0?null:s.value}function iy(n,e){const t=Ih(n,!0).delete(e);return new ql(t).toPromise()}const BN=800,$N=3;class GT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>$N)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Eh._getInstance(MN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await ON(),!this.activeServiceWorker)return;this.sender=new xN(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||VN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await gf();return await ry(e,_u,"1"),await iy(e,_u),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>ry(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>UN(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Ih(r,!1).getAll();return new ql(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),BN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}GT.type="LOCAL";const qN=GT;new Bl(3e4,6e4);function HT(n,e){return e?bs(e):(Te(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Gp extends MT{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return io(e,this._buildIdpRequest())}_linkToIdToken(e,t){return io(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return io(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function jN(n){return wN(n.auth,new Gp(n),n.bypassAuthState)}function KN(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),TN(t,new Gp(n),n.bypassAuthState)}async function GN(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),IN(t,new Gp(n),n.bypassAuthState)}class zT{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jN;case"linkViaPopup":case"linkViaRedirect":return GN;case"reauthViaPopup":case"reauthViaRedirect":return KN;default:ps(this.auth,"internal-error")}}resolve(e){Ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const HN=new Bl(2e3,1e4);async function zN(n,e,t){if(Rn(n.app))return Promise.reject(Gn(n,"operation-not-supported-in-this-environment"));const s=vh(n);$1(n,e,jp);const r=HT(s,t);return new Yr(s,"signInViaPopup",e,r).executeNotNull()}class Yr extends zT{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Yr.currentPopupAction&&Yr.currentPopupAction.cancel(),Yr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Te(e,this.auth,"internal-error"),e}async onExecution(){Ms(this.filter.length===1,"Popup operations only handle one event");const e=Kp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Gn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Gn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yr.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,HN.get())};e()}}Yr.currentPopupAction=null;const WN="pendingRedirect",Lc=new Map;class QN extends zT{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Lc.get(this.auth._key());if(!e){try{const s=await YN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Lc.set(this.auth._key(),e)}return this.bypassAuthState||Lc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function YN(n,e){const t=ZN(e),s=JN(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function XN(n,e){Lc.set(n._key(),e)}function JN(n){return bs(n._redirectPersistence)}function ZN(n){return Mc(WN,n.config.apiKey,n.name)}async function ek(n,e,t=!1){if(Rn(n.app))return Promise.reject(si(n));const s=vh(n),r=HT(s,e),o=await new QN(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const tk=600*1e3;class nk{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sk(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!WT(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Gn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=tk&&this.cachedEventUids.clear(),this.cachedEventUids.has(oy(e))}saveEventToCache(e){this.cachedEventUids.add(oy(e)),this.lastProcessedEventTime=Date.now()}}function oy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function WT({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function sk(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return WT(n);default:return!1}}async function rk(n,e={}){return qo(n,"GET","/v1/projects",e)}const ik=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ok=/^https?/;async function ak(n){if(n.config.emulator)return;const{authorizedDomains:e}=await rk(n);for(const t of e)try{if(lk(t))return}catch{}ps(n,"unauthorized-domain")}function lk(n){const e=pf(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!ok.test(t))return!1;if(ik.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const ck=new Bl(3e4,6e4);function ay(){const n=cs().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function uk(n){return new Promise((e,t)=>{function s(){ay(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ay(),t(Gn(n,"network-request-failed"))},timeout:ck.get()})}if(cs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(cs().gapi?.load)s();else{const r=pN("iframefcb");return cs()[r]=()=>{gapi.load?s():t(Gn(n,"network-request-failed"))},dN(`${fN()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw Fc=null,e})}let Fc=null;function hk(n){return Fc=Fc||uk(n),Fc}const dk=new Bl(5e3,15e3),fk="__/auth/iframe",pk="emulator/auth/iframe",mk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _k(n){const e=n.config;Te(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Fp(e,pk):`https://${n.config.authDomain}/${fk}`,s={apiKey:e.apiKey,appName:n.name,v:bi},r=gk.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${$o(s).slice(1)}`}async function yk(n){const e=await hk(n),t=cs().gapi;return Te(t,n,"internal-error"),e.open({where:document.body,url:_k(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mk,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=Gn(n,"network-request-failed"),a=cs().setTimeout(()=>{i(o)},dk.get());function l(){cs().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}const vk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ek=500,Ik=600,Tk="_blank",wk="http://localhost";class ly{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function bk(n,e,t,s=Ek,r=Ik){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...vk,width:s.toString(),height:r.toString(),top:i,left:o},u=Ct().toLowerCase();t&&(a=CT(u)?Tk:t),ST(u)&&(e=e||wk,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[g,b])=>`${p}${g}=${b},`,"");if(rN(u)&&a!=="_self")return Ak(e||"",a),new ly(null);const d=window.open(e||"",a,h);Te(d,n,"popup-blocked");try{d.focus()}catch{}return new ly(d)}function Ak(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const Sk="__/auth/handler",Rk="emulator/auth/handler",Ck=encodeURIComponent("fac");async function cy(n,e,t,s,r,i){Te(n.config.authDomain,n,"auth-domain-config-required"),Te(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:bi,eventId:r};if(e instanceof jp){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",lf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof $l){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${Ck}=${encodeURIComponent(l)}`:"";return`${Pk(n)}?${$o(a).slice(1)}${u}`}function Pk({config:n}){return n.emulator?Fp(n,Rk):`https://${n.authDomain}/${Sk}`}const Pd="webStorageSupport";class Nk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$T,this._completeRedirectFn=ek,this._overrideRedirectResult=XN}async _openPopup(e,t,s,r){Ms(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await cy(e,t,s,pf(),r);return bk(e,i,Kp())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await cy(e,t,s,pf(),r);return DN(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Ms(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await yk(e),s=new nk(e);return t.register("authEvent",r=>(Te(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Pd,{type:Pd},r=>{const i=r?.[0]?.[Pd];i!==void 0&&t(!!i),ps(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ak(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return DT()||RT()||$p()}}const kk=Nk;var uy="@firebase/auth",hy="1.12.0";class xk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Te(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Dk(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ok(n){ci(new Er("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Te(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:OT(n)},u=new uN(s,r,i,l);return gN(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),ci(new Er("auth-internal",e=>{const t=vh(e.getProvider("auth").getImmediate());return(s=>new xk(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ls(uy,hy,Dk(n)),ls(uy,hy,"esm2020")}const Vk=300,Mk=rT("authIdTokenMaxAge")||Vk;let dy=null;const Lk=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Mk)return;const r=t?.token;dy!==r&&(dy=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Fk(n=gT()){const e=yh(n,"auth");if(e.isInitialized())return e.getImmediate();const t=mN(n,{popupRedirectResolver:kk,persistence:[qN,NN,$T]}),s=rT("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=Lk(i.toString());AN(t,o,()=>o(t.currentUser)),bN(t,a=>o(a))}}const r=nT("auth");return r&&_N(t,`http://${r}`),t}function Uk(){return document.getElementsByTagName("head")?.[0]??document}hN({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=Gn("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",Uk().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ok("Browser");var Bk="firebase",$k="12.7.0";ls(Bk,$k,"app");var fy={};const py="@firebase/database",my="1.1.0";let QT="";function qk(n){QT=n}class jk{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ot(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ul(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Kk{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return qs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const YT=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new jk(e)}}catch{}return new Kk},Xr=YT("localStorage"),Gk=YT("sessionStorage");const oo=new _h("@firebase/database"),Hk=(function(){let n=1;return function(){return n++}})(),XT=function(n){const e=NP(n),t=new SP;t.update(e);const s=t.digest();return kp.encodeByteArray(s)},jl=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=jl.apply(null,s):typeof s=="object"?e+=Ot(s):e+=s,e+=" "}return e};let ja=null,gy=!0;const zk=function(n,e){J(!0,"Can't turn on custom loggers persistently."),oo.logLevel=xe.VERBOSE,ja=oo.log.bind(oo)},Wt=function(...n){if(gy===!0&&(gy=!1,ja===null&&Gk.get("logging_enabled")===!0&&zk()),ja){const e=jl.apply(null,n);ja(e)}},Kl=function(n){return function(...e){Wt(n,...e)}},_f=function(...n){const e="FIREBASE INTERNAL ERROR: "+jl(...n);oo.error(e)},Ls=function(...n){const e=`FIREBASE FATAL ERROR: ${jl(...n)}`;throw oo.error(e),new Error(e)},bn=function(...n){const e="FIREBASE WARNING: "+jl(...n);oo.warn(e)},Wk=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&bn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},JT=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Qk=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Eo="[MIN_NAME]",hi="[MAX_NAME]",jo=function(n,e){if(n===e)return 0;if(n===Eo||e===hi)return-1;if(e===Eo||n===hi)return 1;{const t=_y(n),s=_y(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Yk=function(n,e){return n===e?0:n<e?-1:1},pa=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ot(e))},Hp=function(n){if(typeof n!="object"||n===null)return Ot(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Ot(e[s]),t+=":",t+=Hp(n[e[s]]);return t+="}",t},ZT=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function pn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const ew=function(n){J(!JT(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,a,l;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const h=u.join("");let d="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),d=d+p}return d.toLowerCase()},Xk=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Jk=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Zk(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const ex=new RegExp("^-?(0*)\\d{1,10}$"),tx=-2147483648,nx=2147483647,_y=function(n){if(ex.test(n)){const e=Number(n);if(e>=tx&&e<=nx)return e}return null},Gl=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw bn("Exception was thrown by user callback.",t),e},Math.floor(0))}},sx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ka=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class rx{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Rn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){bn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ix{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Wt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',bn(e)}}class Uc{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Uc.OWNER="owner";const zp="5",tw="v",nw="s",sw="r",rw="f",iw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ow="ls",aw="p",yf="ac",lw="websocket",cw="long_polling";class uw{constructor(e,t,s,r,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Xr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Xr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function ox(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function hw(n,e,t){J(typeof e=="string","typeof type must == string"),J(typeof t=="object","typeof params must == object");let s;if(e===lw)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===cw)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);ox(n)&&(t.ns=n.namespace);const r=[];return pn(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}class ax{constructor(){this.counters_={}}incrementCounter(e,t=1){qs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return aP(this.counters_)}}const Nd={},kd={};function Wp(n){const e=n.toString();return Nd[e]||(Nd[e]=new ax),Nd[e]}function lx(n,e){const t=n.toString();return kd[t]||(kd[t]=e()),kd[t]}class cx{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Gl(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const yy="start",ux="close",hx="pLPCommand",dx="pRTLPCB",dw="id",fw="pw",pw="ser",fx="cb",px="seg",mx="ts",gx="d",_x="dframe",mw=1870,gw=30,yx=mw-gw,vx=25e3,Ex=3e4;class Yi{constructor(e,t,s,r,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kl(e),this.stats_=Wp(t),this.urlFn=l=>(this.appCheckToken&&(l[yf]=this.appCheckToken),hw(t,cw,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new cx(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Ex)),Qk(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Qp((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===yy)this.id=a,this.password=l;else if(o===ux)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[yy]="t",s[pw]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[fx]=this.scriptTagHolder.uniqueCallbackIdentifier),s[tw]=zp,this.transportSessionId&&(s[nw]=this.transportSessionId),this.lastSessionId&&(s[ow]=this.lastSessionId),this.applicationId&&(s[aw]=this.applicationId),this.appCheckToken&&(s[yf]=this.appCheckToken),typeof location<"u"&&location.hostname&&iw.test(location.hostname)&&(s[sw]=rw);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Yi.forceAllow_=!0}static forceDisallow(){Yi.forceDisallow_=!0}static isAvailable(){return Yi.forceAllow_?!0:!Yi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Xk()&&!Jk()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ot(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=ZI(t),r=ZT(s,yx);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[_x]="t",s[dw]=e,s[fw]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ot(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Qp{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Hk(),window[hx+this.uniqueCallbackIdentifier]=e,window[dx+this.uniqueCallbackIdentifier]=t,this.myIFrame=Qp.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Wt("frame writing exception"),a.stack&&Wt(a.stack),Wt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Wt("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[dw]=this.myID,e[fw]=this.myPW,e[pw]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+gw+s.length<=mw;){const o=this.pendingSegs.shift();s=s+"&"+px+r+"="+o.seg+"&"+mx+r+"="+o.ts+"&"+gx+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(vx)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{Wt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const Ix=16384,Tx=45e3;let vu=null;typeof MozWebSocket<"u"?vu=MozWebSocket:typeof WebSocket<"u"&&(vu=WebSocket);class Ln{constructor(e,t,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kl(this.connId),this.stats_=Wp(t),this.connURL=Ln.connectionURL_(t,o,a,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[tw]=zp,typeof location<"u"&&location.hostname&&iw.test(location.hostname)&&(o[sw]=rw),t&&(o[nw]=t),s&&(o[ow]=s),r&&(o[yf]=r),i&&(o[aw]=i),hw(e,lw,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Xr.set("previous_websocket_failure",!0);try{let s;vP(),this.mySock=new vu(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Ln.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&vu!==null&&!Ln.forceDisallow_}static previouslyFailed(){return Xr.isInMemoryStorage||Xr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Xr.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=ul(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(J(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Ot(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=ZT(t,Ix);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Tx))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ln.responsesRequiredToBeHealthy=2;Ln.healthyTimeout=3e4;class fl{static get ALL_TRANSPORTS(){return[Yi,Ln]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Ln&&Ln.isAvailable();let s=t&&!Ln.previouslyFailed();if(e.webSocketOnly&&(t||bn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ln];else{const r=this.transports_=[];for(const i of fl.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);fl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}fl.globalTransportInitialized_=!1;const wx=6e4,bx=5e3,Ax=10*1024,Sx=100*1024,xd="t",vy="d",Rx="s",Ey="r",Cx="e",Iy="o",Ty="a",wy="n",by="p",Px="h";class Nx{constructor(e,t,s,r,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kl("c:"+this.id+":"),this.transportManager_=new fl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Ka(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Sx?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ax?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(xd in e){const t=e[xd];t===Ty?this.upgradeIfSecondaryHealthy_():t===Ey?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Iy&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=pa("t",e),s=pa("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:by,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ty,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:wy,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=pa("t",e),s=pa("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=pa(xd,e);if(vy in e){const s=e[vy];if(t===Px){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===wy){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Rx?this.onConnectionShutdown_(s):t===Ey?this.onReset_(s):t===Cx?_f("Server Error: "+s):t===Iy?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_f("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),zp!==s&&bn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Ka(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(wx))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ka(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(bx))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:by,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Xr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class _w{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class yw{constructor(e){this.allowedEvents_=e,this.listeners_={},J(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){J(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Eu extends yw{static getInstance(){return new Eu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Op()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return J(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Ay=32,Sy=768;class rt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function qe(){return new rt("")}function De(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ir(n){return n.pieces_.length-n.pieceNum_}function ot(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new rt(n.pieces_,e)}function vw(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function kx(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ew(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Iw(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new rt(e,0)}function St(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof rt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new rt(t,0)}function Oe(n){return n.pieceNum_>=n.pieces_.length}function dn(n,e){const t=De(n),s=De(e);if(t===null)return e;if(t===s)return dn(ot(n),ot(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Yp(n,e){if(Ir(n)!==Ir(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Bn(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Ir(n)>Ir(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class xx{constructor(e,t){this.errorPrefix_=t,this.parts_=Ew(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=gh(this.parts_[s]);Tw(this)}}function Dx(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=gh(e),Tw(n)}function Ox(n){const e=n.parts_.pop();n.byteLength_-=gh(e),n.parts_.length>0&&(n.byteLength_-=1)}function Tw(n){if(n.byteLength_>Sy)throw new Error(n.errorPrefix_+"has a key path longer than "+Sy+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ay)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ay+") or object contains a cycle "+jr(n))}function jr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class Xp extends yw{static getInstance(){return new Xp}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return J(e==="visible","Unknown event type: "+e),[this.visible_]}}const ma=1e3,Vx=300*1e3,Ry=30*1e3,Mx=1.3,Lx=3e4,Fx="server_kill",Cy=3;class Cs extends _w{constructor(e,t,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Cs.nextPersistentConnectionId_++,this.log_=Kl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ma,this.maxReconnectDelay_=Vx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Xp.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Eu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Ot(i)),J(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new xp,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),J(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),J(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Cs.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&qs(e,"w")){const s=yo(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();bn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||AP(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ry)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=bP(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),J(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ot(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):_f("Unrecognized action received from server: "+Ot(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){J(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Lx&&(this.reconnectDelay_=ma),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Mx)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Cs.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(d){J(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Wt("getToken() completed but was canceled"):(Wt("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,a=new Nx(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,g=>{bn(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(Fx)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&bn(d),l())}}}interrupt(e){Wt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Wt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],lf(this.interruptReasons_)&&(this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>Hp(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new rt(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){Wt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Cy&&(this.reconnectDelay_=Ry,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Wt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Cy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+QT.replace(/\./g,"-")]=1,Op()?e["framework.cordova"]=1:aT()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Eu.getInstance().currentlyOnline();return lf(this.interruptReasons_)&&e}}Cs.nextPersistentConnectionId_=0;Cs.nextConnectionId_=0;class Pe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Pe(e,t)}}class Th{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Pe(Eo,e),r=new Pe(Eo,t);return this.compare(s,r)!==0}minPost(){return Pe.MIN}}let Ec;class ww extends Th{static get __EMPTY_NODE(){return Ec}static set __EMPTY_NODE(e){Ec=e}compare(e,t){return jo(e.name,t.name)}isDefinedOn(e){throw Bo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Pe.MIN}maxPost(){return new Pe(hi,Ec)}makePost(e,t){return J(typeof e=="string","KeyIndex indexValue must always be a string."),new Pe(e,Ec)}toString(){return".key"}}const ao=new ww;let Ic=class{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},En=class Ca{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ca.RED,this.left=r??ss.EMPTY_NODE,this.right=i??ss.EMPTY_NODE}copy(e,t,s,r,i){return new Ca(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ss.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return ss.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ca.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ca.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};En.RED=!0;En.BLACK=!1;class Ux{copy(e,t,s,r,i){return this}insert(e,t,s){return new En(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let ss=class Bc{constructor(e,t=Bc.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Bc(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,En.BLACK,null,null))}remove(e){return new Bc(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,En.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ic(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ic(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ic(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ic(this.root_,null,this.comparator_,!0,e)}};ss.EMPTY_NODE=new Ux;function Bx(n,e){return jo(n.name,e.name)}function Jp(n,e){return jo(n,e)}let vf;function $x(n){vf=n}const bw=function(n){return typeof n=="number"?"number:"+ew(n):"string:"+n},Aw=function(n){if(n.isLeafNode()){const e=n.val();J(typeof e=="string"||typeof e=="number"||typeof e=="object"&&qs(e,".sv"),"Priority must be a string or number.")}else J(n===vf||n.isEmpty(),"priority of unexpected type.");J(n===vf||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Py;class xt{static set __childrenNodeConstructor(e){Py=e}static get __childrenNodeConstructor(){return Py}constructor(e,t=xt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,J(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Aw(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:xt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Oe(e)?this:De(e)===".priority"?this.priorityNode_:xt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:xt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=De(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(J(s!==".priority"||Ir(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,xt.__childrenNodeConstructor.EMPTY_NODE.updateChild(ot(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+bw(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=ew(this.value_):e+=this.value_,this.lazyHash_=XT(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===xt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof xt.__childrenNodeConstructor?-1:(J(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=xt.VALUE_TYPE_ORDER.indexOf(t),i=xt.VALUE_TYPE_ORDER.indexOf(s);return J(r>=0,"Unknown leaf type: "+t),J(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}xt.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Sw,Rw;function qx(n){Sw=n}function jx(n){Rw=n}class Kx extends Th{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?jo(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Pe.MIN}maxPost(){return new Pe(hi,new xt("[PRIORITY-POST]",Rw))}makePost(e,t){const s=Sw(e);return new Pe(t,new xt("[PRIORITY-POST]",s))}toString(){return".priority"}}const gt=new Kx;const Gx=Math.log(2);class Hx{constructor(e){const t=i=>parseInt(Math.log(i)/Gx,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Iu=function(n,e,t,s){n.sort(e);const r=function(l,u){const h=u-l;let d,p;if(h===0)return null;if(h===1)return d=n[l],p=t?t(d):d,new En(p,d.node,En.BLACK,null,null);{const g=parseInt(h/2,10)+l,b=r(l,g),C=r(g+1,u);return d=n[g],p=t?t(d):d,new En(p,d.node,En.BLACK,b,C)}},i=function(l){let u=null,h=null,d=n.length;const p=function(b,C){const V=d-b,L=d;d-=b;const F=r(V+1,L),D=n[V],P=t?t(D):D;g(new En(P,D.node,C,null,F))},g=function(b){u?(u.left=b,u=b):(h=b,u=b)};for(let b=0;b<l.count;++b){const C=l.nextBitIsOne(),V=Math.pow(2,l.count-(b+1));C?p(V,En.BLACK):(p(V,En.BLACK),p(V,En.RED))}return h},o=new Hx(n.length),a=i(o);return new ss(s||e,a)};let Dd;const Mi={};class As{static get Default(){return J(Mi&&gt,"ChildrenNode.ts has not been loaded"),Dd=Dd||new As({".priority":Mi},{".priority":gt}),Dd}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=yo(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ss?t:null}hasIndex(e){return qs(this.indexSet_,e.toString())}addIndex(e,t){J(e!==ao,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(Pe.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=Iu(s,e.getCompare()):a=Mi;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new As(h,u)}addToIndexes(e,t){const s=hu(this.indexes_,(r,i)=>{const o=yo(this.indexSet_,i);if(J(o,"Missing index implementation for "+i),r===Mi)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Pe.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Iu(a,o.getCompare())}else return Mi;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new Pe(e.name,a))),l.insert(e,e.node)}});return new As(s,this.indexSet_)}removeFromIndexes(e,t){const s=hu(this.indexes_,r=>{if(r===Mi)return r;{const i=t.get(e.name);return i?r.remove(new Pe(e.name,i)):r}});return new As(s,this.indexSet_)}}let ga;class Ee{static get EMPTY_NODE(){return ga||(ga=new Ee(new ss(Jp),null,As.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Aw(this.priorityNode_),this.children_.isEmpty()&&J(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ga}updatePriority(e){return this.children_.isEmpty()?this:new Ee(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ga:t}}getChild(e){const t=De(e);return t===null?this:this.getImmediateChild(t).getChild(ot(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(J(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Pe(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?ga:this.priorityNode_;return new Ee(r,o,i)}}updateChild(e,t){const s=De(e);if(s===null)return t;{J(De(e)!==".priority"||Ir(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(ot(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(gt,(o,a)=>{t[o]=a.val(e),s++,i&&Ee.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+bw(this.getPriority().val())+":"),this.forEachChild(gt,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":XT(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new Pe(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Pe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Pe(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Hl?-1:0}withIndex(e){if(e===ao||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ee(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ao||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(gt),r=t.getIterator(gt);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ao?null:this.indexMap_.get(e.toString())}}Ee.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class zx extends Ee{constructor(){super(new ss(Jp),Ee.EMPTY_NODE,As.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ee.EMPTY_NODE}isEmpty(){return!1}}const Hl=new zx;Object.defineProperties(Pe,{MIN:{value:new Pe(Eo,Ee.EMPTY_NODE)},MAX:{value:new Pe(hi,Hl)}});ww.__EMPTY_NODE=Ee.EMPTY_NODE;xt.__childrenNodeConstructor=Ee;$x(Hl);jx(Hl);const Wx=!0;function Qt(n,e=null){if(n===null)return Ee.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),J(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new xt(t,Qt(e))}if(!(n instanceof Array)&&Wx){const t=[];let s=!1;if(pn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Qt(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new Pe(o,l)))}}),t.length===0)return Ee.EMPTY_NODE;const i=Iu(t,Bx,o=>o.name,Jp);if(s){const o=Iu(t,gt.getCompare());return new Ee(i,Qt(e),new As({".priority":o},{".priority":gt}))}else return new Ee(i,Qt(e),As.Default)}else{let t=Ee.EMPTY_NODE;return pn(n,(s,r)=>{if(qs(n,s)&&s.substring(0,1)!=="."){const i=Qt(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(Qt(e))}}qx(Qt);class Qx extends Th{constructor(e){super(),this.indexPath_=e,J(!Oe(e)&&De(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?jo(e.name,t.name):i}makePost(e,t){const s=Qt(e),r=Ee.EMPTY_NODE.updateChild(this.indexPath_,s);return new Pe(t,r)}maxPost(){const e=Ee.EMPTY_NODE.updateChild(this.indexPath_,Hl);return new Pe(hi,e)}toString(){return Ew(this.indexPath_,0).join("/")}}class Yx extends Th{compare(e,t){const s=e.node.compareTo(t.node);return s===0?jo(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Pe.MIN}maxPost(){return Pe.MAX}makePost(e,t){const s=Qt(e);return new Pe(t,s)}toString(){return".value"}}const Xx=new Yx;function Cw(n){return{type:"value",snapshotNode:n}}function Io(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function pl(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function ml(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Jx(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Zp{constructor(e){this.index_=e}updateChild(e,t,s,r,i,o){J(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(pl(t,a)):J(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Io(t,s)):o.trackChildChange(ml(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(gt,(r,i)=>{t.hasChild(r)||s.trackChildChange(pl(r,i))}),t.isLeafNode()||t.forEachChild(gt,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(ml(r,i,o))}else s.trackChildChange(Io(r,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ee.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class gl{constructor(e){this.indexedFilter_=new Zp(e.getIndex()),this.index_=e.getIndex(),this.startPost_=gl.getStartPost_(e),this.endPost_=gl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,r,i,o){return this.matches(new Pe(t,s))||(s=Ee.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,r,i,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=Ee.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Ee.EMPTY_NODE);const i=this;return t.forEachChild(gt,(o,a)=>{i.matches(new Pe(o,a))||(r=r.updateImmediateChild(o,Ee.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class Zx{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new gl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,r,i,o){return this.rangedFilter_.matches(new Pe(t,s))||(s=Ee.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,r,i,o):this.fullLimitUpdateChild_(e,t,s,i,o)}updateFullNode(e,t,s){let r;if(t.isLeafNode()||t.isEmpty())r=Ee.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=Ee.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(Ee.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Ee.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,r,i){let o;if(this.reverse_){const d=this.index_.getCompare();o=(p,g)=>d(g,p)}else o=this.index_.getCompare();const a=e;J(a.numChildren()===this.limit_,"");const l=new Pe(t,s),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const d=a.getImmediateChild(t);let p=r.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);const g=p==null?1:o(p,l);if(h&&!s.isEmpty()&&g>=0)return i?.trackChildChange(ml(t,s,d)),a.updateImmediateChild(t,s);{i?.trackChildChange(pl(t,d));const C=a.updateImmediateChild(t,Ee.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i?.trackChildChange(Io(p.name,p.node)),C.updateImmediateChild(p.name,p.node)):C}}else return s.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(pl(u.name,u.node)),i.trackChildChange(Io(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(u.name,Ee.EMPTY_NODE)):e}}class em{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=gt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return J(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return J(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Eo}hasEnd(){return this.endSet_}getIndexEndValue(){return J(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return J(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:hi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return J(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===gt}copy(){const e=new em;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function eD(n){return n.loadsAllData()?new Zp(n.getIndex()):n.hasLimit()?new Zx(n):new gl(n)}function Ny(n){const e={};if(n.isDefault())return e;let t;if(n.index_===gt?t="$priority":n.index_===Xx?t="$value":n.index_===ao?t="$key":(J(n.index_ instanceof Qx,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ot(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Ot(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Ot(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Ot(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Ot(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function ky(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==gt&&(e.i=n.index_.toString()),e}class Tu extends _w{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(J(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=Kl("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Tu.getListenId_(e,s),a={};this.listens_[o]=a;const l=Ny(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let d=h;if(u===404&&(d=null,u=null),u===null&&this.onDataUpdate_(i,d,!1,s),yo(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",r(p,null)}})}unlisten(e,t){const s=Tu.getListenId_(e,t);delete this.listens_[s]}get(e){const t=Ny(e._queryParams),s=e._path.toString(),r=new xp;return this.restRequest_(s+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+$o(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=ul(a.responseText)}catch{bn("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&bn("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class tD{constructor(){this.rootNode_=Ee.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function wu(){return{value:null,children:new Map}}function Pw(n,e,t){if(Oe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=De(e);n.children.has(s)||n.children.set(s,wu());const r=n.children.get(s);e=ot(e),Pw(r,e,t)}}function Ef(n,e,t){n.value!==null?t(e,n.value):nD(n,(s,r)=>{const i=new rt(e.toString()+"/"+s);Ef(r,i,t)})}function nD(n,e){n.children.forEach((t,s)=>{e(s,t)})}class sD{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&pn(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}const xy=10*1e3,rD=30*1e3,iD=300*1e3;class oD{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sD(e);const s=xy+(rD-xy)*Math.random();Ka(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;pn(e,(r,i)=>{i>0&&qs(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),Ka(this.reportStats_.bind(this),Math.floor(Math.random()*2*iD))}}var $n;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})($n||($n={}));function Nw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tm(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nm(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class bu{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=$n.ACK_USER_WRITE,this.source=Nw()}operationForChild(e){if(Oe(this.path)){if(this.affectedTree.value!=null)return J(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new rt(e));return new bu(qe(),t,this.revert)}}else return J(De(this.path)===e,"operationForChild called for unrelated child."),new bu(ot(this.path),this.affectedTree,this.revert)}}class _l{constructor(e,t){this.source=e,this.path=t,this.type=$n.LISTEN_COMPLETE}operationForChild(e){return Oe(this.path)?new _l(this.source,qe()):new _l(this.source,ot(this.path))}}class di{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=$n.OVERWRITE}operationForChild(e){return Oe(this.path)?new di(this.source,qe(),this.snap.getImmediateChild(e)):new di(this.source,ot(this.path),this.snap)}}class yl{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=$n.MERGE}operationForChild(e){if(Oe(this.path)){const t=this.children.subtree(new rt(e));return t.isEmpty()?null:t.value?new di(this.source,qe(),t.value):new yl(this.source,qe(),t)}else return J(De(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new yl(this.source,ot(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fi{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Oe(e))return this.isFullyInitialized()&&!this.filtered_;const t=De(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class aD{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function lD(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Jx(o.childName,o.snapshotNode))}),_a(n,r,"child_removed",e,s,t),_a(n,r,"child_added",e,s,t),_a(n,r,"child_moved",i,s,t),_a(n,r,"child_changed",e,s,t),_a(n,r,"value",e,s,t),r}function _a(n,e,t,s,r,i){const o=s.filter(a=>a.type===t);o.sort((a,l)=>uD(n,a,l)),o.forEach(a=>{const l=cD(n,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function cD(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function uD(n,e,t){if(e.childName==null||t.childName==null)throw Bo("Should only compare child_ events.");const s=new Pe(e.childName,e.snapshotNode),r=new Pe(t.childName,t.snapshotNode);return n.index_.compare(s,r)}function wh(n,e){return{eventCache:n,serverCache:e}}function Ga(n,e,t,s){return wh(new fi(e,t,s),n.serverCache)}function kw(n,e,t,s){return wh(n.eventCache,new fi(e,t,s))}function If(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function pi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Od;const hD=()=>(Od||(Od=new ss(Yk)),Od);class ct{static fromObject(e){let t=new ct(null);return pn(e,(s,r)=>{t=t.set(new rt(s),r)}),t}constructor(e,t=hD()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:qe(),value:this.value};if(Oe(e))return null;{const s=De(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(ot(e),t);return i!=null?{path:St(new rt(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Oe(e))return this;{const t=De(e),s=this.children.get(t);return s!==null?s.subtree(ot(e)):new ct(null)}}set(e,t){if(Oe(e))return new ct(t,this.children);{const s=De(e),i=(this.children.get(s)||new ct(null)).set(ot(e),t),o=this.children.insert(s,i);return new ct(this.value,o)}}remove(e){if(Oe(e))return this.children.isEmpty()?new ct(null):new ct(null,this.children);{const t=De(e),s=this.children.get(t);if(s){const r=s.remove(ot(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new ct(null):new ct(this.value,i)}else return this}}get(e){if(Oe(e))return this.value;{const t=De(e),s=this.children.get(t);return s?s.get(ot(e)):null}}setTree(e,t){if(Oe(e))return t;{const s=De(e),i=(this.children.get(s)||new ct(null)).setTree(ot(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new ct(this.value,o)}}fold(e){return this.fold_(qe(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(St(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,qe(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(Oe(e))return null;{const i=De(e),o=this.children.get(i);return o?o.findOnPath_(ot(e),St(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,qe(),t)}foreachOnPath_(e,t,s){if(Oe(e))return this;{this.value&&s(t,this.value);const r=De(e),i=this.children.get(r);return i?i.foreachOnPath_(ot(e),St(t,r),s):new ct(null)}}foreach(e){this.foreach_(qe(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(St(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class Hn{constructor(e){this.writeTree_=e}static empty(){return new Hn(new ct(null))}}function Ha(n,e,t){if(Oe(e))return new Hn(new ct(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=dn(r,e);return i=i.updateChild(o,t),new Hn(n.writeTree_.set(r,i))}else{const r=new ct(t),i=n.writeTree_.setTree(e,r);return new Hn(i)}}}function Dy(n,e,t){let s=n;return pn(t,(r,i)=>{s=Ha(s,St(e,r),i)}),s}function Oy(n,e){if(Oe(e))return Hn.empty();{const t=n.writeTree_.setTree(e,new ct(null));return new Hn(t)}}function Tf(n,e){return Ai(n,e)!=null}function Ai(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(dn(t.path,e)):null}function Vy(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(gt,(s,r)=>{e.push(new Pe(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new Pe(s,r.value))}),e}function mr(n,e){if(Oe(e))return n;{const t=Ai(n,e);return t!=null?new Hn(new ct(t)):new Hn(n.writeTree_.subtree(e))}}function wf(n){return n.writeTree_.isEmpty()}function To(n,e){return xw(qe(),n.writeTree_,e)}function xw(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(J(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=xw(St(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(St(n,".priority"),s)),t}}function sm(n,e){return Mw(e,n)}function dD(n,e,t,s,r){J(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=Ha(n.visibleWrites,e,t)),n.lastWriteId=s}function fD(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function pD(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);J(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&mD(a,s.path)?r=!1:Bn(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return gD(n),!0;if(s.snap)n.visibleWrites=Oy(n.visibleWrites,s.path);else{const a=s.children;pn(a,l=>{n.visibleWrites=Oy(n.visibleWrites,St(s.path,l))})}return!0}else return!1}function mD(n,e){if(n.snap)return Bn(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Bn(St(n.path,t),e))return!0;return!1}function gD(n){n.visibleWrites=Dw(n.allWrites,_D,qe()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function _D(n){return n.visible}function Dw(n,e,t){let s=Hn.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let a;if(i.snap)Bn(t,o)?(a=dn(t,o),s=Ha(s,a,i.snap)):Bn(o,t)&&(a=dn(o,t),s=Ha(s,qe(),i.snap.getChild(a)));else if(i.children){if(Bn(t,o))a=dn(t,o),s=Dy(s,a,i.children);else if(Bn(o,t))if(a=dn(o,t),Oe(a))s=Dy(s,qe(),i.children);else{const l=yo(i.children,De(a));if(l){const u=l.getChild(ot(a));s=Ha(s,qe(),u)}}}else throw Bo("WriteRecord should have .snap or .children")}}return s}function Ow(n,e,t,s,r){if(!s&&!r){const i=Ai(n.visibleWrites,e);if(i!=null)return i;{const o=mr(n.visibleWrites,e);if(wf(o))return t;if(t==null&&!Tf(o,qe()))return null;{const a=t||Ee.EMPTY_NODE;return To(o,a)}}}else{const i=mr(n.visibleWrites,e);if(!r&&wf(i))return t;if(!r&&t==null&&!Tf(i,qe()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(Bn(u.path,e)||Bn(e,u.path))},a=Dw(n.allWrites,o,e),l=t||Ee.EMPTY_NODE;return To(a,l)}}}function yD(n,e,t){let s=Ee.EMPTY_NODE;const r=Ai(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(gt,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=mr(n.visibleWrites,e);return t.forEachChild(gt,(o,a)=>{const l=To(mr(i,new rt(o)),a);s=s.updateImmediateChild(o,l)}),Vy(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=mr(n.visibleWrites,e);return Vy(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function vD(n,e,t,s,r){J(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=St(e,t);if(Tf(n.visibleWrites,i))return null;{const o=mr(n.visibleWrites,i);return wf(o)?r.getChild(t):To(o,r.getChild(t))}}function ED(n,e,t,s){const r=St(e,t),i=Ai(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=mr(n.visibleWrites,r);return To(o,s.getNode().getImmediateChild(t))}else return null}function ID(n,e){return Ai(n.visibleWrites,e)}function TD(n,e,t,s,r,i,o){let a;const l=mr(n.visibleWrites,e),u=Ai(l,qe());if(u!=null)a=u;else if(t!=null)a=To(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),p=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let g=p.getNext();for(;g&&h.length<r;)d(g,s)!==0&&h.push(g),g=p.getNext();return h}else return[]}function wD(){return{visibleWrites:Hn.empty(),allWrites:[],lastWriteId:-1}}function Au(n,e,t,s){return Ow(n.writeTree,n.treePath,e,t,s)}function rm(n,e){return yD(n.writeTree,n.treePath,e)}function My(n,e,t,s){return vD(n.writeTree,n.treePath,e,t,s)}function Su(n,e){return ID(n.writeTree,St(n.treePath,e))}function bD(n,e,t,s,r,i){return TD(n.writeTree,n.treePath,e,t,s,r,i)}function im(n,e,t){return ED(n.writeTree,n.treePath,e,t)}function Vw(n,e){return Mw(St(n.treePath,e),n.writeTree)}function Mw(n,e){return{treePath:n,writeTree:e}}class AD{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;J(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),J(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,ml(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,pl(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,Io(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,ml(s,e.snapshotNode,r.oldSnap));else throw Bo("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class SD{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const Lw=new SD;class om{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new fi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return im(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:pi(this.viewCache_),i=bD(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}function RD(n){return{filter:n}}function CD(n,e){J(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),J(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function PD(n,e,t,s,r){const i=new AD;let o,a;if(t.type===$n.OVERWRITE){const u=t;u.source.fromUser?o=bf(n,e,u.path,u.snap,s,r,i):(J(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Oe(u.path),o=Ru(n,e,u.path,u.snap,s,r,a,i))}else if(t.type===$n.MERGE){const u=t;u.source.fromUser?o=kD(n,e,u.path,u.children,s,r,i):(J(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Af(n,e,u.path,u.children,s,r,a,i))}else if(t.type===$n.ACK_USER_WRITE){const u=t;u.revert?o=OD(n,e,u.path,s,r,i):o=xD(n,e,u.path,u.affectedTree,s,r,i)}else if(t.type===$n.LISTEN_COMPLETE)o=DD(n,e,t.path,s,i);else throw Bo("Unknown operation type: "+t.type);const l=i.getChanges();return ND(e,o,l),{viewCache:o,changes:l}}function ND(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=If(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(Cw(If(e)))}}function Fw(n,e,t,s,r,i){const o=e.eventCache;if(Su(s,t)!=null)return e;{let a,l;if(Oe(t))if(J(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=pi(e),h=u instanceof Ee?u:Ee.EMPTY_NODE,d=rm(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const u=Au(s,pi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=De(t);if(u===".priority"){J(Ir(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=My(s,t,h,l);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{const h=ot(t);let d;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=My(s,t,o.getNode(),l);p!=null?d=o.getNode().getImmediateChild(u).updateChild(h,p):d=o.getNode().getImmediateChild(u)}else d=im(s,u,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),u,d,h,r,i):a=o.getNode()}}return Ga(e,a,o.isFullyInitialized()||Oe(t),n.filter.filtersNodes())}}function Ru(n,e,t,s,r,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Oe(t))u=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const g=l.getNode().updateChild(t,s);u=h.updateFullNode(l.getNode(),g,null)}else{const g=De(t);if(!l.isCompleteForPath(t)&&Ir(t)>1)return e;const b=ot(t),V=l.getNode().getImmediateChild(g).updateChild(b,s);g===".priority"?u=h.updatePriority(l.getNode(),V):u=h.updateChild(l.getNode(),g,V,b,Lw,null)}const d=kw(e,u,l.isFullyInitialized()||Oe(t),h.filtersNodes()),p=new om(r,d,i);return Fw(n,d,t,r,p,a)}function bf(n,e,t,s,r,i,o){const a=e.eventCache;let l,u;const h=new om(r,e,i);if(Oe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=Ga(e,u,!0,n.filter.filtersNodes());else{const d=De(t);if(d===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),s),l=Ga(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=ot(t),g=a.getNode().getImmediateChild(d);let b;if(Oe(p))b=s;else{const C=h.getCompleteChild(d);C!=null?vw(p)===".priority"&&C.getChild(Iw(p)).isEmpty()?b=C:b=C.updateChild(p,s):b=Ee.EMPTY_NODE}if(g.equals(b))l=e;else{const C=n.filter.updateChild(a.getNode(),d,b,p,h,o);l=Ga(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Ly(n,e){return n.eventCache.isCompleteForChild(e)}function kD(n,e,t,s,r,i,o){let a=e;return s.foreach((l,u)=>{const h=St(t,l);Ly(e,De(h))&&(a=bf(n,a,h,u,r,i,o))}),s.foreach((l,u)=>{const h=St(t,l);Ly(e,De(h))||(a=bf(n,a,h,u,r,i,o))}),a}function Fy(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function Af(n,e,t,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Oe(t)?u=s:u=new ct(null).setTree(t,s);const h=e.serverCache.getNode();return u.children.inorderTraversal((d,p)=>{if(h.hasChild(d)){const g=e.serverCache.getNode().getImmediateChild(d),b=Fy(n,g,p);l=Ru(n,l,new rt(d),b,r,i,o,a)}}),u.children.inorderTraversal((d,p)=>{const g=!e.serverCache.isCompleteForChild(d)&&p.value===null;if(!h.hasChild(d)&&!g){const b=e.serverCache.getNode().getImmediateChild(d),C=Fy(n,b,p);l=Ru(n,l,new rt(d),C,r,i,o,a)}}),l}function xD(n,e,t,s,r,i,o){if(Su(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Oe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ru(n,e,t,l.getNode().getChild(t),r,i,a,o);if(Oe(t)){let u=new ct(null);return l.getNode().forEachChild(ao,(h,d)=>{u=u.set(new rt(h),d)}),Af(n,e,t,u,r,i,a,o)}else return e}else{let u=new ct(null);return s.foreach((h,d)=>{const p=St(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),Af(n,e,t,u,r,i,a,o)}}function DD(n,e,t,s,r){const i=e.serverCache,o=kw(e,i.getNode(),i.isFullyInitialized()||Oe(t),i.isFiltered());return Fw(n,o,t,s,Lw,r)}function OD(n,e,t,s,r,i){let o;if(Su(s,t)!=null)return e;{const a=new om(s,e,r),l=e.eventCache.getNode();let u;if(Oe(t)||De(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Au(s,pi(e));else{const d=e.serverCache.getNode();J(d instanceof Ee,"serverChildren would be complete if leaf node"),h=rm(s,d)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=De(t);let d=im(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?u=n.filter.updateChild(l,h,d,ot(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Ee.EMPTY_NODE,ot(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Au(s,pi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Su(s,qe())!=null,Ga(e,u,o,n.filter.filtersNodes())}}class VD{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new Zp(s.getIndex()),i=eD(s);this.processor_=RD(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Ee.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ee.EMPTY_NODE,a.getNode(),null),h=new fi(l,o.isFullyInitialized(),r.filtersNodes()),d=new fi(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=wh(d,h),this.eventGenerator_=new aD(this.query_)}get query(){return this.query_}}function MD(n){return n.viewCache_.serverCache.getNode()}function LD(n,e){const t=pi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Oe(e)&&!t.getImmediateChild(De(e)).isEmpty())?t.getChild(e):null}function Uy(n){return n.eventRegistrations_.length===0}function FD(n,e){n.eventRegistrations_.push(e)}function By(n,e,t){const s=[];if(t){J(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return s}function $y(n,e,t,s){e.type===$n.MERGE&&e.source.queryId!==null&&(J(pi(n.viewCache_),"We should always have a full cache before handling merges"),J(If(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=PD(n.processor_,r,e,t,s);return CD(n.processor_,i.viewCache),J(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,Uw(n,i.changes,i.viewCache.eventCache.getNode(),null)}function UD(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(gt,(i,o)=>{s.push(Io(i,o))}),t.isFullyInitialized()&&s.push(Cw(t.getNode())),Uw(n,s,t.getNode(),e)}function Uw(n,e,t,s){const r=s?[s]:n.eventRegistrations_;return lD(n.eventGenerator_,e,t,r)}let Cu;class BD{constructor(){this.views=new Map}}function $D(n){J(!Cu,"__referenceConstructor has already been defined"),Cu=n}function qD(){return J(Cu,"Reference.ts has not been loaded"),Cu}function jD(n){return n.views.size===0}function am(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return J(i!=null,"SyncTree gave us an op for an invalid query."),$y(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat($y(o,e,t,s));return i}}function KD(n,e,t,s,r){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Au(t,r?s:null),l=!1;a?l=!0:s instanceof Ee?(a=rm(t,s),l=!1):(a=Ee.EMPTY_NODE,l=!1);const u=wh(new fi(a,l,!1),new fi(s,r,!1));return new VD(e,u)}return o}function GD(n,e,t,s,r,i){const o=KD(n,e,s,r,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),FD(o,t),UD(o,t)}function HD(n,e,t,s){const r=e._queryIdentifier,i=[];let o=[];const a=Tr(n);if(r==="default")for(const[l,u]of n.views.entries())o=o.concat(By(u,t,s)),Uy(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(r);l&&(o=o.concat(By(l,t,s)),Uy(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Tr(n)&&i.push(new(qD())(e._repo,e._path)),{removed:i,events:o}}function Bw(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function lo(n,e){let t=null;for(const s of n.views.values())t=t||LD(s,e);return t}function $w(n,e){if(e._queryParams.loadsAllData())return bh(n);{const s=e._queryIdentifier;return n.views.get(s)}}function qw(n,e){return $w(n,e)!=null}function Tr(n){return bh(n)!=null}function bh(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Pu;function zD(n){J(!Pu,"__referenceConstructor has already been defined"),Pu=n}function WD(){return J(Pu,"Reference.ts has not been loaded"),Pu}let QD=1;class qy{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_=wD(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function YD(n,e,t,s,r){return dD(n.pendingWriteTree_,e,t,s,r),r?zl(n,new di(Nw(),e,t)):[]}function Xi(n,e,t=!1){const s=fD(n.pendingWriteTree_,e);if(pD(n.pendingWriteTree_,e)){let i=new ct(null);return s.snap!=null?i=i.set(qe(),!0):pn(s.children,o=>{i=i.set(new rt(o),!0)}),zl(n,new bu(s.path,i,t))}else return[]}function Ah(n,e,t){return zl(n,new di(tm(),e,t))}function XD(n,e,t){const s=ct.fromObject(t);return zl(n,new yl(tm(),e,s))}function JD(n,e){return zl(n,new _l(tm(),e))}function ZD(n,e,t){const s=lm(n,t);if(s){const r=cm(s),i=r.path,o=r.queryId,a=dn(i,e),l=new _l(nm(o),a);return um(n,i,l)}else return[]}function Sf(n,e,t,s,r=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||qw(o,e))){const l=HD(o,e,t,s);jD(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!r){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(i,(p,g)=>Tr(g));if(h&&!d){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const g=nO(p);for(let b=0;b<g.length;++b){const C=g[b],V=C.query,L=Hw(n,C);n.listenProvider_.startListening(za(V),Nu(n,V),L.hashFn,L.onComplete)}}}!d&&u.length>0&&!s&&(h?n.listenProvider_.stopListening(za(e),null):u.forEach(p=>{const g=n.queryToTagMap.get(Sh(p));n.listenProvider_.stopListening(za(p),g)}))}sO(n,u)}return a}function eO(n,e,t,s){const r=lm(n,s);if(r!=null){const i=cm(r),o=i.path,a=i.queryId,l=dn(o,e),u=new di(nm(a),l,t);return um(n,o,u)}else return[]}function tO(n,e,t,s){const r=lm(n,s);if(r){const i=cm(r),o=i.path,a=i.queryId,l=dn(o,e),u=ct.fromObject(t),h=new yl(nm(a),l,u);return um(n,o,h)}else return[]}function jy(n,e,t,s=!1){const r=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(r,(p,g)=>{const b=dn(p,r);i=i||lo(g,b),o=o||Tr(g)});let a=n.syncPointTree_.get(r);a?(o=o||Tr(a),i=i||lo(a,qe())):(a=new BD,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=Ee.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((g,b)=>{const C=lo(b,qe());C&&(i=i.updateImmediateChild(g,C))}));const u=qw(a,e);if(!u&&!e._queryParams.loadsAllData()){const p=Sh(e);J(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const g=rO();n.queryToTagMap.set(p,g),n.tagToQueryMap.set(g,p)}const h=sm(n.pendingWriteTree_,r);let d=GD(a,e,t,h,i,l);if(!u&&!o&&!s){const p=$w(a,e);d=d.concat(iO(n,e,p))}return d}function jw(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=dn(o,e),u=lo(a,l);if(u)return u});return Ow(r,e,i,t,!0)}function zl(n,e){return Kw(e,n.syncPointTree_,null,sm(n.pendingWriteTree_,qe()))}function Kw(n,e,t,s){if(Oe(n.path))return Gw(n,e,t,s);{const r=e.get(qe());t==null&&r!=null&&(t=lo(r,qe()));let i=[];const o=De(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=Vw(s,o);i=i.concat(Kw(a,l,u,h))}return r&&(i=i.concat(am(r,n,s,t))),i}}function Gw(n,e,t,s){const r=e.get(qe());t==null&&r!=null&&(t=lo(r,qe()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=Vw(s,o),h=n.operationForChild(o);h&&(i=i.concat(Gw(h,a,l,u)))}),r&&(i=i.concat(am(r,n,s,t))),i}function Hw(n,e){const t=e.query,s=Nu(n,t);return{hashFn:()=>(MD(e)||Ee.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?ZD(n,t._path,s):JD(n,t._path);{const i=Zk(r,t);return Sf(n,t,null,i)}}}}function Nu(n,e){const t=Sh(e);return n.queryToTagMap.get(t)}function Sh(n){return n._path.toString()+"$"+n._queryIdentifier}function lm(n,e){return n.tagToQueryMap.get(e)}function cm(n){const e=n.indexOf("$");return J(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new rt(n.substr(0,e))}}function um(n,e,t){const s=n.syncPointTree_.get(e);J(s,"Missing sync point for query tag that we're tracking");const r=sm(n.pendingWriteTree_,e);return am(s,t,r,null)}function nO(n){return n.fold((e,t,s)=>{if(t&&Tr(t))return[bh(t)];{let r=[];return t&&(r=Bw(t)),pn(s,(i,o)=>{r=r.concat(o)}),r}})}function za(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(WD())(n._repo,n._path):n}function sO(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const r=Sh(s),i=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(i)}}}function rO(){return QD++}function iO(n,e,t){const s=e._path,r=Nu(n,e),i=Hw(n,t),o=n.listenProvider_.startListening(za(e),r,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(s);if(r)J(!Tr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,d)=>{if(!Oe(u)&&h&&Tr(h))return[bh(h).query];{let p=[];return h&&(p=p.concat(Bw(h).map(g=>g.query))),pn(d,(g,b)=>{p=p.concat(b)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(za(h),Nu(n,h))}}return o}class hm{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new hm(t)}node(){return this.node_}}class dm{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=St(this.path_,e);return new dm(this.syncTree_,t)}node(){return jw(this.syncTree_,this.path_)}}const oO=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ky=function(n,e,t){if(!n||typeof n!="object")return n;if(J(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return aO(n[".sv"],e,t);if(typeof n[".sv"]=="object")return lO(n[".sv"],e);J(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},aO=function(n,e,t){if(n==="timestamp")return t.timestamp;J(!1,"Unexpected server value: "+n)},lO=function(n,e,t){n.hasOwnProperty("increment")||J(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&J(!1,"Unexpected increment value: "+s);const r=e.node();if(J(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},cO=function(n,e,t,s){return fm(e,new dm(t,n),s)},uO=function(n,e,t){return fm(n,new hm(e),t)};function fm(n,e,t){const s=n.getPriority().val(),r=Ky(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=Ky(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new xt(a,Qt(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new xt(r))),o.forEachChild(gt,(a,l)=>{const u=fm(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}class pm{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function mm(n,e){let t=e instanceof rt?e:new rt(e),s=n,r=De(t);for(;r!==null;){const i=yo(s.node.children,r)||{children:{},childCount:0};s=new pm(r,s,i),t=ot(t),r=De(t)}return s}function Ko(n){return n.node.value}function zw(n,e){n.node.value=e,Rf(n)}function Ww(n){return n.node.childCount>0}function hO(n){return Ko(n)===void 0&&!Ww(n)}function Rh(n,e){pn(n.node.children,(t,s)=>{e(new pm(t,n,s))})}function Qw(n,e,t,s){t&&e(n),Rh(n,r=>{Qw(r,e,!0)})}function dO(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Wl(n){return new rt(n.parent===null?n.name:Wl(n.parent)+"/"+n.name)}function Rf(n){n.parent!==null&&fO(n.parent,n.name,n)}function fO(n,e,t){const s=hO(t),r=qs(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,Rf(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Rf(n))}const pO=/[\[\].#$\/\u0000-\u001F\u007F]/,mO=/[\[\].#$\u0000-\u001F\u007F]/,Vd=10*1024*1024,Yw=function(n){return typeof n=="string"&&n.length!==0&&!pO.test(n)},Xw=function(n){return typeof n=="string"&&n.length!==0&&!mO.test(n)},gO=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Xw(n)},Jw=function(n,e,t){const s=t instanceof rt?new xx(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+jr(s));if(typeof e=="function")throw new Error(n+"contains a function "+jr(s)+" with contents = "+e.toString());if(JT(e))throw new Error(n+"contains "+e.toString()+" "+jr(s));if(typeof e=="string"&&e.length>Vd/3&&gh(e)>Vd)throw new Error(n+"contains a string greater than "+Vd+" utf8 bytes "+jr(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(pn(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Yw(o)))throw new Error(n+" contains an invalid key ("+o+") "+jr(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Dx(s,o),Jw(n,a,s),Ox(s)}),r&&i)throw new Error(n+' contains ".value" child '+jr(s)+" in addition to actual children.")}},Zw=function(n,e,t,s){if(!Xw(t))throw new Error(dT(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_O=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Zw(n,e,t)},yO=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Yw(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!gO(t))throw new Error(dT(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class vO{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function eb(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!Yp(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function tb(n,e,t){eb(n,t),nb(n,s=>Yp(s,e))}function Si(n,e,t){eb(n,t),nb(n,s=>Bn(s,e)||Bn(e,s))}function nb(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(EO(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function EO(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();ja&&Wt("event: "+t.toString()),Gl(s)}}}const IO="repo_interrupt",TO=25;class wO{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new vO,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=wu(),this.transactionQueueTree_=new pm,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function bO(n,e,t){if(n.stats_=Wp(n.repoInfo_),n.forceRestClient_||sx())n.server_=new Tu(n.repoInfo_,(s,r,i,o)=>{Gy(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Hy(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ot(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Cs(n.repoInfo_,e,(s,r,i,o)=>{Gy(n,s,r,i,o)},s=>{Hy(n,s)},s=>{SO(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=lx(n.repoInfo_,()=>new oD(n.stats_,n.server_)),n.infoData_=new tD,n.infoSyncTree_=new qy({startListening:(s,r,i,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=Ah(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),gm(n,"connected",!1),n.serverSyncTree_=new qy({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);Si(n.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function AO(n){const t=n.infoData_.getNode(new rt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sb(n){return oO({timestamp:AO(n)})}function Gy(n,e,t,s,r){n.dataUpdateCount++;const i=new rt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const l=hu(t,u=>Qt(u));o=tO(n.serverSyncTree_,i,l,r)}else{const l=Qt(t);o=eO(n.serverSyncTree_,i,l,r)}else if(s){const l=hu(t,u=>Qt(u));o=XD(n.serverSyncTree_,i,l)}else{const l=Qt(t);o=Ah(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=ym(n,i)),Si(n.eventQueue_,a,o)}function Hy(n,e){gm(n,"connected",e),e===!1&&CO(n)}function SO(n,e){pn(e,(t,s)=>{gm(n,t,s)})}function gm(n,e,t){const s=new rt("/.info/"+e),r=Qt(t);n.infoData_.updateSnapshot(s,r);const i=Ah(n.infoSyncTree_,s,r);Si(n.eventQueue_,s,i)}function RO(n){return n.nextWriteId_++}function CO(n){rb(n,"onDisconnectEvents");const e=sb(n),t=wu();Ef(n.onDisconnect_,qe(),(r,i)=>{const o=cO(r,i,n.serverSyncTree_,e);Pw(t,r,o)});let s=[];Ef(t,qe(),(r,i)=>{s=s.concat(Ah(n.serverSyncTree_,r,i));const o=DO(n,r);ym(n,o)}),n.onDisconnect_=wu(),Si(n.eventQueue_,qe(),s)}function PO(n,e,t){let s;De(e._path)===".info"?s=jy(n.infoSyncTree_,e,t):s=jy(n.serverSyncTree_,e,t),tb(n.eventQueue_,e._path,s)}function zy(n,e,t){let s;De(e._path)===".info"?s=Sf(n.infoSyncTree_,e,t):s=Sf(n.serverSyncTree_,e,t),tb(n.eventQueue_,e._path,s)}function NO(n){n.persistentConnection_&&n.persistentConnection_.interrupt(IO)}function rb(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Wt(t,...e)}function ib(n,e,t){return jw(n.serverSyncTree_,e,t)||Ee.EMPTY_NODE}function _m(n,e=n.transactionQueueTree_){if(e||Ch(n,e),Ko(e)){const t=ab(n,e);J(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&kO(n,Wl(e),t)}else Ww(e)&&Rh(e,t=>{_m(n,t)})}function kO(n,e,t){const s=t.map(u=>u.currentWriteId),r=ib(n,e,s);let i=r;const o=r.hash();for(let u=0;u<t.length;u++){const h=t[u];J(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=dn(e,h.path);i=i.updateChild(d,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{rb(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const d=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(Xi(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&d.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();Ch(n,mm(n.transactionQueueTree_,e)),_m(n,n.transactionQueueTree_),Si(n.eventQueue_,e,h);for(let p=0;p<d.length;p++)Gl(d[p])}else{if(u==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{bn("transaction at "+l.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}ym(n,e)}},o)}function ym(n,e){const t=ob(n,e),s=Wl(t),r=ab(n,t);return xO(n,r,s),s}function xO(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=dn(t,l.path);let h=!1,d;if(J(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(Xi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=TO)h=!0,d="maxretry",r=r.concat(Xi(n.serverSyncTree_,l.currentWriteId,!0));else{const p=ib(n,l.path,o);l.currentInputSnapshot=p;const g=e[a].update(p.val());if(g!==void 0){Jw("transaction failed: Data returned ",g,l.path);let b=Qt(g);typeof g=="object"&&g!=null&&qs(g,".priority")||(b=b.updatePriority(p.getPriority()));const V=l.currentWriteId,L=sb(n),F=uO(b,p,L);l.currentOutputSnapshotRaw=b,l.currentOutputSnapshotResolved=F,l.currentWriteId=RO(n),o.splice(o.indexOf(V),1),r=r.concat(YD(n.serverSyncTree_,l.path,F,l.currentWriteId,l.applyLocally)),r=r.concat(Xi(n.serverSyncTree_,V,!0))}else h=!0,d="nodata",r=r.concat(Xi(n.serverSyncTree_,l.currentWriteId,!0))}Si(n.eventQueue_,t,r),r=[],h&&(e[a].status=2,(function(p){setTimeout(p,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Ch(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Gl(s[a]);_m(n,n.transactionQueueTree_)}function ob(n,e){let t,s=n.transactionQueueTree_;for(t=De(e);t!==null&&Ko(s)===void 0;)s=mm(s,t),e=ot(e),t=De(e);return s}function ab(n,e){const t=[];return lb(n,e,t),t.sort((s,r)=>s.order-r.order),t}function lb(n,e,t){const s=Ko(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);Rh(e,r=>{lb(n,r,t)})}function Ch(n,e){const t=Ko(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,zw(e,t.length>0?t:void 0)}Rh(e,s=>{Ch(n,s)})}function DO(n,e){const t=Wl(ob(n,e)),s=mm(n.transactionQueueTree_,e);return dO(s,r=>{Md(n,r)}),Md(n,s),Qw(s,r=>{Md(n,r)}),t}function Md(n,e){const t=Ko(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(J(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(J(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Xi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?zw(e,void 0):t.length=i+1,Si(n.eventQueue_,Wl(e),r);for(let o=0;o<s.length;o++)Gl(s[o])}}function OO(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function VO(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):bn(`Invalid query segment '${t}' in query '${n}'`)}return e}const Wy=function(n,e){const t=MO(n),s=t.namespace;t.domain==="firebase.com"&&Ls(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Ls("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Wk();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new uw(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new rt(t.pathString)}},MO=function(n){let e="",t="",s="",r="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(r=OO(n.substring(h,d)));const p=VO(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const g=e.slice(0,u);if(g.toLowerCase()==="localhost")t="localhost";else if(g.split(".").length<=2)t=g;else{const b=e.indexOf(".");s=e.substring(0,b).toLowerCase(),t=e.substring(b+1),i=s}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};class LO{constructor(e,t,s,r){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ot(this.snapshot.exportVal())}}class FO{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class UO{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return J(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class vm{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return Oe(this._path)?null:vw(this._path)}get ref(){return new Cr(this._repo,this._path)}get _queryIdentifier(){const e=ky(this._queryParams),t=Hp(e);return t==="{}"?"default":t}get _queryObject(){return ky(this._queryParams)}isEqual(e){if(e=$t(e),!(e instanceof vm))return!1;const t=this._repo===e._repo,s=Yp(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+kx(this._path)}}class Cr extends vm{constructor(e,t){super(e,t,new em,!1)}get parent(){const e=Iw(this._path);return e===null?null:new Cr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ku{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new rt(e),s=Cf(this.ref,e);return new ku(this._node.getChild(t),s,gt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new ku(r,Cf(this.ref,s),gt)))}hasChild(e){const t=new rt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function BO(n,e){return n=$t(n),n._checkNotDeleted("ref"),e!==void 0?Cf(n._root,e):n._root}function Cf(n,e){return n=$t(n),De(n._path)===null?_O("child","path",e):Zw("child","path",e),new Cr(n._repo,St(n._path,e))}class Em{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new LO("value",this,new ku(e.snapshotNode,new Cr(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new FO(this,e,t):null}matches(e){return e instanceof Em?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function $O(n,e,t,s,r){let i;if(typeof s=="object"&&(i=void 0,r=s),typeof s=="function"&&(i=s),r&&r.onlyOnce){const l=t,u=(h,d)=>{zy(n._repo,n,a),l(h,d)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new UO(t,i||void 0),a=new Em(o);return PO(n._repo,n,a),()=>zy(n._repo,n,a)}function qO(n,e,t,s){return $O(n,"value",e,t,s)}$D(Cr);zD(Cr);const jO="FIREBASE_DATABASE_EMULATOR_HOST",Pf={};let KO=!1;function GO(n,e,t,s){const r=e.lastIndexOf(":"),i=e.substring(0,r),o=Rr(i);n.repoInfo_=new uw(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function HO(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||Ls("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Wt("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Wy(i,r),a=o.repoInfo,l;typeof process<"u"&&fy&&(l=fy[jO]),l?(i=`http://${l}?ns=${a.namespace}`,o=Wy(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new ix(n.name,n.options,e);yO("Invalid Firebase Database URL",o),Oe(o.path)||Ls("Database URL must point to the root of a Firebase Database (not including a child path).");const h=WO(a,n,u,new rx(n,t));return new QO(h,n)}function zO(n,e){const t=Pf[e];(!t||t[n.key]!==n)&&Ls(`Database ${e}(${n.repoInfo_}) has already been deleted.`),NO(n),delete t[n.key]}function WO(n,e,t,s){let r=Pf[e.name];r||(r={},Pf[e.name]=r);let i=r[n.toURLString()];return i&&Ls("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new wO(n,KO,t,s),r[n.toURLString()]=i,i}class QO{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(bO(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Cr(this._repo,qe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(zO(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ls("Cannot call "+e+" on a deleted database.")}}function YO(n=gT(),e){const t=yh(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=dP("database");s&&XO(t,...s)}return t}function XO(n,e,t,s={}){n=$t(n),n._checkNotDeleted("useEmulator");const r=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&vr(s,i.repoInfo_.emulatorOptions))return;Ls("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Ls('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Uc(Uc.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:fP(s.mockUserToken,n.app.options.projectId);o=new Uc(a)}Rr(e)&&(Dp(e),iT("Database",!0)),GO(i,r,s,o)}function JO(n){qk(bi),ci(new Er("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return HO(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),ls(py,my,n),ls(py,my,"esm2020")}Cs.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Cs.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};JO();var Qy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var gr,cb;(function(){var n;function e(I,v){function w(){}w.prototype=v.prototype,I.F=v.prototype,I.prototype=new w,I.prototype.constructor=I,I.D=function(R,S,N){for(var T=Array(arguments.length-2),he=2;he<arguments.length;he++)T[he-2]=arguments[he];return v.prototype[S].apply(R,T)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,v,w){w||(w=0);const R=Array(16);if(typeof v=="string")for(var S=0;S<16;++S)R[S]=v.charCodeAt(w++)|v.charCodeAt(w++)<<8|v.charCodeAt(w++)<<16|v.charCodeAt(w++)<<24;else for(S=0;S<16;++S)R[S]=v[w++]|v[w++]<<8|v[w++]<<16|v[w++]<<24;v=I.g[0],w=I.g[1],S=I.g[2];let N=I.g[3],T;T=v+(N^w&(S^N))+R[0]+3614090360&4294967295,v=w+(T<<7&4294967295|T>>>25),T=N+(S^v&(w^S))+R[1]+3905402710&4294967295,N=v+(T<<12&4294967295|T>>>20),T=S+(w^N&(v^w))+R[2]+606105819&4294967295,S=N+(T<<17&4294967295|T>>>15),T=w+(v^S&(N^v))+R[3]+3250441966&4294967295,w=S+(T<<22&4294967295|T>>>10),T=v+(N^w&(S^N))+R[4]+4118548399&4294967295,v=w+(T<<7&4294967295|T>>>25),T=N+(S^v&(w^S))+R[5]+1200080426&4294967295,N=v+(T<<12&4294967295|T>>>20),T=S+(w^N&(v^w))+R[6]+2821735955&4294967295,S=N+(T<<17&4294967295|T>>>15),T=w+(v^S&(N^v))+R[7]+4249261313&4294967295,w=S+(T<<22&4294967295|T>>>10),T=v+(N^w&(S^N))+R[8]+1770035416&4294967295,v=w+(T<<7&4294967295|T>>>25),T=N+(S^v&(w^S))+R[9]+2336552879&4294967295,N=v+(T<<12&4294967295|T>>>20),T=S+(w^N&(v^w))+R[10]+4294925233&4294967295,S=N+(T<<17&4294967295|T>>>15),T=w+(v^S&(N^v))+R[11]+2304563134&4294967295,w=S+(T<<22&4294967295|T>>>10),T=v+(N^w&(S^N))+R[12]+1804603682&4294967295,v=w+(T<<7&4294967295|T>>>25),T=N+(S^v&(w^S))+R[13]+4254626195&4294967295,N=v+(T<<12&4294967295|T>>>20),T=S+(w^N&(v^w))+R[14]+2792965006&4294967295,S=N+(T<<17&4294967295|T>>>15),T=w+(v^S&(N^v))+R[15]+1236535329&4294967295,w=S+(T<<22&4294967295|T>>>10),T=v+(S^N&(w^S))+R[1]+4129170786&4294967295,v=w+(T<<5&4294967295|T>>>27),T=N+(w^S&(v^w))+R[6]+3225465664&4294967295,N=v+(T<<9&4294967295|T>>>23),T=S+(v^w&(N^v))+R[11]+643717713&4294967295,S=N+(T<<14&4294967295|T>>>18),T=w+(N^v&(S^N))+R[0]+3921069994&4294967295,w=S+(T<<20&4294967295|T>>>12),T=v+(S^N&(w^S))+R[5]+3593408605&4294967295,v=w+(T<<5&4294967295|T>>>27),T=N+(w^S&(v^w))+R[10]+38016083&4294967295,N=v+(T<<9&4294967295|T>>>23),T=S+(v^w&(N^v))+R[15]+3634488961&4294967295,S=N+(T<<14&4294967295|T>>>18),T=w+(N^v&(S^N))+R[4]+3889429448&4294967295,w=S+(T<<20&4294967295|T>>>12),T=v+(S^N&(w^S))+R[9]+568446438&4294967295,v=w+(T<<5&4294967295|T>>>27),T=N+(w^S&(v^w))+R[14]+3275163606&4294967295,N=v+(T<<9&4294967295|T>>>23),T=S+(v^w&(N^v))+R[3]+4107603335&4294967295,S=N+(T<<14&4294967295|T>>>18),T=w+(N^v&(S^N))+R[8]+1163531501&4294967295,w=S+(T<<20&4294967295|T>>>12),T=v+(S^N&(w^S))+R[13]+2850285829&4294967295,v=w+(T<<5&4294967295|T>>>27),T=N+(w^S&(v^w))+R[2]+4243563512&4294967295,N=v+(T<<9&4294967295|T>>>23),T=S+(v^w&(N^v))+R[7]+1735328473&4294967295,S=N+(T<<14&4294967295|T>>>18),T=w+(N^v&(S^N))+R[12]+2368359562&4294967295,w=S+(T<<20&4294967295|T>>>12),T=v+(w^S^N)+R[5]+4294588738&4294967295,v=w+(T<<4&4294967295|T>>>28),T=N+(v^w^S)+R[8]+2272392833&4294967295,N=v+(T<<11&4294967295|T>>>21),T=S+(N^v^w)+R[11]+1839030562&4294967295,S=N+(T<<16&4294967295|T>>>16),T=w+(S^N^v)+R[14]+4259657740&4294967295,w=S+(T<<23&4294967295|T>>>9),T=v+(w^S^N)+R[1]+2763975236&4294967295,v=w+(T<<4&4294967295|T>>>28),T=N+(v^w^S)+R[4]+1272893353&4294967295,N=v+(T<<11&4294967295|T>>>21),T=S+(N^v^w)+R[7]+4139469664&4294967295,S=N+(T<<16&4294967295|T>>>16),T=w+(S^N^v)+R[10]+3200236656&4294967295,w=S+(T<<23&4294967295|T>>>9),T=v+(w^S^N)+R[13]+681279174&4294967295,v=w+(T<<4&4294967295|T>>>28),T=N+(v^w^S)+R[0]+3936430074&4294967295,N=v+(T<<11&4294967295|T>>>21),T=S+(N^v^w)+R[3]+3572445317&4294967295,S=N+(T<<16&4294967295|T>>>16),T=w+(S^N^v)+R[6]+76029189&4294967295,w=S+(T<<23&4294967295|T>>>9),T=v+(w^S^N)+R[9]+3654602809&4294967295,v=w+(T<<4&4294967295|T>>>28),T=N+(v^w^S)+R[12]+3873151461&4294967295,N=v+(T<<11&4294967295|T>>>21),T=S+(N^v^w)+R[15]+530742520&4294967295,S=N+(T<<16&4294967295|T>>>16),T=w+(S^N^v)+R[2]+3299628645&4294967295,w=S+(T<<23&4294967295|T>>>9),T=v+(S^(w|~N))+R[0]+4096336452&4294967295,v=w+(T<<6&4294967295|T>>>26),T=N+(w^(v|~S))+R[7]+1126891415&4294967295,N=v+(T<<10&4294967295|T>>>22),T=S+(v^(N|~w))+R[14]+2878612391&4294967295,S=N+(T<<15&4294967295|T>>>17),T=w+(N^(S|~v))+R[5]+4237533241&4294967295,w=S+(T<<21&4294967295|T>>>11),T=v+(S^(w|~N))+R[12]+1700485571&4294967295,v=w+(T<<6&4294967295|T>>>26),T=N+(w^(v|~S))+R[3]+2399980690&4294967295,N=v+(T<<10&4294967295|T>>>22),T=S+(v^(N|~w))+R[10]+4293915773&4294967295,S=N+(T<<15&4294967295|T>>>17),T=w+(N^(S|~v))+R[1]+2240044497&4294967295,w=S+(T<<21&4294967295|T>>>11),T=v+(S^(w|~N))+R[8]+1873313359&4294967295,v=w+(T<<6&4294967295|T>>>26),T=N+(w^(v|~S))+R[15]+4264355552&4294967295,N=v+(T<<10&4294967295|T>>>22),T=S+(v^(N|~w))+R[6]+2734768916&4294967295,S=N+(T<<15&4294967295|T>>>17),T=w+(N^(S|~v))+R[13]+1309151649&4294967295,w=S+(T<<21&4294967295|T>>>11),T=v+(S^(w|~N))+R[4]+4149444226&4294967295,v=w+(T<<6&4294967295|T>>>26),T=N+(w^(v|~S))+R[11]+3174756917&4294967295,N=v+(T<<10&4294967295|T>>>22),T=S+(v^(N|~w))+R[2]+718787259&4294967295,S=N+(T<<15&4294967295|T>>>17),T=w+(N^(S|~v))+R[9]+3951481745&4294967295,I.g[0]=I.g[0]+v&4294967295,I.g[1]=I.g[1]+(S+(T<<21&4294967295|T>>>11))&4294967295,I.g[2]=I.g[2]+S&4294967295,I.g[3]=I.g[3]+N&4294967295}s.prototype.v=function(I,v){v===void 0&&(v=I.length);const w=v-this.blockSize,R=this.C;let S=this.h,N=0;for(;N<v;){if(S==0)for(;N<=w;)r(this,I,N),N+=this.blockSize;if(typeof I=="string"){for(;N<v;)if(R[S++]=I.charCodeAt(N++),S==this.blockSize){r(this,R),S=0;break}}else for(;N<v;)if(R[S++]=I[N++],S==this.blockSize){r(this,R),S=0;break}}this.h=S,this.o+=v},s.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var v=1;v<I.length-8;++v)I[v]=0;v=this.o*8;for(var w=I.length-8;w<I.length;++w)I[w]=v&255,v/=256;for(this.v(I),I=Array(16),v=0,w=0;w<4;++w)for(let R=0;R<32;R+=8)I[v++]=this.g[w]>>>R&255;return I};function i(I,v){var w=a;return Object.prototype.hasOwnProperty.call(w,I)?w[I]:w[I]=v(I)}function o(I,v){this.h=v;const w=[];let R=!0;for(let S=I.length-1;S>=0;S--){const N=I[S]|0;R&&N==v||(w[S]=N,R=!1)}this.g=w}var a={};function l(I){return-128<=I&&I<128?i(I,function(v){return new o([v|0],v<0?-1:0)}):new o([I|0],I<0?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return d;if(I<0)return V(u(-I));const v=[];let w=1;for(let R=0;I>=w;R++)v[R]=I/w|0,w*=4294967296;return new o(v,0)}function h(I,v){if(I.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(I.charAt(0)=="-")return V(h(I.substring(1),v));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const w=u(Math.pow(v,8));let R=d;for(let N=0;N<I.length;N+=8){var S=Math.min(8,I.length-N);const T=parseInt(I.substring(N,N+S),v);S<8?(S=u(Math.pow(v,S)),R=R.j(S).add(u(T))):(R=R.j(w),R=R.add(u(T)))}return R}var d=l(0),p=l(1),g=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-V(this).m();let I=0,v=1;for(let w=0;w<this.g.length;w++){const R=this.i(w);I+=(R>=0?R:4294967296+R)*v,v*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(b(this))return"0";if(C(this))return"-"+V(this).toString(I);const v=u(Math.pow(I,6));var w=this;let R="";for(;;){const S=P(w,v).g;w=L(w,S.j(v));let N=((w.g.length>0?w.g[0]:w.h)>>>0).toString(I);if(w=S,b(w))return N+R;for(;N.length<6;)N="0"+N;R=N+R}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function b(I){if(I.h!=0)return!1;for(let v=0;v<I.g.length;v++)if(I.g[v]!=0)return!1;return!0}function C(I){return I.h==-1}n.l=function(I){return I=L(this,I),C(I)?-1:b(I)?0:1};function V(I){const v=I.g.length,w=[];for(let R=0;R<v;R++)w[R]=~I.g[R];return new o(w,~I.h).add(p)}n.abs=function(){return C(this)?V(this):this},n.add=function(I){const v=Math.max(this.g.length,I.g.length),w=[];let R=0;for(let S=0;S<=v;S++){let N=R+(this.i(S)&65535)+(I.i(S)&65535),T=(N>>>16)+(this.i(S)>>>16)+(I.i(S)>>>16);R=T>>>16,N&=65535,T&=65535,w[S]=T<<16|N}return new o(w,w[w.length-1]&-2147483648?-1:0)};function L(I,v){return I.add(V(v))}n.j=function(I){if(b(this)||b(I))return d;if(C(this))return C(I)?V(this).j(V(I)):V(V(this).j(I));if(C(I))return V(this.j(V(I)));if(this.l(g)<0&&I.l(g)<0)return u(this.m()*I.m());const v=this.g.length+I.g.length,w=[];for(var R=0;R<2*v;R++)w[R]=0;for(R=0;R<this.g.length;R++)for(let S=0;S<I.g.length;S++){const N=this.i(R)>>>16,T=this.i(R)&65535,he=I.i(S)>>>16,ae=I.i(S)&65535;w[2*R+2*S]+=T*ae,F(w,2*R+2*S),w[2*R+2*S+1]+=N*ae,F(w,2*R+2*S+1),w[2*R+2*S+1]+=T*he,F(w,2*R+2*S+1),w[2*R+2*S+2]+=N*he,F(w,2*R+2*S+2)}for(I=0;I<v;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=v;I<2*v;I++)w[I]=0;return new o(w,0)};function F(I,v){for(;(I[v]&65535)!=I[v];)I[v+1]+=I[v]>>>16,I[v]&=65535,v++}function D(I,v){this.g=I,this.h=v}function P(I,v){if(b(v))throw Error("division by zero");if(b(I))return new D(d,d);if(C(I))return v=P(V(I),v),new D(V(v.g),V(v.h));if(C(v))return v=P(I,V(v)),new D(V(v.g),v.h);if(I.g.length>30){if(C(I)||C(v))throw Error("slowDivide_ only works with positive integers.");for(var w=p,R=v;R.l(I)<=0;)w=q(w),R=q(R);var S=Y(w,1),N=Y(R,1);for(R=Y(R,2),w=Y(w,2);!b(R);){var T=N.add(R);T.l(I)<=0&&(S=S.add(w),N=T),R=Y(R,1),w=Y(w,1)}return v=L(I,S.j(v)),new D(S,v)}for(S=d;I.l(v)>=0;){for(w=Math.max(1,Math.floor(I.m()/v.m())),R=Math.ceil(Math.log(w)/Math.LN2),R=R<=48?1:Math.pow(2,R-48),N=u(w),T=N.j(v);C(T)||T.l(I)>0;)w-=R,N=u(w),T=N.j(v);b(N)&&(N=p),S=S.add(N),I=L(I,T)}return new D(S,I)}n.B=function(I){return P(this,I).h},n.and=function(I){const v=Math.max(this.g.length,I.g.length),w=[];for(let R=0;R<v;R++)w[R]=this.i(R)&I.i(R);return new o(w,this.h&I.h)},n.or=function(I){const v=Math.max(this.g.length,I.g.length),w=[];for(let R=0;R<v;R++)w[R]=this.i(R)|I.i(R);return new o(w,this.h|I.h)},n.xor=function(I){const v=Math.max(this.g.length,I.g.length),w=[];for(let R=0;R<v;R++)w[R]=this.i(R)^I.i(R);return new o(w,this.h^I.h)};function q(I){const v=I.g.length+1,w=[];for(let R=0;R<v;R++)w[R]=I.i(R)<<1|I.i(R-1)>>>31;return new o(w,I.h)}function Y(I,v){const w=v>>5;v%=32;const R=I.g.length-w,S=[];for(let N=0;N<R;N++)S[N]=v>0?I.i(N+w)>>>v|I.i(N+w+1)<<32-v:I.i(N+w);return new o(S,I.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,cb=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,gr=o}).apply(typeof Qy<"u"?Qy:typeof self<"u"?self:typeof window<"u"?window:{});var Tc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ub,Pa,hb,$c,Nf,db,fb,pb;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Tc=="object"&&Tc];for(var f=0;f<c.length;++f){var m=c[f];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var s=t(this);function r(c,f){if(f)e:{var m=s;c=c.split(".");for(var y=0;y<c.length-1;y++){var O=c[y];if(!(O in m))break e;m=m[O]}c=c[c.length-1],y=m[c],f=f(y),f!=y&&f!=null&&e(m,c,{configurable:!0,writable:!0,value:f})}}r("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(c){return c||function(f){var m=[],y;for(y in f)Object.prototype.hasOwnProperty.call(f,y)&&m.push([y,f[y]]);return m}});var i=i||{},o=this||self;function a(c){var f=typeof c;return f=="object"&&c!=null||f=="function"}function l(c,f,m){return c.call.apply(c.bind,arguments)}function u(c,f,m){return u=l,u.apply(null,arguments)}function h(c,f){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function d(c,f){function m(){}m.prototype=f.prototype,c.Z=f.prototype,c.prototype=new m,c.prototype.constructor=c,c.Ob=function(y,O,M){for(var Z=Array(arguments.length-2),Re=2;Re<arguments.length;Re++)Z[Re-2]=arguments[Re];return f.prototype[O].apply(y,Z)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function g(c){const f=c.length;if(f>0){const m=Array(f);for(let y=0;y<f;y++)m[y]=c[y];return m}return[]}function b(c,f){for(let y=1;y<arguments.length;y++){const O=arguments[y];var m=typeof O;if(m=m!="object"?m:O?Array.isArray(O)?"array":m:"null",m=="array"||m=="object"&&typeof O.length=="number"){m=c.length||0;const M=O.length||0;c.length=m+M;for(let Z=0;Z<M;Z++)c[m+Z]=O[Z]}else c.push(O)}}class C{constructor(f,m){this.i=f,this.j=m,this.h=0,this.g=null}get(){let f;return this.h>0?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function V(c){o.setTimeout(()=>{throw c},0)}function L(){var c=I;let f=null;return c.g&&(f=c.g,c.g=c.g.next,c.g||(c.h=null),f.next=null),f}class F{constructor(){this.h=this.g=null}add(f,m){const y=D.get();y.set(f,m),this.h?this.h.next=y:this.g=y,this.h=y}}var D=new C(()=>new P,c=>c.reset());class P{constructor(){this.next=this.g=this.h=null}set(f,m){this.h=f,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let q,Y=!1,I=new F,v=()=>{const c=Promise.resolve(void 0);q=()=>{c.then(w)}};function w(){for(var c;c=L();){try{c.h.call(c.g)}catch(m){V(m)}var f=D;f.j(c),f.h<100&&(f.h++,c.next=f.g,f.g=c)}Y=!1}function R(){this.u=this.u,this.C=this.C}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function S(c,f){this.type=c,this.g=this.target=f,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var N=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,f=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};o.addEventListener("test",m,f),o.removeEventListener("test",m,f)}catch{}return c})();function T(c){return/^[\s\xa0]*$/.test(c)}function he(c,f){S.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,f)}d(he,S),he.prototype.init=function(c,f){const m=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=f,f=c.relatedTarget,f||(m=="mouseover"?f=c.fromElement:m=="mouseout"&&(f=c.toElement)),this.relatedTarget=f,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&he.Z.h.call(this)},he.prototype.h=function(){he.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var ae="closure_listenable_"+(Math.random()*1e6|0),Fe=0;function Be(c,f,m,y,O){this.listener=c,this.proxy=null,this.src=f,this.type=m,this.capture=!!y,this.ha=O,this.key=++Fe,this.da=this.fa=!1}function Ne(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Vt(c,f,m){for(const y in c)f.call(m,c[y],y,c)}function Sn(c,f){for(const m in c)f.call(void 0,c[m],m,c)}function tn(c){const f={};for(const m in c)f[m]=c[m];return f}const wt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(c,f){let m,y;for(let O=1;O<arguments.length;O++){y=arguments[O];for(m in y)c[m]=y[m];for(let M=0;M<wt.length;M++)m=wt[M],Object.prototype.hasOwnProperty.call(y,m)&&(c[m]=y[m])}}function ee(c){this.src=c,this.g={},this.h=0}ee.prototype.add=function(c,f,m,y,O){const M=c.toString();c=this.g[M],c||(c=this.g[M]=[],this.h++);const Z=Xe(c,f,y,O);return Z>-1?(f=c[Z],m||(f.fa=!1)):(f=new Be(f,this.src,M,!!y,O),f.fa=m,c.push(f)),f};function re(c,f){const m=f.type;if(m in c.g){var y=c.g[m],O=Array.prototype.indexOf.call(y,f,void 0),M;(M=O>=0)&&Array.prototype.splice.call(y,O,1),M&&(Ne(f),c.g[m].length==0&&(delete c.g[m],c.h--))}}function Xe(c,f,m,y){for(let O=0;O<c.length;++O){const M=c[O];if(!M.da&&M.listener==f&&M.capture==!!m&&M.ha==y)return O}return-1}var $="closure_lm_"+(Math.random()*1e6|0),ce={};function ne(c,f,m,y,O){if(Array.isArray(f)){for(let M=0;M<f.length;M++)ne(c,f[M],m,y,O);return null}return m=te(m),c&&c[ae]?c.J(f,m,a(y)?!!y.capture:!1,O):fe(c,f,m,!1,y,O)}function fe(c,f,m,y,O,M){if(!f)throw Error("Invalid event type");const Z=a(O)?!!O.capture:!!O;let Re=K(c);if(Re||(c[$]=Re=new ee(c)),m=Re.add(f,m,y,Z,M),m.proxy)return m;if(y=Ve(),m.proxy=y,y.src=c,y.listener=m,c.addEventListener)N||(O=Z),O===void 0&&(O=!1),c.addEventListener(f.toString(),y,O);else if(c.attachEvent)c.attachEvent(k(f.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Ve(){function c(m){return f.call(c.src,c.listener,m)}const f=U;return c}function E(c,f,m,y,O){if(Array.isArray(f))for(var M=0;M<f.length;M++)E(c,f[M],m,y,O);else y=a(y)?!!y.capture:!!y,m=te(m),c&&c[ae]?(c=c.i,M=String(f).toString(),M in c.g&&(f=c.g[M],m=Xe(f,m,y,O),m>-1&&(Ne(f[m]),Array.prototype.splice.call(f,m,1),f.length==0&&(delete c.g[M],c.h--)))):c&&(c=K(c))&&(f=c.g[f.toString()],c=-1,f&&(c=Xe(f,m,y,O)),(m=c>-1?f[c]:null)&&A(m))}function A(c){if(typeof c!="number"&&c&&!c.da){var f=c.src;if(f&&f[ae])re(f.i,c);else{var m=c.type,y=c.proxy;f.removeEventListener?f.removeEventListener(m,y,c.capture):f.detachEvent?f.detachEvent(k(m),y):f.addListener&&f.removeListener&&f.removeListener(y),(m=K(f))?(re(m,c),m.h==0&&(m.src=null,f[$]=null)):Ne(c)}}}function k(c){return c in ce?ce[c]:ce[c]="on"+c}function U(c,f){if(c.da)c=!0;else{f=new he(f,this);const m=c.listener,y=c.ha||c.src;c.fa&&A(c),c=m.call(y,f)}return c}function K(c){return c=c[$],c instanceof ee?c:null}var B="__closure_events_fn_"+(Math.random()*1e9>>>0);function te(c){return typeof c=="function"?c:(c[B]||(c[B]=function(f){return c.handleEvent(f)}),c[B])}function z(){R.call(this),this.i=new ee(this),this.M=this,this.G=null}d(z,R),z.prototype[ae]=!0,z.prototype.removeEventListener=function(c,f,m,y){E(this,c,f,m,y)};function H(c,f){var m,y=c.G;if(y)for(m=[];y;y=y.G)m.push(y);if(c=c.M,y=f.type||f,typeof f=="string")f=new S(f,c);else if(f instanceof S)f.target=f.target||c;else{var O=f;f=new S(y,c),oe(f,O)}O=!0;let M,Z;if(m)for(Z=m.length-1;Z>=0;Z--)M=f.g=m[Z],O=G(M,y,!0,f)&&O;if(M=f.g=c,O=G(M,y,!0,f)&&O,O=G(M,y,!1,f)&&O,m)for(Z=0;Z<m.length;Z++)M=f.g=m[Z],O=G(M,y,!1,f)&&O}z.prototype.N=function(){if(z.Z.N.call(this),this.i){var c=this.i;for(const f in c.g){const m=c.g[f];for(let y=0;y<m.length;y++)Ne(m[y]);delete c.g[f],c.h--}}this.G=null},z.prototype.J=function(c,f,m,y){return this.i.add(String(c),f,!1,m,y)},z.prototype.K=function(c,f,m,y){return this.i.add(String(c),f,!0,m,y)};function G(c,f,m,y){if(f=c.i.g[String(f)],!f)return!0;f=f.concat();let O=!0;for(let M=0;M<f.length;++M){const Z=f[M];if(Z&&!Z.da&&Z.capture==m){const Re=Z.listener,bt=Z.ha||Z.src;Z.fa&&re(c.i,Z),O=Re.call(bt,y)!==!1&&O}}return O&&!y.defaultPrevented}function _e(c,f){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(f)>2147483647?-1:o.setTimeout(c,f||0)}function ie(c){c.g=_e(()=>{c.g=null,c.i&&(c.i=!1,ie(c))},c.l);const f=c.h;c.h=null,c.m.apply(null,f)}class pe extends R{constructor(f,m){super(),this.m=f,this.l=m,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:ie(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ve(c){R.call(this),this.h=c,this.g={}}d(ve,R);var ke=[];function We(c){Vt(c.g,function(f,m){this.g.hasOwnProperty(m)&&A(f)},c),c.g={}}ve.prototype.N=function(){ve.Z.N.call(this),We(this)},ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ue=o.JSON.stringify,qt=o.JSON.parse,jt=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function gn(){}function _n(){}var On={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ki(){S.call(this,"d")}d(ki,S);function Mt(){S.call(this,"c")}d(Mt,S);var Nt={},Yo=null;function Dr(){return Yo=Yo||new z}Nt.Ia="serverreachability";function yg(c){S.call(this,Nt.Ia,c)}d(yg,S);function Xo(c){const f=Dr();H(f,new yg(f))}Nt.STAT_EVENT="statevent";function vg(c,f){S.call(this,Nt.STAT_EVENT,c),this.stat=f}d(vg,S);function nn(c){const f=Dr();H(f,new vg(f,c))}Nt.Ja="timingevent";function Eg(c,f){S.call(this,Nt.Ja,c),this.size=f}d(Eg,S);function Jo(c,f){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},f)}function Zo(){this.g=!0}Zo.prototype.ua=function(){this.g=!1};function dR(c,f,m,y,O,M){c.info(function(){if(c.g)if(M){var Z="",Re=M.split("&");for(let et=0;et<Re.length;et++){var bt=Re[et].split("=");if(bt.length>1){const kt=bt[0];bt=bt[1];const Jn=kt.split("_");Z=Jn.length>=2&&Jn[1]=="type"?Z+(kt+"="+bt+"&"):Z+(kt+"=redacted&")}}}else Z=null;else Z=M;return"XMLHTTP REQ ("+y+") [attempt "+O+"]: "+f+`
`+m+`
`+Z})}function fR(c,f,m,y,O,M,Z){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+O+"]: "+f+`
`+m+`
`+M+" "+Z})}function xi(c,f,m,y){c.info(function(){return"XMLHTTP TEXT ("+f+"): "+mR(c,m)+(y?" "+y:"")})}function pR(c,f){c.info(function(){return"TIMEOUT: "+f})}Zo.prototype.info=function(){};function mR(c,f){if(!c.g)return f;if(!f)return null;try{const M=JSON.parse(f);if(M){for(c=0;c<M.length;c++)if(Array.isArray(M[c])){var m=M[c];if(!(m.length<2)){var y=m[1];if(Array.isArray(y)&&!(y.length<1)){var O=y[0];if(O!="noop"&&O!="stop"&&O!="close")for(let Z=1;Z<y.length;Z++)y[Z]=""}}}}return Ue(M)}catch{return f}}var oc={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ig={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Tg;function Zh(){}d(Zh,gn),Zh.prototype.g=function(){return new XMLHttpRequest},Tg=new Zh;function ea(c){return encodeURIComponent(String(c))}function gR(c){var f=1;c=c.split(":");const m=[];for(;f>0&&c.length;)m.push(c.shift()),f--;return c.length&&m.push(c.join(":")),m}function Ks(c,f,m,y){this.j=c,this.i=f,this.l=m,this.S=y||1,this.V=new ve(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new wg}function wg(){this.i=null,this.g="",this.h=!1}var bg={},ed={};function td(c,f,m){c.M=1,c.A=lc(Xn(f)),c.u=m,c.R=!0,Ag(c,null)}function Ag(c,f){c.F=Date.now(),ac(c),c.B=Xn(c.A);var m=c.B,y=c.S;Array.isArray(y)||(y=[String(y)]),Fg(m.i,"t",y),c.C=0,m=c.j.L,c.h=new wg,c.g=n_(c.j,m?f:null,!c.u),c.P>0&&(c.O=new pe(u(c.Y,c,c.g),c.P)),f=c.V,m=c.g,y=c.ba;var O="readystatechange";Array.isArray(O)||(O&&(ke[0]=O.toString()),O=ke);for(let M=0;M<O.length;M++){const Z=ne(m,O[M],y||f.handleEvent,!1,f.h||f);if(!Z)break;f.g[Z.key]=Z}f=c.J?tn(c.J):{},c.u?(c.v||(c.v="POST"),f["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,f)):(c.v="GET",c.g.ea(c.B,c.v,null,f)),Xo(),dR(c.i,c.v,c.B,c.l,c.S,c.u)}Ks.prototype.ba=function(c){c=c.target;const f=this.O;f&&zs(c)==3?f.j():this.Y(c)},Ks.prototype.Y=function(c){try{if(c==this.g)e:{const Re=zs(this.g),bt=this.g.ya(),et=this.g.ca();if(!(Re<3)&&(Re!=3||this.g&&(this.h.h||this.g.la()||Gg(this.g)))){this.K||Re!=4||bt==7||(bt==8||et<=0?Xo(3):Xo(2)),nd(this);var f=this.g.ca();this.X=f;var m=_R(this);if(this.o=f==200,fR(this.i,this.v,this.B,this.l,this.S,Re,f),this.o){if(this.U&&!this.L){t:{if(this.g){var y,O=this.g;if((y=O.g?O.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(y)){var M=y;break t}}M=null}if(c=M)xi(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,sd(this,c);else{this.o=!1,this.m=3,nn(12),Or(this),ta(this);break e}}if(this.R){c=!0;let kt;for(;!this.K&&this.C<m.length;)if(kt=yR(this,m),kt==ed){Re==4&&(this.m=4,nn(14),c=!1),xi(this.i,this.l,null,"[Incomplete Response]");break}else if(kt==bg){this.m=4,nn(15),xi(this.i,this.l,m,"[Invalid Chunk]"),c=!1;break}else xi(this.i,this.l,kt,null),sd(this,kt);if(Sg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Re!=4||m.length!=0||this.h.h||(this.m=1,nn(16),c=!1),this.o=this.o&&c,!c)xi(this.i,this.l,m,"[Invalid Chunked Response]"),Or(this),ta(this);else if(m.length>0&&!this.W){this.W=!0;var Z=this.j;Z.g==this&&Z.aa&&!Z.P&&(Z.j.info("Great, no buffering proxy detected. Bytes received: "+m.length),hd(Z),Z.P=!0,nn(11))}}else xi(this.i,this.l,m,null),sd(this,m);Re==4&&Or(this),this.o&&!this.K&&(Re==4?Jg(this.j,this):(this.o=!1,ac(this)))}else xR(this.g),f==400&&m.indexOf("Unknown SID")>0?(this.m=3,nn(12)):(this.m=0,nn(13)),Or(this),ta(this)}}}catch{}};function _R(c){if(!Sg(c))return c.g.la();const f=Gg(c.g);if(f==="")return"";let m="";const y=f.length,O=zs(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return Or(c),ta(c),"";c.h.i=new o.TextDecoder}for(let M=0;M<y;M++)c.h.h=!0,m+=c.h.i.decode(f[M],{stream:!(O&&M==y-1)});return f.length=0,c.h.g+=m,c.C=0,c.h.g}function Sg(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function yR(c,f){var m=c.C,y=f.indexOf(`
`,m);return y==-1?ed:(m=Number(f.substring(m,y)),isNaN(m)?bg:(y+=1,y+m>f.length?ed:(f=f.slice(y,y+m),c.C=y+m,f)))}Ks.prototype.cancel=function(){this.K=!0,Or(this)};function ac(c){c.T=Date.now()+c.H,Rg(c,c.H)}function Rg(c,f){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Jo(u(c.aa,c),f)}function nd(c){c.D&&(o.clearTimeout(c.D),c.D=null)}Ks.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(pR(this.i,this.B),this.M!=2&&(Xo(),nn(17)),Or(this),this.m=2,ta(this)):Rg(this,this.T-c)};function ta(c){c.j.I==0||c.K||Jg(c.j,c)}function Or(c){nd(c);var f=c.O;f&&typeof f.dispose=="function"&&f.dispose(),c.O=null,We(c.V),c.g&&(f=c.g,c.g=null,f.abort(),f.dispose())}function sd(c,f){try{var m=c.j;if(m.I!=0&&(m.g==c||rd(m.h,c))){if(!c.L&&rd(m.h,c)&&m.I==3){try{var y=m.Ba.g.parse(f)}catch{y=null}if(Array.isArray(y)&&y.length==3){var O=y;if(O[0]==0){e:if(!m.v){if(m.g)if(m.g.F+3e3<c.F)fc(m),hc(m);else break e;ud(m),nn(18)}}else m.xa=O[1],0<m.xa-m.K&&O[2]<37500&&m.F&&m.A==0&&!m.C&&(m.C=Jo(u(m.Va,m),6e3));Ng(m.h)<=1&&m.ta&&(m.ta=void 0)}else Mr(m,11)}else if((c.L||m.g==c)&&fc(m),!T(f))for(O=m.Ba.g.parse(f),f=0;f<O.length;f++){let et=O[f];const kt=et[0];if(!(kt<=m.K))if(m.K=kt,et=et[1],m.I==2)if(et[0]=="c"){m.M=et[1],m.ba=et[2];const Jn=et[3];Jn!=null&&(m.ka=Jn,m.j.info("VER="+m.ka));const Lr=et[4];Lr!=null&&(m.za=Lr,m.j.info("SVER="+m.za));const Ws=et[5];Ws!=null&&typeof Ws=="number"&&Ws>0&&(y=1.5*Ws,m.O=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const Qs=c.g;if(Qs){const mc=Qs.g?Qs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(mc){var M=y.h;M.g||mc.indexOf("spdy")==-1&&mc.indexOf("quic")==-1&&mc.indexOf("h2")==-1||(M.j=M.l,M.g=new Set,M.h&&(id(M,M.h),M.h=null))}if(y.G){const dd=Qs.g?Qs.g.getResponseHeader("X-HTTP-Session-Id"):null;dd&&(y.wa=dd,lt(y.J,y.G,dd))}}m.I=3,m.l&&m.l.ra(),m.aa&&(m.T=Date.now()-c.F,m.j.info("Handshake RTT: "+m.T+"ms")),y=m;var Z=c;if(y.na=t_(y,y.L?y.ba:null,y.W),Z.L){kg(y.h,Z);var Re=Z,bt=y.O;bt&&(Re.H=bt),Re.D&&(nd(Re),ac(Re)),y.g=Z}else Yg(y);m.i.length>0&&dc(m)}else et[0]!="stop"&&et[0]!="close"||Mr(m,7);else m.I==3&&(et[0]=="stop"||et[0]=="close"?et[0]=="stop"?Mr(m,7):cd(m):et[0]!="noop"&&m.l&&m.l.qa(et),m.A=0)}}Xo(4)}catch{}}var vR=class{constructor(c,f){this.g=c,this.map=f}};function Cg(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Pg(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ng(c){return c.h?1:c.g?c.g.size:0}function rd(c,f){return c.h?c.h==f:c.g?c.g.has(f):!1}function id(c,f){c.g?c.g.add(f):c.h=f}function kg(c,f){c.h&&c.h==f?c.h=null:c.g&&c.g.has(f)&&c.g.delete(f)}Cg.prototype.cancel=function(){if(this.i=xg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function xg(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let f=c.i;for(const m of c.g.values())f=f.concat(m.G);return f}return g(c.i)}var Dg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ER(c,f){if(c){c=c.split("&");for(let m=0;m<c.length;m++){const y=c[m].indexOf("=");let O,M=null;y>=0?(O=c[m].substring(0,y),M=c[m].substring(y+1)):O=c[m],f(O,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Gs(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let f;c instanceof Gs?(this.l=c.l,na(this,c.j),this.o=c.o,this.g=c.g,sa(this,c.u),this.h=c.h,od(this,Ug(c.i)),this.m=c.m):c&&(f=String(c).match(Dg))?(this.l=!1,na(this,f[1]||"",!0),this.o=ra(f[2]||""),this.g=ra(f[3]||"",!0),sa(this,f[4]),this.h=ra(f[5]||"",!0),od(this,f[6]||"",!0),this.m=ra(f[7]||"")):(this.l=!1,this.i=new oa(null,this.l))}Gs.prototype.toString=function(){const c=[];var f=this.j;f&&c.push(ia(f,Og,!0),":");var m=this.g;return(m||f=="file")&&(c.push("//"),(f=this.o)&&c.push(ia(f,Og,!0),"@"),c.push(ea(m).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.u,m!=null&&c.push(":",String(m))),(m=this.h)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(ia(m,m.charAt(0)=="/"?wR:TR,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",ia(m,AR)),c.join("")},Gs.prototype.resolve=function(c){const f=Xn(this);let m=!!c.j;m?na(f,c.j):m=!!c.o,m?f.o=c.o:m=!!c.g,m?f.g=c.g:m=c.u!=null;var y=c.h;if(m)sa(f,c.u);else if(m=!!c.h){if(y.charAt(0)!="/")if(this.g&&!this.h)y="/"+y;else{var O=f.h.lastIndexOf("/");O!=-1&&(y=f.h.slice(0,O+1)+y)}if(O=y,O==".."||O==".")y="";else if(O.indexOf("./")!=-1||O.indexOf("/.")!=-1){y=O.lastIndexOf("/",0)==0,O=O.split("/");const M=[];for(let Z=0;Z<O.length;){const Re=O[Z++];Re=="."?y&&Z==O.length&&M.push(""):Re==".."?((M.length>1||M.length==1&&M[0]!="")&&M.pop(),y&&Z==O.length&&M.push("")):(M.push(Re),y=!0)}y=M.join("/")}else y=O}return m?f.h=y:m=c.i.toString()!=="",m?od(f,Ug(c.i)):m=!!c.m,m&&(f.m=c.m),f};function Xn(c){return new Gs(c)}function na(c,f,m){c.j=m?ra(f,!0):f,c.j&&(c.j=c.j.replace(/:$/,""))}function sa(c,f){if(f){if(f=Number(f),isNaN(f)||f<0)throw Error("Bad port number "+f);c.u=f}else c.u=null}function od(c,f,m){f instanceof oa?(c.i=f,SR(c.i,c.l)):(m||(f=ia(f,bR)),c.i=new oa(f,c.l))}function lt(c,f,m){c.i.set(f,m)}function lc(c){return lt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function ra(c,f){return c?f?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function ia(c,f,m){return typeof c=="string"?(c=encodeURI(c).replace(f,IR),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function IR(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Og=/[#\/\?@]/g,TR=/[#\?:]/g,wR=/[#\?]/g,bR=/[#\?@]/g,AR=/#/g;function oa(c,f){this.h=this.g=null,this.i=c||null,this.j=!!f}function Vr(c){c.g||(c.g=new Map,c.h=0,c.i&&ER(c.i,function(f,m){c.add(decodeURIComponent(f.replace(/\+/g," ")),m)}))}n=oa.prototype,n.add=function(c,f){Vr(this),this.i=null,c=Di(this,c);let m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(f),this.h+=1,this};function Vg(c,f){Vr(c),f=Di(c,f),c.g.has(f)&&(c.i=null,c.h-=c.g.get(f).length,c.g.delete(f))}function Mg(c,f){return Vr(c),f=Di(c,f),c.g.has(f)}n.forEach=function(c,f){Vr(this),this.g.forEach(function(m,y){m.forEach(function(O){c.call(f,O,y,this)},this)},this)};function Lg(c,f){Vr(c);let m=[];if(typeof f=="string")Mg(c,f)&&(m=m.concat(c.g.get(Di(c,f))));else for(c=Array.from(c.g.values()),f=0;f<c.length;f++)m=m.concat(c[f]);return m}n.set=function(c,f){return Vr(this),this.i=null,c=Di(this,c),Mg(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[f]),this.h+=1,this},n.get=function(c,f){return c?(c=Lg(this,c),c.length>0?String(c[0]):f):f};function Fg(c,f,m){Vg(c,f),m.length>0&&(c.i=null,c.g.set(Di(c,f),g(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],f=Array.from(this.g.keys());for(let y=0;y<f.length;y++){var m=f[y];const O=ea(m);m=Lg(this,m);for(let M=0;M<m.length;M++){let Z=O;m[M]!==""&&(Z+="="+ea(m[M])),c.push(Z)}}return this.i=c.join("&")};function Ug(c){const f=new oa;return f.i=c.i,c.g&&(f.g=new Map(c.g),f.h=c.h),f}function Di(c,f){return f=String(f),c.j&&(f=f.toLowerCase()),f}function SR(c,f){f&&!c.j&&(Vr(c),c.i=null,c.g.forEach(function(m,y){const O=y.toLowerCase();y!=O&&(Vg(this,y),Fg(this,O,m))},c)),c.j=f}function RR(c,f){const m=new Zo;if(o.Image){const y=new Image;y.onload=h(Hs,m,"TestLoadImage: loaded",!0,f,y),y.onerror=h(Hs,m,"TestLoadImage: error",!1,f,y),y.onabort=h(Hs,m,"TestLoadImage: abort",!1,f,y),y.ontimeout=h(Hs,m,"TestLoadImage: timeout",!1,f,y),o.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else f(!1)}function CR(c,f){const m=new Zo,y=new AbortController,O=setTimeout(()=>{y.abort(),Hs(m,"TestPingServer: timeout",!1,f)},1e4);fetch(c,{signal:y.signal}).then(M=>{clearTimeout(O),M.ok?Hs(m,"TestPingServer: ok",!0,f):Hs(m,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(O),Hs(m,"TestPingServer: error",!1,f)})}function Hs(c,f,m,y,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),y(m)}catch{}}function PR(){this.g=new jt}function ad(c){this.i=c.Sb||null,this.h=c.ab||!1}d(ad,gn),ad.prototype.g=function(){return new cc(this.i,this.h)};function cc(c,f){z.call(this),this.H=c,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(cc,z),n=cc.prototype,n.open=function(c,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=f,this.readyState=1,la(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const f={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(f.body=c),(this.H||o).fetch(new Request(this.D,f)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,aa(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,la(this)),this.g&&(this.readyState=3,la(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Bg(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Bg(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var f=c.value?c.value:new Uint8Array(0);(f=this.B.decode(f,{stream:!c.done}))&&(this.response=this.responseText+=f)}c.done?aa(this):la(this),this.readyState==3&&Bg(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,aa(this))},n.Na=function(c){this.g&&(this.response=c,aa(this))},n.ga=function(){this.g&&aa(this)};function aa(c){c.readyState=4,c.l=null,c.j=null,c.B=null,la(c)}n.setRequestHeader=function(c,f){this.A.append(c,f)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],f=this.h.entries();for(var m=f.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=f.next();return c.join(`\r
`)};function la(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(cc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function $g(c){let f="";return Vt(c,function(m,y){f+=y,f+=":",f+=m,f+=`\r
`}),f}function ld(c,f,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=$g(m),typeof c=="string"?m!=null&&ea(m):lt(c,f,m))}function ft(c){z.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(ft,z);var NR=/^https?$/i,kR=["POST","PUT"];n=ft.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,f,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);f=f?f.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Tg.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(f,String(c),!0),this.B=!1}catch(M){qg(this,M);return}if(c=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var O in y)m.set(O,y[O]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const M of y.keys())m.set(M,y.get(M));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(M=>M.toLowerCase()=="content-type"),O=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(kR,f,void 0)>=0)||y||O||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[M,Z]of m)this.g.setRequestHeader(M,Z);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(M){qg(this,M)}};function qg(c,f){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=f,c.o=5,jg(c),uc(c)}function jg(c){c.A||(c.A=!0,H(c,"complete"),H(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,H(this,"complete"),H(this,"abort"),uc(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),uc(this,!0)),ft.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Kg(this):this.Xa())},n.Xa=function(){Kg(this)};function Kg(c){if(c.h&&typeof i<"u"){if(c.v&&zs(c)==4)setTimeout(c.Ca.bind(c),0);else if(H(c,"readystatechange"),zs(c)==4){c.h=!1;try{const M=c.ca();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var m;if(!(m=f)){var y;if(y=M===0){let Z=String(c.D).match(Dg)[1]||null;!Z&&o.self&&o.self.location&&(Z=o.self.location.protocol.slice(0,-1)),y=!NR.test(Z?Z.toLowerCase():"")}m=y}if(m)H(c,"complete"),H(c,"success");else{c.o=6;try{var O=zs(c)>2?c.g.statusText:""}catch{O=""}c.l=O+" ["+c.ca()+"]",jg(c)}}finally{uc(c)}}}}function uc(c,f){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const m=c.g;c.g=null,f||H(c,"ready");try{m.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function zs(c){return c.g?c.g.readyState:0}n.ca=function(){try{return zs(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var f=this.g.responseText;return c&&f.indexOf(c)==0&&(f=f.substring(c.length)),qt(f)}};function Gg(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function xR(c){const f={};c=(c.g&&zs(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(T(c[y]))continue;var m=gR(c[y]);const O=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const M=f[O]||[];f[O]=M,M.push(m)}Sn(f,function(y){return y.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ca(c,f,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||f}function Hg(c){this.za=0,this.i=[],this.j=new Zo,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ca("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ca("baseRetryDelayMs",5e3,c),this.Za=ca("retryDelaySeedMs",1e4,c),this.Ta=ca("forwardChannelMaxRetries",2,c),this.va=ca("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Cg(c&&c.concurrentRequestLimit),this.Ba=new PR,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Hg.prototype,n.ka=8,n.I=1,n.connect=function(c,f,m,y){nn(0),this.W=c,this.H=f||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.J=t_(this,null,this.W),dc(this)};function cd(c){if(zg(c),c.I==3){var f=c.V++,m=Xn(c.J);if(lt(m,"SID",c.M),lt(m,"RID",f),lt(m,"TYPE","terminate"),ua(c,m),f=new Ks(c,c.j,f),f.M=2,f.A=lc(Xn(m)),m=!1,o.navigator&&o.navigator.sendBeacon)try{m=o.navigator.sendBeacon(f.A.toString(),"")}catch{}!m&&o.Image&&(new Image().src=f.A,m=!0),m||(f.g=n_(f.j,null),f.g.ea(f.A)),f.F=Date.now(),ac(f)}e_(c)}function hc(c){c.g&&(hd(c),c.g.cancel(),c.g=null)}function zg(c){hc(c),c.v&&(o.clearTimeout(c.v),c.v=null),fc(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function dc(c){if(!Pg(c.h)&&!c.m){c.m=!0;var f=c.Ea;q||v(),Y||(q(),Y=!0),I.add(f,c),c.D=0}}function DR(c,f){return Ng(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=f.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Jo(u(c.Ea,c,f),Zg(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const O=new Ks(this,this.j,c);let M=this.o;if(this.U&&(M?(M=tn(M),oe(M,this.U)):M=this.U),this.u!==null||this.R||(O.J=M,M=null),this.S)e:{for(var f=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(f+=y,f>4096){f=m;break e}if(f===4096||m===this.i.length-1){f=m+1;break e}}f=1e3}else f=1e3;f=Qg(this,O,f),m=Xn(this.J),lt(m,"RID",c),lt(m,"CVER",22),this.G&&lt(m,"X-HTTP-Session-Id",this.G),ua(this,m),M&&(this.R?f="headers="+ea($g(M))+"&"+f:this.u&&ld(m,this.u,M)),id(this.h,O),this.Ra&&lt(m,"TYPE","init"),this.S?(lt(m,"$req",f),lt(m,"SID","null"),O.U=!0,td(O,m,null)):td(O,m,f),this.I=2}}else this.I==3&&(c?Wg(this,c):this.i.length==0||Pg(this.h)||Wg(this))};function Wg(c,f){var m;f?m=f.l:m=c.V++;const y=Xn(c.J);lt(y,"SID",c.M),lt(y,"RID",m),lt(y,"AID",c.K),ua(c,y),c.u&&c.o&&ld(y,c.u,c.o),m=new Ks(c,c.j,m,c.D+1),c.u===null&&(m.J=c.o),f&&(c.i=f.G.concat(c.i)),f=Qg(c,m,1e3),m.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),id(c.h,m),td(m,y,f)}function ua(c,f){c.H&&Vt(c.H,function(m,y){lt(f,y,m)}),c.l&&Vt({},function(m,y){lt(f,y,m)})}function Qg(c,f,m){m=Math.min(c.i.length,m);const y=c.l?u(c.l.Ka,c.l,c):null;e:{var O=c.i;let Re=-1;for(;;){const bt=["count="+m];Re==-1?m>0?(Re=O[0].g,bt.push("ofs="+Re)):Re=0:bt.push("ofs="+Re);let et=!0;for(let kt=0;kt<m;kt++){var M=O[kt].g;const Jn=O[kt].map;if(M-=Re,M<0)Re=Math.max(0,O[kt].g-100),et=!1;else try{M="req"+M+"_"||"";try{var Z=Jn instanceof Map?Jn:Object.entries(Jn);for(const[Lr,Ws]of Z){let Qs=Ws;a(Ws)&&(Qs=Ue(Ws)),bt.push(M+Lr+"="+encodeURIComponent(Qs))}}catch(Lr){throw bt.push(M+"type="+encodeURIComponent("_badmap")),Lr}}catch{y&&y(Jn)}}if(et){Z=bt.join("&");break e}}Z=void 0}return c=c.i.splice(0,m),f.G=c,Z}function Yg(c){if(!c.g&&!c.v){c.Y=1;var f=c.Da;q||v(),Y||(q(),Y=!0),I.add(f,c),c.A=0}}function ud(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Jo(u(c.Da,c),Zg(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,Xg(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Jo(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,nn(10),hc(this),Xg(this))};function hd(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function Xg(c){c.g=new Ks(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var f=Xn(c.na);lt(f,"RID","rpc"),lt(f,"SID",c.M),lt(f,"AID",c.K),lt(f,"CI",c.F?"0":"1"),!c.F&&c.ia&&lt(f,"TO",c.ia),lt(f,"TYPE","xmlhttp"),ua(c,f),c.u&&c.o&&ld(f,c.u,c.o),c.O&&(c.g.H=c.O);var m=c.g;c=c.ba,m.M=1,m.A=lc(Xn(f)),m.u=null,m.R=!0,Ag(m,c)}n.Va=function(){this.C!=null&&(this.C=null,hc(this),ud(this),nn(19))};function fc(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Jg(c,f){var m=null;if(c.g==f){fc(c),hd(c),c.g=null;var y=2}else if(rd(c.h,f))m=f.G,kg(c.h,f),y=1;else return;if(c.I!=0){if(f.o)if(y==1){m=f.u?f.u.length:0,f=Date.now()-f.F;var O=c.D;y=Dr(),H(y,new Eg(y,m)),dc(c)}else Yg(c);else if(O=f.m,O==3||O==0&&f.X>0||!(y==1&&DR(c,f)||y==2&&ud(c)))switch(m&&m.length>0&&(f=c.h,f.i=f.i.concat(m)),O){case 1:Mr(c,5);break;case 4:Mr(c,10);break;case 3:Mr(c,6);break;default:Mr(c,2)}}}function Zg(c,f){let m=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(m*=2),m*f}function Mr(c,f){if(c.j.info("Error code "+f),f==2){var m=u(c.bb,c),y=c.Ua;const O=!y;y=new Gs(y||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||na(y,"https"),lc(y),O?RR(y.toString(),m):CR(y.toString(),m)}else nn(2);c.I=0,c.l&&c.l.pa(f),e_(c),zg(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),nn(2)):(this.j.info("Failed to ping google.com"),nn(1))};function e_(c){if(c.I=0,c.ja=[],c.l){const f=xg(c.h);(f.length!=0||c.i.length!=0)&&(b(c.ja,f),b(c.ja,c.i),c.h.i.length=0,g(c.i),c.i.length=0),c.l.oa()}}function t_(c,f,m){var y=m instanceof Gs?Xn(m):new Gs(m);if(y.g!="")f&&(y.g=f+"."+y.g),sa(y,y.u);else{var O=o.location;y=O.protocol,f=f?f+"."+O.hostname:O.hostname,O=+O.port;const M=new Gs(null);y&&na(M,y),f&&(M.g=f),O&&sa(M,O),m&&(M.h=m),y=M}return m=c.G,f=c.wa,m&&f&&lt(y,m,f),lt(y,"VER",c.ka),ua(c,y),y}function n_(c,f,m){if(f&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return f=c.Aa&&!c.ma?new ft(new ad({ab:m})):new ft(c.ma),f.Fa(c.L),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function s_(){}n=s_.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function pc(){}pc.prototype.g=function(c,f){return new yn(c,f)};function yn(c,f){z.call(this),this.g=new Hg(f),this.l=c,this.h=f&&f.messageUrlParams||null,c=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(c?c["X-WebChannel-Content-Type"]=f.messageContentType:c={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.sa&&(c?c["X-WebChannel-Client-Profile"]=f.sa:c={"X-WebChannel-Client-Profile":f.sa}),this.g.U=c,(c=f&&f.Qb)&&!T(c)&&(this.g.u=c),this.A=f&&f.supportsCrossDomainXhr||!1,this.v=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!T(f)&&(this.g.G=f,c=this.h,c!==null&&f in c&&(c=this.h,f in c&&delete c[f])),this.j=new Oi(this)}d(yn,z),yn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},yn.prototype.close=function(){cd(this.g)},yn.prototype.o=function(c){var f=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.v&&(m={},m.__data__=Ue(c),c=m);f.i.push(new vR(f.Ya++,c)),f.I==3&&dc(f)},yn.prototype.N=function(){this.g.l=null,delete this.j,cd(this.g),delete this.g,yn.Z.N.call(this)};function r_(c){ki.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var f=c.__sm__;if(f){e:{for(const m in f){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,f=f!==null&&c in f?f[c]:void 0),this.data=f}else this.data=c}d(r_,ki);function i_(){Mt.call(this),this.status=1}d(i_,Mt);function Oi(c){this.g=c}d(Oi,s_),Oi.prototype.ra=function(){H(this.g,"a")},Oi.prototype.qa=function(c){H(this.g,new r_(c))},Oi.prototype.pa=function(c){H(this.g,new i_)},Oi.prototype.oa=function(){H(this.g,"b")},pc.prototype.createWebChannel=pc.prototype.g,yn.prototype.send=yn.prototype.o,yn.prototype.open=yn.prototype.m,yn.prototype.close=yn.prototype.close,pb=function(){return new pc},fb=function(){return Dr()},db=Nt,Nf={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},oc.NO_ERROR=0,oc.TIMEOUT=8,oc.HTTP_ERROR=6,$c=oc,Ig.COMPLETE="complete",hb=Ig,_n.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",z.prototype.listen=z.prototype.J,Pa=_n,ft.prototype.listenOnce=ft.prototype.K,ft.prototype.getLastError=ft.prototype.Ha,ft.prototype.getLastErrorCode=ft.prototype.ya,ft.prototype.getStatus=ft.prototype.ca,ft.prototype.getResponseJson=ft.prototype.La,ft.prototype.getResponseText=ft.prototype.la,ft.prototype.send=ft.prototype.ea,ft.prototype.setWithCredentials=ft.prototype.Fa,ub=ft}).apply(typeof Tc<"u"?Tc:typeof self<"u"?self:typeof window<"u"?window:{});const Yy="@firebase/firestore",Xy="4.9.3";class on{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}on.UNAUTHENTICATED=new on(null),on.GOOGLE_CREDENTIALS=new on("google-credentials-uid"),on.FIRST_PARTY=new on("first-party-uid"),on.MOCK_USER=new on("mock-user");let Go="12.7.0";const mi=new _h("@firebase/firestore");function Ki(){return mi.logLevel}function Q(n,...e){if(mi.logLevel<=xe.DEBUG){const t=e.map(Im);mi.debug(`Firestore (${Go}): ${n}`,...t)}}function ln(n,...e){if(mi.logLevel<=xe.ERROR){const t=e.map(Im);mi.error(`Firestore (${Go}): ${n}`,...t)}}function vl(n,...e){if(mi.logLevel<=xe.WARN){const t=e.map(Im);mi.warn(`Firestore (${Go}): ${n}`,...t)}}function Im(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function ue(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,mb(n,s,t)}function mb(n,e,t){let s=`FIRESTORE (${Go}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw ln(s),new Error(s)}function de(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||mb(e,r,s)}function be(n,e){return n}const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class le extends $s{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ps{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ZO{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class eV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(on.UNAUTHENTICATED)))}shutdown(){}}class tV{constructor(e){this.t=e,this.currentUser=on.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){de(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new Ps;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ps,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},a=l=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ps)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(de(typeof s.accessToken=="string",31837,{l:s}),new ZO(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return de(e===null||typeof e=="string",2055,{h:e}),new on(e)}}class nV{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=on.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class sV{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new nV(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(on.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Jy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rV{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Rn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){de(this.o===void 0,3512);const s=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Jy(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(de(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Jy(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function iV(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Tm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=iV(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function we(n,e){return n<e?-1:n>e?1:0}function kf(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return Ld(r)===Ld(i)?we(r,i):Ld(r)?1:-1}return we(n.length,e.length)}const oV=55296,aV=57343;function Ld(n){const e=n.charCodeAt(0);return e>=oV&&e<=aV}function wo(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}function gb(n){return n+"\0"}const Zy="__name__";class ts{constructor(e,t,s){t===void 0?t=0:t>e.length&&ue(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&ue(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return ts.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ts?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=ts.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return we(e.length,t.length)}static compareSegments(e,t){const s=ts.isNumericId(e),r=ts.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?ts.extractNumericId(e).compare(ts.extractNumericId(t)):kf(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return gr.fromString(e.substring(4,e.length-2))}}class Je extends ts{construct(e,t,s){return new Je(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new le(j.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Je(t)}static emptyPath(){return new Je([])}}const lV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dt extends ts{construct(e,t,s){return new dt(e,t,s)}static isValidIdentifier(e){return lV.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Zy}static keyField(){return new dt([Zy])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new le(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new le(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new le(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new le(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new dt(t)}static emptyPath(){return new dt([])}}class se{constructor(e){this.path=e}static fromPath(e){return new se(Je.fromString(e))}static fromName(e){return new se(Je.fromString(e).popFirst(5))}static empty(){return new se(Je.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Je.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Je.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new Je(e.slice()))}}function cV(n,e,t){if(!t)throw new le(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function uV(n,e,t,s){if(e===!0&&s===!0)throw new le(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ev(n){if(!se.isDocumentKey(n))throw new le(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _b(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function wm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ue(12329,{type:typeof n})}function _r(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new le(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=wm(n);throw new le(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Et(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ql(n,e){if(!_b(n))throw new le(j.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new le(j.INVALID_ARGUMENT,t);return!0}const tv=-62135596800,nv=1e6;class Qe{static now(){return Qe.fromMillis(Date.now())}static fromDate(e){return Qe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*nv);return new Qe(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new le(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new le(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<tv)throw new le(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new le(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/nv}_compareTo(e){return this.seconds===e.seconds?we(this.nanoseconds,e.nanoseconds):we(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ql(e,Qe._jsonSchema))return new Qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-tv;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qe._jsonSchemaVersion="firestore/timestamp/1.0",Qe._jsonSchema={type:Et("string",Qe._jsonSchemaVersion),seconds:Et("number"),nanoseconds:Et("number")};class ge{static fromTimestamp(e){return new ge(e)}static min(){return new ge(new Qe(0,0))}static max(){return new ge(new Qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const El=-1;class xu{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function xf(n){return n.fields.find((e=>e.kind===2))}function Kr(n){return n.fields.filter((e=>e.kind!==2))}xu.UNKNOWN_ID=-1;class qc{constructor(e,t){this.fieldPath=e,this.kind=t}}class Il{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Il(0,An.min())}}function hV(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=ge.fromTimestamp(s===1e9?new Qe(t+1,0):new Qe(t,s));return new An(r,se.empty(),e)}function yb(n){return new An(n.readTime,n.key,El)}class An{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new An(ge.min(),se.empty(),El)}static max(){return new An(ge.max(),se.empty(),El)}}function bm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=se.comparator(n.documentKey,e.documentKey),t!==0?t:we(n.largestBatchId,e.largestBatchId))}const vb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Eb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ri(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==vb)throw n;Q("LocalStore","Unexpectedly lost primary lease")}class x{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new x(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof x?t:x.resolve(t)}catch(t){return x.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):x.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):x.reject(t)}static resolve(e){return new x(((t,s)=>{t(e)}))}static reject(e){return new x(((t,s)=>{s(e)}))}static waitFor(e){return new x(((t,s)=>{let r=0,i=0,o=!1;e.forEach((a=>{++r,a.next((()=>{++i,o&&i===r&&t()}),(l=>s(l)))})),o=!0,i===r&&t()}))}static or(e){let t=x.resolve(!1);for(const s of e)t=t.next((r=>r?x.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new x(((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new x(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}const In="SimpleDb";class Ph{static open(e,t,s,r){try{return new Ph(t,e.transaction(r,s))}catch(i){throw new Wa(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Ps,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Wa(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=Am(s.target.error);this.S.reject(new Wa(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Q(In,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new fV(t)}}class yr{static delete(e){return Q(In,"Removing database:",e),Hr(tT().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!uT())return!1;if(yr.F())return!0;const e=Ct(),t=yr.M(e),s=0<t&&t<10,r=Ib(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,yr.M(Ct())===12.2&&ln("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Q(In,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{s(new Wa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new le(j.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new le(j.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Wa(e,o))},r.onupgradeneeded=i=>{Q(In,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,r.transaction,i.oldVersion,this.version).next((()=>{Q(In,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Ph.open(this.db,e,i?"readonly":"readwrite",s),l=r(a).next((u=>(a.C(),u))).catch((u=>(a.abort(u),x.reject(u)))).toPromise();return l.catch((()=>{})),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(Q(In,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Ib(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class dV{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Hr(this.U.delete())}}class Wa extends le{constructor(e,t){super(j.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Pr(n){return n.name==="IndexedDbTransactionError"}class fV{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(Q(In,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(Q(In,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),Hr(s)}add(e){return Q(In,"ADD",this.store.name,e,e),Hr(this.store.add(e))}get(e){return Hr(this.store.get(e)).next((t=>(t===void 0&&(t=null),Q(In,"GET",this.store.name,e,t),t)))}delete(e){return Q(In,"DELETE",this.store.name,e),Hr(this.store.delete(e))}count(){return Q(In,"COUNT",this.store.name),Hr(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new x(((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(s),o=[];return this.H(i,((a,l)=>{o.push(l)})).next((()=>o))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new x(((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}}))}Z(e,t){Q(In,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,((i,o,a)=>a.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new x(((s,r)=>{t.onerror=i=>{const o=Am(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((a=>{a?o.continue():s()})):s()}}))}H(e,t){const s=[];return new x(((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new dV(a),u=t(a.primaryKey,a.value,l);if(u instanceof x){const h=u.catch((d=>(l.done(),x.reject(d))));s.push(h)}l.isDone?r():l.G===null?a.continue():a.continue(l.G)}})).next((()=>x.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Hr(n){return new x(((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=Am(s.target.error);t(r)}}))}let sv=!1;function Am(n){const e=yr.M(Ct());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new le("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sv||(sv=!0,setTimeout((()=>{throw s}),0)),s}}return n}const Qa="IndexBackfiller";class pV{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Q(Qa,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();Q(Qa,`Documents written: ${t}`)}catch(t){Pr(t)?Q(Qa,"Ignoring IndexedDB error during index backfill: ",t):await Ri(t)}await this.re(6e4)}))}}class mV{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let r=t,i=!0;return x.doWhile((()=>i===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!s.has(o))return Q(Qa,`Processing collection: ${o}`),this.oe(e,o,r).next((a=>{r-=a,s.add(o)}));i=!1})))).next((()=>t-r))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(r,i))).next((a=>(Q(Qa,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a)))).next((()=>o.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((r,i)=>{const o=yb(i);bm(o,s)>0&&(s=o)})),new An(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Pn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Pn.ce=-1;const ri=-1;function Nh(n){return n==null}function Tl(n){return n===0&&1/n==-1/0}function gV(n){return typeof n=="number"&&Number.isInteger(n)&&!Tl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Du="";function Jt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=rv(e)),e=_V(n.get(t),e);return rv(e)}function _V(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case Du:t+="";break;default:t+=i}}return t}function rv(n){return n+Du+""}function rs(n){const e=n.length;if(de(e>=2,64408,{path:n}),e===2)return de(n.charAt(0)===Du&&n.charAt(1)==="",56145,{path:n}),Je.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf(Du,i);switch((o<0||o>t)&&ue(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;r.length===0?l=a:(r+=a,l=r,r=""),s.push(l);break;case"":r+=n.substring(i,o),r+="\0";break;case"":r+=n.substring(i,o+1);break;default:ue(61167,{path:n})}i=o+2}return new Je(s)}const Gr="remoteDocuments",Yl="owner",Li="owner",wl="mutationQueues",yV="userId",Mn="mutations",iv="batchId",Jr="userMutationsIndex",ov=["userId","batchId"];function jc(n,e){return[n,Jt(e)]}function Tb(n,e,t){return[n,Jt(e),t]}const vV={},bo="documentMutations",Ou="remoteDocumentsV14",EV=["prefixPath","collectionGroup","readTime","documentId"],Kc="documentKeyIndex",IV=["prefixPath","collectionGroup","documentId"],wb="collectionGroupIndex",TV=["collectionGroup","readTime","prefixPath","documentId"],bl="remoteDocumentGlobal",Df="remoteDocumentGlobalKey",Ao="targets",bb="queryTargetsIndex",wV=["canonicalId","targetId"],So="targetDocuments",bV=["targetId","path"],Sm="documentTargetsIndex",AV=["path","targetId"],Vu="targetGlobalKey",ii="targetGlobal",Al="collectionParents",SV=["collectionId","parent"],Ro="clientMetadata",RV="clientId",kh="bundles",CV="bundleId",xh="namedQueries",PV="name",Rm="indexConfiguration",NV="indexId",Of="collectionGroupIndex",kV="collectionGroup",Ya="indexState",xV=["indexId","uid"],Ab="sequenceNumberIndex",DV=["uid","sequenceNumber"],Xa="indexEntries",OV=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Sb="documentKeyIndex",VV=["indexId","uid","orderedDocumentKey"],Dh="documentOverlays",MV=["userId","collectionPath","documentId"],Vf="collectionPathOverlayIndex",LV=["userId","collectionPath","largestBatchId"],Rb="collectionGroupOverlayIndex",FV=["userId","collectionGroup","largestBatchId"],Cm="globals",UV="name",Cb=[wl,Mn,bo,Gr,Ao,Yl,ii,So,Ro,bl,Al,kh,xh],BV=[...Cb,Dh],Pb=[wl,Mn,bo,Ou,Ao,Yl,ii,So,Ro,bl,Al,kh,xh,Dh],Nb=Pb,Pm=[...Nb,Rm,Ya,Xa],$V=Pm,kb=[...Pm,Cm],qV=kb;class Mf extends Eb{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Pt(n,e){const t=be(n);return yr.O(t.le,e)}function av(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ci(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function xb(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ht{constructor(e,t){this.comparator=e,this.root=t||Lt.EMPTY}insert(e,t){return new ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Lt.BLACK,null,null))}remove(e){return new ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Lt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wc(this.root,e,this.comparator,!1)}getReverseIterator(){return new wc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wc(this.root,e,this.comparator,!0)}}class wc{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Lt{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Lt.RED,this.left=r??Lt.EMPTY,this.right=i??Lt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Lt(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Lt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Lt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Lt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Lt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ue(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ue(27949);return e+(this.isRed()?0:1)}}Lt.EMPTY=null,Lt.RED=!0,Lt.BLACK=!1;Lt.EMPTY=new class{constructor(){this.size=0}get key(){throw ue(57766)}get value(){throw ue(16141)}get color(){throw ue(16727)}get left(){throw ue(29726)}get right(){throw ue(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Lt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ye{constructor(e){this.comparator=e,this.data=new ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new lv(this.data.getIterator())}getIteratorFrom(e){return new lv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ye)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ye(this.comparator);return t.data=e,t}}class lv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Fi(n){return n.hasNext()?n.getNext():void 0}class Nn{constructor(e){this.fields=e,e.sort(dt.comparator)}static empty(){return new Nn([])}unionWith(e){let t=new Ye(dt.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Nn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wo(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class Db extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Tt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Db("Invalid base64 string: "+i):i}})(e);return new Tt(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new Tt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return we(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Tt.EMPTY_BYTE_STRING=new Tt("");const jV=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fs(n){if(de(!!n,39018),typeof n=="string"){let e=0;const t=jV.exec(n);if(de(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ut(n.seconds),nanos:ut(n.nanos)}}function ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Us(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}const Ob="server_timestamp",Vb="__type__",Mb="__previous_value__",Lb="__local_write_time__";function Nm(n){return(n?.mapValue?.fields||{})[Vb]?.stringValue===Ob}function Oh(n){const e=n.mapValue.fields[Mb];return Nm(e)?Oh(e):e}function Sl(n){const e=Fs(n.mapValue.fields[Lb].timestampValue);return new Qe(e.seconds,e.nanos)}class KV{constructor(e,t,s,r,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Mu="(default)";class gi{constructor(e,t){this.projectId=e,this.database=t||Mu}static empty(){return new gi("","")}get isDefaultDatabase(){return this.database===Mu}isEqual(e){return e instanceof gi&&e.projectId===this.projectId&&e.database===this.database}}const km="__type__",Fb="__max__",hr={mapValue:{fields:{__type__:{stringValue:Fb}}}},xm="__vector__",Co="value",Gc={nullValue:"NULL_VALUE"};function wr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Nm(n)?4:Ub(n)?9007199254740991:Vh(n)?10:11:ue(28295,{value:n})}function ms(n,e){if(n===e)return!0;const t=wr(n);if(t!==wr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Sl(n).isEqual(Sl(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Fs(r.timestampValue),a=Fs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return Us(r.bytesValue).isEqual(Us(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return ut(r.geoPointValue.latitude)===ut(i.geoPointValue.latitude)&&ut(r.geoPointValue.longitude)===ut(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return ut(r.integerValue)===ut(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=ut(r.doubleValue),a=ut(i.doubleValue);return o===a?Tl(o)===Tl(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return wo(n.arrayValue.values||[],e.arrayValue.values||[],ms);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(av(o)!==av(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ms(o[l],a[l])))return!1;return!0})(n,e);default:return ue(52216,{left:n})}}function Rl(n,e){return(n.values||[]).find((t=>ms(t,e)))!==void 0}function br(n,e){if(n===e)return 0;const t=wr(n),s=wr(e);if(t!==s)return we(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return we(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=ut(i.integerValue||i.doubleValue),l=ut(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return cv(n.timestampValue,e.timestampValue);case 4:return cv(Sl(n),Sl(e));case 5:return kf(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=Us(i),l=Us(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=we(a[u],l[u]);if(h!==0)return h}return we(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=we(ut(i.latitude),ut(o.latitude));return a!==0?a:we(ut(i.longitude),ut(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return uv(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const a=i.fields||{},l=o.fields||{},u=a[Co]?.arrayValue,h=l[Co]?.arrayValue,d=we(u?.values?.length||0,h?.values?.length||0);return d!==0?d:uv(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===hr.mapValue&&o===hr.mapValue)return 0;if(i===hr.mapValue)return 1;if(o===hr.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const p=kf(l[d],h[d]);if(p!==0)return p;const g=br(a[l[d]],u[h[d]]);if(g!==0)return g}return we(l.length,h.length)})(n.mapValue,e.mapValue);default:throw ue(23264,{he:t})}}function cv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return we(n,e);const t=Fs(n),s=Fs(e),r=we(t.seconds,s.seconds);return r!==0?r:we(t.nanos,s.nanos)}function uv(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=br(t[r],s[r]);if(i)return i}return we(t.length,s.length)}function Po(n){return Lf(n)}function Lf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Fs(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Us(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return se.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=Lf(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${Lf(t.fields[o])}`;return r+"}"})(n.mapValue):ue(61005,{value:n})}function Hc(n){switch(wr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Oh(n);return e?16+Hc(e):16;case 5:return 2*n.stringValue.length;case 6:return Us(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+Hc(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return Ci(s.fields,((i,o)=>{r+=i.length+Hc(o)})),r})(n.mapValue);default:throw ue(13486,{value:n})}}function Dm(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ff(n){return!!n&&"integerValue"in n}function Cl(n){return!!n&&"arrayValue"in n}function hv(n){return!!n&&"nullValue"in n}function dv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function zc(n){return!!n&&"mapValue"in n}function Vh(n){return(n?.mapValue?.fields||{})[km]?.stringValue===xm}function Ja(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Ci(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Ja(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ja(n.arrayValue.values[t]);return e}return{...n}}function Ub(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Fb}const Bb={mapValue:{fields:{[km]:{stringValue:xm},[Co]:{arrayValue:{}}}}};function GV(n){return"nullValue"in n?Gc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Dm(gi.empty(),se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Vh(n)?Bb:{mapValue:{}}:ue(35942,{value:n})}function HV(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Dm(gi.empty(),se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Bb:"mapValue"in n?Vh(n)?{mapValue:{}}:hr:ue(61959,{value:n})}function fv(n,e){const t=br(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function pv(n,e){const t=br(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class hn{constructor(e){this.value=e}static empty(){return new hn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!zc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ja(t)}setAll(e){let t=dt.emptyPath(),s={},r=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=Ja(o):r.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());zc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ms(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];zc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Ci(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new hn(Ja(this.value))}}function $b(n){const e=[];return Ci(n.fields,((t,s)=>{const r=new dt([t]);if(zc(s)){const i=$b(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new Nn(e)}class mt{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new mt(e,0,ge.min(),ge.min(),ge.min(),hn.empty(),0)}static newFoundDocument(e,t,s,r){return new mt(e,1,t,ge.min(),s,r,0)}static newNoDocument(e,t){return new mt(e,2,t,ge.min(),ge.min(),hn.empty(),0)}static newUnknownDocument(e,t){return new mt(e,3,t,ge.min(),ge.min(),hn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ge.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ge.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class No{constructor(e,t){this.position=e,this.inclusive=t}}function mv(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=se.comparator(se.fromName(o.referenceValue),t.key):s=br(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function gv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ms(n.position[t],e.position[t]))return!1;return!0}class Lu{constructor(e,t="asc"){this.field=e,this.dir=t}}function zV(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class qb{}class Me extends qb{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new WV(e,t,s):t==="array-contains"?new XV(e,s):t==="in"?new Wb(e,s):t==="not-in"?new JV(e,s):t==="array-contains-any"?new ZV(e,s):new Me(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new QV(e,s):new YV(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(br(t,this.value)):t!==null&&wr(this.value)===wr(t)&&this.matchesComparison(br(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ze extends qb{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ze(e,t)}matches(e){return ko(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ko(n){return n.op==="and"}function Uf(n){return n.op==="or"}function Om(n){return jb(n)&&ko(n)}function jb(n){for(const e of n.filters)if(e instanceof Ze)return!1;return!0}function Bf(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+Po(n.value);if(Om(n))return n.filters.map((e=>Bf(e))).join(",");{const e=n.filters.map((t=>Bf(t))).join(",");return`${n.op}(${e})`}}function Kb(n,e){return n instanceof Me?(function(s,r){return r instanceof Me&&s.op===r.op&&s.field.isEqual(r.field)&&ms(s.value,r.value)})(n,e):n instanceof Ze?(function(s,r){return r instanceof Ze&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,a)=>i&&Kb(o,r.filters[a])),!0):!1})(n,e):void ue(19439)}function Gb(n,e){const t=n.filters.concat(e);return Ze.create(t,n.op)}function Hb(n){return n instanceof Me?(function(t){return`${t.field.canonicalString()} ${t.op} ${Po(t.value)}`})(n):n instanceof Ze?(function(t){return t.op.toString()+" {"+t.getFilters().map(Hb).join(" ,")+"}"})(n):"Filter"}class WV extends Me{constructor(e,t,s){super(e,t,s),this.key=se.fromName(s.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class QV extends Me{constructor(e,t){super(e,"in",t),this.keys=zb("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class YV extends Me{constructor(e,t){super(e,"not-in",t),this.keys=zb("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function zb(n,e){return(e.arrayValue?.values||[]).map((t=>se.fromName(t.referenceValue)))}class XV extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cl(t)&&Rl(t.arrayValue,this.value)}}class Wb extends Me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Rl(this.value.arrayValue,t)}}class JV extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Rl(this.value.arrayValue,t)}}class ZV extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cl(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Rl(this.value.arrayValue,s)))}}class eM{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function $f(n,e=null,t=[],s=[],r=null,i=null,o=null){return new eM(n,e,t,s,r,i,o)}function _i(n){const e=be(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Bf(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Nh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Po(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Po(s))).join(",")),e.Te=t}return e.Te}function Xl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!zV(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Kb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gv(n.startAt,e.startAt)&&gv(n.endAt,e.endAt)}function Fu(n){return se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Uu(n,e){return n.filters.filter((t=>t instanceof Me&&t.field.isEqual(e)))}function _v(n,e,t){let s=Gc,r=!0;for(const i of Uu(n,e)){let o=Gc,a=!0;switch(i.op){case"<":case"<=":o=GV(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gc}fv({value:s,inclusive:r},{value:o,inclusive:a})<0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];fv({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function yv(n,e,t){let s=hr,r=!0;for(const i of Uu(n,e)){let o=hr,a=!0;switch(i.op){case">=":case">":o=HV(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=hr}pv({value:s,inclusive:r},{value:o,inclusive:a})>0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];pv({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}class Mh{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tM(n,e,t,s,r,i,o,a){return new Mh(n,e,t,s,r,i,o,a)}function Jl(n){return new Mh(n)}function vv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function nM(n){return n.collectionGroup!==null}function Za(n){const e=be(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ye(dt.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Lu(i,s))})),t.has(dt.keyField().canonicalString())||e.Ie.push(new Lu(dt.keyField(),s))}return e.Ie}function xn(n){const e=be(n);return e.Ee||(e.Ee=sM(e,Za(n))),e.Ee}function sM(n,e){if(n.limitType==="F")return $f(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new Lu(r.field,i)}));const t=n.endAt?new No(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new No(n.startAt.position,n.startAt.inclusive):null;return $f(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function qf(n,e,t){return new Mh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Lh(n,e){return Xl(xn(n),xn(e))&&n.limitType===e.limitType}function Qb(n){return`${_i(xn(n))}|lt:${n.limitType}`}function Gi(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>Hb(r))).join(", ")}]`),Nh(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>Po(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>Po(r))).join(",")),`Target(${s})`})(xn(n))}; limitType=${n.limitType})`}function Zl(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):se.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of Za(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,a,l){const u=mv(o,a,l);return o.inclusive?u<=0:u<0})(s.startAt,Za(s),r)||s.endAt&&!(function(o,a,l){const u=mv(o,a,l);return o.inclusive?u>=0:u>0})(s.endAt,Za(s),r))})(n,e)}function rM(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Yb(n){return(e,t)=>{let s=!1;for(const r of Za(n)){const i=iM(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function iM(n,e,t){const s=n.field.isKeyField()?se.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?br(l,u):ue(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return ue(19790,{direction:n.dir})}}class js{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ci(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return xb(this.inner)}size(){return this.innerSize}}const oM=new ht(se.comparator);function wn(){return oM}const Xb=new ht(se.comparator);function Na(...n){let e=Xb;for(const t of n)e=e.insert(t.key,t);return e}function Jb(n){let e=Xb;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function is(){return el()}function Zb(){return el()}function el(){return new js((n=>n.toString()),((n,e)=>n.isEqual(e)))}const aM=new ht(se.comparator),lM=new Ye(se.comparator);function Ce(...n){let e=lM;for(const t of n)e=e.add(t);return e}const cM=new Ye(we);function uM(){return cM}function Vm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tl(e)?"-0":e}}function eA(n){return{integerValue:""+n}}function hM(n,e){return gV(e)?eA(e):Vm(n,e)}class Fh{constructor(){this._=void 0}}function dM(n,e,t){return n instanceof xo?(function(r,i){const o={fields:{[Vb]:{stringValue:Ob},[Lb]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&Nm(i)&&(i=Oh(i)),i&&(o.fields[Mb]=i),{mapValue:o}})(t,e):n instanceof Do?nA(n,e):n instanceof Oo?sA(n,e):(function(r,i){const o=tA(r,i),a=Ev(o)+Ev(r.Ae);return Ff(o)&&Ff(r.Ae)?eA(a):Vm(r.serializer,a)})(n,e)}function fM(n,e,t){return n instanceof Do?nA(n,e):n instanceof Oo?sA(n,e):t}function tA(n,e){return n instanceof Pl?(function(s){return Ff(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class xo extends Fh{}class Do extends Fh{constructor(e){super(),this.elements=e}}function nA(n,e){const t=rA(e);for(const s of n.elements)t.some((r=>ms(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Oo extends Fh{constructor(e){super(),this.elements=e}}function sA(n,e){let t=rA(e);for(const s of n.elements)t=t.filter((r=>!ms(r,s)));return{arrayValue:{values:t}}}class Pl extends Fh{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ev(n){return ut(n.integerValue||n.doubleValue)}function rA(n){return Cl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class iA{constructor(e,t){this.field=e,this.transform=t}}function pM(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Do&&r instanceof Do||s instanceof Oo&&r instanceof Oo?wo(s.elements,r.elements,ms):s instanceof Pl&&r instanceof Pl?ms(s.Ae,r.Ae):s instanceof xo&&r instanceof xo})(n.transform,e.transform)}class mM{constructor(e,t){this.version=e,this.transformResults=t}}class fn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fn}static exists(e){return new fn(void 0,e)}static updateTime(e){return new fn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Uh{}function oA(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Bh(n.key,fn.none()):new Ho(n.key,n.data,fn.none());{const t=n.data,s=hn.empty();let r=new Ye(dt.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new Nr(n.key,s,new Nn(r.toArray()),fn.none())}}function gM(n,e,t){n instanceof Ho?(function(r,i,o){const a=r.value.clone(),l=Tv(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof Nr?(function(r,i,o){if(!Wc(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Tv(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(aA(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function tl(n,e,t,s){return n instanceof Ho?(function(i,o,a,l){if(!Wc(i.precondition,o))return a;const u=i.value.clone(),h=wv(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,s):n instanceof Nr?(function(i,o,a,l){if(!Wc(i.precondition,o))return a;const u=wv(i.fieldTransforms,l,o),h=o.data;return h.setAll(aA(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((d=>d.field)))})(n,e,t,s):(function(i,o,a){return Wc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function _M(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=tA(s.transform,r||null);i!=null&&(t===null&&(t=hn.empty()),t.set(s.field,i))}return t||null}function Iv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&wo(s,r,((i,o)=>pM(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ho extends Uh{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Nr extends Uh{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function aA(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Tv(n,e,t){const s=new Map;de(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,fM(o,a,t[r]))}return s}function wv(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,dM(i,o,e))}return s}class Bh extends Uh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lA extends Uh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Mm{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&gM(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=tl(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=tl(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Zb();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=oA(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(ge.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ce())}isEqual(e){return this.batchId===e.batchId&&wo(this.mutations,e.mutations,((t,s)=>Iv(t,s)))&&wo(this.baseMutations,e.baseMutations,((t,s)=>Iv(t,s)))}}class Lm{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){de(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return aM})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new Lm(e,t,s,r)}}class Fm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class yM{constructor(e,t){this.count=e,this.unchangedNames=t}}var vt,Le;function vM(n){switch(n){case j.OK:return ue(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return ue(15467,{code:n})}}function cA(n){if(n===void 0)return ln("GRPC error has no .code"),j.UNKNOWN;switch(n){case vt.OK:return j.OK;case vt.CANCELLED:return j.CANCELLED;case vt.UNKNOWN:return j.UNKNOWN;case vt.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case vt.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case vt.INTERNAL:return j.INTERNAL;case vt.UNAVAILABLE:return j.UNAVAILABLE;case vt.UNAUTHENTICATED:return j.UNAUTHENTICATED;case vt.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case vt.NOT_FOUND:return j.NOT_FOUND;case vt.ALREADY_EXISTS:return j.ALREADY_EXISTS;case vt.PERMISSION_DENIED:return j.PERMISSION_DENIED;case vt.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case vt.ABORTED:return j.ABORTED;case vt.OUT_OF_RANGE:return j.OUT_OF_RANGE;case vt.UNIMPLEMENTED:return j.UNIMPLEMENTED;case vt.DATA_LOSS:return j.DATA_LOSS;default:return ue(39323,{code:n})}}(Le=vt||(vt={}))[Le.OK=0]="OK",Le[Le.CANCELLED=1]="CANCELLED",Le[Le.UNKNOWN=2]="UNKNOWN",Le[Le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Le[Le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Le[Le.NOT_FOUND=5]="NOT_FOUND",Le[Le.ALREADY_EXISTS=6]="ALREADY_EXISTS",Le[Le.PERMISSION_DENIED=7]="PERMISSION_DENIED",Le[Le.UNAUTHENTICATED=16]="UNAUTHENTICATED",Le[Le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Le[Le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Le[Le.ABORTED=10]="ABORTED",Le[Le.OUT_OF_RANGE=11]="OUT_OF_RANGE",Le[Le.UNIMPLEMENTED=12]="UNIMPLEMENTED",Le[Le.INTERNAL=13]="INTERNAL",Le[Le.UNAVAILABLE=14]="UNAVAILABLE",Le[Le.DATA_LOSS=15]="DATA_LOSS";function EM(){return new TextEncoder}const IM=new gr([4294967295,4294967295],0);function bv(n){const e=EM().encode(n),t=new cb;return t.update(e),new Uint8Array(t.digest())}function Av(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new gr([t,s],0),new gr([r,i],0)]}class Um{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new ka(`Invalid padding: ${t}`);if(s<0)throw new ka(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new ka(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new ka(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=gr.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(gr.fromNumber(s)));return r.compare(IM)===1&&(r=new gr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=bv(e),[s,r]=Av(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Um(i,r,t);return s.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=bv(e),[s,r]=Av(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class ka extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $h{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,ec.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new $h(ge.min(),r,new ht(we),wn(),Ce())}}class ec{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new ec(s,t,Ce(),Ce(),Ce())}}class Qc{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class uA{constructor(e,t){this.targetId=e,this.Ce=t}}class hA{constructor(e,t,s=Tt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Sv{constructor(){this.ve=0,this.Fe=Rv(),this.Me=Tt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ce(),t=Ce(),s=Ce();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:ue(38017,{changeType:i})}})),new ec(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=Rv()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,de(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class TM{constructor(e){this.Ge=e,this.ze=new Map,this.je=wn(),this.Je=bc(),this.He=bc(),this.Ye=new ht(we)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:ue(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Fu(i))if(s===0){const o=new se(i.path);this.et(t,o,mt.newNoDocument(o,ge.min()))}else de(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=Us(s).toUint8Array()}catch(l){if(l instanceof Db)return vl("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Um(o,r,i)}catch(l){return vl(l instanceof ka?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Fu(a.target)){const l=new se(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,mt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=Ce();this.He.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new $h(e,t,this.Ye,this.je,s);return this.je=wn(),this.Je=bc(),this.He=bc(),this.Ye=new ht(we),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Sv,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ye(we),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ye(we),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Sv),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function bc(){return new ht(se.comparator)}function Rv(){return new ht(se.comparator)}const wM={asc:"ASCENDING",desc:"DESCENDING"},bM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},AM={and:"AND",or:"OR"};class SM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function jf(n,e){return n.useProto3Json||Nh(e)?e:{value:e}}function Vo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dA(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function RM(n,e){return Vo(n,e.toTimestamp())}function cn(n){return de(!!n,49232),ge.fromTimestamp((function(t){const s=Fs(t);return new Qe(s.seconds,s.nanos)})(n))}function Bm(n,e){return Kf(n,e).canonicalString()}function Kf(n,e){const t=(function(r){return new Je(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function fA(n){const e=Je.fromString(n);return de(TA(e),10190,{key:e.toString()}),e}function Bu(n,e){return Bm(n.databaseId,e.path)}function oi(n,e){const t=fA(e);if(t.get(1)!==n.databaseId.projectId)throw new le(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new le(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new se(gA(t))}function pA(n,e){return Bm(n.databaseId,e)}function mA(n){const e=fA(n);return e.length===4?Je.emptyPath():gA(e)}function Gf(n){return new Je(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function gA(n){return de(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Cv(n,e,t){return{name:Bu(n,e),fields:t.value.mapValue.fields}}function CM(n,e,t){const s=oi(n,e.name),r=cn(e.updateTime),i=e.createTime?cn(e.createTime):ge.min(),o=new hn({mapValue:{fields:e.fields}}),a=mt.newFoundDocument(s,r,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function PM(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ue(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?(de(h===void 0||typeof h=="string",58123),Tt.fromBase64String(h||"")):(de(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Tt.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?j.UNKNOWN:cA(u.code);return new le(h,u.message||"")})(o);t=new hA(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=oi(n,s.document.name),i=cn(s.document.updateTime),o=s.document.createTime?cn(s.document.createTime):ge.min(),a=new hn({mapValue:{fields:s.document.fields}}),l=mt.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];t=new Qc(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=oi(n,s.document),i=s.readTime?cn(s.readTime):ge.min(),o=mt.newNoDocument(r,i),a=s.removedTargetIds||[];t=new Qc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=oi(n,s.document),i=s.removedTargetIds||[];t=new Qc([],i,r,null)}else{if(!("filter"in e))return ue(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new yM(r,i),a=s.targetId;t=new uA(a,o)}}return t}function $u(n,e){let t;if(e instanceof Ho)t={update:Cv(n,e.key,e.value)};else if(e instanceof Bh)t={delete:Bu(n,e.key)};else if(e instanceof Nr)t={update:Cv(n,e.key,e.data),updateMask:VM(e.fieldMask)};else{if(!(e instanceof lA))return ue(16599,{Vt:e.type});t={verify:Bu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const a=o.transform;if(a instanceof xo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Do)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Oo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Pl)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ue(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:RM(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ue(27497)})(n,e.precondition)),t}function Hf(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?fn.updateTime(cn(i.updateTime)):i.exists!==void 0?fn.exists(i.exists):fn.none()})(e.currentDocument):fn.none(),s=e.updateTransforms?e.updateTransforms.map((r=>(function(o,a){let l=null;if("setToServerValue"in a)de(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new xo;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Do(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Oo(h)}else"increment"in a?l=new Pl(o,a.increment):ue(16584,{proto:a});const u=dt.fromServerFormat(a.fieldPath);return new iA(u,l)})(n,r))):[];if(e.update){e.update.name;const r=oi(n,e.update.name),i=new hn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new Nn(u.map((h=>dt.fromServerFormat(h))))})(e.updateMask);return new Nr(r,i,o,t,s)}return new Ho(r,i,t,s)}if(e.delete){const r=oi(n,e.delete);return new Bh(r,t)}if(e.verify){const r=oi(n,e.verify);return new lA(r,t)}return ue(1463,{proto:e})}function NM(n,e){return n&&n.length>0?(de(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?cn(r.updateTime):cn(i);return o.isEqual(ge.min())&&(o=cn(i)),new mM(o,r.transformResults||[])})(t,e)))):[]}function _A(n,e){return{documents:[pA(n,e.path)]}}function yA(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=pA(n,r);const i=(function(u){if(u.length!==0)return IA(Ze.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(p){return{field:Hi(p.field),direction:xM(p.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=jf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:r}}function vA(n){let e=mA(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){de(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(d){const p=EA(d);return p instanceof Ze&&Om(p)?p.getFilters():[p]})(t.where));let o=[];t.orderBy&&(o=(function(d){return d.map((p=>(function(b){return new Lu(zi(b.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(p)))})(t.orderBy));let a=null;t.limit&&(a=(function(d){let p;return p=typeof d=="object"?d.value:d,Nh(p)?null:p})(t.limit));let l=null;t.startAt&&(l=(function(d){const p=!!d.before,g=d.values||[];return new No(g,p)})(t.startAt));let u=null;return t.endAt&&(u=(function(d){const p=!d.before,g=d.values||[];return new No(g,p)})(t.endAt)),tM(e,r,o,i,a,"F",l,u)}function kM(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function EA(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=zi(t.unaryFilter.field);return Me.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=zi(t.unaryFilter.field);return Me.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=zi(t.unaryFilter.field);return Me.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=zi(t.unaryFilter.field);return Me.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ue(61313);default:return ue(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Me.create(zi(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ue(58110);default:return ue(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ze.create(t.compositeFilter.filters.map((s=>EA(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return ue(1026)}})(t.compositeFilter.op))})(n):ue(30097,{filter:n})}function xM(n){return wM[n]}function DM(n){return bM[n]}function OM(n){return AM[n]}function Hi(n){return{fieldPath:n.canonicalString()}}function zi(n){return dt.fromServerFormat(n.fieldPath)}function IA(n){return n instanceof Me?(function(t){if(t.op==="=="){if(dv(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NAN"}};if(hv(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dv(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NAN"}};if(hv(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hi(t.field),op:DM(t.op),value:t.value}}})(n):n instanceof Ze?(function(t){const s=t.getFilters().map((r=>IA(r)));return s.length===1?s[0]:{compositeFilter:{op:OM(t.op),filters:s}}})(n):ue(54877,{filter:n})}function VM(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function TA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Ss{constructor(e,t,s,r,i=ge.min(),o=ge.min(),a=Tt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ss(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ss(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class wA{constructor(e){this.yt=e}}function MM(n,e){let t;if(e.document)t=CM(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=se.fromSegments(e.noDocument.path),r=vi(e.noDocument.readTime);t=mt.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ue(56709);{const s=se.fromSegments(e.unknownDocument.path),r=vi(e.unknownDocument.version);t=mt.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime((function(r){const i=new Qe(r[0],r[1]);return ge.fromTimestamp(i)})(e.readTime)),t}function Pv(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:qu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(i,o){return{name:Bu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Vo(i,o.version.toTimestamp()),createTime:Vo(i,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:yi(e.version)};else{if(!e.isUnknownDocument())return ue(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:yi(e.version)}}return s}function qu(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function yi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vi(n){const e=new Qe(n.seconds,n.nanoseconds);return ge.fromTimestamp(e)}function zr(n,e){const t=(e.baseMutations||[]).map((i=>Hf(n.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const s=e.mutations.map((i=>Hf(n.yt,i))),r=Qe.fromMillis(e.localWriteTimeMs);return new Mm(e.batchId,r,t,s)}function xa(n){const e=vi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?vi(n.lastLimboFreeSnapshotVersion):ge.min();let s;return s=(function(i){return i.documents!==void 0})(n.query)?(function(i){const o=i.documents.length;return de(o===1,1966,{count:o}),xn(Jl(mA(i.documents[0])))})(n.query):(function(i){return xn(vA(i))})(n.query),new Ss(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Tt.fromBase64String(n.resumeToken))}function bA(n,e){const t=yi(e.snapshotVersion),s=yi(e.lastLimboFreeSnapshotVersion);let r;r=Fu(e.target)?_A(n.yt,e.target):yA(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_i(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function AA(n){const e=vA({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qf(e,e.limit,"L"):e}function Fd(n,e){return new Fm(e.largestBatchId,Hf(n.yt,e.overlayMutation))}function Nv(n,e){const t=e.path.lastSegment();return[n,Jt(e.path.popLast()),t]}function kv(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:yi(s.readTime),documentKey:Jt(s.documentKey.path),largestBatchId:s.largestBatchId}}class LM{getBundleMetadata(e,t){return xv(e).get(t).next((s=>{if(s)return(function(i){return{id:i.bundleId,createTime:vi(i.createTime),version:i.version}})(s)}))}saveBundleMetadata(e,t){return xv(e).put((function(r){return{bundleId:r.id,createTime:yi(cn(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return Dv(e).get(t).next((s=>{if(s)return(function(i){return{name:i.name,query:AA(i.bundledQuery),readTime:vi(i.readTime)}})(s)}))}saveNamedQuery(e,t){return Dv(e).put((function(r){return{name:r.name,readTime:yi(cn(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function xv(n){return Pt(n,kh)}function Dv(n){return Pt(n,xh)}class qh{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new qh(e,s)}getOverlay(e,t){return ya(e).get(Nv(this.userId,t)).next((s=>s?Fd(this.serializer,s):null))}getOverlays(e,t){const s=is();return x.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){const r=[];return s.forEach(((i,o)=>{const a=new Fm(t,o);r.push(this.St(e,a))})),x.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach((o=>r.add(Jt(o.getCollectionPath()))));const i=[];return r.forEach((o=>{const a=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push(ya(e).Z(Vf,a))})),x.waitFor(i)}getOverlaysForCollection(e,t,s){const r=is(),i=Jt(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ya(e).J(Vf,o).next((a=>{for(const l of a){const u=Fd(this.serializer,l);r.set(u.getKey(),u)}return r}))}getOverlaysForCollectionGroup(e,t,s,r){const i=is();let o;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ya(e).ee({index:Rb,range:a},((l,u,h)=>{const d=Fd(this.serializer,u);i.size()<r||d.largestBatchId===o?(i.set(d.getKey(),d),o=d.largestBatchId):h.done()})).next((()=>i))}St(e,t){return ya(e).put((function(r,i,o){const[a,l,u]=Nv(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:$u(r.yt,o.mutation)}})(this.serializer,this.userId,t))}}function ya(n){return Pt(n,Dh)}class FM{bt(e){return Pt(e,Cm)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?Tt.fromUint8Array(s):Tt.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Wr{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ut(e.integerValue));else if("doubleValue"in e){const s=ut(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),Tl(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=Fs(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Us(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?Ub(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Vh(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ue(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const r=Co,i=s[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ut(i)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Wr.Kt=new Wr;const Ui=255;function UM(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Ov(n){const e=64-(function(s){let r=0;for(let i=0;i<8;++i){const o=UM(255&s[i]);if(r+=o,o!==8)break}return r})(n);return Math.ceil(e/8)}class BM{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=Ov(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=Ov(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Ui),this.sn(255)}_n(){this.an(Ui),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Ui?(this.sn(Ui),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Ui?(this.an(Ui),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class $M{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class qM{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class va{constructor(){this.cn=new BM,this.ln=new $M(this.cn),this.hn=new qM(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Qr{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Qr(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:Yc(this.En),directionalValue:Yc(this.dn),orderedDocumentKey:Yc(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Xs(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=Vv(n.En,e.En),t!==0?t:(t=Vv(n.dn,e.dn),t!==0?t:se.comparator(n.In,e.In)))}function Vv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function Yc(n){return cT()?(function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s})(n):n}function Mv(n){return typeof n!="string"?n:(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(n)}class Lv{constructor(e){this.mn=new Ye(((t,s)=>dt.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(de(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=xf(e);if(t!==void 0&&!this.wn(t))return!1;const s=Kr(e);let r=new Set,i=0,o=0;for(;i<s.length&&this.wn(s[i]);++i)r=r.add(s[i].fieldPath.canonicalString());if(i===s.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!r.has(a.field.canonicalString())){const l=s[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<s.length;++i){const a=s[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Ye(dt.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new qc(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new qc(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new qc(s.field,s.dir==="asc"?0:1)));return new xu(xu.UNKNOWN_ID,this.collectionId,t,Il.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function SA(n){if(de(n instanceof Me||n instanceof Ze,20012),n instanceof Me){if(n instanceof Wb){const t=n.value.arrayValue?.values?.map((s=>Me.create(n.field,"==",s)))||[];return Ze.create(t,"or")}return n}const e=n.filters.map((t=>SA(t)));return Ze.create(e,n.op)}function jM(n){if(n.getFilters().length===0)return[];const e=Qf(SA(n));return de(RA(e),7391),zf(e)||Wf(e)?[e]:e.getFilters()}function zf(n){return n instanceof Me}function Wf(n){return n instanceof Ze&&Om(n)}function RA(n){return zf(n)||Wf(n)||(function(t){if(t instanceof Ze&&Uf(t)){for(const s of t.getFilters())if(!zf(s)&&!Wf(s))return!1;return!0}return!1})(n)}function Qf(n){if(de(n instanceof Me||n instanceof Ze,34018),n instanceof Me)return n;if(n.filters.length===1)return Qf(n.filters[0]);const e=n.filters.map((s=>Qf(s)));let t=Ze.create(e,n.op);return t=ju(t),RA(t)?t:(de(t instanceof Ze,64498),de(ko(t),40251),de(t.filters.length>1,57927),t.filters.reduce(((s,r)=>$m(s,r))))}function $m(n,e){let t;return de(n instanceof Me||n instanceof Ze,38388),de(e instanceof Me||e instanceof Ze,25473),t=n instanceof Me?e instanceof Me?(function(r,i){return Ze.create([r,i],"and")})(n,e):Fv(n,e):e instanceof Me?Fv(e,n):(function(r,i){if(de(r.filters.length>0&&i.filters.length>0,48005),ko(r)&&ko(i))return Gb(r,i.getFilters());const o=Uf(r)?r:i,a=Uf(r)?i:r,l=o.filters.map((u=>$m(u,a)));return Ze.create(l,"or")})(n,e),ju(t)}function Fv(n,e){if(ko(e))return Gb(e,n.getFilters());{const t=e.filters.map((s=>$m(n,s)));return Ze.create(t,"or")}}function ju(n){if(de(n instanceof Me||n instanceof Ze,11850),n instanceof Me)return n;const e=n.getFilters();if(e.length===1)return ju(e[0]);if(jb(n))return n;const t=e.map((r=>ju(r))),s=[];return t.forEach((r=>{r instanceof Me?s.push(r):r instanceof Ze&&(r.op===n.op?s.push(...r.filters):s.push(r))})),s.length===1?s[0]:Ze.create(s,n.op)}class KM{constructor(){this.Cn=new qm}addToCollectionParentIndex(e,t){return this.Cn.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}deleteAllFieldIndexes(e){return x.resolve()}createTargetIndexes(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(An.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(An.min())}updateCollectionGroup(e,t,s){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}}class qm{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ye(Je.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ye(Je.comparator)).toArray()}}const Uv="IndexedDbIndexManager",Ac=new Uint8Array(0);class GM{constructor(e,t){this.databaseId=t,this.vn=new qm,this.Fn=new js((s=>_i(s)),((s,r)=>Xl(s,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:s,parent:Jt(r)};return Bv(e).put(i)}return x.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[gb(t),""],!1,!0);return Bv(e).J(r).next((i=>{for(const o of i){if(o.collectionId!==t)break;s.push(rs(o.parent))}return s}))}addFieldIndex(e,t){const s=Ea(e),r=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete r.indexId;const i=s.add(r);if(t.indexState){const o=$i(e);return i.next((a=>{o.put(kv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const s=Ea(e),r=$i(e),i=Bi(e);return s.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Ea(e),s=Bi(e),r=$i(e);return t.Z().next((()=>s.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return x.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((r=>{if(r===0||r===1){const i=new Lv(s).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const s=Bi(e);let r=!0;const i=new Map;return x.forEach(this.Mn(t),(o=>this.xn(e,o).next((a=>{r&&(r=!!a),i.set(o,a)})))).next((()=>{if(r){let o=Ce();const a=[];return x.forEach(i,((l,u)=>{Q(Uv,`Using index ${(function(D){return`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map((P=>`${P.fieldPath}:${P.kind}`)).join(",")}`})(l)} to execute ${_i(t)}`);const h=(function(D,P){const q=xf(P);if(q===void 0)return null;for(const Y of Uu(D,q.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null})(u,l),d=(function(D,P){const q=new Map;for(const Y of Kr(P))for(const I of Uu(D,Y.fieldPath))switch(I.op){case"==":case"in":q.set(Y.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return q.set(Y.fieldPath.canonicalString(),I.value),Array.from(q.values())}return null})(u,l),p=(function(D,P){const q=[];let Y=!0;for(const I of Kr(P)){const v=I.kind===0?_v(D,I.fieldPath,D.startAt):yv(D,I.fieldPath,D.startAt);q.push(v.value),Y&&(Y=v.inclusive)}return new No(q,Y)})(u,l),g=(function(D,P){const q=[];let Y=!0;for(const I of Kr(P)){const v=I.kind===0?yv(D,I.fieldPath,D.endAt):_v(D,I.fieldPath,D.endAt);q.push(v.value),Y&&(Y=v.inclusive)}return new No(q,Y)})(u,l),b=this.On(l,u,p),C=this.On(l,u,g),V=this.Nn(l,u,d),L=this.Bn(l.indexId,h,b,p.inclusive,C,g.inclusive,V);return x.forEach(L,(F=>s.Y(F,t.limit).next((D=>{D.forEach((P=>{const q=se.fromSegments(P.documentKey);o.has(q)||(o=o.add(q),a.push(q))}))}))))})).next((()=>a))}return x.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=jM(Ze.create(e.filters,"and")).map((s=>$f(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,r,i,o,a){const l=(t!=null?t.length:1)*Math.max(s.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let d=0;d<l;++d){const p=t?this.Ln(t[d/u]):Ac,g=this.kn(e,p,s[d%u],r),b=this.qn(e,p,i[d%u],o),C=a.map((V=>this.kn(e,p,V,!0)));h.push(...this.createRange(g,b,C))}return h}kn(e,t,s,r){const i=new Qr(e,se.empty(),t,s);return r?i:i.An()}qn(e,t,s,r){const i=new Qr(e,se.empty(),t,s);return r?i.An():i}xn(e,t){const s=new Lv(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((i=>{let o=null;for(const a of i)s.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o}))}getIndexType(e,t){let s=2;const r=this.Mn(t);return x.forEach(r,(i=>this.xn(e,i).next((o=>{o?s!==0&&o.fields.length<(function(l){let u=new Ye(dt.comparator),h=!1;for(const d of l.filters)for(const p of d.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const d of l.orderBy)d.field.isKeyField()||(u=u.add(d.field));return u.size+(h?1:0)})(i)&&(s=1):s=0})))).next((()=>(function(o){return o.limit!==null})(t)&&r.length>1&&s===2?1:s))}Qn(e,t){const s=new va;for(const r of Kr(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=s.Pn(r.kind);Wr.Kt.Dt(i,o)}return s.un()}Ln(e){const t=new va;return Wr.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new va;return Wr.Kt.Dt(Dm(this.databaseId,t),s.Pn((function(i){const o=Kr(i);return o.length===0?0:o[o.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new va);let i=0;for(const o of Kr(e)){const a=s[i++];for(const l of r)if(this.Un(t,o.fieldPath)&&Cl(a))r=this.Kn(r,o,a);else{const u=l.Pn(o.kind);Wr.Kt.Dt(a,u)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const a of r){const l=new va;l.seed(a.un()),Wr.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find((s=>s instanceof Me&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=Ea(e),r=$i(e);return(t?s.J(Of,IDBKeyRange.bound(t,t)):s.J()).next((i=>{const o=[];return x.forEach(i,(a=>r.get([a.indexId,this.uid]).next((l=>{o.push((function(h,d){const p=d?new Il(d.sequenceNumber,new An(vi(d.readTime),new se(rs(d.documentKey)),d.largestBatchId)):Il.empty(),g=h.fields.map((([b,C])=>new qc(dt.fromServerFormat(b),C)));return new xu(h.indexId,h.collectionGroup,g,p)})(a,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:we(s.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const r=Ea(e),i=$i(e);return this.Gn(e).next((o=>r.J(Of,IDBKeyRange.bound(t,t)).next((a=>x.forEach(a,(l=>i.put(kv(l.indexId,this.uid,o,s))))))))}updateIndexEntries(e,t){const s=new Map;return x.forEach(t,((r,i)=>{const o=s.get(r.collectionGroup);return(o?x.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next((a=>(s.set(r.collectionGroup,a),x.forEach(a,(l=>this.zn(e,r,l).next((u=>{const h=this.jn(i,l);return u.isEqual(h)?x.resolve():this.Jn(e,i,l,u,h)})))))))}))}Hn(e,t,s,r){return Bi(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return Bi(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=Bi(e);let i=new Ye(Xs);return r.ee({index:Sb,range:IDBKeyRange.only([s.indexId,this.uid,Yc(this.$n(s,t))])},((o,a)=>{i=i.add(new Qr(s.indexId,t,Mv(a.arrayValue),Mv(a.directionalValue)))})).next((()=>i))}jn(e,t){let s=new Ye(Xs);const r=this.Qn(t,e);if(r==null)return s;const i=xf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Cl(o))for(const a of o.arrayValue.values||[])s=s.add(new Qr(t.indexId,e.key,this.Ln(a),r))}else s=s.add(new Qr(t.indexId,e.key,Ac,r));return s}Jn(e,t,s,r,i){Q(Uv,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,h,d,p){const g=l.getIterator(),b=u.getIterator();let C=Fi(g),V=Fi(b);for(;C||V;){let L=!1,F=!1;if(C&&V){const D=h(C,V);D<0?F=!0:D>0&&(L=!0)}else C!=null?F=!0:L=!0;L?(d(V),V=Fi(b)):F?(p(C),C=Fi(g)):(C=Fi(g),V=Fi(b))}})(r,i,Xs,(a=>{o.push(this.Hn(e,t,s,a))}),(a=>{o.push(this.Yn(e,t,s,a))})),x.waitFor(o)}Gn(e){let t=1;return $i(e).ee({index:Ab,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,r,i)=>{i.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((o,a)=>Xs(o,a))).filter(((o,a,l)=>!a||Xs(o,l[a-1])!==0));const r=[];r.push(e);for(const o of s){const a=Xs(o,e),l=Xs(o,t);if(a===0)r[0]=e.An();else if(a>0&&l<0)r.push(o),r.push(o.An());else if(l>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const a=r[o].Vn(this.uid,Ac,se.empty()),l=r[o+1].Vn(this.uid,Ac,se.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Xs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($v)}getMinOffset(e,t){return x.mapArray(this.Mn(t),(s=>this.xn(e,s).next((r=>r||ue(44426))))).next($v)}}function Bv(n){return Pt(n,Al)}function Bi(n){return Pt(n,Xa)}function Ea(n){return Pt(n,Rm)}function $i(n){return Pt(n,Ya)}function $v(n){de(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;bm(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new An(e.readTime,e.documentKey,t)}const qv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},CA=41943040;class Ht{static withCacheSize(e){return new Ht(e,Ht.DEFAULT_COLLECTION_PERCENTILE,Ht.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}function PA(n,e,t){const s=n.store(Mn),r=n.store(bo),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=s.ee({range:o},((h,d,p)=>(a++,p.delete())));i.push(l.next((()=>{de(a===1,47070,{batchId:t.batchId})})));const u=[];for(const h of t.mutations){const d=Tb(e,h.key.path,t.batchId);i.push(r.delete(d)),u.push(h.key)}return x.waitFor(i).next((()=>u))}function Ku(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ue(14731);e=n.noDocument}return JSON.stringify(e).length}Ht.DEFAULT_COLLECTION_PERCENTILE=10,Ht.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ht.DEFAULT=new Ht(CA,Ht.DEFAULT_COLLECTION_PERCENTILE,Ht.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ht.DISABLED=new Ht(-1,0,0);class jh{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){de(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new jh(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Js(e).ee({index:Jr,range:s},((r,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,s,r){const i=Wi(e),o=Js(e);return o.add({}).next((a=>{de(typeof a=="number",49019);const l=new Mm(a,t,s,r),u=(function(g,b,C){const V=C.baseMutations.map((F=>$u(g.yt,F))),L=C.mutations.map((F=>$u(g.yt,F)));return{userId:b,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:V,mutations:L}})(this.serializer,this.userId,l),h=[];let d=new Ye(((p,g)=>we(p.canonicalString(),g.canonicalString())));for(const p of r){const g=Tb(this.userId,p.key.path,a);d=d.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(g,vV))}return d.forEach((p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))})),e.addOnCommittedListener((()=>{this.Xn[a]=l.keys()})),x.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return Js(e).get(t).next((s=>s?(de(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),zr(this.serializer,s)):null))}er(e,t){return this.Xn[t]?x.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return Js(e).ee({index:Jr,range:r},((o,a,l)=>{a.userId===this.userId&&(de(a.batchId>=s,47524,{tr:s}),i=zr(this.serializer,a)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=ri;return Js(e).ee({index:Jr,range:t,reverse:!0},((r,i,o)=>{s=i.batchId,o.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ri],[this.userId,Number.POSITIVE_INFINITY]);return Js(e).J(Jr,t).next((s=>s.map((r=>zr(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=jc(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return Wi(e).ee({range:r},((o,a,l)=>{const[u,h,d]=o,p=rs(h);if(u===this.userId&&t.path.isEqual(p))return Js(e).get(d).next((g=>{if(!g)throw ue(61480,{nr:o,batchId:d});de(g.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:g.userId,batchId:d}),i.push(zr(this.serializer,g))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ye(we);const r=[];return t.forEach((i=>{const o=jc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Wi(e).ee({range:a},((u,h,d)=>{const[p,g,b]=u,C=rs(g);p===this.userId&&i.path.isEqual(C)?s=s.add(b):d.done()}));r.push(l)})),x.waitFor(r).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=jc(this.userId,s),o=IDBKeyRange.lowerBound(i);let a=new Ye(we);return Wi(e).ee({range:o},((l,u,h)=>{const[d,p,g]=l,b=rs(p);d===this.userId&&s.isPrefixOf(b)?b.length===r&&(a=a.add(g)):h.done()})).next((()=>this.rr(e,a)))}rr(e,t){const s=[],r=[];return t.forEach((i=>{r.push(Js(e).get(i).next((o=>{if(o===null)throw ue(35274,{batchId:i});de(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),s.push(zr(this.serializer,o))})))})),x.waitFor(r).next((()=>s))}removeMutationBatch(e,t){return PA(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),x.forEach(s,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return x.resolve();const s=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),r=[];return Wi(e).ee({range:s},((i,o,a)=>{if(i[0]===this.userId){const l=rs(i[1]);r.push(l)}else a.done()})).next((()=>{de(r.length===0,56720,{sr:r.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return NA(e,this.userId,t)}_r(e){return kA(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:ri,lastStreamToken:""}))}}function NA(n,e,t){const s=jc(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Wi(n).ee({range:i,X:!0},((a,l,u)=>{const[h,d,p]=a;h===e&&d===r&&(o=!0),u.done()})).next((()=>o))}function Js(n){return Pt(n,Mn)}function Wi(n){return Pt(n,bo)}function kA(n){return Pt(n,wl)}class Ei{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ei(0)}static cr(){return new Ei(-1)}}class HM{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new Ei(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>ge.fromTimestamp(new Qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>qi(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(de(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let r=0;const i=[];return qi(e).ee(((o,a)=>{const l=xa(a);l.sequenceNumber<=t&&s.get(l.targetId)===null&&(r++,i.push(this.removeTargetData(e,l)))})).next((()=>x.waitFor(i))).next((()=>r))}forEachTarget(e,t){return qi(e).ee(((s,r)=>{const i=xa(r);t(i)}))}lr(e){return jv(e).get(Vu).next((t=>(de(t!==null,2888),t)))}hr(e,t){return jv(e).put(Vu,t)}Pr(e,t){return qi(e).put(bA(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=_i(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return qi(e).ee({range:r,index:bb},((o,a,l)=>{const u=xa(a);Xl(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,s){const r=[],i=ur(e);return t.forEach((o=>{const a=Jt(o.path);r.push(i.put({targetId:s,path:a})),r.push(this.referenceDelegate.addReference(e,s,o))})),x.waitFor(r)}removeMatchingKeys(e,t,s){const r=ur(e);return x.forEach(t,(i=>{const o=Jt(i.path);return x.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])}))}removeMatchingKeysForTargetId(e,t){const s=ur(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=ur(e);let i=Ce();return r.ee({range:s,X:!0},((o,a,l)=>{const u=rs(o[1]),h=new se(u);i=i.add(h)})).next((()=>i))}containsKey(e,t){const s=Jt(t.path),r=IDBKeyRange.bound([s],[gb(s)],!1,!0);let i=0;return ur(e).ee({index:Sm,X:!0,range:r},(([o,a],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return qi(e).get(t).next((s=>s?xa(s):null))}}function qi(n){return Pt(n,Ao)}function jv(n){return Pt(n,ii)}function ur(n){return Pt(n,So)}const Kv="LruGarbageCollector",xA=1048576;function Gv([n,e],[t,s]){const r=we(n,t);return r===0?we(e,s):r}class zM{constructor(e){this.Ir=e,this.buffer=new Ye(Gv),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();Gv(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class DA{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Q(Kv,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Pr(t)?Q(Kv,"Ignoring IndexedDB error during garbage collection: ",t):await Ri(t)}await this.Vr(3e5)}))}}class WM{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return x.resolve(Pn.ce);const s=new zM(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(qv)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qv):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((d=>(d>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r)))).next((d=>(s=d,a=Date.now(),this.removeTargets(e,s,t)))).next((d=>(i=d,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((d=>(u=Date.now(),Ki()<=xe.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:d}))))}}function OA(n,e){return new WM(n,e)}class QM{constructor(e,t){this.db=e,this.garbageCollector=OA(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,r)=>t(r)))}addReference(e,t,s){return Sc(e,s)}removeReference(e,t,s){return Sc(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return Sc(e,t)}br(e,t){return(function(r,i){let o=!1;return kA(r).te((a=>NA(r,a,i).next((l=>(l&&(o=!0),x.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Sr(e,((o,a)=>{if(a<=t){const l=this.br(e,o).next((u=>{if(!u)return i++,s.getEntry(e,o).next((()=>(s.removeEntry(o,ge.min()),ur(e).delete((function(d){return[0,Jt(d.path)]})(o)))))}));r.push(l)}})).next((()=>x.waitFor(r))).next((()=>s.apply(e))).next((()=>i))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return Sc(e,t)}Sr(e,t){const s=ur(e);let r,i=Pn.ce;return s.ee({index:Sm},(([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Pn.ce&&t(new se(rs(r)),i),i=u,r=l):i=Pn.ce})).next((()=>{i!==Pn.ce&&t(new se(rs(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sc(n,e){return ur(n).put((function(s,r){return{targetId:0,path:Jt(s.path),sequenceNumber:r}})(e,n.currentSequenceNumber))}class VA{constructor(){this.changes=new js((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?x.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class YM{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Br(e).put(s)}removeEntry(e,t,s){return Br(e).delete((function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],qu(o),a[a.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=mt.newInvalidDocument(t);return Br(e).ee({index:Kc,range:IDBKeyRange.only(Ia(t))},((r,i)=>{s=this.Cr(t,i)})).next((()=>s))}vr(e,t){let s={size:0,document:mt.newInvalidDocument(t)};return Br(e).ee({index:Kc,range:IDBKeyRange.only(Ia(t))},((r,i)=>{s={document:this.Cr(t,i),size:Ku(i)}})).next((()=>s))}getEntries(e,t){let s=wn();return this.Fr(e,t,((r,i)=>{const o=this.Cr(r,i);s=s.insert(r,o)})).next((()=>s))}Mr(e,t){let s=wn(),r=new ht(se.comparator);return this.Fr(e,t,((i,o)=>{const a=this.Cr(i,o);s=s.insert(i,a),r=r.insert(i,Ku(o))})).next((()=>({documents:s,Or:r})))}Fr(e,t,s){if(t.isEmpty())return x.resolve();let r=new Ye(Wv);t.forEach((l=>r=r.add(l)));const i=IDBKeyRange.bound(Ia(r.first()),Ia(r.last())),o=r.getIterator();let a=o.getNext();return Br(e).ee({index:Kc,range:i},((l,u,h)=>{const d=se.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Wv(a,d)<0;)s(a,null),a=o.getNext();a&&a.isEqual(d)&&(s(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Ia(a)):h.done()})).next((()=>{for(;a;)s(a,null),a=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,s,r,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),qu(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Br(e).J(IDBKeyRange.bound(a,l,!0)).next((u=>{i?.incrementDocumentReadCount(u.length);let h=wn();for(const d of u){const p=this.Cr(se.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);p.isFoundDocument()&&(Zl(t,p)||r.has(p.key))&&(h=h.insert(p.key,p))}return h}))}getAllFromCollectionGroup(e,t,s,r){let i=wn();const o=zv(t,s),a=zv(t,An.max());return Br(e).ee({index:wb,range:IDBKeyRange.bound(o,a,!0)},((l,u,h)=>{const d=this.Cr(se.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(d.key,d),i.size===r&&h.done()})).next((()=>i))}newChangeBuffer(e){return new XM(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return Hv(e).get(Df).next((t=>(de(!!t,20021),t)))}Dr(e,t){return Hv(e).put(Df,t)}Cr(e,t){if(t){const s=MM(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(ge.min())))return s}return mt.newInvalidDocument(e)}}function MA(n){return new YM(n)}class XM extends VA{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new js((s=>s.toString()),((s,r)=>s.isEqual(r)))}applyChanges(e){const t=[];let s=0,r=new Ye(((i,o)=>we(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Pv(this.Nr.serializer,o);r=r.add(i.path.popLast());const u=Ku(l);s+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(s-=a.size,this.trackRemovals){const l=Pv(this.Nr.serializer,o.convertToNoDocument(ge.min()));t.push(this.Nr.addEntry(e,i,l))}})),r.forEach((i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Nr.updateMetadata(e,s)),x.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:r})=>(r.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:s.get(i).readTime})})),s)))}}function Hv(n){return Pt(n,bl)}function Br(n){return Pt(n,Ou)}function Ia(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zv(n,e){const t=e.documentKey.path.toArray();return[n,qu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Wv(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=we(t[i],s[i]),r)return r;return r=we(t.length,s.length),r||(r=we(t[t.length-2],s[s.length-2]),r||we(t[t.length-1],s[s.length-1]))}class JM{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class LA{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&tl(s.mutation,r,Nn.empty(),Qe.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Ce()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Ce()){const r=is();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=Na();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=is();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Ce())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,s,r){let i=wn();const o=el(),a=(function(){return el()})();return t.forEach(((l,u)=>{const h=s.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof Nr)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),tl(h.mutation,u,h.mutation.getFieldMask(),Qe.now())):o.set(u.key,Nn.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new JM(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const s=el();let r=new ht(((o,a)=>o-a)),i=Ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=s.get(l)||Nn.empty();h=a.applyToLocalView(u,h),s.set(l,h);const d=(r.get(a.batchId)||Ce()).add(l);r=r.insert(a.batchId,d)}))})).next((()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=Zb();h.forEach((p=>{if(!i.has(p)){const g=oA(t.get(p),s.get(p));g!==null&&d.set(p,g),i=i.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return x.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):nM(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):x.resolve(is());let a=El,l=i;return o.next((u=>x.forEach(u,((h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?x.resolve():this.remoteDocumentCache.getEntry(e,h).next((p=>{l=l.insert(h,p)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Ce()))).next((h=>({batchId:a,changes:Jb(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next((s=>{let r=Na();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Na();return this.indexManager.getCollectionParents(e,i).next((a=>x.forEach(a,(l=>{const u=(function(d,p){return new Mh(p,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next((h=>{h.forEach(((d,p)=>{o=o.insert(d,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,mt.newInvalidDocument(h)))}));let a=Na();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&tl(h.mutation,u,Nn.empty(),Qe.now()),Zl(t,u)&&(a=a.insert(l,u))})),a}))}}class ZM{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return x.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:cn(r.createTime)}})(t)),x.resolve()}getNamedQuery(e,t){return x.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:AA(r.bundledQuery),readTime:cn(r.readTime)}})(t)),x.resolve()}}class eL{constructor(){this.overlays=new ht(se.comparator),this.qr=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){const s=is();return x.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),x.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),x.resolve()}getOverlaysForCollection(e,t,s){const r=is(),i=t.length+1,o=new se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return x.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new ht(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let h=i.get(u.largestBatchId);h===null&&(h=is(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=is(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=r)););return x.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new Fm(t,s));let i=this.qr.get(t);i===void 0&&(i=Ce(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}class tL{constructor(){this.sessionToken=Tt.EMPTY_BYTE_STRING}getSessionToken(e){return x.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,x.resolve()}}class jm{constructor(){this.Qr=new Ye(Dt.$r),this.Ur=new Ye(Dt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Dt(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new Dt(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new se(new Je([])),s=new Dt(t,e),r=new Dt(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new se(new Je([])),s=new Dt(t,e),r=new Dt(t,e+1);let i=Ce();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new Dt(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Dt{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||we(e.Yr,t.Yr)}static Kr(e,t){return we(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}class nL{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ye(Dt.$r)}checkEmpty(e){return x.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Mm(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new Dt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return x.resolve(o)}lookupMutationBatch(e,t){return x.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return x.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(this.mutationQueue.length===0?ri:this.tr-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Dt(t,0),r=new Dt(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const a=this.Xr(o.Yr);i.push(a)})),x.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ye(we);return t.forEach((r=>{const i=new Dt(r,0),o=new Dt(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(a=>{s=s.add(a.Yr)}))})),x.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;se.isDocumentKey(i)||(i=i.child(""));const o=new Dt(new se(i),0);let a=new Ye(we);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)}),o),x.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){de(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return x.forEach(t.mutations,(r=>{const i=new Dt(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new Dt(t,0),r=this.Zr.firstAfterOrEqual(s);return x.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,x.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sL{constructor(e){this.ri=e,this.docs=(function(){return new ht(se.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return x.resolve(s?s.document.mutableCopy():mt.newInvalidDocument(t))}getEntries(e,t){let s=wn();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():mt.newInvalidDocument(r))})),x.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=wn();const o=t.path,a=new se(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||bm(yb(h),s)<=0||(r.has(h.key)||Zl(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return x.resolve(i)}getAllFromCollectionGroup(e,t,s,r){ue(9500)}ii(e,t){return x.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new rL(this)}getSize(e){return x.resolve(this.size)}}class rL extends VA{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),x.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class iL{constructor(e){this.persistence=e,this.si=new js((t=>_i(t)),Xl),this.lastRemoteSnapshotVersion=ge.min(),this.highestTargetId=0,this.oi=0,this._i=new jm,this.targetCount=0,this.ai=Ei.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),x.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ei(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Pr(t),x.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),x.waitFor(i).next((()=>r))}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return x.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),x.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),x.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),x.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return x.resolve(s)}containsKey(e,t){return x.resolve(this._i.containsKey(t))}}class Km{constructor(e,t){this.ui={},this.overlays={},this.ci=new Pn(0),this.li=!1,this.li=!0,this.hi=new tL,this.referenceDelegate=e(this),this.Pi=new iL(this),this.indexManager=new KM,this.remoteDocumentCache=(function(r){return new sL(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new wA(t),this.Ii=new ZM(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new eL,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new nL(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Q("MemoryPersistence","Starting transaction:",e);const r=new oL(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return x.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class oL extends Eb{constructor(e){super(),this.currentSequenceNumber=e}}class Kh{constructor(e){this.persistence=e,this.Ri=new jm,this.Vi=null}static mi(e){return new Kh(e)}get fi(){if(this.Vi)return this.Vi;throw ue(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),x.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),x.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.fi,(s=>{const r=se.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,ge.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return x.or([()=>x.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Gu{constructor(e,t){this.persistence=e,this.pi=new js((s=>Jt(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=OA(this,t)}static mi(e,t){return new Gu(e,t)}Ei(){}di(e){return x.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return x.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?x.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((a=>{a||(s++,i.removeEntry(o,ge.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),x.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),x.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),x.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),x.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Hc(e.data.value)),t}br(e,t,s){return x.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return x.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class aL{constructor(e){this.serializer=e}k(e,t,s,r){const i=new Ph("createOrUpgrade",t);s<1&&r>=1&&((function(l){l.createObjectStore(Yl)})(e),(function(l){l.createObjectStore(wl,{keyPath:yV}),l.createObjectStore(Mn,{keyPath:iv,autoIncrement:!0}).createIndex(Jr,ov,{unique:!0}),l.createObjectStore(bo)})(e),Qv(e),(function(l){l.createObjectStore(Gr)})(e));let o=x.resolve();return s<3&&r>=3&&(s!==0&&((function(l){l.deleteObjectStore(So),l.deleteObjectStore(Ao),l.deleteObjectStore(ii)})(e),Qv(e)),o=o.next((()=>(function(l){const u=l.store(ii),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ge.min().toTimestamp(),targetCount:0};return u.put(Vu,h)})(i)))),s<4&&r>=4&&(s!==0&&(o=o.next((()=>(function(l,u){return u.store(Mn).J().next((d=>{l.deleteObjectStore(Mn),l.createObjectStore(Mn,{keyPath:iv,autoIncrement:!0}).createIndex(Jr,ov,{unique:!0});const p=u.store(Mn),g=d.map((b=>p.put(b)));return x.waitFor(g)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(Ro,{keyPath:RV})})(e)}))),s<5&&r>=5&&(o=o.next((()=>this.yi(i)))),s<6&&r>=6&&(o=o.next((()=>((function(l){l.createObjectStore(bl)})(e),this.wi(i))))),s<7&&r>=7&&(o=o.next((()=>this.Si(i)))),s<8&&r>=8&&(o=o.next((()=>this.bi(e,i)))),s<9&&r>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&r>=10&&(o=o.next((()=>this.Di(i)))),s<11&&r>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(kh,{keyPath:CV})})(e),(function(l){l.createObjectStore(xh,{keyPath:PV})})(e)}))),s<12&&r>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(Dh,{keyPath:MV});u.createIndex(Vf,LV,{unique:!1}),u.createIndex(Rb,FV,{unique:!1})})(e)}))),s<13&&r>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore(Ou,{keyPath:EV});u.createIndex(Kc,IV),u.createIndex(wb,TV)})(e))).next((()=>this.Ci(e,i))).next((()=>e.deleteObjectStore(Gr)))),s<14&&r>=14&&(o=o.next((()=>this.Fi(e,i)))),s<15&&r>=15&&(o=o.next((()=>(function(l){l.createObjectStore(Rm,{keyPath:NV,autoIncrement:!0}).createIndex(Of,kV,{unique:!1}),l.createObjectStore(Ya,{keyPath:xV}).createIndex(Ab,DV,{unique:!1}),l.createObjectStore(Xa,{keyPath:OV}).createIndex(Sb,VV,{unique:!1})})(e)))),s<16&&r>=16&&(o=o.next((()=>{t.objectStore(Ya).clear()})).next((()=>{t.objectStore(Xa).clear()}))),s<17&&r>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(Cm,{keyPath:UV})})(e)}))),s<18&&r>=18&&cT()&&(o=o.next((()=>{t.objectStore(Ya).clear()})).next((()=>{t.objectStore(Xa).clear()}))),o}wi(e){let t=0;return e.store(Gr).ee(((s,r)=>{t+=Ku(r)})).next((()=>{const s={byteSize:t};return e.store(bl).put(Df,s)}))}yi(e){const t=e.store(wl),s=e.store(Mn);return t.J().next((r=>x.forEach(r,(i=>{const o=IDBKeyRange.bound([i.userId,ri],[i.userId,i.lastAcknowledgedBatchId]);return s.J(Jr,o).next((a=>x.forEach(a,(l=>{de(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=zr(this.serializer,l);return PA(e,i.userId,u).next((()=>{}))}))))}))))}Si(e){const t=e.store(So),s=e.store(Gr);return e.store(ii).get(Vu).next((r=>{const i=[];return s.ee(((o,a)=>{const l=new Je(o),u=(function(d){return[0,Jt(d)]})(l);i.push(t.get(u).next((h=>h?x.resolve():(d=>t.put({targetId:0,path:Jt(d),sequenceNumber:r.highestListenSequenceNumber}))(l))))})).next((()=>x.waitFor(i)))}))}bi(e,t){e.createObjectStore(Al,{keyPath:SV});const s=t.store(Al),r=new qm,i=o=>{if(r.add(o)){const a=o.lastSegment(),l=o.popLast();return s.put({collectionId:a,parent:Jt(l)})}};return t.store(Gr).ee({X:!0},((o,a)=>{const l=new Je(o);return i(l.popLast())})).next((()=>t.store(bo).ee({X:!0},(([o,a,l],u)=>{const h=rs(a);return i(h.popLast())}))))}Di(e){const t=e.store(Ao);return t.ee(((s,r)=>{const i=xa(r),o=bA(this.serializer,i);return t.put(o)}))}Ci(e,t){const s=t.store(Gr),r=[];return s.ee(((i,o)=>{const a=t.store(Ou),l=(function(d){return d.document?new se(Je.fromString(d.document.name).popFirst(5)):d.noDocument?se.fromSegments(d.noDocument.path):d.unknownDocument?se.fromSegments(d.unknownDocument.path):ue(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))})).next((()=>x.waitFor(r)))}Fi(e,t){const s=t.store(Mn),r=MA(this.serializer),i=new Km(Kh.mi,this.serializer.yt);return s.J().next((o=>{const a=new Map;return o.forEach((l=>{let u=a.get(l.userId)??Ce();zr(this.serializer,l).keys().forEach((h=>u=u.add(h))),a.set(l.userId,u)})),x.forEach(a,((l,u)=>{const h=new on(u),d=qh.wt(this.serializer,h),p=i.getIndexManager(h),g=jh.wt(h,this.serializer,p,i.referenceDelegate);return new LA(r,g,d,p).recalculateAndSaveOverlaysForDocumentKeys(new Mf(t,Pn.ce),l).next()}))}))}}function Qv(n){n.createObjectStore(So,{keyPath:bV}).createIndex(Sm,AV,{unique:!0}),n.createObjectStore(Ao,{keyPath:"targetId"}).createIndex(bb,wV,{unique:!0}),n.createObjectStore(ii)}const Zs="IndexedDbPersistence",Ud=18e5,Bd=5e3,$d="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",lL="main";class Gm{constructor(e,t,s,r,i,o,a,l,u,h,d=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=d,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Gm.v())throw new le(j.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new QM(this,r),this.$i=t+lL,this.serializer=new wA(l),this.Ui=new yr(this.$i,this.Ni,new aL(this.serializer)),this.hi=new FM,this.Pi=new HM(this.referenceDelegate,this.serializer),this.remoteDocumentCache=MA(this.serializer),this.Ii=new LM,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&ln(Zs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new le(j.FAILED_PRECONDITION,$d);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Pn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Rc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(Pr(e))return Q(Zs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Q(Zs,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Ta(e).get(Li).next((t=>x.resolve(this.es(t))))}ts(e){return Rc(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ud)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=Pt(t,Ro);return s.J().next((r=>{const i=this.ss(r,Ud),o=r.filter((a=>i.indexOf(a)===-1));return x.forEach(o,(a=>s.delete(a.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?x.resolve(!0):Ta(e).get(Li).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Bd)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new le(j.FAILED_PRECONDITION,$d);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rc(e).J().next((s=>this.ss(s,Bd).find((r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(i||o&&a)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&Q(Zs,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Yl,Ro],(e=>{const t=new Mf(e,Pn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Rc(e).J().next((t=>this.ss(t,Ud).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return jh.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new GM(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return qh.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){Q(Zs,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?qV:l===17?kb:l===16?$V:l===15?Pm:l===14?Nb:l===13?Pb:l===12?BV:l===11?Cb:void ue(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,r,i,(a=>(o=new Mf(a,this.ci?this.ci.next():Pn.ce),t==="readwrite-primary"?this.Hi(o).next((l=>!!l||this.Yi(o))).next((l=>{if(!l)throw ln(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new le(j.FAILED_PRECONDITION,vb);return s(o)})).next((l=>this.Xi(o).next((()=>l)))):this.Is(o).next((()=>s(o)))))).then((a=>(o.raiseOnCommittedEvent(),a)))}Is(e){return Ta(e).get(Li).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Bd)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new le(j.FAILED_PRECONDITION,$d)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ta(e).put(Li,t)}static v(){return yr.v()}Zi(e){const t=Ta(e);return t.get(Li).next((s=>this.es(s)?(Q(Zs,"Releasing primary lease."),t.delete(Li)):x.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(ln(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;lT()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return Q(Zs,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return ln(Zs,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){ln("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ta(n){return Pt(n,Yl)}function Rc(n){return Pt(n,Ro)}function cL(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Hm{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Ce(),r=Ce();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Hm(e,t.fromCache,s,r)}}class uL{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class FA{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return lT()?8:Ib(Ct())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new uL;return this.Ss(e,t,o).next((a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(Ki()<=xe.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",Gi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),x.resolve()):(Ki()<=xe.DEBUG&&Q("QueryEngine","Query:",Gi(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Ki()<=xe.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",Gi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xn(t))):x.resolve())}ys(e,t){if(vv(t))return x.resolve(null);let s=xn(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=qf(t,null,"F"),s=xn(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=Ce(...i);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,s).next((l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,qf(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,s,r){return vv(t)||r.isEqual(ge.min())?x.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?x.resolve(null):(Ki()<=xe.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Gi(t)),this.vs(e,o,t,hV(r,El)).next((a=>a)))}))}Ds(e,t){let s=new Ye(Yb(e));return t.forEach(((r,i)=>{Zl(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return Ki()<=xe.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",Gi(t)),this.ps.getDocumentsMatchingQuery(e,t,An.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const zm="LocalStore",hL=3e8;class dL{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new ht(we),this.xs=new js((i=>_i(i)),Xl),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LA(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function UA(n,e,t,s){return new dL(n,e,t,s)}async function BA(n,e){const t=be(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],a=[];let l=Ce();for(const u of r){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function fL(n,e){const t=be(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const d=u.batch,p=d.keys();let g=x.resolve();return p.forEach((b=>{g=g.next((()=>h.getEntry(l,b))).next((C=>{const V=u.docVersions.get(b);de(V!==null,48541),C.version.compareTo(V)<0&&(d.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),h.addEntry(C)))}))})),g.next((()=>a.mutationQueue.removeMutationBatch(l,d)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let l=Ce();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function $A(n){const e=be(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function pL(n,e){const t=be(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach(((h,d)=>{const p=r.get(d);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,d).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,d))));let g=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?g=g.withResumeToken(Tt.EMPTY_BYTE_STRING,ge.min()).withLastLimboFreeSnapshotVersion(ge.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,s)),r=r.insert(d,g),(function(C,V,L){return C.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=hL?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(p,g,h)&&a.push(t.Pi.updateTargetData(i,g))}));let l=wn(),u=Ce();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(mL(i,o,e.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!s.isEqual(ge.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((d=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));a.push(h)}return x.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function mL(n,e,t){let s=Ce(),r=Ce();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=wn();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(ge.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Q(zm,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:r}}))}function gL(n,e){const t=be(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=ri),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function _L(n,e){const t=be(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,x.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new Ss(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Yf(n,e,t){const s=be(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Pr(o))throw o;Q(zm,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Yv(n,e,t){const s=be(n);let r=ge.min(),i=Ce();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const d=be(l),p=d.xs.get(h);return p!==void 0?x.resolve(d.Ms.get(p)):d.Pi.getTargetData(u,h)})(s,o,xn(e)).next((a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:ge.min(),t?i:Ce()))).next((a=>(yL(s,rM(e),a),{documents:a,Qs:i})))))}function yL(n,e,t){let s=n.Os.get(e)||ge.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}class Xv{constructor(){this.activeTargetIds=uM()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qA{constructor(){this.Mo=new Xv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Xv,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class vL{Oo(e){}shutdown(){}}const Jv="ConnectivityMonitor";class Zv{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Q(Jv,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Q(Jv,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Cc=null;function Xf(){return Cc===null?Cc=(function(){return 268435456+Math.round(2147483648*Math.random())})():Cc++,"0x"+Cc.toString(16)}const qd="RestConnection",EL={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class IL{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Mu?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=Xf(),a=this.zo(e,t.toUriEncodedString());Q(qd,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),h=Rr(u);return this.Jo(e,a,l,s,h).then((d=>(Q(qd,`Received RPC '${e}' ${o}: `,d),d)),(d=>{throw vl(qd,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",s),d}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Go})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=EL[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class TL{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Kt="WebChannelConnection";class wL extends IL{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=Xf();return new Promise(((a,l)=>{const u=new ub;u.setWithCredentials(!0),u.listenOnce(hb.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case $c.NO_ERROR:const d=u.getResponseJson();Q(Kt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case $c.TIMEOUT:Q(Kt,`RPC '${e}' ${o} timed out`),l(new le(j.DEADLINE_EXCEEDED,"Request time out"));break;case $c.HTTP_ERROR:const p=u.getStatus();if(Q(Kt,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const b=g?.error;if(b&&b.status&&b.message){const C=(function(L){const F=L.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(F)>=0?F:j.UNKNOWN})(b.status);l(new le(C,b.message))}else l(new le(j.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new le(j.UNAVAILABLE,"Connection failed."));break;default:ue(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Q(Kt,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);Q(Kt,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=Xf(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=pb(),a=fb(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");Q(Kt,`Creating RPC '${e}' stream ${r}: ${h}`,l);const d=o.createWebChannel(h,l);this.I_(d);let p=!1,g=!1;const b=new TL({Yo:V=>{g?Q(Kt,`Not sending because RPC '${e}' stream ${r} is closed:`,V):(p||(Q(Kt,`Opening RPC '${e}' stream ${r} transport.`),d.open(),p=!0),Q(Kt,`RPC '${e}' stream ${r} sending:`,V),d.send(V))},Zo:()=>d.close()}),C=(V,L,F)=>{V.listen(L,(D=>{try{F(D)}catch(P){setTimeout((()=>{throw P}),0)}}))};return C(d,Pa.EventType.OPEN,(()=>{g||(Q(Kt,`RPC '${e}' stream ${r} transport opened.`),b.o_())})),C(d,Pa.EventType.CLOSE,(()=>{g||(g=!0,Q(Kt,`RPC '${e}' stream ${r} transport closed`),b.a_(),this.E_(d))})),C(d,Pa.EventType.ERROR,(V=>{g||(g=!0,vl(Kt,`RPC '${e}' stream ${r} transport errored. Name:`,V.name,"Message:",V.message),b.a_(new le(j.UNAVAILABLE,"The operation could not be completed")))})),C(d,Pa.EventType.MESSAGE,(V=>{if(!g){const L=V.data[0];de(!!L,16349);const F=L,D=F?.error||F[0]?.error;if(D){Q(Kt,`RPC '${e}' stream ${r} received error:`,D);const P=D.status;let q=(function(v){const w=vt[v];if(w!==void 0)return cA(w)})(P),Y=D.message;q===void 0&&(q=j.INTERNAL,Y="Unknown error status: "+P+" with message "+D.message),g=!0,b.a_(new le(q,Y)),d.close()}else Q(Kt,`RPC '${e}' stream ${r} received:`,L),b.u_(L)}})),C(a,db.STAT_EVENT,(V=>{V.stat===Nf.PROXY?Q(Kt,`RPC '${e}' stream ${r} detected buffering proxy`):V.stat===Nf.NOPROXY&&Q(Kt,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function bL(){return typeof window<"u"?window:null}function Xc(){return typeof document<"u"?document:null}function Gh(n){return new SM(n,!0)}class jA{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&Q("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const eE="PersistentStream";class KA{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new jA(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(ln(t.toString()),ln("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new le(j.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Q(eE,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Q(eE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class AL extends KA{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=PM(this.serializer,e),s=(function(i){if(!("targetChange"in i))return ge.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ge.min():o.readTime?cn(o.readTime):ge.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Gf(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=Fu(l)?{documents:_A(i,l)}:{query:yA(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=dA(i,o.resumeToken);const u=jf(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ge.min())>0){a.readTime=Vo(i,o.snapshotVersion.toTimestamp());const u=jf(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const s=kM(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Gf(this.serializer),t.removeTarget=e,this.q_(t)}}class SL extends KA{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return de(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,de(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){de(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=NM(e.writeResults,e.commitTime),s=cn(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Gf(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>$u(this.serializer,s)))};this.q_(t)}}class RL{}class CL extends RL{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new le(j.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,Kf(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new le(j.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,Kf(t,s),r,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new le(j.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class PL{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ln(t),this.aa=!1):Q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ii="RemoteStore";class NL{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{Pi(this)&&(Q(Ii,"Restarting streams for network reachability change."),await(async function(l){const u=be(l);u.Ea.add(4),await tc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Hh(u)})(this))}))})),this.Ra=new PL(s,r)}}async function Hh(n){if(Pi(n))for(const e of n.da)await e(!0)}async function tc(n){for(const e of n.da)await e(!1)}function GA(n,e){const t=be(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Xm(t)?Ym(t):zo(t).O_()&&Qm(t,e))}function Wm(n,e){const t=be(n),s=zo(t);t.Ia.delete(e),s.O_()&&HA(t,e),t.Ia.size===0&&(s.O_()?s.L_():Pi(t)&&t.Ra.set("Unknown"))}function Qm(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ge.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zo(n).Y_(e)}function HA(n,e){n.Va.Ue(e),zo(n).Z_(e)}function Ym(n){n.Va=new TM({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),zo(n).start(),n.Ra.ua()}function Xm(n){return Pi(n)&&!zo(n).x_()&&n.Ia.size>0}function Pi(n){return be(n).Ea.size===0}function zA(n){n.Va=void 0}async function kL(n){n.Ra.set("Online")}async function xL(n){n.Ia.forEach(((e,t)=>{Qm(n,e)}))}async function DL(n,e){zA(n),Xm(n)?(n.Ra.ha(e),Ym(n)):n.Ra.set("Unknown")}async function OL(n,e,t){if(n.Ra.set("Online"),e instanceof hA&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))})(n,e)}catch(s){Q(Ii,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Hu(n,s)}else if(e instanceof Qc?n.Va.Ze(e):e instanceof uA?n.Va.st(e):n.Va.tt(e),!t.isEqual(ge.min()))try{const s=await $A(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(Tt.EMPTY_BYTE_STRING,h.snapshotVersion)),HA(i,l);const d=new Ss(h.target,l,u,h.sequenceNumber);Qm(i,d)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(s){Q(Ii,"Failed to raise snapshot:",s),await Hu(n,s)}}async function Hu(n,e,t){if(!Pr(e))throw e;n.Ea.add(1),await tc(n),n.Ra.set("Offline"),t||(t=()=>$A(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Q(Ii,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Hh(n)}))}function WA(n,e){return e().catch((t=>Hu(n,t,e)))}async function nc(n){const e=be(n),t=Ar(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ri;for(;VL(e);)try{const r=await gL(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,ML(e,r)}catch(r){await Hu(e,r)}QA(e)&&YA(e)}function VL(n){return Pi(n)&&n.Ta.length<10}function ML(n,e){n.Ta.push(e);const t=Ar(n);t.O_()&&t.X_&&t.ea(e.mutations)}function QA(n){return Pi(n)&&!Ar(n).x_()&&n.Ta.length>0}function YA(n){Ar(n).start()}async function LL(n){Ar(n).ra()}async function FL(n){const e=Ar(n);for(const t of n.Ta)e.ea(t.mutations)}async function UL(n,e,t){const s=n.Ta.shift(),r=Lm.from(s,e,t);await WA(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await nc(n)}async function BL(n,e){e&&Ar(n).X_&&await(async function(s,r){if((function(o){return vM(o)&&o!==j.ABORTED})(r.code)){const i=s.Ta.shift();Ar(s).B_(),await WA(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await nc(s)}})(n,e),QA(n)&&YA(n)}async function tE(n,e){const t=be(n);t.asyncQueue.verifyOperationInProgress(),Q(Ii,"RemoteStore received new credentials");const s=Pi(t);t.Ea.add(3),await tc(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Hh(t)}async function $L(n,e){const t=be(n);e?(t.Ea.delete(2),await Hh(t)):e||(t.Ea.add(2),await tc(t),t.Ra.set("Unknown"))}function zo(n){return n.ma||(n.ma=(function(t,s,r){const i=be(t);return i.sa(),new AL(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:kL.bind(null,n),t_:xL.bind(null,n),r_:DL.bind(null,n),H_:OL.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Xm(n)?Ym(n):n.Ra.set("Unknown")):(await n.ma.stop(),zA(n))}))),n.ma}function Ar(n){return n.fa||(n.fa=(function(t,s,r){const i=be(t);return i.sa(),new SL(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:LL.bind(null,n),r_:BL.bind(null,n),ta:FL.bind(null,n),na:UL.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await nc(n)):(await n.fa.stop(),n.Ta.length>0&&(Q(Ii,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Jm{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Ps,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new Jm(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new le(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zm(n,e){if(ln("AsyncQueue",`${e}: ${n}`),Pr(n))return new le(j.UNAVAILABLE,`${e}: ${n}`);throw n}class co{static emptySet(e){return new co(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||se.comparator(t.key,s.key):(t,s)=>se.comparator(t.key,s.key),this.keyedMap=Na(),this.sortedSet=new ht(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof co)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new co;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class nE{constructor(){this.ga=new ht(se.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ue(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Mo{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new Mo(e,t,co.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class qL{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class jL{constructor(){this.queries=sE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=be(t),i=r.queries;r.queries=sE(),i.forEach(((o,a)=>{for(const l of a.Sa)l.onError(s)}))})(this,new le(j.ABORTED,"Firestore shutting down"))}}function sE(){return new js((n=>Qb(n)),Lh)}async function XA(n,e){const t=be(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new qL,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=Zm(o,`Initialization of query '${Gi(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&eg(t)}async function JA(n,e){const t=be(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function KL(n,e){const t=be(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&eg(t)}function GL(n,e,t){const s=be(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function eg(n){n.Ca.forEach((e=>{e.next()}))}var Jf,rE;(rE=Jf||(Jf={})).Ma="default",rE.Cache="cache";class ZA{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Mo(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Mo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Jf.Cache}}class eS{constructor(e){this.key=e}}class tS{constructor(e){this.key=e}}class HL{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ce(),this.mutatedKeys=Ce(),this.eu=Yb(e),this.tu=new co(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new nE,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,d)=>{const p=r.get(h),g=Zl(this.query,d)?d:null,b=!!p&&this.mutatedKeys.has(p.key),C=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let V=!1;p&&g?p.data.isEqual(g.data)?b!==C&&(s.track({type:3,doc:g}),V=!0):this.su(p,g)||(s.track({type:2,doc:g}),V=!0,(l&&this.eu(g,l)>0||u&&this.eu(g,u)<0)&&(a=!0)):!p&&g?(s.track({type:0,doc:g}),V=!0):p&&!g&&(s.track({type:1,doc:p}),V=!0,(l||u)&&(a=!0)),V&&(g?(o=o.add(g),i=C?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,d)=>(function(g,b){const C=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue(20277,{Rt:V})}};return C(g)-C(b)})(h.type,d.type)||this.eu(h.doc,d.doc))),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Mo(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new nE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ce(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new tS(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new eS(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Ce();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Mo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const tg="SyncEngine";class zL{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class WL{constructor(e){this.key=e,this.hu=!1}}class QL{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new js((a=>Qb(a)),Lh),this.Iu=new Map,this.Eu=new Set,this.du=new ht(se.comparator),this.Au=new Map,this.Ru=new jm,this.Vu={},this.mu=new Map,this.fu=Ei.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function YL(n,e,t=!0){const s=aS(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await nS(s,e,t,!0),r}async function XL(n,e){const t=aS(n);await nS(t,e,!0,!1)}async function nS(n,e,t,s){const r=await _L(n.localStore,xn(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await JL(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&GA(n.remoteStore,r),a}async function JL(n,e,t,s,r){n.pu=(d,p,g)=>(async function(C,V,L,F){let D=V.view.ru(L);D.Cs&&(D=await Yv(C.localStore,V.query,!1).then((({documents:I})=>V.view.ru(I,D))));const P=F&&F.targetChanges.get(V.targetId),q=F&&F.targetMismatches.get(V.targetId)!=null,Y=V.view.applyChanges(D,C.isPrimaryClient,P,q);return oE(C,V.targetId,Y.au),Y.snapshot})(n,d,p,g);const i=await Yv(n.localStore,e,!0),o=new HL(e,i.Qs),a=o.ru(i.documents),l=ec.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);oE(n,t,u.au);const h=new zL(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function ZL(n,e,t){const s=be(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Lh(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Yf(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Wm(s.remoteStore,r.targetId),Zf(s,r.targetId)})).catch(Ri)):(Zf(s,r.targetId),await Yf(s.localStore,r.targetId,!0))}async function e2(n,e){const t=be(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Wm(t.remoteStore,s.targetId))}async function t2(n,e,t){const s=lS(n);try{const r=await(function(o,a){const l=be(o),u=Qe.now(),h=a.reduce(((g,b)=>g.add(b.key)),Ce());let d,p;return l.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let b=wn(),C=Ce();return l.Ns.getEntries(g,h).next((V=>{b=V,b.forEach(((L,F)=>{F.isValidDocument()||(C=C.add(L))}))})).next((()=>l.localDocuments.getOverlayedDocuments(g,b))).next((V=>{d=V;const L=[];for(const F of a){const D=_M(F,d.get(F.key).overlayedDocument);D!=null&&L.push(new Nr(F.key,D,$b(D.value.mapValue),fn.exists(!0)))}return l.mutationQueue.addMutationBatch(g,u,L,a)})).next((V=>{p=V;const L=V.applyToLocalDocumentSet(d,C);return l.documentOverlayCache.saveOverlays(g,V.batchId,L)}))})).then((()=>({batchId:p.batchId,changes:Jb(d)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new ht(we)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(s,r.batchId,t),await sc(s,r.changes),await nc(s.remoteStore)}catch(r){const i=Zm(r,"Failed to persist write");t.reject(i)}}async function sS(n,e){const t=be(n);try{const s=await pL(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(de(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?de(o.hu,14607):r.removedDocuments.size>0&&(de(o.hu,42227),o.hu=!1))})),await sc(t,s,e)}catch(s){await Ri(s)}}function iE(n,e,t){const s=be(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)})),(function(o,a){const l=be(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,d)=>{for(const p of d.Sa)p.va(a)&&(u=!0)})),u&&eg(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function n2(n,e,t){const s=be(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new ht(se.comparator);o=o.insert(i,mt.newNoDocument(i,ge.min()));const a=Ce().add(i),l=new $h(ge.min(),new Map,new ht(we),o,a);await sS(s,l),s.du=s.du.remove(i),s.Au.delete(e),ng(s)}else await Yf(s.localStore,e,!1).then((()=>Zf(s,e,t))).catch(Ri)}async function s2(n,e){const t=be(n),s=e.batch.batchId;try{const r=await fL(t.localStore,e);iS(t,s,null),rS(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await sc(t,r)}catch(r){await Ri(r)}}async function r2(n,e,t){const s=be(n);try{const r=await(function(o,a){const l=be(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((d=>(de(d!==null,37113),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(s.localStore,e);iS(s,e,t),rS(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await sc(s,r)}catch(r){await Ri(r)}}function rS(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function iS(n,e,t){const s=be(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function Zf(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||oS(n,s)}))}function oS(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Wm(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),ng(n))}function oE(n,e,t){for(const s of t)s instanceof eS?(n.Ru.addReference(s.key,e),i2(n,s)):s instanceof tS?(Q(tg,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||oS(n,s.key)):ue(19791,{wu:s})}function i2(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(Q(tg,"New document in limbo: "+t),n.Eu.add(s),ng(n))}function ng(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new se(Je.fromString(e)),s=n.fu.next();n.Au.set(s,new WL(t)),n.du=n.du.insert(t,s),GA(n.remoteStore,new Ss(xn(Jl(t.path)),s,"TargetPurposeLimboResolution",Pn.ce))}}async function sc(n,e,t){const s=be(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,l)=>{o.push(s.pu(l,e,t).then((u=>{if((u||t)&&s.isPrimaryClient){const h=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=Hm.As(l.targetId,u);i.push(h)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(l,u){const h=be(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(d=>x.forEach(u,(p=>x.forEach(p.Es,(g=>h.persistence.referenceDelegate.addReference(d,p.targetId,g))).next((()=>x.forEach(p.ds,(g=>h.persistence.referenceDelegate.removeReference(d,p.targetId,g)))))))))}catch(d){if(!Pr(d))throw d;Q(zm,"Failed to update sequence numbers: "+d)}for(const d of u){const p=d.targetId;if(!d.fromCache){const g=h.Ms.get(p),b=g.snapshotVersion,C=g.withLastLimboFreeSnapshotVersion(b);h.Ms=h.Ms.insert(p,C)}}})(s.localStore,i))}async function o2(n,e){const t=be(n);if(!t.currentUser.isEqual(e)){Q(tg,"User change. New user:",e.toKey());const s=await BA(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new le(j.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await sc(t,s.Ls)}}function a2(n,e){const t=be(n),s=t.Au.get(e);if(s&&s.hu)return Ce().add(s.key);{let r=Ce();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function aS(n){const e=be(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=sS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=a2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=n2.bind(null,e),e.Pu.H_=KL.bind(null,e.eventManager),e.Pu.yu=GL.bind(null,e.eventManager),e}function lS(n){const e=be(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=s2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=r2.bind(null,e),e}class Nl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Gh(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return UA(this.persistence,new FA,e.initialUser,this.serializer)}Cu(e){return new Km(Kh.mi,this.serializer)}Du(e){return new qA}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nl.provider={build:()=>new Nl};class l2 extends Nl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){de(this.persistence.referenceDelegate instanceof Gu,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new DA(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ht.withCacheSize(this.cacheSizeBytes):Ht.DEFAULT;return new Km((s=>Gu.mi(s,t)),this.serializer)}}class c2 extends Nl{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await lS(this.xu.syncEngine),await nc(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return UA(this.persistence,new FA,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new DA(s,e.asyncQueue,t)}Mu(e,t){const s=new mV(t,this.persistence);return new pV(e.asyncQueue,s)}Cu(e){const t=cL(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?Ht.withCacheSize(this.cacheSizeBytes):Ht.DEFAULT;return new Gm(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,bL(),Xc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new qA}}class zu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>iE(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=o2.bind(null,this.syncEngine),await $L(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new jL})()}createDatastore(e){const t=Gh(e.databaseInfo.databaseId),s=(function(i){return new wL(i)})(e.databaseInfo);return(function(i,o,a,l){return new CL(i,o,a,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,a){return new NL(s,r,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>iE(this.syncEngine,t,0)),(function(){return Zv.v()?new Zv:new vL})())}createSyncEngine(e,t){return(function(r,i,o,a,l,u,h){const d=new QL(r,i,o,a,l,u);return h&&(d.gu=!0),d})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=be(t);Q(Ii,"RemoteStore shutting down."),s.Ea.add(5),await tc(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}zu.provider={build:()=>new zu};class cS{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ln("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Sr="FirestoreClient";class u2{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=on.UNAUTHENTICATED,this.clientId=Tm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{Q(Sr,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(Q(Sr,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ps;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Zm(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function jd(n,e){n.asyncQueue.verifyOperationInProgress(),Q(Sr,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await BA(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function aE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await h2(n);Q(Sr,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>tE(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>tE(e.remoteStore,r))),n._onlineComponents=e}async function h2(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Q(Sr,"Using user provided OfflineComponentProvider");try{await jd(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===j.FAILED_PRECONDITION||r.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;vl("Error using user provided cache. Falling back to memory cache: "+t),await jd(n,new Nl)}}else Q(Sr,"Using default OfflineComponentProvider"),await jd(n,new l2(void 0));return n._offlineComponents}async function uS(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Q(Sr,"Using user provided OnlineComponentProvider"),await aE(n,n._uninitializedComponentsProvider._online)):(Q(Sr,"Using default OnlineComponentProvider"),await aE(n,new zu))),n._onlineComponents}function d2(n){return uS(n).then((e=>e.syncEngine))}async function ep(n){const e=await uS(n),t=e.eventManager;return t.onListen=YL.bind(null,e.syncEngine),t.onUnlisten=ZL.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=XL.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=e2.bind(null,e.syncEngine),t}function f2(n,e,t={}){const s=new Ps;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new cS({next:p=>{h.Nu(),o.enqueueAndForget((()=>JA(i,d)));const g=p.docs.has(a);!g&&p.fromCache?u.reject(new le(j.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&p.fromCache&&l&&l.source==="server"?u.reject(new le(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new ZA(Jl(a.path),h,{includeMetadataChanges:!0,qa:!0});return XA(i,d)})(await ep(n),n.asyncQueue,e,t,s))),s.promise}function hS(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const lE=new Map;const p2="firestore.googleapis.com",cE=!0;class uE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new le(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=p2,this.ssl=cE}else this.host=e.host,this.ssl=e.ssl??cE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=CA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<xA)throw new le(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}uV("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hS(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new le(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new le(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new le(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dS{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new le(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new le(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new eV;switch(s.type){case"firstParty":return new sV(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new le(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=lE.get(t);s&&(Q("ComponentProvider","Removing Datastore"),lE.delete(t),s.terminate())})(this),Promise.resolve()}}class zh{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new zh(this.firestore,e,this._query)}}class Rt{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rt(this.firestore,e,this._key)}toJSON(){return{type:Rt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Ql(t,Rt._jsonSchema))return new Rt(e,s||null,new se(Je.fromString(t.referencePath)))}}Rt._jsonSchemaVersion="firestore/documentReference/1.0",Rt._jsonSchema={type:Et("string",Rt._jsonSchemaVersion),referencePath:Et("string")};class kl extends zh{constructor(e,t,s){super(e,t,Jl(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rt(this.firestore,null,new se(e))}withConverter(e){return new kl(this.firestore,e,this._path)}}function Wu(n,e,...t){if(n=$t(n),arguments.length===1&&(e=Tm.newId()),cV("doc","path",e),n instanceof dS){const s=Je.fromString(e,...t);return ev(s),new Rt(n,null,new se(s))}{if(!(n instanceof Rt||n instanceof kl))throw new le(j.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Je.fromString(e,...t));return ev(s),new Rt(n.firestore,n instanceof kl?n.converter:null,new se(s))}}const hE="AsyncQueue";class dE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new jA(this,"async_queue_retry"),this._c=()=>{const s=Xc();s&&Q(hE,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=Xc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Xc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ps;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Pr(e))throw e;Q(hE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,ln("INTERNAL UNHANDLED ERROR: ",fE(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Jm.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&ue(47125,{Pc:fE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function fE(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function pE(n){return(function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1})(n,["next","error","complete"])}class Lo extends dS{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new dE,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new dE(e),this._firestoreClient=void 0,await e}}}function m2(n,e,t){t||(t=Mu);const s=yh(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),i=s.getOptions(t);if(vr(i,e))return r;throw new le(j.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new le(j.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<xA)throw new le(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Rr(e.host)&&Dp(e.host),s.initialize({options:e,instanceIdentifier:t})}function sg(n){if(n._terminated)throw new le(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||g2(n),n._firestoreClient}function g2(n){const e=n._freezeSettings(),t=(function(r,i,o,a){return new KV(r,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,hS(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new u2(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}class Cn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cn(Tt.fromBase64String(e))}catch(t){throw new le(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Cn(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Cn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ql(e,Cn._jsonSchema))return Cn.fromBase64String(e.bytes)}}Cn._jsonSchemaVersion="firestore/bytes/1.0",Cn._jsonSchema={type:Et("string",Cn._jsonSchemaVersion),bytes:Et("string")};class rg{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new le(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ig{constructor(e){this._methodName=e}}class us{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new le(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new le(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return we(this._lat,e._lat)||we(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:us._jsonSchemaVersion}}static fromJSON(e){if(Ql(e,us._jsonSchema))return new us(e.latitude,e.longitude)}}us._jsonSchemaVersion="firestore/geoPoint/1.0",us._jsonSchema={type:Et("string",us._jsonSchemaVersion),latitude:Et("number"),longitude:Et("number")};class hs{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:hs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ql(e,hs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new hs(e.vectorValues);throw new le(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}hs._jsonSchemaVersion="firestore/vectorValue/1.0",hs._jsonSchema={type:Et("string",hs._jsonSchemaVersion),vectorValues:Et("object")};const _2=/^__.*__$/;class y2{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Nr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ho(e,this.data,t,this.fieldTransforms)}}function fS(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ue(40011,{Ac:n})}}class og{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new og({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(fS(this.Ac)&&_2.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class v2{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Gh(e)}Cc(e,t,s,r=!1){return new og({Ac:e,methodName:t,Dc:s,path:dt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function E2(n){const e=n._freezeSettings(),t=Gh(n._databaseId);return new v2(n._databaseId,!!e.ignoreUndefinedProperties,t)}function I2(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);_S("Data must be an object, but it was:",o,s);const a=mS(s,o);let l,u;if(i.merge)l=new Nn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const p=T2(e,d,t);if(!o.contains(p))throw new le(j.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);b2(h,p)||h.push(p)}l=new Nn(h),u=o.fieldTransforms.filter((d=>l.covers(d.field)))}else l=null,u=o.fieldTransforms;return new y2(new hn(a),l,u)}class ag extends ig{_toFieldTransform(e){return new iA(e.path,new xo)}isEqual(e){return e instanceof ag}}function pS(n,e){if(gS(n=$t(n)))return _S("Unsupported field value:",e,n),mS(n,e);if(n instanceof ig)return(function(s,r){if(!fS(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const a of s){let l=pS(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=$t(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return hM(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Qe.fromDate(s);return{timestampValue:Vo(r.serializer,i)}}if(s instanceof Qe){const i=new Qe(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Vo(r.serializer,i)}}if(s instanceof us)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Cn)return{bytesValue:dA(r.serializer,s._byteString)};if(s instanceof Rt){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Bm(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof hs)return(function(o,a){return{mapValue:{fields:{[km]:{stringValue:xm},[Co]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Vm(a.serializer,u)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${wm(s)}`)})(n,e)}function mS(n,e){const t={};return xb(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ci(n,((s,r)=>{const i=pS(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function gS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Qe||n instanceof us||n instanceof Cn||n instanceof Rt||n instanceof ig||n instanceof hs)}function _S(n,e,t){if(!gS(t)||!_b(t)){const s=wm(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function T2(n,e,t){if((e=$t(e))instanceof rg)return e._internalPath;if(typeof e=="string")return yS(n,e);throw Qu("Field path arguments must be of type string or ",n,!1,void 0,t)}const w2=new RegExp("[~\\*/\\[\\]]");function yS(n,e,t){if(e.search(w2)>=0)throw Qu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new rg(...e.split("."))._internalPath}catch{throw Qu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qu(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new le(j.INVALID_ARGUMENT,a+n+l)}function b2(n,e){return n.some((t=>t.isEqual(e)))}class vS{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new A2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ES("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class A2 extends vS{data(){return super.data()}}function ES(n,e){return typeof e=="string"?yS(n,e):e instanceof rg?e._internalPath:e._delegate._internalPath}function S2(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new le(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class R2{convertValue(e,t="none"){switch(wr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ut(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Us(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ue(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Ci(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[Co].arrayValue?.values?.map((s=>ut(s.doubleValue)));return new hs(t)}convertGeoPoint(e){return new us(ut(e.latitude),ut(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Oh(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Sl(e));default:return null}}convertTimestamp(e){const t=Fs(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Je.fromString(e);de(TA(s),9688,{name:e});const r=new gi(s.get(1),s.get(3)),i=new se(s.popFirst(5));return r.isEqual(t)||ln(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function C2(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Da{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ai extends vS{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Jc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(ES("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new le(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ai._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ai._jsonSchemaVersion="firestore/documentSnapshot/1.0",ai._jsonSchema={type:Et("string",ai._jsonSchemaVersion),bundleSource:Et("string","DocumentSnapshot"),bundleName:Et("string"),bundle:Et("string")};class Jc extends ai{data(e={}){return super.data(e)}}class uo{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Da(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Jc(this._firestore,this._userDataWriter,s.key,s,new Da(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new le(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((a=>{const l=new Jc(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Da(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new Jc(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Da(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:P2(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new le(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=uo._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Tm.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function P2(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue(61501,{type:n})}}function N2(n){n=_r(n,Rt);const e=_r(n.firestore,Lo);return f2(sg(e),n._key).then((t=>bS(e,n,t)))}uo._jsonSchemaVersion="firestore/querySnapshot/1.0",uo._jsonSchema={type:Et("string",uo._jsonSchemaVersion),bundleSource:Et("string","QuerySnapshot"),bundleName:Et("string"),bundle:Et("string")};class IS extends R2{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rt(this.firestore,null,t)}}function TS(n,e,t){n=_r(n,Rt);const s=_r(n.firestore,Lo),r=C2(n.converter,e,t);return wS(s,[I2(E2(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,fn.none())])}function k2(n){return wS(_r(n.firestore,Lo),[new Bh(n._key,fn.none())])}function x2(n,...e){n=$t(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||pE(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(pE(e[s])){const l=e[s];e[s]=l.next?.bind(l),e[s+1]=l.error?.bind(l),e[s+2]=l.complete?.bind(l)}let i,o,a;if(n instanceof Rt)o=_r(n.firestore,Lo),a=Jl(n._key.path),i={next:l=>{e[s]&&e[s](bS(o,n,l))},error:e[s+1],complete:e[s+2]};else{const l=_r(n,zh);o=_r(l.firestore,Lo),a=l._query;const u=new IS(o);i={next:h=>{e[s]&&e[s](new uo(o,u,l,h))},error:e[s+1],complete:e[s+2]},S2(n._query)}return(function(u,h,d,p){const g=new cS(p),b=new ZA(h,g,d);return u.asyncQueue.enqueueAndForget((async()=>XA(await ep(u),b))),()=>{g.Nu(),u.asyncQueue.enqueueAndForget((async()=>JA(await ep(u),b)))}})(sg(o),a,r,i)}function wS(n,e){return(function(s,r){const i=new Ps;return s.asyncQueue.enqueueAndForget((async()=>t2(await d2(s),r,i))),i.promise})(sg(n),e)}function bS(n,e,t){const s=t.docs.get(e._key),r=new IS(n);return new ai(n,r,e._key,s,new Da(t.hasPendingWrites,t.fromCache),e.converter)}class D2{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=AS(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function O2(n){return new D2(n)}class V2{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zu.provider,this._offlineComponentProvider={build:t=>new c2(t,e?.cacheSizeBytes,this.forceOwnership)}}}function AS(n){return new V2(n?.forceOwnership)}function tp(){return new ag("serverTimestamp")}(function(e,t=!0){(function(r){Go=r})(bi),ci(new Er("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new Lo(new tV(s.getProvider("auth-internal")),new rV(o,s.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new le(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gi(u.options.projectId,h)})(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),ls(Yy,Xy,e),ls(Yy,Xy,"esm2020")})();const M2={apiKey:"AIzaSyDMvSyTEhJGh7a0coyDWCDiAsWCgxE9QsU",authDomain:"realcitytransport.firebaseapp.com",databaseURL:"https://realcitytransport-default-rtdb.firebaseio.com",projectId:"realcitytransport",storageBucket:"realcitytransport.firebasestorage.app",messagingSenderId:"510805652928",appId:"1:510805652928:web:0559bdd8da50af10b7c425",measurementId:"G-JE98MMZMCW"},lg=mT(M2),np=Fk(lg),Yu=m2(lg,{localCache:O2({tabManager:AS()})}),L2=YO(lg),SS=Se(null),wa=Se(null),RS=Se(!1);let mE=!1;mE||(SN(np,n=>{SS.value=n||null,RS.value=!0,n?.uid?console.log("   :  ",n.displayName||n.email):console.log("   :  ")}),mE=!0);function Wh(){return{user:SS,authError:wa,authReady:RS,signInWithGoogle:async()=>{const t=new Ts;try{const s=await zN(np,t);return wa.value=null,console.log("useAuth:  !",s.user.displayName||s.user.email),s.user}catch(s){throw wa.value=s,console.error("useAuth:  :",s),s}},signOutUser:async()=>{try{return await RN(np),wa.value=null,console.log("useAuth:  !"),!0}catch(t){throw wa.value=t,console.error("useAuth:  :",t),t}}}}const Xu=Se(0),sp=Se(!1);let gE=!1,_E=null;function F2(){gE||(gE=!0,_E=BO(L2,"/.info/serverTimeOffset"),qO(_E,n=>{const e=Number(n.val()||0);Xu.value=Number.isFinite(e)?e:0,sp.value=!0},n=>{console.warn("ServerTime: offset subscribe failed:",n),Xu.value=0,sp.value=!0}))}function U2(){return{serverOffsetMs:Xu,isServerTimeReady:sp,serverNowMs:()=>Date.now()+(Xu.value||0)}}const rp=Se(null),ip=Se(!1);let yE=!1;const B2=540*60*1e3;function $2(n){return new Date(n+B2)}function q2(){if(yE)return;yE=!0;const{serverNowMs:n}=U2(),e=()=>{rp.value=$2(n()),ip.value=!0};e(),setInterval(e,1e3)}function CS(){const n=me(()=>ip.value&&rp.value instanceof Date);return{kstDate:rp,isKstTimeReady:ip,isKstReady:n}}const yt=3600,vE=60,ba=8*yt,kr=[{id:"sys_unlock_vehicle",type:"SYSTEM",domain:"vehicle",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ba,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"vehicle"}]},{id:"sys_unlock_route",type:"SYSTEM",domain:"route",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ba,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"route"}]},{id:"sys_unlock_construction",type:"SYSTEM",domain:"construction",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ba,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"construction"}]},{id:"sys_unlock_finance",type:"SYSTEM",domain:"finance",timePolicy:"FIXED",title:"()  ",desc:"  . (  )",tier:1,durationSec:ba,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"finance"}]},{id:"sys_unlock_city",type:"SYSTEM",domain:"city",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ba,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"city"}]},{id:"sys_preview_starter_vehicles",type:"REAL",domain:"vehicle",timePolicy:"SCALABLE",title:"  ",desc:' (//)    .   ""  ,     . (30,  )',tier:1,durationSec:30*vE,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_STARTER_FLEET_PREVIEW",transports:["bus","truck","rail"],runTimeMinSec:30*vE,runTimeMaxSec:3*yt,countPerTransport:1,mode:"MANUAL"}]},{id:"sys_preview_auto_assign",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:"  ",desc:"      . (1,  )",tier:1,durationSec:1*yt,requires:["sys_preview_starter_vehicles"],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_FEATURE",featureKey:"preview_auto_assign"},{type:"SET_PREVIEW_RUN_MODE",mode:"AUTO"}]},{id:"city_scale_region",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  .',tier:1,durationSec:4*yt,requires:["sys_unlock_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"REGION"}]},{id:"city_scale_city",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  . (  )',tier:1,durationSec:8*yt,requires:["city_scale_region"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"CITY"}]},{id:"city_scale_country",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . ( / )',tier:1,durationSec:12*yt,requires:["city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"COUNTRY"}]},{id:"city_scale_state",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:16*yt,requires:["city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"STATE"}]},{id:"city_scale_planet",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:24*yt,requires:["city_scale_state"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"PLANET"}]},{id:"unlock_bus_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*yt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"bus",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"bus",tier:1}]},{id:"unlock_truck_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*yt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"truck",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"truck",tier:1}]},{id:"unlock_rail_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*yt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"rail",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"rail",tier:1}]},{id:"unlock_plane_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*yt,requires:["sys_unlock_city","city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"plane",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"plane",tier:1}]},{id:"unlock_ship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*yt,requires:["sys_unlock_city","city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"ship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"ship",tier:1}]},{id:"unlock_spaceship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:3*yt,requires:["sys_unlock_city","city_scale_planet"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"spaceship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"spaceship",tier:1}]},{id:"rs_1",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  I",desc:"     5% . (SYSTEM  8 )",tier:1,durationSec:1*yt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:1}]},{id:"rs_2",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  II",desc:"     10% . (SYSTEM  8 )",tier:1,durationSec:2*yt,requires:["rs_1"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:2}]},{id:"rs_3",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  III",desc:"     15% . (SYSTEM  8 )",tier:1,durationSec:4*yt,requires:["rs_2"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:3}]},{id:"rs_4",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  IV",desc:"     20% . (SYSTEM  8 )",tier:1,durationSec:8*yt,requires:["rs_3"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:4}]},{id:"rs_5",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  V",desc:"     25% . (SYSTEM  8 )",tier:1,durationSec:16*yt,requires:["rs_4"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:5}]},{id:"t2_transport_foundation",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:" 2  ()",desc:"2   .   .",tier:2,durationSec:12*yt,requires:[],revealAfter:[],enabled:!1,effects:[]}];function cg(n){return kr.find(e=>e.id===n)||null}function Kd(n){return String(Math.max(0,Number(n)||0)).padStart(2,"0")}function EE(n){const e=Math.max(0,Math.floor(Number(n)||0)),t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return{h:t,m:s,sec:r}}function IE({h:n,m:e,sec:t}){return n>0?`${n}h ${Kd(e)}m ${Kd(t)}s`:e>0?`${e}m ${Kd(t)}s`:`${t}s`}function PS(){const n=r=>{const i=Math.max(0,Math.floor(Number(r||0)/1e3));return IE(EE(i))},e=r=>IE(EE(r));return{formatRemainMs:n,formatRemainSec:e,makeRemainLabelFromMs:r=>me(()=>n(r.value)),makeRemainLabelFromSec:r=>me(()=>e(r.value))}}const NS="rcts.research.saveEnabled",kS="rcts.research.autosave.enabled",xS="rcts.research.autosave.base",ug="rcts.research.autosave.intervalMin",{kstDate:DS,isKstTimeReady:OS}=CS(),rc=me(()=>OS.value&&DS.value instanceof Date);function Qh(){return rc.value?DS.value.getTime():Date.now()}const j2=new Set(["sys_unlock_vehicle","sys_unlock_route","sys_unlock_construction","sys_unlock_finance","sys_unlock_city"]);function Ju(n){return!n||!j2.has(n)?!1:cg(n)?.enabled===!1}const gs=Se(null),Zt=Se(new Set),nt=Se(null),at=Se([]),VS=Se({}),MS=Se(1),hg=Se(0),xl=Se(1),Ti=Se(1),Zu=Se("NONE"),eh=Se({vehicle:!1,route:!1,construction:!1,finance:!1,city:!1}),Zc=Se(!1),op=Se(!1),ds=Se(!1),xr=Se(null);let un=null,Ns=!1,eu=null;const li=Se(FS(NS,!0)),Dl=Se(FS(kS,!1)),dg=Se(US(xS,5)),Ol=Se(US(ug,10)),fg=Se(!1),LS=Se(0);let Zr=null;function FS(n,e){const t=localStorage.getItem(n);return t===null?e:t==="1"}function US(n,e){const t=localStorage.getItem(n),s=t==null?NaN:Number(t);return Number.isFinite(s)?s:e}function BS(n,e){localStorage.setItem(n,e?"1":"0")}function ap(n,e){localStorage.setItem(n,String(e))}function Yh(n){const e=Math.max(1,Math.min(3,Number(n||1)));return e===1?1:e===2?3:5}function K2(n){li.value=!!n,BS(NS,li.value),li.value?ic():(un&&(clearTimeout(un),un=null),Fn())}function G2(n){Dl.value=!!n,BS(kS,Dl.value),ic()}function H2(n){const e=Number(n)===10?10:5;dg.value=e,ap(xS,e);const t=Number(Ol.value)||e,s=Math.max(e,Math.round(t/e)*e);Ol.value=s,ap(ug,s),ic(!0)}function z2(n){const e=Number(dg.value)===10?10:5,t=Number(n);if(!Number.isFinite(t)||t<=0)return;const s=Math.max(e,Math.round(t/e)*e);Ol.value=s,ap(ug,s),ic(!0)}function W2(n){const e=Number(n);if(!Number.isFinite(e)||e<=0)return 6e4;const t=e*60*1e3,s=540*60*1e3,r=Date.now()+s,o=(Math.floor(r/t)+1)*t-r;return Math.max(1e3,o)}function Fn(){fg.value=!1,Zr&&(clearTimeout(Zr),Zr=null)}function $S(){if(Zr&&(clearTimeout(Zr),Zr=null),!Dl.value||!li.value||!xr.value||!ds.value||Ns)return Fn();fg.value=!0;const n=Number(Ol.value)||10,e=W2(n);Zr=setTimeout(async()=>{try{await Qn({reason:"autosave"}),LS.value=Date.now()}catch(t){console.error("useResearch:  :",t)}finally{$S()}},e)}function ic(n=!1){n&&Fn(),Dl.value&&li.value&&xr.value&&ds.value&&!Ns?$S():Fn()}function Q2(){un&&(clearTimeout(un),un=null),Fn(),xr.value=null,ds.value=!1,Ns=!1}function Y2(n){return(Array.isArray(n?.requires)?n.requires:[]).every(t=>Zt.value.has(t))}function qS(n){const e=Array.isArray(n?.revealAfter)?n.revealAfter:[];return e.length===0?!0:e.every(t=>Zt.value.has(t))}function pg(n){return Zt.value.has(n)}function X2(n){return!n||Number(n.tier||1)!==1?!1:(n.effects||[]).some(e=>e?.type==="UNLOCK_TRANSPORT_TIER"&&Number(e?.tier||1)===1&&!!e?.transportId)}function jS(n){return n?n.timePolicy==="FIXED"?!0:n.type==="SYSTEM":!1}function J2(n){return n?n.timePolicy==="SCALABLE"?!0:n.timePolicy==null?!jS(n):!1:!1}function th(n){switch(String(n||"").toUpperCase()){case"REGION":return 1;case"CITY":return 2;case"COUNTRY":return 3;case"STATE":return 4;case"PLANET":return 5;default:return 0}}function Wo(){const n={};let e=1,t=0,s=1,r="NONE";const i={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1};for(const l of kr)if(Zt.value.has(l.id))for(const u of l.effects||[]){if(u.type==="UNLOCK_TRANSPORT_TIER"){const h=u.transportId,d=Number(u.tier||1);if(!h)continue;n[h]=Math.max(Number(n[h]||0),d)}if(u.type==="INCOME_MULTIPLIER"&&(e*=Number(u.value||1)),u.type==="RESEARCH_SPEED_LEVEL"){const h=Number(u.level||0);Number.isFinite(h)&&(t=Math.max(t,h))}if(u.type==="QUEUE_RESERVE_LEVEL"){const h=Number(u.level||1);Number.isFinite(h)&&(s=Math.max(s,h))}if(u.type==="UNLOCK_FEATURE"){const h=String(u.featureKey||"");h&&Object.prototype.hasOwnProperty.call(i,h)&&(i[h]=!0)}if(u.type==="SET_CITY_SCALE"){const h=String(u.scale||"").toUpperCase();th(h)>th(r)&&(r=h)}}VS.value=n,MS.value=e,hg.value=t;const o=1-.05*Math.max(0,t);xl.value=Math.max(.2,o),Zu.value=r,eh.value=i,Ti.value=Math.max(1,Math.min(3,s));const a=Yh(Ti.value);at.value.length>a&&(at.value=at.value.slice(0,a))}const Z2=me(()=>kr.filter(n=>Number(n?.tier||1)>=2?!0:qS(n))),eF=me(()=>{const n=new Set;for(const e of kr)if(Number(e.tier||1)===1)for(const t of e.effects||[])t.type==="UNLOCK_TRANSPORT_TIER"&&Number(t.tier||1)===1&&t.transportId&&n.add(t.transportId);return Array.from(n)}),tF=me(()=>!gs.value),nF=me(()=>eF.value.map(n=>({id:n})));function sF(){return Zt.value.has("unlock_bus_t1")||Zt.value.has("unlock_truck_t1")||Zt.value.has("unlock_rail_t1")}function mg(n){const e=cg(n);if(!e)return"unknown";const t=Number(e.tier||1);return t===1&&!qS(e)?"hidden":pg(n)?"done":nt.value?.id===n?"active":at.value.includes(n)?"queued":e.enabled===!1?"comingSoon":n==="sys_preview_starter_vehicles"?!gs.value||!sF()?"locked":"available":t===1&&X2(e)&&gs.value||Y2(e)?"available":"locked"}function KS(n){return kr.find(t=>t.enabled!==!1&&Number(t.tier||1)===1&&(t.effects||[]).some(s=>s.type==="UNLOCK_TRANSPORT_TIER"&&s.transportId===n&&Number(s.tier||1)===1))?.id??null}function GS(){return!(!xr.value||!ds.value||Ns)}function rF(){return li.value?GS():!1}function HS(){const n=Yh(Ti.value);return{version:10,firstUnlockTransportId:gs.value??null,completedResearchIds:Array.from(Zt.value),activeResearch:nt.value?{id:nt.value.id,startedAtMs:nt.value.startedAtMs,endsAtMs:nt.value.endsAtMs}:null,queuedResearchIds:Array.isArray(at.value)?at.value.slice(0,n):[]}}function iF(n){gs.value=typeof n?.firstUnlockTransportId=="string"?n.firstUnlockTransportId:typeof n?.firstUnlockId=="string"?n.firstUnlockId:null;const e=Array.isArray(n?.completedResearchIds)?n.completedResearchIds:[];Zt.value=new Set(e.filter(o=>typeof o=="string"));const t=n?.activeResearch;t&&typeof t=="object"&&typeof t.id=="string"?nt.value={id:t.id,startedAtMs:Number(t.startedAtMs||0),endsAtMs:Number(t.endsAtMs||0)}:nt.value=null;const s=Array.isArray(n?.queuedResearchIds)?n.queuedResearchIds.filter(o=>typeof o=="string"):[],r=typeof n?.queuedResearchId=="string"?n.queuedResearchId:null,i=[];for(const o of s)i.includes(o)||i.push(o);if(r&&!i.includes(r)&&i.push(r),at.value=i,Zt.value.size===0&&Array.isArray(n?.transports)){for(const o of n.transports)if(!(!o||typeof o.id!="string")&&o.locked===!1){const a=KS(o.id);a&&Zt.value.add(a)}}Wo()}async function Qn({reason:n="manual"}={}){if(GS()){un&&(clearTimeout(un),un=null);try{op.value=!0;const e={...HS(),updatedAt:tp(),lastSaveReason:n},t=Wu(Yu,"users",xr.value,"research","state");await TS(t,e,{merge:!0})}catch(e){console.error("useResearch: Firebase  :",e)}finally{op.value=!1}}}const oF=()=>{rF()&&(un&&clearTimeout(un),un=setTimeout(async()=>{await Qn({reason:"debounced"})},800))};function aF(n){if(!n||gs.value)return;const e=KS(n);e&&(gs.value=n,Zt.value.add(e),Wo(),Qn({reason:"firstUnlock"}))}function zS(n){if(Ju(n))return{ok:!1,reason:"COMING_SOON"};const e=cg(n);if(!e)return{ok:!1,reason:"UNKNOWN_RESEARCH"};if(!gs.value)return{ok:!1,reason:"FIRST_UNLOCK_REQUIRED"};if(!rc.value)return{ok:!1,reason:"KST_NOT_READY"};if(pg(n))return{ok:!1,reason:"ALREADY_DONE"};if(e.enabled===!1)return{ok:!1,reason:"COMING_SOON"};const t=mg(n);if(t!=="available")return{ok:!1,reason:t.toUpperCase()};const s=Qh(),r=Number(e.durationSec||0);let i=0;return r>0&&(jS(e)?i=Math.ceil(r):(J2(e),i=Math.ceil(r*xl.value))),i<=0?(Zt.value.add(n),Wo(),Qn({reason:"instantComplete"}),{ok:!0,instant:!0}):(nt.value={id:n,startedAtMs:s,endsAtMs:s+i*1e3},Qn({reason:"startResearch"}),{ok:!0,instant:!1})}function lF(n){if(Ju(n))return{ok:!1,reason:"COMING_SOON"};const e=Yh(Ti.value);if(pg(n))return{ok:!1,reason:"ALREADY_DONE"};if(nt.value?.id===n)return{ok:!1,reason:"ALREADY_ACTIVE"};if(at.value.includes(n))return{ok:!0,queued:!0,alreadyQueued:!0};if(nt.value){if(at.value.length>=e)return{ok:!1,reason:"QUEUE_FULL"};const t=mg(n);return t!=="available"?{ok:!1,reason:t.toUpperCase()}:(at.value=[...at.value,n].slice(0,e),Qn({reason:"queueAdd"}),{ok:!0,queued:!0})}return zS(n)}function cF(n){const e=at.value.slice(),t=e.filter(s=>s!==n);t.length!==e.length&&(at.value=t,Qn({reason:"queueCancel"}))}function uF(){at.value.length!==0&&(at.value=[],Qn({reason:"queueCancelAll"}))}function hF(n){if(!nt.value||nt.value.id!==n||!rc.value)return 0;const e=nt.value.endsAtMs-nt.value.startedAtMs;if(e<=0)return 0;const t=Qh()-nt.value.startedAtMs;return Math.max(0,Math.min(100,t/e*100))}function dF(n){const{formatRemainSec:e}=PS();if(!nt.value||nt.value.id!==n||!rc.value)return"0s";const t=Math.max(0,nt.value.endsAtMs-Qh()),s=Math.floor(t/1e3);return e(s)}function WS(){eu&&(eu(),eu=null),un&&(clearTimeout(un),un=null),Fn(),xr.value=null,ds.value=!1,Ns=!1}function QS(n){if(!n)return;WS(),xr.value=n,Zc.value=!0,ds.value=!1;const e=Wu(Yu,"users",n,"research","state");eu=x2(e,async t=>{Ns=!0;try{if(t.exists())iF(t.data());else{Wo();const s={...HS(),createdAt:tp(),updatedAt:tp(),lastSaveReason:"init"};await TS(e,s,{merge:!0})}}catch(s){console.error("useResearch: onSnapshot apply failed:",s)}finally{Ns=!1,Zc.value=!1,ds.value=!0,ic(!0)}},t=>{Ns=!1,Zc.value=!1,ds.value=!1,Fn(),console.error("useResearch: onSnapshot error:",t)})}async function fF(n){QS(n)}function pF(){Q2(),gs.value=null,Zt.value=new Set,nt.value=null,at.value=[],Zu.value="NONE",eh.value={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1},hg.value=0,xl.value=1,Ti.value=1,Wo()}La(()=>{if(Ns)return;let n=!1;if(nt.value?.id&&Ju(nt.value.id)&&(nt.value=null,n=!0),Array.isArray(at.value)&&at.value.length>0){const e=at.value.filter(t=>!Ju(t));e.length!==at.value.length&&(at.value=e,n=!0)}n&&Qn({reason:"hardLockCleanup"})});La(()=>{if(!rc.value)return;const n=Qh();if(nt.value&&n>=Number(nt.value.endsAtMs||0)){const e=nt.value.id;if(nt.value=null,Zt.value.add(e),Wo(),at.value.length>0){const[t,...s]=at.value;at.value=s;const r=zS(t);r?.ok||console.warn("useResearch: queued next start failed:",t,r?.reason)}Qn({reason:"researchComplete"})}});function Ni(){const n=me(()=>!xr.value||ds.value),e=me(()=>Yh(Ti.value)),t=me(()=>at.value.length),s=me(()=>t.value>=e.value);return{catalog:kr,visibleCatalog:Z2,firstUnlockTransportId:gs,needsFirstUnlockSelection:tF,firstUnlockCandidates:nF,setFirstUnlockTransport:aF,completedIds:Zt,activeResearch:nt,queuedResearchIds:at,queueReserveLevel:Ti,queueLimit:e,queueCount:t,isQueueFull:s,unlockedTransportTiers:VS,incomeMultiplier:MS,researchSpeedLevel:hg,researchDurationMultiplier:xl,cityScale:Zu,unlockedFeatures:eh,hasFeature:o=>!!eh.value?.[o],cityScaleAtLeast:o=>th(Zu.value)>=th(o),getStatus:mg,startResearch:lF,cancelQueuedResearch:cF,cancelAllQueuedResearch:uF,getResearchProgress:hF,getResearchRemainingTime:dF,isKstTimeReady:OS,subscribeForUser:QS,unsubscribe:WS,loadForUser:fF,clearUserState:pF,saveNow:Qn,scheduleSave:oF,saveEnabled:li,setSaveEnabled:K2,autoSaveEnabled:Dl,autoSaveBase:dg,autoSaveIntervalMin:Ol,setAutoSaveEnabled:G2,setAutoSaveBase:H2,setAutoSaveIntervalMin:z2,autoSaveRunning:fg,lastAutoSaveAtMs:LS,isLoadingFirebaseData:Zc,isSavingFirebaseData:op,isStateLoaded:ds,isHydrated:n}}let TE=!1;function mF(){const{user:n,authReady:e}=Wh(),t=Ni(),s=me(()=>n.value?.uid||null);return{start:()=>{TE||(as([e,s],async([i,o],[a,l])=>{i&&(l&&l!==o&&t.unsubscribe(),o?t.subscribeForUser(o):(t.unsubscribe(),t.clearUserState()))},{immediate:!0}),TE=!0)}}}const gF={__name:"App",setup(n){return mF().start(),Rp(()=>{F2(),q2()}),(e,t)=>{const s=ol("router-view");return W(),mo(s)}}};const Qi=typeof document<"u";function YS(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function _F(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&YS(n.default)}const je=Object.assign;function Gd(n,e){const t={};for(const s in e){const r=e[s];t[s]=Yn(r)?r.map(n):n(r)}return t}const nl=()=>{},Yn=Array.isArray;function wE(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}const XS=/#/g,yF=/&/g,vF=/\//g,EF=/=/g,IF=/\?/g,JS=/\+/g,TF=/%5B/g,wF=/%5D/g,ZS=/%5E/g,bF=/%60/g,eR=/%7B/g,AF=/%7C/g,tR=/%7D/g,SF=/%20/g;function gg(n){return n==null?"":encodeURI(""+n).replace(AF,"|").replace(TF,"[").replace(wF,"]")}function RF(n){return gg(n).replace(eR,"{").replace(tR,"}").replace(ZS,"^")}function lp(n){return gg(n).replace(JS,"%2B").replace(SF,"+").replace(XS,"%23").replace(yF,"%26").replace(bF,"`").replace(eR,"{").replace(tR,"}").replace(ZS,"^")}function CF(n){return lp(n).replace(EF,"%3D")}function PF(n){return gg(n).replace(XS,"%23").replace(IF,"%3F")}function NF(n){return PF(n).replace(vF,"%2F")}function Vl(n){if(n==null)return null;try{return decodeURIComponent(""+n)}catch{}return""+n}const kF=/\/$/,xF=n=>n.replace(kF,"");function Hd(n,e,t="/"){let s,r={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return l=a>=0&&l>a?-1:l,l>=0&&(s=e.slice(0,l),i=e.slice(l,a>0?a:e.length),r=n(i.slice(1))),a>=0&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=MF(s??e,t),{fullPath:s+i+o,path:s,query:r,hash:Vl(o)}}function DF(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function bE(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function OF(n,e,t){const s=e.matched.length-1,r=t.matched.length-1;return s>-1&&s===r&&Fo(e.matched[s],t.matched[r])&&nR(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Fo(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function nR(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(var t in n)if(!VF(n[t],e[t]))return!1;return!0}function VF(n,e){return Yn(n)?AE(n,e):Yn(e)?AE(e,n):n?.valueOf()===e?.valueOf()}function AE(n,e){return Yn(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function MF(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),r=s[s.length-1];(r===".."||r===".")&&s.push("");let i=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+s.slice(o).join("/")}const er={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let cp=(function(n){return n.pop="pop",n.push="push",n})({}),zd=(function(n){return n.back="back",n.forward="forward",n.unknown="",n})({});function LF(n){if(!n)if(Qi){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),xF(n)}const FF=/^[^#]+#/;function UF(n,e){return n.replace(FF,"#")+e}function BF(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const Xh=()=>({left:window.scrollX,top:window.scrollY});function $F(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),r=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!r)return;e=BF(r,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function SE(n,e){return(history.state?history.state.position-e:-1)+n}const up=new Map;function qF(n,e){up.set(n,e)}function jF(n){const e=up.get(n);return up.delete(n),e}function KF(n){return typeof n=="string"||n&&typeof n=="object"}function sR(n){return typeof n=="string"||typeof n=="symbol"}let pt=(function(n){return n[n.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",n[n.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",n[n.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",n[n.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",n[n.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",n})({});const rR=Symbol("");pt.MATCHER_NOT_FOUND+"",pt.NAVIGATION_GUARD_REDIRECT+"",pt.NAVIGATION_ABORTED+"",pt.NAVIGATION_CANCELLED+"",pt.NAVIGATION_DUPLICATED+"";function Uo(n,e){return je(new Error,{type:n,[rR]:!0},e)}function ys(n,e){return n instanceof Error&&rR in n&&(e==null||!!(n.type&e))}const GF=["params","query","hash"];function HF(n){if(typeof n=="string")return n;if(n.path!=null)return n.path;const e={};for(const t of GF)t in n&&(e[t]=n[t]);return JSON.stringify(e,null,2)}function zF(n){const e={};if(n===""||n==="?")return e;const t=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<t.length;++s){const r=t[s].replace(JS," "),i=r.indexOf("="),o=Vl(i<0?r:r.slice(0,i)),a=i<0?null:Vl(r.slice(i+1));if(o in e){let l=e[o];Yn(l)||(l=e[o]=[l]),l.push(a)}else e[o]=a}return e}function RE(n){let e="";for(let t in n){const s=n[t];if(t=CF(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(Yn(s)?s.map(r=>r&&lp(r)):[s&&lp(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function WF(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=Yn(s)?s.map(r=>r==null?null:""+r):s==null?s:""+s)}return e}const QF=Symbol(""),CE=Symbol(""),Jh=Symbol(""),_g=Symbol(""),hp=Symbol("");function Aa(){let n=[];function e(s){return n.push(s),()=>{const r=n.indexOf(s);r>-1&&n.splice(r,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ir(n,e,t,s,r,i=o=>o()){const o=s&&(s.enterCallbacks[r]=s.enterCallbacks[r]||[]);return()=>new Promise((a,l)=>{const u=p=>{p===!1?l(Uo(pt.NAVIGATION_ABORTED,{from:t,to:e})):p instanceof Error?l(p):KF(p)?l(Uo(pt.NAVIGATION_GUARD_REDIRECT,{from:e,to:p})):(o&&s.enterCallbacks[r]===o&&typeof p=="function"&&o.push(p),a())},h=i(()=>n.call(s&&s.instances[r],e,t,u));let d=Promise.resolve(h);n.length<3&&(d=d.then(u)),d.catch(p=>l(p))})}function Wd(n,e,t,s,r=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(YS(l)){const u=(l.__vccOpts||l)[e];u&&i.push(ir(u,t,s,o,a,r))}else{let u=l();i.push(()=>u.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const d=_F(h)?h.default:h;o.mods[a]=h,o.components[a]=d;const p=(d.__vccOpts||d)[e];return p&&ir(p,t,s,o,a,r)()}))}}return i}function YF(n,e){const t=[],s=[],r=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>Fo(u,a))?s.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>Fo(u,l))||r.push(l))}return[t,s,r]}let XF=()=>location.protocol+"//"+location.host;function iR(n,e){const{pathname:t,search:s,hash:r}=e,i=n.indexOf("#");if(i>-1){let o=r.includes(n.slice(i))?n.slice(i).length:1,a=r.slice(o);return a[0]!=="/"&&(a="/"+a),bE(a,"")}return bE(t,n)+s+r}function JF(n,e,t,s){let r=[],i=[],o=null;const a=({state:p})=>{const g=iR(n,location),b=t.value,C=e.value;let V=0;if(p){if(t.value=g,e.value=p,o&&o===b){o=null;return}V=C?p.position-C.position:0}else s(g);r.forEach(L=>{L(t.value,b,{delta:V,type:cp.pop,direction:V?V>0?zd.forward:zd.back:zd.unknown})})};function l(){o=t.value}function u(p){r.push(p);const g=()=>{const b=r.indexOf(p);b>-1&&r.splice(b,1)};return i.push(g),g}function h(){if(document.visibilityState==="hidden"){const{history:p}=window;if(!p.state)return;p.replaceState(je({},p.state,{scroll:Xh()}),"")}}function d(){for(const p of i)p();i=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",h),document.removeEventListener("visibilitychange",h)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",h),document.addEventListener("visibilitychange",h),{pauseListeners:l,listen:u,destroy:d}}function PE(n,e,t,s=!1,r=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:r?Xh():null}}function ZF(n){const{history:e,location:t}=window,s={value:iR(n,t)},r={value:e.state};r.value||i(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,h){const d=n.indexOf("#"),p=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:XF()+n+l;try{e[h?"replaceState":"pushState"](u,"",p),r.value=u}catch(g){console.error(g),t[h?"replace":"assign"](p)}}function o(l,u){i(l,je({},e.state,PE(r.value.back,l,r.value.forward,!0),u,{position:r.value.position}),!0),s.value=l}function a(l,u){const h=je({},r.value,e.state,{forward:l,scroll:Xh()});i(h.current,h,!0),i(l,je({},PE(s.value,l,null),{position:h.position+1},u),!1),s.value=l}return{location:s,state:r,push:a,replace:o}}function e4(n){n=LF(n);const e=ZF(n),t=JF(n,e.state,e.location,e.replace);function s(i,o=!0){o||t.pauseListeners(),history.go(i)}const r=je({location:"",base:n,go:s,createHref:UF.bind(null,n)},e,t);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>e.state.value}),r}let ei=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.Group=2]="Group",n})({});var At=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.ParamRegExp=2]="ParamRegExp",n[n.ParamRegExpEnd=3]="ParamRegExpEnd",n[n.EscapeNext=4]="EscapeNext",n})(At||{});const t4={type:ei.Static,value:""},n4=/[a-zA-Z0-9_]/;function s4(n){if(!n)return[[]];if(n==="/")return[[t4]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(g){throw new Error(`ERR (${t})/"${u}": ${g}`)}let t=At.Static,s=t;const r=[];let i;function o(){i&&r.push(i),i=[]}let a=0,l,u="",h="";function d(){u&&(t===At.Static?i.push({type:ei.Static,value:u}):t===At.Param||t===At.ParamRegExp||t===At.ParamRegExpEnd?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:ei.Param,value:u,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function p(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==At.ParamRegExp){s=t,t=At.EscapeNext;continue}switch(t){case At.Static:l==="/"?(u&&d(),o()):l===":"?(d(),t=At.Param):p();break;case At.EscapeNext:p(),t=s;break;case At.Param:l==="("?t=At.ParamRegExp:n4.test(l)?p():(d(),t=At.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case At.ParamRegExp:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=At.ParamRegExpEnd:h+=l;break;case At.ParamRegExpEnd:d(),t=At.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===At.ParamRegExp&&e(`Unfinished custom RegExp for param "${u}"`),d(),o(),r}const NE="[^/]+?",r4={sensitive:!1,strict:!1,start:!0,end:!0};var rn=(function(n){return n[n._multiplier=10]="_multiplier",n[n.Root=90]="Root",n[n.Segment=40]="Segment",n[n.SubSegment=30]="SubSegment",n[n.Static=40]="Static",n[n.Dynamic=20]="Dynamic",n[n.BonusCustomRegExp=10]="BonusCustomRegExp",n[n.BonusWildcard=-50]="BonusWildcard",n[n.BonusRepeatable=-20]="BonusRepeatable",n[n.BonusOptional=-8]="BonusOptional",n[n.BonusStrict=.7000000000000001]="BonusStrict",n[n.BonusCaseSensitive=.25]="BonusCaseSensitive",n})(rn||{});const i4=/[.+*?^${}()[\]/\\]/g;function o4(n,e){const t=je({},r4,e),s=[];let r=t.start?"^":"";const i=[];for(const u of n){const h=u.length?[]:[rn.Root];t.strict&&!u.length&&(r+="/");for(let d=0;d<u.length;d++){const p=u[d];let g=rn.Segment+(t.sensitive?rn.BonusCaseSensitive:0);if(p.type===ei.Static)d||(r+="/"),r+=p.value.replace(i4,"\\$&"),g+=rn.Static;else if(p.type===ei.Param){const{value:b,repeatable:C,optional:V,regexp:L}=p;i.push({name:b,repeatable:C,optional:V});const F=L||NE;if(F!==NE){g+=rn.BonusCustomRegExp;try{`${F}`}catch(P){throw new Error(`Invalid custom RegExp for param "${b}" (${F}): `+P.message)}}let D=C?`((?:${F})(?:/(?:${F}))*)`:`(${F})`;d||(D=V&&u.length<2?`(?:/${D})`:"/"+D),V&&(D+="?"),r+=D,g+=rn.Dynamic,V&&(g+=rn.BonusOptional),C&&(g+=rn.BonusRepeatable),F===".*"&&(g+=rn.BonusWildcard)}h.push(g)}s.push(h)}if(t.strict&&t.end){const u=s.length-1;s[u][s[u].length-1]+=rn.BonusStrict}t.strict||(r+="/?"),t.end?r+="$":t.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const o=new RegExp(r,t.sensitive?"":"i");function a(u){const h=u.match(o),d={};if(!h)return null;for(let p=1;p<h.length;p++){const g=h[p]||"",b=i[p-1];d[b.name]=g&&b.repeatable?g.split("/"):g}return d}function l(u){let h="",d=!1;for(const p of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const g of p)if(g.type===ei.Static)h+=g.value;else if(g.type===ei.Param){const{value:b,repeatable:C,optional:V}=g,L=b in u?u[b]:"";if(Yn(L)&&!C)throw new Error(`Provided param "${b}" is an array but it is not repeatable (* or + modifiers)`);const F=Yn(L)?L.join("/"):L;if(!F)if(V)p.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${b}"`);h+=F}}return h||"/"}return{re:o,score:s,keys:i,parse:a,stringify:l}}function a4(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===rn.Static+rn.Segment?-1:1:n.length>e.length?e.length===1&&e[0]===rn.Static+rn.Segment?1:-1:0}function oR(n,e){let t=0;const s=n.score,r=e.score;for(;t<s.length&&t<r.length;){const i=a4(s[t],r[t]);if(i)return i;t++}if(Math.abs(r.length-s.length)===1){if(kE(s))return 1;if(kE(r))return-1}return r.length-s.length}function kE(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const l4={strict:!1,end:!0,sensitive:!1};function c4(n,e,t){const s=o4(s4(n.path),t),r=je(s,{record:n,parent:e,children:[],alias:[]});return e&&!r.record.aliasOf==!e.record.aliasOf&&e.children.push(r),r}function u4(n,e){const t=[],s=new Map;e=wE(l4,e);function r(d){return s.get(d)}function i(d,p,g){const b=!g,C=DE(d);C.aliasOf=g&&g.record;const V=wE(e,d),L=[C];if("alias"in d){const P=typeof d.alias=="string"?[d.alias]:d.alias;for(const q of P)L.push(DE(je({},C,{components:g?g.record.components:C.components,path:q,aliasOf:g?g.record:C})))}let F,D;for(const P of L){const{path:q}=P;if(p&&q[0]!=="/"){const Y=p.record.path,I=Y[Y.length-1]==="/"?"":"/";P.path=p.record.path+(q&&I+q)}if(F=c4(P,p,V),g?g.alias.push(F):(D=D||F,D!==F&&D.alias.push(F),b&&d.name&&!OE(F)&&o(d.name)),aR(F)&&l(F),C.children){const Y=C.children;for(let I=0;I<Y.length;I++)i(Y[I],F,g&&g.children[I])}g=g||F}return D?()=>{o(D)}:nl}function o(d){if(sR(d)){const p=s.get(d);p&&(s.delete(d),t.splice(t.indexOf(p),1),p.children.forEach(o),p.alias.forEach(o))}else{const p=t.indexOf(d);p>-1&&(t.splice(p,1),d.record.name&&s.delete(d.record.name),d.children.forEach(o),d.alias.forEach(o))}}function a(){return t}function l(d){const p=f4(d,t);t.splice(p,0,d),d.record.name&&!OE(d)&&s.set(d.record.name,d)}function u(d,p){let g,b={},C,V;if("name"in d&&d.name){if(g=s.get(d.name),!g)throw Uo(pt.MATCHER_NOT_FOUND,{location:d});V=g.record.name,b=je(xE(p.params,g.keys.filter(D=>!D.optional).concat(g.parent?g.parent.keys.filter(D=>D.optional):[]).map(D=>D.name)),d.params&&xE(d.params,g.keys.map(D=>D.name))),C=g.stringify(b)}else if(d.path!=null)C=d.path,g=t.find(D=>D.re.test(C)),g&&(b=g.parse(C),V=g.record.name);else{if(g=p.name?s.get(p.name):t.find(D=>D.re.test(p.path)),!g)throw Uo(pt.MATCHER_NOT_FOUND,{location:d,currentLocation:p});V=g.record.name,b=je({},p.params,d.params),C=g.stringify(b)}const L=[];let F=g;for(;F;)L.unshift(F.record),F=F.parent;return{name:V,path:C,params:b,matched:L,meta:d4(L)}}n.forEach(d=>i(d));function h(){t.length=0,s.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:r}}function xE(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function DE(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:h4(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function h4(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function OE(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function d4(n){return n.reduce((e,t)=>je(e,t.meta),{})}function f4(n,e){let t=0,s=e.length;for(;t!==s;){const i=t+s>>1;oR(n,e[i])<0?s=i:t=i+1}const r=p4(n);return r&&(s=e.lastIndexOf(r,s-1)),s}function p4(n){let e=n;for(;e=e.parent;)if(aR(e)&&oR(n,e)===0)return e}function aR({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function VE(n){const e=jn(Jh),t=jn(_g),s=me(()=>{const l=He(n.to);return e.resolve(l)}),r=me(()=>{const{matched:l}=s.value,{length:u}=l,h=l[u-1],d=t.matched;if(!h||!d.length)return-1;const p=d.findIndex(Fo.bind(null,h));if(p>-1)return p;const g=ME(l[u-2]);return u>1&&ME(h)===g&&d[d.length-1].path!==g?d.findIndex(Fo.bind(null,l[u-2])):p}),i=me(()=>r.value>-1&&v4(t.params,s.value.params)),o=me(()=>r.value>-1&&r.value===t.matched.length-1&&nR(t.params,s.value.params));function a(l={}){if(y4(l)){const u=e[He(n.replace)?"replace":"push"](He(n.to)).catch(nl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:s,href:me(()=>s.value.href),isActive:i,isExactActive:o,navigate:a}}function m4(n){return n.length===1?n[0]:n}const g4=vI({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:VE,setup(n,{slots:e}){const t=ch(VE(n)),{options:s}=jn(Jh),r=me(()=>({[LE(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[LE(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&m4(e.default(t));return n.custom?i:HI("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:r.value},i)}}}),_4=g4;function y4(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function v4(n,e){for(const t in e){const s=e[t],r=n[t];if(typeof s=="string"){if(s!==r)return!1}else if(!Yn(r)||r.length!==s.length||s.some((i,o)=>i.valueOf()!==r[o].valueOf()))return!1}return!0}function ME(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const LE=(n,e,t)=>n??e??t,E4=vI({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=jn(hp),r=me(()=>n.route||s.value),i=jn(CE,0),o=me(()=>{let u=He(i);const{matched:h}=r.value;let d;for(;(d=h[u])&&!d.components;)u++;return u}),a=me(()=>r.value.matched[o.value]);kc(CE,me(()=>o.value+1)),kc(QF,a),kc(hp,r);const l=Se();return as(()=>[l.value,a.value,n.name],([u,h,d],[p,g,b])=>{h&&(h.instances[d]=u,g&&g!==h&&u&&u===p&&(h.leaveGuards.size||(h.leaveGuards=g.leaveGuards),h.updateGuards.size||(h.updateGuards=g.updateGuards))),u&&h&&(!g||!Fo(h,g)||!p)&&(h.enterCallbacks[d]||[]).forEach(C=>C(u))},{flush:"post"}),()=>{const u=r.value,h=n.name,d=a.value,p=d&&d.components[h];if(!p)return FE(t.default,{Component:p,route:u});const g=d.props[h],b=g?g===!0?u.params:typeof g=="function"?g(u):g:null,V=HI(p,je({},b,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(d.instances[h]=null)},ref:l}));return FE(t.default,{Component:V,route:u})||V}}});function FE(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const I4=E4;function T4(n){const e=u4(n.routes,n),t=n.parseQuery||zF,s=n.stringifyQuery||RE,r=n.history,i=Aa(),o=Aa(),a=Aa(),l=fC(er);let u=er;Qi&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Gd.bind(null,$=>""+$),d=Gd.bind(null,NF),p=Gd.bind(null,Vl);function g($,ce){let ne,fe;return sR($)?(ne=e.getRecordMatcher($),fe=ce):fe=$,e.addRoute(fe,ne)}function b($){const ce=e.getRecordMatcher($);ce&&e.removeRoute(ce)}function C(){return e.getRoutes().map($=>$.record)}function V($){return!!e.getRecordMatcher($)}function L($,ce){if(ce=je({},ce||l.value),typeof $=="string"){const k=Hd(t,$,ce.path),U=e.resolve({path:k.path},ce),K=r.createHref(k.fullPath);return je(k,U,{params:p(U.params),hash:Vl(k.hash),redirectedFrom:void 0,href:K})}let ne;if($.path!=null)ne=je({},$,{path:Hd(t,$.path,ce.path).path});else{const k=je({},$.params);for(const U in k)k[U]==null&&delete k[U];ne=je({},$,{params:d(k)}),ce.params=d(ce.params)}const fe=e.resolve(ne,ce),Ve=$.hash||"";fe.params=h(p(fe.params));const E=DF(s,je({},$,{hash:RF(Ve),path:fe.path})),A=r.createHref(E);return je({fullPath:E,hash:Ve,query:s===RE?WF($.query):$.query||{}},fe,{redirectedFrom:void 0,href:A})}function F($){return typeof $=="string"?Hd(t,$,l.value.path):je({},$)}function D($,ce){if(u!==$)return Uo(pt.NAVIGATION_CANCELLED,{from:ce,to:$})}function P($){return I($)}function q($){return P(je(F($),{replace:!0}))}function Y($,ce){const ne=$.matched[$.matched.length-1];if(ne&&ne.redirect){const{redirect:fe}=ne;let Ve=typeof fe=="function"?fe($,ce):fe;return typeof Ve=="string"&&(Ve=Ve.includes("?")||Ve.includes("#")?Ve=F(Ve):{path:Ve},Ve.params={}),je({query:$.query,hash:$.hash,params:Ve.path!=null?{}:$.params},Ve)}}function I($,ce){const ne=u=L($),fe=l.value,Ve=$.state,E=$.force,A=$.replace===!0,k=Y(ne,fe);if(k)return I(je(F(k),{state:typeof k=="object"?je({},Ve,k.state):Ve,force:E,replace:A}),ce||ne);const U=ne;U.redirectedFrom=ce;let K;return!E&&OF(s,fe,ne)&&(K=Uo(pt.NAVIGATION_DUPLICATED,{to:U,from:fe}),tn(fe,fe,!0,!1)),(K?Promise.resolve(K):R(U,fe)).catch(B=>ys(B)?ys(B,pt.NAVIGATION_GUARD_REDIRECT)?B:Sn(B):Ne(B,U,fe)).then(B=>{if(B){if(ys(B,pt.NAVIGATION_GUARD_REDIRECT))return I(je({replace:A},F(B.to),{state:typeof B.to=="object"?je({},Ve,B.to.state):Ve,force:E}),ce||U)}else B=N(U,fe,!0,A,Ve);return S(U,fe,B),B})}function v($,ce){const ne=D($,ce);return ne?Promise.reject(ne):Promise.resolve()}function w($){const ce=ee.values().next().value;return ce&&typeof ce.runWithContext=="function"?ce.runWithContext($):$()}function R($,ce){let ne;const[fe,Ve,E]=YF($,ce);ne=Wd(fe.reverse(),"beforeRouteLeave",$,ce);for(const k of fe)k.leaveGuards.forEach(U=>{ne.push(ir(U,$,ce))});const A=v.bind(null,$,ce);return ne.push(A),Xe(ne).then(()=>{ne=[];for(const k of i.list())ne.push(ir(k,$,ce));return ne.push(A),Xe(ne)}).then(()=>{ne=Wd(Ve,"beforeRouteUpdate",$,ce);for(const k of Ve)k.updateGuards.forEach(U=>{ne.push(ir(U,$,ce))});return ne.push(A),Xe(ne)}).then(()=>{ne=[];for(const k of E)if(k.beforeEnter)if(Yn(k.beforeEnter))for(const U of k.beforeEnter)ne.push(ir(U,$,ce));else ne.push(ir(k.beforeEnter,$,ce));return ne.push(A),Xe(ne)}).then(()=>($.matched.forEach(k=>k.enterCallbacks={}),ne=Wd(E,"beforeRouteEnter",$,ce,w),ne.push(A),Xe(ne))).then(()=>{ne=[];for(const k of o.list())ne.push(ir(k,$,ce));return ne.push(A),Xe(ne)}).catch(k=>ys(k,pt.NAVIGATION_CANCELLED)?k:Promise.reject(k))}function S($,ce,ne){a.list().forEach(fe=>w(()=>fe($,ce,ne)))}function N($,ce,ne,fe,Ve){const E=D($,ce);if(E)return E;const A=ce===er,k=Qi?history.state:{};ne&&(fe||A?r.replace($.fullPath,je({scroll:A&&k&&k.scroll},Ve)):r.push($.fullPath,Ve)),l.value=$,tn($,ce,ne,A),Sn()}let T;function he(){T||(T=r.listen(($,ce,ne)=>{if(!re.listening)return;const fe=L($),Ve=Y(fe,re.currentRoute.value);if(Ve){I(je(Ve,{replace:!0,force:!0}),fe).catch(nl);return}u=fe;const E=l.value;Qi&&qF(SE(E.fullPath,ne.delta),Xh()),R(fe,E).catch(A=>ys(A,pt.NAVIGATION_ABORTED|pt.NAVIGATION_CANCELLED)?A:ys(A,pt.NAVIGATION_GUARD_REDIRECT)?(I(je(F(A.to),{force:!0}),fe).then(k=>{ys(k,pt.NAVIGATION_ABORTED|pt.NAVIGATION_DUPLICATED)&&!ne.delta&&ne.type===cp.pop&&r.go(-1,!1)}).catch(nl),Promise.reject()):(ne.delta&&r.go(-ne.delta,!1),Ne(A,fe,E))).then(A=>{A=A||N(fe,E,!1),A&&(ne.delta&&!ys(A,pt.NAVIGATION_CANCELLED)?r.go(-ne.delta,!1):ne.type===cp.pop&&ys(A,pt.NAVIGATION_ABORTED|pt.NAVIGATION_DUPLICATED)&&r.go(-1,!1)),S(fe,E,A)}).catch(nl)}))}let ae=Aa(),Fe=Aa(),Be;function Ne($,ce,ne){Sn($);const fe=Fe.list();return fe.length?fe.forEach(Ve=>Ve($,ce,ne)):console.error($),Promise.reject($)}function Vt(){return Be&&l.value!==er?Promise.resolve():new Promise(($,ce)=>{ae.add([$,ce])})}function Sn($){return Be||(Be=!$,he(),ae.list().forEach(([ce,ne])=>$?ne($):ce()),ae.reset()),$}function tn($,ce,ne,fe){const{scrollBehavior:Ve}=n;if(!Qi||!Ve)return Promise.resolve();const E=!ne&&jF(SE($.fullPath,0))||(fe||!ne)&&history.state&&history.state.scroll||null;return fI().then(()=>Ve($,ce,E)).then(A=>A&&$F(A)).catch(A=>Ne(A,$,ce))}const wt=$=>r.go($);let oe;const ee=new Set,re={currentRoute:l,listening:!0,addRoute:g,removeRoute:b,clearRoutes:e.clearRoutes,hasRoute:V,getRoutes:C,resolve:L,options:n,push:P,replace:q,go:wt,back:()=>wt(-1),forward:()=>wt(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Fe.add,isReady:Vt,install($){$.component("RouterLink",_4),$.component("RouterView",I4),$.config.globalProperties.$router=re,Object.defineProperty($.config.globalProperties,"$route",{enumerable:!0,get:()=>He(l)}),Qi&&!oe&&l.value===er&&(oe=!0,P(r.location).catch(fe=>{}));const ce={};for(const fe in er)Object.defineProperty(ce,fe,{get:()=>l.value[fe],enumerable:!0});$.provide(Jh,re),$.provide(_g,cI(ce)),$.provide(hp,l);const ne=$.unmount;ee.add($),$.unmount=function(){ee.delete($),ee.size<1&&(u=er,T&&T(),T=null,l.value=er,oe=!1,Be=!1),ne()}}};function Xe($){return $.reduce((ce,ne)=>ce.then(()=>w(ne)),Promise.resolve())}return re}function Qo(){return jn(Jh)}function w4(n){return jn(_g)}const mn=(n,e)=>{const t=n.__vccOpts||n;for(const[s,r]of e)t[s]=r;return t},b4={class:"top-bar-area"},A4={class:"top-bar-content"},S4={class:"center-area"},R4={class:"time-value"},C4={class:"right-area"},P4={class:"auth-text"},N4={class:"auth-icon"},k4={__name:"TheTopBar",setup(n){const{kstString:e}=CS(),{user:t,signInWithGoogle:s,signOutUser:r}=Wh();return(i,o)=>(W(),X("header",b4,[_("div",A4,[o[2]||(o[2]=_("div",{class:"left-area"},[_("h1",{class:"game-title"},"RCTS")],-1)),_("div",S4,[o[1]||(o[1]=_("span",{class:"time-label"},"KST",-1)),_("span",R4,ye(He(e)),1)]),_("div",C4,[_("button",{class:"auth-btn",onClick:o[0]||(o[0]=a=>He(t)?He(r)():He(s)())},[_("span",P4,ye(He(t)?"":""),1),_("span",N4,ye(He(t)?"":""),1)])])])]))}},x4=mn(k4,[["__scopeId","data-v-0953860d"]]),D4=["bus","truck","rail","plane","ship","spaceship"],tu={bus:{name:"",icon:""},truck:{name:"",icon:""},rail:{name:"",icon:""},plane:{name:"",icon:""},ship:{name:"",icon:""},spaceship:{name:"",icon:""}};function Pc(n,e=1){const t=Number(e||1);return kr.find(r=>(r.effects||[]).some(i=>i.type==="UNLOCK_TRANSPORT_TIER"&&i.transportId===n&&Number(i.tier||1)===t))?.id??null}function O4(){return kr.filter(t=>(t.effects||[]).some(s=>s?.type==="UNLOCK_STARTER_FLEET_PREVIEW")).map(t=>{const s=(t.effects||[]).find(i=>i?.type==="UNLOCK_STARTER_FLEET_PREVIEW")||null,r=s?{transports:Array.isArray(s.transports)?s.transports.filter(Boolean):[],runTimeMinSec:Number(s.runTimeMinSec||0),runTimeMaxSec:Number(s.runTimeMaxSec||0),countPerTransport:Number(s.countPerTransport||1)}:null;return{researchId:t.id,config:r}})}function lR(){const n=Ni(),e=me(()=>O4()),t=me(()=>{const p=n.completedIds.value,g=e.value||[];return!p||g.length===0?!1:g.some(b=>b?.researchId&&p.has(b.researchId))}),s=me(()=>{const p=n.completedIds.value,g=e.value||[];return g.length&&((p?g.find(C=>C?.researchId&&p.has(C.researchId)):null)?.researchId??g[0]?.researchId)||null}),r=me(()=>{const p=n.completedIds.value,g=e.value||[];return g.length?(p?g.find(C=>C?.researchId&&p.has(C.researchId)):null)?.config??g[0]?.config??null:null}),i=me(()=>{const p=r.value;return p?new Set(p.transports||[]):new Set}),o=me(()=>{const p=i.value,g=t.value;return D4.map(b=>{const C=tu[b]||{},V=C.name??b,L=C.icon??"",D=Number(n.unlockedTransportTiers.value?.[b]||0)<1,P=Pc(b,1),q=!!P&&n.activeResearch.value?.id===P;let Y=null,I=null;q&&n.activeResearch.value&&(Y=new Date(n.activeResearch.value.startedAtMs),I=new Date(n.activeResearch.value.endsAtMs));const v=p.has(b),w=!!g&&!D&&v;return{id:b,name:V,icon:L,locked:D,isResearching:q,researchStartTime:Y,researchFinishTime:I,unlockResearchId:P,previewEligible:v,previewActive:w,previewLabel:w?"  ":null}})}),a=me(()=>o.value.filter(p=>p.locked)),l=me(()=>o.value.filter(p=>!p.locked));function u(p){const g=Pc(p,1);g&&n.startResearch(g)}function h(p){const g=Pc(p,1);return g?n.getResearchProgress(g):0}function d(p){const g=Pc(p,1);return g?n.getResearchRemainingTime(g):"00h 00m 00s"}return{transportTypes:o,lockedTransports:a,unlockedTransports:l,unlockTransport:u,getResearchProgress:h,getResearchRemainingTime:d,previewResearchId:s,previewConfig:r,previewStarterFleetUnlocked:t}}const UE=Se(null);function V4(){return{selectedTransportId:UE,setSelectedTransportId:e=>{UE.value=e}}}const cR="rcts.preview.runs.v2",M4=60,L4=30*M4,F4=3*3600;function U4(n,e){const t=Math.ceil(n),s=Math.floor(e);return Math.floor(Math.random()*(s-t+1))+t}function B4(){try{const n=localStorage.getItem(cR);if(!n)return null;const e=JSON.parse(n);return!e||typeof e!="object"?null:e}catch{return null}}function Sa(n){try{localStorage.setItem(cR,JSON.stringify(n))}catch{}}function tr(n,e){const t={transportId:n,status:"idle",startedAtMs:null,endsAtMs:null,durationSec:0,routeName:" "};if(!e||typeof e!="object")return t;const s=e.status==="running"||e.status==="idle"||e.status==="ready"?e.status:"idle";return{...t,...e,transportId:e.transportId||n,status:s,routeName:e.routeName||" "}}function $4(){const n=Ni(),{transportTypes:e}=lR(),{formatRemainMs:t}=PS(),s=me(()=>!!n.completedIds.value?.has?.("sys_preview_starter_vehicles")),r=me(()=>!!n.completedIds.value?.has?.("sys_preview_auto_assign")),i=me(()=>{const D=e.value||[];return new Set(D.filter(P=>P?.previewActive).map(P=>P.id))}),o=Se({}),a=Se(Date.now()),l=B4();l?.runs&&typeof l.runs=="object"&&(o.value=l.runs),La(()=>{const D=o.value||{};let P=!1;for(const[q,Y]of Object.entries(D)){const I=tr(q,Y);(!Y?.status||Y.status!==I.status||Y.routeName!==I.routeName)&&(D[q]=I,P=!0)}P&&(o.value={...D},Sa({runs:o.value}))});function u(D,P=Date.now()){const q=U4(L4,F4),Y=tr(D,o.value?.[D]);o.value[D]={...Y,transportId:D,status:"running",startedAtMs:P,endsAtMs:P+q*1e3,durationSec:q,routeName:" "}}function h(D=Date.now()){if(!s.value||!r.value)return!1;const P=i.value;if(!P||P.size===0)return!1;let q=!1;for(const Y of P){const I=tr(Y,o.value?.[Y]);if(I.status!=="running")u(Y,D),q=!0;else{const v=Number(I.endsAtMs||0);(!v||v<=D)&&(u(Y,D),q=!0)}}return q&&Sa({runs:o.value}),q}La(()=>{if(!s.value)return;const D=i.value;if(!D||D.size===0)return;let P=!1;for(const q of D)o.value?.[q]||(u(q,Date.now()),P=!0);P&&Sa({runs:o.value}),h(Date.now())});let d=null;function p(){d||(d=setInterval(()=>{if(a.value=Date.now(),!s.value)return;const D=a.value,P=i.value;let q=!1;r.value&&h(D)&&(q=!0);for(const Y of Object.keys(o.value||{})){if(!P.has(Y))continue;const I=tr(Y,o.value[Y]);if(I.status!=="running")continue;const v=Number(I.endsAtMs||0);v&&D>=v&&(r.value?u(Y,D):o.value[Y]={...I,status:"ready",startedAtMs:null,endsAtMs:v,durationSec:I.durationSec||0,routeName:" "},q=!0)}q&&Sa({runs:o.value})},1e3))}function g(){d&&(clearInterval(d),d=null)}La(()=>{if(!s.value){g();return}p(),zR(()=>{g()})});function b(D){const P=a.value;if(!i.value.has(D))return 0;const q=tr(D,o.value?.[D]);if(q.status!=="running")return 0;const Y=Number(q.endsAtMs||0);return Y?Math.max(0,Y-P):0}function C(D){return t(b(D))}function V(D){return i.value.has(D)?tr(D,o.value?.[D]).status:"idle"}function L(D){return!s.value||!i.value.has(D)||r.value||tr(D,o.value?.[D]).status!=="ready"?!1:(u(D,Date.now()),Sa({runs:o.value}),a.value=Date.now(),!0)}const F=me(()=>{const D=i.value;return Object.values(o.value||{}).map(q=>tr(q.transportId,q)).filter(q=>D.has(q.transportId)).sort((q,Y)=>String(q.transportId).localeCompare(String(Y.transportId)))});return{previewUnlocked:s,autoAssignUnlocked:r,runs:o,runList:F,remainingOf:C,statusOf:V,startManualRun:L}}const q4={class:"layout-area left-area"},j4={class:"left-panel-wrapper"},K4={class:"panel transport-list-container"},G4={class:"panel-head"},H4={class:"panel-meta"},z4={key:0,class:"transport-list"},W4=["onClick"],Q4={class:"transport-icon"},Y4={class:"transport-name"},X4={key:1,class:"placeholder-box"},J4={class:"panel transport-details-container"},Z4={class:"panel-head"},eU={class:"panel-heading"},tU={key:0,class:"panel-meta"},nU={key:0,class:"placeholder-box"},sU={key:1,class:"details-content"},rU={class:"kv"},iU={class:"kv-row"},oU={class:"v"},aU={class:"kv-row"},lU={class:"v"},cU={class:"kv-row"},uU={class:"v"},hU={key:0,class:"lock-box"},dU={key:0,class:"preview-placeholder"},fU={key:1,class:"preview-box"},pU={class:"box-desc"},mU={key:0,class:"preview-placeholder"},gU={key:1,class:"preview-data"},_U={class:"preview-left"},yU={class:"preview-title"},vU={class:"preview-sub"},EU={key:0,class:"preview-right"},IU={class:"preview-remain mono"},TU={key:1,class:"preview-right"},wU={key:0,class:"preview-right"},bU={class:"preview-remain mono"},AU={key:1,class:"preview-right"},SU=["onClick"],RU={class:"details-footnote"},CU={class:"panel resource-container"},PU={class:"panel-head"},NU={class:"panel-meta"},kU={key:0,class:"placeholder-box"},xU={key:1,class:"resource-content"},DU={__name:"TheLeftArea",setup(n){const e=Ni(),{transportTypes:t,unlockedTransports:s,previewStarterFleetUnlocked:r,previewConfig:i}=lR(),o=me(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),a=me(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),{selectedTransportId:l,setSelectedTransportId:u}=V4(),h=me(()=>s.value||[]),d=me(()=>l.value&&(t.value||[]).find(D=>D.id===l.value)||null),p=me(()=>{const D=new Set((s.value||[]).map(Y=>Y.id)),P=i.value;return(P&&Array.isArray(P.transports)&&P.transports.length>0?P.transports:["bus","truck","rail"]).some(Y=>D.has(Y))}),{runList:g,remainingOf:b,statusOf:C,startManualRun:V,autoAssignUnlocked:L}=$4();function F(D){return(t.value||[]).find(q=>q.id===D)?.name??D}return(D,P)=>(W(),X("aside",q4,[_("div",j4,[_("section",K4,[_("div",G4,[P[0]||(P[0]=_("h3",{class:"panel-heading"},"  ",-1)),_("span",H4,ye(h.value.length)+"",1)]),h.value.length>0?(W(),X("ul",z4,[(W(!0),X($e,null,Bt(h.value,q=>(W(),X("li",{key:q.id,class:ho(["transport-item",{active:He(l)===q.id}]),onClick:Y=>He(u)(q.id)},[_("span",Q4,ye(q.icon),1),_("span",Y4,ye(q.name),1),P[1]||(P[1]=_("span",{class:"transport-count"},"0",-1))],10,W4))),128))])):(W(),X("div",X4,[...P[2]||(P[2]=[_("p",{class:"placeholder-text"},"     .   . ",-1)])]))]),_("section",J4,[_("div",Z4,[_("h3",eU,ye(d.value?`${d.value.name} `:"  "),1),d.value?(W(),X("span",tU,"ID: "+ye(d.value.id),1)):_t("",!0)]),d.value?(W(),X("div",sU,[_("div",rU,[_("div",iU,[P[4]||(P[4]=_("span",{class:"k"},"",-1)),_("span",oU,ye(d.value.icon),1)]),_("div",aU,[P[5]||(P[5]=_("span",{class:"k"},"",-1)),_("span",lU,ye(d.value.name),1)]),P[7]||(P[7]=_("div",{class:"kv-row"},[_("span",{class:"k"}," "),_("span",{class:"v"},"0")],-1)),_("div",cU,[P[6]||(P[6]=_("span",{class:"k"}," ",-1)),_("span",uU,ye(d.value.locked?"":""),1)])]),P[19]||(P[19]=_("hr",{class:"divider"},null,-1)),He(r)?(W(),X("div",fU,[P[18]||(P[18]=_("p",{class:"box-title"},"   ",-1)),_("p",pU,[P[12]||(P[12]=Ft(" (): ",-1)),_("strong",null,ye(a.value?"":""),1)]),He(g).length===0?(W(),X("div",mU,[...P[13]||(P[13]=[_("p",{class:"placeholder-text"},"      . (/   ) ",-1)])])):(W(),X("div",gU,[(W(!0),X($e,null,Bt(He(g),q=>(W(),X("div",{class:"preview-row",key:q.transportId},[_("div",_U,[_("div",yU,ye(F(q.transportId)),1),_("div",vU,ye(q.routeName),1)]),He(L)?(W(),X($e,{key:0},[He(C)(q.transportId)==="running"?(W(),X("div",EU,[P[14]||(P[14]=_("div",{class:"preview-pill"},"",-1)),_("div",IU,ye(He(b)(q.transportId)),1)])):(W(),X("div",TU,[...P[15]||(P[15]=[_("div",{class:"preview-idle-text"}," ",-1),_("div",{class:"preview-remain mono"},"00:00",-1)])]))],64)):(W(),X($e,{key:1},[He(C)(q.transportId)==="running"?(W(),X("div",wU,[P[16]||(P[16]=_("div",{class:"preview-pill"},"",-1)),_("div",bU,ye(He(b)(q.transportId)),1)])):(W(),X("div",AU,[P[17]||(P[17]=_("div",{class:"preview-idle-text"},"",-1)),_("button",{class:"preview-btn",type:"button",onClick:Y=>He(V)(q.transportId)},"    ",8,SU)]))],64))]))),128))]))])):(W(),X("div",hU,[P[9]||(P[9]=_("p",{class:"box-title"},"    ",-1)),P[10]||(P[10]=_("p",{class:"box-desc"},[Ft("  "),_("strong",null,"  "),Ft("  ,  "),_("strong",null," / "),Ft(" . ")],-1)),P[11]||(P[11]=_("p",{class:"box-desc subtle"}," (    .) ",-1)),p.value?_t("",!0):(W(),X("div",dU,[...P[8]||(P[8]=[_("p",{class:"placeholder-text"}," :           . ",-1)])]))])),_("p",RU,"  "+ye(d.value.name)+"       . ",1)])):(W(),X("div",nU,[...P[3]||(P[3]=[_("p",{class:"placeholder-text"},"     .",-1)])]))]),_("section",CU,[_("div",PU,[P[20]||(P[20]=_("h3",{class:"panel-heading"},"  ",-1)),_("span",NU,ye(o.value?"":""),1)]),o.value?(W(),X("div",xU,[...P[22]||(P[22]=[_("div",{class:"kv"},[_("div",{class:"kv-row"},[_("span",{class:"k"},""),_("span",{class:"v"},"$10,000")])],-1)])])):(W(),X("div",kU,[...P[21]||(P[21]=[_("p",{class:"placeholder-text"}," .",-1)])]))])])]))}},uR=mn(DU,[["__scopeId","data-v-c2ac4b92"]]),OU={class:"layout-area center-area"},VU={class:"center-content-wrapper"},MU={class:"main-content-nav desktop-only","aria-label":"Main navigation"},LU={class:"nav-list"},FU={class:"nav-item"},UU={class:"nav-item"},BU={class:"nav-item"},$U={class:"nav-item"},qU={class:"nav-item"},jU={class:"nav-item"},KU={class:"nav-item"},GU={class:"mobile-nav mobile-only","aria-label":"Mobile navigation header"},HU=["aria-expanded"],zU={class:"mobile-title"},WU={class:"mobile-title-text"},QU={class:"drawer",role:"dialog","aria-modal":"true","aria-label":"Main menu"},YU={class:"drawer-body"},XU={class:"main-content-display"},JU={__name:"TheCenterArea",setup(n){const e=Qo(),t=w4(),s=Se(!1);function r(){s.value=!1}function i(){s.value=!s.value}function o(u){r(),e.push(u)}const a=me(()=>{const u=t.path||"";return u.includes("/home/preview")?" ":u.includes("/home/research")?"":u.includes("/home/vehicles")?"":u.includes("/home/line")?"":u.includes("/home/construction")?"":u.includes("/home/finance")?"":u.includes("/home/city")?"":u.includes("/home/settings")?"":""});as(()=>t.fullPath,()=>{r()});function l(u){u.key==="Escape"&&r()}return as(s,u=>{document.body.style.overflow=u?"hidden":""}),Rp(()=>{window.addEventListener("keydown",l)}),wI(()=>{window.removeEventListener("keydown",l),document.body.style.overflow=""}),(u,h)=>{const d=ol("router-link"),p=ol("router-view");return W(),X("div",OU,[_("div",VU,[_("nav",MU,[_("ul",LU,[_("li",FU,[ze(d,{to:"/home/research"},{default:Vn(()=>[...h[8]||(h[8]=[Ft("",-1)])]),_:1})]),_("li",UU,[ze(d,{to:"/home/vehicles"},{default:Vn(()=>[...h[9]||(h[9]=[Ft("",-1)])]),_:1})]),_("li",BU,[ze(d,{to:"/home/line"},{default:Vn(()=>[...h[10]||(h[10]=[Ft("",-1)])]),_:1})]),_("li",$U,[ze(d,{to:"/home/construction"},{default:Vn(()=>[...h[11]||(h[11]=[Ft("",-1)])]),_:1})]),_("li",qU,[ze(d,{to:"/home/finance"},{default:Vn(()=>[...h[12]||(h[12]=[Ft("",-1)])]),_:1})]),_("li",jU,[ze(d,{to:"/home/city"},{default:Vn(()=>[...h[13]||(h[13]=[Ft("",-1)])]),_:1})]),_("li",KU,[ze(d,{to:"/home/settings"},{default:Vn(()=>[...h[14]||(h[14]=[Ft("",-1)])]),_:1})])])]),_("div",GU,[_("button",{class:"hamburger-btn",type:"button","aria-label":"Open menu","aria-expanded":s.value?"true":"false",onClick:i},[...h[15]||(h[15]=[_("span",{class:"hamburger-icon"},"",-1),_("span",{class:"hamburger-label"},"",-1)])],8,HU),_("div",zU,[_("span",WU,ye(a.value),1)])]),s.value?(W(),X("div",{key:0,class:"drawer-overlay mobile-only",role:"presentation",onClick:YI(r,["self"])},[_("aside",QU,[_("div",{class:"drawer-head"},[h[16]||(h[16]=_("div",{class:"drawer-title"},"RCTS ",-1)),_("button",{class:"drawer-close",type:"button","aria-label":"Close menu",onClick:r},"  ")]),_("div",YU,[_("button",{class:"drawer-item drawer-item-preview",type:"button",onClick:h[0]||(h[0]=g=>o("/home/preview"))},"   "),_("button",{class:"drawer-item",type:"button",onClick:h[1]||(h[1]=g=>o("/home/research"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[2]||(h[2]=g=>o("/home/vehicles"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[3]||(h[3]=g=>o("/home/line"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[4]||(h[4]=g=>o("/home/construction"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[5]||(h[5]=g=>o("/home/finance"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[6]||(h[6]=g=>o("/home/city"))},""),_("button",{class:"drawer-item",type:"button",onClick:h[7]||(h[7]=g=>o("/home/settings"))},"")]),h[17]||(h[17]=_("div",{class:"drawer-foot"},[_("div",{class:"drawer-hint"},"     . ")],-1))])])):_t("",!0),_("div",XU,[ze(p)])])])}}},ZU=mn(JU,[["__scopeId","data-v-6101d703"]]),e6={class:"game-wrapper"},t6={class:"main-layout"},n6={__name:"HomeView",setup(n){return(e,t)=>(W(),X("div",e6,[ze(x4),_("div",t6,[ze(uR,{class:"layout-area left-area desktop-only"}),ze(ZU,{class:"layout-area center-area"})])]))}},s6=mn(n6,[["__scopeId","data-v-baa77003"]]),r6={class:"research-page"},i6={class:"research-header"},o6={class:"status-row"},a6={key:0,class:"badge ok"},l6={class:"badge"},c6={class:"panel"},u6={class:"panel-head"},h6={class:"panel-actions"},d6=["disabled"],f6={key:0,class:"empty"},p6={key:1,class:"empty"},m6={key:2,class:"list"},g6={class:"card"},_6={class:"card-mid"},y6={class:"name-row"},v6={class:"name"},E6={class:"meta"},I6={class:"pill time"},T6={key:0,class:"pill fixed"},w6={key:0,class:"hint2"},b6={class:"progress-area"},A6={class:"progress-bar"},S6={class:"progress-info"},R6={class:"mono"},C6={key:1,class:"queue-row"},P6={class:"queue-title"},N6={key:2,class:"queue-list"},k6={class:"mono"},x6=["onClick"],D6={class:"panel"},O6={key:0,class:"empty"},V6={key:1,class:"empty"},M6={key:2,class:"list"},L6={class:"card-left"},F6={class:"icon"},U6={class:"card-mid"},B6={class:"name-row"},$6={class:"name"},q6={class:"meta"},j6={key:0,class:"pill"},K6={key:0,class:"hint2"},G6={class:"card-right"},H6=["disabled","onClick"],z6={class:"card-left"},W6={class:"icon"},Q6={class:"card-mid"},Y6={class:"name-row"},X6={class:"name"},J6={class:"meta"},Z6={class:"pill time"},eB={key:0,class:"pill fixed"},tB={key:1,class:"pill"},nB={key:2,class:"pill"},sB={key:0,class:"hint2"},rB={key:1,class:"hint2"},iB={class:"card-right"},oB=["disabled","onClick"],aB={class:"panel"},lB={key:0,class:"empty"},cB={key:1,class:"empty"},uB={key:2,class:"list"},hB={class:"card-mid"},dB={class:"name-row"},fB={class:"name"},pB={class:"meta"},mB={class:"pill lock"},gB={class:"pill time"},_B={key:0,class:"pill fixed"},yB={key:0,class:"hint2"},vB={key:1,class:"hint2"},EB={key:2,class:"hint2"},IB={__name:"ResearchView",setup(n){const e=Ni(),t=me(()=>e.isHydrated.value),s=e.firstUnlockTransportId,r=e.needsFirstUnlockSelection,i=e.firstUnlockCandidates,o=me(()=>e.activeResearch.value),a=me(()=>e.queuedResearchIds.value||[]),l=me(()=>e.queueReserveLevel.value||1),u=me(()=>e.queueLimit.value||1),h=me(()=>e.queueCount.value||0),d=me(()=>e.isQueueFull.value),p=me(()=>!!e.saveEnabled.value&&!!e.isStateLoaded.value&&!e.isSavingFirebaseData.value);function g(oe){return tu[oe]?.name??oe}function b(oe){return e.catalog.find(ee=>ee.id===oe)||null}function C(oe){return b(oe)?.title??oe}function V(oe){return oe?oe.timePolicy==="FIXED"?!0:oe.type==="SYSTEM":!1}function L(oe){return V(b(oe))}function F(oe){const ee=Math.max(0,Number(oe||0));if(!ee)return"";if(ee<3600)return`${Math.max(1,Math.round(ee/60))}`;const re=Math.floor(ee/3600),Xe=Math.round(ee%3600/60);return Xe>0?`${re} ${Xe}`:`${re}`}function D(oe){const ee=Number(oe?.durationSec||0),re=V(oe),Xe=F(ee);return Xe===""?"":re?`: ${Xe}`:`: ${Xe}`}function P(oe){return D(b(oe))}function q(oe){return(oe.effects||[]).find(re=>re?.type==="UNLOCK_TRANSPORT_TIER"&&Number(re?.tier||1)===1)?.transportId||null}function Y(oe,ee){const re=q(oe);return!re||!ee.has(re)?null:{key:`first-${re}`,transportId:re,icon:tu[re]?.icon??"",title:`${tu[re]?.name??re}  `,desc:" 1  ."}}const I=me(()=>{const oe=e.visibleCatalog.value||[];if(s.value)return[];const ee=new Set((i.value||[]).map(re=>re.id));return oe.map(re=>Y(re,ee)).filter(Boolean)});function v(oe,ee){const re=String(oe?.title??"").trim(),Xe=String(ee?.title??"").trim();return re.localeCompare(Xe,"ko")}function w(oe){return{id:oe.id,title:oe.title??oe.id,desc:oe.desc??"",durationLabel:D(oe),fixed:V(oe),type:oe.type,domain:oe.domain}}const R=me(()=>(e.visibleCatalog.value||[]).filter(ee=>e.getStatus(ee.id)==="available").map(w).sort(v)),S=me(()=>(e.visibleCatalog.value||[]).map(ee=>{const re=e.getStatus(ee.id);return re!=="locked"&&re!=="comingSoon"?null:{...w(ee),status:re,statusLabel:re==="comingSoon"?"":"",lockReason:"  ."}}).filter(Boolean).sort(v));function N(oe){const ee=String(oe?.type||"");return ee==="SYSTEM"?"":ee==="CITY"?"":ee==="TRANSPORT"?"":ee==="EFFICIENCY"?"":String(oe?.id||"").startsWith("sys_preview_")?"":""}function T(oe){return a.value.includes(oe)}function he(oe){return o.value?T(oe)?"":d.value?" ":"":" "}function ae(oe){e.setFirstUnlockTransport(oe)}function Fe(oe){e.startResearch(oe)}function Be(oe){e.cancelQueuedResearch(oe)}function Ne(){e.cancelAllQueuedResearch()}function Vt(oe){return e.getResearchProgress(oe)}function Sn(oe){return e.getResearchRemainingTime(oe)}function tn(oe){e.saveNow(oe)}function wt(){console.log("[ResearchView Debug]"),console.log("queueReserveLevel:",l.value),console.log("queueLimit:",u.value),console.log("queuedResearchIds:",a.value);const oe=(e.visibleCatalog.value||[]).filter(ee=>String(ee?.id||"").startsWith("sys_preview_"));console.log("[Preview durations]",oe.map(ee=>({id:ee.id,sec:ee.durationSec,label:D(ee)})))}return(oe,ee)=>(W(),X("div",r6,[_("header",i6,[ee[1]||(ee[1]=_("h1",{class:"title"},"",-1)),ee[2]||(ee[2]=_("p",{class:"desc"},"    1 .        . ",-1)),_("div",o6,[_("span",{class:ho(["badge",{ok:t.value}])},ye(t.value?"  ":"  "),3),_("span",{class:ho(["badge",{warn:He(r)}])},ye(He(r)?"  ()":"  "),3),He(s)?(W(),X("span",a6,"  : "+ye(g(He(s))),1)):_t("",!0),_("span",l6," : "+ye(h.value)+"/"+ye(u.value)+" (Lv"+ye(l.value)+") ",1)])]),_("section",c6,[_("div",u6,[ee[3]||(ee[3]=_("h2",{class:"panel-title"}," ",-1)),_("div",h6,[_("button",{class:"btn",disabled:!p.value,onClick:ee[0]||(ee[0]=re=>tn({reason:"manual"}))},"   ",8,d6),_("button",{class:"btn ghost",onClick:wt},"   ")])]),t.value?o.value?(W(),X("div",m6,[_("article",g6,[ee[6]||(ee[6]=_("div",{class:"card-left"},[_("div",{class:"icon"},"")],-1)),_("div",_6,[_("div",y6,[_("div",v6,ye(C(o.value.id)),1),_("div",E6,[ee[4]||(ee[4]=_("span",{class:"pill"},"",-1)),_("span",I6,ye(P(o.value.id)),1),L(o.value.id)?(W(),X("span",T6,"")):_t("",!0)])]),L(o.value.id)?(W(),X("div",w6,"    ,     . ")):_t("",!0),_("div",b6,[_("div",A6,[_("div",{class:"progress-fill",style:ah({transform:`scaleX(${Math.max(0,Math.min(100,Vt(o.value.id)))/100})`})},null,4)]),_("div",S6,[_("span",null,ye(Vt(o.value.id).toFixed(1))+"%",1),_("span",R6,": "+ye(Sn(o.value.id)),1)])]),a.value.length>0?(W(),X("div",C6,[ee[5]||(ee[5]=_("span",{class:"pill"},"",-1)),_("span",P6,ye(a.value.length)+" ",1),_("button",{class:"btn small ghost",onClick:Ne}," ")])):_t("",!0),a.value.length>0?(W(),X("div",N6,[(W(!0),X($e,null,Bt(a.value,re=>(W(),X("div",{key:re,class:"queue-item"},[_("span",k6,ye(C(re)),1),_("button",{class:"btn small ghost",onClick:Xe=>Be(re)},"",8,x6)]))),128))])):_t("",!0)]),ee[7]||(ee[7]=_("div",{class:"card-right"},[_("button",{class:"btn primary",disabled:""},"")],-1))])])):(W(),X("div",p6,"    .     . ")):(W(),X("div",f6," "))]),_("section",D6,[ee[9]||(ee[9]=_("h2",{class:"panel-title"}," ( )",-1)),ee[10]||(ee[10]=_("p",{class:"panel-desc"},"     (  )   .       . ",-1)),t.value?R.value.length===0&&I.value.length===0?(W(),X("div",V6,"     . ")):(W(),X("div",M6,[(W(!0),X($e,null,Bt(I.value,re=>(W(),X("article",{key:re.key,class:"card"},[_("div",L6,[_("div",F6,ye(re.icon),1)]),_("div",U6,[_("div",B6,[_("div",$6,ye(re.title),1),_("div",q6,[ee[8]||(ee[8]=_("span",{class:"pill time"},"",-1)),He(r)?(W(),X("span",j6,"")):_t("",!0)])]),re.desc?(W(),X("div",K6,ye(re.desc),1)):_t("",!0)]),_("div",G6,[_("button",{class:"btn primary",disabled:!!o.value||!t.value,onClick:Xe=>ae(re.transportId)},"   ",8,H6)])]))),128)),(W(!0),X($e,null,Bt(R.value,re=>(W(),X("article",{key:re.id,class:"card"},[_("div",z6,[_("div",W6,ye(N(re)),1)]),_("div",Q6,[_("div",Y6,[_("div",X6,ye(re.title),1),_("div",J6,[_("span",Z6,ye(re.durationLabel),1),re.fixed?(W(),X("span",eB,"")):_t("",!0),o.value?(W(),X("span",tB,"")):(W(),X("span",nB,""))])]),re.desc?(W(),X("div",sB,ye(re.desc),1)):_t("",!0),re.fixed?(W(),X("div",rB,"        .")):_t("",!0)]),_("div",iB,[_("button",{class:"btn primary",disabled:!t.value||o.value&&d.value&&!T(re.id),onClick:Xe=>Fe(re.id)},ye(he(re.id)),9,oB)])]))),128))])):(W(),X("div",O6," "))]),_("section",aB,[ee[13]||(ee[13]=_("h2",{class:"panel-title"},"  ",-1)),ee[14]||(ee[14]=_("p",{class:"panel-desc"},"     .        . ",-1)),t.value?S.value.length===0?(W(),X("div",cB,"/  .")):(W(),X("div",uB,[(W(!0),X($e,null,Bt(S.value,re=>(W(),X("article",{key:re.id,class:"card"},[ee[11]||(ee[11]=_("div",{class:"card-left"},[_("div",{class:"icon"},"")],-1)),_("div",hB,[_("div",dB,[_("div",fB,ye(re.title),1),_("div",pB,[_("span",mB,ye(re.statusLabel),1),_("span",gB,ye(re.durationLabel),1),re.fixed?(W(),X("span",_B,"")):_t("",!0)])]),re.desc?(W(),X("div",yB,ye(re.desc),1)):_t("",!0),re.status==="comingSoon"?(W(),X("div",vB,".")):re.status==="locked"?(W(),X("div",EB,ye(re.lockReason||"  ."),1)):_t("",!0)]),ee[12]||(ee[12]=_("div",{class:"card-right"},[_("button",{class:"btn primary",disabled:""},"")],-1))]))),128))])):(W(),X("div",lB," "))])]))}},TB=mn(IB,[["__scopeId","data-v-b9cdda19"]]),wB={class:"page"},bB={class:"panel"},AB={class:"list"},SB={class:"panel"},RB={class:"grid"},CB={class:"table"},PB={__name:"VehiclesView",setup(n){const e=Qo();function t(){e.push("/home/research")}return(s,r)=>(W(),X("div",wB,[_("header",{class:"page-header"},[r[2]||(r[2]=_("h1",{class:"title"},"",-1)),r[3]||(r[3]=_("p",{class:"desc"},"     .      .",-1)),_("div",{class:"status-row"},[r[0]||(r[0]=_("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=_("span",{class:"badge"}," ",-1)),_("button",{class:"btn primary",onClick:t}," ")])]),_("section",bB,[r[5]||(r[5]=Kn('<div class="panel-head" data-v-e2a4d6c8><h2 class="panel-title" data-v-e2a4d6c8> </h2><div class="panel-actions" data-v-e2a4d6c8><button class="btn" disabled data-v-e2a4d6c8> </button><button class="btn" disabled data-v-e2a4d6c8></button><button class="btn ghost" disabled data-v-e2a4d6c8></button></div></div><div class="empty" data-v-e2a4d6c8>   . <span class="mono" data-v-e2a4d6c8> ( 8)</span>     . </div>',2)),_("div",AB,[(W(),X($e,null,Bt(8,i=>_("article",{class:"card",key:i},[...r[4]||(r[4]=[Kn('<div class="card-left" data-v-e2a4d6c8><div class="icon" data-v-e2a4d6c8></div></div><div class="card-mid" data-v-e2a4d6c8><div class="name-row" data-v-e2a4d6c8><div class="name" data-v-e2a4d6c8>  </div><div class="meta" data-v-e2a4d6c8><span class="pill lock" data-v-e2a4d6c8></span><span class="pill time" data-v-e2a4d6c8></span></div></div><div class="hint2" data-v-e2a4d6c8>  :  ////  UI . </div></div><div class="card-right" data-v-e2a4d6c8><button class="btn primary" disabled data-v-e2a4d6c8></button></div>',3)])])),64))])]),_("section",SB,[r[9]||(r[9]=_("h2",{class:"panel-title"},"",-1)),r[10]||(r[10]=_("p",{class:"panel-desc"},"      .",-1)),_("div",RB,[(W(),X($e,null,Bt(4,i=>_("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[_("div",{class:"mini-title"},"",-1),_("div",{class:"mini-value muted"},"",-1),_("div",{class:"mini-sub muted"},"",-1)])])),64))]),_("div",CB,[r[8]||(r[8]=_("div",{class:"table-head"},[_("span",null,""),_("span",null,""),_("span",null,""),_("span",null,""),_("span",null,"")],-1)),(W(),X($e,null,Bt(6,i=>_("div",{class:"table-row",key:i},[...r[7]||(r[7]=[Kn('<span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span>',5)])])),64))])])]))}},NB=mn(PB,[["__scopeId","data-v-e2a4d6c8"]]),kB={class:"page"},xB={class:"panel"},DB={class:"list"},OB={class:"panel"},VB={class:"table"},MB={__name:"LineView",setup(n){const e=Qo();function t(){e.push("/home/research")}return(s,r)=>(W(),X("div",kB,[_("header",{class:"page-header"},[r[2]||(r[2]=_("h1",{class:"title"},"",-1)),r[3]||(r[3]=_("p",{class:"desc"},"//     .    .",-1)),_("div",{class:"status-row"},[r[0]||(r[0]=_("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=_("span",{class:"badge"}," ",-1)),_("button",{class:"btn primary",onClick:t}," ")])]),_("section",xB,[r[5]||(r[5]=Kn('<div class="panel-head" data-v-58d6af1b><h2 class="panel-title" data-v-58d6af1b> </h2><div class="panel-actions" data-v-58d6af1b><button class="btn" disabled data-v-58d6af1b> </button><button class="btn" disabled data-v-58d6af1b> </button><button class="btn ghost" disabled data-v-58d6af1b> </button></div></div><div class="empty" data-v-58d6af1b>   .       . </div>',2)),_("div",DB,[(W(),X($e,null,Bt(8,i=>_("article",{class:"card",key:i},[...r[4]||(r[4]=[Kn('<div class="card-left" data-v-58d6af1b><div class="icon" data-v-58d6af1b></div></div><div class="card-mid" data-v-58d6af1b><div class="name-row" data-v-58d6af1b><div class="name" data-v-58d6af1b>  </div><div class="meta" data-v-58d6af1b><span class="pill lock" data-v-58d6af1b></span><span class="pill time" data-v-58d6af1b></span></div></div><div class="hint2" data-v-58d6af1b>  : ,  , , /  . </div></div><div class="card-right" data-v-58d6af1b><button class="btn primary" disabled data-v-58d6af1b></button></div>',3)])])),64))])]),_("section",OB,[r[8]||(r[8]=_("h2",{class:"panel-title"},"",-1)),r[9]||(r[9]=_("p",{class:"panel-desc"},"    / .",-1)),_("div",VB,[r[7]||(r[7]=_("div",{class:"table-head"},[_("span",null,""),_("span",null,""),_("span",null,""),_("span",null,""),_("span",null,"")],-1)),(W(),X($e,null,Bt(8,i=>_("div",{class:"table-row",key:i},[...r[6]||(r[6]=[Kn('<span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span>',5)])])),64))])])]))}},LB=mn(MB,[["__scopeId","data-v-58d6af1b"]]),FB={class:"page"},UB={class:"panel"},BB={class:"list"},$B={class:"panel"},qB={class:"grid"},jB={__name:"ConstructionView",setup(n){const e=Qo();function t(){e.push("/home/research")}return(s,r)=>(W(),X("div",FB,[_("header",{class:"page-header"},[r[2]||(r[2]=_("h1",{class:"title"},"",-1)),r[3]||(r[3]=_("p",{class:"desc"}," /     .    .",-1)),_("div",{class:"status-row"},[r[0]||(r[0]=_("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=_("span",{class:"badge"}," ",-1)),_("button",{class:"btn primary",onClick:t}," ")])]),_("section",UB,[r[5]||(r[5]=Kn('<div class="panel-head" data-v-f1dc01af><h2 class="panel-title" data-v-f1dc01af> </h2><div class="panel-actions" data-v-f1dc01af><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button></div></div><div class="empty" data-v-f1dc01af>   .       . </div>',2)),_("div",BB,[(W(),X($e,null,Bt(10,i=>_("article",{class:"card",key:i},[...r[4]||(r[4]=[Kn('<div class="card-left" data-v-f1dc01af><div class="icon" data-v-f1dc01af></div></div><div class="card-mid" data-v-f1dc01af><div class="name-row" data-v-f1dc01af><div class="name" data-v-f1dc01af>  </div><div class="meta" data-v-f1dc01af><span class="pill lock" data-v-f1dc01af></span><span class="pill time" data-v-f1dc01af></span></div></div><div class="hint2" data-v-f1dc01af>  : //,  ,    UI . </div></div><div class="card-right" data-v-f1dc01af><button class="btn primary" disabled data-v-f1dc01af></button></div>',3)])])),64))])]),_("section",$B,[r[7]||(r[7]=_("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=_("p",{class:"panel-desc"},"     /   /   .",-1)),_("div",qB,[(W(),X($e,null,Bt(3,i=>_("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[_("div",{class:"mini-title"},"",-1),_("div",{class:"mini-value muted"},"",-1),_("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},KB=mn(jB,[["__scopeId","data-v-f1dc01af"]]),GB={class:"page"},HB={class:"panel"},zB={class:"grid"},WB={class:"table"},QB={__name:"FinanceView",setup(n){const e=Qo();function t(){e.push("/home/research")}return(s,r)=>(W(),X("div",GB,[_("header",{class:"page-header"},[r[2]||(r[2]=_("h1",{class:"title"},"",-1)),r[3]||(r[3]=_("p",{class:"desc"},"//    .    .",-1)),_("div",{class:"status-row"},[r[0]||(r[0]=_("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=_("span",{class:"badge"}," ",-1)),_("button",{class:"btn primary",onClick:t}," ")])]),_("section",HB,[r[7]||(r[7]=Kn('<div class="panel-head" data-v-d1892e60><h2 class="panel-title" data-v-d1892e60> </h2><div class="panel-actions" data-v-d1892e60><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn ghost" disabled data-v-d1892e60></button></div></div><div class="empty" data-v-d1892e60>   .       . </div>',2)),_("div",zB,[(W(),X($e,null,Bt(4,i=>_("div",{class:"mini-card",key:i},[...r[4]||(r[4]=[_("div",{class:"mini-title"},"",-1),_("div",{class:"mini-value muted"},"",-1),_("div",{class:"mini-sub muted"},"",-1)])])),64))]),_("div",WB,[r[6]||(r[6]=_("div",{class:"table-head"},[_("span",null,""),_("span",null,""),_("span",null,""),_("span",null,"")],-1)),(W(),X($e,null,Bt(8,i=>_("div",{class:"table-row",key:i},[...r[5]||(r[5]=[_("span",{class:"muted"},"",-1),_("span",{class:"muted"},"",-1),_("span",{class:"muted"},"",-1),_("span",{class:"muted"},"",-1)])])),64))])])]))}},YB=mn(QB,[["__scopeId","data-v-d1892e60"]]),XB={class:"page"},JB={class:"panel"},ZB={class:"list"},e3={class:"panel"},t3={class:"grid"},n3={__name:"CityView",setup(n){const e=Qo();function t(){e.push("/home/research")}return(s,r)=>(W(),X("div",XB,[_("header",{class:"page-header"},[r[2]||(r[2]=_("h1",{class:"title"},"",-1)),r[3]||(r[3]=_("p",{class:"desc"}," //     .    .",-1)),_("div",{class:"status-row"},[r[0]||(r[0]=_("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=_("span",{class:"badge"}," ",-1)),_("button",{class:"btn primary",onClick:t}," ")])]),_("section",JB,[r[5]||(r[5]=Kn('<div class="panel-head" data-v-370df6f4><h2 class="panel-title" data-v-370df6f4> </h2><div class="panel-actions" data-v-370df6f4><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn ghost" disabled data-v-370df6f4></button></div></div><div class="empty" data-v-370df6f4>   .  /     . </div>',2)),_("div",ZB,[(W(),X($e,null,Bt(8,i=>_("article",{class:"card",key:i},[...r[4]||(r[4]=[Kn('<div class="card-left" data-v-370df6f4><div class="icon" data-v-370df6f4></div></div><div class="card-mid" data-v-370df6f4><div class="name-row" data-v-370df6f4><div class="name" data-v-370df6f4>  </div><div class="meta" data-v-370df6f4><span class="pill lock" data-v-370df6f4></span><span class="pill time" data-v-370df6f4></span></div></div><div class="hint2" data-v-370df6f4>  : /// ,  , ,   . </div></div><div class="card-right" data-v-370df6f4><button class="btn primary" disabled data-v-370df6f4></button></div>',3)])])),64))])]),_("section",e3,[r[7]||(r[7]=_("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=_("p",{class:"panel-desc"},"     /  /  .",-1)),_("div",t3,[(W(),X($e,null,Bt(3,i=>_("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[_("div",{class:"mini-title"},"",-1),_("div",{class:"mini-value muted"},"",-1),_("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},s3=mn(n3,[["__scopeId","data-v-370df6f4"]]),r3={},i3={class:"settings-shell"},o3={class:"settings-nav"},a3={class:"settings-content"};function l3(n,e){return W(),X("div",i3,[_("aside",o3,[f_(n.$slots,"nav",{},void 0)]),_("section",a3,[f_(n.$slots,"content",{},void 0)])])}const c3=mn(r3,[["render",l3],["__scopeId","data-v-e20a5156"]]),u3={},h3={class:"settings-nav-inner"},d3={class:"menu"};function f3(n,e){const t=ol("router-link");return W(),X("nav",h3,[e[1]||(e[1]=_("h3",{class:"title"},"",-1)),_("ul",d3,[_("li",null,[ze(t,{to:{name:"DataManager"}},{default:Vn(()=>[...e[0]||(e[0]=[Ft("   ",-1)])]),_:1})])])])}const p3=mn(u3,[["render",f3],["__scopeId","data-v-0036c63e"]]),m3={__name:"SettingsView",setup(n){return(e,t)=>{const s=ol("router-view");return W(),mo(c3,null,{nav:Vn(()=>[ze(p3)]),content:Vn(()=>[ze(s)]),_:1})}}},g3={class:"data-manager"},_3={class:"card"},y3={class:"kv"},v3={class:"v"},E3={key:0,class:"hint"},I3={class:"card"},T3={class:"row"},w3=["disabled"],b3=["disabled"],A3=["disabled"],S3={class:"autosave"},R3={class:"autosave-controls"},C3={class:"radio"},P3=["disabled"],N3={class:"radio"},k3=["disabled"],x3={class:"radio"},D3=["disabled"],O3={key:0,class:"hint"},V3={key:0,class:"message"},M3={key:1,class:"preview"},L3={class:"preview-head"},F3={class:"summary"},U3={class:"summary-item"},B3={class:"summary-v"},$3={class:"summary-item"},q3={class:"summary-v"},j3={class:"summary-item"},K3={class:"summary-v"},G3={key:0,class:"pre"},H3={key:2,class:"hint"},z3={class:"modal"},W3={class:"check"},Q3={class:"row"},Y3=["disabled"],X3=["disabled"],J3={__name:"DataManagerPanel",setup(n){const e=Wh(),t=me(()=>(e?.user?.value??e?.currentUser?.value??e?.firebaseUser?.value??e?.user??e?.currentUser??null)?.uid??null),{saveNow:s,isSavingFirebaseData:r,autoSaveEnabled:i,autoSaveBase:o,autoSaveIntervalMin:a,setAutoSaveEnabled:l,setAutoSaveBase:u,setAutoSaveIntervalMin:h,autoSaveRunning:d}=Ni(),p=me(()=>r.value),g=Se(!1),b=Se(""),C=Se(!1),V=Se(null),L=Se(!1);function F(he){return JSON.stringify(he,null,2)}function D(he){if(!he)return"-";try{return typeof he?.toDate=="function"?he.toDate().toLocaleString():he instanceof Date?he.toLocaleString():typeof he=="number"?new Date(he).toLocaleString():String(he)}catch{return String(he)}}const P=Se("off");function q(){if(!i.value){P.value="off";return}const he=Number(o.value),ae=Number(a.value);he===10&&ae===10?P.value="10":he===5&&ae===5?P.value="5":he===10?P.value="10":P.value="5"}as([i,o,a],()=>q(),{immediate:!0}),as(P,he=>{if(t.value){if(he==="off"){l(!1);return}if(he==="5"){u(5),h(5),l(!0);return}he==="10"&&(u(10),h(10),l(!0))}});async function Y(){if(t.value){b.value="";try{await s({reason:"manual-ui"}),b.value=" ."}catch(he){console.error("DataManager: save failed",he),b.value=` : ${String(he?.message??he)}`}}}async function I(){if(t.value){g.value=!0,b.value="",C.value=!1,V.value=null,L.value=!1;try{const he=Wu(Yu,"users",t.value,"research","state"),ae=await N2(he);ae.exists()?(V.value=ae.data(),C.value=!0,b.value="  ."):b.value="  . ( )"}catch(he){console.error("DataManager: load failed",he),b.value=` : ${String(he?.message??he)}`}finally{g.value=!1}}}const v=Se(!1),w=Se(!1),R=Se("");function S(){v.value=!0,w.value=!1,R.value=""}function N(){v.value=!1}async function T(){if(t.value){g.value=!0,b.value="";try{const he=Wu(Yu,"users",t.value,"research","state");await k2(he),C.value=!1,V.value=null,L.value=!1,b.value=" .   .",N()}catch(he){console.error("DataManager: delete failed",he),b.value=` : ${String(he?.message??he)}`}finally{g.value=!1}}}return(he,ae)=>(W(),X("div",g3,[ae[22]||(ae[22]=_("header",{class:"header"},[_("div",null,[_("h1",{class:"title"}," "),_("p",{class:"desc"},"   ,        . ")])],-1)),_("section",_3,[ae[7]||(ae[7]=_("h2",{class:"card-title"}," ",-1)),_("div",y3,[ae[6]||(ae[6]=_("div",{class:"k"}," ",-1)),_("div",v3,ye(t.value?"":"()"),1)]),t.value?_t("",!0):(W(),X("p",E3," Firestore  /   . "))]),_("section",I3,[ae[16]||(ae[16]=_("h2",{class:"card-title"}," ",-1)),_("div",T3,[_("button",{class:"btn",onClick:Y,disabled:!t.value||g.value||p.value},"  ",8,w3),_("button",{class:"btn",onClick:I,disabled:!t.value||g.value},"   ",8,b3),_("button",{class:"btn danger",onClick:S,disabled:!t.value||g.value},"   ",8,A3)]),_("div",S3,[ae[11]||(ae[11]=_("div",{class:"autosave-title"},"",-1)),_("div",R3,[_("label",C3,[da(_("input",{type:"radio",name:"autosave",value:"off","onUpdate:modelValue":ae[0]||(ae[0]=Fe=>P.value=Fe),disabled:!t.value||g.value},null,8,P3),[[Td,P.value]]),ae[8]||(ae[8]=_("span",null,"",-1))]),_("label",N3,[da(_("input",{type:"radio",name:"autosave",value:"5","onUpdate:modelValue":ae[1]||(ae[1]=Fe=>P.value=Fe),disabled:!t.value||g.value},null,8,k3),[[Td,P.value]]),ae[9]||(ae[9]=_("span",null,"5",-1))]),_("label",x3,[da(_("input",{type:"radio",name:"autosave",value:"10","onUpdate:modelValue":ae[2]||(ae[2]=Fe=>P.value=Fe),disabled:!t.value||g.value},null,8,D3),[[Td,P.value]]),ae[10]||(ae[10]=_("span",null,"10",-1))])]),t.value&&He(i)&&He(d)?(W(),X("p",O3,"    (KST   ) ")):_t("",!0)]),b.value?(W(),X("p",V3,ye(b.value),1)):_t("",!0),C.value?(W(),X("div",M3,[_("div",L3,[ae[12]||(ae[12]=_("h3",{class:"preview-title"},"    ",-1)),_("button",{class:"btn small",onClick:ae[3]||(ae[3]=Fe=>L.value=!L.value)},ye(L.value?"":""),1)]),_("div",F3,[_("div",U3,[ae[13]||(ae[13]=_("div",{class:"summary-k"},"",-1)),_("div",B3,ye(V.value?.version??"-"),1)]),_("div",$3,[ae[14]||(ae[14]=_("div",{class:"summary-k"},"  ",-1)),_("div",q3,ye(V.value?.transports?.length??0),1)]),_("div",j3,[ae[15]||(ae[15]=_("div",{class:"summary-k"},"",-1)),_("div",K3,ye(D(V.value?.updatedAt)),1)])]),L.value?(W(),X("pre",G3,ye(F(V.value)),1)):_t("",!0)])):(W(),X("p",H3,"   ."))]),v.value?(W(),X("div",{key:0,class:"modal-backdrop",onClick:YI(N,["self"])},[_("div",z3,[ae[18]||(ae[18]=_("h2",{class:"modal-title"}," ?",-1)),ae[19]||(ae[19]=_("p",{class:"modal-desc danger-text"},"     .  ? ",-1)),ae[20]||(ae[20]=_("p",{class:"modal-desc"},[Ft("   ,  "),_("b",null," "),Ft(". ")],-1)),_("label",W3,[da(_("input",{type:"checkbox","onUpdate:modelValue":ae[4]||(ae[4]=Fe=>w.value=Fe)},null,512),[[Y0,w.value]]),ae[17]||(ae[17]=_("span",null,"      .",-1))]),ae[21]||(ae[21]=_("p",{class:"modal-desc"},[Ft("   "),_("b",null,"DELETE"),Ft(" . ")],-1)),da(_("input",{class:"input","onUpdate:modelValue":ae[5]||(ae[5]=Fe=>R.value=Fe),placeholder:"DELETE"},null,512),[[Q0,R.value]]),_("div",Q3,[_("button",{class:"btn",onClick:N,disabled:g.value},"",8,Y3),_("button",{class:"btn danger",onClick:T,disabled:g.value||!w.value||R.value!=="DELETE"},"   ",8,X3)])])])):_t("",!0)]))}},Z3=mn(J3,[["__scopeId","data-v-a8ca5a4d"]]),e9={__name:"DataManagerView",setup(n){return(e,t)=>(W(),mo(Z3))}},t9={class:"preview-page"},n9={__name:"PreviewRunsView",setup(n){return(e,t)=>(W(),X("div",t9,[ze(uR,{class:"preview-left-as-main"})]))}},s9=mn(n9,[["__scopeId","data-v-3aa6340f"]]),r9=[{path:"/",redirect:"/home/research"},{path:"/home",component:s6,children:[{path:"",redirect:"/home/research"},{path:"preview",name:"PreviewRuns",component:s9},{path:"research",name:"Research",component:TB},{path:"vehicles",name:"Vehicles",component:NB},{path:"line",name:"Line",component:LB},{path:"construction",name:"Construction",component:KB},{path:"finance",name:"Finance",component:YB},{path:"city",name:"City",component:s3},{path:"settings",component:m3,children:[{path:"",redirect:{name:"DataManager"}},{path:"data",name:"DataManager",component:e9}]}]}],i9=T4({history:e4(),routes:r9,scrollBehavior(){return{top:0}}}),{user:o9,authReady:a9}=Wh(),{loadForUser:l9,clearUserState:c9}=Ni();let Qd=null;as([a9,o9],async([n,e])=>{if(!n)return;if(!e){Qd=null,c9();return}const t=e.uid;t&&t!==Qd&&(Qd=t,await l9(t))},{immediate:!0});const hR=tP(gF);hR.use(i9);hR.mount("#app");
