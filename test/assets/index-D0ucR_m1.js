(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function xm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const rt={},Lo=[],Ts=()=>{},MT=()=>!1,ad=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Dm=n=>n.startsWith("onUpdate:"),fn=Object.assign,Vm=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},m0=Object.prototype.hasOwnProperty,We=(n,e)=>m0.call(n,e),we=Array.isArray,Fo=n=>Lc(n)==="[object Map]",ld=n=>Lc(n)==="[object Set]",ev=n=>Lc(n)==="[object Date]",Se=n=>typeof n=="function",kt=n=>typeof n=="string",as=n=>typeof n=="symbol",ot=n=>n!==null&&typeof n=="object",LT=n=>(ot(n)||Se(n))&&Se(n.then)&&Se(n.catch),FT=Object.prototype.toString,Lc=n=>FT.call(n),_0=n=>Lc(n).slice(8,-1),UT=n=>Lc(n)==="[object Object]",Om=n=>kt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,kl=xm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cd=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},g0=/-\w/g,Gn=cd(n=>n.replace(g0,e=>e.slice(1).toUpperCase())),y0=/\B([A-Z])/g,oo=cd(n=>n.replace(y0,"-$1").toLowerCase()),ud=cd(n=>n.charAt(0).toUpperCase()+n.slice(1)),Rf=cd(n=>n?`on${ud(n)}`:""),Fr=(n,e)=>!Object.is(n,e),Bu=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},BT=(n,e,t,s=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:s,value:t})},Mm=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let tv;const hd=()=>tv||(tv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function dd(n){if(we(n)){const e={};for(let t=0;t<n.length;t++){const s=n[t],r=kt(s)?T0(s):dd(s);if(r)for(const i in r)e[i]=r[i]}return e}else if(kt(n)||ot(n))return n}const v0=/;(?![^(]*\))/g,E0=/:([^]+)/,I0=/\/\*[^]*?\*\//g;function T0(n){const e={};return n.replace(I0,"").split(v0).forEach(t=>{if(t){const s=t.split(E0);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Yo(n){let e="";if(kt(n))e=n;else if(we(n))for(let t=0;t<n.length;t++){const s=Yo(n[t]);s&&(e+=s+" ")}else if(ot(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const w0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",b0=xm(w0);function qT(n){return!!n||n===""}function A0(n,e){if(n.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<n.length;s++)t=Jo(n[s],e[s]);return t}function Jo(n,e){if(n===e)return!0;let t=ev(n),s=ev(e);if(t||s)return t&&s?n.getTime()===e.getTime():!1;if(t=as(n),s=as(e),t||s)return n===e;if(t=we(n),s=we(e),t||s)return t&&s?A0(n,e):!1;if(t=ot(n),s=ot(e),t||s){if(!t||!s)return!1;const r=Object.keys(n).length,i=Object.keys(e).length;if(r!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Jo(n[o],e[o]))return!1}}return String(n)===String(e)}function $T(n,e){return n.findIndex(t=>Jo(t,e))}const jT=n=>!!(n&&n.__v_isRef===!0),ye=n=>kt(n)?n:n==null?"":we(n)||ot(n)&&(n.toString===FT||!Se(n.toString))?jT(n)?ye(n.value):JSON.stringify(n,GT,2):String(n),GT=(n,e)=>jT(e)?GT(n,e.value):Fo(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,r],i)=>(t[Cf(s,i)+" =>"]=r,t),{})}:ld(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Cf(t))}:as(e)?Cf(e):ot(e)&&!we(e)&&!UT(e)?String(e):e,Cf=(n,e="")=>{var t;return as(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let nn;class S0{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=nn,!e&&nn&&(this.index=(nn.scopes||(nn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=nn;try{return nn=this,e()}finally{nn=t}}}on(){++this._on===1&&(this.prevScope=nn,nn=this)}off(){this._on>0&&--this._on===0&&(nn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function R0(){return nn}function C0(n,e=!1){nn&&nn.cleanups.push(n)}let ct;const Pf=new WeakSet;class KT{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,nn&&nn.active&&nn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Pf.has(this)&&(Pf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||zT(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,nv(this),HT(this);const e=ct,t=es;ct=this,es=!0;try{return this.fn()}finally{QT(this),ct=e,es=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Um(e);this.deps=this.depsTail=void 0,nv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Pf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){fp(this)&&this.run()}get dirty(){return fp(this)}}let WT=0,xl,Dl;function zT(n,e=!1){if(n.flags|=8,e){n.next=Dl,Dl=n;return}n.next=xl,xl=n}function Lm(){WT++}function Fm(){if(--WT>0)return;if(Dl){let e=Dl;for(Dl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;xl;){let e=xl;for(xl=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){n||(n=s)}e=t}}if(n)throw n}function HT(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function QT(n){let e,t=n.depsTail,s=t;for(;s;){const r=s.prevDep;s.version===-1?(s===t&&(t=r),Um(s),P0(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=r}n.deps=e,n.depsTail=t}function fp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(YT(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function YT(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===ic)||(n.globalVersion=ic,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!fp(n))))return;n.flags|=2;const e=n.dep,t=ct,s=es;ct=n,es=!0;try{HT(n);const r=n.fn(n._value);(e.version===0||Fr(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{ct=t,es=s,QT(n),n.flags&=-3}}function Um(n,e=!1){const{dep:t,prevSub:s,nextSub:r}=n;if(s&&(s.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=s,n.nextSub=void 0),t.subs===n&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Um(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function P0(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let es=!0;const JT=[];function Hs(){JT.push(es),es=!1}function Qs(){const n=JT.pop();es=n===void 0?!0:n}function nv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=ct;ct=void 0;try{e()}finally{ct=t}}}let ic=0;class N0{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Bm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ct||!es||ct===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==ct)t=this.activeLink=new N0(ct,this),ct.deps?(t.prevDep=ct.depsTail,ct.depsTail.nextDep=t,ct.depsTail=t):ct.deps=ct.depsTail=t,XT(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=ct.depsTail,t.nextDep=void 0,ct.depsTail.nextDep=t,ct.depsTail=t,ct.deps===t&&(ct.deps=s)}return t}trigger(e){this.version++,ic++,this.notify(e)}notify(e){Lm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Fm()}}}function XT(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)XT(s)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const pp=new WeakMap,Mi=Symbol(""),mp=Symbol(""),oc=Symbol("");function rn(n,e,t){if(es&&ct){let s=pp.get(n);s||pp.set(n,s=new Map);let r=s.get(t);r||(s.set(t,r=new Bm),r.map=s,r.key=t),r.track()}}function Ms(n,e,t,s,r,i){const o=pp.get(n);if(!o){ic++;return}const a=l=>{l&&l.trigger()};if(Lm(),e==="clear")o.forEach(a);else{const l=we(n),u=l&&Om(t);if(l&&t==="length"){const h=Number(s);o.forEach((d,f)=>{(f==="length"||f===oc||!as(f)&&f>=h)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(oc)),e){case"add":l?u&&a(o.get("length")):(a(o.get(Mi)),Fo(n)&&a(o.get(mp)));break;case"delete":l||(a(o.get(Mi)),Fo(n)&&a(o.get(mp)));break;case"set":Fo(n)&&a(o.get(Mi));break}}Fm()}function Io(n){const e=Ke(n);return e===n?e:(rn(e,"iterate",oc),$n(n)?e:e.map(ls))}function fd(n){return rn(n=Ke(n),"iterate",oc),n}function Ar(n,e){return Ys(n)?Li(n)?Xo(ls(e)):Xo(e):ls(e)}const k0={__proto__:null,[Symbol.iterator](){return Nf(this,Symbol.iterator,n=>Ar(this,n))},concat(...n){return Io(this).concat(...n.map(e=>we(e)?Io(e):e))},entries(){return Nf(this,"entries",n=>(n[1]=Ar(this,n[1]),n))},every(n,e){return ks(this,"every",n,e,void 0,arguments)},filter(n,e){return ks(this,"filter",n,e,t=>t.map(s=>Ar(this,s)),arguments)},find(n,e){return ks(this,"find",n,e,t=>Ar(this,t),arguments)},findIndex(n,e){return ks(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ks(this,"findLast",n,e,t=>Ar(this,t),arguments)},findLastIndex(n,e){return ks(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ks(this,"forEach",n,e,void 0,arguments)},includes(...n){return kf(this,"includes",n)},indexOf(...n){return kf(this,"indexOf",n)},join(n){return Io(this).join(n)},lastIndexOf(...n){return kf(this,"lastIndexOf",n)},map(n,e){return ks(this,"map",n,e,void 0,arguments)},pop(){return ul(this,"pop")},push(...n){return ul(this,"push",n)},reduce(n,...e){return sv(this,"reduce",n,e)},reduceRight(n,...e){return sv(this,"reduceRight",n,e)},shift(){return ul(this,"shift")},some(n,e){return ks(this,"some",n,e,void 0,arguments)},splice(...n){return ul(this,"splice",n)},toReversed(){return Io(this).toReversed()},toSorted(n){return Io(this).toSorted(n)},toSpliced(...n){return Io(this).toSpliced(...n)},unshift(...n){return ul(this,"unshift",n)},values(){return Nf(this,"values",n=>Ar(this,n))}};function Nf(n,e,t){const s=fd(n),r=s[e]();return s!==n&&!$n(n)&&(r._next=r.next,r.next=()=>{const i=r._next();return i.done||(i.value=t(i.value)),i}),r}const x0=Array.prototype;function ks(n,e,t,s,r,i){const o=fd(n),a=o!==n&&!$n(n),l=o[e];if(l!==x0[e]){const d=l.apply(n,i);return a?ls(d):d}let u=t;o!==n&&(a?u=function(d,f){return t.call(this,Ar(n,d),f,n)}:t.length>2&&(u=function(d,f){return t.call(this,d,f,n)}));const h=l.call(o,u,s);return a&&r?r(h):h}function sv(n,e,t,s){const r=fd(n);let i=t;return r!==n&&($n(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Ar(n,a),l,n)}),r[e](i,...s)}function kf(n,e,t){const s=Ke(n);rn(s,"iterate",oc);const r=s[e](...t);return(r===-1||r===!1)&&jm(t[0])?(t[0]=Ke(t[0]),s[e](...t)):r}function ul(n,e,t=[]){Hs(),Lm();const s=Ke(n)[e].apply(n,t);return Fm(),Qs(),s}const D0=xm("__proto__,__v_isRef,__isVue"),ZT=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(as));function V0(n){as(n)||(n=String(n));const e=Ke(this);return rn(e,"has",n),e.hasOwnProperty(n)}class ew{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return i;if(t==="__v_raw")return s===(r?i?G0:rw:i?sw:nw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=we(e);if(!r){let l;if(o&&(l=k0[t]))return l;if(t==="hasOwnProperty")return V0}const a=Reflect.get(e,t,cn(e)?e:s);if((as(t)?ZT.has(t):D0(t))||(r||rn(e,"get",t),i))return a;if(cn(a)){const l=o&&Om(t)?a:a.value;return r&&ot(l)?gp(l):l}return ot(a)?r?gp(a):pd(a):a}}class tw extends ew{constructor(e=!1){super(!1,e)}set(e,t,s,r){let i=e[t];const o=we(e)&&Om(t);if(!this._isShallow){const u=Ys(i);if(!$n(s)&&!Ys(s)&&(i=Ke(i),s=Ke(s)),!o&&cn(i)&&!cn(s))return u||(i.value=s),!0}const a=o?Number(t)<e.length:We(e,t),l=Reflect.set(e,t,s,cn(e)?e:r);return e===Ke(r)&&(a?Fr(s,i)&&Ms(e,"set",t,s):Ms(e,"add",t,s)),l}deleteProperty(e,t){const s=We(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&Ms(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(!as(t)||!ZT.has(t))&&rn(e,"has",t),s}ownKeys(e){return rn(e,"iterate",we(e)?"length":Mi),Reflect.ownKeys(e)}}class O0 extends ew{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const M0=new tw,L0=new O0,F0=new tw(!0);const _p=n=>n,wu=n=>Reflect.getPrototypeOf(n);function U0(n,e,t){return function(...s){const r=this.__v_raw,i=Ke(r),o=Fo(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=r[n](...s),h=t?_p:e?Xo:ls;return!e&&rn(i,"iterate",l?mp:Mi),{next(){const{value:d,done:f}=u.next();return f?{value:d,done:f}:{value:a?[h(d[0]),h(d[1])]:h(d),done:f}},[Symbol.iterator](){return this}}}}function bu(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function B0(n,e){const t={get(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);n||(Fr(r,a)&&rn(o,"get",r),rn(o,"get",a));const{has:l}=wu(o),u=e?_p:n?Xo:ls;if(l.call(o,r))return u(i.get(r));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(r)},get size(){const r=this.__v_raw;return!n&&rn(Ke(r),"iterate",Mi),r.size},has(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);return n||(Fr(r,a)&&rn(o,"has",r),rn(o,"has",a)),r===a?i.has(r):i.has(r)||i.has(a)},forEach(r,i){const o=this,a=o.__v_raw,l=Ke(a),u=e?_p:n?Xo:ls;return!n&&rn(l,"iterate",Mi),a.forEach((h,d)=>r.call(i,u(h),u(d),o))}};return fn(t,n?{add:bu("add"),set:bu("set"),delete:bu("delete"),clear:bu("clear")}:{add(r){!e&&!$n(r)&&!Ys(r)&&(r=Ke(r));const i=Ke(this);return wu(i).has.call(i,r)||(i.add(r),Ms(i,"add",r,r)),this},set(r,i){!e&&!$n(i)&&!Ys(i)&&(i=Ke(i));const o=Ke(this),{has:a,get:l}=wu(o);let u=a.call(o,r);u||(r=Ke(r),u=a.call(o,r));const h=l.call(o,r);return o.set(r,i),u?Fr(i,h)&&Ms(o,"set",r,i):Ms(o,"add",r,i),this},delete(r){const i=Ke(this),{has:o,get:a}=wu(i);let l=o.call(i,r);l||(r=Ke(r),l=o.call(i,r)),a&&a.call(i,r);const u=i.delete(r);return l&&Ms(i,"delete",r,void 0),u},clear(){const r=Ke(this),i=r.size!==0,o=r.clear();return i&&Ms(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=U0(r,n,e)}),t}function qm(n,e){const t=B0(n,e);return(s,r,i)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?s:Reflect.get(We(t,r)&&r in s?t:s,r,i)}const q0={get:qm(!1,!1)},$0={get:qm(!1,!0)},j0={get:qm(!0,!1)};const nw=new WeakMap,sw=new WeakMap,rw=new WeakMap,G0=new WeakMap;function K0(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function W0(n){return n.__v_skip||!Object.isExtensible(n)?0:K0(_0(n))}function pd(n){return Ys(n)?n:$m(n,!1,M0,q0,nw)}function iw(n){return $m(n,!1,F0,$0,sw)}function gp(n){return $m(n,!0,L0,j0,rw)}function $m(n,e,t,s,r){if(!ot(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=W0(n);if(i===0)return n;const o=r.get(n);if(o)return o;const a=new Proxy(n,i===2?s:t);return r.set(n,a),a}function Li(n){return Ys(n)?Li(n.__v_raw):!!(n&&n.__v_isReactive)}function Ys(n){return!!(n&&n.__v_isReadonly)}function $n(n){return!!(n&&n.__v_isShallow)}function jm(n){return n?!!n.__v_raw:!1}function Ke(n){const e=n&&n.__v_raw;return e?Ke(e):n}function z0(n){return!We(n,"__v_skip")&&Object.isExtensible(n)&&BT(n,"__v_skip",!0),n}const ls=n=>ot(n)?pd(n):n,Xo=n=>ot(n)?gp(n):n;function cn(n){return n?n.__v_isRef===!0:!1}function Ae(n){return ow(n,!1)}function H0(n){return ow(n,!0)}function ow(n,e){return cn(n)?n:new Q0(n,e)}class Q0{constructor(e,t){this.dep=new Bm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ke(e),this._value=t?e:ls(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||$n(e)||Ys(e);e=s?e:Ke(e),Fr(e,t)&&(this._rawValue=e,this._value=s?e:ls(e),this.dep.trigger())}}function ze(n){return cn(n)?n.value:n}const Y0={get:(n,e,t)=>e==="__v_raw"?n:ze(Reflect.get(n,e,t)),set:(n,e,t,s)=>{const r=n[e];return cn(r)&&!cn(t)?(r.value=t,!0):Reflect.set(n,e,t,s)}};function aw(n){return Li(n)?n:new Proxy(n,Y0)}class J0{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Bm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ic-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&ct!==this)return zT(this,!0),!0}get value(){const e=this.dep.track();return YT(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function X0(n,e,t=!1){let s,r;return Se(n)?s=n:(s=n.get,r=n.set),new J0(s,r,t)}const Au={},uh=new WeakMap;let Ii;function Z0(n,e=!1,t=Ii){if(t){let s=uh.get(t);s||uh.set(t,s=[]),s.push(n)}}function e1(n,e,t=rt){const{immediate:s,deep:r,once:i,scheduler:o,augmentJob:a,call:l}=t,u=k=>r?k:$n(k)||r===!1||r===0?Ls(k,1):Ls(k);let h,d,f,_,E=!1,T=!1;if(cn(n)?(d=()=>n.value,E=$n(n)):Li(n)?(d=()=>u(n),E=!0):we(n)?(T=!0,E=n.some(k=>Li(k)||$n(k)),d=()=>n.map(k=>{if(cn(k))return k.value;if(Li(k))return u(k);if(Se(k))return l?l(k,2):k()})):Se(n)?e?d=l?()=>l(n,2):n:d=()=>{if(f){Hs();try{f()}finally{Qs()}}const k=Ii;Ii=h;try{return l?l(n,3,[_]):n(_)}finally{Ii=k}}:d=Ts,e&&r){const k=d,G=r===!0?1/0:r;d=()=>Ls(k(),G)}const C=R0(),L=()=>{h.stop(),C&&C.active&&Vm(C.effects,h)};if(i&&e){const k=e;e=(...G)=>{k(...G),L()}}let U=T?new Array(n.length).fill(Au):Au;const N=k=>{if(!(!(h.flags&1)||!h.dirty&&!k))if(e){const G=h.run();if(r||E||(T?G.some((J,b)=>Fr(J,U[b])):Fr(G,U))){f&&f();const J=Ii;Ii=h;try{const b=[G,U===Au?void 0:T&&U[0]===Au?[]:U,_];U=G,l?l(e,3,b):e(...b)}finally{Ii=J}}}else h.run()};return a&&a(N),h=new KT(d),h.scheduler=o?()=>o(N,!1):N,_=k=>Z0(k,!1,h),f=h.onStop=()=>{const k=uh.get(h);if(k){if(l)l(k,4);else for(const G of k)G();uh.delete(h)}},e?s?N(!0):U=h.run():o?o(N.bind(null,!0),!0):h.run(),L.pause=h.pause.bind(h),L.resume=h.resume.bind(h),L.stop=L,L}function Ls(n,e=1/0,t){if(e<=0||!ot(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,cn(n))Ls(n.value,e,t);else if(we(n))for(let s=0;s<n.length;s++)Ls(n[s],e,t);else if(ld(n)||Fo(n))n.forEach(s=>{Ls(s,e,t)});else if(UT(n)){for(const s in n)Ls(n[s],e,t);for(const s of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,s)&&Ls(n[s],e,t)}return n}function Fc(n,e,t,s){try{return s?n(...s):n()}catch(r){md(r,e,t)}}function Rs(n,e,t,s){if(Se(n)){const r=Fc(n,e,t,s);return r&&LT(r)&&r.catch(i=>{md(i,e,t)}),r}if(we(n)){const r=[];for(let i=0;i<n.length;i++)r.push(Rs(n[i],e,t,s));return r}}function md(n,e,t,s=!0){const r=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||rt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let d=0;d<h.length;d++)if(h[d](n,l,u)===!1)return}a=a.parent}if(i){Hs(),Fc(i,null,10,[n,l,u]),Qs();return}}t1(n,t,r,s,o)}function t1(n,e,t,s=!0,r=!1){if(r)throw n;console.error(n)}const yn=[];let ps=-1;const Uo=[];let Sr=null,Po=0;const lw=Promise.resolve();let hh=null;function cw(n){const e=hh||lw;return n?e.then(this?n.bind(this):n):e}function n1(n){let e=ps+1,t=yn.length;for(;e<t;){const s=e+t>>>1,r=yn[s],i=ac(r);i<n||i===n&&r.flags&2?e=s+1:t=s}return e}function Gm(n){if(!(n.flags&1)){const e=ac(n),t=yn[yn.length-1];!t||!(n.flags&2)&&e>=ac(t)?yn.push(n):yn.splice(n1(e),0,n),n.flags|=1,uw()}}function uw(){hh||(hh=lw.then(dw))}function s1(n){we(n)?Uo.push(...n):Sr&&n.id===-1?Sr.splice(Po+1,0,n):n.flags&1||(Uo.push(n),n.flags|=1),uw()}function rv(n,e,t=ps+1){for(;t<yn.length;t++){const s=yn[t];if(s&&s.flags&2){if(n&&s.id!==n.uid)continue;yn.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function hw(n){if(Uo.length){const e=[...new Set(Uo)].sort((t,s)=>ac(t)-ac(s));if(Uo.length=0,Sr){Sr.push(...e);return}for(Sr=e,Po=0;Po<Sr.length;Po++){const t=Sr[Po];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Sr=null,Po=0}}const ac=n=>n.id==null?n.flags&2?-1:1/0:n.id;function dw(n){try{for(ps=0;ps<yn.length;ps++){const e=yn[ps];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Fc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ps<yn.length;ps++){const e=yn[ps];e&&(e.flags&=-2)}ps=-1,yn.length=0,hw(),hh=null,(yn.length||Uo.length)&&dw()}}let Jt=null,fw=null;function dh(n){const e=Jt;return Jt=n,fw=n&&n.type.__scopeId||null,e}function zn(n,e=Jt,t){if(!e||n._n)return n;const s=(...r)=>{s._d&&mh(-1);const i=dh(e);let o;try{o=n(...r)}finally{dh(i),s._d&&mh(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function hl(n,e){if(Jt===null)return n;const t=vd(Jt),s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[i,o,a,l=rt]=e[r];i&&(Se(i)&&(i={mounted:i,updated:i}),i.deep&&Ls(o),s.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function yi(n,e,t,s){const r=n.dirs,i=e&&e.dirs;for(let o=0;o<r.length;o++){const a=r[o];i&&(a.oldValue=i[o].value);let l=a.dir[s];l&&(Hs(),Rs(l,t,8,[n.el,a,n,e]),Qs())}}function qu(n,e){if(ln){let t=ln.provides;const s=ln.parent&&ln.parent.provides;s===t&&(t=ln.provides=Object.create(s)),t[n]=e}}function ts(n,e,t=!1){const s=nN();if(s||qo){let r=qo?qo._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&Se(e)?e.call(s&&s.proxy):e}}const r1=Symbol.for("v-scx"),i1=()=>ts(r1);function Vl(n,e){return Km(n,null,e)}function Ks(n,e,t){return Km(n,e,t)}function Km(n,e,t=rt){const{immediate:s,deep:r,flush:i,once:o}=t,a=fn({},t),l=e&&s||!e&&i!=="post";let u;if(hc){if(i==="sync"){const _=i1();u=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=Ts,_.resume=Ts,_.pause=Ts,_}}const h=ln;a.call=(_,E,T)=>Rs(_,h,E,T);let d=!1;i==="post"?a.scheduler=_=>{Dn(_,h&&h.suspense)}:i!=="sync"&&(d=!0,a.scheduler=(_,E)=>{E?_():Gm(_)}),a.augmentJob=_=>{e&&(_.flags|=4),d&&(_.flags|=2,h&&(_.id=h.uid,_.i=h))};const f=e1(n,e,a);return hc&&(u?u.push(f):l&&f()),f}function o1(n,e,t){const s=this.proxy,r=kt(n)?n.includes(".")?pw(s,n):()=>s[n]:n.bind(s,s);let i;Se(e)?i=e:(i=e.handler,t=e);const o=Uc(this),a=Km(r,i.bind(s),t);return o(),a}function pw(n,e){const t=e.split(".");return()=>{let s=n;for(let r=0;r<t.length&&s;r++)s=s[t[r]];return s}}const a1=Symbol("_vte"),l1=n=>n.__isTeleport,c1=Symbol("_leaveCb");function Wm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Wm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function mw(n,e){return Se(n)?fn({name:n.name},e,{setup:n}):n}function _w(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const fh=new WeakMap;function Ol(n,e,t,s,r=!1){if(we(n)){n.forEach((E,T)=>Ol(E,e&&(we(e)?e[T]:e),t,s,r));return}if(Bo(s)&&!r){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Ol(n,e,t,s.component.subTree);return}const i=s.shapeFlag&4?vd(s.component):s.el,o=r?null:i,{i:a,r:l}=n,u=e&&e.r,h=a.refs===rt?a.refs={}:a.refs,d=a.setupState,f=Ke(d),_=d===rt?MT:E=>We(f,E);if(u!=null&&u!==l){if(iv(e),kt(u))h[u]=null,_(u)&&(d[u]=null);else if(cn(u)){u.value=null;const E=e;E.k&&(h[E.k]=null)}}if(Se(l))Fc(l,a,12,[o,h]);else{const E=kt(l),T=cn(l);if(E||T){const C=()=>{if(n.f){const L=E?_(l)?d[l]:h[l]:l.value;if(r)we(L)&&Vm(L,i);else if(we(L))L.includes(i)||L.push(i);else if(E)h[l]=[i],_(l)&&(d[l]=h[l]);else{const U=[i];l.value=U,n.k&&(h[n.k]=U)}}else E?(h[l]=o,_(l)&&(d[l]=o)):T&&(l.value=o,n.k&&(h[n.k]=o))};if(o){const L=()=>{C(),fh.delete(n)};L.id=-1,fh.set(n,L),Dn(L,t)}else iv(n),C()}}}function iv(n){const e=fh.get(n);e&&(e.flags|=8,fh.delete(n))}hd().requestIdleCallback;hd().cancelIdleCallback;const Bo=n=>!!n.type.__asyncLoader,gw=n=>n.type.__isKeepAlive;function u1(n,e){yw(n,"a",e)}function h1(n,e){yw(n,"da",e)}function yw(n,e,t=ln){const s=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(_d(e,s,t),t){let r=t.parent;for(;r&&r.parent;)gw(r.parent.vnode)&&d1(s,e,t,r),r=r.parent}}function d1(n,e,t,s){const r=_d(e,n,s,!0);Ew(()=>{Vm(s[e],r)},t)}function _d(n,e,t=ln,s=!1){if(t){const r=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Hs();const a=Uc(t),l=Rs(e,t,n,o);return a(),Qs(),l});return s?r.unshift(i):r.push(i),i}}const sr=n=>(e,t=ln)=>{(!hc||n==="sp")&&_d(n,(...s)=>e(...s),t)},f1=sr("bm"),zm=sr("m"),p1=sr("bu"),m1=sr("u"),vw=sr("bum"),Ew=sr("um"),_1=sr("sp"),g1=sr("rtg"),y1=sr("rtc");function v1(n,e=ln){_d("ec",n,e)}const E1="components";function lc(n,e){return T1(E1,n,!0,e)||n}const I1=Symbol.for("v-ndc");function T1(n,e,t=!0,s=!1){const r=Jt||ln;if(r){const i=r.type;{const a=aN(i,!1);if(a&&(a===e||a===Gn(e)||a===ud(Gn(e))))return i}const o=ov(r[n]||i[n],e)||ov(r.appContext[n],e);return!o&&s?i:o}}function ov(n,e){return n&&(n[e]||n[Gn(e)]||n[ud(Gn(e))])}function Xt(n,e,t,s){let r;const i=t,o=we(n);if(o||kt(n)){const a=o&&Li(n);let l=!1,u=!1;a&&(l=!$n(n),u=Ys(n),n=fd(n)),r=new Array(n.length);for(let h=0,d=n.length;h<d;h++)r[h]=e(l?u?Xo(ls(n[h])):ls(n[h]):n[h],h,void 0,i)}else if(typeof n=="number"){r=new Array(n);for(let a=0;a<n;a++)r[a]=e(a+1,a,void 0,i)}else if(ot(n))if(n[Symbol.iterator])r=Array.from(n,(a,l)=>e(a,l,void 0,i));else{const a=Object.keys(n);r=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const h=a[l];r[l]=e(n[h],h,l,i)}}else r=[];return r}function av(n,e,t={},s,r){if(Jt.ce||Jt.parent&&Bo(Jt.parent)&&Jt.parent.ce){const u=Object.keys(t).length>0;return e!=="default"&&(t.name=e),Y(),Zo(qe,null,[He("slot",t,s)],u?-2:64)}let i=n[e];i&&i._c&&(i._d=!1),Y();const o=i&&Iw(i(t)),a=t.key||o&&o.key,l=Zo(qe,{key:(a&&!as(a)?a:`_${e}`)+(!o&&s?"_fb":"")},o||[],o&&n._===1?64:-2);return i&&i._c&&(i._d=!0),l}function Iw(n){return n.some(e=>uc(e)?!(e.type===Js||e.type===qe&&!Iw(e.children)):!0)?n:null}const yp=n=>n?Bw(n)?vd(n):yp(n.parent):null,Ml=fn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>yp(n.parent),$root:n=>yp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>ww(n),$forceUpdate:n=>n.f||(n.f=()=>{Gm(n.update)}),$nextTick:n=>n.n||(n.n=cw.bind(n.proxy)),$watch:n=>o1.bind(n)}),xf=(n,e)=>n!==rt&&!n.__isScriptSetup&&We(n,e),w1={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:r,props:i,accessCache:o,type:a,appContext:l}=n;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return s[e];case 2:return r[e];case 4:return t[e];case 3:return i[e]}else{if(xf(s,e))return o[e]=1,s[e];if(r!==rt&&We(r,e))return o[e]=2,r[e];if(We(i,e))return o[e]=3,i[e];if(t!==rt&&We(t,e))return o[e]=4,t[e];vp&&(o[e]=0)}}const u=Ml[e];let h,d;if(u)return e==="$attrs"&&rn(n.attrs,"get",""),u(n);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==rt&&We(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,We(d,e))return d[e]},set({_:n},e,t){const{data:s,setupState:r,ctx:i}=n;return xf(r,e)?(r[e]=t,!0):s!==rt&&We(s,e)?(s[e]=t,!0):We(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:s,appContext:r,props:i,type:o}},a){let l;return!!(t[a]||n!==rt&&a[0]!=="$"&&We(n,a)||xf(e,a)||We(i,a)||We(s,a)||We(Ml,a)||We(r.config.globalProperties,a)||(l=o.__cssModules)&&l[a])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:We(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function lv(n){return we(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let vp=!0;function b1(n){const e=ww(n),t=n.proxy,s=n.ctx;vp=!1,e.beforeCreate&&cv(e.beforeCreate,n,"bc");const{data:r,computed:i,methods:o,watch:a,provide:l,inject:u,created:h,beforeMount:d,mounted:f,beforeUpdate:_,updated:E,activated:T,deactivated:C,beforeDestroy:L,beforeUnmount:U,destroyed:N,unmounted:k,render:G,renderTracked:J,renderTriggered:b,errorCaptured:v,serverPrefetch:A,expose:P,inheritAttrs:R,components:x,directives:w,filters:nt}=e;if(u&&A1(u,s,null),o)for(const Fe in o){const se=o[Fe];Se(se)&&(s[Fe]=se.bind(t))}if(r){const Fe=r.call(t,t);ot(Fe)&&(n.data=pd(Fe))}if(vp=!0,i)for(const Fe in i){const se=i[Fe],re=Se(se)?se.bind(t,t):Se(se.get)?se.get.bind(t,t):Ts,ft=!Se(se)&&Se(se.set)?se.set.bind(t):Ts,pn=he({get:re,set:ft});Object.defineProperty(s,Fe,{enumerable:!0,configurable:!0,get:()=>pn.value,set:xt=>pn.value=xt})}if(a)for(const Fe in a)Tw(a[Fe],s,t,Fe);if(l){const Fe=Se(l)?l.call(t):l;Reflect.ownKeys(Fe).forEach(se=>{qu(se,Fe[se])})}h&&cv(h,n,"c");function lt(Fe,se){we(se)?se.forEach(re=>Fe(re.bind(t))):se&&Fe(se.bind(t))}if(lt(f1,d),lt(zm,f),lt(p1,_),lt(m1,E),lt(u1,T),lt(h1,C),lt(v1,v),lt(y1,J),lt(g1,b),lt(vw,U),lt(Ew,k),lt(_1,A),we(P))if(P.length){const Fe=n.exposed||(n.exposed={});P.forEach(se=>{Object.defineProperty(Fe,se,{get:()=>t[se],set:re=>t[se]=re,enumerable:!0})})}else n.exposed||(n.exposed={});G&&n.render===Ts&&(n.render=G),R!=null&&(n.inheritAttrs=R),x&&(n.components=x),w&&(n.directives=w),A&&_w(n)}function A1(n,e,t=Ts){we(n)&&(n=Ep(n));for(const s in n){const r=n[s];let i;ot(r)?"default"in r?i=ts(r.from||s,r.default,!0):i=ts(r.from||s):i=ts(r),cn(i)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[s]=i}}function cv(n,e,t){Rs(we(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,t)}function Tw(n,e,t,s){let r=s.includes(".")?pw(t,s):()=>t[s];if(kt(n)){const i=e[n];Se(i)&&Ks(r,i)}else if(Se(n))Ks(r,n.bind(t));else if(ot(n))if(we(n))n.forEach(i=>Tw(i,e,t,s));else{const i=Se(n.handler)?n.handler.bind(t):e[n.handler];Se(i)&&Ks(r,i,n)}}function ww(n){const e=n.type,{mixins:t,extends:s}=e,{mixins:r,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!r.length&&!t&&!s?l=e:(l={},r.length&&r.forEach(u=>ph(l,u,o,!0)),ph(l,e,o)),ot(e)&&i.set(e,l),l}function ph(n,e,t,s=!1){const{mixins:r,extends:i}=e;i&&ph(n,i,t,!0),r&&r.forEach(o=>ph(n,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=S1[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const S1={data:uv,props:hv,emits:hv,methods:Al,computed:Al,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:Al,directives:Al,watch:C1,provide:uv,inject:R1};function uv(n,e){return e?n?function(){return fn(Se(n)?n.call(this,this):n,Se(e)?e.call(this,this):e)}:e:n}function R1(n,e){return Al(Ep(n),Ep(e))}function Ep(n){if(we(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function _n(n,e){return n?[...new Set([].concat(n,e))]:e}function Al(n,e){return n?fn(Object.create(null),n,e):e}function hv(n,e){return n?we(n)&&we(e)?[...new Set([...n,...e])]:fn(Object.create(null),lv(n),lv(e??{})):e}function C1(n,e){if(!n)return e;if(!e)return n;const t=fn(Object.create(null),n);for(const s in e)t[s]=_n(n[s],e[s]);return t}function bw(){return{app:null,config:{isNativeTag:MT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let P1=0;function N1(n,e){return function(s,r=null){Se(s)||(s=fn({},s)),r!=null&&!ot(r)&&(r=null);const i=bw(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:P1++,_component:s,_props:r,_container:null,_context:i,_instance:null,version:cN,get config(){return i.config},set config(h){},use(h,...d){return o.has(h)||(h&&Se(h.install)?(o.add(h),h.install(u,...d)):Se(h)&&(o.add(h),h(u,...d))),u},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),u},component(h,d){return d?(i.components[h]=d,u):i.components[h]},directive(h,d){return d?(i.directives[h]=d,u):i.directives[h]},mount(h,d,f){if(!l){const _=u._ceVNode||He(s,r);return _.appContext=i,f===!0?f="svg":f===!1&&(f=void 0),n(_,h,f),l=!0,u._container=h,h.__vue_app__=u,vd(_.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Rs(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(h,d){return i.provides[h]=d,u},runWithContext(h){const d=qo;qo=u;try{return h()}finally{qo=d}}};return u}}let qo=null;const k1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Gn(e)}Modifiers`]||n[`${oo(e)}Modifiers`];function x1(n,e,...t){if(n.isUnmounted)return;const s=n.vnode.props||rt;let r=t;const i=e.startsWith("update:"),o=i&&k1(s,e.slice(7));o&&(o.trim&&(r=t.map(h=>kt(h)?h.trim():h)),o.number&&(r=t.map(Mm)));let a,l=s[a=Rf(e)]||s[a=Rf(Gn(e))];!l&&i&&(l=s[a=Rf(oo(e))]),l&&Rs(l,n,6,r);const u=s[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Rs(u,n,6,r)}}const D1=new WeakMap;function Aw(n,e,t=!1){const s=t?D1:e.emitsCache,r=s.get(n);if(r!==void 0)return r;const i=n.emits;let o={},a=!1;if(!Se(n)){const l=u=>{const h=Aw(u,e,!0);h&&(a=!0,fn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(ot(n)&&s.set(n,null),null):(we(i)?i.forEach(l=>o[l]=null):fn(o,i),ot(n)&&s.set(n,o),o)}function gd(n,e){return!n||!ad(e)?!1:(e=e.slice(2).replace(/Once$/,""),We(n,e[0].toLowerCase()+e.slice(1))||We(n,oo(e))||We(n,e))}function dv(n){const{type:e,vnode:t,proxy:s,withProxy:r,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:h,props:d,data:f,setupState:_,ctx:E,inheritAttrs:T}=n,C=dh(n);let L,U;try{if(t.shapeFlag&4){const k=r||s,G=k;L=_s(u.call(G,k,h,d,_,f,E)),U=a}else{const k=e;L=_s(k.length>1?k(d,{attrs:a,slots:o,emit:l}):k(d,null)),U=e.props?a:V1(a)}}catch(k){Ll.length=0,md(k,n,1),L=He(Js)}let N=L;if(U&&T!==!1){const k=Object.keys(U),{shapeFlag:G}=N;k.length&&G&7&&(i&&k.some(Dm)&&(U=O1(U,i)),N=ea(N,U,!1,!0))}return t.dirs&&(N=ea(N,null,!1,!0),N.dirs=N.dirs?N.dirs.concat(t.dirs):t.dirs),t.transition&&Wm(N,t.transition),L=N,dh(C),L}const V1=n=>{let e;for(const t in n)(t==="class"||t==="style"||ad(t))&&((e||(e={}))[t]=n[t]);return e},O1=(n,e)=>{const t={};for(const s in n)(!Dm(s)||!(s.slice(9)in e))&&(t[s]=n[s]);return t};function M1(n,e,t){const{props:s,children:r,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?fv(s,o,u):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const f=h[d];if(o[f]!==s[f]&&!gd(u,f))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?fv(s,o,u):!0:!!o;return!1}function fv(n,e,t){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let r=0;r<s.length;r++){const i=s[r];if(e[i]!==n[i]&&!gd(t,i))return!0}return!1}function L1({vnode:n,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=e.vnode).el=t,e=e.parent;else break}}const Sw={},Rw=()=>Object.create(Sw),Cw=n=>Object.getPrototypeOf(n)===Sw;function F1(n,e,t,s=!1){const r={},i=Rw();n.propsDefaults=Object.create(null),Pw(n,e,r,i);for(const o in n.propsOptions[0])o in r||(r[o]=void 0);t?n.props=s?r:iw(r):n.type.props?n.props=r:n.props=i,n.attrs=i}function U1(n,e,t,s){const{props:r,attrs:i,vnode:{patchFlag:o}}=n,a=Ke(r),[l]=n.propsOptions;let u=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let f=h[d];if(gd(n.emitsOptions,f))continue;const _=e[f];if(l)if(We(i,f))_!==i[f]&&(i[f]=_,u=!0);else{const E=Gn(f);r[E]=Ip(l,a,E,_,n,!1)}else _!==i[f]&&(i[f]=_,u=!0)}}}else{Pw(n,e,r,i)&&(u=!0);let h;for(const d in a)(!e||!We(e,d)&&((h=oo(d))===d||!We(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(r[d]=Ip(l,a,d,void 0,n,!0)):delete r[d]);if(i!==a)for(const d in i)(!e||!We(e,d))&&(delete i[d],u=!0)}u&&Ms(n.attrs,"set","")}function Pw(n,e,t,s){const[r,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(kl(l))continue;const u=e[l];let h;r&&We(r,h=Gn(l))?!i||!i.includes(h)?t[h]=u:(a||(a={}))[h]=u:gd(n.emitsOptions,l)||(!(l in s)||u!==s[l])&&(s[l]=u,o=!0)}if(i){const l=Ke(t),u=a||rt;for(let h=0;h<i.length;h++){const d=i[h];t[d]=Ip(r,l,d,u[d],n,!We(u,d))}}return o}function Ip(n,e,t,s,r,i){const o=n[t];if(o!=null){const a=We(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Se(l)){const{propsDefaults:u}=r;if(t in u)s=u[t];else{const h=Uc(r);s=u[t]=l.call(null,e),h()}}else s=l;r.ce&&r.ce._setProp(t,s)}o[0]&&(i&&!a?s=!1:o[1]&&(s===""||s===oo(t))&&(s=!0))}return s}const B1=new WeakMap;function Nw(n,e,t=!1){const s=t?B1:e.propsCache,r=s.get(n);if(r)return r;const i=n.props,o={},a=[];let l=!1;if(!Se(n)){const h=d=>{l=!0;const[f,_]=Nw(d,e,!0);fn(o,f),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return ot(n)&&s.set(n,Lo),Lo;if(we(i))for(let h=0;h<i.length;h++){const d=Gn(i[h]);pv(d)&&(o[d]=rt)}else if(i)for(const h in i){const d=Gn(h);if(pv(d)){const f=i[h],_=o[d]=we(f)||Se(f)?{type:f}:fn({},f),E=_.type;let T=!1,C=!0;if(we(E))for(let L=0;L<E.length;++L){const U=E[L],N=Se(U)&&U.name;if(N==="Boolean"){T=!0;break}else N==="String"&&(C=!1)}else T=Se(E)&&E.name==="Boolean";_[0]=T,_[1]=C,(T||We(_,"default"))&&a.push(d)}}const u=[o,a];return ot(n)&&s.set(n,u),u}function pv(n){return n[0]!=="$"&&!kl(n)}const Hm=n=>n==="_"||n==="_ctx"||n==="$stable",Qm=n=>we(n)?n.map(_s):[_s(n)],q1=(n,e,t)=>{if(e._n)return e;const s=zn((...r)=>Qm(e(...r)),t);return s._c=!1,s},kw=(n,e,t)=>{const s=n._ctx;for(const r in n){if(Hm(r))continue;const i=n[r];if(Se(i))e[r]=q1(r,i,s);else if(i!=null){const o=Qm(i);e[r]=()=>o}}},xw=(n,e)=>{const t=Qm(e);n.slots.default=()=>t},Dw=(n,e,t)=>{for(const s in e)(t||!Hm(s))&&(n[s]=e[s])},$1=(n,e,t)=>{const s=n.slots=Rw();if(n.vnode.shapeFlag&32){const r=e._;r?(Dw(s,e,t),t&&BT(s,"_",r,!0)):kw(e,s)}else e&&xw(n,e)},j1=(n,e,t)=>{const{vnode:s,slots:r}=n;let i=!0,o=rt;if(s.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Dw(r,e,t):(i=!e.$stable,kw(e,r)),o=e}else e&&(xw(n,e),o={default:1});if(i)for(const a in r)!Hm(a)&&o[a]==null&&delete r[a]},Dn=H1;function G1(n){return K1(n)}function K1(n,e){const t=hd();t.__VUE__=!0;const{insert:s,remove:r,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:h,parentNode:d,nextSibling:f,setScopeId:_=Ts,insertStaticContent:E}=n,T=(I,S,V,q=null,K=null,$=null,oe=void 0,Q=null,H=!!S.dynamicChildren)=>{if(I===S)return;I&&!dl(I,S)&&(q=j(I),xt(I,K,$,!0),I=null),S.patchFlag===-2&&(H=!1,S.dynamicChildren=null);const{type:z,ref:ve,shapeFlag:ce}=S;switch(z){case yd:C(I,S,V,q);break;case Js:L(I,S,V,q);break;case $u:I==null&&U(S,V,q,oe);break;case qe:x(I,S,V,q,K,$,oe,Q,H);break;default:ce&1?G(I,S,V,q,K,$,oe,Q,H):ce&6?w(I,S,V,q,K,$,oe,Q,H):(ce&64||ce&128)&&z.process(I,S,V,q,K,$,oe,Q,H,_e)}ve!=null&&K?Ol(ve,I&&I.ref,$,S||I,!S):ve==null&&I&&I.ref!=null&&Ol(I.ref,null,$,I,!0)},C=(I,S,V,q)=>{if(I==null)s(S.el=a(S.children),V,q);else{const K=S.el=I.el;S.children!==I.children&&u(K,S.children)}},L=(I,S,V,q)=>{I==null?s(S.el=l(S.children||""),V,q):S.el=I.el},U=(I,S,V,q)=>{[I.el,I.anchor]=E(I.children,S,V,q,I.el,I.anchor)},N=({el:I,anchor:S},V,q)=>{let K;for(;I&&I!==S;)K=f(I),s(I,V,q),I=K;s(S,V,q)},k=({el:I,anchor:S})=>{let V;for(;I&&I!==S;)V=f(I),r(I),I=V;r(S)},G=(I,S,V,q,K,$,oe,Q,H)=>{if(S.type==="svg"?oe="svg":S.type==="math"&&(oe="mathml"),I==null)J(S,V,q,K,$,oe,Q,H);else{const z=I.el&&I.el._isVueCE?I.el:null;try{z&&z._beginPatch(),A(I,S,K,$,oe,Q,H)}finally{z&&z._endPatch()}}},J=(I,S,V,q,K,$,oe,Q)=>{let H,z;const{props:ve,shapeFlag:ce,transition:ge,dirs:Ee}=I;if(H=I.el=o(I.type,$,ve&&ve.is,ve),ce&8?h(H,I.children):ce&16&&v(I.children,H,null,q,K,Df(I,$),oe,Q),Ee&&yi(I,null,q,"created"),b(H,I,I.scopeId,oe,q),ve){for(const Ye in ve)Ye!=="value"&&!kl(Ye)&&i(H,Ye,null,ve[Ye],$,q);"value"in ve&&i(H,"value",null,ve.value,$),(z=ve.onVnodeBeforeMount)&&fs(z,q,I)}Ee&&yi(I,null,q,"beforeMount");const xe=W1(K,ge);xe&&ge.beforeEnter(H),s(H,S,V),((z=ve&&ve.onVnodeMounted)||xe||Ee)&&Dn(()=>{z&&fs(z,q,I),xe&&ge.enter(H),Ee&&yi(I,null,q,"mounted")},K)},b=(I,S,V,q,K)=>{if(V&&_(I,V),q)for(let $=0;$<q.length;$++)_(I,q[$]);if(K){let $=K.subTree;if(S===$||Lw($.type)&&($.ssContent===S||$.ssFallback===S)){const oe=K.vnode;b(I,oe,oe.scopeId,oe.slotScopeIds,K.parent)}}},v=(I,S,V,q,K,$,oe,Q,H=0)=>{for(let z=H;z<I.length;z++){const ve=I[z]=Q?Rr(I[z]):_s(I[z]);T(null,ve,S,V,q,K,$,oe,Q)}},A=(I,S,V,q,K,$,oe)=>{const Q=S.el=I.el;let{patchFlag:H,dynamicChildren:z,dirs:ve}=S;H|=I.patchFlag&16;const ce=I.props||rt,ge=S.props||rt;let Ee;if(V&&vi(V,!1),(Ee=ge.onVnodeBeforeUpdate)&&fs(Ee,V,S,I),ve&&yi(S,I,V,"beforeUpdate"),V&&vi(V,!0),(ce.innerHTML&&ge.innerHTML==null||ce.textContent&&ge.textContent==null)&&h(Q,""),z?P(I.dynamicChildren,z,Q,V,q,Df(S,K),$):oe||se(I,S,Q,null,V,q,Df(S,K),$,!1),H>0){if(H&16)R(Q,ce,ge,V,K);else if(H&2&&ce.class!==ge.class&&i(Q,"class",null,ge.class,K),H&4&&i(Q,"style",ce.style,ge.style,K),H&8){const xe=S.dynamicProps;for(let Ye=0;Ye<xe.length;Ye++){const Be=xe[Ye],Zt=ce[Be],en=ge[Be];(en!==Zt||Be==="value")&&i(Q,Be,Zt,en,K,V)}}H&1&&I.children!==S.children&&h(Q,S.children)}else!oe&&z==null&&R(Q,ce,ge,V,K);((Ee=ge.onVnodeUpdated)||ve)&&Dn(()=>{Ee&&fs(Ee,V,S,I),ve&&yi(S,I,V,"updated")},q)},P=(I,S,V,q,K,$,oe)=>{for(let Q=0;Q<S.length;Q++){const H=I[Q],z=S[Q],ve=H.el&&(H.type===qe||!dl(H,z)||H.shapeFlag&198)?d(H.el):V;T(H,z,ve,null,q,K,$,oe,!0)}},R=(I,S,V,q,K)=>{if(S!==V){if(S!==rt)for(const $ in S)!kl($)&&!($ in V)&&i(I,$,S[$],null,K,q);for(const $ in V){if(kl($))continue;const oe=V[$],Q=S[$];oe!==Q&&$!=="value"&&i(I,$,Q,oe,K,q)}"value"in V&&i(I,"value",S.value,V.value,K)}},x=(I,S,V,q,K,$,oe,Q,H)=>{const z=S.el=I?I.el:a(""),ve=S.anchor=I?I.anchor:a("");let{patchFlag:ce,dynamicChildren:ge,slotScopeIds:Ee}=S;Ee&&(Q=Q?Q.concat(Ee):Ee),I==null?(s(z,V,q),s(ve,V,q),v(S.children||[],V,ve,K,$,oe,Q,H)):ce>0&&ce&64&&ge&&I.dynamicChildren&&I.dynamicChildren.length===ge.length?(P(I.dynamicChildren,ge,V,K,$,oe,Q),(S.key!=null||K&&S===K.subTree)&&Vw(I,S,!0)):se(I,S,V,ve,K,$,oe,Q,H)},w=(I,S,V,q,K,$,oe,Q,H)=>{S.slotScopeIds=Q,I==null?S.shapeFlag&512?K.ctx.activate(S,V,q,oe,H):nt(S,V,q,K,$,oe,H):Ut(I,S,H)},nt=(I,S,V,q,K,$,oe)=>{const Q=I.component=tN(I,q,K);if(gw(I)&&(Q.ctx.renderer=_e),sN(Q,!1,oe),Q.asyncDep){if(K&&K.registerDep(Q,lt,oe),!I.el){const H=Q.subTree=He(Js);L(null,H,S,V),I.placeholder=H.el}}else lt(Q,I,S,V,K,$,oe)},Ut=(I,S,V)=>{const q=S.component=I.component;if(M1(I,S,V))if(q.asyncDep&&!q.asyncResolved){Fe(q,S,V);return}else q.next=S,q.update();else S.el=I.el,q.vnode=S},lt=(I,S,V,q,K,$,oe)=>{const Q=()=>{if(I.isMounted){let{next:ce,bu:ge,u:Ee,parent:xe,vnode:Ye}=I;{const kn=Ow(I);if(kn){ce&&(ce.el=Ye.el,Fe(I,ce,oe)),kn.asyncDep.then(()=>{I.isUnmounted||Q()});return}}let Be=ce,Zt;vi(I,!1),ce?(ce.el=Ye.el,Fe(I,ce,oe)):ce=Ye,ge&&Bu(ge),(Zt=ce.props&&ce.props.onVnodeBeforeUpdate)&&fs(Zt,xe,ce,Ye),vi(I,!0);const en=dv(I),Nn=I.subTree;I.subTree=en,T(Nn,en,d(Nn.el),j(Nn),I,K,$),ce.el=en.el,Be===null&&L1(I,en.el),Ee&&Dn(Ee,K),(Zt=ce.props&&ce.props.onVnodeUpdated)&&Dn(()=>fs(Zt,xe,ce,Ye),K)}else{let ce;const{el:ge,props:Ee}=S,{bm:xe,m:Ye,parent:Be,root:Zt,type:en}=I,Nn=Bo(S);vi(I,!1),xe&&Bu(xe),!Nn&&(ce=Ee&&Ee.onVnodeBeforeMount)&&fs(ce,Be,S),vi(I,!0);{Zt.ce&&Zt.ce._def.shadowRoot!==!1&&Zt.ce._injectChildStyle(en);const kn=I.subTree=dv(I);T(null,kn,V,q,I,K,$),S.el=kn.el}if(Ye&&Dn(Ye,K),!Nn&&(ce=Ee&&Ee.onVnodeMounted)){const kn=S;Dn(()=>fs(ce,Be,kn),K)}(S.shapeFlag&256||Be&&Bo(Be.vnode)&&Be.vnode.shapeFlag&256)&&I.a&&Dn(I.a,K),I.isMounted=!0,S=V=q=null}};I.scope.on();const H=I.effect=new KT(Q);I.scope.off();const z=I.update=H.run.bind(H),ve=I.job=H.runIfDirty.bind(H);ve.i=I,ve.id=I.uid,H.scheduler=()=>Gm(ve),vi(I,!0),z()},Fe=(I,S,V)=>{S.component=I;const q=I.vnode.props;I.vnode=S,I.next=null,U1(I,S.props,q,V),j1(I,S.children,V),Hs(),rv(I),Qs()},se=(I,S,V,q,K,$,oe,Q,H=!1)=>{const z=I&&I.children,ve=I?I.shapeFlag:0,ce=S.children,{patchFlag:ge,shapeFlag:Ee}=S;if(ge>0){if(ge&128){ft(z,ce,V,q,K,$,oe,Q,H);return}else if(ge&256){re(z,ce,V,q,K,$,oe,Q,H);return}}Ee&8?(ve&16&&et(z,K,$),ce!==z&&h(V,ce)):ve&16?Ee&16?ft(z,ce,V,q,K,$,oe,Q,H):et(z,K,$,!0):(ve&8&&h(V,""),Ee&16&&v(ce,V,q,K,$,oe,Q,H))},re=(I,S,V,q,K,$,oe,Q,H)=>{I=I||Lo,S=S||Lo;const z=I.length,ve=S.length,ce=Math.min(z,ve);let ge;for(ge=0;ge<ce;ge++){const Ee=S[ge]=H?Rr(S[ge]):_s(S[ge]);T(I[ge],Ee,V,null,K,$,oe,Q,H)}z>ve?et(I,K,$,!0,!1,ce):v(S,V,q,K,$,oe,Q,H,ce)},ft=(I,S,V,q,K,$,oe,Q,H)=>{let z=0;const ve=S.length;let ce=I.length-1,ge=ve-1;for(;z<=ce&&z<=ge;){const Ee=I[z],xe=S[z]=H?Rr(S[z]):_s(S[z]);if(dl(Ee,xe))T(Ee,xe,V,null,K,$,oe,Q,H);else break;z++}for(;z<=ce&&z<=ge;){const Ee=I[ce],xe=S[ge]=H?Rr(S[ge]):_s(S[ge]);if(dl(Ee,xe))T(Ee,xe,V,null,K,$,oe,Q,H);else break;ce--,ge--}if(z>ce){if(z<=ge){const Ee=ge+1,xe=Ee<ve?S[Ee].el:q;for(;z<=ge;)T(null,S[z]=H?Rr(S[z]):_s(S[z]),V,xe,K,$,oe,Q,H),z++}}else if(z>ge)for(;z<=ce;)xt(I[z],K,$,!0),z++;else{const Ee=z,xe=z,Ye=new Map;for(z=xe;z<=ge;z++){const zt=S[z]=H?Rr(S[z]):_s(S[z]);zt.key!=null&&Ye.set(zt.key,z)}let Be,Zt=0;const en=ge-xe+1;let Nn=!1,kn=0;const Wn=new Array(en);for(z=0;z<en;z++)Wn[z]=0;for(z=Ee;z<=ce;z++){const zt=I[z];if(Zt>=en){xt(zt,K,$,!0);continue}let Bt;if(zt.key!=null)Bt=Ye.get(zt.key);else for(Be=xe;Be<=ge;Be++)if(Wn[Be-xe]===0&&dl(zt,S[Be])){Bt=Be;break}Bt===void 0?xt(zt,K,$,!0):(Wn[Bt-xe]=z+1,Bt>=kn?kn=Bt:Nn=!0,T(zt,S[Bt],V,null,K,$,oe,Q,H),Zt++)}const go=Nn?z1(Wn):Lo;for(Be=go.length-1,z=en-1;z>=0;z--){const zt=xe+z,Bt=S[zt],Qa=S[zt+1],fi=zt+1<ve?Qa.el||Mw(Qa):q;Wn[z]===0?T(null,Bt,V,fi,K,$,oe,Q,H):Nn&&(Be<0||z!==go[Be]?pn(Bt,V,fi,2):Be--)}}},pn=(I,S,V,q,K=null)=>{const{el:$,type:oe,transition:Q,children:H,shapeFlag:z}=I;if(z&6){pn(I.component.subTree,S,V,q);return}if(z&128){I.suspense.move(S,V,q);return}if(z&64){oe.move(I,S,V,_e);return}if(oe===qe){s($,S,V);for(let ce=0;ce<H.length;ce++)pn(H[ce],S,V,q);s(I.anchor,S,V);return}if(oe===$u){N(I,S,V);return}if(q!==2&&z&1&&Q)if(q===0)Q.beforeEnter($),s($,S,V),Dn(()=>Q.enter($),K);else{const{leave:ce,delayLeave:ge,afterLeave:Ee}=Q,xe=()=>{I.ctx.isUnmounted?r($):s($,S,V)},Ye=()=>{$._isLeaving&&$[c1](!0),ce($,()=>{xe(),Ee&&Ee()})};ge?ge($,xe,Ye):Ye()}else s($,S,V)},xt=(I,S,V,q=!1,K=!1)=>{const{type:$,props:oe,ref:Q,children:H,dynamicChildren:z,shapeFlag:ve,patchFlag:ce,dirs:ge,cacheIndex:Ee}=I;if(ce===-2&&(K=!1),Q!=null&&(Hs(),Ol(Q,null,V,I,!0),Qs()),Ee!=null&&(S.renderCache[Ee]=void 0),ve&256){S.ctx.deactivate(I);return}const xe=ve&1&&ge,Ye=!Bo(I);let Be;if(Ye&&(Be=oe&&oe.onVnodeBeforeUnmount)&&fs(Be,S,I),ve&6)le(I.component,V,q);else{if(ve&128){I.suspense.unmount(V,q);return}xe&&yi(I,null,S,"beforeUnmount"),ve&64?I.type.remove(I,S,V,_e,q):z&&!z.hasOnce&&($!==qe||ce>0&&ce&64)?et(z,S,V,!1,!0):($===qe&&ce&384||!K&&ve&16)&&et(H,S,V),q&&ue(I)}(Ye&&(Be=oe&&oe.onVnodeUnmounted)||xe)&&Dn(()=>{Be&&fs(Be,S,I),xe&&yi(I,null,S,"unmounted")},V)},ue=I=>{const{type:S,el:V,anchor:q,transition:K}=I;if(S===qe){ie(V,q);return}if(S===$u){k(I);return}const $=()=>{r(V),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(I.shapeFlag&1&&K&&!K.persisted){const{leave:oe,delayLeave:Q}=K,H=()=>oe(V,$);Q?Q(I.el,$,H):H()}else $()},ie=(I,S)=>{let V;for(;I!==S;)V=f(I),r(I),I=V;r(S)},le=(I,S,V)=>{const{bum:q,scope:K,job:$,subTree:oe,um:Q,m:H,a:z}=I;mv(H),mv(z),q&&Bu(q),K.stop(),$&&($.flags|=8,xt(oe,I,S,V)),Q&&Dn(Q,S),Dn(()=>{I.isUnmounted=!0},S)},et=(I,S,V,q=!1,K=!1,$=0)=>{for(let oe=$;oe<I.length;oe++)xt(I[oe],S,V,q,K)},j=I=>{if(I.shapeFlag&6)return j(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const S=f(I.anchor||I.el),V=S&&S[a1];return V?f(V):S};let fe=!1;const ae=(I,S,V)=>{let q;I==null?S._vnode&&(xt(S._vnode,null,null,!0),q=S._vnode.component):T(S._vnode||null,I,S,null,null,null,V),S._vnode=I,fe||(fe=!0,rv(q),hw(),fe=!1)},_e={p:T,um:xt,m:pn,r:ue,mt:nt,mc:v,pc:se,pbc:P,n:j,o:n};return{render:ae,hydrate:void 0,createApp:N1(ae)}}function Df({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function vi({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function W1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Vw(n,e,t=!1){const s=n.children,r=e.children;if(we(s)&&we(r))for(let i=0;i<s.length;i++){const o=s[i];let a=r[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[i]=Rr(r[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Vw(o,a)),a.type===yd&&(a.patchFlag!==-1?a.el=o.el:a.__elIndex=i+(n.type===qe?1:0)),a.type===Js&&!a.el&&(a.el=o.el)}}function z1(n){const e=n.slice(),t=[0];let s,r,i,o,a;const l=n.length;for(s=0;s<l;s++){const u=n[s];if(u!==0){if(r=t[t.length-1],n[r]<u){e[s]=r,t.push(s);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[s]=t[i-1]),t[i]=s)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Ow(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Ow(e)}function mv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}function Mw(n){if(n.placeholder)return n.placeholder;const e=n.component;return e?Mw(e.subTree):null}const Lw=n=>n.__isSuspense;function H1(n,e){e&&e.pendingBranch?we(n)?e.effects.push(...n):e.effects.push(n):s1(n)}const qe=Symbol.for("v-fgt"),yd=Symbol.for("v-txt"),Js=Symbol.for("v-cmt"),$u=Symbol.for("v-stc"),Ll=[];let Mn=null;function Y(n=!1){Ll.push(Mn=n?null:[])}function Q1(){Ll.pop(),Mn=Ll[Ll.length-1]||null}let cc=1;function mh(n,e=!1){cc+=n,n<0&&Mn&&e&&(Mn.hasOnce=!0)}function Fw(n){return n.dynamicChildren=cc>0?Mn||Lo:null,Q1(),cc>0&&Mn&&Mn.push(n),n}function X(n,e,t,s,r,i){return Fw(g(n,e,t,s,r,i,!0))}function Zo(n,e,t,s,r){return Fw(He(n,e,t,s,r,!0))}function uc(n){return n?n.__v_isVNode===!0:!1}function dl(n,e){return n.type===e.type&&n.key===e.key}const Uw=({key:n})=>n??null,ju=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?kt(n)||cn(n)||Se(n)?{i:Jt,r:n,k:e,f:!!t}:n:null);function g(n,e=null,t=null,s=0,r=null,i=n===qe?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Uw(e),ref:e&&ju(e),scopeId:fw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Jt};return a?(Ym(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=kt(t)?8:16),cc>0&&!o&&Mn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Mn.push(l),l}const He=Y1;function Y1(n,e=null,t=null,s=0,r=null,i=!1){if((!n||n===I1)&&(n=Js),uc(n)){const a=ea(n,e,!0);return t&&Ym(a,t),cc>0&&!i&&Mn&&(a.shapeFlag&6?Mn[Mn.indexOf(n)]=a:Mn.push(a)),a.patchFlag=-2,a}if(lN(n)&&(n=n.__vccOpts),e){e=J1(e);let{class:a,style:l}=e;a&&!kt(a)&&(e.class=Yo(a)),ot(l)&&(jm(l)&&!we(l)&&(l=fn({},l)),e.style=dd(l))}const o=kt(n)?1:Lw(n)?128:l1(n)?64:ot(n)?4:Se(n)?2:0;return g(n,e,t,s,r,o,i,!0)}function J1(n){return n?jm(n)||Cw(n)?fn({},n):n:null}function ea(n,e,t=!1,s=!1){const{props:r,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?X1(r||{},e):r,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&Uw(u),ref:e&&e.ref?t&&i?we(i)?i.concat(ju(e)):[i,ju(e)]:ju(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==qe?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ea(n.ssContent),ssFallback:n.ssFallback&&ea(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&Wm(h,l.clone(h)),h}function Qt(n=" ",e=0){return He(yd,null,n,e)}function ns(n,e){const t=He($u,null,n);return t.staticCount=e,t}function At(n="",e=!1){return e?(Y(),Zo(Js,null,n)):He(Js,null,n)}function _s(n){return n==null||typeof n=="boolean"?He(Js):we(n)?He(qe,null,n.slice()):uc(n)?Rr(n):He(yd,null,String(n))}function Rr(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ea(n)}function Ym(n,e){let t=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(we(e))t=16;else if(typeof e=="object")if(s&65){const r=e.default;r&&(r._c&&(r._d=!1),Ym(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!Cw(e)?e._ctx=Jt:r===3&&Jt&&(Jt.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Se(e)?(e={default:e,_ctx:Jt},t=32):(e=String(e),s&64?(t=16,e=[Qt(e)]):t=8);n.children=e,n.shapeFlag|=t}function X1(...n){const e={};for(let t=0;t<n.length;t++){const s=n[t];for(const r in s)if(r==="class")e.class!==s.class&&(e.class=Yo([e.class,s.class]));else if(r==="style")e.style=dd([e.style,s.style]);else if(ad(r)){const i=e[r],o=s[r];o&&i!==o&&!(we(i)&&i.includes(o))&&(e[r]=i?[].concat(i,o):o)}else r!==""&&(e[r]=s[r])}return e}function fs(n,e,t,s=null){Rs(n,e,7,[t,s])}const Z1=bw();let eN=0;function tN(n,e,t){const s=n.type,r=(e?e.appContext:n.appContext)||Z1,i={uid:eN++,vnode:n,type:s,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new S0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Nw(s,r),emitsOptions:Aw(s,r),emit:null,emitted:null,propsDefaults:rt,inheritAttrs:s.inheritAttrs,ctx:rt,data:rt,props:rt,attrs:rt,slots:rt,refs:rt,setupState:rt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=x1.bind(null,i),n.ce&&n.ce(i),i}let ln=null;const nN=()=>ln||Jt;let _h,Tp;{const n=hd(),e=(t,s)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(s),i=>{r.length>1?r.forEach(o=>o(i)):r[0](i)}};_h=e("__VUE_INSTANCE_SETTERS__",t=>ln=t),Tp=e("__VUE_SSR_SETTERS__",t=>hc=t)}const Uc=n=>{const e=ln;return _h(n),n.scope.on(),()=>{n.scope.off(),_h(e)}},_v=()=>{ln&&ln.scope.off(),_h(null)};function Bw(n){return n.vnode.shapeFlag&4}let hc=!1;function sN(n,e=!1,t=!1){e&&Tp(e);const{props:s,children:r}=n.vnode,i=Bw(n);F1(n,s,i,e),$1(n,r,t||e);const o=i?rN(n,e):void 0;return e&&Tp(!1),o}function rN(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,w1);const{setup:s}=t;if(s){Hs();const r=n.setupContext=s.length>1?oN(n):null,i=Uc(n),o=Fc(s,n,0,[n.props,r]),a=LT(o);if(Qs(),i(),(a||n.sp)&&!Bo(n)&&_w(n),a){if(o.then(_v,_v),e)return o.then(l=>{gv(n,l)}).catch(l=>{md(l,n,0)});n.asyncDep=o}else gv(n,o)}else qw(n)}function gv(n,e,t){Se(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:ot(e)&&(n.setupState=aw(e)),qw(n)}function qw(n,e,t){const s=n.type;n.render||(n.render=s.render||Ts);{const r=Uc(n);Hs();try{b1(n)}finally{Qs(),r()}}}const iN={get(n,e){return rn(n,"get",""),n[e]}};function oN(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,iN),slots:n.slots,emit:n.emit,expose:e}}function vd(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(aw(z0(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ml)return Ml[t](n)},has(e,t){return t in e||t in Ml}})):n.proxy}function aN(n,e=!0){return Se(n)?n.displayName||n.name:n.name||e&&n.__name}function lN(n){return Se(n)&&"__vccOpts"in n}const he=(n,e)=>X0(n,e,hc);function $w(n,e,t){try{mh(-1);const s=arguments.length;return s===2?ot(e)&&!we(e)?uc(e)?He(n,null,[e]):He(n,e):He(n,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&uc(t)&&(t=[t]),He(n,e,t))}finally{mh(1)}}const cN="3.5.26";let wp;const yv=typeof window<"u"&&window.trustedTypes;if(yv)try{wp=yv.createPolicy("vue",{createHTML:n=>n})}catch{}const jw=wp?n=>wp.createHTML(n):n=>n,uN="http://www.w3.org/2000/svg",hN="http://www.w3.org/1998/Math/MathML",Ds=typeof document<"u"?document:null,vv=Ds&&Ds.createElement("template"),dN={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,s)=>{const r=e==="svg"?Ds.createElementNS(uN,n):e==="mathml"?Ds.createElementNS(hN,n):t?Ds.createElement(n,{is:t}):Ds.createElement(n);return n==="select"&&s&&s.multiple!=null&&r.setAttribute("multiple",s.multiple),r},createText:n=>Ds.createTextNode(n),createComment:n=>Ds.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ds.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,s,r,i){const o=t?t.previousSibling:e.lastChild;if(r&&(r===i||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===i||!(r=r.nextSibling)););else{vv.innerHTML=jw(s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n);const a=vv.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},fN=Symbol("_vtc");function pN(n,e,t){const s=n[fN];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Ev=Symbol("_vod"),mN=Symbol("_vsh"),_N=Symbol(""),gN=/(?:^|;)\s*display\s*:/;function yN(n,e,t){const s=n.style,r=kt(t);let i=!1;if(t&&!r){if(e)if(kt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Gu(s,a,"")}else for(const o in e)t[o]==null&&Gu(s,o,"");for(const o in t)o==="display"&&(i=!0),Gu(s,o,t[o])}else if(r){if(e!==t){const o=s[_N];o&&(t+=";"+o),s.cssText=t,i=gN.test(t)}}else e&&n.removeAttribute("style");Ev in n&&(n[Ev]=i?s.display:"",n[mN]&&(s.display="none"))}const Iv=/\s*!important$/;function Gu(n,e,t){if(we(t))t.forEach(s=>Gu(n,e,s));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const s=vN(n,e);Iv.test(t)?n.setProperty(oo(s),t.replace(Iv,""),"important"):n[s]=t}}const Tv=["Webkit","Moz","ms"],Vf={};function vN(n,e){const t=Vf[e];if(t)return t;let s=Gn(e);if(s!=="filter"&&s in n)return Vf[e]=s;s=ud(s);for(let r=0;r<Tv.length;r++){const i=Tv[r]+s;if(i in n)return Vf[e]=i}return e}const wv="http://www.w3.org/1999/xlink";function bv(n,e,t,s,r,i=b0(e)){s&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(wv,e.slice(6,e.length)):n.setAttributeNS(wv,e,t):t==null||i&&!qT(t)?n.removeAttribute(e):n.setAttribute(e,i?"":as(t)?String(t):t)}function Av(n,e,t,s,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?jw(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=qT(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(r||e)}function Pr(n,e,t,s){n.addEventListener(e,t,s)}function EN(n,e,t,s){n.removeEventListener(e,t,s)}const Sv=Symbol("_vei");function IN(n,e,t,s,r=null){const i=n[Sv]||(n[Sv]={}),o=i[e];if(s&&o)o.value=s;else{const[a,l]=TN(e);if(s){const u=i[e]=AN(s,r);Pr(n,a,u,l)}else o&&(EN(n,a,o,l),i[e]=void 0)}}const Rv=/(?:Once|Passive|Capture)$/;function TN(n){let e;if(Rv.test(n)){e={};let s;for(;s=n.match(Rv);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):oo(n.slice(2)),e]}let Of=0;const wN=Promise.resolve(),bN=()=>Of||(wN.then(()=>Of=0),Of=Date.now());function AN(n,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;Rs(SN(s,t.value),e,5,[s])};return t.value=n,t.attached=bN(),t}function SN(n,e){if(we(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(s=>r=>!r._stopped&&s&&s(r))}else return e}const Cv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,RN=(n,e,t,s,r,i)=>{const o=r==="svg";e==="class"?pN(n,s,o):e==="style"?yN(n,t,s):ad(e)?Dm(e)||IN(n,e,t,s,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):CN(n,e,s,o))?(Av(n,e,s),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&bv(n,e,s,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!kt(s))?Av(n,Gn(e),s,i,e):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),bv(n,e,s,o))};function CN(n,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in n&&Cv(e)&&Se(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return Cv(e)&&kt(t)?!1:e in n}const ta=n=>{const e=n.props["onUpdate:modelValue"]||!1;return we(e)?t=>Bu(e,t):e};function PN(n){n.target.composing=!0}function Pv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ws=Symbol("_assign");function Nv(n,e,t){return e&&(n=n.trim()),t&&(n=Mm(n)),n}const NN={created(n,{modifiers:{lazy:e,trim:t,number:s}},r){n[Ws]=ta(r);const i=s||r.props&&r.props.type==="number";Pr(n,e?"change":"input",o=>{o.target.composing||n[Ws](Nv(n.value,t,i))}),(t||i)&&Pr(n,"change",()=>{n.value=Nv(n.value,t,i)}),e||(Pr(n,"compositionstart",PN),Pr(n,"compositionend",Pv),Pr(n,"change",Pv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:s,trim:r,number:i}},o){if(n[Ws]=ta(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Mm(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(s&&e===t||r&&n.value.trim()===l)||(n.value=l))}},kN={deep:!0,created(n,e,t){n[Ws]=ta(t),Pr(n,"change",()=>{const s=n._modelValue,r=Gw(n),i=n.checked,o=n[Ws];if(we(s)){const a=$T(s,r),l=a!==-1;if(i&&!l)o(s.concat(r));else if(!i&&l){const u=[...s];u.splice(a,1),o(u)}}else if(ld(s)){const a=new Set(s);i?a.add(r):a.delete(r),o(a)}else o(Kw(n,i))})},mounted:kv,beforeUpdate(n,e,t){n[Ws]=ta(t),kv(n,e,t)}};function kv(n,{value:e,oldValue:t},s){n._modelValue=e;let r;if(we(e))r=$T(e,s.props.value)>-1;else if(ld(e))r=e.has(s.props.value);else{if(e===t)return;r=Jo(e,Kw(n,!0))}n.checked!==r&&(n.checked=r)}const Mf={created(n,{value:e},t){n.checked=Jo(e,t.props.value),n[Ws]=ta(t),Pr(n,"change",()=>{n[Ws](Gw(n))})},beforeUpdate(n,{value:e,oldValue:t},s){n[Ws]=ta(s),e!==t&&(n.checked=Jo(e,s.props.value))}};function Gw(n){return"_value"in n?n._value:n.value}function Kw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const xN=["ctrl","shift","alt","meta"],DN={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>xN.some(t=>n[`${t}Key`]&&!e.includes(t))},Ww=(n,e)=>{const t=n._withMods||(n._withMods={}),s=e.join(".");return t[s]||(t[s]=((r,...i)=>{for(let o=0;o<e.length;o++){const a=DN[e[o]];if(a&&a(r,e))return}return n(r,...i)}))},VN=fn({patchProp:RN},dN);let xv;function ON(){return xv||(xv=G1(VN))}const MN=((...n)=>{const e=ON().createApp(...n),{mount:t}=e;return e.mount=s=>{const r=FN(s);if(!r)return;const i=e._component;!Se(i)&&!i.render&&!i.template&&(i.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=t(r,!1,LN(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},e});function LN(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function FN(n){return kt(n)?document.querySelector(n):n}const UN=()=>{};var Dv={};const zw={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Z=function(n,e){if(!n)throw Na(e)},Na=function(n){return new Error("Firebase Database ("+zw.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Hw=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},BN=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Jm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(f=64)),s.push(t[h],t[d],t[f],t[_])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Hw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):BN(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const d=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||d==null)throw new qN;const f=i<<2|a>>4;if(s.push(f),u!==64){const _=a<<4&240|u>>2;if(s.push(_),d!==64){const E=u<<6&192|d;s.push(E)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class qN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Qw=function(n){const e=Hw(n);return Jm.encodeByteArray(e,!0)},gh=function(n){return Qw(n).replace(/\./g,"")},yh=function(n){try{return Jm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function $N(n){return Yw(void 0,n)}function Yw(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!jN(t)||(n[t]=Yw(n[t],e[t]));return n}function jN(n){return n!=="__proto__"}function Jw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const GN=()=>Jw().__FIREBASE_DEFAULTS__,KN=()=>{if(typeof process>"u"||typeof Dv>"u")return;const n=Dv.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},WN=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&yh(n[1]);return e&&JSON.parse(e)},Ed=()=>{try{return UN()||GN()||KN()||WN()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Xw=n=>Ed()?.emulatorHosts?.[n],Zw=n=>{const e=Xw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},eb=()=>Ed()?.config,tb=n=>Ed()?.[`_${n}`];class Xm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function rr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Id(n){return(await fetch(n,{credentials:"include"})).ok}function nb(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[gh(JSON.stringify(t)),gh(JSON.stringify(o)),""].join(".")}const Fl={};function zN(){const n={prod:[],emulator:[]};for(const e of Object.keys(Fl))Fl[e]?n.emulator.push(e):n.prod.push(e);return n}function HN(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Vv=!1;function Zm(n,e){if(typeof window>"u"||typeof document>"u"||!rr(window.location.host)||Fl[n]===e||Fl[n]||Vv)return;Fl[n]=e;function t(f){return`__firebase__banner__${f}`}const s="__firebase__banner",i=zN().prod.length>0;function o(){const f=document.getElementById(s);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,_){f.setAttribute("width","24"),f.setAttribute("id",_),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Vv=!0,o()},f}function h(f,_){f.setAttribute("id",_),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function d(){const f=HN(s),_=t("text"),E=document.getElementById(_)||document.createElement("span"),T=t("learnmore"),C=document.getElementById(T)||document.createElement("a"),L=t("preprendIcon"),U=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const N=f.element;a(N),h(C,T);const k=u();l(U,L),N.append(U,E,C,k),document.body.appendChild(N)}i?(E.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function Mt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function e_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mt())}function sb(){const n=Ed()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function QN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function YN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function rb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function JN(){const n=Mt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function XN(){return zw.NODE_ADMIN===!0}function ib(){return!sb()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ob(){return!sb()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ab(){try{return typeof indexedDB=="object"}catch{return!1}}function ZN(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const ek="FirebaseError";class ir extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=ek,Object.setPrototypeOf(this,ir.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bc.prototype.create)}}class Bc{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?tk(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new ir(r,a,s)}}function tk(n,e){return n.replace(nk,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const nk=/\{\$([^}]+)}/g;function dc(n){return JSON.parse(n)}function Kt(n){return JSON.stringify(n)}const lb=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=dc(yh(i[0])||""),t=dc(yh(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},sk=function(n){const e=lb(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},rk=function(n){const e=lb(n).claims;return typeof e=="object"&&e.admin===!0};function or(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function na(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function bp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function vh(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function Kn(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(Ov(i)&&Ov(o)){if(!Kn(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Ov(n){return n!==null&&typeof n=="object"}function ka(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class ik{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)s[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const f=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(f<<1|f>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let d=0;d<80;d++){d<40?d<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):d<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const f=(r<<5|r>>>27)+u+l+h+s[d]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=f}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function ok(n,e){const t=new ak(n,e);return t.subscribe.bind(t)}class ak{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");lk(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=Lf),r.error===void 0&&(r.error=Lf),r.complete===void 0&&(r.complete=Lf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lk(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Lf(){}function cb(n,e){return`${n} failed: ${e} argument `}const ck=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,Z(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Td=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function je(n){return n&&n._delegate?n._delegate:n}class Kr{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ti="[DEFAULT]";class uk{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Xm;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(dk(e))try{this.getOrInitializeService({instanceIdentifier:Ti})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Ti){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ti){return this.instances.has(e)}getOptions(e=Ti){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:hk(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ti){return this.component?this.component.multipleInstances?e:Ti:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hk(n){return n===Ti?void 0:n}function dk(n){return n.instantiationMode==="EAGER"}class fk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new uk(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var De;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(De||(De={}));const pk={debug:De.DEBUG,verbose:De.VERBOSE,info:De.INFO,warn:De.WARN,error:De.ERROR,silent:De.SILENT},mk=De.INFO,_k={[De.DEBUG]:"log",[De.VERBOSE]:"log",[De.INFO]:"info",[De.WARN]:"warn",[De.ERROR]:"error"},gk=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=_k[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wd{constructor(e){this.name=e,this._logLevel=mk,this._logHandler=gk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in De))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?pk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,De.DEBUG,...e),this._logHandler(this,De.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,De.VERBOSE,...e),this._logHandler(this,De.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,De.INFO,...e),this._logHandler(this,De.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,De.WARN,...e),this._logHandler(this,De.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,De.ERROR,...e),this._logHandler(this,De.ERROR,...e)}}const yk=(n,e)=>e.some(t=>n instanceof t);let Mv,Lv;function vk(){return Mv||(Mv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ek(){return Lv||(Lv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ub=new WeakMap,Ap=new WeakMap,hb=new WeakMap,Ff=new WeakMap,t_=new WeakMap;function Ik(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ur(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ub.set(t,n)}).catch(()=>{}),t_.set(e,n),e}function Tk(n){if(Ap.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Ap.set(n,e)}let Sp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ap.get(n);if(e==="objectStoreNames")return n.objectStoreNames||hb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ur(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function wk(n){Sp=n(Sp)}function bk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Uf(this),e,...t);return hb.set(s,e.sort?e.sort():[e]),Ur(s)}:Ek().includes(n)?function(...e){return n.apply(Uf(this),e),Ur(ub.get(this))}:function(...e){return Ur(n.apply(Uf(this),e))}}function Ak(n){return typeof n=="function"?bk(n):(n instanceof IDBTransaction&&Tk(n),yk(n,vk())?new Proxy(n,Sp):n)}function Ur(n){if(n instanceof IDBRequest)return Ik(n);if(Ff.has(n))return Ff.get(n);const e=Ak(n);return e!==n&&(Ff.set(n,e),t_.set(e,n)),e}const Uf=n=>t_.get(n);function Sk(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Ur(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Ur(o.result),l.oldVersion,l.newVersion,Ur(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Rk=["get","getKey","getAll","getAllKeys","count"],Ck=["put","add","delete","clear"],Bf=new Map;function Fv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Bf.get(e))return Bf.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Ck.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Rk.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return Bf.set(e,i),i}wk(n=>({...n,get:(e,t,s)=>Fv(e,t)||n.get(e,t,s),has:(e,t)=>!!Fv(e,t)||n.has(e,t)}));class Pk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Nk(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Nk(n){return n.getComponent()?.type==="VERSION"}const Rp="@firebase/app",Uv="0.14.6";const Xs=new wd("@firebase/app"),kk="@firebase/app-compat",xk="@firebase/analytics-compat",Dk="@firebase/analytics",Vk="@firebase/app-check-compat",Ok="@firebase/app-check",Mk="@firebase/auth",Lk="@firebase/auth-compat",Fk="@firebase/database",Uk="@firebase/data-connect",Bk="@firebase/database-compat",qk="@firebase/functions",$k="@firebase/functions-compat",jk="@firebase/installations",Gk="@firebase/installations-compat",Kk="@firebase/messaging",Wk="@firebase/messaging-compat",zk="@firebase/performance",Hk="@firebase/performance-compat",Qk="@firebase/remote-config",Yk="@firebase/remote-config-compat",Jk="@firebase/storage",Xk="@firebase/storage-compat",Zk="@firebase/firestore",ex="@firebase/ai",tx="@firebase/firestore-compat",nx="firebase",sx="12.6.0";const Eh="[DEFAULT]",rx={[Rp]:"fire-core",[kk]:"fire-core-compat",[Dk]:"fire-analytics",[xk]:"fire-analytics-compat",[Ok]:"fire-app-check",[Vk]:"fire-app-check-compat",[Mk]:"fire-auth",[Lk]:"fire-auth-compat",[Fk]:"fire-rtdb",[Uk]:"fire-data-connect",[Bk]:"fire-rtdb-compat",[qk]:"fire-fn",[$k]:"fire-fn-compat",[jk]:"fire-iid",[Gk]:"fire-iid-compat",[Kk]:"fire-fcm",[Wk]:"fire-fcm-compat",[zk]:"fire-perf",[Hk]:"fire-perf-compat",[Qk]:"fire-rc",[Yk]:"fire-rc-compat",[Jk]:"fire-gcs",[Xk]:"fire-gcs-compat",[Zk]:"fire-fst",[tx]:"fire-fst-compat",[ex]:"fire-vertex","fire-js":"fire-js",[nx]:"fire-js-all"};const Ih=new Map,ix=new Map,Cp=new Map;function Bv(n,e){try{n.container.addComponent(e)}catch(t){Xs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Gi(n){const e=n.name;if(Cp.has(e))return Xs.debug(`There were multiple attempts to register component ${e}.`),!1;Cp.set(e,n);for(const t of Ih.values())Bv(t,n);for(const t of ix.values())Bv(t,n);return!0}function xa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ox(n,e,t=Eh){xa(n,e).clearInstance(t)}function Bn(n){return n==null?!1:n.settings!==void 0}const ax={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Br=new Bc("app","Firebase",ax);class lx{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Kr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Br.create("app-deleted",{appName:this._name})}}const ao=sx;function db(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Eh,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Br.create("bad-app-name",{appName:String(r)});if(t||(t=eb()),!t)throw Br.create("no-options");const i=Ih.get(r);if(i){if(Kn(t,i.options)&&Kn(s,i.config))return i;throw Br.create("duplicate-app",{appName:r})}const o=new fk(r);for(const l of Cp.values())o.addComponent(l);const a=new lx(t,s,o);return Ih.set(r,a),a}function n_(n=Eh){const e=Ih.get(n);if(!e&&n===Eh&&eb())return db();if(!e)throw Br.create("no-app",{appName:n});return e}function ws(n,e,t){let s=rx[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xs.warn(o.join(" "));return}Gi(new Kr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const cx="firebase-heartbeat-database",ux=1,fc="firebase-heartbeat-store";let qf=null;function fb(){return qf||(qf=Sk(cx,ux,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Br.create("idb-open",{originalErrorMessage:n.message})})),qf}async function hx(n){try{const t=(await fb()).transaction(fc),s=await t.objectStore(fc).get(pb(n));return await t.done,s}catch(e){if(e instanceof ir)Xs.warn(e.message);else{const t=Br.create("idb-get",{originalErrorMessage:e?.message});Xs.warn(t.message)}}}async function qv(n,e){try{const s=(await fb()).transaction(fc,"readwrite");await s.objectStore(fc).put(e,pb(n)),await s.done}catch(t){if(t instanceof ir)Xs.warn(t.message);else{const s=Br.create("idb-set",{originalErrorMessage:t?.message});Xs.warn(s.message)}}}function pb(n){return`${n.name}!${n.options.appId}`}const dx=1024,fx=30;class px{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _x(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=$v();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>fx){const r=gx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Xs.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=$v(),{heartbeatsToSend:t,unsentEntries:s}=mx(this._heartbeatsCache.heartbeats),r=gh(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Xs.warn(e),""}}}function $v(){return new Date().toISOString().substring(0,10)}function mx(n,e=dx){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),jv(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),jv(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class _x{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ab()?ZN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await hx(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return qv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return qv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function jv(n){return gh(JSON.stringify({version:2,heartbeats:n})).length}function gx(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function yx(n){Gi(new Kr("platform-logger",e=>new Pk(e),"PRIVATE")),Gi(new Kr("heartbeat",e=>new px(e),"PRIVATE")),ws(Rp,Uv,n),ws(Rp,Uv,"esm2020"),ws("fire-js","")}yx("");function mb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vx=mb,_b=new Bc("auth","Firebase",mb());const Th=new wd("@firebase/auth");function Ex(n,...e){Th.logLevel<=De.WARN&&Th.warn(`Auth (${ao}): ${n}`,...e)}function Ku(n,...e){Th.logLevel<=De.ERROR&&Th.error(`Auth (${ao}): ${n}`,...e)}function Cs(n,...e){throw r_(n,...e)}function ss(n,...e){return r_(n,...e)}function s_(n,e,t){const s={...vx(),[e]:t};return new Bc("auth","Firebase",s).create(e,{appName:n.name})}function Fi(n){return s_(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ix(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Cs(n,"argument-error"),s_(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function r_(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return _b.create(n,...e)}function be(n,e,...t){if(!n)throw r_(e,...t)}function Us(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ku(e),new Error(e)}function Zs(n,e){n||Us(e)}function Pp(){return typeof self<"u"&&self.location?.href||""}function Tx(){return Gv()==="http:"||Gv()==="https:"}function Gv(){return typeof self<"u"&&self.location?.protocol||null}function wx(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Tx()||YN()||"connection"in navigator)?navigator.onLine:!0}function bx(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class qc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Zs(t>e,"Short delay should be less than long delay!"),this.isMobile=e_()||rb()}get(){return wx()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function i_(n,e){Zs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class gb{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Us("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Us("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Us("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ax={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Sx=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Rx=new qc(3e4,6e4);function o_(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Da(n,e,t,s,r={}){return yb(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=ka({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return QN()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&rr(n.emulatorConfig.host)&&(u.credentials="include"),gb.fetch()(await vb(n,n.config.apiHost,t,a),u)})}async function yb(n,e,t){n._canInitEmulator=!1;const s={...Ax,...e};try{const r=new Px(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Su(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Su(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Su(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Su(n,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw s_(n,h,u);Cs(n,h)}}catch(r){if(r instanceof ir)throw r;Cs(n,"network-request-failed",{message:String(r)})}}async function Cx(n,e,t,s,r={}){const i=await Da(n,e,t,s,r);return"mfaPendingCredential"in i&&Cs(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function vb(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?i_(n.config,r):`${n.config.apiScheme}://${r}`;return Sx.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class Px{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(ss(this.auth,"network-request-failed")),Rx.get())})}}function Su(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=ss(n,e,s);return r.customData._tokenResponse=t,r}async function Nx(n,e){return Da(n,"POST","/v1/accounts:delete",e)}async function wh(n,e){return Da(n,"POST","/v1/accounts:lookup",e)}function Ul(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function kx(n,e=!1){const t=je(n),s=await t.getIdToken(e),r=a_(s);be(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:Ul($f(r.auth_time)),issuedAtTime:Ul($f(r.iat)),expirationTime:Ul($f(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function $f(n){return Number(n)*1e3}function a_(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Ku("JWT malformed, contained fewer than 3 sections"),null;try{const r=yh(t);return r?JSON.parse(r):(Ku("Failed to decode base64 JWT payload"),null)}catch(r){return Ku("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Kv(n){const e=a_(n);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function pc(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof ir&&xx(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function xx({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Dx{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Np{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ul(this.lastLoginAt),this.creationTime=Ul(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bh(n){const e=n.auth,t=await n.getIdToken(),s=await pc(n,wh(e,{idToken:t}));be(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?Eb(r.providerUserInfo):[],o=Ox(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!o?.length,u=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Np(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Vx(n){const e=je(n);await bh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ox(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function Eb(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Mx(n,e){const t=await yb(n,{},async()=>{const s=ka({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await vb(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&rr(n.emulatorConfig.host)&&(l.credentials="include"),gb.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Lx(n,e){return Da(n,"POST","/v2/accounts:revokeToken",o_(n,e))}class $o{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){be(e.length!==0,"internal-error");const t=Kv(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Mx(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new $o;return s&&(be(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(be(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $o,this.toJSON())}_performRefresh(){return Us("not implemented")}}function yr(n,e){be(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Jn{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new Dx(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Np(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await pc(this,this.stsTokenManager.getToken(this.auth,e));return be(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return kx(this,e)}reload(){return Vx(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Jn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await bh(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Bn(this.auth.app))return Promise.reject(Fi(this.auth));const e=await this.getIdToken();return await pc(this,Nx(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:d,emailVerified:f,isAnonymous:_,providerData:E,stsTokenManager:T}=t;be(d&&T,e,"internal-error");const C=$o.fromJSON(this.name,T);be(typeof d=="string",e,"internal-error"),yr(s,e.name),yr(r,e.name),be(typeof f=="boolean",e,"internal-error"),be(typeof _=="boolean",e,"internal-error"),yr(i,e.name),yr(o,e.name),yr(a,e.name),yr(l,e.name),yr(u,e.name),yr(h,e.name);const L=new Jn({uid:d,auth:e,email:r,emailVerified:f,displayName:s,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:C,createdAt:u,lastLoginAt:h});return E&&Array.isArray(E)&&(L.providerData=E.map(U=>({...U}))),l&&(L._redirectEventId=l),L}static async _fromIdTokenResponse(e,t,s=!1){const r=new $o;r.updateFromServerResponse(t);const i=new Jn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await bh(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];be(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?Eb(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!i?.length,a=new $o;a.updateFromIdToken(s);const l=new Jn({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Np(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,u),l}}const Wv=new Map;function Bs(n){Zs(n instanceof Function,"Expected a class definition");let e=Wv.get(n);return e?(Zs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Wv.set(n,e),e)}class Ib{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ib.type="NONE";const zv=Ib;function Wu(n,e,t){return`firebase:${n}:${e}:${t}`}class jo{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Wu(this.userKey,r.apiKey,i),this.fullPersistenceKey=Wu("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await wh(this.auth,{idToken:e}).catch(()=>{});return t?Jn._fromGetAccountInfoResponse(this.auth,t,e):null}return Jn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new jo(Bs(zv),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Bs(zv);const o=Wu(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let d;if(typeof h=="string"){const f=await wh(e,{idToken:h}).catch(()=>{});if(!f)break;d=await Jn._fromGetAccountInfoResponse(e,f,h)}else d=Jn._fromJSON(e,h);u!==i&&(a=d),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new jo(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new jo(i,e,s))}}function Hv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ab(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Tb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Rb(e))return"Blackberry";if(Cb(e))return"Webos";if(wb(e))return"Safari";if((e.includes("chrome/")||bb(e))&&!e.includes("edge/"))return"Chrome";if(Sb(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function Tb(n=Mt()){return/firefox\//i.test(n)}function wb(n=Mt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bb(n=Mt()){return/crios\//i.test(n)}function Ab(n=Mt()){return/iemobile/i.test(n)}function Sb(n=Mt()){return/android/i.test(n)}function Rb(n=Mt()){return/blackberry/i.test(n)}function Cb(n=Mt()){return/webos/i.test(n)}function l_(n=Mt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Fx(n=Mt()){return l_(n)&&!!window.navigator?.standalone}function Ux(){return JN()&&document.documentMode===10}function Pb(n=Mt()){return l_(n)||Sb(n)||Cb(n)||Rb(n)||/windows phone/i.test(n)||Ab(n)}function Nb(n,e=[]){let t;switch(n){case"Browser":t=Hv(Mt());break;case"Worker":t=`${Hv(Mt())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ao}/${s}`}class Bx{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function qx(n,e={}){return Da(n,"GET","/v2/passwordPolicy",o_(n,e))}const $x=6;class jx{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??$x,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Gx{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qv(this),this.idTokenSubscription=new Qv(this),this.beforeStateQueue=new Bx(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_b,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bs(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await jo.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await wh(this,{idToken:e}),s=await Jn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Bn(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bh(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=bx()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Bn(this.app))return Promise.reject(Fi(this));const t=e?je(e):null;return t&&be(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Bn(this.app)?Promise.reject(Fi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Bn(this.app)?Promise.reject(Fi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await qx(this),t=new jx(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Bc("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Lx(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Bs(e)||this._popupRedirectResolver;be(t,this,"argument-error"),this.redirectPersistenceManager=await jo.create(this,[Bs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Nb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(Bn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Ex(`Error while retrieving App Check token: ${e.error}`),e?.token}}function bd(n){return je(n)}class Qv{constructor(e){this.auth=e,this.observer=null,this.addObserver=ok(t=>this.observer=t)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let c_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Kx(n){c_=n}function Wx(n){return c_.loadJS(n)}function zx(){return c_.gapiScript}function Hx(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Qx(n,e){const t=xa(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(Kn(i,e??{}))return r;Cs(r,"already-initialized")}return t.initialize({options:e})}function Yx(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Bs);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Jx(n,e,t){const s=bd(n);be(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=kb(e),{host:o,port:a}=Xx(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){be(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),be(Kn(u,s.config.emulator)&&Kn(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,rr(o)?(Id(`${i}//${o}${l}`),Zm("Auth",!0)):Zx()}function kb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Xx(n){const e=kb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:Yv(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:Yv(o)}}}function Yv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Zx(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class xb{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Us("not implemented")}_getIdTokenResponse(e){return Us("not implemented")}_linkToIdToken(e,t){return Us("not implemented")}_getReauthenticationResolver(e){return Us("not implemented")}}async function Go(n,e){return Cx(n,"POST","/v1/accounts:signInWithIdp",o_(n,e))}const eD="http://localhost";class Ki extends xb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ki(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Cs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new Ki(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Go(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Go(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Go(e,t)}buildRequest(){const e={requestUri:eD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ka(t)}return e}}class u_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class $c extends u_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Nr extends $c{constructor(){super("facebook.com")}static credential(e){return Ki._fromParams({providerId:Nr.PROVIDER_ID,signInMethod:Nr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nr.credentialFromTaggedObject(e)}static credentialFromError(e){return Nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Nr.credential(e.oauthAccessToken)}catch{return null}}}Nr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Nr.PROVIDER_ID="facebook.com";class Fs extends $c{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ki._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Fs.credential(t,s)}catch{return null}}}Fs.GOOGLE_SIGN_IN_METHOD="google.com";Fs.PROVIDER_ID="google.com";class kr extends $c{constructor(){super("github.com")}static credential(e){return Ki._fromParams({providerId:kr.PROVIDER_ID,signInMethod:kr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return kr.credentialFromTaggedObject(e)}static credentialFromError(e){return kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return kr.credential(e.oauthAccessToken)}catch{return null}}}kr.GITHUB_SIGN_IN_METHOD="github.com";kr.PROVIDER_ID="github.com";class xr extends $c{constructor(){super("twitter.com")}static credential(e,t){return Ki._fromParams({providerId:xr.PROVIDER_ID,signInMethod:xr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xr.credentialFromTaggedObject(e)}static credentialFromError(e){return xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return xr.credential(t,s)}catch{return null}}}xr.TWITTER_SIGN_IN_METHOD="twitter.com";xr.PROVIDER_ID="twitter.com";class sa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Jn._fromIdTokenResponse(e,s,r),o=Jv(s);return new sa({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=Jv(s);return new sa({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function Jv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Ah extends ir{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Ah.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new Ah(e,t,s,r)}}function Db(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ah._fromErrorAndOperation(n,i,e,s):i})}async function tD(n,e,t=!1){const s=await pc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return sa._forOperation(n,"link",s)}async function nD(n,e,t=!1){const{auth:s}=n;if(Bn(s.app))return Promise.reject(Fi(s));const r="reauthenticate";try{const i=await pc(n,Db(s,r,e,n),t);be(i.idToken,s,"internal-error");const o=a_(i.idToken);be(o,s,"internal-error");const{sub:a}=o;return be(n.uid===a,s,"user-mismatch"),sa._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&Cs(s,"user-mismatch"),i}}async function sD(n,e,t=!1){if(Bn(n.app))return Promise.reject(Fi(n));const s="signIn",r=await Db(n,s,e),i=await sa._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}function rD(n,e,t,s){return je(n).onIdTokenChanged(e,t,s)}function iD(n,e,t){return je(n).beforeAuthStateChanged(e,t)}function oD(n,e,t,s){return je(n).onAuthStateChanged(e,t,s)}function aD(n){return je(n).signOut()}const Sh="__sak";class Vb{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Sh,"1"),this.storage.removeItem(Sh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const lD=1e3,cD=10;class Ob extends Vb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Pb(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Ux()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,cD):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},lD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ob.type="LOCAL";const uD=Ob;class Mb extends Vb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Mb.type="SESSION";const Lb=Mb;function hD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ad{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Ad(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await hD(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ad.receivers=[];function h_(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class dD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=h_("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const f=d;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function bs(){return window}function fD(n){bs().location.href=n}function Fb(){return typeof bs().WorkerGlobalScope<"u"&&typeof bs().importScripts=="function"}async function pD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mD(){return navigator?.serviceWorker?.controller||null}function _D(){return Fb()?self:null}const Ub="firebaseLocalStorageDb",gD=1,Rh="firebaseLocalStorage",Bb="fbase_key";class jc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Sd(n,e){return n.transaction([Rh],e?"readwrite":"readonly").objectStore(Rh)}function yD(){const n=indexedDB.deleteDatabase(Ub);return new jc(n).toPromise()}function kp(){const n=indexedDB.open(Ub,gD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Rh,{keyPath:Bb})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Rh)?e(s):(s.close(),await yD(),e(await kp()))})})}async function Xv(n,e,t){const s=Sd(n,!0).put({[Bb]:e,value:t});return new jc(s).toPromise()}async function vD(n,e){const t=Sd(n,!1).get(e),s=await new jc(t).toPromise();return s===void 0?null:s.value}function Zv(n,e){const t=Sd(n,!0).delete(e);return new jc(t).toPromise()}const ED=800,ID=3;class qb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await kp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>ID)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ad._getInstance(_D()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await pD(),!this.activeServiceWorker)return;this.sender=new dD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kp();return await Xv(e,Sh,"1"),await Zv(e,Sh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>Xv(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>vD(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Zv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Sd(r,!1).getAll();return new jc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ED)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}qb.type="LOCAL";const TD=qb;new qc(3e4,6e4);function $b(n,e){return e?Bs(e):(be(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class d_ extends xb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Go(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Go(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Go(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function wD(n){return sD(n.auth,new d_(n),n.bypassAuthState)}function bD(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),nD(t,new d_(n),n.bypassAuthState)}async function AD(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),tD(t,new d_(n),n.bypassAuthState)}class jb{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return wD;case"linkViaPopup":case"linkViaRedirect":return AD;case"reauthViaPopup":case"reauthViaRedirect":return bD;default:Cs(this.auth,"internal-error")}}resolve(e){Zs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const SD=new qc(2e3,1e4);async function RD(n,e,t){if(Bn(n.app))return Promise.reject(ss(n,"operation-not-supported-in-this-environment"));const s=bd(n);Ix(n,e,u_);const r=$b(s,t);return new ki(s,"signInViaPopup",e,r).executeNotNull()}class ki extends jb{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,ki.currentPopupAction&&ki.currentPopupAction.cancel(),ki.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){Zs(this.filter.length===1,"Popup operations only handle one event");const e=h_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ss(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ss(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ki.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ss(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,SD.get())};e()}}ki.currentPopupAction=null;const CD="pendingRedirect",zu=new Map;class PD extends jb{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=zu.get(this.auth._key());if(!e){try{const s=await ND(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}zu.set(this.auth._key(),e)}return this.bypassAuthState||zu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ND(n,e){const t=DD(e),s=xD(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function kD(n,e){zu.set(n._key(),e)}function xD(n){return Bs(n._redirectPersistence)}function DD(n){return Wu(CD,n.config.apiKey,n.name)}async function VD(n,e,t=!1){if(Bn(n.app))return Promise.reject(Fi(n));const s=bd(n),r=$b(s,e),o=await new PD(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const OD=600*1e3;class MD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!LD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Gb(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ss(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=OD&&this.cachedEventUids.clear(),this.cachedEventUids.has(eE(e))}saveEventToCache(e){this.cachedEventUids.add(eE(e)),this.lastProcessedEventTime=Date.now()}}function eE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Gb({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function LD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Gb(n);default:return!1}}async function FD(n,e={}){return Da(n,"GET","/v1/projects",e)}const UD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,BD=/^https?/;async function qD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await FD(n);for(const t of e)try{if($D(t))return}catch{}Cs(n,"unauthorized-domain")}function $D(n){const e=Pp(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!BD.test(t))return!1;if(UD.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const jD=new qc(3e4,6e4);function tE(){const n=bs().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function GD(n){return new Promise((e,t)=>{function s(){tE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{tE(),t(ss(n,"network-request-failed"))},timeout:jD.get()})}if(bs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(bs().gapi?.load)s();else{const r=Hx("iframefcb");return bs()[r]=()=>{gapi.load?s():t(ss(n,"network-request-failed"))},Wx(`${zx()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw Hu=null,e})}let Hu=null;function KD(n){return Hu=Hu||GD(n),Hu}const WD=new qc(5e3,15e3),zD="__/auth/iframe",HD="emulator/auth/iframe",QD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},YD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JD(n){const e=n.config;be(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?i_(e,HD):`https://${n.config.authDomain}/${zD}`,s={apiKey:e.apiKey,appName:n.name,v:ao},r=YD.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${ka(s).slice(1)}`}async function XD(n){const e=await KD(n),t=bs().gapi;return be(t,n,"internal-error"),e.open({where:document.body,url:JD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:QD,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=ss(n,"network-request-failed"),a=bs().setTimeout(()=>{i(o)},WD.get());function l(){bs().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}const ZD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},eV=500,tV=600,nV="_blank",sV="http://localhost";class nE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rV(n,e,t,s=eV,r=tV){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...ZD,width:s.toString(),height:r.toString(),top:i,left:o},u=Mt().toLowerCase();t&&(a=bb(u)?nV:t),Tb(u)&&(e=e||sV,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[_,E])=>`${f}${_}=${E},`,"");if(Fx(u)&&a!=="_self")return iV(e||"",a),new nE(null);const d=window.open(e||"",a,h);be(d,n,"popup-blocked");try{d.focus()}catch{}return new nE(d)}function iV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const oV="__/auth/handler",aV="emulator/auth/handler",lV=encodeURIComponent("fac");async function sE(n,e,t,s,r,i){be(n.config.authDomain,n,"auth-domain-config-required"),be(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:ao,eventId:r};if(e instanceof u_){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",bp(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof $c){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${lV}=${encodeURIComponent(l)}`:"";return`${cV(n)}?${ka(a).slice(1)}${u}`}function cV({config:n}){return n.emulator?i_(n,aV):`https://${n.authDomain}/${oV}`}const jf="webStorageSupport";class uV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Lb,this._completeRedirectFn=VD,this._overrideRedirectResult=kD}async _openPopup(e,t,s,r){Zs(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await sE(e,t,s,Pp(),r);return rV(e,i,h_())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await sE(e,t,s,Pp(),r);return fD(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Zs(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await XD(e),s=new MD(e);return t.register("authEvent",r=>(be(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jf,{type:jf},r=>{const i=r?.[0]?.[jf];i!==void 0&&t(!!i),Cs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=qD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Pb()||wb()||l_()}}const hV=uV;var rE="@firebase/auth",iE="1.12.0";class dV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function fV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pV(n){Gi(new Kr("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;be(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nb(n)},u=new Gx(s,r,i,l);return Yx(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Gi(new Kr("auth-internal",e=>{const t=bd(e.getProvider("auth").getImmediate());return(s=>new dV(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ws(rE,iE,fV(n)),ws(rE,iE,"esm2020")}const mV=300,_V=tb("authIdTokenMaxAge")||mV;let oE=null;const gV=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>_V)return;const r=t?.token;oE!==r&&(oE=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function yV(n=n_()){const e=xa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Qx(n,{popupRedirectResolver:hV,persistence:[TD,uD,Lb]}),s=tb("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=gV(i.toString());iD(t,o,()=>o(t.currentUser)),rD(t,a=>o(a))}}const r=Xw("auth");return r&&Jx(t,`http://${r}`),t}function vV(){return document.getElementsByTagName("head")?.[0]??document}Kx({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=ss("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",vV().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pV("Browser");var EV="firebase",IV="12.7.0";ws(EV,IV,"app");var aE={};const lE="@firebase/database",cE="1.1.0";let Kb="";function TV(n){Kb=n}class wV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Kt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:dc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class bV{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return or(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Wb=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new wV(e)}}catch{}return new bV},xi=Wb("localStorage"),AV=Wb("sessionStorage");const Ko=new wd("@firebase/database"),SV=(function(){let n=1;return function(){return n++}})(),zb=function(n){const e=ck(n),t=new ik;t.update(e);const s=t.digest();return Jm.encodeByteArray(s)},Gc=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Gc.apply(null,s):typeof s=="object"?e+=Kt(s):e+=s,e+=" "}return e};let Bl=null,uE=!0;const RV=function(n,e){Z(!0,"Can't turn on custom loggers persistently."),Ko.logLevel=De.VERBOSE,Bl=Ko.log.bind(Ko)},on=function(...n){if(uE===!0&&(uE=!1,Bl===null&&AV.get("logging_enabled")===!0&&RV()),Bl){const e=Gc.apply(null,n);Bl(e)}},Kc=function(n){return function(...e){on(n,...e)}},xp=function(...n){const e="FIREBASE INTERNAL ERROR: "+Gc(...n);Ko.error(e)},er=function(...n){const e=`FIREBASE FATAL ERROR: ${Gc(...n)}`;throw Ko.error(e),new Error(e)},Ln=function(...n){const e="FIREBASE WARNING: "+Gc(...n);Ko.warn(e)},CV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ln("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Hb=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},PV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ra="[MIN_NAME]",Wi="[MAX_NAME]",Va=function(n,e){if(n===e)return 0;if(n===ra||e===Wi)return-1;if(e===ra||n===Wi)return 1;{const t=hE(n),s=hE(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},NV=function(n,e){return n===e?0:n<e?-1:1},fl=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Kt(e))},f_=function(n){if(typeof n!="object"||n===null)return Kt(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Kt(e[s]),t+=":",t+=f_(n[e[s]]);return t+="}",t},Qb=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function Cn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Yb=function(n){Z(!Hb(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,a,l;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const h=u.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},kV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},xV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function DV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const VV=new RegExp("^-?(0*)\\d{1,10}$"),OV=-2147483648,MV=2147483647,hE=function(n){if(VV.test(n)){const e=Number(n);if(e>=OV&&e<=MV)return e}return null},Wc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Ln("Exception was thrown by user callback.",t),e},Math.floor(0))}},LV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ql=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class FV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Bn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Ln(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class UV{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(on("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ln(e)}}class Qu{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Qu.OWNER="owner";const p_="5",Jb="v",Xb="s",Zb="r",eA="f",tA=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nA="ls",sA="p",Dp="ac",rA="websocket",iA="long_polling";class oA{constructor(e,t,s,r,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function BV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function aA(n,e,t){Z(typeof e=="string","typeof type must == string"),Z(typeof t=="object","typeof params must == object");let s;if(e===rA)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===iA)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);BV(n)&&(t.ns=n.namespace);const r=[];return Cn(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}class qV{constructor(){this.counters_={}}incrementCounter(e,t=1){or(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return $N(this.counters_)}}const Gf={},Kf={};function m_(n){const e=n.toString();return Gf[e]||(Gf[e]=new qV),Gf[e]}function $V(n,e){const t=n.toString();return Kf[t]||(Kf[t]=e()),Kf[t]}class jV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Wc(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const dE="start",GV="close",KV="pLPCommand",WV="pRTLPCB",lA="id",cA="pw",uA="ser",zV="cb",HV="seg",QV="ts",YV="d",JV="dframe",hA=1870,dA=30,XV=hA-dA,ZV=25e3,eO=3e4;class Oo{constructor(e,t,s,r,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kc(e),this.stats_=m_(t),this.urlFn=l=>(this.appCheckToken&&(l[Dp]=this.appCheckToken),aA(t,iA,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new jV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(eO)),PV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new __((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===dE)this.id=a,this.password=l;else if(o===GV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[dE]="t",s[uA]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[zV]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Jb]=p_,this.transportSessionId&&(s[Xb]=this.transportSessionId),this.lastSessionId&&(s[nA]=this.lastSessionId),this.applicationId&&(s[sA]=this.applicationId),this.appCheckToken&&(s[Dp]=this.appCheckToken),typeof location<"u"&&location.hostname&&tA.test(location.hostname)&&(s[Zb]=eA);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oo.forceAllow_=!0}static forceDisallow(){Oo.forceDisallow_=!0}static isAvailable(){return Oo.forceAllow_?!0:!Oo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!kV()&&!xV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Qw(t),r=Qb(s,XV);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[JV]="t",s[lA]=e,s[cA]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Kt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class __{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=SV(),window[KV+this.uniqueCallbackIdentifier]=e,window[WV+this.uniqueCallbackIdentifier]=t,this.myIFrame=__.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){on("frame writing exception"),a.stack&&on(a.stack),on(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||on("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[lA]=this.myID,e[cA]=this.myPW,e[uA]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+dA+s.length<=hA;){const o=this.pendingSegs.shift();s=s+"&"+HV+r+"="+o.seg+"&"+QV+r+"="+o.ts+"&"+YV+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(ZV)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{on("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const tO=16384,nO=45e3;let Ch=null;typeof MozWebSocket<"u"?Ch=MozWebSocket:typeof WebSocket<"u"&&(Ch=WebSocket);class Qn{constructor(e,t,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kc(this.connId),this.stats_=m_(t),this.connURL=Qn.connectionURL_(t,o,a,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[Jb]=p_,typeof location<"u"&&location.hostname&&tA.test(location.hostname)&&(o[Zb]=eA),t&&(o[Xb]=t),s&&(o[nA]=s),r&&(o[Dp]=r),i&&(o[sA]=i),aA(e,rA,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xi.set("previous_websocket_failure",!0);try{let s;XN(),this.mySock=new Ch(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Qn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Ch!==null&&!Qn.forceDisallow_}static previouslyFailed(){return xi.isInMemoryStorage||xi.get("previous_websocket_failure")===!0}markConnectionHealthy(){xi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=dc(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Z(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Qb(t,tO);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(nO))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Qn.responsesRequiredToBeHealthy=2;Qn.healthyTimeout=3e4;class mc{static get ALL_TRANSPORTS(){return[Oo,Qn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Qn&&Qn.isAvailable();let s=t&&!Qn.previouslyFailed();if(e.webSocketOnly&&(t||Ln("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Qn];else{const r=this.transports_=[];for(const i of mc.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);mc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}mc.globalTransportInitialized_=!1;const sO=6e4,rO=5e3,iO=10*1024,oO=100*1024,Wf="t",fE="d",aO="s",pE="r",lO="e",mE="o",_E="a",gE="n",yE="p",cO="h";class uO{constructor(e,t,s,r,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kc("c:"+this.id+":"),this.transportManager_=new mc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ql(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>oO?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>iO?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Wf in e){const t=e[Wf];t===_E?this.upgradeIfSecondaryHealthy_():t===pE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===mE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=fl("t",e),s=fl("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_E,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:gE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=fl("t",e),s=fl("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=fl(Wf,e);if(fE in e){const s=e[fE];if(t===cO){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===gE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===aO?this.onConnectionShutdown_(s):t===pE?this.onReset_(s):t===lO?xp("Server Error: "+s):t===mE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):xp("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),p_!==s&&Ln("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),ql(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(sO))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ql(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(rO))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class fA{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class pA{constructor(e){this.allowedEvents_=e,this.listeners_={},Z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){Z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Ph extends pA{static getInstance(){return new Ph}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!e_()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const vE=32,EE=768;class at{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function $e(){return new at("")}function Ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Wr(n){return n.pieces_.length-n.pieceNum_}function ut(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new at(n.pieces_,e)}function mA(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function hO(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function _A(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function gA(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new at(e,0)}function Ot(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof at)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new at(t,0)}function Oe(n){return n.pieceNum_>=n.pieces_.length}function Tn(n,e){const t=Ve(n),s=Ve(e);if(t===null)return e;if(t===s)return Tn(ut(n),ut(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function g_(n,e){if(Wr(n)!==Wr(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Xn(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Wr(n)>Wr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class dO{constructor(e,t){this.errorPrefix_=t,this.parts_=_A(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Td(this.parts_[s]);yA(this)}}function fO(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Td(e),yA(n)}function pO(n){const e=n.parts_.pop();n.byteLength_-=Td(e),n.parts_.length>0&&(n.byteLength_-=1)}function yA(n){if(n.byteLength_>EE)throw new Error(n.errorPrefix_+"has a key path longer than "+EE+" bytes ("+n.byteLength_+").");if(n.parts_.length>vE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+vE+") or object contains a cycle "+wi(n))}function wi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class y_ extends pA{static getInstance(){return new y_}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return Z(e==="visible","Unknown event type: "+e),[this.visible_]}}const pl=1e3,mO=300*1e3,IE=30*1e3,_O=1.3,gO=3e4,yO="server_kill",TE=3;class zs extends fA{constructor(e,t,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=zs.nextPersistentConnectionId_++,this.log_=Kc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=pl,this.maxReconnectDelay_=mO,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");y_.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Ph.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Kt(i)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new Xm,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;zs.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&or(e,"w")){const s=na(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Ln(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||rk(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=IE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=sk(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Kt(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):xp("Unrecognized action received from server: "+Kt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>gO&&(this.reconnectDelay_=pl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*_O)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+zs.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(d){Z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?on("getToken() completed but was canceled"):(on("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new uO(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,_=>{Ln(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(yO)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&Ln(d),l())}}}interrupt(e){on("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){on("Resuming connection for reason: "+e),delete this.interruptReasons_[e],bp(this.interruptReasons_)&&(this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>f_(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new at(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){on("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=TE&&(this.reconnectDelay_=IE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){on("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=TE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Kb.replace(/\./g,"-")]=1,e_()?e["framework.cordova"]=1:rb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Ph.getInstance().currentlyOnline();return bp(this.interruptReasons_)&&e}}zs.nextPersistentConnectionId_=0;zs.nextConnectionId_=0;class Pe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Pe(e,t)}}class Rd{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Pe(ra,e),r=new Pe(ra,t);return this.compare(s,r)!==0}minPost(){return Pe.MIN}}let Ru;class vA extends Rd{static get __EMPTY_NODE(){return Ru}static set __EMPTY_NODE(e){Ru=e}compare(e,t){return Va(e.name,t.name)}isDefinedOn(e){throw Na("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Pe.MIN}maxPost(){return new Pe(Wi,Ru)}makePost(e,t){return Z(typeof e=="string","KeyIndex indexValue must always be a string."),new Pe(e,Ru)}toString(){return".key"}}const Wo=new vA;let Cu=class{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Vn=class Sl{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Sl.RED,this.left=r??ys.EMPTY_NODE,this.right=i??ys.EMPTY_NODE}copy(e,t,s,r,i){return new Sl(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ys.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return ys.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Vn.RED=!0;Vn.BLACK=!1;class vO{copy(e,t,s,r,i){return this}insert(e,t,s){return new Vn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let ys=class Yu{constructor(e,t=Yu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Yu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Vn.BLACK,null,null))}remove(e){return new Yu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Vn.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Cu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Cu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Cu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Cu(this.root_,null,this.comparator_,!0,e)}};ys.EMPTY_NODE=new vO;function EO(n,e){return Va(n.name,e.name)}function v_(n,e){return Va(n,e)}let Vp;function IO(n){Vp=n}const EA=function(n){return typeof n=="number"?"number:"+Yb(n):"string:"+n},IA=function(n){if(n.isLeafNode()){const e=n.val();Z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&or(e,".sv"),"Priority must be a string or number.")}else Z(n===Vp||n.isEmpty(),"priority of unexpected type.");Z(n===Vp||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let wE;class $t{static set __childrenNodeConstructor(e){wE=e}static get __childrenNodeConstructor(){return wE}constructor(e,t=$t.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),IA(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new $t(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:$t.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Oe(e)?this:Ve(e)===".priority"?this.priorityNode_:$t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:$t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Ve(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(Z(s!==".priority"||Wr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,$t.__childrenNodeConstructor.EMPTY_NODE.updateChild(ut(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+EA(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Yb(this.value_):e+=this.value_,this.lazyHash_=zb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===$t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof $t.__childrenNodeConstructor?-1:(Z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=$t.VALUE_TYPE_ORDER.indexOf(t),i=$t.VALUE_TYPE_ORDER.indexOf(s);return Z(r>=0,"Unknown leaf type: "+t),Z(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}$t.VALUE_TYPE_ORDER=["object","boolean","number","string"];let TA,wA;function TO(n){TA=n}function wO(n){wA=n}class bO extends Rd{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?Va(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Pe.MIN}maxPost(){return new Pe(Wi,new $t("[PRIORITY-POST]",wA))}makePost(e,t){const s=TA(e);return new Pe(t,new $t("[PRIORITY-POST]",s))}toString(){return".priority"}}const bt=new bO;const AO=Math.log(2);class SO{constructor(e){const t=i=>parseInt(Math.log(i)/AO,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Nh=function(n,e,t,s){n.sort(e);const r=function(l,u){const h=u-l;let d,f;if(h===0)return null;if(h===1)return d=n[l],f=t?t(d):d,new Vn(f,d.node,Vn.BLACK,null,null);{const _=parseInt(h/2,10)+l,E=r(l,_),T=r(_+1,u);return d=n[_],f=t?t(d):d,new Vn(f,d.node,Vn.BLACK,E,T)}},i=function(l){let u=null,h=null,d=n.length;const f=function(E,T){const C=d-E,L=d;d-=E;const U=r(C+1,L),N=n[C],k=t?t(N):N;_(new Vn(k,N.node,T,null,U))},_=function(E){u?(u.left=E,u=E):(h=E,u=E)};for(let E=0;E<l.count;++E){const T=l.nextBitIsOne(),C=Math.pow(2,l.count-(E+1));T?f(C,Vn.BLACK):(f(C,Vn.BLACK),f(C,Vn.RED))}return h},o=new SO(n.length),a=i(o);return new ys(s||e,a)};let zf;const To={};class qs{static get Default(){return Z(To&&bt,"ChildrenNode.ts has not been loaded"),zf=zf||new qs({".priority":To},{".priority":bt}),zf}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=na(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ys?t:null}hasIndex(e){return or(this.indexSet_,e.toString())}addIndex(e,t){Z(e!==Wo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(Pe.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=Nh(s,e.getCompare()):a=To;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new qs(h,u)}addToIndexes(e,t){const s=vh(this.indexes_,(r,i)=>{const o=na(this.indexSet_,i);if(Z(o,"Missing index implementation for "+i),r===To)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Pe.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Nh(a,o.getCompare())}else return To;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new Pe(e.name,a))),l.insert(e,e.node)}});return new qs(s,this.indexSet_)}removeFromIndexes(e,t){const s=vh(this.indexes_,r=>{if(r===To)return r;{const i=t.get(e.name);return i?r.remove(new Pe(e.name,i)):r}});return new qs(s,this.indexSet_)}}let ml;class Te{static get EMPTY_NODE(){return ml||(ml=new Te(new ys(v_),null,qs.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&IA(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ml}updatePriority(e){return this.children_.isEmpty()?this:new Te(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ml:t}}getChild(e){const t=Ve(e);return t===null?this:this.getImmediateChild(t).getChild(ut(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Z(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Pe(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?ml:this.priorityNode_;return new Te(r,o,i)}}updateChild(e,t){const s=Ve(e);if(s===null)return t;{Z(Ve(e)!==".priority"||Wr(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(ut(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(bt,(o,a)=>{t[o]=a.val(e),s++,i&&Te.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+EA(this.getPriority().val())+":"),this.forEachChild(bt,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":zb(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new Pe(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Pe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Pe(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===zc?-1:0}withIndex(e){if(e===Wo||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Te(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Wo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(bt),r=t.getIterator(bt);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Wo?null:this.indexMap_.get(e.toString())}}Te.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class RO extends Te{constructor(){super(new ys(v_),Te.EMPTY_NODE,qs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Te.EMPTY_NODE}isEmpty(){return!1}}const zc=new RO;Object.defineProperties(Pe,{MIN:{value:new Pe(ra,Te.EMPTY_NODE)},MAX:{value:new Pe(Wi,zc)}});vA.__EMPTY_NODE=Te.EMPTY_NODE;$t.__childrenNodeConstructor=Te;IO(zc);wO(zc);const CO=!0;function an(n,e=null){if(n===null)return Te.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new $t(t,an(e))}if(!(n instanceof Array)&&CO){const t=[];let s=!1;if(Cn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=an(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new Pe(o,l)))}}),t.length===0)return Te.EMPTY_NODE;const i=Nh(t,EO,o=>o.name,v_);if(s){const o=Nh(t,bt.getCompare());return new Te(i,an(e),new qs({".priority":o},{".priority":bt}))}else return new Te(i,an(e),qs.Default)}else{let t=Te.EMPTY_NODE;return Cn(n,(s,r)=>{if(or(n,s)&&s.substring(0,1)!=="."){const i=an(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(an(e))}}TO(an);class PO extends Rd{constructor(e){super(),this.indexPath_=e,Z(!Oe(e)&&Ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?Va(e.name,t.name):i}makePost(e,t){const s=an(e),r=Te.EMPTY_NODE.updateChild(this.indexPath_,s);return new Pe(t,r)}maxPost(){const e=Te.EMPTY_NODE.updateChild(this.indexPath_,zc);return new Pe(Wi,e)}toString(){return _A(this.indexPath_,0).join("/")}}class NO extends Rd{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Va(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Pe.MIN}maxPost(){return Pe.MAX}makePost(e,t){const s=an(e);return new Pe(t,s)}toString(){return".value"}}const kO=new NO;function bA(n){return{type:"value",snapshotNode:n}}function ia(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function _c(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function gc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function xO(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class E_{constructor(e){this.index_=e}updateChild(e,t,s,r,i,o){Z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(_c(t,a)):Z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ia(t,s)):o.trackChildChange(gc(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(bt,(r,i)=>{t.hasChild(r)||s.trackChildChange(_c(r,i))}),t.isLeafNode()||t.forEachChild(bt,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(gc(r,i,o))}else s.trackChildChange(ia(r,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Te.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class yc{constructor(e){this.indexedFilter_=new E_(e.getIndex()),this.index_=e.getIndex(),this.startPost_=yc.getStartPost_(e),this.endPost_=yc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,r,i,o){return this.matches(new Pe(t,s))||(s=Te.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,r,i,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=Te.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Te.EMPTY_NODE);const i=this;return t.forEachChild(bt,(o,a)=>{i.matches(new Pe(o,a))||(r=r.updateImmediateChild(o,Te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class DO{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new yc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,r,i,o){return this.rangedFilter_.matches(new Pe(t,s))||(s=Te.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,r,i,o):this.fullLimitUpdateChild_(e,t,s,i,o)}updateFullNode(e,t,s){let r;if(t.isLeafNode()||t.isEmpty())r=Te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=Te.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(Te.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,r,i){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,_)=>d(_,f)}else o=this.index_.getCompare();const a=e;Z(a.numChildren()===this.limit_,"");const l=new Pe(t,s),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const d=a.getImmediateChild(t);let f=r.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===t||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);const _=f==null?1:o(f,l);if(h&&!s.isEmpty()&&_>=0)return i?.trackChildChange(gc(t,s,d)),a.updateImmediateChild(t,s);{i?.trackChildChange(_c(t,d));const T=a.updateImmediateChild(t,Te.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i?.trackChildChange(ia(f.name,f.node)),T.updateImmediateChild(f.name,f.node)):T}}else return s.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(_c(u.name,u.node)),i.trackChildChange(ia(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(u.name,Te.EMPTY_NODE)):e}}class I_{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=bt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ra}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===bt}copy(){const e=new I_;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function VO(n){return n.loadsAllData()?new E_(n.getIndex()):n.hasLimit()?new DO(n):new yc(n)}function bE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===bt?t="$priority":n.index_===kO?t="$value":n.index_===Wo?t="$key":(Z(n.index_ instanceof PO,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Kt(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Kt(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Kt(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Kt(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Kt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function AE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==bt&&(e.i=n.index_.toString()),e}class kh extends fA{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=Kc("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=kh.getListenId_(e,s),a={};this.listens_[o]=a;const l=bE(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let d=h;if(u===404&&(d=null,u=null),u===null&&this.onDataUpdate_(i,d,!1,s),na(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",r(f,null)}})}unlisten(e,t){const s=kh.getListenId_(e,t);delete this.listens_[s]}get(e){const t=bE(e._queryParams),s=e._path.toString(),r=new Xm;return this.restRequest_(s+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ka(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=dc(a.responseText)}catch{Ln("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&Ln("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class OO{constructor(){this.rootNode_=Te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function xh(){return{value:null,children:new Map}}function AA(n,e,t){if(Oe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Ve(e);n.children.has(s)||n.children.set(s,xh());const r=n.children.get(s);e=ut(e),AA(r,e,t)}}function Op(n,e,t){n.value!==null?t(e,n.value):MO(n,(s,r)=>{const i=new at(e.toString()+"/"+s);Op(r,i,t)})}function MO(n,e){n.children.forEach((t,s)=>{e(s,t)})}class LO{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Cn(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}const SE=10*1e3,FO=30*1e3,UO=300*1e3;class BO{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new LO(e);const s=SE+(FO-SE)*Math.random();ql(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;Cn(e,(r,i)=>{i>0&&or(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),ql(this.reportStats_.bind(this),Math.floor(Math.random()*2*UO))}}var Zn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Zn||(Zn={}));function SA(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function T_(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function w_(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Dh{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Zn.ACK_USER_WRITE,this.source=SA()}operationForChild(e){if(Oe(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new at(e));return new Dh($e(),t,this.revert)}}else return Z(Ve(this.path)===e,"operationForChild called for unrelated child."),new Dh(ut(this.path),this.affectedTree,this.revert)}}class vc{constructor(e,t){this.source=e,this.path=t,this.type=Zn.LISTEN_COMPLETE}operationForChild(e){return Oe(this.path)?new vc(this.source,$e()):new vc(this.source,ut(this.path))}}class zi{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Zn.OVERWRITE}operationForChild(e){return Oe(this.path)?new zi(this.source,$e(),this.snap.getImmediateChild(e)):new zi(this.source,ut(this.path),this.snap)}}class Ec{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Zn.MERGE}operationForChild(e){if(Oe(this.path)){const t=this.children.subtree(new at(e));return t.isEmpty()?null:t.value?new zi(this.source,$e(),t.value):new Ec(this.source,$e(),t)}else return Z(Ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ec(this.source,ut(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Hi{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Oe(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class qO{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function $O(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(xO(o.childName,o.snapshotNode))}),_l(n,r,"child_removed",e,s,t),_l(n,r,"child_added",e,s,t),_l(n,r,"child_moved",i,s,t),_l(n,r,"child_changed",e,s,t),_l(n,r,"value",e,s,t),r}function _l(n,e,t,s,r,i){const o=s.filter(a=>a.type===t);o.sort((a,l)=>GO(n,a,l)),o.forEach(a=>{const l=jO(n,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function jO(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function GO(n,e,t){if(e.childName==null||t.childName==null)throw Na("Should only compare child_ events.");const s=new Pe(e.childName,e.snapshotNode),r=new Pe(t.childName,t.snapshotNode);return n.index_.compare(s,r)}function Cd(n,e){return{eventCache:n,serverCache:e}}function $l(n,e,t,s){return Cd(new Hi(e,t,s),n.serverCache)}function RA(n,e,t,s){return Cd(n.eventCache,new Hi(e,t,s))}function Mp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Qi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Hf;const KO=()=>(Hf||(Hf=new ys(NV)),Hf);class mt{static fromObject(e){let t=new mt(null);return Cn(e,(s,r)=>{t=t.set(new at(s),r)}),t}constructor(e,t=KO()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:$e(),value:this.value};if(Oe(e))return null;{const s=Ve(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(ut(e),t);return i!=null?{path:Ot(new at(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Oe(e))return this;{const t=Ve(e),s=this.children.get(t);return s!==null?s.subtree(ut(e)):new mt(null)}}set(e,t){if(Oe(e))return new mt(t,this.children);{const s=Ve(e),i=(this.children.get(s)||new mt(null)).set(ut(e),t),o=this.children.insert(s,i);return new mt(this.value,o)}}remove(e){if(Oe(e))return this.children.isEmpty()?new mt(null):new mt(null,this.children);{const t=Ve(e),s=this.children.get(t);if(s){const r=s.remove(ut(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new mt(null):new mt(this.value,i)}else return this}}get(e){if(Oe(e))return this.value;{const t=Ve(e),s=this.children.get(t);return s?s.get(ut(e)):null}}setTree(e,t){if(Oe(e))return t;{const s=Ve(e),i=(this.children.get(s)||new mt(null)).setTree(ut(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new mt(this.value,o)}}fold(e){return this.fold_($e(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(Ot(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,$e(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(Oe(e))return null;{const i=Ve(e),o=this.children.get(i);return o?o.findOnPath_(ut(e),Ot(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,$e(),t)}foreachOnPath_(e,t,s){if(Oe(e))return this;{this.value&&s(t,this.value);const r=Ve(e),i=this.children.get(r);return i?i.foreachOnPath_(ut(e),Ot(t,r),s):new mt(null)}}foreach(e){this.foreach_($e(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(Ot(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class rs{constructor(e){this.writeTree_=e}static empty(){return new rs(new mt(null))}}function jl(n,e,t){if(Oe(e))return new rs(new mt(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=Tn(r,e);return i=i.updateChild(o,t),new rs(n.writeTree_.set(r,i))}else{const r=new mt(t),i=n.writeTree_.setTree(e,r);return new rs(i)}}}function RE(n,e,t){let s=n;return Cn(t,(r,i)=>{s=jl(s,Ot(e,r),i)}),s}function CE(n,e){if(Oe(e))return rs.empty();{const t=n.writeTree_.setTree(e,new mt(null));return new rs(t)}}function Lp(n,e){return lo(n,e)!=null}function lo(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Tn(t.path,e)):null}function PE(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(bt,(s,r)=>{e.push(new Pe(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new Pe(s,r.value))}),e}function qr(n,e){if(Oe(e))return n;{const t=lo(n,e);return t!=null?new rs(new mt(t)):new rs(n.writeTree_.subtree(e))}}function Fp(n){return n.writeTree_.isEmpty()}function oa(n,e){return CA($e(),n.writeTree_,e)}function CA(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(Z(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=CA(Ot(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(Ot(n,".priority"),s)),t}}function b_(n,e){return xA(e,n)}function WO(n,e,t,s,r){Z(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=jl(n.visibleWrites,e,t)),n.lastWriteId=s}function zO(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function HO(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Z(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&QO(a,s.path)?r=!1:Xn(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return YO(n),!0;if(s.snap)n.visibleWrites=CE(n.visibleWrites,s.path);else{const a=s.children;Cn(a,l=>{n.visibleWrites=CE(n.visibleWrites,Ot(s.path,l))})}return!0}else return!1}function QO(n,e){if(n.snap)return Xn(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Xn(Ot(n.path,t),e))return!0;return!1}function YO(n){n.visibleWrites=PA(n.allWrites,JO,$e()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function JO(n){return n.visible}function PA(n,e,t){let s=rs.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let a;if(i.snap)Xn(t,o)?(a=Tn(t,o),s=jl(s,a,i.snap)):Xn(o,t)&&(a=Tn(o,t),s=jl(s,$e(),i.snap.getChild(a)));else if(i.children){if(Xn(t,o))a=Tn(t,o),s=RE(s,a,i.children);else if(Xn(o,t))if(a=Tn(o,t),Oe(a))s=RE(s,$e(),i.children);else{const l=na(i.children,Ve(a));if(l){const u=l.getChild(ut(a));s=jl(s,$e(),u)}}}else throw Na("WriteRecord should have .snap or .children")}}return s}function NA(n,e,t,s,r){if(!s&&!r){const i=lo(n.visibleWrites,e);if(i!=null)return i;{const o=qr(n.visibleWrites,e);if(Fp(o))return t;if(t==null&&!Lp(o,$e()))return null;{const a=t||Te.EMPTY_NODE;return oa(o,a)}}}else{const i=qr(n.visibleWrites,e);if(!r&&Fp(i))return t;if(!r&&t==null&&!Lp(i,$e()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(Xn(u.path,e)||Xn(e,u.path))},a=PA(n.allWrites,o,e),l=t||Te.EMPTY_NODE;return oa(a,l)}}}function XO(n,e,t){let s=Te.EMPTY_NODE;const r=lo(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(bt,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=qr(n.visibleWrites,e);return t.forEachChild(bt,(o,a)=>{const l=oa(qr(i,new at(o)),a);s=s.updateImmediateChild(o,l)}),PE(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=qr(n.visibleWrites,e);return PE(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function ZO(n,e,t,s,r){Z(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=Ot(e,t);if(Lp(n.visibleWrites,i))return null;{const o=qr(n.visibleWrites,i);return Fp(o)?r.getChild(t):oa(o,r.getChild(t))}}function eM(n,e,t,s){const r=Ot(e,t),i=lo(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=qr(n.visibleWrites,r);return oa(o,s.getNode().getImmediateChild(t))}else return null}function tM(n,e){return lo(n.visibleWrites,e)}function nM(n,e,t,s,r,i,o){let a;const l=qr(n.visibleWrites,e),u=lo(l,$e());if(u!=null)a=u;else if(t!=null)a=oa(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),f=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let _=f.getNext();for(;_&&h.length<r;)d(_,s)!==0&&h.push(_),_=f.getNext();return h}else return[]}function sM(){return{visibleWrites:rs.empty(),allWrites:[],lastWriteId:-1}}function Vh(n,e,t,s){return NA(n.writeTree,n.treePath,e,t,s)}function A_(n,e){return XO(n.writeTree,n.treePath,e)}function NE(n,e,t,s){return ZO(n.writeTree,n.treePath,e,t,s)}function Oh(n,e){return tM(n.writeTree,Ot(n.treePath,e))}function rM(n,e,t,s,r,i){return nM(n.writeTree,n.treePath,e,t,s,r,i)}function S_(n,e,t){return eM(n.writeTree,n.treePath,e,t)}function kA(n,e){return xA(Ot(n.treePath,e),n.writeTree)}function xA(n,e){return{treePath:n,writeTree:e}}class iM{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;Z(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Z(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,gc(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,_c(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,ia(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,gc(s,e.snapshotNode,r.oldSnap));else throw Na("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class oM{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const DA=new oM;class R_{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Hi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return S_(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Qi(this.viewCache_),i=rM(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}function aM(n){return{filter:n}}function lM(n,e){Z(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Z(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function cM(n,e,t,s,r){const i=new iM;let o,a;if(t.type===Zn.OVERWRITE){const u=t;u.source.fromUser?o=Up(n,e,u.path,u.snap,s,r,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Oe(u.path),o=Mh(n,e,u.path,u.snap,s,r,a,i))}else if(t.type===Zn.MERGE){const u=t;u.source.fromUser?o=hM(n,e,u.path,u.children,s,r,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Bp(n,e,u.path,u.children,s,r,a,i))}else if(t.type===Zn.ACK_USER_WRITE){const u=t;u.revert?o=pM(n,e,u.path,s,r,i):o=dM(n,e,u.path,u.affectedTree,s,r,i)}else if(t.type===Zn.LISTEN_COMPLETE)o=fM(n,e,t.path,s,i);else throw Na("Unknown operation type: "+t.type);const l=i.getChanges();return uM(e,o,l),{viewCache:o,changes:l}}function uM(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=Mp(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(bA(Mp(e)))}}function VA(n,e,t,s,r,i){const o=e.eventCache;if(Oh(s,t)!=null)return e;{let a,l;if(Oe(t))if(Z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Qi(e),h=u instanceof Te?u:Te.EMPTY_NODE,d=A_(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const u=Vh(s,Qi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Ve(t);if(u===".priority"){Z(Wr(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=NE(s,t,h,l);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{const h=ut(t);let d;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const f=NE(s,t,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(u).updateChild(h,f):d=o.getNode().getImmediateChild(u)}else d=S_(s,u,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),u,d,h,r,i):a=o.getNode()}}return $l(e,a,o.isFullyInitialized()||Oe(t),n.filter.filtersNodes())}}function Mh(n,e,t,s,r,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Oe(t))u=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,s);u=h.updateFullNode(l.getNode(),_,null)}else{const _=Ve(t);if(!l.isCompleteForPath(t)&&Wr(t)>1)return e;const E=ut(t),C=l.getNode().getImmediateChild(_).updateChild(E,s);_===".priority"?u=h.updatePriority(l.getNode(),C):u=h.updateChild(l.getNode(),_,C,E,DA,null)}const d=RA(e,u,l.isFullyInitialized()||Oe(t),h.filtersNodes()),f=new R_(r,d,i);return VA(n,d,t,r,f,a)}function Up(n,e,t,s,r,i,o){const a=e.eventCache;let l,u;const h=new R_(r,e,i);if(Oe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=$l(e,u,!0,n.filter.filtersNodes());else{const d=Ve(t);if(d===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),s),l=$l(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=ut(t),_=a.getNode().getImmediateChild(d);let E;if(Oe(f))E=s;else{const T=h.getCompleteChild(d);T!=null?mA(f)===".priority"&&T.getChild(gA(f)).isEmpty()?E=T:E=T.updateChild(f,s):E=Te.EMPTY_NODE}if(_.equals(E))l=e;else{const T=n.filter.updateChild(a.getNode(),d,E,f,h,o);l=$l(e,T,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function kE(n,e){return n.eventCache.isCompleteForChild(e)}function hM(n,e,t,s,r,i,o){let a=e;return s.foreach((l,u)=>{const h=Ot(t,l);kE(e,Ve(h))&&(a=Up(n,a,h,u,r,i,o))}),s.foreach((l,u)=>{const h=Ot(t,l);kE(e,Ve(h))||(a=Up(n,a,h,u,r,i,o))}),a}function xE(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function Bp(n,e,t,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Oe(t)?u=s:u=new mt(null).setTree(t,s);const h=e.serverCache.getNode();return u.children.inorderTraversal((d,f)=>{if(h.hasChild(d)){const _=e.serverCache.getNode().getImmediateChild(d),E=xE(n,_,f);l=Mh(n,l,new at(d),E,r,i,o,a)}}),u.children.inorderTraversal((d,f)=>{const _=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!h.hasChild(d)&&!_){const E=e.serverCache.getNode().getImmediateChild(d),T=xE(n,E,f);l=Mh(n,l,new at(d),T,r,i,o,a)}}),l}function dM(n,e,t,s,r,i,o){if(Oh(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Oe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Mh(n,e,t,l.getNode().getChild(t),r,i,a,o);if(Oe(t)){let u=new mt(null);return l.getNode().forEachChild(Wo,(h,d)=>{u=u.set(new at(h),d)}),Bp(n,e,t,u,r,i,a,o)}else return e}else{let u=new mt(null);return s.foreach((h,d)=>{const f=Ot(t,h);l.isCompleteForPath(f)&&(u=u.set(h,l.getNode().getChild(f)))}),Bp(n,e,t,u,r,i,a,o)}}function fM(n,e,t,s,r){const i=e.serverCache,o=RA(e,i.getNode(),i.isFullyInitialized()||Oe(t),i.isFiltered());return VA(n,o,t,s,DA,r)}function pM(n,e,t,s,r,i){let o;if(Oh(s,t)!=null)return e;{const a=new R_(s,e,r),l=e.eventCache.getNode();let u;if(Oe(t)||Ve(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Vh(s,Qi(e));else{const d=e.serverCache.getNode();Z(d instanceof Te,"serverChildren would be complete if leaf node"),h=A_(s,d)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Ve(t);let d=S_(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?u=n.filter.updateChild(l,h,d,ut(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Te.EMPTY_NODE,ut(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Vh(s,Qi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Oh(s,$e())!=null,$l(e,u,o,n.filter.filtersNodes())}}class mM{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new E_(s.getIndex()),i=VO(s);this.processor_=aM(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Te.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Te.EMPTY_NODE,a.getNode(),null),h=new Hi(l,o.isFullyInitialized(),r.filtersNodes()),d=new Hi(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Cd(d,h),this.eventGenerator_=new qO(this.query_)}get query(){return this.query_}}function _M(n){return n.viewCache_.serverCache.getNode()}function gM(n,e){const t=Qi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Oe(e)&&!t.getImmediateChild(Ve(e)).isEmpty())?t.getChild(e):null}function DE(n){return n.eventRegistrations_.length===0}function yM(n,e){n.eventRegistrations_.push(e)}function VE(n,e,t){const s=[];if(t){Z(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return s}function OE(n,e,t,s){e.type===Zn.MERGE&&e.source.queryId!==null&&(Z(Qi(n.viewCache_),"We should always have a full cache before handling merges"),Z(Mp(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=cM(n.processor_,r,e,t,s);return lM(n.processor_,i.viewCache),Z(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,OA(n,i.changes,i.viewCache.eventCache.getNode(),null)}function vM(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(bt,(i,o)=>{s.push(ia(i,o))}),t.isFullyInitialized()&&s.push(bA(t.getNode())),OA(n,s,t.getNode(),e)}function OA(n,e,t,s){const r=s?[s]:n.eventRegistrations_;return $O(n.eventGenerator_,e,t,r)}let Lh;class EM{constructor(){this.views=new Map}}function IM(n){Z(!Lh,"__referenceConstructor has already been defined"),Lh=n}function TM(){return Z(Lh,"Reference.ts has not been loaded"),Lh}function wM(n){return n.views.size===0}function C_(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return Z(i!=null,"SyncTree gave us an op for an invalid query."),OE(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat(OE(o,e,t,s));return i}}function bM(n,e,t,s,r){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Vh(t,r?s:null),l=!1;a?l=!0:s instanceof Te?(a=A_(t,s),l=!1):(a=Te.EMPTY_NODE,l=!1);const u=Cd(new Hi(a,l,!1),new Hi(s,r,!1));return new mM(e,u)}return o}function AM(n,e,t,s,r,i){const o=bM(n,e,s,r,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),yM(o,t),vM(o,t)}function SM(n,e,t,s){const r=e._queryIdentifier,i=[];let o=[];const a=zr(n);if(r==="default")for(const[l,u]of n.views.entries())o=o.concat(VE(u,t,s)),DE(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(r);l&&(o=o.concat(VE(l,t,s)),DE(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!zr(n)&&i.push(new(TM())(e._repo,e._path)),{removed:i,events:o}}function MA(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function zo(n,e){let t=null;for(const s of n.views.values())t=t||gM(s,e);return t}function LA(n,e){if(e._queryParams.loadsAllData())return Pd(n);{const s=e._queryIdentifier;return n.views.get(s)}}function FA(n,e){return LA(n,e)!=null}function zr(n){return Pd(n)!=null}function Pd(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Fh;function RM(n){Z(!Fh,"__referenceConstructor has already been defined"),Fh=n}function CM(){return Z(Fh,"Reference.ts has not been loaded"),Fh}let PM=1;class ME{constructor(e){this.listenProvider_=e,this.syncPointTree_=new mt(null),this.pendingWriteTree_=sM(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function NM(n,e,t,s,r){return WO(n.pendingWriteTree_,e,t,s,r),r?Hc(n,new zi(SA(),e,t)):[]}function Mo(n,e,t=!1){const s=zO(n.pendingWriteTree_,e);if(HO(n.pendingWriteTree_,e)){let i=new mt(null);return s.snap!=null?i=i.set($e(),!0):Cn(s.children,o=>{i=i.set(new at(o),!0)}),Hc(n,new Dh(s.path,i,t))}else return[]}function Nd(n,e,t){return Hc(n,new zi(T_(),e,t))}function kM(n,e,t){const s=mt.fromObject(t);return Hc(n,new Ec(T_(),e,s))}function xM(n,e){return Hc(n,new vc(T_(),e))}function DM(n,e,t){const s=P_(n,t);if(s){const r=N_(s),i=r.path,o=r.queryId,a=Tn(i,e),l=new vc(w_(o),a);return k_(n,i,l)}else return[]}function qp(n,e,t,s,r=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||FA(o,e))){const l=SM(o,e,t,s);wM(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!r){const h=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(i,(f,_)=>zr(_));if(h&&!d){const f=n.syncPointTree_.subtree(i);if(!f.isEmpty()){const _=MM(f);for(let E=0;E<_.length;++E){const T=_[E],C=T.query,L=$A(n,T);n.listenProvider_.startListening(Gl(C),Uh(n,C),L.hashFn,L.onComplete)}}}!d&&u.length>0&&!s&&(h?n.listenProvider_.stopListening(Gl(e),null):u.forEach(f=>{const _=n.queryToTagMap.get(kd(f));n.listenProvider_.stopListening(Gl(f),_)}))}LM(n,u)}return a}function VM(n,e,t,s){const r=P_(n,s);if(r!=null){const i=N_(r),o=i.path,a=i.queryId,l=Tn(o,e),u=new zi(w_(a),l,t);return k_(n,o,u)}else return[]}function OM(n,e,t,s){const r=P_(n,s);if(r){const i=N_(r),o=i.path,a=i.queryId,l=Tn(o,e),u=mt.fromObject(t),h=new Ec(w_(a),l,u);return k_(n,o,h)}else return[]}function LE(n,e,t,s=!1){const r=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(r,(f,_)=>{const E=Tn(f,r);i=i||zo(_,E),o=o||zr(_)});let a=n.syncPointTree_.get(r);a?(o=o||zr(a),i=i||zo(a,$e())):(a=new EM,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=Te.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((_,E)=>{const T=zo(E,$e());T&&(i=i.updateImmediateChild(_,T))}));const u=FA(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=kd(e);Z(!n.queryToTagMap.has(f),"View does not exist, but we have a tag");const _=FM();n.queryToTagMap.set(f,_),n.tagToQueryMap.set(_,f)}const h=b_(n.pendingWriteTree_,r);let d=AM(a,e,t,h,i,l);if(!u&&!o&&!s){const f=LA(a,e);d=d.concat(UM(n,e,f))}return d}function UA(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Tn(o,e),u=zo(a,l);if(u)return u});return NA(r,e,i,t,!0)}function Hc(n,e){return BA(e,n.syncPointTree_,null,b_(n.pendingWriteTree_,$e()))}function BA(n,e,t,s){if(Oe(n.path))return qA(n,e,t,s);{const r=e.get($e());t==null&&r!=null&&(t=zo(r,$e()));let i=[];const o=Ve(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=kA(s,o);i=i.concat(BA(a,l,u,h))}return r&&(i=i.concat(C_(r,n,s,t))),i}}function qA(n,e,t,s){const r=e.get($e());t==null&&r!=null&&(t=zo(r,$e()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=kA(s,o),h=n.operationForChild(o);h&&(i=i.concat(qA(h,a,l,u)))}),r&&(i=i.concat(C_(r,n,s,t))),i}function $A(n,e){const t=e.query,s=Uh(n,t);return{hashFn:()=>(_M(e)||Te.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?DM(n,t._path,s):xM(n,t._path);{const i=DV(r,t);return qp(n,t,null,i)}}}}function Uh(n,e){const t=kd(e);return n.queryToTagMap.get(t)}function kd(n){return n._path.toString()+"$"+n._queryIdentifier}function P_(n,e){return n.tagToQueryMap.get(e)}function N_(n){const e=n.indexOf("$");return Z(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new at(n.substr(0,e))}}function k_(n,e,t){const s=n.syncPointTree_.get(e);Z(s,"Missing sync point for query tag that we're tracking");const r=b_(n.pendingWriteTree_,e);return C_(s,t,r,null)}function MM(n){return n.fold((e,t,s)=>{if(t&&zr(t))return[Pd(t)];{let r=[];return t&&(r=MA(t)),Cn(s,(i,o)=>{r=r.concat(o)}),r}})}function Gl(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(CM())(n._repo,n._path):n}function LM(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const r=kd(s),i=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(i)}}}function FM(){return PM++}function UM(n,e,t){const s=e._path,r=Uh(n,e),i=$A(n,t),o=n.listenProvider_.startListening(Gl(e),r,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(s);if(r)Z(!zr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,d)=>{if(!Oe(u)&&h&&zr(h))return[Pd(h).query];{let f=[];return h&&(f=f.concat(MA(h).map(_=>_.query))),Cn(d,(_,E)=>{f=f.concat(E)}),f}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Gl(h),Uh(n,h))}}return o}class x_{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new x_(t)}node(){return this.node_}}class D_{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ot(this.path_,e);return new D_(this.syncTree_,t)}node(){return UA(this.syncTree_,this.path_)}}const BM=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},FE=function(n,e,t){if(!n||typeof n!="object")return n;if(Z(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return qM(n[".sv"],e,t);if(typeof n[".sv"]=="object")return $M(n[".sv"],e);Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},qM=function(n,e,t){if(n==="timestamp")return t.timestamp;Z(!1,"Unexpected server value: "+n)},$M=function(n,e,t){n.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&Z(!1,"Unexpected increment value: "+s);const r=e.node();if(Z(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},jM=function(n,e,t,s){return V_(e,new D_(t,n),s)},GM=function(n,e,t){return V_(n,new x_(e),t)};function V_(n,e,t){const s=n.getPriority().val(),r=FE(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=FE(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new $t(a,an(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new $t(r))),o.forEachChild(bt,(a,l)=>{const u=V_(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}class O_{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function M_(n,e){let t=e instanceof at?e:new at(e),s=n,r=Ve(t);for(;r!==null;){const i=na(s.node.children,r)||{children:{},childCount:0};s=new O_(r,s,i),t=ut(t),r=Ve(t)}return s}function Oa(n){return n.node.value}function jA(n,e){n.node.value=e,$p(n)}function GA(n){return n.node.childCount>0}function KM(n){return Oa(n)===void 0&&!GA(n)}function xd(n,e){Cn(n.node.children,(t,s)=>{e(new O_(t,n,s))})}function KA(n,e,t,s){t&&e(n),xd(n,r=>{KA(r,e,!0)})}function WM(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Qc(n){return new at(n.parent===null?n.name:Qc(n.parent)+"/"+n.name)}function $p(n){n.parent!==null&&zM(n.parent,n.name,n)}function zM(n,e,t){const s=KM(t),r=or(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,$p(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,$p(n))}const HM=/[\[\].#$\/\u0000-\u001F\u007F]/,QM=/[\[\].#$\u0000-\u001F\u007F]/,Qf=10*1024*1024,WA=function(n){return typeof n=="string"&&n.length!==0&&!HM.test(n)},zA=function(n){return typeof n=="string"&&n.length!==0&&!QM.test(n)},YM=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),zA(n)},HA=function(n,e,t){const s=t instanceof at?new dO(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+wi(s));if(typeof e=="function")throw new Error(n+"contains a function "+wi(s)+" with contents = "+e.toString());if(Hb(e))throw new Error(n+"contains "+e.toString()+" "+wi(s));if(typeof e=="string"&&e.length>Qf/3&&Td(e)>Qf)throw new Error(n+"contains a string greater than "+Qf+" utf8 bytes "+wi(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Cn(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!WA(o)))throw new Error(n+" contains an invalid key ("+o+") "+wi(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);fO(s,o),HA(n,a,s),pO(s)}),r&&i)throw new Error(n+' contains ".value" child '+wi(s)+" in addition to actual children.")}},QA=function(n,e,t,s){if(!zA(t))throw new Error(cb(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},JM=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),QA(n,e,t)},XM=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!WA(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!YM(t))throw new Error(cb(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class ZM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function YA(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!g_(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function JA(n,e,t){YA(n,t),XA(n,s=>g_(s,e))}function co(n,e,t){YA(n,t),XA(n,s=>Xn(s,e)||Xn(e,s))}function XA(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(eL(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function eL(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Bl&&on("event: "+t.toString()),Wc(s)}}}const tL="repo_interrupt",nL=25;class sL{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ZM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xh(),this.transactionQueueTree_=new O_,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rL(n,e,t){if(n.stats_=m_(n.repoInfo_),n.forceRestClient_||LV())n.server_=new kh(n.repoInfo_,(s,r,i,o)=>{UE(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>BE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Kt(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new zs(n.repoInfo_,e,(s,r,i,o)=>{UE(n,s,r,i,o)},s=>{BE(n,s)},s=>{oL(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=$V(n.repoInfo_,()=>new BO(n.stats_,n.server_)),n.infoData_=new OO,n.infoSyncTree_=new ME({startListening:(s,r,i,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=Nd(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),L_(n,"connected",!1),n.serverSyncTree_=new ME({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);co(n.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function iL(n){const t=n.infoData_.getNode(new at(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ZA(n){return BM({timestamp:iL(n)})}function UE(n,e,t,s,r){n.dataUpdateCount++;const i=new at(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const l=vh(t,u=>an(u));o=OM(n.serverSyncTree_,i,l,r)}else{const l=an(t);o=VM(n.serverSyncTree_,i,l,r)}else if(s){const l=vh(t,u=>an(u));o=kM(n.serverSyncTree_,i,l)}else{const l=an(t);o=Nd(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=U_(n,i)),co(n.eventQueue_,a,o)}function BE(n,e){L_(n,"connected",e),e===!1&&lL(n)}function oL(n,e){Cn(e,(t,s)=>{L_(n,t,s)})}function L_(n,e,t){const s=new at("/.info/"+e),r=an(t);n.infoData_.updateSnapshot(s,r);const i=Nd(n.infoSyncTree_,s,r);co(n.eventQueue_,s,i)}function aL(n){return n.nextWriteId_++}function lL(n){eS(n,"onDisconnectEvents");const e=ZA(n),t=xh();Op(n.onDisconnect_,$e(),(r,i)=>{const o=jM(r,i,n.serverSyncTree_,e);AA(t,r,o)});let s=[];Op(t,$e(),(r,i)=>{s=s.concat(Nd(n.serverSyncTree_,r,i));const o=fL(n,r);U_(n,o)}),n.onDisconnect_=xh(),co(n.eventQueue_,$e(),s)}function cL(n,e,t){let s;Ve(e._path)===".info"?s=LE(n.infoSyncTree_,e,t):s=LE(n.serverSyncTree_,e,t),JA(n.eventQueue_,e._path,s)}function qE(n,e,t){let s;Ve(e._path)===".info"?s=qp(n.infoSyncTree_,e,t):s=qp(n.serverSyncTree_,e,t),JA(n.eventQueue_,e._path,s)}function uL(n){n.persistentConnection_&&n.persistentConnection_.interrupt(tL)}function eS(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),on(t,...e)}function tS(n,e,t){return UA(n.serverSyncTree_,e,t)||Te.EMPTY_NODE}function F_(n,e=n.transactionQueueTree_){if(e||Dd(n,e),Oa(e)){const t=sS(n,e);Z(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&hL(n,Qc(e),t)}else GA(e)&&xd(e,t=>{F_(n,t)})}function hL(n,e,t){const s=t.map(u=>u.currentWriteId),r=tS(n,e,s);let i=r;const o=r.hash();for(let u=0;u<t.length;u++){const h=t[u];Z(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=Tn(e,h.path);i=i.updateChild(d,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{eS(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const d=[];for(let f=0;f<t.length;f++)t[f].status=2,h=h.concat(Mo(n.serverSyncTree_,t[f].currentWriteId)),t[f].onComplete&&d.push(()=>t[f].onComplete(null,!0,t[f].currentOutputSnapshotResolved)),t[f].unwatcher();Dd(n,M_(n.transactionQueueTree_,e)),F_(n,n.transactionQueueTree_),co(n.eventQueue_,e,h);for(let f=0;f<d.length;f++)Wc(d[f])}else{if(u==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{Ln("transaction at "+l.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}U_(n,e)}},o)}function U_(n,e){const t=nS(n,e),s=Qc(t),r=sS(n,t);return dL(n,r,s),s}function dL(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Tn(t,l.path);let h=!1,d;if(Z(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=nL)h=!0,d="maxretry",r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0));else{const f=tS(n,l.path,o);l.currentInputSnapshot=f;const _=e[a].update(f.val());if(_!==void 0){HA("transaction failed: Data returned ",_,l.path);let E=an(_);typeof _=="object"&&_!=null&&or(_,".priority")||(E=E.updatePriority(f.getPriority()));const C=l.currentWriteId,L=ZA(n),U=GM(E,f,L);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=U,l.currentWriteId=aL(n),o.splice(o.indexOf(C),1),r=r.concat(NM(n.serverSyncTree_,l.path,U,l.currentWriteId,l.applyLocally)),r=r.concat(Mo(n.serverSyncTree_,C,!0))}else h=!0,d="nodata",r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0))}co(n.eventQueue_,t,r),r=[],h&&(e[a].status=2,(function(f){setTimeout(f,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Dd(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Wc(s[a]);F_(n,n.transactionQueueTree_)}function nS(n,e){let t,s=n.transactionQueueTree_;for(t=Ve(e);t!==null&&Oa(s)===void 0;)s=M_(s,t),e=ut(e),t=Ve(e);return s}function sS(n,e){const t=[];return rS(n,e,t),t.sort((s,r)=>s.order-r.order),t}function rS(n,e,t){const s=Oa(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);xd(e,r=>{rS(n,r,t)})}function Dd(n,e){const t=Oa(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,jA(e,t.length>0?t:void 0)}xd(e,s=>{Dd(n,s)})}function fL(n,e){const t=Qc(nS(n,e)),s=M_(n.transactionQueueTree_,e);return WM(s,r=>{Yf(n,r)}),Yf(n,s),KA(s,r=>{Yf(n,r)}),t}function Yf(n,e){const t=Oa(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Z(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Z(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Mo(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?jA(e,void 0):t.length=i+1,co(n.eventQueue_,Qc(e),r);for(let o=0;o<s.length;o++)Wc(s[o])}}function pL(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function mL(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Ln(`Invalid query segment '${t}' in query '${n}'`)}return e}const $E=function(n,e){const t=_L(n),s=t.namespace;t.domain==="firebase.com"&&er(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&er("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||CV();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new oA(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new at(t.pathString)}},_L=function(n){let e="",t="",s="",r="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(r=pL(n.substring(h,d)));const f=mL(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{const E=e.indexOf(".");s=e.substring(0,E).toLowerCase(),t=e.substring(E+1),i=s}"ns"in f&&(i=f.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};class gL{constructor(e,t,s,r){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Kt(this.snapshot.exportVal())}}class yL{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class vL{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class B_{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return Oe(this._path)?null:mA(this._path)}get ref(){return new ni(this._repo,this._path)}get _queryIdentifier(){const e=AE(this._queryParams),t=f_(e);return t==="{}"?"default":t}get _queryObject(){return AE(this._queryParams)}isEqual(e){if(e=je(e),!(e instanceof B_))return!1;const t=this._repo===e._repo,s=g_(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+hO(this._path)}}class ni extends B_{constructor(e,t){super(e,t,new I_,!1)}get parent(){const e=gA(this._path);return e===null?null:new ni(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Bh{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new at(e),s=jp(this.ref,e);return new Bh(this._node.getChild(t),s,bt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new Bh(r,jp(this.ref,s),bt)))}hasChild(e){const t=new at(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function EL(n,e){return n=je(n),n._checkNotDeleted("ref"),e!==void 0?jp(n._root,e):n._root}function jp(n,e){return n=je(n),Ve(n._path)===null?JM("child","path",e):QA("child","path",e),new ni(n._repo,Ot(n._path,e))}class q_{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new gL("value",this,new Bh(e.snapshotNode,new ni(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new yL(this,e,t):null}matches(e){return e instanceof q_?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function IL(n,e,t,s,r){let i;if(typeof s=="object"&&(i=void 0,r=s),typeof s=="function"&&(i=s),r&&r.onlyOnce){const l=t,u=(h,d)=>{qE(n._repo,n,a),l(h,d)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new vL(t,i||void 0),a=new q_(o);return cL(n._repo,n,a),()=>qE(n._repo,n,a)}function TL(n,e,t,s){return IL(n,"value",e,t,s)}IM(ni);RM(ni);const wL="FIREBASE_DATABASE_EMULATOR_HOST",Gp={};let bL=!1;function AL(n,e,t,s){const r=e.lastIndexOf(":"),i=e.substring(0,r),o=rr(i);n.repoInfo_=new oA(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function SL(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||er("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),on("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=$E(i,r),a=o.repoInfo,l;typeof process<"u"&&aE&&(l=aE[wL]),l?(i=`http://${l}?ns=${a.namespace}`,o=$E(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new UV(n.name,n.options,e);XM("Invalid Firebase Database URL",o),Oe(o.path)||er("Database URL must point to the root of a Firebase Database (not including a child path).");const h=CL(a,n,u,new FV(n,t));return new PL(h,n)}function RL(n,e){const t=Gp[e];(!t||t[n.key]!==n)&&er(`Database ${e}(${n.repoInfo_}) has already been deleted.`),uL(n),delete t[n.key]}function CL(n,e,t,s){let r=Gp[e.name];r||(r={},Gp[e.name]=r);let i=r[n.toURLString()];return i&&er("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new sL(n,bL,t,s),r[n.toURLString()]=i,i}class PL{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rL(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ni(this._repo,$e())),this._rootInternal}_delete(){return this._rootInternal!==null&&(RL(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&er("Cannot call "+e+" on a deleted database.")}}function NL(n=n_(),e){const t=xa(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Zw("database");s&&kL(t,...s)}return t}function kL(n,e,t,s={}){n=je(n),n._checkNotDeleted("useEmulator");const r=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&Kn(s,i.repoInfo_.emulatorOptions))return;er("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&er('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Qu(Qu.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:nb(s.mockUserToken,n.app.options.projectId);o=new Qu(a)}rr(e)&&(Id(e),Zm("Database",!0)),AL(i,r,s,o)}function xL(n){TV(ao),Gi(new Kr("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return SL(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),ws(lE,cE,n),ws(lE,cE,"esm2020")}zs.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};zs.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};xL();var jE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var $r,iS;(function(){var n;function e(b,v){function A(){}A.prototype=v.prototype,b.F=v.prototype,b.prototype=new A,b.prototype.constructor=b,b.D=function(P,R,x){for(var w=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)w[nt-2]=arguments[nt];return v.prototype[R].apply(P,w)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,v,A){A||(A=0);const P=Array(16);if(typeof v=="string")for(var R=0;R<16;++R)P[R]=v.charCodeAt(A++)|v.charCodeAt(A++)<<8|v.charCodeAt(A++)<<16|v.charCodeAt(A++)<<24;else for(R=0;R<16;++R)P[R]=v[A++]|v[A++]<<8|v[A++]<<16|v[A++]<<24;v=b.g[0],A=b.g[1],R=b.g[2];let x=b.g[3],w;w=v+(x^A&(R^x))+P[0]+3614090360&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[1]+3905402710&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[2]+606105819&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[3]+3250441966&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[4]+4118548399&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[5]+1200080426&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[6]+2821735955&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[7]+4249261313&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[8]+1770035416&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[9]+2336552879&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[10]+4294925233&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[11]+2304563134&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[12]+1804603682&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[13]+4254626195&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[14]+2792965006&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[15]+1236535329&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(R^x&(A^R))+P[1]+4129170786&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[6]+3225465664&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[11]+643717713&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[0]+3921069994&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[5]+3593408605&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[10]+38016083&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[15]+3634488961&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[4]+3889429448&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[9]+568446438&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[14]+3275163606&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[3]+4107603335&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[8]+1163531501&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[13]+2850285829&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[2]+4243563512&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[7]+1735328473&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[12]+2368359562&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(A^R^x)+P[5]+4294588738&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[8]+2272392833&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[11]+1839030562&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[14]+4259657740&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[1]+2763975236&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[4]+1272893353&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[7]+4139469664&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[10]+3200236656&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[13]+681279174&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[0]+3936430074&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[3]+3572445317&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[6]+76029189&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[9]+3654602809&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[12]+3873151461&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[15]+530742520&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[2]+3299628645&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(R^(A|~x))+P[0]+4096336452&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[7]+1126891415&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[14]+2878612391&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[5]+4237533241&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[12]+1700485571&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[3]+2399980690&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[10]+4293915773&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[1]+2240044497&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[8]+1873313359&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[15]+4264355552&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[6]+2734768916&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[13]+1309151649&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[4]+4149444226&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[11]+3174756917&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[2]+718787259&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[9]+3951481745&4294967295,b.g[0]=b.g[0]+v&4294967295,b.g[1]=b.g[1]+(R+(w<<21&4294967295|w>>>11))&4294967295,b.g[2]=b.g[2]+R&4294967295,b.g[3]=b.g[3]+x&4294967295}s.prototype.v=function(b,v){v===void 0&&(v=b.length);const A=v-this.blockSize,P=this.C;let R=this.h,x=0;for(;x<v;){if(R==0)for(;x<=A;)r(this,b,x),x+=this.blockSize;if(typeof b=="string"){for(;x<v;)if(P[R++]=b.charCodeAt(x++),R==this.blockSize){r(this,P),R=0;break}}else for(;x<v;)if(P[R++]=b[x++],R==this.blockSize){r(this,P),R=0;break}}this.h=R,this.o+=v},s.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var v=1;v<b.length-8;++v)b[v]=0;v=this.o*8;for(var A=b.length-8;A<b.length;++A)b[A]=v&255,v/=256;for(this.v(b),b=Array(16),v=0,A=0;A<4;++A)for(let P=0;P<32;P+=8)b[v++]=this.g[A]>>>P&255;return b};function i(b,v){var A=a;return Object.prototype.hasOwnProperty.call(A,b)?A[b]:A[b]=v(b)}function o(b,v){this.h=v;const A=[];let P=!0;for(let R=b.length-1;R>=0;R--){const x=b[R]|0;P&&x==v||(A[R]=x,P=!1)}this.g=A}var a={};function l(b){return-128<=b&&b<128?i(b,function(v){return new o([v|0],v<0?-1:0)}):new o([b|0],b<0?-1:0)}function u(b){if(isNaN(b)||!isFinite(b))return d;if(b<0)return C(u(-b));const v=[];let A=1;for(let P=0;b>=A;P++)v[P]=b/A|0,A*=4294967296;return new o(v,0)}function h(b,v){if(b.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(b.charAt(0)=="-")return C(h(b.substring(1),v));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const A=u(Math.pow(v,8));let P=d;for(let x=0;x<b.length;x+=8){var R=Math.min(8,b.length-x);const w=parseInt(b.substring(x,x+R),v);R<8?(R=u(Math.pow(v,R)),P=P.j(R).add(u(w))):(P=P.j(A),P=P.add(u(w)))}return P}var d=l(0),f=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-C(this).m();let b=0,v=1;for(let A=0;A<this.g.length;A++){const P=this.i(A);b+=(P>=0?P:4294967296+P)*v,v*=4294967296}return b},n.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(E(this))return"0";if(T(this))return"-"+C(this).toString(b);const v=u(Math.pow(b,6));var A=this;let P="";for(;;){const R=k(A,v).g;A=L(A,R.j(v));let x=((A.g.length>0?A.g[0]:A.h)>>>0).toString(b);if(A=R,E(A))return x+P;for(;x.length<6;)x="0"+x;P=x+P}},n.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function E(b){if(b.h!=0)return!1;for(let v=0;v<b.g.length;v++)if(b.g[v]!=0)return!1;return!0}function T(b){return b.h==-1}n.l=function(b){return b=L(this,b),T(b)?-1:E(b)?0:1};function C(b){const v=b.g.length,A=[];for(let P=0;P<v;P++)A[P]=~b.g[P];return new o(A,~b.h).add(f)}n.abs=function(){return T(this)?C(this):this},n.add=function(b){const v=Math.max(this.g.length,b.g.length),A=[];let P=0;for(let R=0;R<=v;R++){let x=P+(this.i(R)&65535)+(b.i(R)&65535),w=(x>>>16)+(this.i(R)>>>16)+(b.i(R)>>>16);P=w>>>16,x&=65535,w&=65535,A[R]=w<<16|x}return new o(A,A[A.length-1]&-2147483648?-1:0)};function L(b,v){return b.add(C(v))}n.j=function(b){if(E(this)||E(b))return d;if(T(this))return T(b)?C(this).j(C(b)):C(C(this).j(b));if(T(b))return C(this.j(C(b)));if(this.l(_)<0&&b.l(_)<0)return u(this.m()*b.m());const v=this.g.length+b.g.length,A=[];for(var P=0;P<2*v;P++)A[P]=0;for(P=0;P<this.g.length;P++)for(let R=0;R<b.g.length;R++){const x=this.i(P)>>>16,w=this.i(P)&65535,nt=b.i(R)>>>16,Ut=b.i(R)&65535;A[2*P+2*R]+=w*Ut,U(A,2*P+2*R),A[2*P+2*R+1]+=x*Ut,U(A,2*P+2*R+1),A[2*P+2*R+1]+=w*nt,U(A,2*P+2*R+1),A[2*P+2*R+2]+=x*nt,U(A,2*P+2*R+2)}for(b=0;b<v;b++)A[b]=A[2*b+1]<<16|A[2*b];for(b=v;b<2*v;b++)A[b]=0;return new o(A,0)};function U(b,v){for(;(b[v]&65535)!=b[v];)b[v+1]+=b[v]>>>16,b[v]&=65535,v++}function N(b,v){this.g=b,this.h=v}function k(b,v){if(E(v))throw Error("division by zero");if(E(b))return new N(d,d);if(T(b))return v=k(C(b),v),new N(C(v.g),C(v.h));if(T(v))return v=k(b,C(v)),new N(C(v.g),v.h);if(b.g.length>30){if(T(b)||T(v))throw Error("slowDivide_ only works with positive integers.");for(var A=f,P=v;P.l(b)<=0;)A=G(A),P=G(P);var R=J(A,1),x=J(P,1);for(P=J(P,2),A=J(A,2);!E(P);){var w=x.add(P);w.l(b)<=0&&(R=R.add(A),x=w),P=J(P,1),A=J(A,1)}return v=L(b,R.j(v)),new N(R,v)}for(R=d;b.l(v)>=0;){for(A=Math.max(1,Math.floor(b.m()/v.m())),P=Math.ceil(Math.log(A)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),x=u(A),w=x.j(v);T(w)||w.l(b)>0;)A-=P,x=u(A),w=x.j(v);E(x)&&(x=f),R=R.add(x),b=L(b,w)}return new N(R,b)}n.B=function(b){return k(this,b).h},n.and=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)&b.i(P);return new o(A,this.h&b.h)},n.or=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)|b.i(P);return new o(A,this.h|b.h)},n.xor=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)^b.i(P);return new o(A,this.h^b.h)};function G(b){const v=b.g.length+1,A=[];for(let P=0;P<v;P++)A[P]=b.i(P)<<1|b.i(P-1)>>>31;return new o(A,b.h)}function J(b,v){const A=v>>5;v%=32;const P=b.g.length-A,R=[];for(let x=0;x<P;x++)R[x]=v>0?b.i(x+A)>>>v|b.i(x+A+1)<<32-v:b.i(x+A);return new o(R,b.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,iS=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,$r=o}).apply(typeof jE<"u"?jE:typeof self<"u"?self:typeof window<"u"?window:{});var Pu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var oS,Rl,aS,Ju,Kp,lS,cS,uS;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Pu=="object"&&Pu];for(var p=0;p<c.length;++p){var m=c[p];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var s=t(this);function r(c,p){if(p)e:{var m=s;c=c.split(".");for(var y=0;y<c.length-1;y++){var O=c[y];if(!(O in m))break e;m=m[O]}c=c[c.length-1],y=m[c],p=p(y),p!=y&&p!=null&&e(m,c,{configurable:!0,writable:!0,value:p})}}r("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(c){return c||function(p){var m=[],y;for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&m.push([y,p[y]]);return m}});var i=i||{},o=this||self;function a(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function l(c,p,m){return c.call.apply(c.bind,arguments)}function u(c,p,m){return u=l,u.apply(null,arguments)}function h(c,p){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function d(c,p){function m(){}m.prototype=p.prototype,c.Z=p.prototype,c.prototype=new m,c.prototype.constructor=c,c.Ob=function(y,O,F){for(var ne=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)ne[Ce-2]=arguments[Ce];return p.prototype[O].apply(y,ne)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function _(c){const p=c.length;if(p>0){const m=Array(p);for(let y=0;y<p;y++)m[y]=c[y];return m}return[]}function E(c,p){for(let y=1;y<arguments.length;y++){const O=arguments[y];var m=typeof O;if(m=m!="object"?m:O?Array.isArray(O)?"array":m:"null",m=="array"||m=="object"&&typeof O.length=="number"){m=c.length||0;const F=O.length||0;c.length=m+F;for(let ne=0;ne<F;ne++)c[m+ne]=O[ne]}else c.push(O)}}class T{constructor(p,m){this.i=p,this.j=m,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function C(c){o.setTimeout(()=>{throw c},0)}function L(){var c=b;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class U{constructor(){this.h=this.g=null}add(p,m){const y=N.get();y.set(p,m),this.h?this.h.next=y:this.g=y,this.h=y}}var N=new T(()=>new k,c=>c.reset());class k{constructor(){this.next=this.g=this.h=null}set(p,m){this.h=p,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let G,J=!1,b=new U,v=()=>{const c=Promise.resolve(void 0);G=()=>{c.then(A)}};function A(){for(var c;c=L();){try{c.h.call(c.g)}catch(m){C(m)}var p=N;p.j(c),p.h<100&&(p.h++,c.next=p.g,p.g=c)}J=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var x=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};o.addEventListener("test",m,p),o.removeEventListener("test",m,p)}catch{}return c})();function w(c){return/^[\s\xa0]*$/.test(c)}function nt(c,p){R.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,p)}d(nt,R),nt.prototype.init=function(c,p){const m=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget,p||(m=="mouseover"?p=c.fromElement:m=="mouseout"&&(p=c.toElement)),this.relatedTarget=p,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&nt.Z.h.call(this)},nt.prototype.h=function(){nt.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ut="closure_listenable_"+(Math.random()*1e6|0),lt=0;function Fe(c,p,m,y,O){this.listener=c,this.proxy=null,this.src=p,this.type=m,this.capture=!!y,this.ha=O,this.key=++lt,this.da=this.fa=!1}function se(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function re(c,p,m){for(const y in c)p.call(m,c[y],y,c)}function ft(c,p){for(const m in c)p.call(void 0,c[m],m,c)}function pn(c){const p={};for(const m in c)p[m]=c[m];return p}const xt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(c,p){let m,y;for(let O=1;O<arguments.length;O++){y=arguments[O];for(m in y)c[m]=y[m];for(let F=0;F<xt.length;F++)m=xt[F],Object.prototype.hasOwnProperty.call(y,m)&&(c[m]=y[m])}}function ie(c){this.src=c,this.g={},this.h=0}ie.prototype.add=function(c,p,m,y,O){const F=c.toString();c=this.g[F],c||(c=this.g[F]=[],this.h++);const ne=et(c,p,y,O);return ne>-1?(p=c[ne],m||(p.fa=!1)):(p=new Fe(p,this.src,F,!!y,O),p.fa=m,c.push(p)),p};function le(c,p){const m=p.type;if(m in c.g){var y=c.g[m],O=Array.prototype.indexOf.call(y,p,void 0),F;(F=O>=0)&&Array.prototype.splice.call(y,O,1),F&&(se(p),c.g[m].length==0&&(delete c.g[m],c.h--))}}function et(c,p,m,y){for(let O=0;O<c.length;++O){const F=c[O];if(!F.da&&F.listener==p&&F.capture==!!m&&F.ha==y)return O}return-1}var j="closure_lm_"+(Math.random()*1e6|0),fe={};function ae(c,p,m,y,O){if(Array.isArray(p)){for(let F=0;F<p.length;F++)ae(c,p[F],m,y,O);return null}return m=oe(m),c&&c[Ut]?c.J(p,m,a(y)?!!y.capture:!1,O):_e(c,p,m,!1,y,O)}function _e(c,p,m,y,O,F){if(!p)throw Error("Invalid event type");const ne=a(O)?!!O.capture:!!O;let Ce=K(c);if(Ce||(c[j]=Ce=new ie(c)),m=Ce.add(p,m,y,ne,F),m.proxy)return m;if(y=Me(),m.proxy=y,y.src=c,y.listener=m,c.addEventListener)x||(O=ne),O===void 0&&(O=!1),c.addEventListener(p.toString(),y,O);else if(c.attachEvent)c.attachEvent(V(p.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Me(){function c(m){return p.call(c.src,c.listener,m)}const p=q;return c}function I(c,p,m,y,O){if(Array.isArray(p))for(var F=0;F<p.length;F++)I(c,p[F],m,y,O);else y=a(y)?!!y.capture:!!y,m=oe(m),c&&c[Ut]?(c=c.i,F=String(p).toString(),F in c.g&&(p=c.g[F],m=et(p,m,y,O),m>-1&&(se(p[m]),Array.prototype.splice.call(p,m,1),p.length==0&&(delete c.g[F],c.h--)))):c&&(c=K(c))&&(p=c.g[p.toString()],c=-1,p&&(c=et(p,m,y,O)),(m=c>-1?p[c]:null)&&S(m))}function S(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[Ut])le(p.i,c);else{var m=c.type,y=c.proxy;p.removeEventListener?p.removeEventListener(m,y,c.capture):p.detachEvent?p.detachEvent(V(m),y):p.addListener&&p.removeListener&&p.removeListener(y),(m=K(p))?(le(m,c),m.h==0&&(m.src=null,p[j]=null)):se(c)}}}function V(c){return c in fe?fe[c]:fe[c]="on"+c}function q(c,p){if(c.da)c=!0;else{p=new nt(p,this);const m=c.listener,y=c.ha||c.src;c.fa&&S(c),c=m.call(y,p)}return c}function K(c){return c=c[j],c instanceof ie?c:null}var $="__closure_events_fn_"+(Math.random()*1e9>>>0);function oe(c){return typeof c=="function"?c:(c[$]||(c[$]=function(p){return c.handleEvent(p)}),c[$])}function Q(){P.call(this),this.i=new ie(this),this.M=this,this.G=null}d(Q,P),Q.prototype[Ut]=!0,Q.prototype.removeEventListener=function(c,p,m,y){I(this,c,p,m,y)};function H(c,p){var m,y=c.G;if(y)for(m=[];y;y=y.G)m.push(y);if(c=c.M,y=p.type||p,typeof p=="string")p=new R(p,c);else if(p instanceof R)p.target=p.target||c;else{var O=p;p=new R(y,c),ue(p,O)}O=!0;let F,ne;if(m)for(ne=m.length-1;ne>=0;ne--)F=p.g=m[ne],O=z(F,y,!0,p)&&O;if(F=p.g=c,O=z(F,y,!0,p)&&O,O=z(F,y,!1,p)&&O,m)for(ne=0;ne<m.length;ne++)F=p.g=m[ne],O=z(F,y,!1,p)&&O}Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var c=this.i;for(const p in c.g){const m=c.g[p];for(let y=0;y<m.length;y++)se(m[y]);delete c.g[p],c.h--}}this.G=null},Q.prototype.J=function(c,p,m,y){return this.i.add(String(c),p,!1,m,y)},Q.prototype.K=function(c,p,m,y){return this.i.add(String(c),p,!0,m,y)};function z(c,p,m,y){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();let O=!0;for(let F=0;F<p.length;++F){const ne=p[F];if(ne&&!ne.da&&ne.capture==m){const Ce=ne.listener,Dt=ne.ha||ne.src;ne.fa&&le(c.i,ne),O=Ce.call(Dt,y)!==!1&&O}}return O&&!y.defaultPrevented}function ve(c,p){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(c,p||0)}function ce(c){c.g=ve(()=>{c.g=null,c.i&&(c.i=!1,ce(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class ge extends P{constructor(p,m){super(),this.m=p,this.l=m,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:ce(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ee(c){P.call(this),this.h=c,this.g={}}d(Ee,P);var xe=[];function Ye(c){re(c.g,function(p,m){this.g.hasOwnProperty(m)&&S(p)},c),c.g={}}Ee.prototype.N=function(){Ee.Z.N.call(this),Ye(this)},Ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Be=o.JSON.stringify,Zt=o.JSON.parse,en=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function Nn(){}function kn(){}var Wn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function go(){R.call(this,"d")}d(go,R);function zt(){R.call(this,"c")}d(zt,R);var Bt={},Qa=null;function fi(){return Qa=Qa||new Q}Bt.Ia="serverreachability";function dy(c){R.call(this,Bt.Ia,c)}d(dy,R);function Ya(c){const p=fi();H(p,new dy(p))}Bt.STAT_EVENT="statevent";function fy(c,p){R.call(this,Bt.STAT_EVENT,c),this.stat=p}d(fy,R);function mn(c){const p=fi();H(p,new fy(p,c))}Bt.Ja="timingevent";function py(c,p){R.call(this,Bt.Ja,c),this.size=p}d(py,R);function Ja(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},p)}function Xa(){this.g=!0}Xa.prototype.ua=function(){this.g=!1};function zP(c,p,m,y,O,F){c.info(function(){if(c.g)if(F){var ne="",Ce=F.split("&");for(let st=0;st<Ce.length;st++){var Dt=Ce[st].split("=");if(Dt.length>1){const qt=Dt[0];Dt=Dt[1];const ds=qt.split("_");ne=ds.length>=2&&ds[1]=="type"?ne+(qt+"="+Dt+"&"):ne+(qt+"=redacted&")}}}else ne=null;else ne=F;return"XMLHTTP REQ ("+y+") [attempt "+O+"]: "+p+`
`+m+`
`+ne})}function HP(c,p,m,y,O,F,ne){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+O+"]: "+p+`
`+m+`
`+F+" "+ne})}function yo(c,p,m,y){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+YP(c,m)+(y?" "+y:"")})}function QP(c,p){c.info(function(){return"TIMEOUT: "+p})}Xa.prototype.info=function(){};function YP(c,p){if(!c.g)return p;if(!p)return null;try{const F=JSON.parse(p);if(F){for(c=0;c<F.length;c++)if(Array.isArray(F[c])){var m=F[c];if(!(m.length<2)){var y=m[1];if(Array.isArray(y)&&!(y.length<1)){var O=y[0];if(O!="noop"&&O!="stop"&&O!="close")for(let ne=1;ne<y.length;ne++)y[ne]=""}}}}return Be(F)}catch{return p}}var fu={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},my={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},_y;function ff(){}d(ff,Nn),ff.prototype.g=function(){return new XMLHttpRequest},_y=new ff;function Za(c){return encodeURIComponent(String(c))}function JP(c){var p=1;c=c.split(":");const m=[];for(;p>0&&c.length;)m.push(c.shift()),p--;return c.length&&m.push(c.join(":")),m}function dr(c,p,m,y){this.j=c,this.i=p,this.l=m,this.S=y||1,this.V=new Ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new gy}function gy(){this.i=null,this.g="",this.h=!1}var yy={},pf={};function mf(c,p,m){c.M=1,c.A=mu(hs(p)),c.u=m,c.R=!0,vy(c,null)}function vy(c,p){c.F=Date.now(),pu(c),c.B=hs(c.A);var m=c.B,y=c.S;Array.isArray(y)||(y=[String(y)]),xy(m.i,"t",y),c.C=0,m=c.j.L,c.h=new gy,c.g=Yy(c.j,m?p:null,!c.u),c.P>0&&(c.O=new ge(u(c.Y,c,c.g),c.P)),p=c.V,m=c.g,y=c.ba;var O="readystatechange";Array.isArray(O)||(O&&(xe[0]=O.toString()),O=xe);for(let F=0;F<O.length;F++){const ne=ae(m,O[F],y||p.handleEvent,!1,p.h||p);if(!ne)break;p.g[ne.key]=ne}p=c.J?pn(c.J):{},c.u?(c.v||(c.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,p)):(c.v="GET",c.g.ea(c.B,c.v,null,p)),Ya(),zP(c.i,c.v,c.B,c.l,c.S,c.u)}dr.prototype.ba=function(c){c=c.target;const p=this.O;p&&mr(c)==3?p.j():this.Y(c)},dr.prototype.Y=function(c){try{if(c==this.g)e:{const Ce=mr(this.g),Dt=this.g.ya(),st=this.g.ca();if(!(Ce<3)&&(Ce!=3||this.g&&(this.h.h||this.g.la()||Uy(this.g)))){this.K||Ce!=4||Dt==7||(Dt==8||st<=0?Ya(3):Ya(2)),_f(this);var p=this.g.ca();this.X=p;var m=XP(this);if(this.o=p==200,HP(this.i,this.v,this.B,this.l,this.S,Ce,p),this.o){if(this.U&&!this.L){t:{if(this.g){var y,O=this.g;if((y=O.g?O.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(y)){var F=y;break t}}F=null}if(c=F)yo(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,gf(this,c);else{this.o=!1,this.m=3,mn(12),pi(this),el(this);break e}}if(this.R){c=!0;let qt;for(;!this.K&&this.C<m.length;)if(qt=ZP(this,m),qt==pf){Ce==4&&(this.m=4,mn(14),c=!1),yo(this.i,this.l,null,"[Incomplete Response]");break}else if(qt==yy){this.m=4,mn(15),yo(this.i,this.l,m,"[Invalid Chunk]"),c=!1;break}else yo(this.i,this.l,qt,null),gf(this,qt);if(Ey(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ce!=4||m.length!=0||this.h.h||(this.m=1,mn(16),c=!1),this.o=this.o&&c,!c)yo(this.i,this.l,m,"[Invalid Chunked Response]"),pi(this),el(this);else if(m.length>0&&!this.W){this.W=!0;var ne=this.j;ne.g==this&&ne.aa&&!ne.P&&(ne.j.info("Great, no buffering proxy detected. Bytes received: "+m.length),Af(ne),ne.P=!0,mn(11))}}else yo(this.i,this.l,m,null),gf(this,m);Ce==4&&pi(this),this.o&&!this.K&&(Ce==4?Wy(this.j,this):(this.o=!1,pu(this)))}else f0(this.g),p==400&&m.indexOf("Unknown SID")>0?(this.m=3,mn(12)):(this.m=0,mn(13)),pi(this),el(this)}}}catch{}};function XP(c){if(!Ey(c))return c.g.la();const p=Uy(c.g);if(p==="")return"";let m="";const y=p.length,O=mr(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return pi(c),el(c),"";c.h.i=new o.TextDecoder}for(let F=0;F<y;F++)c.h.h=!0,m+=c.h.i.decode(p[F],{stream:!(O&&F==y-1)});return p.length=0,c.h.g+=m,c.C=0,c.h.g}function Ey(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function ZP(c,p){var m=c.C,y=p.indexOf(`
`,m);return y==-1?pf:(m=Number(p.substring(m,y)),isNaN(m)?yy:(y+=1,y+m>p.length?pf:(p=p.slice(y,y+m),c.C=y+m,p)))}dr.prototype.cancel=function(){this.K=!0,pi(this)};function pu(c){c.T=Date.now()+c.H,Iy(c,c.H)}function Iy(c,p){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Ja(u(c.aa,c),p)}function _f(c){c.D&&(o.clearTimeout(c.D),c.D=null)}dr.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(QP(this.i,this.B),this.M!=2&&(Ya(),mn(17)),pi(this),this.m=2,el(this)):Iy(this,this.T-c)};function el(c){c.j.I==0||c.K||Wy(c.j,c)}function pi(c){_f(c);var p=c.O;p&&typeof p.dispose=="function"&&p.dispose(),c.O=null,Ye(c.V),c.g&&(p=c.g,c.g=null,p.abort(),p.dispose())}function gf(c,p){try{var m=c.j;if(m.I!=0&&(m.g==c||yf(m.h,c))){if(!c.L&&yf(m.h,c)&&m.I==3){try{var y=m.Ba.g.parse(p)}catch{y=null}if(Array.isArray(y)&&y.length==3){var O=y;if(O[0]==0){e:if(!m.v){if(m.g)if(m.g.F+3e3<c.F)Eu(m),yu(m);else break e;bf(m),mn(18)}}else m.xa=O[1],0<m.xa-m.K&&O[2]<37500&&m.F&&m.A==0&&!m.C&&(m.C=Ja(u(m.Va,m),6e3));by(m.h)<=1&&m.ta&&(m.ta=void 0)}else _i(m,11)}else if((c.L||m.g==c)&&Eu(m),!w(p))for(O=m.Ba.g.parse(p),p=0;p<O.length;p++){let st=O[p];const qt=st[0];if(!(qt<=m.K))if(m.K=qt,st=st[1],m.I==2)if(st[0]=="c"){m.M=st[1],m.ba=st[2];const ds=st[3];ds!=null&&(m.ka=ds,m.j.info("VER="+m.ka));const gi=st[4];gi!=null&&(m.za=gi,m.j.info("SVER="+m.za));const _r=st[5];_r!=null&&typeof _r=="number"&&_r>0&&(y=1.5*_r,m.O=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const gr=c.g;if(gr){const Tu=gr.g?gr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Tu){var F=y.h;F.g||Tu.indexOf("spdy")==-1&&Tu.indexOf("quic")==-1&&Tu.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(vf(F,F.h),F.h=null))}if(y.G){const Sf=gr.g?gr.g.getResponseHeader("X-HTTP-Session-Id"):null;Sf&&(y.wa=Sf,pt(y.J,y.G,Sf))}}m.I=3,m.l&&m.l.ra(),m.aa&&(m.T=Date.now()-c.F,m.j.info("Handshake RTT: "+m.T+"ms")),y=m;var ne=c;if(y.na=Qy(y,y.L?y.ba:null,y.W),ne.L){Ay(y.h,ne);var Ce=ne,Dt=y.O;Dt&&(Ce.H=Dt),Ce.D&&(_f(Ce),pu(Ce)),y.g=ne}else Gy(y);m.i.length>0&&vu(m)}else st[0]!="stop"&&st[0]!="close"||_i(m,7);else m.I==3&&(st[0]=="stop"||st[0]=="close"?st[0]=="stop"?_i(m,7):wf(m):st[0]!="noop"&&m.l&&m.l.qa(st),m.A=0)}}Ya(4)}catch{}}var e0=class{constructor(c,p){this.g=c,this.map=p}};function Ty(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function wy(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function by(c){return c.h?1:c.g?c.g.size:0}function yf(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function vf(c,p){c.g?c.g.add(p):c.h=p}function Ay(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}Ty.prototype.cancel=function(){if(this.i=Sy(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Sy(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const m of c.g.values())p=p.concat(m.G);return p}return _(c.i)}var Ry=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function t0(c,p){if(c){c=c.split("&");for(let m=0;m<c.length;m++){const y=c[m].indexOf("=");let O,F=null;y>=0?(O=c[m].substring(0,y),F=c[m].substring(y+1)):O=c[m],p(O,F?decodeURIComponent(F.replace(/\+/g," ")):"")}}}function fr(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;c instanceof fr?(this.l=c.l,tl(this,c.j),this.o=c.o,this.g=c.g,nl(this,c.u),this.h=c.h,Ef(this,Dy(c.i)),this.m=c.m):c&&(p=String(c).match(Ry))?(this.l=!1,tl(this,p[1]||"",!0),this.o=sl(p[2]||""),this.g=sl(p[3]||"",!0),nl(this,p[4]),this.h=sl(p[5]||"",!0),Ef(this,p[6]||"",!0),this.m=sl(p[7]||"")):(this.l=!1,this.i=new il(null,this.l))}fr.prototype.toString=function(){const c=[];var p=this.j;p&&c.push(rl(p,Cy,!0),":");var m=this.g;return(m||p=="file")&&(c.push("//"),(p=this.o)&&c.push(rl(p,Cy,!0),"@"),c.push(Za(m).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.u,m!=null&&c.push(":",String(m))),(m=this.h)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(rl(m,m.charAt(0)=="/"?r0:s0,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",rl(m,o0)),c.join("")},fr.prototype.resolve=function(c){const p=hs(this);let m=!!c.j;m?tl(p,c.j):m=!!c.o,m?p.o=c.o:m=!!c.g,m?p.g=c.g:m=c.u!=null;var y=c.h;if(m)nl(p,c.u);else if(m=!!c.h){if(y.charAt(0)!="/")if(this.g&&!this.h)y="/"+y;else{var O=p.h.lastIndexOf("/");O!=-1&&(y=p.h.slice(0,O+1)+y)}if(O=y,O==".."||O==".")y="";else if(O.indexOf("./")!=-1||O.indexOf("/.")!=-1){y=O.lastIndexOf("/",0)==0,O=O.split("/");const F=[];for(let ne=0;ne<O.length;){const Ce=O[ne++];Ce=="."?y&&ne==O.length&&F.push(""):Ce==".."?((F.length>1||F.length==1&&F[0]!="")&&F.pop(),y&&ne==O.length&&F.push("")):(F.push(Ce),y=!0)}y=F.join("/")}else y=O}return m?p.h=y:m=c.i.toString()!=="",m?Ef(p,Dy(c.i)):m=!!c.m,m&&(p.m=c.m),p};function hs(c){return new fr(c)}function tl(c,p,m){c.j=m?sl(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function nl(c,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);c.u=p}else c.u=null}function Ef(c,p,m){p instanceof il?(c.i=p,a0(c.i,c.l)):(m||(p=rl(p,i0)),c.i=new il(p,c.l))}function pt(c,p,m){c.i.set(p,m)}function mu(c){return pt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function sl(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function rl(c,p,m){return typeof c=="string"?(c=encodeURI(c).replace(p,n0),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function n0(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Cy=/[#\/\?@]/g,s0=/[#\?:]/g,r0=/[#\?]/g,i0=/[#\?@]/g,o0=/#/g;function il(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function mi(c){c.g||(c.g=new Map,c.h=0,c.i&&t0(c.i,function(p,m){c.add(decodeURIComponent(p.replace(/\+/g," ")),m)}))}n=il.prototype,n.add=function(c,p){mi(this),this.i=null,c=vo(this,c);let m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(p),this.h+=1,this};function Py(c,p){mi(c),p=vo(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function Ny(c,p){return mi(c),p=vo(c,p),c.g.has(p)}n.forEach=function(c,p){mi(this),this.g.forEach(function(m,y){m.forEach(function(O){c.call(p,O,y,this)},this)},this)};function ky(c,p){mi(c);let m=[];if(typeof p=="string")Ny(c,p)&&(m=m.concat(c.g.get(vo(c,p))));else for(c=Array.from(c.g.values()),p=0;p<c.length;p++)m=m.concat(c[p]);return m}n.set=function(c,p){return mi(this),this.i=null,c=vo(this,c),Ny(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=ky(this,c),c.length>0?String(c[0]):p):p};function xy(c,p,m){Py(c,p),m.length>0&&(c.i=null,c.g.set(vo(c,p),_(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(let y=0;y<p.length;y++){var m=p[y];const O=Za(m);m=ky(this,m);for(let F=0;F<m.length;F++){let ne=O;m[F]!==""&&(ne+="="+Za(m[F])),c.push(ne)}}return this.i=c.join("&")};function Dy(c){const p=new il;return p.i=c.i,c.g&&(p.g=new Map(c.g),p.h=c.h),p}function vo(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function a0(c,p){p&&!c.j&&(mi(c),c.i=null,c.g.forEach(function(m,y){const O=y.toLowerCase();y!=O&&(Py(this,y),xy(this,O,m))},c)),c.j=p}function l0(c,p){const m=new Xa;if(o.Image){const y=new Image;y.onload=h(pr,m,"TestLoadImage: loaded",!0,p,y),y.onerror=h(pr,m,"TestLoadImage: error",!1,p,y),y.onabort=h(pr,m,"TestLoadImage: abort",!1,p,y),y.ontimeout=h(pr,m,"TestLoadImage: timeout",!1,p,y),o.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else p(!1)}function c0(c,p){const m=new Xa,y=new AbortController,O=setTimeout(()=>{y.abort(),pr(m,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:y.signal}).then(F=>{clearTimeout(O),F.ok?pr(m,"TestPingServer: ok",!0,p):pr(m,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(O),pr(m,"TestPingServer: error",!1,p)})}function pr(c,p,m,y,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),y(m)}catch{}}function u0(){this.g=new en}function If(c){this.i=c.Sb||null,this.h=c.ab||!1}d(If,Nn),If.prototype.g=function(){return new _u(this.i,this.h)};function _u(c,p){Q.call(this),this.H=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(_u,Q),n=_u.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=p,this.readyState=1,al(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(p.body=c),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ol(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,al(this)),this.g&&(this.readyState=3,al(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Vy(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Vy(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?ol(this):al(this),this.readyState==3&&Vy(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,ol(this))},n.Na=function(c){this.g&&(this.response=c,ol(this))},n.ga=function(){this.g&&ol(this)};function ol(c){c.readyState=4,c.l=null,c.j=null,c.B=null,al(c)}n.setRequestHeader=function(c,p){this.A.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var m=p.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=p.next();return c.join(`\r
`)};function al(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(_u.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Oy(c){let p="";return re(c,function(m,y){p+=y,p+=":",p+=m,p+=`\r
`}),p}function Tf(c,p,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=Oy(m),typeof c=="string"?m!=null&&Za(m):pt(c,p,m))}function Tt(c){Q.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(Tt,Q);var h0=/^https?$/i,d0=["POST","PUT"];n=Tt.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,p,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_y.g(),this.g.onreadystatechange=f(u(this.Ca,this));try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(F){My(this,F);return}if(c=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var O in y)m.set(O,y[O]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const F of y.keys())m.set(F,y.get(F));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(F=>F.toLowerCase()=="content-type"),O=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(d0,p,void 0)>=0)||y||O||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,ne]of m)this.g.setRequestHeader(F,ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(F){My(this,F)}};function My(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.o=5,Ly(c),gu(c)}function Ly(c){c.A||(c.A=!0,H(c,"complete"),H(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,H(this,"complete"),H(this,"abort"),gu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gu(this,!0)),Tt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Fy(this):this.Xa())},n.Xa=function(){Fy(this)};function Fy(c){if(c.h&&typeof i<"u"){if(c.v&&mr(c)==4)setTimeout(c.Ca.bind(c),0);else if(H(c,"readystatechange"),mr(c)==4){c.h=!1;try{const F=c.ca();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var m;if(!(m=p)){var y;if(y=F===0){let ne=String(c.D).match(Ry)[1]||null;!ne&&o.self&&o.self.location&&(ne=o.self.location.protocol.slice(0,-1)),y=!h0.test(ne?ne.toLowerCase():"")}m=y}if(m)H(c,"complete"),H(c,"success");else{c.o=6;try{var O=mr(c)>2?c.g.statusText:""}catch{O=""}c.l=O+" ["+c.ca()+"]",Ly(c)}}finally{gu(c)}}}}function gu(c,p){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const m=c.g;c.g=null,p||H(c,"ready");try{m.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function mr(c){return c.g?c.g.readyState:0}n.ca=function(){try{return mr(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),Zt(p)}};function Uy(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function f0(c){const p={};c=(c.g&&mr(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(w(c[y]))continue;var m=JP(c[y]);const O=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const F=p[O]||[];p[O]=F,F.push(m)}ft(p,function(y){return y.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ll(c,p,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||p}function By(c){this.za=0,this.i=[],this.j=new Xa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ll("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ll("baseRetryDelayMs",5e3,c),this.Za=ll("retryDelaySeedMs",1e4,c),this.Ta=ll("forwardChannelMaxRetries",2,c),this.va=ll("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Ty(c&&c.concurrentRequestLimit),this.Ba=new u0,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=By.prototype,n.ka=8,n.I=1,n.connect=function(c,p,m,y){mn(0),this.W=c,this.H=p||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.J=Qy(this,null,this.W),vu(this)};function wf(c){if(qy(c),c.I==3){var p=c.V++,m=hs(c.J);if(pt(m,"SID",c.M),pt(m,"RID",p),pt(m,"TYPE","terminate"),cl(c,m),p=new dr(c,c.j,p),p.M=2,p.A=mu(hs(m)),m=!1,o.navigator&&o.navigator.sendBeacon)try{m=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!m&&o.Image&&(new Image().src=p.A,m=!0),m||(p.g=Yy(p.j,null),p.g.ea(p.A)),p.F=Date.now(),pu(p)}Hy(c)}function yu(c){c.g&&(Af(c),c.g.cancel(),c.g=null)}function qy(c){yu(c),c.v&&(o.clearTimeout(c.v),c.v=null),Eu(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function vu(c){if(!wy(c.h)&&!c.m){c.m=!0;var p=c.Ea;G||v(),J||(G(),J=!0),b.add(p,c),c.D=0}}function p0(c,p){return by(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=p.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Ja(u(c.Ea,c,p),zy(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const O=new dr(this,this.j,c);let F=this.o;if(this.U&&(F?(F=pn(F),ue(F,this.U)):F=this.U),this.u!==null||this.R||(O.J=F,F=null),this.S)e:{for(var p=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(p+=y,p>4096){p=m;break e}if(p===4096||m===this.i.length-1){p=m+1;break e}}p=1e3}else p=1e3;p=jy(this,O,p),m=hs(this.J),pt(m,"RID",c),pt(m,"CVER",22),this.G&&pt(m,"X-HTTP-Session-Id",this.G),cl(this,m),F&&(this.R?p="headers="+Za(Oy(F))+"&"+p:this.u&&Tf(m,this.u,F)),vf(this.h,O),this.Ra&&pt(m,"TYPE","init"),this.S?(pt(m,"$req",p),pt(m,"SID","null"),O.U=!0,mf(O,m,null)):mf(O,m,p),this.I=2}}else this.I==3&&(c?$y(this,c):this.i.length==0||wy(this.h)||$y(this))};function $y(c,p){var m;p?m=p.l:m=c.V++;const y=hs(c.J);pt(y,"SID",c.M),pt(y,"RID",m),pt(y,"AID",c.K),cl(c,y),c.u&&c.o&&Tf(y,c.u,c.o),m=new dr(c,c.j,m,c.D+1),c.u===null&&(m.J=c.o),p&&(c.i=p.G.concat(c.i)),p=jy(c,m,1e3),m.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),vf(c.h,m),mf(m,y,p)}function cl(c,p){c.H&&re(c.H,function(m,y){pt(p,y,m)}),c.l&&re({},function(m,y){pt(p,y,m)})}function jy(c,p,m){m=Math.min(c.i.length,m);const y=c.l?u(c.l.Ka,c.l,c):null;e:{var O=c.i;let Ce=-1;for(;;){const Dt=["count="+m];Ce==-1?m>0?(Ce=O[0].g,Dt.push("ofs="+Ce)):Ce=0:Dt.push("ofs="+Ce);let st=!0;for(let qt=0;qt<m;qt++){var F=O[qt].g;const ds=O[qt].map;if(F-=Ce,F<0)Ce=Math.max(0,O[qt].g-100),st=!1;else try{F="req"+F+"_"||"";try{var ne=ds instanceof Map?ds:Object.entries(ds);for(const[gi,_r]of ne){let gr=_r;a(_r)&&(gr=Be(_r)),Dt.push(F+gi+"="+encodeURIComponent(gr))}}catch(gi){throw Dt.push(F+"type="+encodeURIComponent("_badmap")),gi}}catch{y&&y(ds)}}if(st){ne=Dt.join("&");break e}}ne=void 0}return c=c.i.splice(0,m),p.G=c,ne}function Gy(c){if(!c.g&&!c.v){c.Y=1;var p=c.Da;G||v(),J||(G(),J=!0),b.add(p,c),c.A=0}}function bf(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Ja(u(c.Da,c),zy(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,Ky(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Ja(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,mn(10),yu(this),Ky(this))};function Af(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function Ky(c){c.g=new dr(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var p=hs(c.na);pt(p,"RID","rpc"),pt(p,"SID",c.M),pt(p,"AID",c.K),pt(p,"CI",c.F?"0":"1"),!c.F&&c.ia&&pt(p,"TO",c.ia),pt(p,"TYPE","xmlhttp"),cl(c,p),c.u&&c.o&&Tf(p,c.u,c.o),c.O&&(c.g.H=c.O);var m=c.g;c=c.ba,m.M=1,m.A=mu(hs(p)),m.u=null,m.R=!0,vy(m,c)}n.Va=function(){this.C!=null&&(this.C=null,yu(this),bf(this),mn(19))};function Eu(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Wy(c,p){var m=null;if(c.g==p){Eu(c),Af(c),c.g=null;var y=2}else if(yf(c.h,p))m=p.G,Ay(c.h,p),y=1;else return;if(c.I!=0){if(p.o)if(y==1){m=p.u?p.u.length:0,p=Date.now()-p.F;var O=c.D;y=fi(),H(y,new py(y,m)),vu(c)}else Gy(c);else if(O=p.m,O==3||O==0&&p.X>0||!(y==1&&p0(c,p)||y==2&&bf(c)))switch(m&&m.length>0&&(p=c.h,p.i=p.i.concat(m)),O){case 1:_i(c,5);break;case 4:_i(c,10);break;case 3:_i(c,6);break;default:_i(c,2)}}}function zy(c,p){let m=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(m*=2),m*p}function _i(c,p){if(c.j.info("Error code "+p),p==2){var m=u(c.bb,c),y=c.Ua;const O=!y;y=new fr(y||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||tl(y,"https"),mu(y),O?l0(y.toString(),m):c0(y.toString(),m)}else mn(2);c.I=0,c.l&&c.l.pa(p),Hy(c),qy(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),mn(2)):(this.j.info("Failed to ping google.com"),mn(1))};function Hy(c){if(c.I=0,c.ja=[],c.l){const p=Sy(c.h);(p.length!=0||c.i.length!=0)&&(E(c.ja,p),E(c.ja,c.i),c.h.i.length=0,_(c.i),c.i.length=0),c.l.oa()}}function Qy(c,p,m){var y=m instanceof fr?hs(m):new fr(m);if(y.g!="")p&&(y.g=p+"."+y.g),nl(y,y.u);else{var O=o.location;y=O.protocol,p=p?p+"."+O.hostname:O.hostname,O=+O.port;const F=new fr(null);y&&tl(F,y),p&&(F.g=p),O&&nl(F,O),m&&(F.h=m),y=F}return m=c.G,p=c.wa,m&&p&&pt(y,m,p),pt(y,"VER",c.ka),cl(c,y),y}function Yy(c,p,m){if(p&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Aa&&!c.ma?new Tt(new If({ab:m})):new Tt(c.ma),p.Fa(c.L),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Jy(){}n=Jy.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Iu(){}Iu.prototype.g=function(c,p){return new xn(c,p)};function xn(c,p){Q.call(this),this.g=new By(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(c?c["X-WebChannel-Client-Profile"]=p.sa:c={"X-WebChannel-Client-Profile":p.sa}),this.g.U=c,(c=p&&p.Qb)&&!w(c)&&(this.g.u=c),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!w(p)&&(this.g.G=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new Eo(this)}d(xn,Q),xn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xn.prototype.close=function(){wf(this.g)},xn.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.v&&(m={},m.__data__=Be(c),c=m);p.i.push(new e0(p.Ya++,c)),p.I==3&&vu(p)},xn.prototype.N=function(){this.g.l=null,delete this.j,wf(this.g),delete this.g,xn.Z.N.call(this)};function Xy(c){go.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const m in p){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}d(Xy,go);function Zy(){zt.call(this),this.status=1}d(Zy,zt);function Eo(c){this.g=c}d(Eo,Jy),Eo.prototype.ra=function(){H(this.g,"a")},Eo.prototype.qa=function(c){H(this.g,new Xy(c))},Eo.prototype.pa=function(c){H(this.g,new Zy)},Eo.prototype.oa=function(){H(this.g,"b")},Iu.prototype.createWebChannel=Iu.prototype.g,xn.prototype.send=xn.prototype.o,xn.prototype.open=xn.prototype.m,xn.prototype.close=xn.prototype.close,uS=function(){return new Iu},cS=function(){return fi()},lS=Bt,Kp={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},fu.NO_ERROR=0,fu.TIMEOUT=8,fu.HTTP_ERROR=6,Ju=fu,my.COMPLETE="complete",aS=my,kn.EventType=Wn,Wn.OPEN="a",Wn.CLOSE="b",Wn.ERROR="c",Wn.MESSAGE="d",Q.prototype.listen=Q.prototype.J,Rl=kn,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,oS=Tt}).apply(typeof Pu<"u"?Pu:typeof self<"u"?self:typeof window<"u"?window:{});const GE="@firebase/firestore",KE="4.9.3";class Gt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Gt.UNAUTHENTICATED=new Gt(null),Gt.GOOGLE_CREDENTIALS=new Gt("google-credentials-uid"),Gt.FIRST_PARTY=new Gt("first-party-uid"),Gt.MOCK_USER=new Gt("mock-user");let Ma="12.7.0";const Hr=new wd("@firebase/firestore");function No(){return Hr.logLevel}function DL(n){Hr.setLogLevel(n)}function W(n,...e){if(Hr.logLevel<=De.DEBUG){const t=e.map($_);Hr.debug(`Firestore (${Ma}): ${n}`,...t)}}function St(n,...e){if(Hr.logLevel<=De.ERROR){const t=e.map($_);Hr.error(`Firestore (${Ma}): ${n}`,...t)}}function Fn(n,...e){if(Hr.logLevel<=De.WARN){const t=e.map($_);Hr.warn(`Firestore (${Ma}): ${n}`,...t)}}function $_(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function de(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,hS(n,s,t)}function hS(n,e,t){let s=`FIRESTORE (${Ma}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw St(s),new Error(s)}function pe(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||hS(e,r,s)}function VL(n,e){n||de(57014,e)}function te(n,e){return n}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends ir{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class dS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Gt.UNAUTHENTICATED)))}shutdown(){}}class OL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ML{constructor(e){this.t=e,this.currentUser=Gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pe(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new Wt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Wt,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},a=l=>{W("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(W("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Wt)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(W("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(pe(typeof s.accessToken=="string",31837,{l:s}),new dS(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(e===null||typeof e=="string",2055,{h:e}),new Gt(e)}}class LL{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Gt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class FL{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new LL(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Gt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Wp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class UL{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Bn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){pe(this.o===void 0,3512);const s=i=>{i.error!=null&&W("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,W("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{W("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):W("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Wp(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(pe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Wp(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class BL{getToken(){return Promise.resolve(new Wp(""))}invalidateToken(){}start(e,t){}shutdown(){}}function qL(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Vd{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=qL(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Ie(n,e){return n<e?-1:n>e?1:0}function zp(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return Jf(r)===Jf(i)?Ie(r,i):Jf(r)?1:-1}return Ie(n.length,e.length)}const $L=55296,jL=57343;function Jf(n){const e=n.charCodeAt(0);return e>=$L&&e<=jL}function aa(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}function pS(n){return n+"\0"}const Hp="__name__";class ms{constructor(e,t,s){t===void 0?t=0:t>e.length&&de(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&de(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return ms.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ms?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=ms.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Ie(e.length,t.length)}static compareSegments(e,t){const s=ms.isNumericId(e),r=ms.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?ms.extractNumericId(e).compare(ms.extractNumericId(t)):zp(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return $r.fromString(e.substring(4,e.length-2))}}class Ne extends ms{construct(e,t,s){return new Ne(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Ne(t)}static emptyPath(){return new Ne([])}}const GL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gt extends ms{construct(e,t,s){return new gt(e,t,s)}static isValidIdentifier(e){return GL.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Hp}static keyField(){return new gt([Hp])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new B(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new B(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new B(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gt(t)}static emptyPath(){return new gt([])}}class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Ne.fromString(e))}static fromName(e){return new ee(Ne.fromString(e).popFirst(5))}static empty(){return new ee(Ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Ne(e.slice()))}}function j_(n,e,t){if(!t)throw new B(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mS(n,e,t,s){if(e===!0&&s===!0)throw new B(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function WE(n){if(!ee.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function zE(n){if(ee.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _S(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Od(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":de(12329,{type:typeof n})}function ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Od(n);throw new B(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function gS(n,e){if(e<=0)throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Nt(n,e){const t={typeString:n};return e&&(t.value=e),t}function uo(n,e){if(!_S(n))throw new B(M.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new B(M.INVALID_ARGUMENT,t);return!0}const HE=-62135596800,QE=1e6;class Qe{static now(){return Qe.fromMillis(Date.now())}static fromDate(e){return Qe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*QE);return new Qe(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<HE)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/QE}_compareTo(e){return this.seconds===e.seconds?Ie(this.nanoseconds,e.nanoseconds):Ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(uo(e,Qe._jsonSchema))return new Qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-HE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qe._jsonSchemaVersion="firestore/timestamp/1.0",Qe._jsonSchema={type:Nt("string",Qe._jsonSchemaVersion),seconds:Nt("number"),nanoseconds:Nt("number")};class me{static fromTimestamp(e){return new me(e)}static min(){return new me(new Qe(0,0))}static max(){return new me(new Qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const la=-1;class ca{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function Qp(n){return n.fields.find((e=>e.kind===2))}function bi(n){return n.fields.filter((e=>e.kind!==2))}function KL(n,e){let t=Ie(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let s=0;s<Math.min(n.fields.length,e.fields.length);++s)if(t=WL(n.fields[s],e.fields[s]),t!==0)return t;return Ie(n.fields.length,e.fields.length)}ca.UNKNOWN_ID=-1;class Ui{constructor(e,t){this.fieldPath=e,this.kind=t}}function WL(n,e){const t=gt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ie(n.kind,e.kind)}class ua{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ua(0,Un.min())}}function yS(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=me.fromTimestamp(s===1e9?new Qe(t+1,0):new Qe(t,s));return new Un(r,ee.empty(),e)}function vS(n){return new Un(n.readTime,n.key,la)}class Un{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Un(me.min(),ee.empty(),la)}static max(){return new Un(me.max(),ee.empty(),la)}}function G_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ee.comparator(n.documentKey,e.documentKey),t!==0?t:Ie(n.largestBatchId,e.largestBatchId))}const ES="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class IS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function si(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==ES)throw n;W("LocalStore","Unexpectedly lost primary lease")}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&de(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):D.reject(t)}static resolve(e){return new D(((t,s)=>{t(e)}))}static reject(e){return new D(((t,s)=>{s(e)}))}static waitFor(e){return new D(((t,s)=>{let r=0,i=0,o=!1;e.forEach((a=>{++r,a.next((()=>{++i,o&&i===r&&t()}),(l=>s(l)))})),o=!0,i===r&&t()}))}static or(e){let t=D.resolve(!1);for(const s of e)t=t.next((r=>r?D.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new D(((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new D(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}const On="SimpleDb";class Md{static open(e,t,s,r){try{return new Md(t,e.transaction(r,s))}catch(i){throw new Kl(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Wt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Kl(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=K_(s.target.error);this.S.reject(new Kl(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(W(On,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new HL(t)}}class As{static delete(e){return W(On,"Removing database:",e),Si(Jw().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!ab())return!1;if(As.F())return!0;const e=Mt(),t=As.M(e),s=0<t&&t<10,r=TS(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,As.M(Mt())===12.2&&St("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(W(On,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{s(new Kl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new B(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new B(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Kl(e,o))},r.onupgradeneeded=i=>{W(On,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,r.transaction,i.oldVersion,this.version).next((()=>{W(On,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Md.open(this.db,e,i?"readonly":"readwrite",s),l=r(a).next((u=>(a.C(),u))).catch((u=>(a.abort(u),D.reject(u)))).toPromise();return l.catch((()=>{})),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(W(On,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function TS(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class zL{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Si(this.U.delete())}}class Kl extends B{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ri(n){return n.name==="IndexedDbTransactionError"}class HL{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(W(On,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(W(On,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),Si(s)}add(e){return W(On,"ADD",this.store.name,e,e),Si(this.store.add(e))}get(e){return Si(this.store.get(e)).next((t=>(t===void 0&&(t=null),W(On,"GET",this.store.name,e,t),t)))}delete(e){return W(On,"DELETE",this.store.name,e),Si(this.store.delete(e))}count(){return W(On,"COUNT",this.store.name),Si(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new D(((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(s),o=[];return this.H(i,((a,l)=>{o.push(l)})).next((()=>o))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new D(((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}}))}Z(e,t){W(On,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,((i,o,a)=>a.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new D(((s,r)=>{t.onerror=i=>{const o=K_(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((a=>{a?o.continue():s()})):s()}}))}H(e,t){const s=[];return new D(((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new zL(a),u=t(a.primaryKey,a.value,l);if(u instanceof D){const h=u.catch((d=>(l.done(),D.reject(d))));s.push(h)}l.isDone?r():l.G===null?a.continue():a.continue(l.G)}})).next((()=>D.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Si(n){return new D(((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=K_(s.target.error);t(r)}}))}let YE=!1;function K_(n){const e=As.M(Mt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return YE||(YE=!0,setTimeout((()=>{throw s}),0)),s}}return n}const Wl="IndexBackfiller";class QL{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){W(Wl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();W(Wl,`Documents written: ${t}`)}catch(t){ri(t)?W(Wl,"Ignoring IndexedDB error during index backfill: ",t):await si(t)}await this.re(6e4)}))}}class YL{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let r=t,i=!0;return D.doWhile((()=>i===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!s.has(o))return W(Wl,`Processing collection: ${o}`),this.oe(e,o,r).next((a=>{r-=a,s.add(o)}));i=!1})))).next((()=>t-r))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(r,i))).next((a=>(W(Wl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a)))).next((()=>o.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((r,i)=>{const o=vS(i);G_(o,s)>0&&(s=o)})),new Un(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}class wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}wn.ce=-1;const jr=-1;function Yc(n){return n==null}function Ic(n){return n===0&&1/n==-1/0}function wS(n){return typeof n=="number"&&Number.isInteger(n)&&!Ic(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const qh="";function un(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=JE(e)),e=JL(n.get(t),e);return JE(e)}function JL(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case qh:t+="";break;default:t+=i}}return t}function JE(n){return n+qh+""}function vs(n){const e=n.length;if(pe(e>=2,64408,{path:n}),e===2)return pe(n.charAt(0)===qh&&n.charAt(1)==="",56145,{path:n}),Ne.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf(qh,i);switch((o<0||o>t)&&de(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;r.length===0?l=a:(r+=a,l=r,r=""),s.push(l);break;case"":r+=n.substring(i,o),r+="\0";break;case"":r+=n.substring(i,o+1);break;default:de(61167,{path:n})}i=o+2}return new Ne(s)}const Ai="remoteDocuments",Jc="owner",wo="owner",Tc="mutationQueues",XL="userId",Hn="mutations",XE="batchId",Di="userMutationsIndex",ZE=["userId","batchId"];function Xu(n,e){return[n,un(e)]}function bS(n,e,t){return[n,un(e),t]}const ZL={},ha="documentMutations",$h="remoteDocumentsV14",eF=["prefixPath","collectionGroup","readTime","documentId"],Zu="documentKeyIndex",tF=["prefixPath","collectionGroup","documentId"],AS="collectionGroupIndex",nF=["collectionGroup","readTime","prefixPath","documentId"],wc="remoteDocumentGlobal",Yp="remoteDocumentGlobalKey",da="targets",SS="queryTargetsIndex",sF=["canonicalId","targetId"],fa="targetDocuments",rF=["targetId","path"],W_="documentTargetsIndex",iF=["path","targetId"],jh="targetGlobalKey",Bi="targetGlobal",bc="collectionParents",oF=["collectionId","parent"],pa="clientMetadata",aF="clientId",Ld="bundles",lF="bundleId",Fd="namedQueries",cF="name",z_="indexConfiguration",uF="indexId",Jp="collectionGroupIndex",hF="collectionGroup",zl="indexState",dF=["indexId","uid"],RS="sequenceNumberIndex",fF=["uid","sequenceNumber"],Hl="indexEntries",pF=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],CS="documentKeyIndex",mF=["indexId","uid","orderedDocumentKey"],Ud="documentOverlays",_F=["userId","collectionPath","documentId"],Xp="collectionPathOverlayIndex",gF=["userId","collectionPath","largestBatchId"],PS="collectionGroupOverlayIndex",yF=["userId","collectionGroup","largestBatchId"],H_="globals",vF="name",NS=[Tc,Hn,ha,Ai,da,Jc,Bi,fa,pa,wc,bc,Ld,Fd],EF=[...NS,Ud],kS=[Tc,Hn,ha,$h,da,Jc,Bi,fa,pa,wc,bc,Ld,Fd,Ud],xS=kS,Q_=[...xS,z_,zl,Hl],IF=Q_,DS=[...Q_,H_],TF=DS;class Zp extends IS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ft(n,e){const t=te(n);return As.O(t.le,e)}function eI(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ii(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function VS(n,e){const t=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.push(e(n[s],s,n));return t}function OS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class dt{constructor(e,t){this.comparator=e,this.root=t||Ht.EMPTY}insert(e,t){return new dt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(e){return new dt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nu(this.root,e,this.comparator,!0)}}class Nu{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ht{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ht.RED,this.left=r??Ht.EMPTY,this.right=i??Ht.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Ht(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ht.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ht.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ht.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ht.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw de(43730,{key:this.key,value:this.value});if(this.right.isRed())throw de(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw de(27949);return e+(this.isRed()?0:1)}}Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1;Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw de(57766)}get value(){throw de(16141)}get color(){throw de(16727)}get left(){throw de(29726)}get right(){throw de(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ze{constructor(e){this.comparator=e,this.data=new dt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tI(this.data.getIterator())}getIteratorFrom(e){return new tI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ze)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ze(this.comparator);return t.data=e,t}}class tI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function bo(n){return n.hasNext()?n.getNext():void 0}class bn{constructor(e){this.fields=e,e.sort(gt.comparator)}static empty(){return new bn([])}unionWith(e){let t=new Ze(gt.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new bn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return aa(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class MS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function wF(){return typeof atob<"u"}class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new MS("Invalid base64 string: "+i):i}})(e);return new It(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const bF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tr(n){if(pe(!!n,39018),typeof n=="string"){let e=0;const t=bF.exec(n);if(pe(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function nr(n){return typeof n=="string"?It.fromBase64String(n):It.fromUint8Array(n)}const LS="server_timestamp",FS="__type__",US="__previous_value__",BS="__local_write_time__";function Bd(n){return(n?.mapValue?.fields||{})[FS]?.stringValue===LS}function qd(n){const e=n.mapValue.fields[US];return Bd(e)?qd(e):e}function Ac(n){const e=tr(n.mapValue.fields[BS].timestampValue);return new Qe(e.seconds,e.nanos)}class AF{constructor(e,t,s,r,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Sc="(default)";class Qr{constructor(e,t){this.projectId=e,this.database=t||Sc}static empty(){return new Qr("","")}get isDefaultDatabase(){return this.database===Sc}isEqual(e){return e instanceof Qr&&e.projectId===this.projectId&&e.database===this.database}}const Y_="__type__",qS="__max__",Or={mapValue:{fields:{__type__:{stringValue:qS}}}},J_="__vector__",ma="value",eh={nullValue:"NULL_VALUE"};function Yr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bd(n)?4:$S(n)?9007199254740991:$d(n)?10:11:de(28295,{value:n})}function Ps(n,e){if(n===e)return!0;const t=Yr(n);if(t!==Yr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ac(n).isEqual(Ac(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=tr(r.timestampValue),a=tr(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return nr(r.bytesValue).isEqual(nr(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return yt(r.geoPointValue.latitude)===yt(i.geoPointValue.latitude)&&yt(r.geoPointValue.longitude)===yt(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return yt(r.integerValue)===yt(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=yt(r.doubleValue),a=yt(i.doubleValue);return o===a?Ic(o)===Ic(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return aa(n.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(eI(o)!==eI(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ps(o[l],a[l])))return!1;return!0})(n,e);default:return de(52216,{left:n})}}function Rc(n,e){return(n.values||[]).find((t=>Ps(t,e)))!==void 0}function Jr(n,e){if(n===e)return 0;const t=Yr(n),s=Yr(e);if(t!==s)return Ie(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ie(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=yt(i.integerValue||i.doubleValue),l=yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return nI(n.timestampValue,e.timestampValue);case 4:return nI(Ac(n),Ac(e));case 5:return zp(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=nr(i),l=nr(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Ie(a[u],l[u]);if(h!==0)return h}return Ie(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=Ie(yt(i.latitude),yt(o.latitude));return a!==0?a:Ie(yt(i.longitude),yt(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return sI(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const a=i.fields||{},l=o.fields||{},u=a[ma]?.arrayValue,h=l[ma]?.arrayValue,d=Ie(u?.values?.length||0,h?.values?.length||0);return d!==0?d:sI(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===Or.mapValue&&o===Or.mapValue)return 0;if(i===Or.mapValue)return 1;if(o===Or.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const f=zp(l[d],h[d]);if(f!==0)return f;const _=Jr(a[l[d]],u[h[d]]);if(_!==0)return _}return Ie(l.length,h.length)})(n.mapValue,e.mapValue);default:throw de(23264,{he:t})}}function nI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ie(n,e);const t=tr(n),s=tr(e),r=Ie(t.seconds,s.seconds);return r!==0?r:Ie(t.nanos,s.nanos)}function sI(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Jr(t[r],s[r]);if(i)return i}return Ie(t.length,s.length)}function _a(n){return em(n)}function em(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=tr(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return nr(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return ee.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=em(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${em(t.fields[o])}`;return r+"}"})(n.mapValue):de(61005,{value:n})}function th(n){switch(Yr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=qd(n);return e?16+th(e):16;case 5:return 2*n.stringValue.length;case 6:return nr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+th(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return ii(s.fields,((i,o)=>{r+=i.length+th(o)})),r})(n.mapValue);default:throw de(13486,{value:n})}}function Yi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function tm(n){return!!n&&"integerValue"in n}function Cc(n){return!!n&&"arrayValue"in n}function rI(n){return!!n&&"nullValue"in n}function iI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function nh(n){return!!n&&"mapValue"in n}function $d(n){return(n?.mapValue?.fields||{})[Y_]?.stringValue===J_}function Ql(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ii(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Ql(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ql(n.arrayValue.values[t]);return e}return{...n}}function $S(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qS}const jS={mapValue:{fields:{[Y_]:{stringValue:J_},[ma]:{arrayValue:{}}}}};function SF(n){return"nullValue"in n?eh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Yi(Qr.empty(),ee.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?$d(n)?jS:{mapValue:{}}:de(35942,{value:n})}function RF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Yi(Qr.empty(),ee.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?jS:"mapValue"in n?$d(n)?{mapValue:{}}:Or:de(61959,{value:n})}function oI(n,e){const t=Jr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function aI(n,e){const t=Jr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Yt{constructor(e){this.value=e}static empty(){return new Yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!nh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ql(t)}setAll(e){let t=gt.emptyPath(),s={},r=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=Ql(o):r.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());nh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];nh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){ii(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new Yt(Ql(this.value))}}function GS(n){const e=[];return ii(n.fields,((t,s)=>{const r=new gt([t]);if(nh(s)){const i=GS(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new bn(e)}class _t{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _t(e,0,me.min(),me.min(),me.min(),Yt.empty(),0)}static newFoundDocument(e,t,s,r){return new _t(e,1,t,me.min(),s,r,0)}static newNoDocument(e,t){return new _t(e,2,t,me.min(),me.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,me.min(),me.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xr{constructor(e,t){this.position=e,this.inclusive=t}}function lI(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=ee.comparator(ee.fromName(o.referenceValue),t.key):s=Jr(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function cI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ps(n.position[t],e.position[t]))return!1;return!0}class Pc{constructor(e,t="asc"){this.field=e,this.dir=t}}function CF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class KS{}class Le extends KS{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new PF(e,t,s):t==="array-contains"?new xF(e,s):t==="in"?new JS(e,s):t==="not-in"?new DF(e,s):t==="array-contains-any"?new VF(e,s):new Le(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new NF(e,s):new kF(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Jr(t,this.value)):t!==null&&Yr(this.value)===Yr(t)&&this.matchesComparison(Jr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Je extends KS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Je(e,t)}matches(e){return ga(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ga(n){return n.op==="and"}function nm(n){return n.op==="or"}function X_(n){return WS(n)&&ga(n)}function WS(n){for(const e of n.filters)if(e instanceof Je)return!1;return!0}function sm(n){if(n instanceof Le)return n.field.canonicalString()+n.op.toString()+_a(n.value);if(X_(n))return n.filters.map((e=>sm(e))).join(",");{const e=n.filters.map((t=>sm(t))).join(",");return`${n.op}(${e})`}}function zS(n,e){return n instanceof Le?(function(s,r){return r instanceof Le&&s.op===r.op&&s.field.isEqual(r.field)&&Ps(s.value,r.value)})(n,e):n instanceof Je?(function(s,r){return r instanceof Je&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,a)=>i&&zS(o,r.filters[a])),!0):!1})(n,e):void de(19439)}function HS(n,e){const t=n.filters.concat(e);return Je.create(t,n.op)}function QS(n){return n instanceof Le?(function(t){return`${t.field.canonicalString()} ${t.op} ${_a(t.value)}`})(n):n instanceof Je?(function(t){return t.op.toString()+" {"+t.getFilters().map(QS).join(" ,")+"}"})(n):"Filter"}class PF extends Le{constructor(e,t,s){super(e,t,s),this.key=ee.fromName(s.referenceValue)}matches(e){const t=ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class NF extends Le{constructor(e,t){super(e,"in",t),this.keys=YS("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class kF extends Le{constructor(e,t){super(e,"not-in",t),this.keys=YS("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function YS(n,e){return(e.arrayValue?.values||[]).map((t=>ee.fromName(t.referenceValue)))}class xF extends Le{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cc(t)&&Rc(t.arrayValue,this.value)}}class JS extends Le{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Rc(this.value.arrayValue,t)}}class DF extends Le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Rc(this.value.arrayValue,t)}}class VF extends Le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Rc(this.value.arrayValue,s)))}}class OF{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function rm(n,e=null,t=[],s=[],r=null,i=null,o=null){return new OF(n,e,t,s,r,i,o)}function Ji(n){const e=te(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>sm(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Yc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>_a(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>_a(s))).join(",")),e.Te=t}return e.Te}function Xc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!CF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!zS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cI(n.startAt,e.startAt)&&cI(n.endAt,e.endAt)}function Gh(n){return ee.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Kh(n,e){return n.filters.filter((t=>t instanceof Le&&t.field.isEqual(e)))}function uI(n,e,t){let s=eh,r=!0;for(const i of Kh(n,e)){let o=eh,a=!0;switch(i.op){case"<":case"<=":o=SF(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=eh}oI({value:s,inclusive:r},{value:o,inclusive:a})<0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];oI({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function hI(n,e,t){let s=Or,r=!0;for(const i of Kh(n,e)){let o=Or,a=!0;switch(i.op){case">=":case">":o=RF(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Or}aI({value:s,inclusive:r},{value:o,inclusive:a})>0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];aI({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}class ar{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XS(n,e,t,s,r,i,o,a){return new ar(n,e,t,s,r,i,o,a)}function La(n){return new ar(n)}function dI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Z_(n){return n.collectionGroup!==null}function Ho(n){const e=te(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ze(gt.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Pc(i,s))})),t.has(gt.keyField().canonicalString())||e.Ie.push(new Pc(gt.keyField(),s))}return e.Ie}function hn(n){const e=te(n);return e.Ee||(e.Ee=eR(e,Ho(n))),e.Ee}function ZS(n){const e=te(n);return e.de||(e.de=eR(e,n.explicitOrderBy)),e.de}function eR(n,e){if(n.limitType==="F")return rm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new Pc(r.field,i)}));const t=n.endAt?new Xr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Xr(n.startAt.position,n.startAt.inclusive):null;return rm(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function im(n,e){const t=n.filters.concat([e]);return new ar(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Wh(n,e,t){return new ar(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zc(n,e){return Xc(hn(n),hn(e))&&n.limitType===e.limitType}function tR(n){return`${Ji(hn(n))}|lt:${n.limitType}`}function ko(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>QS(r))).join(", ")}]`),Yc(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>_a(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>_a(r))).join(",")),`Target(${s})`})(hn(n))}; limitType=${n.limitType})`}function eu(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):ee.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of Ho(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,a,l){const u=lI(o,a,l);return o.inclusive?u<=0:u<0})(s.startAt,Ho(s),r)||s.endAt&&!(function(o,a,l){const u=lI(o,a,l);return o.inclusive?u>=0:u>0})(s.endAt,Ho(s),r))})(n,e)}function nR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function sR(n){return(e,t)=>{let s=!1;for(const r of Ho(n)){const i=MF(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function MF(n,e,t){const s=n.field.isKeyField()?ee.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Jr(l,u):de(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return de(19790,{direction:n.dir})}}class lr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ii(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return OS(this.inner)}size(){return this.innerSize}}const LF=new dt(ee.comparator);function An(){return LF}const rR=new dt(ee.comparator);function Cl(...n){let e=rR;for(const t of n)e=e.insert(t.key,t);return e}function iR(n){let e=rR;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Es(){return Yl()}function oR(){return Yl()}function Yl(){return new lr((n=>n.toString()),((n,e)=>n.isEqual(e)))}const FF=new dt(ee.comparator),UF=new Ze(ee.comparator);function Re(...n){let e=UF;for(const t of n)e=e.add(t);return e}const BF=new Ze(Ie);function eg(){return BF}function tg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ic(e)?"-0":e}}function aR(n){return{integerValue:""+n}}function lR(n,e){return wS(e)?aR(e):tg(n,e)}class jd{constructor(){this._=void 0}}function qF(n,e,t){return n instanceof ya?(function(r,i){const o={fields:{[FS]:{stringValue:LS},[BS]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&Bd(i)&&(i=qd(i)),i&&(o.fields[US]=i),{mapValue:o}})(t,e):n instanceof Xi?uR(n,e):n instanceof Zi?hR(n,e):(function(r,i){const o=cR(r,i),a=fI(o)+fI(r.Ae);return tm(o)&&tm(r.Ae)?aR(a):tg(r.serializer,a)})(n,e)}function $F(n,e,t){return n instanceof Xi?uR(n,e):n instanceof Zi?hR(n,e):t}function cR(n,e){return n instanceof va?(function(s){return tm(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class ya extends jd{}class Xi extends jd{constructor(e){super(),this.elements=e}}function uR(n,e){const t=dR(e);for(const s of n.elements)t.some((r=>Ps(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Zi extends jd{constructor(e){super(),this.elements=e}}function hR(n,e){let t=dR(e);for(const s of n.elements)t=t.filter((r=>!Ps(r,s)));return{arrayValue:{values:t}}}class va extends jd{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function fI(n){return yt(n.integerValue||n.doubleValue)}function dR(n){return Cc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class tu{constructor(e,t){this.field=e,this.transform=t}}function jF(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Xi&&r instanceof Xi||s instanceof Zi&&r instanceof Zi?aa(s.elements,r.elements,Ps):s instanceof va&&r instanceof va?Ps(s.Ae,r.Ae):s instanceof ya&&r instanceof ya})(n.transform,e.transform)}class GF{constructor(e,t){this.version=e,this.transformResults=t}}class vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vt}static exists(e){return new vt(void 0,e)}static updateTime(e){return new vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Gd{}function fR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ua(n.key,vt.none()):new Fa(n.key,n.data,vt.none());{const t=n.data,s=Yt.empty();let r=new Ze(gt.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new cr(n.key,s,new bn(r.toArray()),vt.none())}}function KF(n,e,t){n instanceof Fa?(function(r,i,o){const a=r.value.clone(),l=mI(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof cr?(function(r,i,o){if(!sh(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=mI(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(pR(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Jl(n,e,t,s){return n instanceof Fa?(function(i,o,a,l){if(!sh(i.precondition,o))return a;const u=i.value.clone(),h=_I(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,s):n instanceof cr?(function(i,o,a,l){if(!sh(i.precondition,o))return a;const u=_I(i.fieldTransforms,l,o),h=o.data;return h.setAll(pR(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((d=>d.field)))})(n,e,t,s):(function(i,o,a){return sh(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function WF(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=cR(s.transform,r||null);i!=null&&(t===null&&(t=Yt.empty()),t.set(s.field,i))}return t||null}function pI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&aa(s,r,((i,o)=>jF(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fa extends Gd{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class cr extends Gd{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function pR(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function mI(n,e,t){const s=new Map;pe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,$F(o,a,t[r]))}return s}function _I(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,qF(i,o,e))}return s}class Ua extends Gd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ng extends Gd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sg{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&KF(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Jl(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Jl(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=oR();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=fR(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(me.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Re())}isEqual(e){return this.batchId===e.batchId&&aa(this.mutations,e.mutations,((t,s)=>pI(t,s)))&&aa(this.baseMutations,e.baseMutations,((t,s)=>pI(t,s)))}}class rg{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){pe(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return FF})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new rg(e,t,s,r)}}class ig{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class mR{constructor(e,t,s){this.alias=e,this.aggregateType=t,this.fieldPath=s}}class zF{constructor(e,t){this.count=e,this.unchangedNames=t}}var Pt,Ue;function _R(n){switch(n){case M.OK:return de(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return de(15467,{code:n})}}function gR(n){if(n===void 0)return St("GRPC error has no .code"),M.UNKNOWN;switch(n){case Pt.OK:return M.OK;case Pt.CANCELLED:return M.CANCELLED;case Pt.UNKNOWN:return M.UNKNOWN;case Pt.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Pt.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Pt.INTERNAL:return M.INTERNAL;case Pt.UNAVAILABLE:return M.UNAVAILABLE;case Pt.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Pt.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Pt.NOT_FOUND:return M.NOT_FOUND;case Pt.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Pt.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Pt.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Pt.ABORTED:return M.ABORTED;case Pt.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Pt.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Pt.DATA_LOSS:return M.DATA_LOSS;default:return de(39323,{code:n})}}(Ue=Pt||(Pt={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";let om=null;function yR(){return new TextEncoder}const HF=new $r([4294967295,4294967295],0);function gI(n){const e=yR().encode(n),t=new iS;return t.update(e),new Uint8Array(t.digest())}function yI(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new $r([t,s],0),new $r([r,i],0)]}class og{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Pl(`Invalid padding: ${t}`);if(s<0)throw new Pl(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Pl(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Pl(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=$r.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply($r.fromNumber(s)));return r.compare(HF)===1&&(r=new $r([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=gI(e),[s,r]=yI(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new og(i,r,t);return s.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=gI(e),[s,r]=yI(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Pl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class nu{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,su.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new nu(me.min(),r,new dt(Ie),An(),Re())}}class su{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new su(s,t,Re(),Re(),Re())}}class rh{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class vR{constructor(e,t){this.targetId=e,this.Ce=t}}class ER{constructor(e,t,s=It.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class vI{constructor(){this.ve=0,this.Fe=EI(),this.Me=It.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Re(),t=Re(),s=Re();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:de(38017,{changeType:i})}})),new su(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=EI()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,pe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class QF{constructor(e){this.Ge=e,this.ze=new Map,this.je=An(),this.Je=ku(),this.He=ku(),this.Ye=new dt(Ie)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:de(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Gh(i))if(s===0){const o=new ee(i.path);this.et(t,o,_t.newNoDocument(o,me.min()))}else pe(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}om?.lt((function(h,d,f,_,E){const T={localCacheCount:h,existenceFilterCount:d.count,databaseId:f.database,projectId:f.projectId},C=d.unchangedNames;return C&&(T.bloomFilter={applied:E===0,hashCount:C?.hashCount??0,bitmapLength:C?.bits?.bitmap?.length??0,padding:C?.bits?.padding??0,mightContain:L=>_?.mightContain(L)??!1}),T})(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=nr(s).toUint8Array()}catch(l){if(l instanceof MS)return Fn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new og(o,r,i)}catch(l){return Fn(l instanceof Pl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Gh(a.target)){const l=new ee(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,_t.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=Re();this.He.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new nu(e,t,this.Ye,this.je,s);return this.je=An(),this.Je=ku(),this.He=ku(),this.Ye=new dt(Ie),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new vI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ze(Ie),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ze(Ie),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||W("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new vI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ku(){return new dt(ee.comparator)}function EI(){return new dt(ee.comparator)}const YF={asc:"ASCENDING",desc:"DESCENDING"},JF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XF={and:"AND",or:"OR"};class ZF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function am(n,e){return n.useProto3Json||Yc(e)?e:{value:e}}function Ea(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function IR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function e2(n,e){return Ea(n,e.toTimestamp())}function Rt(n){return pe(!!n,49232),me.fromTimestamp((function(t){const s=tr(t);return new Qe(s.seconds,s.nanos)})(n))}function ag(n,e){return lm(n,e).canonicalString()}function lm(n,e){const t=(function(r){return new Ne(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function TR(n){const e=Ne.fromString(n);return pe(kR(e),10190,{key:e.toString()}),e}function Nc(n,e){return ag(n.databaseId,e.path)}function Ss(n,e){const t=TR(e);if(t.get(1)!==n.databaseId.projectId)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ee(AR(t))}function wR(n,e){return ag(n.databaseId,e)}function bR(n){const e=TR(n);return e.length===4?Ne.emptyPath():AR(e)}function cm(n){return new Ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function AR(n){return pe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function II(n,e,t){return{name:Nc(n,e),fields:t.value.mapValue.fields}}function Kd(n,e,t){const s=Ss(n,e.name),r=Rt(e.updateTime),i=e.createTime?Rt(e.createTime):me.min(),o=new Yt({mapValue:{fields:e.fields}}),a=_t.newFoundDocument(s,r,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function t2(n,e){return"found"in e?(function(s,r){pe(!!r.found,43571),r.found.name,r.found.updateTime;const i=Ss(s,r.found.name),o=Rt(r.found.updateTime),a=r.found.createTime?Rt(r.found.createTime):me.min(),l=new Yt({mapValue:{fields:r.found.fields}});return _t.newFoundDocument(i,o,a,l)})(n,e):"missing"in e?(function(s,r){pe(!!r.missing,3894),pe(!!r.readTime,22933);const i=Ss(s,r.missing),o=Rt(r.readTime);return _t.newNoDocument(i,o)})(n,e):de(7234,{result:e})}function n2(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:de(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?(pe(h===void 0||typeof h=="string",58123),It.fromBase64String(h||"")):(pe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),It.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?M.UNKNOWN:gR(u.code);return new B(h,u.message||"")})(o);t=new ER(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ss(n,s.document.name),i=Rt(s.document.updateTime),o=s.document.createTime?Rt(s.document.createTime):me.min(),a=new Yt({mapValue:{fields:s.document.fields}}),l=_t.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];t=new rh(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ss(n,s.document),i=s.readTime?Rt(s.readTime):me.min(),o=_t.newNoDocument(r,i),a=s.removedTargetIds||[];t=new rh([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ss(n,s.document),i=s.removedTargetIds||[];t=new rh([],i,r,null)}else{if(!("filter"in e))return de(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new zF(r,i),a=s.targetId;t=new vR(a,o)}}return t}function kc(n,e){let t;if(e instanceof Fa)t={update:II(n,e.key,e.value)};else if(e instanceof Ua)t={delete:Nc(n,e.key)};else if(e instanceof cr)t={update:II(n,e.key,e.data),updateMask:l2(e.fieldMask)};else{if(!(e instanceof ng))return de(16599,{Vt:e.type});t={verify:Nc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const a=o.transform;if(a instanceof ya)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Xi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Zi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof va)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw de(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:e2(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:de(27497)})(n,e.precondition)),t}function um(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?vt.updateTime(Rt(i.updateTime)):i.exists!==void 0?vt.exists(i.exists):vt.none()})(e.currentDocument):vt.none(),s=e.updateTransforms?e.updateTransforms.map((r=>(function(o,a){let l=null;if("setToServerValue"in a)pe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new ya;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Xi(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Zi(h)}else"increment"in a?l=new va(o,a.increment):de(16584,{proto:a});const u=gt.fromServerFormat(a.fieldPath);return new tu(u,l)})(n,r))):[];if(e.update){e.update.name;const r=Ss(n,e.update.name),i=new Yt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new bn(u.map((h=>gt.fromServerFormat(h))))})(e.updateMask);return new cr(r,i,o,t,s)}return new Fa(r,i,t,s)}if(e.delete){const r=Ss(n,e.delete);return new Ua(r,t)}if(e.verify){const r=Ss(n,e.verify);return new ng(r,t)}return de(1463,{proto:e})}function s2(n,e){return n&&n.length>0?(pe(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?Rt(r.updateTime):Rt(i);return o.isEqual(me.min())&&(o=Rt(i)),new GF(o,r.transformResults||[])})(t,e)))):[]}function SR(n,e){return{documents:[wR(n,e.path)]}}function Wd(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=wR(n,r);const i=(function(u){if(u.length!==0)return NR(Je.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(f){return{field:Dr(f.field),direction:i2(f.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=am(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:r}}function RR(n,e,t,s){const{ft:r,parent:i}=Wd(n,e),o={},a=[];let l=0;return t.forEach((u=>{const h=s?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Dr(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Dr(u.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},gt:o,parent:i}}function CR(n){let e=bR(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){pe(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(d){const f=PR(d);return f instanceof Je&&X_(f)?f.getFilters():[f]})(t.where));let o=[];t.orderBy&&(o=(function(d){return d.map((f=>(function(E){return new Pc(xo(E.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(f)))})(t.orderBy));let a=null;t.limit&&(a=(function(d){let f;return f=typeof d=="object"?d.value:d,Yc(f)?null:f})(t.limit));let l=null;t.startAt&&(l=(function(d){const f=!!d.before,_=d.values||[];return new Xr(_,f)})(t.startAt));let u=null;return t.endAt&&(u=(function(d){const f=!d.before,_=d.values||[];return new Xr(_,f)})(t.endAt)),XS(e,r,o,i,a,"F",l,u)}function r2(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function PR(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=xo(t.unaryFilter.field);return Le.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=xo(t.unaryFilter.field);return Le.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=xo(t.unaryFilter.field);return Le.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=xo(t.unaryFilter.field);return Le.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return de(61313);default:return de(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Le.create(xo(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return de(58110);default:return de(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Je.create(t.compositeFilter.filters.map((s=>PR(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return de(1026)}})(t.compositeFilter.op))})(n):de(30097,{filter:n})}function i2(n){return YF[n]}function o2(n){return JF[n]}function a2(n){return XF[n]}function Dr(n){return{fieldPath:n.canonicalString()}}function xo(n){return gt.fromServerFormat(n.fieldPath)}function NR(n){return n instanceof Le?(function(t){if(t.op==="=="){if(iI(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NAN"}};if(rI(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(iI(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NAN"}};if(rI(t.value))return{unaryFilter:{field:Dr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dr(t.field),op:o2(t.op),value:t.value}}})(n):n instanceof Je?(function(t){const s=t.getFilters().map((r=>NR(r)));return s.length===1?s[0]:{compositeFilter:{op:a2(t.op),filters:s}}})(n):de(54877,{filter:n})}function l2(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function kR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class $s{constructor(e,t,s,r,i=me.min(),o=me.min(),a=It.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new $s(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class xR{constructor(e){this.yt=e}}function c2(n,e){let t;if(e.document)t=Kd(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=ee.fromSegments(e.noDocument.path),r=to(e.noDocument.readTime);t=_t.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return de(56709);{const s=ee.fromSegments(e.unknownDocument.path),r=to(e.unknownDocument.version);t=_t.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime((function(r){const i=new Qe(r[0],r[1]);return me.fromTimestamp(i)})(e.readTime)),t}function TI(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:zh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(i,o){return{name:Nc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ea(i,o.version.toTimestamp()),createTime:Ea(i,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:eo(e.version)};else{if(!e.isUnknownDocument())return de(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:eo(e.version)}}return s}function zh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function eo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function to(n){const e=new Qe(n.seconds,n.nanoseconds);return me.fromTimestamp(e)}function Ri(n,e){const t=(e.baseMutations||[]).map((i=>um(n.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const s=e.mutations.map((i=>um(n.yt,i))),r=Qe.fromMillis(e.localWriteTimeMs);return new sg(e.batchId,r,t,s)}function Nl(n){const e=to(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?to(n.lastLimboFreeSnapshotVersion):me.min();let s;return s=(function(i){return i.documents!==void 0})(n.query)?(function(i){const o=i.documents.length;return pe(o===1,1966,{count:o}),hn(La(bR(i.documents[0])))})(n.query):(function(i){return hn(CR(i))})(n.query),new $s(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,It.fromBase64String(n.resumeToken))}function DR(n,e){const t=eo(e.snapshotVersion),s=eo(e.lastLimboFreeSnapshotVersion);let r;r=Gh(e.target)?SR(n.yt,e.target):Wd(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ji(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function zd(n){const e=CR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wh(e,e.limit,"L"):e}function Xf(n,e){return new ig(e.largestBatchId,um(n.yt,e.overlayMutation))}function wI(n,e){const t=e.path.lastSegment();return[n,un(e.path.popLast()),t]}function bI(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:eo(s.readTime),documentKey:un(s.documentKey.path),largestBatchId:s.largestBatchId}}class u2{getBundleMetadata(e,t){return AI(e).get(t).next((s=>{if(s)return(function(i){return{id:i.bundleId,createTime:to(i.createTime),version:i.version}})(s)}))}saveBundleMetadata(e,t){return AI(e).put((function(r){return{bundleId:r.id,createTime:eo(Rt(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return SI(e).get(t).next((s=>{if(s)return(function(i){return{name:i.name,query:zd(i.bundledQuery),readTime:to(i.readTime)}})(s)}))}saveNamedQuery(e,t){return SI(e).put((function(r){return{name:r.name,readTime:eo(Rt(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function AI(n){return Ft(n,Ld)}function SI(n){return Ft(n,Fd)}class Hd{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new Hd(e,s)}getOverlay(e,t){return gl(e).get(wI(this.userId,t)).next((s=>s?Xf(this.serializer,s):null))}getOverlays(e,t){const s=Es();return D.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){const r=[];return s.forEach(((i,o)=>{const a=new ig(t,o);r.push(this.St(e,a))})),D.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach((o=>r.add(un(o.getCollectionPath()))));const i=[];return r.forEach((o=>{const a=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push(gl(e).Z(Xp,a))})),D.waitFor(i)}getOverlaysForCollection(e,t,s){const r=Es(),i=un(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gl(e).J(Xp,o).next((a=>{for(const l of a){const u=Xf(this.serializer,l);r.set(u.getKey(),u)}return r}))}getOverlaysForCollectionGroup(e,t,s,r){const i=Es();let o;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gl(e).ee({index:PS,range:a},((l,u,h)=>{const d=Xf(this.serializer,u);i.size()<r||d.largestBatchId===o?(i.set(d.getKey(),d),o=d.largestBatchId):h.done()})).next((()=>i))}St(e,t){return gl(e).put((function(r,i,o){const[a,l,u]=wI(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:kc(r.yt,o.mutation)}})(this.serializer,this.userId,t))}}function gl(n){return Ft(n,Ud)}class h2{bt(e){return Ft(e,H_)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?It.fromUint8Array(s):It.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Ci{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(yt(e.integerValue));else if("doubleValue"in e){const s=yt(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),Ic(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=tr(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(nr(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?$S(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):$d(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):de(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const r=ma,i=s[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(yt(i)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),ee.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ci.Kt=new Ci;const Ao=255;function d2(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function RI(n){const e=64-(function(s){let r=0;for(let i=0;i<8;++i){const o=d2(255&s[i]);if(r+=o,o!==8)break}return r})(n);return Math.ceil(e/8)}class f2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=RI(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=RI(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Ao),this.sn(255)}_n(){this.an(Ao),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Ao?(this.sn(Ao),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Ao?(this.an(Ao),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class p2{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class m2{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class yl{constructor(){this.cn=new f2,this.ln=new p2(this.cn),this.hn=new m2(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Pi{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Pi(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:ih(this.En),directionalValue:ih(this.dn),orderedDocumentKey:ih(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function vr(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=CI(n.En,e.En),t!==0?t:(t=CI(n.dn,e.dn),t!==0?t:ee.comparator(n.In,e.In)))}function CI(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function ih(n){return ob()?(function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s})(n):n}function PI(n){return typeof n!="string"?n:(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(n)}class NI{constructor(e){this.mn=new Ze(((t,s)=>gt.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(pe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Qp(e);if(t!==void 0&&!this.wn(t))return!1;const s=bi(e);let r=new Set,i=0,o=0;for(;i<s.length&&this.wn(s[i]);++i)r=r.add(s[i].fieldPath.canonicalString());if(i===s.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!r.has(a.field.canonicalString())){const l=s[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<s.length;++i){const a=s[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Ze(gt.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new Ui(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Ui(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Ui(s.field,s.dir==="asc"?0:1)));return new ca(ca.UNKNOWN_ID,this.collectionId,t,ua.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function VR(n){if(pe(n instanceof Le||n instanceof Je,20012),n instanceof Le){if(n instanceof JS){const t=n.value.arrayValue?.values?.map((s=>Le.create(n.field,"==",s)))||[];return Je.create(t,"or")}return n}const e=n.filters.map((t=>VR(t)));return Je.create(e,n.op)}function _2(n){if(n.getFilters().length===0)return[];const e=fm(VR(n));return pe(OR(e),7391),hm(e)||dm(e)?[e]:e.getFilters()}function hm(n){return n instanceof Le}function dm(n){return n instanceof Je&&X_(n)}function OR(n){return hm(n)||dm(n)||(function(t){if(t instanceof Je&&nm(t)){for(const s of t.getFilters())if(!hm(s)&&!dm(s))return!1;return!0}return!1})(n)}function fm(n){if(pe(n instanceof Le||n instanceof Je,34018),n instanceof Le)return n;if(n.filters.length===1)return fm(n.filters[0]);const e=n.filters.map((s=>fm(s)));let t=Je.create(e,n.op);return t=Hh(t),OR(t)?t:(pe(t instanceof Je,64498),pe(ga(t),40251),pe(t.filters.length>1,57927),t.filters.reduce(((s,r)=>lg(s,r))))}function lg(n,e){let t;return pe(n instanceof Le||n instanceof Je,38388),pe(e instanceof Le||e instanceof Je,25473),t=n instanceof Le?e instanceof Le?(function(r,i){return Je.create([r,i],"and")})(n,e):kI(n,e):e instanceof Le?kI(e,n):(function(r,i){if(pe(r.filters.length>0&&i.filters.length>0,48005),ga(r)&&ga(i))return HS(r,i.getFilters());const o=nm(r)?r:i,a=nm(r)?i:r,l=o.filters.map((u=>lg(u,a)));return Je.create(l,"or")})(n,e),Hh(t)}function kI(n,e){if(ga(e))return HS(e,n.getFilters());{const t=e.filters.map((s=>lg(n,s)));return Je.create(t,"or")}}function Hh(n){if(pe(n instanceof Le||n instanceof Je,11850),n instanceof Le)return n;const e=n.getFilters();if(e.length===1)return Hh(e[0]);if(WS(n))return n;const t=e.map((r=>Hh(r))),s=[];return t.forEach((r=>{r instanceof Le?s.push(r):r instanceof Je&&(r.op===n.op?s.push(...r.filters):s.push(r))})),s.length===1?s[0]:Je.create(s,n.op)}class g2{constructor(){this.Cn=new cg}addToCollectionParentIndex(e,t){return this.Cn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Un.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Un.min())}updateCollectionGroup(e,t,s){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class cg{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ze(Ne.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ze(Ne.comparator)).toArray()}}const xI="IndexedDbIndexManager",xu=new Uint8Array(0);class y2{constructor(e,t){this.databaseId=t,this.vn=new cg,this.Fn=new lr((s=>Ji(s)),((s,r)=>Xc(s,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:s,parent:un(r)};return DI(e).put(i)}return D.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[pS(t),""],!1,!0);return DI(e).J(r).next((i=>{for(const o of i){if(o.collectionId!==t)break;s.push(vs(o.parent))}return s}))}addFieldIndex(e,t){const s=vl(e),r=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete r.indexId;const i=s.add(r);if(t.indexState){const o=Ro(e);return i.next((a=>{o.put(bI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const s=vl(e),r=Ro(e),i=So(e);return s.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=vl(e),s=So(e),r=Ro(e);return t.Z().next((()=>s.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return D.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((r=>{if(r===0||r===1){const i=new NI(s).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const s=So(e);let r=!0;const i=new Map;return D.forEach(this.Mn(t),(o=>this.xn(e,o).next((a=>{r&&(r=!!a),i.set(o,a)})))).next((()=>{if(r){let o=Re();const a=[];return D.forEach(i,((l,u)=>{W(xI,`Using index ${(function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map((k=>`${k.fieldPath}:${k.kind}`)).join(",")}`})(l)} to execute ${Ji(t)}`);const h=(function(N,k){const G=Qp(k);if(G===void 0)return null;for(const J of Kh(N,G.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null})(u,l),d=(function(N,k){const G=new Map;for(const J of bi(k))for(const b of Kh(N,J.fieldPath))switch(b.op){case"==":case"in":G.set(J.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return G.set(J.fieldPath.canonicalString(),b.value),Array.from(G.values())}return null})(u,l),f=(function(N,k){const G=[];let J=!0;for(const b of bi(k)){const v=b.kind===0?uI(N,b.fieldPath,N.startAt):hI(N,b.fieldPath,N.startAt);G.push(v.value),J&&(J=v.inclusive)}return new Xr(G,J)})(u,l),_=(function(N,k){const G=[];let J=!0;for(const b of bi(k)){const v=b.kind===0?hI(N,b.fieldPath,N.endAt):uI(N,b.fieldPath,N.endAt);G.push(v.value),J&&(J=v.inclusive)}return new Xr(G,J)})(u,l),E=this.On(l,u,f),T=this.On(l,u,_),C=this.Nn(l,u,d),L=this.Bn(l.indexId,h,E,f.inclusive,T,_.inclusive,C);return D.forEach(L,(U=>s.Y(U,t.limit).next((N=>{N.forEach((k=>{const G=ee.fromSegments(k.documentKey);o.has(G)||(o=o.add(G),a.push(G))}))}))))})).next((()=>a))}return D.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=_2(Je.create(e.filters,"and")).map((s=>rm(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,r,i,o,a){const l=(t!=null?t.length:1)*Math.max(s.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let d=0;d<l;++d){const f=t?this.Ln(t[d/u]):xu,_=this.kn(e,f,s[d%u],r),E=this.qn(e,f,i[d%u],o),T=a.map((C=>this.kn(e,f,C,!0)));h.push(...this.createRange(_,E,T))}return h}kn(e,t,s,r){const i=new Pi(e,ee.empty(),t,s);return r?i:i.An()}qn(e,t,s,r){const i=new Pi(e,ee.empty(),t,s);return r?i.An():i}xn(e,t){const s=new NI(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((i=>{let o=null;for(const a of i)s.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o}))}getIndexType(e,t){let s=2;const r=this.Mn(t);return D.forEach(r,(i=>this.xn(e,i).next((o=>{o?s!==0&&o.fields.length<(function(l){let u=new Ze(gt.comparator),h=!1;for(const d of l.filters)for(const f of d.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?h=!0:u=u.add(f.field));for(const d of l.orderBy)d.field.isKeyField()||(u=u.add(d.field));return u.size+(h?1:0)})(i)&&(s=1):s=0})))).next((()=>(function(o){return o.limit!==null})(t)&&r.length>1&&s===2?1:s))}Qn(e,t){const s=new yl;for(const r of bi(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=s.Pn(r.kind);Ci.Kt.Dt(i,o)}return s.un()}Ln(e){const t=new yl;return Ci.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new yl;return Ci.Kt.Dt(Yi(this.databaseId,t),s.Pn((function(i){const o=bi(i);return o.length===0?0:o[o.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new yl);let i=0;for(const o of bi(e)){const a=s[i++];for(const l of r)if(this.Un(t,o.fieldPath)&&Cc(a))r=this.Kn(r,o,a);else{const u=l.Pn(o.kind);Ci.Kt.Dt(a,u)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const a of r){const l=new yl;l.seed(a.un()),Ci.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find((s=>s instanceof Le&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=vl(e),r=Ro(e);return(t?s.J(Jp,IDBKeyRange.bound(t,t)):s.J()).next((i=>{const o=[];return D.forEach(i,(a=>r.get([a.indexId,this.uid]).next((l=>{o.push((function(h,d){const f=d?new ua(d.sequenceNumber,new Un(to(d.readTime),new ee(vs(d.documentKey)),d.largestBatchId)):ua.empty(),_=h.fields.map((([E,T])=>new Ui(gt.fromServerFormat(E),T)));return new ca(h.indexId,h.collectionGroup,_,f)})(a,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:Ie(s.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const r=vl(e),i=Ro(e);return this.Gn(e).next((o=>r.J(Jp,IDBKeyRange.bound(t,t)).next((a=>D.forEach(a,(l=>i.put(bI(l.indexId,this.uid,o,s))))))))}updateIndexEntries(e,t){const s=new Map;return D.forEach(t,((r,i)=>{const o=s.get(r.collectionGroup);return(o?D.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next((a=>(s.set(r.collectionGroup,a),D.forEach(a,(l=>this.zn(e,r,l).next((u=>{const h=this.jn(i,l);return u.isEqual(h)?D.resolve():this.Jn(e,i,l,u,h)})))))))}))}Hn(e,t,s,r){return So(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return So(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=So(e);let i=new Ze(vr);return r.ee({index:CS,range:IDBKeyRange.only([s.indexId,this.uid,ih(this.$n(s,t))])},((o,a)=>{i=i.add(new Pi(s.indexId,t,PI(a.arrayValue),PI(a.directionalValue)))})).next((()=>i))}jn(e,t){let s=new Ze(vr);const r=this.Qn(t,e);if(r==null)return s;const i=Qp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Cc(o))for(const a of o.arrayValue.values||[])s=s.add(new Pi(t.indexId,e.key,this.Ln(a),r))}else s=s.add(new Pi(t.indexId,e.key,xu,r));return s}Jn(e,t,s,r,i){W(xI,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,h,d,f){const _=l.getIterator(),E=u.getIterator();let T=bo(_),C=bo(E);for(;T||C;){let L=!1,U=!1;if(T&&C){const N=h(T,C);N<0?U=!0:N>0&&(L=!0)}else T!=null?U=!0:L=!0;L?(d(C),C=bo(E)):U?(f(T),T=bo(_)):(T=bo(_),C=bo(E))}})(r,i,vr,(a=>{o.push(this.Hn(e,t,s,a))}),(a=>{o.push(this.Yn(e,t,s,a))})),D.waitFor(o)}Gn(e){let t=1;return Ro(e).ee({index:RS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,r,i)=>{i.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((o,a)=>vr(o,a))).filter(((o,a,l)=>!a||vr(o,l[a-1])!==0));const r=[];r.push(e);for(const o of s){const a=vr(o,e),l=vr(o,t);if(a===0)r[0]=e.An();else if(a>0&&l<0)r.push(o),r.push(o.An());else if(l>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const a=r[o].Vn(this.uid,xu,ee.empty()),l=r[o+1].Vn(this.uid,xu,ee.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return vr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(VI)}getMinOffset(e,t){return D.mapArray(this.Mn(t),(s=>this.xn(e,s).next((r=>r||de(44426))))).next(VI)}}function DI(n){return Ft(n,bc)}function So(n){return Ft(n,Hl)}function vl(n){return Ft(n,z_)}function Ro(n){return Ft(n,zl)}function VI(n){pe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;G_(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Un(e.readTime,e.documentKey,t)}const OI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},MR=41943040;class sn{static withCacheSize(e){return new sn(e,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}function LR(n,e,t){const s=n.store(Hn),r=n.store(ha),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=s.ee({range:o},((h,d,f)=>(a++,f.delete())));i.push(l.next((()=>{pe(a===1,47070,{batchId:t.batchId})})));const u=[];for(const h of t.mutations){const d=bS(e,h.key.path,t.batchId);i.push(r.delete(d)),u.push(h.key)}return D.waitFor(i).next((()=>u))}function Qh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw de(14731);e=n.noDocument}return JSON.stringify(e).length}sn.DEFAULT_COLLECTION_PERCENTILE=10,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sn.DEFAULT=new sn(MR,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sn.DISABLED=new sn(-1,0,0);class Qd{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){pe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Qd(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Er(e).ee({index:Di,range:s},((r,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,s,r){const i=Do(e),o=Er(e);return o.add({}).next((a=>{pe(typeof a=="number",49019);const l=new sg(a,t,s,r),u=(function(_,E,T){const C=T.baseMutations.map((U=>kc(_.yt,U))),L=T.mutations.map((U=>kc(_.yt,U)));return{userId:E,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:C,mutations:L}})(this.serializer,this.userId,l),h=[];let d=new Ze(((f,_)=>Ie(f.canonicalString(),_.canonicalString())));for(const f of r){const _=bS(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),h.push(o.put(u)),h.push(i.put(_,ZL))}return d.forEach((f=>{h.push(this.indexManager.addToCollectionParentIndex(e,f))})),e.addOnCommittedListener((()=>{this.Xn[a]=l.keys()})),D.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return Er(e).get(t).next((s=>s?(pe(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),Ri(this.serializer,s)):null))}er(e,t){return this.Xn[t]?D.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return Er(e).ee({index:Di,range:r},((o,a,l)=>{a.userId===this.userId&&(pe(a.batchId>=s,47524,{tr:s}),i=Ri(this.serializer,a)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=jr;return Er(e).ee({index:Di,range:t,reverse:!0},((r,i,o)=>{s=i.batchId,o.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,jr],[this.userId,Number.POSITIVE_INFINITY]);return Er(e).J(Di,t).next((s=>s.map((r=>Ri(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Xu(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return Do(e).ee({range:r},((o,a,l)=>{const[u,h,d]=o,f=vs(h);if(u===this.userId&&t.path.isEqual(f))return Er(e).get(d).next((_=>{if(!_)throw de(61480,{nr:o,batchId:d});pe(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:d}),i.push(Ri(this.serializer,_))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ze(Ie);const r=[];return t.forEach((i=>{const o=Xu(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Do(e).ee({range:a},((u,h,d)=>{const[f,_,E]=u,T=vs(_);f===this.userId&&i.path.isEqual(T)?s=s.add(E):d.done()}));r.push(l)})),D.waitFor(r).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=Xu(this.userId,s),o=IDBKeyRange.lowerBound(i);let a=new Ze(Ie);return Do(e).ee({range:o},((l,u,h)=>{const[d,f,_]=l,E=vs(f);d===this.userId&&s.isPrefixOf(E)?E.length===r&&(a=a.add(_)):h.done()})).next((()=>this.rr(e,a)))}rr(e,t){const s=[],r=[];return t.forEach((i=>{r.push(Er(e).get(i).next((o=>{if(o===null)throw de(35274,{batchId:i});pe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),s.push(Ri(this.serializer,o))})))})),D.waitFor(r).next((()=>s))}removeMutationBatch(e,t){return LR(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),D.forEach(s,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return D.resolve();const s=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),r=[];return Do(e).ee({range:s},((i,o,a)=>{if(i[0]===this.userId){const l=vs(i[1]);r.push(l)}else a.done()})).next((()=>{pe(r.length===0,56720,{sr:r.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return FR(e,this.userId,t)}_r(e){return UR(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:jr,lastStreamToken:""}))}}function FR(n,e,t){const s=Xu(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Do(n).ee({range:i,X:!0},((a,l,u)=>{const[h,d,f]=a;h===e&&d===r&&(o=!0),u.done()})).next((()=>o))}function Er(n){return Ft(n,Hn)}function Do(n){return Ft(n,ha)}function UR(n){return Ft(n,Tc)}class no{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new no(0)}static cr(){return new no(-1)}}class v2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new no(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>me.fromTimestamp(new Qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Co(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(pe(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let r=0;const i=[];return Co(e).ee(((o,a)=>{const l=Nl(a);l.sequenceNumber<=t&&s.get(l.targetId)===null&&(r++,i.push(this.removeTargetData(e,l)))})).next((()=>D.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Co(e).ee(((s,r)=>{const i=Nl(r);t(i)}))}lr(e){return MI(e).get(jh).next((t=>(pe(t!==null,2888),t)))}hr(e,t){return MI(e).put(jh,t)}Pr(e,t){return Co(e).put(DR(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=Ji(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return Co(e).ee({range:r,index:SS},((o,a,l)=>{const u=Nl(a);Xc(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,s){const r=[],i=Vr(e);return t.forEach((o=>{const a=un(o.path);r.push(i.put({targetId:s,path:a})),r.push(this.referenceDelegate.addReference(e,s,o))})),D.waitFor(r)}removeMatchingKeys(e,t,s){const r=Vr(e);return D.forEach(t,(i=>{const o=un(i.path);return D.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])}))}removeMatchingKeysForTargetId(e,t){const s=Vr(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Vr(e);let i=Re();return r.ee({range:s,X:!0},((o,a,l)=>{const u=vs(o[1]),h=new ee(u);i=i.add(h)})).next((()=>i))}containsKey(e,t){const s=un(t.path),r=IDBKeyRange.bound([s],[pS(s)],!1,!0);let i=0;return Vr(e).ee({index:W_,X:!0,range:r},(([o,a],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return Co(e).get(t).next((s=>s?Nl(s):null))}}function Co(n){return Ft(n,da)}function MI(n){return Ft(n,Bi)}function Vr(n){return Ft(n,fa)}const LI="LruGarbageCollector",BR=1048576;function FI([n,e],[t,s]){const r=Ie(n,t);return r===0?Ie(e,s):r}class E2{constructor(e){this.Ir=e,this.buffer=new Ze(FI),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();FI(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class qR{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){W(LI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ri(t)?W(LI,"Ignoring IndexedDB error during garbage collection: ",t):await si(t)}await this.Vr(3e5)}))}}class I2{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return D.resolve(wn.ce);const s=new E2(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(W("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(OI)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(W("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),OI):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((d=>(d>this.params.maximumSequenceNumbersToCollect?(W("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r)))).next((d=>(s=d,a=Date.now(),this.removeTargets(e,s,t)))).next((d=>(i=d,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((d=>(u=Date.now(),No()<=De.DEBUG&&W("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:d}))))}}function $R(n,e){return new I2(n,e)}class T2{constructor(e,t){this.db=e,this.garbageCollector=$R(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,r)=>t(r)))}addReference(e,t,s){return Du(e,s)}removeReference(e,t,s){return Du(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return Du(e,t)}br(e,t){return(function(r,i){let o=!1;return UR(r).te((a=>FR(r,a,i).next((l=>(l&&(o=!0),D.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Sr(e,((o,a)=>{if(a<=t){const l=this.br(e,o).next((u=>{if(!u)return i++,s.getEntry(e,o).next((()=>(s.removeEntry(o,me.min()),Vr(e).delete((function(d){return[0,un(d.path)]})(o)))))}));r.push(l)}})).next((()=>D.waitFor(r))).next((()=>s.apply(e))).next((()=>i))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return Du(e,t)}Sr(e,t){const s=Vr(e);let r,i=wn.ce;return s.ee({index:W_},(([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==wn.ce&&t(new ee(vs(r)),i),i=u,r=l):i=wn.ce})).next((()=>{i!==wn.ce&&t(new ee(vs(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Du(n,e){return Vr(n).put((function(s,r){return{targetId:0,path:un(s.path),sequenceNumber:r}})(e,n.currentSequenceNumber))}class jR{constructor(){this.changes=new lr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?D.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class w2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Ei(e).put(s)}removeEntry(e,t,s){return Ei(e).delete((function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],zh(o),a[a.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=_t.newInvalidDocument(t);return Ei(e).ee({index:Zu,range:IDBKeyRange.only(El(t))},((r,i)=>{s=this.Cr(t,i)})).next((()=>s))}vr(e,t){let s={size:0,document:_t.newInvalidDocument(t)};return Ei(e).ee({index:Zu,range:IDBKeyRange.only(El(t))},((r,i)=>{s={document:this.Cr(t,i),size:Qh(i)}})).next((()=>s))}getEntries(e,t){let s=An();return this.Fr(e,t,((r,i)=>{const o=this.Cr(r,i);s=s.insert(r,o)})).next((()=>s))}Mr(e,t){let s=An(),r=new dt(ee.comparator);return this.Fr(e,t,((i,o)=>{const a=this.Cr(i,o);s=s.insert(i,a),r=r.insert(i,Qh(o))})).next((()=>({documents:s,Or:r})))}Fr(e,t,s){if(t.isEmpty())return D.resolve();let r=new Ze(qI);t.forEach((l=>r=r.add(l)));const i=IDBKeyRange.bound(El(r.first()),El(r.last())),o=r.getIterator();let a=o.getNext();return Ei(e).ee({index:Zu,range:i},((l,u,h)=>{const d=ee.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&qI(a,d)<0;)s(a,null),a=o.getNext();a&&a.isEqual(d)&&(s(a,u),a=o.hasNext()?o.getNext():null),a?h.j(El(a)):h.done()})).next((()=>{for(;a;)s(a,null),a=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,s,r,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),zh(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ei(e).J(IDBKeyRange.bound(a,l,!0)).next((u=>{i?.incrementDocumentReadCount(u.length);let h=An();for(const d of u){const f=this.Cr(ee.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(eu(t,f)||r.has(f.key))&&(h=h.insert(f.key,f))}return h}))}getAllFromCollectionGroup(e,t,s,r){let i=An();const o=BI(t,s),a=BI(t,Un.max());return Ei(e).ee({index:AS,range:IDBKeyRange.bound(o,a,!0)},((l,u,h)=>{const d=this.Cr(ee.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(d.key,d),i.size===r&&h.done()})).next((()=>i))}newChangeBuffer(e){return new b2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return UI(e).get(Yp).next((t=>(pe(!!t,20021),t)))}Dr(e,t){return UI(e).put(Yp,t)}Cr(e,t){if(t){const s=c2(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(me.min())))return s}return _t.newInvalidDocument(e)}}function GR(n){return new w2(n)}class b2 extends jR{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new lr((s=>s.toString()),((s,r)=>s.isEqual(r)))}applyChanges(e){const t=[];let s=0,r=new Ze(((i,o)=>Ie(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=TI(this.Nr.serializer,o);r=r.add(i.path.popLast());const u=Qh(l);s+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(s-=a.size,this.trackRemovals){const l=TI(this.Nr.serializer,o.convertToNoDocument(me.min()));t.push(this.Nr.addEntry(e,i,l))}})),r.forEach((i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Nr.updateMetadata(e,s)),D.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:r})=>(r.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:s.get(i).readTime})})),s)))}}function UI(n){return Ft(n,wc)}function Ei(n){return Ft(n,$h)}function El(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function BI(n,e){const t=e.documentKey.path.toArray();return[n,zh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function qI(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=Ie(t[i],s[i]),r)return r;return r=Ie(t.length,s.length),r||(r=Ie(t[t.length-2],s[s.length-2]),r||Ie(t[t.length-1],s[s.length-1]))}class A2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class KR{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Jl(s.mutation,r,bn.empty(),Qe.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Re()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Re()){const r=Es();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=Cl();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=Es();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Re())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,s,r){let i=An();const o=Yl(),a=(function(){return Yl()})();return t.forEach(((l,u)=>{const h=s.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof cr)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Jl(h.mutation,u,h.mutation.getFieldMask(),Qe.now())):o.set(u.key,bn.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new A2(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const s=Yl();let r=new dt(((o,a)=>o-a)),i=Re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=s.get(l)||bn.empty();h=a.applyToLocalView(u,h),s.set(l,h);const d=(r.get(a.batchId)||Re()).add(l);r=r.insert(a.batchId,d)}))})).next((()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=oR();h.forEach((f=>{if(!i.has(f)){const _=fR(t.get(f),s.get(f));_!==null&&d.set(f,_),i=i.add(f)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return D.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return ee.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Z_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):D.resolve(Es());let a=la,l=i;return o.next((u=>D.forEach(u,((h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?D.resolve():this.remoteDocumentCache.getEntry(e,h).next((f=>{l=l.insert(h,f)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Re()))).next((h=>({batchId:a,changes:iR(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ee(t)).next((s=>{let r=Cl();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Cl();return this.indexManager.getCollectionParents(e,i).next((a=>D.forEach(a,(l=>{const u=(function(d,f){return new ar(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next((h=>{h.forEach(((d,f)=>{o=o.insert(d,f)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,_t.newInvalidDocument(h)))}));let a=Cl();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&Jl(h.mutation,u,bn.empty(),Qe.now()),eu(t,u)&&(a=a.insert(l,u))})),a}))}}class S2{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return D.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Rt(r.createTime)}})(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:zd(r.bundledQuery),readTime:Rt(r.readTime)}})(t)),D.resolve()}}class R2{constructor(){this.overlays=new dt(ee.comparator),this.qr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Es();return D.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),D.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),D.resolve()}getOverlaysForCollection(e,t,s){const r=Es(),i=t.length+1,o=new ee(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return D.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new dt(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let h=i.get(u.largestBatchId);h===null&&(h=Es(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Es(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=r)););return D.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new ig(t,s));let i=this.qr.get(t);i===void 0&&(i=Re(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}class C2{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}class ug{constructor(){this.Qr=new Ze(jt.$r),this.Ur=new Ze(jt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new jt(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new jt(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new ee(new Ne([])),s=new jt(t,e),r=new jt(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ee(new Ne([])),s=new jt(t,e),r=new jt(t,e+1);let i=Re();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new jt(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class jt{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ee.comparator(e.key,t.key)||Ie(e.Yr,t.Yr)}static Kr(e,t){return Ie(e.Yr,t.Yr)||ee.comparator(e.key,t.key)}}class P2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ze(jt.$r)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new sg(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new jt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return D.resolve(o)}lookupMutationBatch(e,t){return D.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return D.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?jr:this.tr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new jt(t,0),r=new jt(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const a=this.Xr(o.Yr);i.push(a)})),D.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ze(Ie);return t.forEach((r=>{const i=new jt(r,0),o=new jt(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(a=>{s=s.add(a.Yr)}))})),D.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;ee.isDocumentKey(i)||(i=i.child(""));const o=new jt(new ee(i),0);let a=new Ze(Ie);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)}),o),D.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){pe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return D.forEach(t.mutations,(r=>{const i=new jt(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new jt(t,0),r=this.Zr.firstAfterOrEqual(s);return D.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class N2{constructor(e){this.ri=e,this.docs=(function(){return new dt(ee.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return D.resolve(s?s.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let s=An();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():_t.newInvalidDocument(r))})),D.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=An();const o=t.path,a=new ee(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||G_(vS(h),s)<=0||(r.has(h.key)||eu(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return D.resolve(i)}getAllFromCollectionGroup(e,t,s,r){de(9500)}ii(e,t){return D.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new k2(this)}getSize(e){return D.resolve(this.size)}}class k2 extends jR{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),D.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class x2{constructor(e){this.persistence=e,this.si=new lr((t=>Ji(t)),Xc),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.oi=0,this._i=new ug,this.targetCount=0,this.ai=no.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),D.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new no(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Pr(t),D.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),D.waitFor(i).next((()=>r))}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return D.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),D.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),D.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return D.resolve(s)}containsKey(e,t){return D.resolve(this._i.containsKey(t))}}class hg{constructor(e,t){this.ui={},this.overlays={},this.ci=new wn(0),this.li=!1,this.li=!0,this.hi=new C2,this.referenceDelegate=e(this),this.Pi=new x2(this),this.indexManager=new g2,this.remoteDocumentCache=(function(r){return new N2(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new xR(t),this.Ii=new S2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new R2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new P2(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){W("MemoryPersistence","Starting transaction:",e);const r=new D2(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return D.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class D2 extends IS{constructor(e){super(),this.currentSequenceNumber=e}}class Yd{constructor(e){this.persistence=e,this.Ri=new ug,this.Vi=null}static mi(e){return new Yd(e)}get fi(){if(this.Vi)return this.Vi;throw de(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),D.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.fi,(s=>{const r=ee.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,me.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Yh{constructor(e,t){this.persistence=e,this.pi=new lr((s=>un(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=$R(this,t)}static mi(e,t){return new Yh(e,t)}Ei(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return D.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?D.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((a=>{a||(s++,i.removeEntry(o,me.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=th(e.data.value)),t}br(e,t,s){return D.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return D.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class V2{constructor(e){this.serializer=e}k(e,t,s,r){const i=new Md("createOrUpgrade",t);s<1&&r>=1&&((function(l){l.createObjectStore(Jc)})(e),(function(l){l.createObjectStore(Tc,{keyPath:XL}),l.createObjectStore(Hn,{keyPath:XE,autoIncrement:!0}).createIndex(Di,ZE,{unique:!0}),l.createObjectStore(ha)})(e),$I(e),(function(l){l.createObjectStore(Ai)})(e));let o=D.resolve();return s<3&&r>=3&&(s!==0&&((function(l){l.deleteObjectStore(fa),l.deleteObjectStore(da),l.deleteObjectStore(Bi)})(e),$I(e)),o=o.next((()=>(function(l){const u=l.store(Bi),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0};return u.put(jh,h)})(i)))),s<4&&r>=4&&(s!==0&&(o=o.next((()=>(function(l,u){return u.store(Hn).J().next((d=>{l.deleteObjectStore(Hn),l.createObjectStore(Hn,{keyPath:XE,autoIncrement:!0}).createIndex(Di,ZE,{unique:!0});const f=u.store(Hn),_=d.map((E=>f.put(E)));return D.waitFor(_)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(pa,{keyPath:aF})})(e)}))),s<5&&r>=5&&(o=o.next((()=>this.yi(i)))),s<6&&r>=6&&(o=o.next((()=>((function(l){l.createObjectStore(wc)})(e),this.wi(i))))),s<7&&r>=7&&(o=o.next((()=>this.Si(i)))),s<8&&r>=8&&(o=o.next((()=>this.bi(e,i)))),s<9&&r>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&r>=10&&(o=o.next((()=>this.Di(i)))),s<11&&r>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(Ld,{keyPath:lF})})(e),(function(l){l.createObjectStore(Fd,{keyPath:cF})})(e)}))),s<12&&r>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(Ud,{keyPath:_F});u.createIndex(Xp,gF,{unique:!1}),u.createIndex(PS,yF,{unique:!1})})(e)}))),s<13&&r>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore($h,{keyPath:eF});u.createIndex(Zu,tF),u.createIndex(AS,nF)})(e))).next((()=>this.Ci(e,i))).next((()=>e.deleteObjectStore(Ai)))),s<14&&r>=14&&(o=o.next((()=>this.Fi(e,i)))),s<15&&r>=15&&(o=o.next((()=>(function(l){l.createObjectStore(z_,{keyPath:uF,autoIncrement:!0}).createIndex(Jp,hF,{unique:!1}),l.createObjectStore(zl,{keyPath:dF}).createIndex(RS,fF,{unique:!1}),l.createObjectStore(Hl,{keyPath:pF}).createIndex(CS,mF,{unique:!1})})(e)))),s<16&&r>=16&&(o=o.next((()=>{t.objectStore(zl).clear()})).next((()=>{t.objectStore(Hl).clear()}))),s<17&&r>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(H_,{keyPath:vF})})(e)}))),s<18&&r>=18&&ob()&&(o=o.next((()=>{t.objectStore(zl).clear()})).next((()=>{t.objectStore(Hl).clear()}))),o}wi(e){let t=0;return e.store(Ai).ee(((s,r)=>{t+=Qh(r)})).next((()=>{const s={byteSize:t};return e.store(wc).put(Yp,s)}))}yi(e){const t=e.store(Tc),s=e.store(Hn);return t.J().next((r=>D.forEach(r,(i=>{const o=IDBKeyRange.bound([i.userId,jr],[i.userId,i.lastAcknowledgedBatchId]);return s.J(Di,o).next((a=>D.forEach(a,(l=>{pe(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=Ri(this.serializer,l);return LR(e,i.userId,u).next((()=>{}))}))))}))))}Si(e){const t=e.store(fa),s=e.store(Ai);return e.store(Bi).get(jh).next((r=>{const i=[];return s.ee(((o,a)=>{const l=new Ne(o),u=(function(d){return[0,un(d)]})(l);i.push(t.get(u).next((h=>h?D.resolve():(d=>t.put({targetId:0,path:un(d),sequenceNumber:r.highestListenSequenceNumber}))(l))))})).next((()=>D.waitFor(i)))}))}bi(e,t){e.createObjectStore(bc,{keyPath:oF});const s=t.store(bc),r=new cg,i=o=>{if(r.add(o)){const a=o.lastSegment(),l=o.popLast();return s.put({collectionId:a,parent:un(l)})}};return t.store(Ai).ee({X:!0},((o,a)=>{const l=new Ne(o);return i(l.popLast())})).next((()=>t.store(ha).ee({X:!0},(([o,a,l],u)=>{const h=vs(a);return i(h.popLast())}))))}Di(e){const t=e.store(da);return t.ee(((s,r)=>{const i=Nl(r),o=DR(this.serializer,i);return t.put(o)}))}Ci(e,t){const s=t.store(Ai),r=[];return s.ee(((i,o)=>{const a=t.store($h),l=(function(d){return d.document?new ee(Ne.fromString(d.document.name).popFirst(5)):d.noDocument?ee.fromSegments(d.noDocument.path):d.unknownDocument?ee.fromSegments(d.unknownDocument.path):de(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))})).next((()=>D.waitFor(r)))}Fi(e,t){const s=t.store(Hn),r=GR(this.serializer),i=new hg(Yd.mi,this.serializer.yt);return s.J().next((o=>{const a=new Map;return o.forEach((l=>{let u=a.get(l.userId)??Re();Ri(this.serializer,l).keys().forEach((h=>u=u.add(h))),a.set(l.userId,u)})),D.forEach(a,((l,u)=>{const h=new Gt(u),d=Hd.wt(this.serializer,h),f=i.getIndexManager(h),_=Qd.wt(h,this.serializer,f,i.referenceDelegate);return new KR(r,_,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Zp(t,wn.ce),l).next()}))}))}}function $I(n){n.createObjectStore(fa,{keyPath:rF}).createIndex(W_,iF,{unique:!0}),n.createObjectStore(da,{keyPath:"targetId"}).createIndex(SS,sF,{unique:!0}),n.createObjectStore(Bi)}const Ir="IndexedDbPersistence",Zf=18e5,ep=5e3,tp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",WR="main";class dg{constructor(e,t,s,r,i,o,a,l,u,h,d=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=d,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=f=>Promise.resolve(),!dg.v())throw new B(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new T2(this,r),this.$i=t+WR,this.serializer=new xR(l),this.Ui=new As(this.$i,this.Ni,new V2(this.serializer)),this.hi=new h2,this.Pi=new v2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=GR(this.serializer),this.Ii=new u2,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&St(Ir,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,tp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new wn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Vu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(ri(e))return W(Ir,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return W(Ir,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Il(e).get(wo).next((t=>D.resolve(this.es(t))))}ts(e){return Vu(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Zf)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=Ft(t,pa);return s.J().next((r=>{const i=this.ss(r,Zf),o=r.filter((a=>i.indexOf(a)===-1));return D.forEach(o,(a=>s.delete(a.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?D.resolve(!0):Il(e).get(wo).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,ep)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,tp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vu(e).J().next((s=>this.ss(s,ep).find((r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(i||o&&a)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&W(Ir,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Jc,pa],(e=>{const t=new Zp(e,wn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Vu(e).J().next((t=>this.ss(t,Zf).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Qd.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new y2(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Hd.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){W(Ir,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?TF:l===17?DS:l===16?IF:l===15?Q_:l===14?xS:l===13?kS:l===12?EF:l===11?NS:void de(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,r,i,(a=>(o=new Zp(a,this.ci?this.ci.next():wn.ce),t==="readwrite-primary"?this.Hi(o).next((l=>!!l||this.Yi(o))).next((l=>{if(!l)throw St(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new B(M.FAILED_PRECONDITION,ES);return s(o)})).next((l=>this.Xi(o).next((()=>l)))):this.Is(o).next((()=>s(o)))))).then((a=>(o.raiseOnCommittedEvent(),a)))}Is(e){return Il(e).get(wo).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,ep)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(M.FAILED_PRECONDITION,tp)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Il(e).put(wo,t)}static v(){return As.v()}Zi(e){const t=Il(e);return t.get(wo).next((s=>this.es(s)?(W(Ir,"Releasing primary lease."),t.delete(wo)):D.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(St(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;ib()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return W(Ir,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return St(Ir,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){St("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Il(n){return Ft(n,Jc)}function Vu(n){return Ft(n,pa)}function fg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class pg{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Re(),r=Re();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new pg(e,t.fromCache,s,r)}}class O2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class zR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return ib()?8:TS(Mt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new O2;return this.Ss(e,t,o).next((a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(No()<=De.DEBUG&&W("QueryEngine","SDK will not create cache indexes for query:",ko(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),D.resolve()):(No()<=De.DEBUG&&W("QueryEngine","Query:",ko(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(No()<=De.DEBUG&&W("QueryEngine","The SDK decides to create cache indexes for query:",ko(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hn(t))):D.resolve())}ys(e,t){if(dI(t))return D.resolve(null);let s=hn(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Wh(t,null,"F"),s=hn(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=Re(...i);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,s).next((l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,Wh(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,s,r){return dI(t)||r.isEqual(me.min())?D.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?D.resolve(null):(No()<=De.DEBUG&&W("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ko(t)),this.vs(e,o,t,yS(r,la)).next((a=>a)))}))}Ds(e,t){let s=new Ze(sR(e));return t.forEach(((r,i)=>{eu(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return No()<=De.DEBUG&&W("QueryEngine","Using full collection scan to execute query:",ko(t)),this.ps.getDocumentsMatchingQuery(e,t,Un.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const mg="LocalStore",M2=3e8;class L2{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new dt(Ie),this.xs=new lr((i=>Ji(i)),Xc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function HR(n,e,t,s){return new L2(n,e,t,s)}async function QR(n,e){const t=te(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],a=[];let l=Re();for(const u of r){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function F2(n,e){const t=te(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const d=u.batch,f=d.keys();let _=D.resolve();return f.forEach((E=>{_=_.next((()=>h.getEntry(l,E))).next((T=>{const C=u.docVersions.get(E);pe(C!==null,48541),T.version.compareTo(C)<0&&(d.applyToRemoteDocument(T,u),T.isValidDocument()&&(T.setReadTime(u.commitVersion),h.addEntry(T)))}))})),_.next((()=>a.mutationQueue.removeMutationBatch(l,d)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let l=Re();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function YR(n){const e=te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function U2(n,e){const t=te(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach(((h,d)=>{const f=r.get(d);if(!f)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,d).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,d))));let _=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?_=_.withResumeToken(It.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,s)),r=r.insert(d,_),(function(T,C,L){return T.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=M2?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(f,_,h)&&a.push(t.Pi.updateTargetData(i,_))}));let l=An(),u=Re();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(JR(i,o,e.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!s.isEqual(me.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((d=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));a.push(h)}return D.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function JR(n,e,t){let s=Re(),r=Re();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=An();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):W(mg,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:r}}))}function B2(n,e){const t=te(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=jr),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function Ia(n,e){const t=te(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,D.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new $s(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Ta(n,e,t){const s=te(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!ri(o))throw o;W(mg,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Jh(n,e,t){const s=te(n);let r=me.min(),i=Re();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const d=te(l),f=d.xs.get(h);return f!==void 0?D.resolve(d.Ms.get(f)):d.Pi.getTargetData(u,h)})(s,o,hn(e)).next((a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:me.min(),t?i:Re()))).next((a=>(eC(s,nR(e),a),{documents:a,Qs:i})))))}function XR(n,e){const t=te(n),s=te(t.Pi),r=t.Ms.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",(i=>s.At(i,e).next((o=>o?o.target:null))))}function ZR(n,e){const t=te(n),s=t.Os.get(e)||me.min();return t.persistence.runTransaction("Get new document changes","readonly",(r=>t.Ns.getAllFromCollectionGroup(r,e,yS(s,la),Number.MAX_SAFE_INTEGER))).then((r=>(eC(t,e,r),r)))}function eC(n,e,t){let s=n.Os.get(e)||me.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}async function q2(n,e,t,s){const r=te(n);let i=Re(),o=An();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const d=e.Us(u);d.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,d)}const a=r.Ns.newChangeBuffer({trackRemovals:!0}),l=await Ia(r,(function(h){return hn(La(Ne.fromString(`__bundle__/docs/${h}`)))})(s));return r.persistence.runTransaction("Apply bundle documents","readwrite",(u=>JR(u,a,o).next((h=>(a.apply(u),h))).next((h=>r.Pi.removeMatchingKeysForTargetId(u,l.targetId).next((()=>r.Pi.addMatchingKeys(u,i,l.targetId))).next((()=>r.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs))).next((()=>h.ks))))))}async function $2(n,e,t=Re()){const s=await Ia(n,hn(zd(e.bundledQuery))),r=te(n);return r.persistence.runTransaction("Save named query","readwrite",(i=>{const o=Rt(e.readTime);if(s.snapshotVersion.compareTo(o)>=0)return r.Ii.saveNamedQuery(i,e);const a=s.withResumeToken(It.EMPTY_BYTE_STRING,o);return r.Ms=r.Ms.insert(a.targetId,a),r.Pi.updateTargetData(i,a).next((()=>r.Pi.removeMatchingKeysForTargetId(i,s.targetId))).next((()=>r.Pi.addMatchingKeys(i,t,s.targetId))).next((()=>r.Ii.saveNamedQuery(i,e)))}))}const tC="firestore_clients";function jI(n,e){return`${tC}_${n}_${e}`}const nC="firestore_mutations";function GI(n,e,t){let s=`${nC}_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const sC="firestore_targets";function np(n,e){return`${sC}_${n}_${e}`}const gs="SharedClientState";class Xh{constructor(e,t,s,r){this.user=e,this.batchId=t,this.state=s,this.error=r}static Ws(e,t,s){const r=JSON.parse(s);let i,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(i=new B(r.error.code,r.error.message))),o?new Xh(e,t,r.state,i):(St(gs,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xl{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let r,i=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return i&&s.error&&(i=typeof s.error.message=="string"&&typeof s.error.code=="string",i&&(r=new B(s.error.code,s.error.message))),i?new Xl(e,s.state,r):(St(gs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let r=typeof s=="object"&&s.activeTargetIds instanceof Array,i=eg();for(let o=0;r&&o<s.activeTargetIds.length;++o)r=wS(s.activeTargetIds[o]),i=i.add(s.activeTargetIds[o]);return r?new Zh(e,i):(St(gs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class _g{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new _g(t.clientId,t.onlineState):(St(gs,`Failed to parse online state: ${e}`),null)}}class pm{constructor(){this.activeTargetIds=eg()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sp{constructor(e,t,s,r,i){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new dt(Ie),this.started=!1,this.Xs=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=jI(this.persistenceKey,this.Js),this.no=(function(l){return`firestore_sequence_number_${l}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new pm),this.ro=new RegExp(`^${tC}_${o}_([^_]*)$`),this.io=new RegExp(`^${nC}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${sC}_${o}_(\\d+)$`),this.oo=(function(l){return`firestore_online_state_${l}`})(this.persistenceKey),this._o=(function(l){return`firestore_bundle_loaded_v2_${l}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const r=this.getItem(jI(this.persistenceKey,s));if(r){const i=Zh.Ws(s,r);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((s,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(np(this.persistenceKey,e));if(r){const i=Xl.Ws(e,r);i&&(s=i.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(np(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach((r=>{this.Po(r)})),this.currentUser=e,s.forEach((r=>{this.addPendingMutation(r)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return W(gs,"READ",e,t),t}setItem(e,t){W(gs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){W(gs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(W(gs,"EVENT",t.key,t.newValue),t.key===this.eo)return void St("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=(function(i){let o=wn.ce;if(i!=null)try{const a=JSON.parse(i);pe(typeof a=="number",30636,{So:i}),o=a}catch(a){St(gs,"Failed to read sequence number from WebStorage",a)}return o})(t.newValue);s!==wn.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map((r=>this.syncEngine.Do(r))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const r=new Xh(this.currentUser,e,t,s),i=GI(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){const t=GI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const r=np(this.persistenceKey,e),i=new Xl(e,t,s);this.setItem(r,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return Zh.Ws(s,t)}fo(e,t){const s=this.io.exec(e),r=Number(s[1]),i=s[2]!==void 0?s[2]:null;return Xh.Ws(new Gt(i),r,t)}yo(e,t){const s=this.so.exec(e),r=Number(s[1]);return Xl.Ws(r,t)}uo(e){return _g.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);W(gs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(s),o=[],a=[];return i.forEach((l=>{r.has(l)||o.push(l)})),r.forEach((l=>{i.has(l)||a.push(l)})),this.syncEngine.Fo(o,a).then((()=>{this.Zs=s}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=eg();return e.forEach(((s,r)=>{t=t.unionWith(r.activeTargetIds)})),t}}class rC{constructor(){this.Mo=new pm,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new pm,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class j2{Oo(e){}shutdown(){}}const KI="ConnectivityMonitor";class WI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){W(KI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){W(KI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ou=null;function mm(){return Ou===null?Ou=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ou++,"0x"+Ou.toString(16)}const rp="RestConnection",G2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class K2{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Sc?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=mm(),a=this.zo(e,t.toUriEncodedString());W(rp,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),h=rr(u);return this.Jo(e,a,l,s,h).then((d=>(W(rp,`Received RPC '${e}' ${o}: `,d),d)),(d=>{throw Fn(rp,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",s),d}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ma})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=G2[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class W2{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const tn="WebChannelConnection";class z2 extends K2{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=mm();return new Promise(((a,l)=>{const u=new oS;u.setWithCredentials(!0),u.listenOnce(aS.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case Ju.NO_ERROR:const d=u.getResponseJson();W(tn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case Ju.TIMEOUT:W(tn,`RPC '${e}' ${o} timed out`),l(new B(M.DEADLINE_EXCEEDED,"Request time out"));break;case Ju.HTTP_ERROR:const f=u.getStatus();if(W(tn,`RPC '${e}' ${o} failed with status:`,f,"response text:",u.getResponseText()),f>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const E=_?.error;if(E&&E.status&&E.message){const T=(function(L){const U=L.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(U)>=0?U:M.UNKNOWN})(E.status);l(new B(T,E.message))}else l(new B(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(M.UNAVAILABLE,"Connection failed."));break;default:de(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{W(tn,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);W(tn,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=mm(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=uS(),a=cS(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");W(tn,`Creating RPC '${e}' stream ${r}: ${h}`,l);const d=o.createWebChannel(h,l);this.I_(d);let f=!1,_=!1;const E=new W2({Yo:C=>{_?W(tn,`Not sending because RPC '${e}' stream ${r} is closed:`,C):(f||(W(tn,`Opening RPC '${e}' stream ${r} transport.`),d.open(),f=!0),W(tn,`RPC '${e}' stream ${r} sending:`,C),d.send(C))},Zo:()=>d.close()}),T=(C,L,U)=>{C.listen(L,(N=>{try{U(N)}catch(k){setTimeout((()=>{throw k}),0)}}))};return T(d,Rl.EventType.OPEN,(()=>{_||(W(tn,`RPC '${e}' stream ${r} transport opened.`),E.o_())})),T(d,Rl.EventType.CLOSE,(()=>{_||(_=!0,W(tn,`RPC '${e}' stream ${r} transport closed`),E.a_(),this.E_(d))})),T(d,Rl.EventType.ERROR,(C=>{_||(_=!0,Fn(tn,`RPC '${e}' stream ${r} transport errored. Name:`,C.name,"Message:",C.message),E.a_(new B(M.UNAVAILABLE,"The operation could not be completed")))})),T(d,Rl.EventType.MESSAGE,(C=>{if(!_){const L=C.data[0];pe(!!L,16349);const U=L,N=U?.error||U[0]?.error;if(N){W(tn,`RPC '${e}' stream ${r} received error:`,N);const k=N.status;let G=(function(v){const A=Pt[v];if(A!==void 0)return gR(A)})(k),J=N.message;G===void 0&&(G=M.INTERNAL,J="Unknown error status: "+k+" with message "+N.message),_=!0,E.a_(new B(G,J)),d.close()}else W(tn,`RPC '${e}' stream ${r} received:`,L),E.u_(L)}})),T(a,lS.STAT_EVENT,(C=>{C.stat===Kp.PROXY?W(tn,`RPC '${e}' stream ${r} detected buffering proxy`):C.stat===Kp.NOPROXY&&W(tn,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function iC(){return typeof window<"u"?window:null}function oh(){return typeof document<"u"?document:null}function ho(n){return new ZF(n,!0)}class gg{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&W("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const zI="PersistentStream";class oC{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new gg(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(St(t.toString()),St("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new B(M.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return W(zI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(W(zI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class H2 extends oC{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=n2(this.serializer,e),s=(function(i){if(!("targetChange"in i))return me.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?me.min():o.readTime?Rt(o.readTime):me.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=cm(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=Gh(l)?{documents:SR(i,l)}:{query:Wd(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=IR(i,o.resumeToken);const u=am(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(me.min())>0){a.readTime=Ea(i,o.snapshotVersion.toTimestamp());const u=am(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const s=r2(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=cm(this.serializer),t.removeTarget=e,this.q_(t)}}class Q2 extends oC{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return pe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,pe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){pe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=s2(e.writeResults,e.commitTime),s=Rt(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=cm(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>kc(this.serializer,s)))};this.q_(t)}}class Y2{}class J2 extends Y2{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,lm(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(M.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,lm(t,s),r,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(M.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class X2{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(St(t),this.aa=!1):W("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const so="RemoteStore";class Z2{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{oi(this)&&(W(so,"Restarting streams for network reachability change."),await(async function(l){const u=te(l);u.Ea.add(4),await Ba(u),u.Ra.set("Unknown"),u.Ea.delete(4),await ru(u)})(this))}))})),this.Ra=new X2(s,r)}}async function ru(n){if(oi(n))for(const e of n.da)await e(!0)}async function Ba(n){for(const e of n.da)await e(!1)}function Jd(n,e){const t=te(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Eg(t)?vg(t):$a(t).O_()&&yg(t,e))}function wa(n,e){const t=te(n),s=$a(t);t.Ia.delete(e),s.O_()&&aC(t,e),t.Ia.size===0&&(s.O_()?s.L_():oi(t)&&t.Ra.set("Unknown"))}function yg(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$a(n).Y_(e)}function aC(n,e){n.Va.Ue(e),$a(n).Z_(e)}function vg(n){n.Va=new QF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),$a(n).start(),n.Ra.ua()}function Eg(n){return oi(n)&&!$a(n).x_()&&n.Ia.size>0}function oi(n){return te(n).Ea.size===0}function lC(n){n.Va=void 0}async function eU(n){n.Ra.set("Online")}async function tU(n){n.Ia.forEach(((e,t)=>{yg(n,e)}))}async function nU(n,e){lC(n),Eg(n)?(n.Ra.ha(e),vg(n)):n.Ra.set("Unknown")}async function sU(n,e,t){if(n.Ra.set("Online"),e instanceof ER&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))})(n,e)}catch(s){W(so,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await ed(n,s)}else if(e instanceof rh?n.Va.Ze(e):e instanceof vR?n.Va.st(e):n.Va.tt(e),!t.isEqual(me.min()))try{const s=await YR(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(It.EMPTY_BYTE_STRING,h.snapshotVersion)),aC(i,l);const d=new $s(h.target,l,u,h.sequenceNumber);yg(i,d)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(s){W(so,"Failed to raise snapshot:",s),await ed(n,s)}}async function ed(n,e,t){if(!ri(e))throw e;n.Ea.add(1),await Ba(n),n.Ra.set("Offline"),t||(t=()=>YR(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{W(so,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ru(n)}))}function cC(n,e){return e().catch((t=>ed(n,t,e)))}async function qa(n){const e=te(n),t=Zr(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:jr;for(;rU(e);)try{const r=await B2(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,iU(e,r)}catch(r){await ed(e,r)}uC(e)&&hC(e)}function rU(n){return oi(n)&&n.Ta.length<10}function iU(n,e){n.Ta.push(e);const t=Zr(n);t.O_()&&t.X_&&t.ea(e.mutations)}function uC(n){return oi(n)&&!Zr(n).x_()&&n.Ta.length>0}function hC(n){Zr(n).start()}async function oU(n){Zr(n).ra()}async function aU(n){const e=Zr(n);for(const t of n.Ta)e.ea(t.mutations)}async function lU(n,e,t){const s=n.Ta.shift(),r=rg.from(s,e,t);await cC(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await qa(n)}async function cU(n,e){e&&Zr(n).X_&&await(async function(s,r){if((function(o){return _R(o)&&o!==M.ABORTED})(r.code)){const i=s.Ta.shift();Zr(s).B_(),await cC(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await qa(s)}})(n,e),uC(n)&&hC(n)}async function HI(n,e){const t=te(n);t.asyncQueue.verifyOperationInProgress(),W(so,"RemoteStore received new credentials");const s=oi(t);t.Ea.add(3),await Ba(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ru(t)}async function _m(n,e){const t=te(n);e?(t.Ea.delete(2),await ru(t)):e||(t.Ea.add(2),await Ba(t),t.Ra.set("Unknown"))}function $a(n){return n.ma||(n.ma=(function(t,s,r){const i=te(t);return i.sa(),new H2(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:eU.bind(null,n),t_:tU.bind(null,n),r_:nU.bind(null,n),H_:sU.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Eg(n)?vg(n):n.Ra.set("Unknown")):(await n.ma.stop(),lC(n))}))),n.ma}function Zr(n){return n.fa||(n.fa=(function(t,s,r){const i=te(t);return i.sa(),new Q2(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:oU.bind(null,n),r_:cU.bind(null,n),ta:aU.bind(null,n),na:lU.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await qa(n)):(await n.fa.stop(),n.Ta.length>0&&(W(so,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Ig{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Wt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new Ig(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ja(n,e){if(St("AsyncQueue",`${e}: ${n}`),ri(n))return new B(M.UNAVAILABLE,`${e}: ${n}`);throw n}class qi{static emptySet(e){return new qi(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||ee.comparator(t.key,s.key):(t,s)=>ee.comparator(t.key,s.key),this.keyedMap=Cl(),this.sortedSet=new dt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new qi;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class QI{constructor(){this.ga=new dt(ee.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):de(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class ro{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new ro(e,t,qi.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class uU{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class hU{constructor(){this.queries=YI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=te(t),i=r.queries;r.queries=YI(),i.forEach(((o,a)=>{for(const l of a.Sa)l.onError(s)}))})(this,new B(M.ABORTED,"Firestore shutting down"))}}function YI(){return new lr((n=>tR(n)),Zc)}async function Tg(n,e){const t=te(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new uU,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=ja(o,`Initialization of query '${ko(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&bg(t)}async function wg(n,e){const t=te(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function dU(n,e){const t=te(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&bg(t)}function fU(n,e,t){const s=te(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function bg(n){n.Ca.forEach((e=>{e.next()}))}var gm,JI;(JI=gm||(gm={})).Ma="default",JI.Cache="cache";class Ag{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new ro(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ro.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==gm.Cache}}class dC{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class XI{constructor(e){this.serializer=e}$s(e){return Ss(this.serializer,e)}Us(e){return e.metadata.exists?Kd(this.serializer,e.document,!1):_t.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Rt(e)}}class Sg{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=fC(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const s=Ne.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(s.get(s.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,s=new XI(this.serializer);for(const r of e)if(r.metadata.queries){const i=s.$s(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||Re()).add(i);t.set(o,a)}}return t}async ja(e){const t=await q2(e,new XI(this.serializer),this.Wa,this.Ua.id),s=this.za(this.documents);for(const r of this.Ka)await $2(e,r,s.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function fC(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class pC{constructor(e){this.key=e}}class mC{constructor(e){this.key=e}}class _C{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Re(),this.mutatedKeys=Re(),this.eu=sR(e),this.tu=new qi(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new QI,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,d)=>{const f=r.get(h),_=eu(this.query,d)?d:null,E=!!f&&this.mutatedKeys.has(f.key),T=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let C=!1;f&&_?f.data.isEqual(_.data)?E!==T&&(s.track({type:3,doc:_}),C=!0):this.su(f,_)||(s.track({type:2,doc:_}),C=!0,(l&&this.eu(_,l)>0||u&&this.eu(_,u)<0)&&(a=!0)):!f&&_?(s.track({type:0,doc:_}),C=!0):f&&!_&&(s.track({type:1,doc:f}),C=!0,(l||u)&&(a=!0)),C&&(_?(o=o.add(_),i=T?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,d)=>(function(_,E){const T=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de(20277,{Rt:C})}};return T(_)-T(E)})(h.type,d.type)||this.eu(h.doc,d.doc))),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new ro(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new QI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Re(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new mC(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new pC(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Re();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ro.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ai="SyncEngine";class pU{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class mU{constructor(e){this.key=e,this.hu=!1}}class _U{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new lr((a=>tR(a)),Zc),this.Iu=new Map,this.Eu=new Set,this.du=new dt(ee.comparator),this.Au=new Map,this.Ru=new ug,this.Vu={},this.mu=new Map,this.fu=no.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function gU(n,e,t=!0){const s=Xd(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await gC(s,e,t,!0),r}async function yU(n,e){const t=Xd(n);await gC(t,e,!0,!1)}async function gC(n,e,t,s){const r=await Ia(n.localStore,hn(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await Rg(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Jd(n.remoteStore,r),a}async function Rg(n,e,t,s,r){n.pu=(d,f,_)=>(async function(T,C,L,U){let N=C.view.ru(L);N.Cs&&(N=await Jh(T.localStore,C.query,!1).then((({documents:b})=>C.view.ru(b,N))));const k=U&&U.targetChanges.get(C.targetId),G=U&&U.targetMismatches.get(C.targetId)!=null,J=C.view.applyChanges(N,T.isPrimaryClient,k,G);return ym(T,C.targetId,J.au),J.snapshot})(n,d,f,_);const i=await Jh(n.localStore,e,!0),o=new _C(e,i.Qs),a=o.ru(i.documents),l=su.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);ym(n,t,u.au);const h=new pU(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function vU(n,e,t){const s=te(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Zc(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Ta(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&wa(s.remoteStore,r.targetId),ba(s,r.targetId)})).catch(si)):(ba(s,r.targetId),await Ta(s.localStore,r.targetId,!0))}async function EU(n,e){const t=te(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),wa(t.remoteStore,s.targetId))}async function IU(n,e,t){const s=kg(n);try{const r=await(function(o,a){const l=te(o),u=Qe.now(),h=a.reduce(((_,E)=>_.add(E.key)),Re());let d,f;return l.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let E=An(),T=Re();return l.Ns.getEntries(_,h).next((C=>{E=C,E.forEach(((L,U)=>{U.isValidDocument()||(T=T.add(L))}))})).next((()=>l.localDocuments.getOverlayedDocuments(_,E))).next((C=>{d=C;const L=[];for(const U of a){const N=WF(U,d.get(U.key).overlayedDocument);N!=null&&L.push(new cr(U.key,N,GS(N.value.mapValue),vt.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,L,a)})).next((C=>{f=C;const L=C.applyToLocalDocumentSet(d,T);return l.documentOverlayCache.saveOverlays(_,C.batchId,L)}))})).then((()=>({batchId:f.batchId,changes:iR(d)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new dt(Ie)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(s,r.batchId,t),await ur(s,r.changes),await qa(s.remoteStore)}catch(r){const i=ja(r,"Failed to persist write");t.reject(i)}}async function yC(n,e){const t=te(n);try{const s=await U2(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(pe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?pe(o.hu,14607):r.removedDocuments.size>0&&(pe(o.hu,42227),o.hu=!1))})),await ur(t,s,e)}catch(s){await si(s)}}function ZI(n,e,t){const s=te(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)})),(function(o,a){const l=te(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,d)=>{for(const f of d.Sa)f.va(a)&&(u=!0)})),u&&bg(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function TU(n,e,t){const s=te(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new dt(ee.comparator);o=o.insert(i,_t.newNoDocument(i,me.min()));const a=Re().add(i),l=new nu(me.min(),new Map,new dt(Ie),o,a);await yC(s,l),s.du=s.du.remove(i),s.Au.delete(e),Ng(s)}else await Ta(s.localStore,e,!1).then((()=>ba(s,e,t))).catch(si)}async function wU(n,e){const t=te(n),s=e.batch.batchId;try{const r=await F2(t.localStore,e);Pg(t,s,null),Cg(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await ur(t,r)}catch(r){await si(r)}}async function bU(n,e,t){const s=te(n);try{const r=await(function(o,a){const l=te(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((d=>(pe(d!==null,37113),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(s.localStore,e);Pg(s,e,t),Cg(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await ur(s,r)}catch(r){await si(r)}}async function AU(n,e){const t=te(n);oi(t.remoteStore)||W(ai,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await(function(o){const a=te(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l)))})(t.localStore);if(s===jr)return void e.resolve();const r=t.mu.get(s)||[];r.push(e),t.mu.set(s,r)}catch(s){const r=ja(s,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}function Cg(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Pg(n,e,t){const s=te(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function ba(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||vC(n,s)}))}function vC(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(wa(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ng(n))}function ym(n,e,t){for(const s of t)s instanceof pC?(n.Ru.addReference(s.key,e),SU(n,s)):s instanceof mC?(W(ai,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||vC(n,s.key)):de(19791,{wu:s})}function SU(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(W(ai,"New document in limbo: "+t),n.Eu.add(s),Ng(n))}function Ng(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ee(Ne.fromString(e)),s=n.fu.next();n.Au.set(s,new mU(t)),n.du=n.du.insert(t,s),Jd(n.remoteStore,new $s(hn(La(t.path)),s,"TargetPurposeLimboResolution",wn.ce))}}async function ur(n,e,t){const s=te(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,l)=>{o.push(s.pu(l,e,t).then((u=>{if((u||t)&&s.isPrimaryClient){const h=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=pg.As(l.targetId,u);i.push(h)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(l,u){const h=te(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(d=>D.forEach(u,(f=>D.forEach(f.Es,(_=>h.persistence.referenceDelegate.addReference(d,f.targetId,_))).next((()=>D.forEach(f.ds,(_=>h.persistence.referenceDelegate.removeReference(d,f.targetId,_)))))))))}catch(d){if(!ri(d))throw d;W(mg,"Failed to update sequence numbers: "+d)}for(const d of u){const f=d.targetId;if(!d.fromCache){const _=h.Ms.get(f),E=_.snapshotVersion,T=_.withLastLimboFreeSnapshotVersion(E);h.Ms=h.Ms.insert(f,T)}}})(s.localStore,i))}async function RU(n,e){const t=te(n);if(!t.currentUser.isEqual(e)){W(ai,"User change. New user:",e.toKey());const s=await QR(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new B(M.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await ur(t,s.Ls)}}function CU(n,e){const t=te(n),s=t.Au.get(e);if(s&&s.hu)return Re().add(s.key);{let r=Re();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}async function PU(n,e){const t=te(n),s=await Jh(t.localStore,e.query,!0),r=e.view.cu(s);return t.isPrimaryClient&&ym(t,e.targetId,r.au),r}async function NU(n,e){const t=te(n);return ZR(t.localStore,e).then((s=>ur(t,s)))}async function kU(n,e,t,s){const r=te(n),i=await(function(a,l){const u=te(a),h=te(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",(d=>h.er(d,l).next((f=>f?u.localDocuments.getDocuments(d,f):D.resolve(null)))))})(r.localStore,e);i!==null?(t==="pending"?await qa(r.remoteStore):t==="acknowledged"||t==="rejected"?(Pg(r,e,s||null),Cg(r,e),(function(a,l){te(te(a).mutationQueue).ir(l)})(r.localStore,e)):de(6720,"Unknown batchState",{Su:t}),await ur(r,i)):W(ai,"Cannot apply mutation batch with id: "+e)}async function xU(n,e){const t=te(n);if(Xd(t),kg(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),r=await eT(t,s.toArray());t.gu=!0,await _m(t.remoteStore,!0);for(const i of r)Jd(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const s=[];let r=Promise.resolve();t.Iu.forEach(((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):r=r.then((()=>(ba(t,o),Ta(t.localStore,o,!0)))),wa(t.remoteStore,o)})),await r,await eT(t,s),(function(o){const a=te(o);a.Au.forEach(((l,u)=>{wa(a.remoteStore,u)})),a.Ru.Jr(),a.Au=new Map,a.du=new dt(ee.comparator)})(t),t.gu=!1,await _m(t.remoteStore,!1)}}async function eT(n,e,t){const s=te(n),r=[],i=[];for(const o of e){let a;const l=s.Iu.get(o);if(l&&l.length!==0){a=await Ia(s.localStore,hn(l[0]));for(const u of l){const h=s.Tu.get(u),d=await PU(s,h);d.snapshot&&i.push(d.snapshot)}}else{const u=await XR(s.localStore,o);a=await Ia(s.localStore,u),await Rg(s,EC(u),o,!1,a.resumeToken)}r.push(a)}return s.Pu.H_(i),r}function EC(n){return XS(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function DU(n){return(function(t){return te(te(t).persistence).Ts()})(te(n).localStore)}async function VU(n,e,t,s){const r=te(n);if(r.gu)return void W(ai,"Ignoring unexpected query state notification.");const i=r.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await ZR(r.localStore,nR(i[0])),a=nu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",It.EMPTY_BYTE_STRING);await ur(r,o,a);break}case"rejected":await Ta(r.localStore,e,!0),ba(r,e,s);break;default:de(64155,t)}}async function OU(n,e,t){const s=Xd(n);if(s.gu){for(const r of e){if(s.Iu.has(r)&&s.sharedClientState.isActiveQueryTarget(r)){W(ai,"Adding an already active target "+r);continue}const i=await XR(s.localStore,r),o=await Ia(s.localStore,i);await Rg(s,EC(i),o.targetId,!1,o.resumeToken),Jd(s.remoteStore,o)}for(const r of t)s.Iu.has(r)&&await Ta(s.localStore,r,!1).then((()=>{wa(s.remoteStore,r),ba(s,r)})).catch(si)}}function Xd(n){const e=te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=CU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TU.bind(null,e),e.Pu.H_=dU.bind(null,e.eventManager),e.Pu.yu=fU.bind(null,e.eventManager),e}function kg(n){const e=te(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bU.bind(null,e),e}function MU(n,e,t){const s=te(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await(function(_,E){const T=te(_),C=Rt(E.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",(L=>T.Ii.getBundleMetadata(L,E.id))).then((L=>!!L&&L.createTime.compareTo(C)>=0))})(i.localStore,l))return await o.close(),a._completeWith((function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}})(l)),Promise.resolve(new Set);a._updateProgress(fC(l));const u=new Sg(l,o.serializer);let h=await o.bu();for(;h;){const f=await u.Ga(h);f&&a._updateProgress(f),h=await o.bu()}const d=await u.ja(i.localStore);return await ur(i,d.Ha,void 0),await(function(_,E){const T=te(_);return T.persistence.runTransaction("Save bundle","readwrite",(C=>T.Ii.saveBundleMetadata(C,E)))})(i.localStore,l),a._completeWith(d.progress),Promise.resolve(d.Ja)}catch(l){return Fn(ai,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(s,e,t).then((r=>{s.sharedClientState.notifyBundleLoaded(r)}))}class Aa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ho(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return HR(this.persistence,new zR,e.initialUser,this.serializer)}Cu(e){return new hg(Yd.mi,this.serializer)}Du(e){return new rC}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Aa.provider={build:()=>new Aa};class xg extends Aa{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){pe(this.persistence.referenceDelegate instanceof Yh,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new qR(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new hg((s=>Yh.mi(s,t)),this.serializer)}}class Dg extends Aa{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await kg(this.xu.syncEngine),await qa(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return HR(this.persistence,new zR,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new qR(s,e.asyncQueue,t)}Mu(e,t){const s=new YL(t,this.persistence);return new QL(e.asyncQueue,s)}Cu(e){const t=fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new dg(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,iC(),oh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new rC}}class IC extends Dg{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof sp&&(this.sharedClientState.syncEngine={Co:kU.bind(null,t),vo:VU.bind(null,t),Fo:OU.bind(null,t),Ts:DU.bind(null,t),Do:NU.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async s=>{await xU(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())}))}Du(e){const t=iC();if(!sp.v(t))throw new B(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new sp(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class ei{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>ZI(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=RU.bind(null,this.syncEngine),await _m(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new hU})()}createDatastore(e){const t=ho(e.databaseInfo.databaseId),s=(function(i){return new z2(i)})(e.databaseInfo);return(function(i,o,a,l){return new J2(i,o,a,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,a){return new Z2(s,r,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>ZI(this.syncEngine,t,0)),(function(){return WI.v()?new WI:new j2})())}createSyncEngine(e,t){return(function(r,i,o,a,l,u,h){const d=new _U(r,i,o,a,l,u);return h&&(d.gu=!0),d})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=te(t);W(so,"RemoteStore shutting down."),s.Ea.add(5),await Ba(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ei.provider={build:()=>new ei};function tT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Zd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):St("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class LU{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Wt,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((s=>{s&&s.$a()?this.metadata.resolve(s.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(s?.Qa)}`))}),(s=>this.metadata.reject(s)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),s=Number(t);isNaN(s)&&this.Qu(`length string (${t}) is not valid number`);const r=await this.$u(s);return new dC(JSON.parse(r),e.length+s)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class FU{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let s=this.bu();if(!s||!s.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(s?.Qa)}`);this.metadata=s;do s=this.bu(),s!==null&&this.elements.push(s);while(s!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new dC(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}class UU{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(r,i){const o=te(r),a={documents:i.map((d=>Nc(o.serializer,d)))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ne.emptyPath(),a,i.length),u=new Map;l.forEach((d=>{const f=t2(o.serializer,d);u.set(f.key.toString(),f)}));const h=[];return i.forEach((d=>{const f=u.get(d.toString());pe(!!f,55234,{key:d}),h.push(f)})),h})(this.datastore,e);return t.forEach((s=>this.recordVersion(s))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ua(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,s)=>{const r=ee.fromPath(s);this.mutations.push(new ng(r,this.precondition(r)))})),await(async function(s,r){const i=te(s),o={writes:r.map((a=>kc(i.serializer,a)))};await i.Go("Commit",i.serializer.databaseId,Ne.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw de(50498,{Gu:e.constructor.name});t=me.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new B(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(me.min())?vt.exists(!1):vt.updateTime(t):vt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(me.min()))throw new B(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vt.updateTime(t)}return vt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class BU{constructor(e,t,s,r,i){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=i,this.zu=s.maxAttempts,this.M_=new gg(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new UU(this.datastore),t=this.Hu(e);t&&t.then((s=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(s)})).catch((r=>{this.Yu(r)}))))})).catch((s=>{this.Yu(s)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Yc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!_R(t)}return!1}}const ti="FirestoreClient";class qU{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Gt.UNAUTHENTICATED,this.clientId=Vd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{W(ti,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(W(ti,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=ja(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function ip(n,e){n.asyncQueue.verifyOperationInProgress(),W(ti,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await QR(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function nT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Vg(n);W(ti,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>HI(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>HI(e.remoteStore,r))),n._onlineComponents=e}async function Vg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){W(ti,"Using user provided OfflineComponentProvider");try{await ip(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===M.FAILED_PRECONDITION||r.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Fn("Error using user provided cache. Falling back to memory cache: "+t),await ip(n,new Aa)}}else W(ti,"Using default OfflineComponentProvider"),await ip(n,new xg(void 0));return n._offlineComponents}async function ef(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(W(ti,"Using user provided OnlineComponentProvider"),await nT(n,n._uninitializedComponentsProvider._online)):(W(ti,"Using default OnlineComponentProvider"),await nT(n,new ei))),n._onlineComponents}function TC(n){return Vg(n).then((e=>e.persistence))}function Ga(n){return Vg(n).then((e=>e.localStore))}function wC(n){return ef(n).then((e=>e.remoteStore))}function Og(n){return ef(n).then((e=>e.syncEngine))}function bC(n){return ef(n).then((e=>e.datastore))}async function Sa(n){const e=await ef(n),t=e.eventManager;return t.onListen=gU.bind(null,e.syncEngine),t.onUnlisten=vU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=EU.bind(null,e.syncEngine),t}function $U(n){return n.asyncQueue.enqueue((async()=>{const e=await TC(n),t=await wC(n);return e.setNetworkEnabled(!0),(function(r){const i=te(r);return i.Ea.delete(0),ru(i)})(t)}))}function jU(n){return n.asyncQueue.enqueue((async()=>{const e=await TC(n),t=await wC(n);return e.setNetworkEnabled(!1),(async function(r){const i=te(r);i.Ea.add(0),await Ba(i),i.Ra.set("Offline")})(t)}))}function GU(n,e){const t=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await(function(u,h){const d=te(u);return d.persistence.runTransaction("read document","readonly",(f=>d.localDocuments.getDocument(f,h)))})(r,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=ja(a,`Failed to get document '${i} from cache`);o.reject(l)}})(await Ga(n),e,t))),t.promise}function AC(n,e,t={}){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new Zd({next:f=>{h.Nu(),o.enqueueAndForget((()=>wg(i,d)));const _=f.docs.has(a);!_&&f.fromCache?u.reject(new B(M.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&f.fromCache&&l&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new Ag(La(a.path),h,{includeMetadataChanges:!0,qa:!0});return Tg(i,d)})(await Sa(n),n.asyncQueue,e,t,s))),s.promise}function KU(n,e){const t=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await Jh(r,i,!0),l=new _C(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=ja(a,`Failed to execute query '${i} against cache`);o.reject(l)}})(await Ga(n),e,t))),t.promise}function SC(n,e,t={}){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new Zd({next:f=>{h.Nu(),o.enqueueAndForget((()=>wg(i,d))),f.fromCache&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new Ag(a,h,{includeMetadataChanges:!0,qa:!0});return Tg(i,d)})(await Sa(n),n.asyncQueue,e,t,s))),s.promise}function WU(n,e,t){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>{try{const r=await bC(n);s.resolve((async function(o,a,l){const u=te(o),{request:h,gt:d,parent:f}=RR(u.serializer,ZS(a),l);u.connection.$o||delete h.parent;const _=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,f,h,1)).filter((T=>!!T.result));pe(_.length===1,64727);const E=_[0].result?.aggregateFields;return Object.keys(E).reduce(((T,C)=>(T[d[C]]=E[C],T)),{})})(r,e,t))}catch(r){s.reject(r)}})),s.promise}function zU(n,e){const t=new Zd(e);return n.asyncQueue.enqueueAndForget((async()=>(function(r,i){te(r).Ca.add(i),i.next()})(await Sa(n),t))),()=>{t.Nu(),n.asyncQueue.enqueueAndForget((async()=>(function(r,i){te(r).Ca.delete(i)})(await Sa(n),t)))}}function HU(n,e,t,s){const r=(function(o,a){let l;return l=typeof o=="string"?yR().encode(o):o,(function(h,d){return new LU(h,d)})((function(h,d){if(h instanceof Uint8Array)return tT(h,d);if(h instanceof ArrayBuffer)return tT(new Uint8Array(h),d);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(l),a)})(t,ho(e));n.asyncQueue.enqueueAndForget((async()=>{MU(await Og(n),r,s)}))}function QU(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){const i=te(s);return i.persistence.runTransaction("Get named query","readonly",(o=>i.Ii.getNamedQuery(o,r)))})(await Ga(n),e)))}function RC(n,e){return(function(s,r){return new FU(s,r)})(n,e)}function YU(n,e){return n.asyncQueue.enqueue((async()=>(async function(s,r){const i=te(s),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",(l=>o.getFieldIndexes(l).next((u=>(function(d,f,_,E,T){d=[...d],f=[...f],d.sort(_),f.sort(_);const C=d.length,L=f.length;let U=0,N=0;for(;U<L&&N<C;){const k=_(d[N],f[U]);k<0?T(d[N++]):k>0?E(f[U++]):(U++,N++)}for(;U<L;)E(f[U++]);for(;N<C;)T(d[N++])})(u,r,KL,(h=>{a.push(o.addFieldIndex(l,h))}),(h=>{a.push(o.deleteFieldIndex(l,h))})))).next((()=>D.waitFor(a)))))})(await Ga(n),e)))}function JU(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){te(s).Fs.Vs=r})(await Ga(n),e)))}function XU(n){return n.asyncQueue.enqueue((async()=>(function(t){const s=te(t),r=s.indexManager;return s.persistence.runTransaction("Delete All Indexes","readwrite",(i=>r.deleteAllFieldIndexes(i)))})(await Ga(n))))}function CC(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const sT=new Map;const PC="firestore.googleapis.com",rT=!0;class iT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=PC,this.ssl=rT}else this.host=e.host,this.ssl=e.ssl??rT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=MR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<BR)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=CC(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class iu{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new fS;switch(s.type){case"firstParty":return new FL(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new B(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=sT.get(t);s&&(W("ComponentProvider","Removing Datastore"),sT.delete(t),s.terminate())})(this),Promise.resolve()}}function NC(n,e,t,s={}){n=ke(n,iu);const r=rr(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(Id(`https://${a}`),Zm("Firestore",!0)),i.host!==PC&&i.host!==a&&Fn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!Kn(l,o)&&(n._setSettings(l),s.mockUserToken)){let u,h;if(typeof s.mockUserToken=="string")u=s.mockUserToken,h=Gt.MOCK_USER;else{u=nb(s.mockUserToken,n._app?.options.projectId);const d=s.mockUserToken.sub||s.mockUserToken.user_id;if(!d)throw new B(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Gt(d)}n._authCredentials=new OL(new dS(u,h))}}class Lt{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Lt(this.firestore,e,this._query)}}class Xe{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xe(this.firestore,e,this._key)}toJSON(){return{type:Xe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(uo(t,Xe._jsonSchema))return new Xe(e,s||null,new ee(Ne.fromString(t.referencePath)))}}Xe._jsonSchemaVersion="firestore/documentReference/1.0",Xe._jsonSchema={type:Nt("string",Xe._jsonSchemaVersion),referencePath:Nt("string")};class is extends Lt{constructor(e,t,s){super(e,t,La(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xe(this.firestore,null,new ee(e))}withConverter(e){return new is(this.firestore,e,this._path)}}function ZU(n,e,...t){if(n=je(n),j_("collection","path",e),n instanceof iu){const s=Ne.fromString(e,...t);return zE(s),new is(n,null,s)}{if(!(n instanceof Xe||n instanceof is))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ne.fromString(e,...t));return zE(s),new is(n.firestore,null,s)}}function e4(n,e){if(n=ke(n,iu),j_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Lt(n,null,(function(s){return new ar(Ne.emptyPath(),s)})(e))}function Mg(n,e,...t){if(n=je(n),arguments.length===1&&(e=Vd.newId()),j_("doc","path",e),n instanceof iu){const s=Ne.fromString(e,...t);return WE(s),new Xe(n,null,new ee(s))}{if(!(n instanceof Xe||n instanceof is))throw new B(M.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ne.fromString(e,...t));return WE(s),new Xe(n.firestore,n instanceof is?n.converter:null,new ee(s))}}function t4(n,e){return n=je(n),e=je(e),(n instanceof Xe||n instanceof is)&&(e instanceof Xe||e instanceof is)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Lg(n,e){return n=je(n),e=je(e),n instanceof Lt&&e instanceof Lt&&n.firestore===e.firestore&&Zc(n._query,e._query)&&n.converter===e.converter}const oT="AsyncQueue";class aT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new gg(this,"async_queue_retry"),this._c=()=>{const s=oh();s&&W(oT,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=oh();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=oh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Wt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ri(e))throw e;W(oT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,St("INTERNAL UNHANDLED ERROR: ",lT(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Ig.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&de(47125,{Pc:lT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function lT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Qo(n){return(function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1})(n,["next","error","complete"])}class kC{constructor(){this._progressObserver={},this._taskCompletionResolver=new Wt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,s){this._progressObserver={next:e,error:t,complete:s}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const n4=-1;class tt extends iu{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new aT,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new aT(e),this._firestoreClient=void 0,await e}}}function vm(n,e,t){t||(t=Sc);const s=xa(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),i=s.getOptions(t);if(Kn(i,e))return r;throw new B(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<BR)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&rr(e.host)&&Id(e.host),s.initialize({options:e,instanceIdentifier:t})}function ah(n,e){const t=typeof n=="object"?n:n_(),s=typeof n=="string"?n:e||Sc,r=xa(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=Zw("firestore");i&&NC(r,...i)}return r}function Et(n){if(n._terminated)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||xC(n),n._firestoreClient}function xC(n){const e=n._freezeSettings(),t=(function(r,i,o,a){return new AF(r,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,CC(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new qU(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}function s4(n,e){Fn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return DC(n,ei.provider,{build:s=>new Dg(s,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function r4(n){Fn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();DC(n,ei.provider,{build:t=>new IC(t,e.cacheSizeBytes)})}function DC(n,e,t){if((n=ke(n,tt))._firestoreClient||n._terminated)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(M.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},xC(n)}function i4(n){if(n._initialized&&!n._terminated)throw new B(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Wt;return n._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(s){if(!As.v())return Promise.resolve();const r=s+WR;await As.delete(r)})(fg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function o4(n){return(function(t){const s=new Wt;return t.asyncQueue.enqueueAndForget((async()=>AU(await Og(t),s))),s.promise})(Et(n=ke(n,tt)))}function a4(n){return $U(Et(n=ke(n,tt)))}function l4(n){return jU(Et(n=ke(n,tt)))}function c4(n){return ox(n.app,"firestore",n._databaseId.database),n._delete()}function Em(n,e){const t=Et(n=ke(n,tt)),s=new kC;return HU(t,n._databaseId,e,s),s}function VC(n,e){return QU(Et(n=ke(n,tt)),e).then((t=>t?new Lt(n,null,t.query):null))}class Ra{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class OC{constructor(e,t,s){this._userDataWriter=t,this._data=s,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class In{constructor(e){this._byteString=e}static fromBase64String(e){try{return new In(It.fromBase64String(e))}catch(t){throw new B(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new In(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:In._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(uo(e,In._jsonSchema))return In.fromBase64String(e.bytes)}}In._jsonSchemaVersion="firestore/bytes/1.0",In._jsonSchema={type:Nt("string",In._jsonSchemaVersion),bytes:Nt("string")};class li{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function u4(){return new li(Hp)}class ci{constructor(e){this._methodName=e}}class os{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ie(this._lat,e._lat)||Ie(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:os._jsonSchemaVersion}}static fromJSON(e){if(uo(e,os._jsonSchema))return new os(e.latitude,e.longitude)}}os._jsonSchemaVersion="firestore/geoPoint/1.0",os._jsonSchema={type:Nt("string",os._jsonSchemaVersion),latitude:Nt("number"),longitude:Nt("number")};class jn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:jn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(uo(e,jn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new jn(e.vectorValues);throw new B(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}jn._jsonSchemaVersion="firestore/vectorValue/1.0",jn._jsonSchema={type:Nt("string",jn._jsonSchemaVersion),vectorValues:Nt("object")};const h4=/^__.*__$/;class d4{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new cr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fa(e,this.data,t,this.fieldTransforms)}}class MC{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new cr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function LC(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de(40011,{Ac:n})}}class tf{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new tf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return td(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(LC(this.Ac)&&h4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class f4{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||ho(e)}Cc(e,t,s,r=!1){return new tf({Ac:e,methodName:t,Dc:s,path:gt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fo(n){const e=n._freezeSettings(),t=ho(n._databaseId);return new f4(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nf(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);Gg("Data must be an object, but it was:",o,s);const a=BC(s,o);let l,u;if(i.merge)l=new bn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const f=xc(e,d,t);if(!o.contains(f))throw new B(M.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);$C(h,f)||h.push(f)}l=new bn(h),u=o.fieldTransforms.filter((d=>l.covers(d.field)))}else l=null,u=o.fieldTransforms;return new d4(new Yt(a),l,u)}class ou extends ci{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ou}}function FC(n,e,t){return new tf({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Fg extends ci{_toFieldTransform(e){return new tu(e.path,new ya)}isEqual(e){return e instanceof Fg}}class Ug extends ci{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FC(this,e,!0),s=this.vc.map((i=>po(i,t))),r=new Xi(s);return new tu(e.path,r)}isEqual(e){return e instanceof Ug&&Kn(this.vc,e.vc)}}class Bg extends ci{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FC(this,e,!0),s=this.vc.map((i=>po(i,t))),r=new Zi(s);return new tu(e.path,r)}isEqual(e){return e instanceof Bg&&Kn(this.vc,e.vc)}}class qg extends ci{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new va(e.serializer,lR(e.serializer,this.Fc));return new tu(e.path,t)}isEqual(e){return e instanceof qg&&this.Fc===e.Fc}}function $g(n,e,t,s){const r=n.Cc(1,e,t);Gg("Data must be an object, but it was:",r,s);const i=[],o=Yt.empty();ii(s,((l,u)=>{const h=sf(e,l,t);u=je(u);const d=r.yc(h);if(u instanceof ou)i.push(h);else{const f=po(u,d);f!=null&&(i.push(h),o.set(h,f))}}));const a=new bn(i);return new MC(o,a,r.fieldTransforms)}function jg(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[xc(e,s,t)],l=[r];if(i.length%2!=0)throw new B(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(xc(e,i[f])),l.push(i[f+1]);const u=[],h=Yt.empty();for(let f=a.length-1;f>=0;--f)if(!$C(u,a[f])){const _=a[f];let E=l[f];E=je(E);const T=o.yc(_);if(E instanceof ou)u.push(_);else{const C=po(E,T);C!=null&&(u.push(_),h.set(_,C))}}const d=new bn(u);return new MC(h,d,o.fieldTransforms)}function UC(n,e,t,s=!1){return po(t,n.Cc(s?4:3,e))}function po(n,e){if(qC(n=je(n)))return Gg("Unsupported field value:",e,n),BC(n,e);if(n instanceof ci)return(function(s,r){if(!LC(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const a of s){let l=po(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=je(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return lR(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Qe.fromDate(s);return{timestampValue:Ea(r.serializer,i)}}if(s instanceof Qe){const i=new Qe(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ea(r.serializer,i)}}if(s instanceof os)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof In)return{bytesValue:IR(r.serializer,s._byteString)};if(s instanceof Xe){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ag(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof jn)return(function(o,a){return{mapValue:{fields:{[Y_]:{stringValue:J_},[ma]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return tg(a.serializer,u)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${Od(s)}`)})(n,e)}function BC(n,e){const t={};return OS(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ii(n,((s,r)=>{const i=po(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function qC(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Qe||n instanceof os||n instanceof In||n instanceof Xe||n instanceof ci||n instanceof jn)}function Gg(n,e,t){if(!qC(t)||!_S(t)){const s=Od(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function xc(n,e,t){if((e=je(e))instanceof li)return e._internalPath;if(typeof e=="string")return sf(n,e);throw td("Field path arguments must be of type string or ",n,!1,void 0,t)}const p4=new RegExp("[~\\*/\\[\\]]");function sf(n,e,t){if(e.search(p4)>=0)throw td(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new li(...e.split("."))._internalPath}catch{throw td(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function td(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new B(M.INVALID_ARGUMENT,a+n+l)}function $C(n,e){return n.some((t=>t.isEqual(e)))}class Dc{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new m4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(rf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class m4 extends Dc{data(){return super.data()}}function rf(n,e){return typeof e=="string"?sf(n,e):e instanceof li?e._internalPath:e._delegate._internalPath}function jC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Kg{}class Ka extends Kg{}function _4(n,e,...t){let s=[];e instanceof Kg&&s.push(e),s=s.concat(t),(function(i){const o=i.filter((l=>l instanceof mo)).length,a=i.filter((l=>l instanceof Wa)).length;if(o>1||o>0&&a>0)throw new B(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class Wa extends Ka{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Wa(e,t,s)}_apply(e){const t=this._parse(e);return KC(e._query,t),new Lt(e.firestore,e.converter,im(e._query,t))}_parse(e){const t=fo(e.firestore);return(function(i,o,a,l,u,h,d){let f;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){uT(d,h);const E=[];for(const T of d)E.push(cT(l,i,T));f={arrayValue:{values:E}}}else f=cT(l,i,d)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||uT(d,h),f=UC(a,o,d,h==="in"||h==="not-in");return Le.create(u,h,f)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function g4(n,e,t){const s=e,r=rf("where",n);return Wa._create(r,s,t)}class mo extends Kg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new mo(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Je.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)KC(o,l),o=im(o,l)})(e._query,t),new Lt(e.firestore,e.converter,im(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function y4(...n){return n.forEach((e=>WC("or",e))),mo._create("or",n)}function v4(...n){return n.forEach((e=>WC("and",e))),mo._create("and",n)}class of extends Ka{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new of(e,t)}_apply(e){const t=(function(r,i,o){if(r.startAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Pc(i,o)})(e._query,this._field,this._direction);return new Lt(e.firestore,e.converter,(function(r,i){const o=r.explicitOrderBy.concat([i]);return new ar(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function E4(n,e="asc"){const t=e,s=rf("orderBy",n);return of._create(s,t)}class au extends Ka{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new au(e,t,s)}_apply(e){return new Lt(e.firestore,e.converter,Wh(e._query,this._limit,this._limitType))}}function I4(n){return gS("limit",n),au._create("limit",n,"F")}function T4(n){return gS("limitToLast",n),au._create("limitToLast",n,"L")}class lu extends Ka{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new lu(e,t,s)}_apply(e){const t=GC(e,this.type,this._docOrFields,this._inclusive);return new Lt(e.firestore,e.converter,(function(r,i){return new ar(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)})(e._query,t))}}function w4(...n){return lu._create("startAt",n,!0)}function b4(...n){return lu._create("startAfter",n,!1)}class cu extends Ka{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new cu(e,t,s)}_apply(e){const t=GC(e,this.type,this._docOrFields,this._inclusive);return new Lt(e.firestore,e.converter,(function(r,i){return new ar(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)})(e._query,t))}}function A4(...n){return cu._create("endBefore",n,!1)}function S4(...n){return cu._create("endAt",n,!0)}function GC(n,e,t,s){if(t[0]=je(t[0]),t[0]instanceof Dc)return(function(i,o,a,l,u){if(!l)throw new B(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const d of Ho(i))if(d.field.isKeyField())h.push(Yi(o,l.key));else{const f=l.data.field(d.field);if(Bd(f))throw new B(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(f===null){const _=d.field.canonicalString();throw new B(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(f)}return new Xr(h,u)})(n._query,n.firestore._databaseId,e,t[0]._document,s);{const r=fo(n.firestore);return(function(o,a,l,u,h,d){const f=o.explicitOrderBy;if(h.length>f.length)throw new B(M.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let E=0;E<h.length;E++){const T=h[E];if(f[E].field.isKeyField()){if(typeof T!="string")throw new B(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof T}`);if(!Z_(o)&&T.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${T}' contains a slash.`);const C=o.path.child(Ne.fromString(T));if(!ee.isDocumentKey(C))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const L=new ee(C);_.push(Yi(a,L))}else{const C=UC(l,u,T);_.push(C)}}return new Xr(_,d)})(n._query,n.firestore._databaseId,r,e,t,s)}}function cT(n,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new B(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Z_(e)&&t.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Ne.fromString(t));if(!ee.isDocumentKey(s))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Yi(n,new ee(s))}if(t instanceof Xe)return Yi(n,t._key);throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Od(t)}.`)}function uT(n,e){if(!Array.isArray(n)||n.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function KC(n,e){const t=(function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function WC(n,e){if(!(e instanceof Wa||e instanceof mo))throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Wg{convertValue(e,t="none"){switch(Yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw de(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return ii(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[ma].arrayValue?.values?.map((s=>yt(s.doubleValue)));return new jn(t)}convertGeoPoint(e){return new os(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=qd(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Ac(e));default:return null}}convertTimestamp(e){const t=tr(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Ne.fromString(e);pe(kR(s),9688,{name:e});const r=new Qr(s.get(1),s.get(3)),i=new ee(s.popFirst(5));return r.isEqual(t)||St(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function af(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class zg extends Wg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xe(this.firestore,null,t)}}function R4(n){return new Ra("sum",xc("sum",n))}function C4(n){return new Ra("avg",xc("average",n))}function zC(){return new Ra("count")}function P4(n,e){return n instanceof Ra&&e instanceof Ra&&n.aggregateType===e.aggregateType&&n._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function N4(n,e){return Lg(n.query,e.query)&&Kn(n.data(),e.data())}const HC="NOT SUPPORTED";class js{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Sn extends Dc{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(rf("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Sn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function k4(n,e,t){if(uo(e,Sn._jsonSchema)){if(e.bundle===HC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=ho(n._databaseId),r=RC(e.bundle,s),i=r.Wu(),o=new Sg(r.getMetadata(),s);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Kd(s,a[0].document),u=new ee(Ne.fromString(e.bundleName));return new Sn(n,new zg(n),u,l,new js(!1,!1),t||null)}}Sn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Sn._jsonSchema={type:Nt("string",Sn._jsonSchemaVersion),bundleSource:Nt("string","DocumentSnapshot"),bundleName:Nt("string"),bundle:Nt("string")};class Zl extends Sn{data(e={}){return super.data(e)}}class Rn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new js(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Zl(this._firestore,this._userDataWriter,s.key,s,new js(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((a=>{const l=new Zl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new js(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new Zl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new js(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:D4(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Vd.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function x4(n,e,t){if(uo(e,Rn._jsonSchema)){if(e.bundle===HC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=ho(n._databaseId),r=RC(e.bundle,s),i=r.Wu(),o=new Sg(r.getMetadata(),s);for(const f of i)o.Ga(f);if(o.queries.length!==1)throw new B(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=zd(o.queries[0].bundledQuery),l=o.documents;let u=new qi;l.map((f=>{const _=Kd(s,f.document);u=u.add(_)}));const h=ro.fromInitialDocuments(a,u,Re(),!1,!1),d=new Lt(n,t||null,a);return new Rn(n,new zg(n),d,h)}}function D4(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de(61501,{type:n})}}function V4(n,e){return n instanceof Sn&&e instanceof Sn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Rn&&e instanceof Rn&&n._firestore===e._firestore&&Lg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function QC(n){n=ke(n,Xe);const e=ke(n.firestore,tt);return AC(Et(e),n._key).then((t=>Hg(e,n,t)))}Rn._jsonSchemaVersion="firestore/querySnapshot/1.0",Rn._jsonSchema={type:Nt("string",Rn._jsonSchemaVersion),bundleSource:Nt("string","QuerySnapshot"),bundleName:Nt("string"),bundle:Nt("string")};class ui extends Wg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xe(this.firestore,null,t)}}function O4(n){n=ke(n,Xe);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return GU(t,n._key).then((r=>new Sn(e,s,n._key,r,new js(r!==null&&r.hasLocalMutations,!0),n.converter)))}function M4(n){n=ke(n,Xe);const e=ke(n.firestore,tt);return AC(Et(e),n._key,{source:"server"}).then((t=>Hg(e,n,t)))}function L4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return jC(n._query),SC(t,n._query).then((r=>new Rn(e,s,n,r)))}function F4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return KU(t,n._query).then((r=>new Rn(e,s,n,r)))}function U4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return SC(t,n._query,{source:"server"}).then((r=>new Rn(e,s,n,r)))}function B4(n,e,t){n=ke(n,Xe);const s=ke(n.firestore,tt),r=af(n.converter,e,t);return za(s,[nf(fo(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,vt.none())])}function q4(n,e,t,...s){n=ke(n,Xe);const r=ke(n.firestore,tt),i=fo(r);let o;return o=typeof(e=je(e))=="string"||e instanceof li?jg(i,"updateDoc",n._key,e,t,s):$g(i,"updateDoc",n._key,e),za(r,[o.toMutation(n._key,vt.exists(!0))])}function YC(n){return za(ke(n.firestore,tt),[new Ua(n._key,vt.none())])}function $4(n,e){const t=ke(n.firestore,tt),s=Mg(n),r=af(n.converter,e);return za(t,[nf(fo(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,vt.exists(!1))]).then((()=>s))}function Im(n,...e){n=je(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||Qo(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Qo(e[s])){const l=e[s];e[s]=l.next?.bind(l),e[s+1]=l.error?.bind(l),e[s+2]=l.complete?.bind(l)}let i,o,a;if(n instanceof Xe)o=ke(n.firestore,tt),a=La(n._key.path),i={next:l=>{e[s]&&e[s](Hg(o,n,l))},error:e[s+1],complete:e[s+2]};else{const l=ke(n,Lt);o=ke(l.firestore,tt),a=l._query;const u=new ui(o);i={next:h=>{e[s]&&e[s](new Rn(o,u,l,h))},error:e[s+1],complete:e[s+2]},jC(n._query)}return(function(u,h,d,f){const _=new Zd(f),E=new Ag(h,_,d);return u.asyncQueue.enqueueAndForget((async()=>Tg(await Sa(u),E))),()=>{_.Nu(),u.asyncQueue.enqueueAndForget((async()=>wg(await Sa(u),E)))}})(Et(o),a,r,i)}function j4(n,e,...t){const s=je(n),r=(function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const d of h){if(!(d in l)){u.error=`snapshotJson missing required field: ${d}`;break}const f=l[d];if(typeof f!="string"){u.error=`snapshotJson field '${d}' must be a string.`;break}if(f.length===0){u.error=`snapshotJson field '${d}' cannot be an empty string.`;break}d==="bundle"?u.bundle=f:d==="bundleName"?u.bundleName=f:d==="bundleSource"&&(u.bundleSource=f)}return u})(e);if(r.error)throw new B(M.INVALID_ARGUMENT,r.error);let i,o=0;if(typeof t[o]!="object"||Qo(t[o])||(i=t[o++]),r.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,f,_){let E,T=!1;return Em(u,h.bundle).then((()=>VC(u,h.bundleName))).then((L=>{L&&!T&&(_&&L.withConverter(_),E=Im(L,d||{},f))})).catch((L=>(f.error&&f.error(L),()=>{}))),()=>{T||(T=!0,E&&E())}})(s,r,i,a,t[o])}if(r.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,f,_){let E,T=!1;return Em(u,h.bundle).then((()=>{if(!T){const L=new Xe(u,_||null,ee.fromPath(h.bundleName));E=Im(L,d||{},f)}})).catch((L=>(f.error&&f.error(L),()=>{}))),()=>{T||(T=!0,E&&E())}})(s,r,i,a,t[o])}throw new B(M.INVALID_ARGUMENT,`unsupported bundle source: ${r.bundleSource}`)}function G4(n,e){return zU(Et(n=ke(n,tt)),Qo(e)?e:{next:e})}function za(n,e){return(function(s,r){const i=new Wt;return s.asyncQueue.enqueueAndForget((async()=>IU(await Og(s),r,i))),i.promise})(Et(n),e)}function Hg(n,e,t){const s=t.docs.get(e._key),r=new ui(n);return new Sn(n,r,e._key,s,new js(t.hasPendingWrites,t.fromCache),e.converter)}function K4(n){return JC(n,{count:zC()})}function JC(n,e){const t=ke(n.firestore,tt),s=Et(t),r=VS(e,((i,o)=>new mR(o,i.aggregateType,i._internalFieldPath)));return WU(s,n._query,r).then((i=>(function(a,l,u){const h=new ui(a);return new OC(l,h,u)})(t,n,i)))}class W4{constructor(e){this.kind="memory",this._onlineComponentProvider=ei.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new xg(void 0)}}toJSON(){return{kind:this.kind}}}class z4{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=XC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class H4{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Aa.provider}toJSON(){return{kind:this.kind}}}class Q4{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new xg(e)}}toJSON(){return{kind:this.kind}}}function Y4(){return new H4}function J4(n){return new Q4(n?.cacheSizeBytes)}function X4(n){return new W4(n)}function Tm(n){return new z4(n)}class Z4{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new Dg(t,e?.cacheSizeBytes,this.forceOwnership)}}}class e6{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new IC(t,e?.cacheSizeBytes)}}}function XC(n){return new Z4(n?.forceOwnership)}function wm(){return new e6}const t6={maxAttempts:5};class ZC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fo(e)}set(e,t,s){this._verifyNotCommitted();const r=Mr(e,this._firestore),i=af(r.converter,t,s),o=nf(this._dataReader,"WriteBatch.set",r._key,i,r.converter!==null,s);return this._mutations.push(o.toMutation(r._key,vt.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=Mr(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof li?jg(this._dataReader,"WriteBatch.update",i._key,t,s,r):$g(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,vt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Mr(e,this._firestore);return this._mutations=this._mutations.concat(new Ua(t._key,vt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Mr(n,e){if((n=je(n)).firestore!==e)throw new B(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class n6{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=fo(e)}get(e){const t=Mr(e,this._firestore),s=new zg(this._firestore);return this._transaction.lookup([t._key]).then((r=>{if(!r||r.length!==1)return de(24041);const i=r[0];if(i.isFoundDocument())return new Dc(this._firestore,s,i.key,i,t.converter);if(i.isNoDocument())return new Dc(this._firestore,s,t._key,null,t.converter);throw de(18433,{doc:i})}))}set(e,t,s){const r=Mr(e,this._firestore),i=af(r.converter,t,s),o=nf(this._dataReader,"Transaction.set",r._key,i,r.converter!==null,s);return this._transaction.set(r._key,o),this}update(e,t,s,...r){const i=Mr(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof li?jg(this._dataReader,"Transaction.update",i._key,t,s,r):$g(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Mr(e,this._firestore);return this._transaction.delete(t._key),this}}class eP extends n6{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Mr(e,this._firestore),s=new ui(this._firestore);return super.get(e).then((r=>new Sn(this._firestore,s,t._key,r._document,new js(!1,!1),t.converter)))}}function s6(n,e,t){n=ke(n,tt);const s={...t6,...t};return(function(i){if(i.maxAttempts<1)throw new B(M.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s),(function(i,o,a){const l=new Wt;return i.asyncQueue.enqueueAndForget((async()=>{const u=await bC(i);new BU(i.asyncQueue,u,a,o,l).ju()})),l.promise})(Et(n),(r=>e(new eP(n,r))),s)}function r6(){return new ou("deleteField")}function i6(){return new Fg("serverTimestamp")}function o6(...n){return new Ug("arrayUnion",n)}function a6(...n){return new Bg("arrayRemove",n)}function l6(n){return new qg("increment",n)}function c6(n){return new jn(n)}function u6(n){return Et(n=ke(n,tt)),new ZC(n,(e=>za(n,e)))}function h6(n,e){const t=Et(n=ke(n,tt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Fn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const s=(function(i){const o=typeof i=="string"?(function(u){try{return JSON.parse(u)}catch(h){throw new B(M.INVALID_ARGUMENT,"Failed to parse JSON: "+h?.message)}})(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=hT(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const d of l.fields){const f=sf("setIndexConfiguration",hT(d,"fieldPath"));d.arrayConfig==="CONTAINS"?h.push(new Ui(f,2)):d.order==="ASCENDING"?h.push(new Ui(f,0)):d.order==="DESCENDING"&&h.push(new Ui(f,1))}a.push(new ca(ca.UNKNOWN_ID,u,h,ua.empty()))}return a})(e);return YU(t,s)}function hT(n,e){if(typeof n[e]!="string")throw new B(M.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}class tP{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function d6(n){n=ke(n,tt);const e=dT.get(n);if(e)return e;if(Et(n)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const s=new tP(n);return dT.set(n,s),s}function f6(n){nP(n,!0)}function p6(n){nP(n,!1)}function m6(n){XU(Et(n._firestore)).then((e=>W("deleting all persistent cache indexes succeeded"))).catch((e=>Fn("deleting all persistent cache indexes failed",e)))}function nP(n,e){JU(Et(n._firestore),e).then((t=>W(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Fn(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const dT=new WeakMap;function _6(n){const e=Et(ke(n.firestore,tt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:Wd(t,hn(n._query)).ft}function g6(n,e){const t=VS(e,((i,o)=>new mR(o,i.aggregateType,i._internalFieldPath))),s=Et(ke(n.firestore,tt)),r=s._onlineComponents?.datastore.serializer;return r===void 0?null:RR(r,ZS(n._query),t,!0).request}class y6{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Qg.instance.onExistenceFilterMismatch(e)}}class Qg{constructor(){this.Mc=new Map}static get instance(){return Mu||(Mu=new Qg,(function(t){if(om)throw new Error("a TestingHooksSpi instance is already set");om=t})(Mu)),Mu}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),s=this.Mc;return s.set(t,e),()=>s.delete(t)}}let Mu=null;(function(e,t=!0){(function(r){Ma=r})(ao),Gi(new Kr("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new tt(new ML(s.getProvider("auth-internal")),new UL(o,s.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qr(u.options.projectId,h)})(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),ws(GE,KE,e),ws(GE,KE,"esm2020")})();const v6=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Wg,AggregateField:Ra,AggregateQuerySnapshot:OC,Bytes:In,CACHE_SIZE_UNLIMITED:n4,CollectionReference:is,DocumentReference:Xe,DocumentSnapshot:Sn,FieldPath:li,FieldValue:ci,Firestore:tt,FirestoreError:B,GeoPoint:os,LoadBundleTask:kC,PersistentCacheIndexManager:tP,Query:Lt,QueryCompositeFilterConstraint:mo,QueryConstraint:Ka,QueryDocumentSnapshot:Zl,QueryEndAtConstraint:cu,QueryFieldFilterConstraint:Wa,QueryLimitConstraint:au,QueryOrderByConstraint:of,QuerySnapshot:Rn,QueryStartAtConstraint:lu,SnapshotMetadata:js,Timestamp:Qe,Transaction:eP,VectorValue:jn,WriteBatch:ZC,_AutoId:Vd,_ByteString:It,_DatabaseId:Qr,_DocumentKey:ee,_EmptyAppCheckTokenProvider:BL,_EmptyAuthCredentialsProvider:fS,_FieldPath:gt,_TestingHooks:y6,_cast:ke,_debugAssert:VL,_internalAggregationQueryToProtoRunAggregationQueryRequest:g6,_internalQueryToProtoQueryTarget:_6,_isBase64Available:wF,_logWarn:Fn,_validateIsNotUsedTogether:mS,addDoc:$4,aggregateFieldEqual:P4,aggregateQuerySnapshotEqual:N4,and:v4,arrayRemove:a6,arrayUnion:o6,average:C4,clearIndexedDbPersistence:i4,collection:ZU,collectionGroup:e4,connectFirestoreEmulator:NC,count:zC,deleteAllPersistentCacheIndexes:m6,deleteDoc:YC,deleteField:r6,disableNetwork:l4,disablePersistentCacheIndexAutoCreation:p6,doc:Mg,documentId:u4,documentSnapshotFromJSON:k4,enableIndexedDbPersistence:s4,enableMultiTabIndexedDbPersistence:r4,enableNetwork:a4,enablePersistentCacheIndexAutoCreation:f6,endAt:S4,endBefore:A4,ensureFirestoreConfigured:Et,executeWrite:za,getAggregateFromServer:JC,getCountFromServer:K4,getDoc:QC,getDocFromCache:O4,getDocFromServer:M4,getDocs:L4,getDocsFromCache:F4,getDocsFromServer:U4,getFirestore:ah,getPersistentCacheIndexManager:d6,increment:l6,initializeFirestore:vm,limit:I4,limitToLast:T4,loadBundle:Em,memoryEagerGarbageCollector:Y4,memoryLocalCache:X4,memoryLruGarbageCollector:J4,namedQuery:VC,onSnapshot:Im,onSnapshotResume:j4,onSnapshotsInSync:G4,or:y4,orderBy:E4,persistentLocalCache:Tm,persistentMultipleTabManager:wm,persistentSingleTabManager:XC,query:_4,queryEqual:Lg,querySnapshotFromJSON:x4,refEqual:t4,runTransaction:s6,serverTimestamp:i6,setDoc:B4,setIndexConfiguration:h6,setLogLevel:DL,snapshotEqual:V4,startAfter:b4,startAt:w4,sum:R4,terminate:c4,updateDoc:q4,vector:c6,waitForPendingWrites:o4,where:g4,writeBatch:u6},Symbol.toStringTag,{value:"Module"})),E6=!0,I6=!0,T6=E6,sP=I6,Gs={apiKey:"...",authDomain:"...",databaseURL:"...",projectId:"...",storageBucket:"...",messagingSenderId:"...",appId:"...",measurementId:"..."},w6=!!Gs.apiKey&&!!Gs.authDomain&&!!Gs.projectId&&!!Gs.appId;function b6(n){if(!n||typeof n!="string")return!1;const e=n.trim();return!e||!/^https?:\/\//i.test(e)?!1:!!(e.includes(".firebaseio.com")||e.includes(".firebasedatabase.app"))}const rP=b6(Gs.databaseURL);let Vs=null,Lr=null,ec=null,Yn=null;console.log("[firebase] apiKey=",Gs.apiKey?"(set)":"(missing)");console.log("[firebase] projectId=",Gs.projectId||"(missing)");console.log("[firebase] authDomain=",Gs.authDomain||"(missing)");console.log("[firebase] databaseURL=",rP?"(set)":"(missing/invalid)");console.log("[firebase] MODE=","production","PROD=",!0);console.log("[firebase] REMOTE_ENABLED=",T6);console.log("[firebase] FIRESTORE_PERSISTENCE_ENABLED=",sP);try{w6?(Vs=db(Gs),Lr=yV(Vs)):console.warn("[firebase] Missing VITE_FB_* env config. Running in guest-safe mode.")}catch(n){console.warn("[firebase] initializeApp failed. Running in guest-safe mode:",n),Vs=null,Lr=null}if(Vs){if(!rP)console.warn("[firebase] RTDB disabled: VITE_FB_DATABASE_URL is missing/invalid. Set it like https://<YOUR>.firebaseio.com or https://<YOUR>.firebasedatabase.app"),ec=null;else try{ec=NL(Vs)}catch(n){console.warn("[firebase] getDatabase failed:",n),ec=null}try{typeof vm=="function"?sP&&(typeof Tm=="function"&&typeof wm=="function"?Yn=vm(Vs,{localCache:Tm({tabManager:wm()})}):Yn=ah(Vs)):Yn=ah(Vs)}catch(n){console.warn("[firebase] firestore init failed. Fallback to getFirestore:",n);try{Yn=ah(Vs)}catch(e){console.warn("[firebase] getFirestore failed:",e),Yn=null}}}const Yg=Ae(null),Os=Ae(null),Jg=Ae(!1);let op=!1,Lu=null;const A6=!0;function bm(){Yg.value=null,Os.value=null,Jg.value=!0}function S6(){if(!op){if(!Lr){bm(),op=!0;return}if(typeof Lu=="function"){try{Lu()}catch{}Lu=null}Lu=oD(Lr,n=>{Yg.value=n||null,Jg.value=!0,Os.value=null,n?.uid?console.log("   :  ",n.displayName||n.email):console.log("   :  ")},n=>{Os.value=n,bm(),console.error("onAuthStateChanged error:",n)}),op=!0}}S6();function Xg(){return{user:Yg,authError:Os,authReady:Jg,signInWithGoogle:async()=>{if(!Lr){const s=new Error("     .");throw s.code="AUTH_DISABLED",Os.value=s,s}const t=new Fs;try{const s=await RD(Lr,t);return Os.value=null,console.log("useAuth:  !",s.user.displayName||s.user.email),s.user}catch(s){throw Os.value=s,console.error("useAuth:  :",s),s}},signOutUser:async()=>{if(!Lr)return bm(),!0;try{return await aD(Lr),Os.value=null,console.log("useAuth:  !"),!0}catch(t){throw Os.value=t,console.error("useAuth:  :",t),t}},AUTH_ENABLED:A6}}const R6="modulepreload",C6=function(n){return"/RCTS/"+n},fT={},P6=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};var o=u;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=u(t.map(h=>{if(h=C6(h),h in fT)return;fT[h]=!0;const d=h.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":R6,d||(_.as="script"),_.crossOrigin="",_.href=h,l&&_.setAttribute("nonce",l),document.head.appendChild(_),d)return new Promise((E,T)=>{_.addEventListener("load",E),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return r.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},tc=Ae(0),nc=Ae(!1);let pT=!1,ap=null;function N6(){if(!pT){if(pT=!0,!ec){tc.value=0,nc.value=!0,ap=null;return}ap=EL(ec,"/.info/serverTimeOffset"),TL(ap,n=>{const e=Number(n.val()||0);tc.value=Number.isFinite(e)?e:0,nc.value=!0},n=>{console.warn("ServerTime: offset subscribe failed:",n),tc.value=0,nc.value=!0})}}function k6(){const n=()=>Date.now()+(tc.value||0),e=he(()=>nc.value===!0);return{serverOffsetMs:tc,isServerTimeReady:nc,isServerTimeReadyComputed:e,serverNowMs:n}}const sc=Ae(null),nd=Ae(!1);let Am=!1;const x6=540*60*1e3;function D6(n){return new Date(n+x6)}function V6(n){if(!(n instanceof Date))return"";const e=t=>String(t).padStart(2,"0");return`${e(n.getHours())}:${e(n.getMinutes())}`}function iP(){if(Am)return;Am=!0;let n,e;{const{serverNowMs:s}=k6();n=()=>s(),e=D6}const t=()=>{try{const s=Number(n?.()??Date.now());sc.value=e(s),nd.value=!0}catch(s){sc.value=new Date,nd.value=!0,console.warn("[useKstTime] fallback to local time:",s)}};t(),setInterval(t,6e4)}function oP(){Am||iP();const n=he(()=>nd.value&&sc.value instanceof Date),e=he(()=>n.value?V6(sc.value):"");return{kstDate:sc,isKstTimeReady:nd,isKstReady:n,kstString:e}}const Ct=3600,mT=60,Tl=8*Ct,hi=[{id:"sys_unlock_vehicle",type:"SYSTEM",domain:"vehicle",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"vehicle"}]},{id:"sys_unlock_route",type:"SYSTEM",domain:"route",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"route"}]},{id:"sys_unlock_construction",type:"SYSTEM",domain:"construction",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"construction"}]},{id:"sys_unlock_finance",type:"SYSTEM",domain:"finance",timePolicy:"FIXED",title:"()  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"finance"}]},{id:"sys_unlock_city",type:"SYSTEM",domain:"city",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"city"}]},{id:"sys_preview_starter_vehicles",type:"REAL",domain:"vehicle",timePolicy:"SCALABLE",title:"  ",desc:' (//)    .   ""  ,     . (30,  )',tier:1,durationSec:30*mT,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_STARTER_FLEET_PREVIEW",transports:["bus","truck","rail"],runTimeMinSec:30*mT,runTimeMaxSec:3*Ct,countPerTransport:1,mode:"MANUAL"}]},{id:"sys_preview_auto_assign",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:"  ",desc:"      . (1,  )",tier:1,durationSec:1*Ct,requires:["sys_preview_starter_vehicles"],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_FEATURE",featureKey:"preview_auto_assign"},{type:"SET_PREVIEW_RUN_MODE",mode:"AUTO"}]},{id:"city_scale_region",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  .',tier:1,durationSec:4*Ct,requires:["sys_unlock_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"REGION"}]},{id:"city_scale_city",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  . (  )',tier:1,durationSec:8*Ct,requires:["city_scale_region"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"CITY"}]},{id:"city_scale_country",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . ( / )',tier:1,durationSec:12*Ct,requires:["city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"COUNTRY"}]},{id:"city_scale_state",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:16*Ct,requires:["city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"STATE"}]},{id:"city_scale_planet",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:24*Ct,requires:["city_scale_state"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"PLANET"}]},{id:"unlock_bus_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"bus",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"bus",tier:1}]},{id:"unlock_truck_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"truck",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"truck",tier:1}]},{id:"unlock_rail_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"rail",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"rail",tier:1}]},{id:"unlock_plane_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Ct,requires:["sys_unlock_city","city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"plane",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"plane",tier:1}]},{id:"unlock_ship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Ct,requires:["sys_unlock_city","city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"ship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"ship",tier:1}]},{id:"unlock_spaceship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:3*Ct,requires:["sys_unlock_city","city_scale_planet"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"spaceship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"spaceship",tier:1}]},{id:"rs_1",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  I",desc:"     5% . (SYSTEM  8 )",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:1}]},{id:"rs_2",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  II",desc:"     10% . (SYSTEM  8 )",tier:1,durationSec:2*Ct,requires:["rs_1"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:2}]},{id:"rs_3",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  III",desc:"     15% . (SYSTEM  8 )",tier:1,durationSec:4*Ct,requires:["rs_2"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:3}]},{id:"rs_4",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  IV",desc:"     20% . (SYSTEM  8 )",tier:1,durationSec:8*Ct,requires:["rs_3"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:4}]},{id:"rs_5",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  V",desc:"     25% . (SYSTEM  8 )",tier:1,durationSec:16*Ct,requires:["rs_4"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:5}]},{id:"t2_transport_foundation",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:" 2  ()",desc:"2   .   .",tier:2,durationSec:12*Ct,requires:[],revealAfter:[],enabled:!1,effects:[]}];function Zg(n){return hi.find(e=>e.id===n)||null}function lp(n){return String(Math.max(0,Number(n)||0)).padStart(2,"0")}function _T(n){const e=Math.max(0,Math.floor(Number(n)||0)),t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return{h:t,m:s,sec:r}}function gT({h:n,m:e,sec:t}){return n>0?`${n}h ${lp(e)}m ${lp(t)}s`:e>0?`${e}m ${lp(t)}s`:`${t}s`}function aP(){const n=r=>{const i=Math.max(0,Math.floor(Number(r||0)/1e3));return gT(_T(i))},e=r=>gT(_T(r));return{formatRemainMs:n,formatRemainSec:e,makeRemainLabelFromMs:r=>he(()=>n(r.value)),makeRemainLabelFromSec:r=>he(()=>e(r.value))}}function O6(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="test"?"test":e==="preview"?"preview":e==="prod"?"prod":e==="beta"?"beta":"prod"}function M6(){const n=he(()=>O6("prod")),e=he(()=>n.value==="dev"),t=he(()=>n.value==="test"),s=he(()=>n.value==="preview"),r=he(()=>n.value==="prod");return{channel:n,isDev:e,isTest:t,isPreview:s,isProd:r}}const lP="rcts.research.saveEnabled",cP="rcts.research.autosave.enabled",uP="rcts.research.autosave.base",ey="rcts.research.autosave.intervalMin",{kstDate:hP,isKstTimeReady:dP}=oP(),uu=he(()=>dP.value&&hP.value instanceof Date);function lf(){return uu.value?hP.value.getTime():Date.now()}const L6=new Set(["sys_unlock_vehicle","sys_unlock_route","sys_unlock_construction","sys_unlock_finance","sys_unlock_city"]);function sd(n){return!n||!L6.has(n)?!1:Zg(n)?.enabled===!1}function fP(n){const e=String(n||"").toLowerCase().trim();return e||"prod"}const{isTest:pP}=M6(),hr=he(()=>pP.value?!1:!!Yn),mP=he(()=>pP.value),F6=300;let Fu=null;async function hu(){if(!hr.value)return null;if(Fu)return Fu;const n=await P6(()=>Promise.resolve().then(()=>v6),void 0);return Fu={doc:n.doc,getDoc:n.getDoc,setDoc:n.setDoc,serverTimestamp:n.serverTimestamp,onSnapshot:n.onSnapshot},Fu}async function _P(...n){const e=await hu();return e?e.doc(...n):null}async function U6(n){const e=await hu();return!e||!n?null:e.getDoc(n)}async function ty(n,e,t){const s=await hu();return!s||!n?!1:(await s.setDoc(n,e,t),!0)}async function B6(n,e,t){const s=await hu();return!s||!n?null:s.onSnapshot(n,e,t)}async function ny(){const n=await hu();return n?n.serverTimestamp():null}async function sy(n,e){if(!hr.value)return null;const t=fP(e);return _P(Yn,"worlds",t,"users",n,"research","state")}async function q6(n){return hr.value?_P(Yn,"users",n,"research","state"):null}const Ns=Ae(null),dn=Ae(new Set),it=Ae(null),ht=Ae([]),gP=Ae({}),yP=Ae(1),ry=Ae(0),cf=Ae(1),io=Ae(1),rd=Ae("NONE"),id=Ae({vehicle:!1,route:!1,construction:!1,finance:!1,city:!1}),Ni=Ae(!1),Sm=Ae(!1),qn=Ae(!1),di=Ae(null),$i=Ae("prod");let vn=null,Is=!1,lh=null;const ji=Ae(EP(lP,!0)),Vc=Ae(EP(cP,!1)),iy=Ae(IP(uP,5)),Oc=Ae(IP(ey,10)),oy=Ae(!1),vP=Ae(0);let Vi=null;function EP(n,e){const t=localStorage.getItem(n);return t===null?e:t==="1"}function IP(n,e){const t=localStorage.getItem(n),s=t==null?NaN:Number(t);return Number.isFinite(s)?s:e}function TP(n,e){localStorage.setItem(n,e?"1":"0")}function Rm(n,e){localStorage.setItem(n,String(e))}function uf(n){const e=Math.max(1,Math.min(3,Number(n||1)));return e===1?1:e===2?3:5}function $6(n){ji.value=!!n,TP(lP,ji.value),ji.value?du():(vn&&(clearTimeout(vn),vn=null),En())}function j6(n){Vc.value=!!n,TP(cP,Vc.value),du()}function G6(n){const e=Number(n)===10?10:5;iy.value=e,Rm(uP,e);const t=Number(Oc.value)||e,s=Math.max(e,Math.round(t/e)*e);Oc.value=s,Rm(ey,s),du(!0)}function K6(n){const e=Number(iy.value)===10?10:5,t=Number(n);if(!Number.isFinite(t)||t<=0)return;const s=Math.max(e,Math.round(t/e)*e);Oc.value=s,Rm(ey,s),du(!0)}function W6(n){const e=Number(n);if(!Number.isFinite(e)||e<=0)return 6e4;const t=e*60*1e3,s=540*60*1e3,r=Date.now()+s,o=(Math.floor(r/t)+1)*t-r;return Math.max(1e3,o)}function En(){oy.value=!1,Vi&&(clearTimeout(Vi),Vi=null)}function wP(){if(Vi&&(clearTimeout(Vi),Vi=null),!hr.value||!Vc.value||!ji.value||!di.value||!qn.value||Is)return En();oy.value=!0;const n=Number(Oc.value)||10,e=W6(n);Vi=setTimeout(async()=>{try{await cs({reason:"autosave"}),vP.value=Date.now()}catch(t){console.error("useResearch:  :",t)}finally{wP()}},e)}function du(n=!1){if(n&&En(),!hr.value)return En();Vc.value&&ji.value&&di.value&&qn.value&&!Is?wP():En()}function z6(){vn&&(clearTimeout(vn),vn=null),En(),di.value=null,$i.value="prod",qn.value=!1,Is=!1}function H6(n){return(Array.isArray(n?.requires)?n.requires:[]).every(t=>dn.value.has(t))}function bP(n){const e=Array.isArray(n?.revealAfter)?n.revealAfter:[];return e.length===0?!0:e.every(t=>dn.value.has(t))}function ay(n){return dn.value.has(n)}function Q6(n){return!n||Number(n.tier||1)!==1?!1:(n.effects||[]).some(e=>e?.type==="UNLOCK_TRANSPORT_TIER"&&Number(e?.tier||1)===1&&!!e?.transportId)}function Y6(n){return n?n.timePolicy==="FIXED"?!0:n.type==="SYSTEM":!1}function od(n){switch(String(n||"").toUpperCase()){case"REGION":return 1;case"CITY":return 2;case"COUNTRY":return 3;case"STATE":return 4;case"PLANET":return 5;default:return 0}}function Gr(){const n={};let e=1,t=0,s=1,r="NONE";const i={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1};for(const l of hi)if(dn.value.has(l.id))for(const u of l.effects||[]){if(u.type==="UNLOCK_TRANSPORT_TIER"){const h=u.transportId,d=Number(u.tier||1);if(!h)continue;n[h]=Math.max(Number(n[h]||0),d)}if(u.type==="INCOME_MULTIPLIER"&&(e*=Number(u.value||1)),u.type==="RESEARCH_SPEED_LEVEL"){const h=Number(u.level||0);Number.isFinite(h)&&(t=Math.max(t,h))}if(u.type==="QUEUE_RESERVE_LEVEL"){const h=Number(u.level||1);Number.isFinite(h)&&(s=Math.max(s,h))}if(u.type==="UNLOCK_FEATURE"){const h=String(u.featureKey||"");h&&Object.prototype.hasOwnProperty.call(i,h)&&(i[h]=!0)}if(u.type==="SET_CITY_SCALE"){const h=String(u.scale||"").toUpperCase();od(h)>od(r)&&(r=h)}}gP.value=n,yP.value=e,ry.value=t;const o=1-.05*Math.max(0,t);cf.value=Math.max(.2,o),rd.value=r,id.value=i,io.value=Math.max(1,Math.min(3,s));const a=uf(io.value);ht.value.length>a&&(ht.value=ht.value.slice(0,a))}const J6=he(()=>hi.filter(n=>Number(n?.tier||1)>=2?!0:bP(n))),X6=he(()=>{const n=new Set;for(const e of hi)if(Number(e.tier||1)===1)for(const t of e.effects||[])t.type==="UNLOCK_TRANSPORT_TIER"&&Number(t.tier||1)===1&&t.transportId&&n.add(t.transportId);return Array.from(n)}),Z6=he(()=>!Ns.value),eB=he(()=>X6.value.map(n=>({id:n})));function tB(){return dn.value.has("unlock_bus_t1")||dn.value.has("unlock_truck_t1")||dn.value.has("unlock_rail_t1")}function ly(n){const e=Zg(n);if(!e)return"unknown";const t=Number(e.tier||1);return t===1&&!bP(e)?"hidden":ay(n)?"done":it.value?.id===n?"active":ht.value.includes(n)?"queued":e.enabled===!1?"comingSoon":n==="sys_preview_starter_vehicles"?!Ns.value||!tB()?"locked":"available":t===1&&Q6(e)&&Ns.value||H6(e)?"available":"locked"}function AP(n){return hi.find(t=>t.enabled!==!1&&Number(t.tier||1)===1&&(t.effects||[]).some(s=>s.type==="UNLOCK_TRANSPORT_TIER"&&s.transportId===n&&Number(s.tier||1)===1))?.id??null}function SP(){return!(!hr.value||!di.value||!qn.value||Is)}function nB(){return ji.value?SP():!1}function RP(){const n=uf(io.value);return{version:10,firstUnlockTransportId:Ns.value??null,completedResearchIds:Array.from(dn.value),activeResearch:it.value?{id:it.value.id,startedAtMs:it.value.startedAtMs,endsAtMs:it.value.endsAtMs}:null,queuedResearchIds:Array.isArray(ht.value)?ht.value.slice(0,n):[]}}function sB(n){Ns.value=typeof n?.firstUnlockTransportId=="string"?n.firstUnlockTransportId:typeof n?.firstUnlockId=="string"?n.firstUnlockId:null;const e=Array.isArray(n?.completedResearchIds)?n.completedResearchIds:[];dn.value=new Set(e.filter(o=>typeof o=="string"));const t=n?.activeResearch;t&&typeof t=="object"&&typeof t.id=="string"?it.value={id:t.id,startedAtMs:Number(t.startedAtMs||0),endsAtMs:Number(t.endsAtMs||0)}:it.value=null;const s=Array.isArray(n?.queuedResearchIds)?n.queuedResearchIds.filter(o=>typeof o=="string"):[],r=typeof n?.queuedResearchId=="string"?n.queuedResearchId:null,i=[];for(const o of s)i.includes(o)||i.push(o);if(r&&!i.includes(r)&&i.push(r),ht.value=i,dn.value.size===0&&Array.isArray(n?.transports)){for(const o of n.transports)if(!(!o||typeof o.id!="string")&&o.locked===!1){const a=AP(o.id);a&&dn.value.add(a)}}Gr()}async function cs({reason:n="manual"}={}){if(!SP())return;vn&&(clearTimeout(vn),vn=null);const e=await sy(di.value,$i.value);if(e)try{Sm.value=!0;const t=await ny(),s={...RP(),updatedAt:t,lastSaveReason:n};await ty(e,s,{merge:!0})}catch(t){console.error("useResearch: Firebase  :",t)}finally{Sm.value=!1}}const rB=()=>{nB()&&(vn&&clearTimeout(vn),vn=setTimeout(async()=>{await cs({reason:"debounced"})},800))};function iB(n){if(!n||Ns.value)return;const e=AP(n);e&&(Ns.value=n,dn.value.add(e),Gr(),cs({reason:"firstUnlock"}))}function CP(n){if(sd(n))return{ok:!1,reason:"COMING_SOON"};const e=Zg(n);if(!e)return{ok:!1,reason:"UNKNOWN_RESEARCH"};if(!Ns.value)return{ok:!1,reason:"FIRST_UNLOCK_REQUIRED"};if(!uu.value)return{ok:!1,reason:"KST_NOT_READY"};if(ay(n))return{ok:!1,reason:"ALREADY_DONE"};if(e.enabled===!1)return{ok:!1,reason:"COMING_SOON"};const t=ly(n);if(t!=="available")return{ok:!1,reason:t.toUpperCase()};const s=lf(),r=Number(e.durationSec||0);let i=0;return r>0&&(mP.value?i=F6:Y6(e)?i=Math.ceil(r):i=Math.ceil(r*cf.value)),i<=0?(dn.value.add(n),Gr(),cs({reason:"instantComplete"}),{ok:!0,instant:!0}):(it.value={id:n,startedAtMs:s,endsAtMs:s+i*1e3},cs({reason:"startResearch"}),{ok:!0,instant:!1})}function oB(n){if(sd(n))return{ok:!1,reason:"COMING_SOON"};const e=uf(io.value);if(ay(n))return{ok:!1,reason:"ALREADY_DONE"};if(it.value?.id===n)return{ok:!1,reason:"ALREADY_ACTIVE"};if(ht.value.includes(n))return{ok:!0,queued:!0,alreadyQueued:!0};if(it.value){if(ht.value.length>=e)return{ok:!1,reason:"QUEUE_FULL"};const t=ly(n);return t!=="available"?{ok:!1,reason:t.toUpperCase()}:(ht.value=[...ht.value,n].slice(0,e),cs({reason:"queueAdd"}),{ok:!0,queued:!0})}return CP(n)}function aB(n){const e=ht.value.slice(),t=e.filter(s=>s!==n);t.length!==e.length&&(ht.value=t,cs({reason:"queueCancel"}))}function lB(){ht.value.length!==0&&(ht.value=[],cs({reason:"queueCancelAll"}))}function cB(n){if(!it.value||it.value.id!==n||!uu.value)return 0;const e=it.value.endsAtMs-it.value.startedAtMs;if(e<=0)return 0;const t=lf()-it.value.startedAtMs;return Math.max(0,Math.min(100,t/e*100))}function uB(n){const{formatRemainSec:e}=aP();if(!it.value||it.value.id!==n||!uu.value)return"0s";const t=Math.max(0,it.value.endsAtMs-lf()),s=Math.floor(t/1e3);return e(s)}function PP(){lh&&(lh(),lh=null),vn&&(clearTimeout(vn),vn=null),En(),di.value=null,$i.value="prod",qn.value=!1,Is=!1,Ni.value=!1}async function hB(n,e){if(!hr.value)return!1;const t=await sy(n,e),s=await q6(n);if(!t||!s)return!1;const r=await U6(s);if(!r||!r.exists())return!1;const i=r.data()||{},o=await ny(),a={...i,migratedFromLegacy:!0,migratedAt:o,updatedAt:o,lastSaveReason:"migrateLegacy"};return await ty(t,a,{merge:!0}),!0}async function NP(n,e="prod"){if(!n)return;if(PP(),di.value=n,$i.value=fP(e),!hr.value){Gr(),Ni.value=!1,qn.value=!0,Is=!1,En();return}Ni.value=!0,qn.value=!1;const t=await sy(n,$i.value);if(!t){Ni.value=!1,qn.value=!1;return}lh=await B6(t,async s=>{Is=!0;try{if(s.exists())sB(s.data());else if(await hB(n,$i.value))Gr();else{Gr();const i=await ny(),o={...RP(),createdAt:i,updatedAt:i,lastSaveReason:"init"};await ty(t,o,{merge:!0})}}catch(r){console.error("useResearch: onSnapshot apply failed:",r)}finally{Is=!1,Ni.value=!1,qn.value=!0,du(!0)}},s=>{Is=!1,Ni.value=!1,qn.value=!1,En(),console.error("useResearch: onSnapshot error:",s)})}async function dB(n,e="prod"){await NP(n,e)}function fB(){z6(),Ns.value=null,dn.value=new Set,it.value=null,ht.value=[],rd.value="NONE",id.value={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1},ry.value=0,cf.value=1,io.value=1,Gr()}Vl(()=>{if(Is)return;let n=!1;if(it.value?.id&&sd(it.value.id)&&(it.value=null,n=!0),Array.isArray(ht.value)&&ht.value.length>0){const e=ht.value.filter(t=>!sd(t));e.length!==ht.value.length&&(ht.value=e,n=!0)}n&&cs({reason:"hardLockCleanup"})});Vl(()=>{if(!uu.value)return;const n=lf();if(it.value&&n>=Number(it.value.endsAtMs||0)){const e=it.value.id;if(it.value=null,dn.value.add(e),Gr(),ht.value.length>0){const[t,...s]=ht.value;ht.value=s;const r=CP(t);r?.ok||console.warn("useResearch: queued next start failed:",t,r?.reason)}cs({reason:"researchComplete"})}});function _o(){const n=he(()=>!di.value||qn.value),e=he(()=>uf(io.value)),t=he(()=>ht.value.length),s=he(()=>t.value>=e.value);return{catalog:hi,visibleCatalog:J6,firstUnlockTransportId:Ns,needsFirstUnlockSelection:Z6,firstUnlockCandidates:eB,setFirstUnlockTransport:iB,completedIds:dn,activeResearch:it,queuedResearchIds:ht,queueReserveLevel:io,queueLimit:e,queueCount:t,isQueueFull:s,unlockedTransportTiers:gP,incomeMultiplier:yP,researchSpeedLevel:ry,researchDurationMultiplier:cf,cityScale:rd,unlockedFeatures:id,hasFeature:o=>!!id.value?.[o],cityScaleAtLeast:o=>od(rd.value)>=od(o),getStatus:ly,startResearch:oB,cancelQueuedResearch:aB,cancelAllQueuedResearch:lB,getResearchProgress:cB,getResearchRemainingTime:uB,isKstTimeReady:dP,subscribeForUser:NP,unsubscribe:PP,loadForUser:dB,clearUserState:fB,saveNow:cs,scheduleSave:rB,saveEnabled:ji,setSaveEnabled:$6,autoSaveEnabled:Vc,autoSaveBase:iy,autoSaveIntervalMin:Oc,setAutoSaveEnabled:j6,setAutoSaveBase:G6,setAutoSaveIntervalMin:K6,autoSaveRunning:oy,lastAutoSaveAtMs:vP,isLoadingFirebaseData:Ni,isSavingFirebaseData:Sm,isStateLoaded:qn,isHydrated:n,currentWorld:$i,REMOTE_OK:hr,FORCE_ALL_5MIN:mP}}function pB(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="stage"?"stage":"prod"}function cy(){return{world:he(()=>pB("prod"))}}let yT=!1;function mB(){const{user:n,authReady:e}=Xg(),{world:t}=cy(),s=_o(),r=he(()=>n.value?.uid||null),i=he(()=>!0);return{start:()=>{i.value&&(yT||(Ks([e,r,t],([a,l,u],[h,d,f])=>{if(!a)return;(d&&d!==l||f&&f!==u)&&s.unsubscribe(),l?s.subscribeForUser(l,u):(s.unsubscribe(),s.clearUserState())},{immediate:!0}),yT=!0))}}}const _B={__name:"App",setup(n){return zm(()=>{iP(),mB().start(),N6()}),(e,t)=>{const s=lc("router-view");return Y(),Zo(s)}}};const Vo=typeof document<"u";function kP(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function gB(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&kP(n.default)}const Ge=Object.assign;function cp(n,e){const t={};for(const s in e){const r=e[s];t[s]=us(r)?r.map(n):n(r)}return t}const rc=()=>{},us=Array.isArray;function vT(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}const xP=/#/g,yB=/&/g,vB=/\//g,EB=/=/g,IB=/\?/g,DP=/\+/g,TB=/%5B/g,wB=/%5D/g,VP=/%5E/g,bB=/%60/g,OP=/%7B/g,AB=/%7C/g,MP=/%7D/g,SB=/%20/g;function uy(n){return n==null?"":encodeURI(""+n).replace(AB,"|").replace(TB,"[").replace(wB,"]")}function RB(n){return uy(n).replace(OP,"{").replace(MP,"}").replace(VP,"^")}function Cm(n){return uy(n).replace(DP,"%2B").replace(SB,"+").replace(xP,"%23").replace(yB,"%26").replace(bB,"`").replace(OP,"{").replace(MP,"}").replace(VP,"^")}function CB(n){return Cm(n).replace(EB,"%3D")}function PB(n){return uy(n).replace(xP,"%23").replace(IB,"%3F")}function NB(n){return PB(n).replace(vB,"%2F")}function Mc(n){if(n==null)return null;try{return decodeURIComponent(""+n)}catch{}return""+n}const kB=/\/$/,xB=n=>n.replace(kB,"");function up(n,e,t="/"){let s,r={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return l=a>=0&&l>a?-1:l,l>=0&&(s=e.slice(0,l),i=e.slice(l,a>0?a:e.length),r=n(i.slice(1))),a>=0&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=MB(s??e,t),{fullPath:s+i+o,path:s,query:r,hash:Mc(o)}}function DB(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ET(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function VB(n,e,t){const s=e.matched.length-1,r=t.matched.length-1;return s>-1&&s===r&&Ca(e.matched[s],t.matched[r])&&LP(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ca(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function LP(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(var t in n)if(!OB(n[t],e[t]))return!1;return!0}function OB(n,e){return us(n)?IT(n,e):us(e)?IT(e,n):n?.valueOf()===e?.valueOf()}function IT(n,e){return us(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function MB(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),r=s[s.length-1];(r===".."||r===".")&&s.push("");let i=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+s.slice(o).join("/")}const Tr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let Pm=(function(n){return n.pop="pop",n.push="push",n})({}),hp=(function(n){return n.back="back",n.forward="forward",n.unknown="",n})({});function LB(n){if(!n)if(Vo){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),xB(n)}const FB=/^[^#]+#/;function UB(n,e){return n.replace(FB,"#")+e}function BB(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const hf=()=>({left:window.scrollX,top:window.scrollY});function qB(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),r=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!r)return;e=BB(r,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function TT(n,e){return(history.state?history.state.position-e:-1)+n}const Nm=new Map;function $B(n,e){Nm.set(n,e)}function jB(n){const e=Nm.get(n);return Nm.delete(n),e}function GB(n){return typeof n=="string"||n&&typeof n=="object"}function FP(n){return typeof n=="string"||typeof n=="symbol"}let wt=(function(n){return n[n.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",n[n.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",n[n.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",n[n.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",n[n.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",n})({});const UP=Symbol("");wt.MATCHER_NOT_FOUND+"",wt.NAVIGATION_GUARD_REDIRECT+"",wt.NAVIGATION_ABORTED+"",wt.NAVIGATION_CANCELLED+"",wt.NAVIGATION_DUPLICATED+"";function Pa(n,e){return Ge(new Error,{type:n,[UP]:!0},e)}function xs(n,e){return n instanceof Error&&UP in n&&(e==null||!!(n.type&e))}const KB=["params","query","hash"];function WB(n){if(typeof n=="string")return n;if(n.path!=null)return n.path;const e={};for(const t of KB)t in n&&(e[t]=n[t]);return JSON.stringify(e,null,2)}function zB(n){const e={};if(n===""||n==="?")return e;const t=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<t.length;++s){const r=t[s].replace(DP," "),i=r.indexOf("="),o=Mc(i<0?r:r.slice(0,i)),a=i<0?null:Mc(r.slice(i+1));if(o in e){let l=e[o];us(l)||(l=e[o]=[l]),l.push(a)}else e[o]=a}return e}function wT(n){let e="";for(let t in n){const s=n[t];if(t=CB(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(us(s)?s.map(r=>r&&Cm(r)):[s&&Cm(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function HB(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=us(s)?s.map(r=>r==null?null:""+r):s==null?s:""+s)}return e}const QB=Symbol(""),bT=Symbol(""),df=Symbol(""),hy=Symbol(""),km=Symbol("");function wl(){let n=[];function e(s){return n.push(s),()=>{const r=n.indexOf(s);r>-1&&n.splice(r,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Cr(n,e,t,s,r,i=o=>o()){const o=s&&(s.enterCallbacks[r]=s.enterCallbacks[r]||[]);return()=>new Promise((a,l)=>{const u=f=>{f===!1?l(Pa(wt.NAVIGATION_ABORTED,{from:t,to:e})):f instanceof Error?l(f):GB(f)?l(Pa(wt.NAVIGATION_GUARD_REDIRECT,{from:e,to:f})):(o&&s.enterCallbacks[r]===o&&typeof f=="function"&&o.push(f),a())},h=i(()=>n.call(s&&s.instances[r],e,t,u));let d=Promise.resolve(h);n.length<3&&(d=d.then(u)),d.catch(f=>l(f))})}function dp(n,e,t,s,r=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(kP(l)){const u=(l.__vccOpts||l)[e];u&&i.push(Cr(u,t,s,o,a,r))}else{let u=l();i.push(()=>u.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const d=gB(h)?h.default:h;o.mods[a]=h,o.components[a]=d;const f=(d.__vccOpts||d)[e];return f&&Cr(f,t,s,o,a,r)()}))}}return i}function YB(n,e){const t=[],s=[],r=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>Ca(u,a))?s.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>Ca(u,l))||r.push(l))}return[t,s,r]}let JB=()=>location.protocol+"//"+location.host;function BP(n,e){const{pathname:t,search:s,hash:r}=e,i=n.indexOf("#");if(i>-1){let o=r.includes(n.slice(i))?n.slice(i).length:1,a=r.slice(o);return a[0]!=="/"&&(a="/"+a),ET(a,"")}return ET(t,n)+s+r}function XB(n,e,t,s){let r=[],i=[],o=null;const a=({state:f})=>{const _=BP(n,location),E=t.value,T=e.value;let C=0;if(f){if(t.value=_,e.value=f,o&&o===E){o=null;return}C=T?f.position-T.position:0}else s(_);r.forEach(L=>{L(t.value,E,{delta:C,type:Pm.pop,direction:C?C>0?hp.forward:hp.back:hp.unknown})})};function l(){o=t.value}function u(f){r.push(f);const _=()=>{const E=r.indexOf(f);E>-1&&r.splice(E,1)};return i.push(_),_}function h(){if(document.visibilityState==="hidden"){const{history:f}=window;if(!f.state)return;f.replaceState(Ge({},f.state,{scroll:hf()}),"")}}function d(){for(const f of i)f();i=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",h),document.removeEventListener("visibilitychange",h)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",h),document.addEventListener("visibilitychange",h),{pauseListeners:l,listen:u,destroy:d}}function AT(n,e,t,s=!1,r=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:r?hf():null}}function ZB(n){const{history:e,location:t}=window,s={value:BP(n,t)},r={value:e.state};r.value||i(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,h){const d=n.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:JB()+n+l;try{e[h?"replaceState":"pushState"](u,"",f),r.value=u}catch(_){console.error(_),t[h?"replace":"assign"](f)}}function o(l,u){i(l,Ge({},e.state,AT(r.value.back,l,r.value.forward,!0),u,{position:r.value.position}),!0),s.value=l}function a(l,u){const h=Ge({},r.value,e.state,{forward:l,scroll:hf()});i(h.current,h,!0),i(l,Ge({},AT(s.value,l,null),{position:h.position+1},u),!1),s.value=l}return{location:s,state:r,push:a,replace:o}}function e3(n){n=LB(n);const e=ZB(n),t=XB(n,e.state,e.location,e.replace);function s(i,o=!0){o||t.pauseListeners(),history.go(i)}const r=Ge({location:"",base:n,go:s,createHref:UB.bind(null,n)},e,t);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>e.state.value}),r}let Oi=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.Group=2]="Group",n})({});var Vt=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.ParamRegExp=2]="ParamRegExp",n[n.ParamRegExpEnd=3]="ParamRegExpEnd",n[n.EscapeNext=4]="EscapeNext",n})(Vt||{});const t3={type:Oi.Static,value:""},n3=/[a-zA-Z0-9_]/;function s3(n){if(!n)return[[]];if(n==="/")return[[t3]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${u}": ${_}`)}let t=Vt.Static,s=t;const r=[];let i;function o(){i&&r.push(i),i=[]}let a=0,l,u="",h="";function d(){u&&(t===Vt.Static?i.push({type:Oi.Static,value:u}):t===Vt.Param||t===Vt.ParamRegExp||t===Vt.ParamRegExpEnd?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:Oi.Param,value:u,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function f(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==Vt.ParamRegExp){s=t,t=Vt.EscapeNext;continue}switch(t){case Vt.Static:l==="/"?(u&&d(),o()):l===":"?(d(),t=Vt.Param):f();break;case Vt.EscapeNext:f(),t=s;break;case Vt.Param:l==="("?t=Vt.ParamRegExp:n3.test(l)?f():(d(),t=Vt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case Vt.ParamRegExp:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=Vt.ParamRegExpEnd:h+=l;break;case Vt.ParamRegExpEnd:d(),t=Vt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===Vt.ParamRegExp&&e(`Unfinished custom RegExp for param "${u}"`),d(),o(),r}const ST="[^/]+?",r3={sensitive:!1,strict:!1,start:!0,end:!0};var gn=(function(n){return n[n._multiplier=10]="_multiplier",n[n.Root=90]="Root",n[n.Segment=40]="Segment",n[n.SubSegment=30]="SubSegment",n[n.Static=40]="Static",n[n.Dynamic=20]="Dynamic",n[n.BonusCustomRegExp=10]="BonusCustomRegExp",n[n.BonusWildcard=-50]="BonusWildcard",n[n.BonusRepeatable=-20]="BonusRepeatable",n[n.BonusOptional=-8]="BonusOptional",n[n.BonusStrict=.7000000000000001]="BonusStrict",n[n.BonusCaseSensitive=.25]="BonusCaseSensitive",n})(gn||{});const i3=/[.+*?^${}()[\]/\\]/g;function o3(n,e){const t=Ge({},r3,e),s=[];let r=t.start?"^":"";const i=[];for(const u of n){const h=u.length?[]:[gn.Root];t.strict&&!u.length&&(r+="/");for(let d=0;d<u.length;d++){const f=u[d];let _=gn.Segment+(t.sensitive?gn.BonusCaseSensitive:0);if(f.type===Oi.Static)d||(r+="/"),r+=f.value.replace(i3,"\\$&"),_+=gn.Static;else if(f.type===Oi.Param){const{value:E,repeatable:T,optional:C,regexp:L}=f;i.push({name:E,repeatable:T,optional:C});const U=L||ST;if(U!==ST){_+=gn.BonusCustomRegExp;try{`${U}`}catch(k){throw new Error(`Invalid custom RegExp for param "${E}" (${U}): `+k.message)}}let N=T?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;d||(N=C&&u.length<2?`(?:/${N})`:"/"+N),C&&(N+="?"),r+=N,_+=gn.Dynamic,C&&(_+=gn.BonusOptional),T&&(_+=gn.BonusRepeatable),U===".*"&&(_+=gn.BonusWildcard)}h.push(_)}s.push(h)}if(t.strict&&t.end){const u=s.length-1;s[u][s[u].length-1]+=gn.BonusStrict}t.strict||(r+="/?"),t.end?r+="$":t.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const o=new RegExp(r,t.sensitive?"":"i");function a(u){const h=u.match(o),d={};if(!h)return null;for(let f=1;f<h.length;f++){const _=h[f]||"",E=i[f-1];d[E.name]=_&&E.repeatable?_.split("/"):_}return d}function l(u){let h="",d=!1;for(const f of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const _ of f)if(_.type===Oi.Static)h+=_.value;else if(_.type===Oi.Param){const{value:E,repeatable:T,optional:C}=_,L=E in u?u[E]:"";if(us(L)&&!T)throw new Error(`Provided param "${E}" is an array but it is not repeatable (* or + modifiers)`);const U=us(L)?L.join("/"):L;if(!U)if(C)f.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${E}"`);h+=U}}return h||"/"}return{re:o,score:s,keys:i,parse:a,stringify:l}}function a3(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===gn.Static+gn.Segment?-1:1:n.length>e.length?e.length===1&&e[0]===gn.Static+gn.Segment?1:-1:0}function qP(n,e){let t=0;const s=n.score,r=e.score;for(;t<s.length&&t<r.length;){const i=a3(s[t],r[t]);if(i)return i;t++}if(Math.abs(r.length-s.length)===1){if(RT(s))return 1;if(RT(r))return-1}return r.length-s.length}function RT(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const l3={strict:!1,end:!0,sensitive:!1};function c3(n,e,t){const s=o3(s3(n.path),t),r=Ge(s,{record:n,parent:e,children:[],alias:[]});return e&&!r.record.aliasOf==!e.record.aliasOf&&e.children.push(r),r}function u3(n,e){const t=[],s=new Map;e=vT(l3,e);function r(d){return s.get(d)}function i(d,f,_){const E=!_,T=PT(d);T.aliasOf=_&&_.record;const C=vT(e,d),L=[T];if("alias"in d){const k=typeof d.alias=="string"?[d.alias]:d.alias;for(const G of k)L.push(PT(Ge({},T,{components:_?_.record.components:T.components,path:G,aliasOf:_?_.record:T})))}let U,N;for(const k of L){const{path:G}=k;if(f&&G[0]!=="/"){const J=f.record.path,b=J[J.length-1]==="/"?"":"/";k.path=f.record.path+(G&&b+G)}if(U=c3(k,f,C),_?_.alias.push(U):(N=N||U,N!==U&&N.alias.push(U),E&&d.name&&!NT(U)&&o(d.name)),$P(U)&&l(U),T.children){const J=T.children;for(let b=0;b<J.length;b++)i(J[b],U,_&&_.children[b])}_=_||U}return N?()=>{o(N)}:rc}function o(d){if(FP(d)){const f=s.get(d);f&&(s.delete(d),t.splice(t.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=t.indexOf(d);f>-1&&(t.splice(f,1),d.record.name&&s.delete(d.record.name),d.children.forEach(o),d.alias.forEach(o))}}function a(){return t}function l(d){const f=f3(d,t);t.splice(f,0,d),d.record.name&&!NT(d)&&s.set(d.record.name,d)}function u(d,f){let _,E={},T,C;if("name"in d&&d.name){if(_=s.get(d.name),!_)throw Pa(wt.MATCHER_NOT_FOUND,{location:d});C=_.record.name,E=Ge(CT(f.params,_.keys.filter(N=>!N.optional).concat(_.parent?_.parent.keys.filter(N=>N.optional):[]).map(N=>N.name)),d.params&&CT(d.params,_.keys.map(N=>N.name))),T=_.stringify(E)}else if(d.path!=null)T=d.path,_=t.find(N=>N.re.test(T)),_&&(E=_.parse(T),C=_.record.name);else{if(_=f.name?s.get(f.name):t.find(N=>N.re.test(f.path)),!_)throw Pa(wt.MATCHER_NOT_FOUND,{location:d,currentLocation:f});C=_.record.name,E=Ge({},f.params,d.params),T=_.stringify(E)}const L=[];let U=_;for(;U;)L.unshift(U.record),U=U.parent;return{name:C,path:T,params:E,matched:L,meta:d3(L)}}n.forEach(d=>i(d));function h(){t.length=0,s.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:r}}function CT(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function PT(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:h3(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function h3(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function NT(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function d3(n){return n.reduce((e,t)=>Ge(e,t.meta),{})}function f3(n,e){let t=0,s=e.length;for(;t!==s;){const i=t+s>>1;qP(n,e[i])<0?s=i:t=i+1}const r=p3(n);return r&&(s=e.lastIndexOf(r,s-1)),s}function p3(n){let e=n;for(;e=e.parent;)if($P(e)&&qP(n,e)===0)return e}function $P({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function kT(n){const e=ts(df),t=ts(hy),s=he(()=>{const l=ze(n.to);return e.resolve(l)}),r=he(()=>{const{matched:l}=s.value,{length:u}=l,h=l[u-1],d=t.matched;if(!h||!d.length)return-1;const f=d.findIndex(Ca.bind(null,h));if(f>-1)return f;const _=xT(l[u-2]);return u>1&&xT(h)===_&&d[d.length-1].path!==_?d.findIndex(Ca.bind(null,l[u-2])):f}),i=he(()=>r.value>-1&&v3(t.params,s.value.params)),o=he(()=>r.value>-1&&r.value===t.matched.length-1&&LP(t.params,s.value.params));function a(l={}){if(y3(l)){const u=e[ze(n.replace)?"replace":"push"](ze(n.to)).catch(rc);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:s,href:he(()=>s.value.href),isActive:i,isExactActive:o,navigate:a}}function m3(n){return n.length===1?n[0]:n}const _3=mw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:kT,setup(n,{slots:e}){const t=pd(kT(n)),{options:s}=ts(df),r=he(()=>({[DT(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[DT(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&m3(e.default(t));return n.custom?i:$w("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:r.value},i)}}}),g3=_3;function y3(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function v3(n,e){for(const t in e){const s=e[t],r=n[t];if(typeof s=="string"){if(s!==r)return!1}else if(!us(r)||r.length!==s.length||s.some((i,o)=>i.valueOf()!==r[o].valueOf()))return!1}return!0}function xT(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const DT=(n,e,t)=>n??e??t,E3=mw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=ts(km),r=he(()=>n.route||s.value),i=ts(bT,0),o=he(()=>{let u=ze(i);const{matched:h}=r.value;let d;for(;(d=h[u])&&!d.components;)u++;return u}),a=he(()=>r.value.matched[o.value]);qu(bT,he(()=>o.value+1)),qu(QB,a),qu(km,r);const l=Ae();return Ks(()=>[l.value,a.value,n.name],([u,h,d],[f,_,E])=>{h&&(h.instances[d]=u,_&&_!==h&&u&&u===f&&(h.leaveGuards.size||(h.leaveGuards=_.leaveGuards),h.updateGuards.size||(h.updateGuards=_.updateGuards))),u&&h&&(!_||!Ca(h,_)||!f)&&(h.enterCallbacks[d]||[]).forEach(T=>T(u))},{flush:"post"}),()=>{const u=r.value,h=n.name,d=a.value,f=d&&d.components[h];if(!f)return VT(t.default,{Component:f,route:u});const _=d.props[h],E=_?_===!0?u.params:typeof _=="function"?_(u):_:null,C=$w(f,Ge({},E,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(d.instances[h]=null)},ref:l}));return VT(t.default,{Component:C,route:u})||C}}});function VT(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const I3=E3;function T3(n){const e=u3(n.routes,n),t=n.parseQuery||zB,s=n.stringifyQuery||wT,r=n.history,i=wl(),o=wl(),a=wl(),l=H0(Tr);let u=Tr;Vo&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=cp.bind(null,j=>""+j),d=cp.bind(null,NB),f=cp.bind(null,Mc);function _(j,fe){let ae,_e;return FP(j)?(ae=e.getRecordMatcher(j),_e=fe):_e=j,e.addRoute(_e,ae)}function E(j){const fe=e.getRecordMatcher(j);fe&&e.removeRoute(fe)}function T(){return e.getRoutes().map(j=>j.record)}function C(j){return!!e.getRecordMatcher(j)}function L(j,fe){if(fe=Ge({},fe||l.value),typeof j=="string"){const V=up(t,j,fe.path),q=e.resolve({path:V.path},fe),K=r.createHref(V.fullPath);return Ge(V,q,{params:f(q.params),hash:Mc(V.hash),redirectedFrom:void 0,href:K})}let ae;if(j.path!=null)ae=Ge({},j,{path:up(t,j.path,fe.path).path});else{const V=Ge({},j.params);for(const q in V)V[q]==null&&delete V[q];ae=Ge({},j,{params:d(V)}),fe.params=d(fe.params)}const _e=e.resolve(ae,fe),Me=j.hash||"";_e.params=h(f(_e.params));const I=DB(s,Ge({},j,{hash:RB(Me),path:_e.path})),S=r.createHref(I);return Ge({fullPath:I,hash:Me,query:s===wT?HB(j.query):j.query||{}},_e,{redirectedFrom:void 0,href:S})}function U(j){return typeof j=="string"?up(t,j,l.value.path):Ge({},j)}function N(j,fe){if(u!==j)return Pa(wt.NAVIGATION_CANCELLED,{from:fe,to:j})}function k(j){return b(j)}function G(j){return k(Ge(U(j),{replace:!0}))}function J(j,fe){const ae=j.matched[j.matched.length-1];if(ae&&ae.redirect){const{redirect:_e}=ae;let Me=typeof _e=="function"?_e(j,fe):_e;return typeof Me=="string"&&(Me=Me.includes("?")||Me.includes("#")?Me=U(Me):{path:Me},Me.params={}),Ge({query:j.query,hash:j.hash,params:Me.path!=null?{}:j.params},Me)}}function b(j,fe){const ae=u=L(j),_e=l.value,Me=j.state,I=j.force,S=j.replace===!0,V=J(ae,_e);if(V)return b(Ge(U(V),{state:typeof V=="object"?Ge({},Me,V.state):Me,force:I,replace:S}),fe||ae);const q=ae;q.redirectedFrom=fe;let K;return!I&&VB(s,_e,ae)&&(K=Pa(wt.NAVIGATION_DUPLICATED,{to:q,from:_e}),pn(_e,_e,!0,!1)),(K?Promise.resolve(K):P(q,_e)).catch($=>xs($)?xs($,wt.NAVIGATION_GUARD_REDIRECT)?$:ft($):se($,q,_e)).then($=>{if($){if(xs($,wt.NAVIGATION_GUARD_REDIRECT))return b(Ge({replace:S},U($.to),{state:typeof $.to=="object"?Ge({},Me,$.to.state):Me,force:I}),fe||q)}else $=x(q,_e,!0,S,Me);return R(q,_e,$),$})}function v(j,fe){const ae=N(j,fe);return ae?Promise.reject(ae):Promise.resolve()}function A(j){const fe=ie.values().next().value;return fe&&typeof fe.runWithContext=="function"?fe.runWithContext(j):j()}function P(j,fe){let ae;const[_e,Me,I]=YB(j,fe);ae=dp(_e.reverse(),"beforeRouteLeave",j,fe);for(const V of _e)V.leaveGuards.forEach(q=>{ae.push(Cr(q,j,fe))});const S=v.bind(null,j,fe);return ae.push(S),et(ae).then(()=>{ae=[];for(const V of i.list())ae.push(Cr(V,j,fe));return ae.push(S),et(ae)}).then(()=>{ae=dp(Me,"beforeRouteUpdate",j,fe);for(const V of Me)V.updateGuards.forEach(q=>{ae.push(Cr(q,j,fe))});return ae.push(S),et(ae)}).then(()=>{ae=[];for(const V of I)if(V.beforeEnter)if(us(V.beforeEnter))for(const q of V.beforeEnter)ae.push(Cr(q,j,fe));else ae.push(Cr(V.beforeEnter,j,fe));return ae.push(S),et(ae)}).then(()=>(j.matched.forEach(V=>V.enterCallbacks={}),ae=dp(I,"beforeRouteEnter",j,fe,A),ae.push(S),et(ae))).then(()=>{ae=[];for(const V of o.list())ae.push(Cr(V,j,fe));return ae.push(S),et(ae)}).catch(V=>xs(V,wt.NAVIGATION_CANCELLED)?V:Promise.reject(V))}function R(j,fe,ae){a.list().forEach(_e=>A(()=>_e(j,fe,ae)))}function x(j,fe,ae,_e,Me){const I=N(j,fe);if(I)return I;const S=fe===Tr,V=Vo?history.state:{};ae&&(_e||S?r.replace(j.fullPath,Ge({scroll:S&&V&&V.scroll},Me)):r.push(j.fullPath,Me)),l.value=j,pn(j,fe,ae,S),ft()}let w;function nt(){w||(w=r.listen((j,fe,ae)=>{if(!le.listening)return;const _e=L(j),Me=J(_e,le.currentRoute.value);if(Me){b(Ge(Me,{replace:!0,force:!0}),_e).catch(rc);return}u=_e;const I=l.value;Vo&&$B(TT(I.fullPath,ae.delta),hf()),P(_e,I).catch(S=>xs(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_CANCELLED)?S:xs(S,wt.NAVIGATION_GUARD_REDIRECT)?(b(Ge(U(S.to),{force:!0}),_e).then(V=>{xs(V,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&!ae.delta&&ae.type===Pm.pop&&r.go(-1,!1)}).catch(rc),Promise.reject()):(ae.delta&&r.go(-ae.delta,!1),se(S,_e,I))).then(S=>{S=S||x(_e,I,!1),S&&(ae.delta&&!xs(S,wt.NAVIGATION_CANCELLED)?r.go(-ae.delta,!1):ae.type===Pm.pop&&xs(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&r.go(-1,!1)),R(_e,I,S)}).catch(rc)}))}let Ut=wl(),lt=wl(),Fe;function se(j,fe,ae){ft(j);const _e=lt.list();return _e.length?_e.forEach(Me=>Me(j,fe,ae)):console.error(j),Promise.reject(j)}function re(){return Fe&&l.value!==Tr?Promise.resolve():new Promise((j,fe)=>{Ut.add([j,fe])})}function ft(j){return Fe||(Fe=!j,nt(),Ut.list().forEach(([fe,ae])=>j?ae(j):fe()),Ut.reset()),j}function pn(j,fe,ae,_e){const{scrollBehavior:Me}=n;if(!Vo||!Me)return Promise.resolve();const I=!ae&&jB(TT(j.fullPath,0))||(_e||!ae)&&history.state&&history.state.scroll||null;return cw().then(()=>Me(j,fe,I)).then(S=>S&&qB(S)).catch(S=>se(S,j,fe))}const xt=j=>r.go(j);let ue;const ie=new Set,le={currentRoute:l,listening:!0,addRoute:_,removeRoute:E,clearRoutes:e.clearRoutes,hasRoute:C,getRoutes:T,resolve:L,options:n,push:k,replace:G,go:xt,back:()=>xt(-1),forward:()=>xt(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:lt.add,isReady:re,install(j){j.component("RouterLink",g3),j.component("RouterView",I3),j.config.globalProperties.$router=le,Object.defineProperty(j.config.globalProperties,"$route",{enumerable:!0,get:()=>ze(l)}),Vo&&!ue&&l.value===Tr&&(ue=!0,k(r.location).catch(_e=>{}));const fe={};for(const _e in Tr)Object.defineProperty(fe,_e,{get:()=>l.value[_e],enumerable:!0});j.provide(df,le),j.provide(hy,iw(fe)),j.provide(km,l);const ae=j.unmount;ie.add(j),j.unmount=function(){ie.delete(j),ie.size<1&&(u=Tr,w&&w(),w=null,l.value=Tr,ue=!1,Fe=!1),ae()}}};function et(j){return j.reduce((fe,ae)=>fe.then(()=>A(ae)),Promise.resolve())}return le}function Ha(){return ts(df)}function w3(n){return ts(hy)}function b3(n){const e=String(n).toLowerCase();return e==="test"?"test":e==="preview"?"preview":"prod"}function A3(){const n=he(()=>b3("prod")),e=he(()=>{switch(n.value){case"test":return"";case"preview":return"";case"prod":return"";default:return""}});return{envKey:n,envLabel:e}}const Pn=(n,e)=>{const t=n.__vccOpts||n;for(const[s,r]of e)t[s]=r;return t},S3={class:"top-bar-area"},R3={class:"top-bar-content"},C3={class:"center-area"},P3=["data-ready"],N3={class:"right-area"},k3=["data-env"],x3={class:"auth-text"},D3={class:"auth-icon"},V3={__name:"TheTopBar",setup(n){const{kstString:e,isKstTimeReady:t}=oP(),{user:s,signInWithGoogle:r,signOutUser:i}=Xg(),{loadForUser:o,clearUserState:a,unsubscribe:l}=_o(),{world:u}=cy(),{envKey:h,envLabel:d}=A3(),f=he(()=>!!s.value?.uid),_=he(()=>!!Yn);async function E(){if(f.value){try{await i()}finally{try{l()}catch{}try{a()}catch{}}return}try{const T=await r();_.value&&T?.uid&&await o(T.uid,u.value)}catch(T){console.error("[auth] login failed",T),alert(` : ${T?.code||T?.message||T}`)}}return(T,C)=>(Y(),X("header",S3,[g("div",R3,[C[1]||(C[1]=g("div",{class:"left-area"},[g("h1",{class:"game-title"},"RCTS")],-1)),g("div",C3,[C[0]||(C[0]=g("span",{class:"time-label"},"KST",-1)),g("span",{class:"time-value","data-ready":ze(t)},ye(ze(t)?ze(e):"SYNC"),9,P3)]),g("div",N3,[g("span",{class:"env-badge","data-env":ze(h)},ye(ze(d)),9,k3),g("button",{class:"auth-btn",type:"button",onClick:E},[g("span",x3,ye(f.value?"":""),1),g("span",D3,ye(f.value?"":""),1)])])])]))}},O3=Pn(V3,[["__scopeId","data-v-bd04a5f0"]]),M3=["bus","truck","rail","plane","ship","spaceship"],ch={bus:{name:"",icon:""},truck:{name:"",icon:""},rail:{name:"",icon:""},plane:{name:"",icon:""},ship:{name:"",icon:""},spaceship:{name:"",icon:""}};function Uu(n,e=1){const t=Number(e||1);return hi.find(r=>(r.effects||[]).some(i=>i.type==="UNLOCK_TRANSPORT_TIER"&&i.transportId===n&&Number(i.tier||1)===t))?.id??null}function L3(){return hi.filter(t=>(t.effects||[]).some(s=>s?.type==="UNLOCK_STARTER_FLEET_PREVIEW")).map(t=>{const s=(t.effects||[]).find(i=>i?.type==="UNLOCK_STARTER_FLEET_PREVIEW")||null,r=s?{transports:Array.isArray(s.transports)?s.transports.filter(Boolean):[],runTimeMinSec:Number(s.runTimeMinSec||0),runTimeMaxSec:Number(s.runTimeMaxSec||0),countPerTransport:Number(s.countPerTransport||1)}:null;return{researchId:t.id,config:r}})}function jP(){const n=_o(),e=he(()=>L3()),t=he(()=>{const f=n.completedIds.value,_=e.value||[];return!f||_.length===0?!1:_.some(E=>E?.researchId&&f.has(E.researchId))}),s=he(()=>{const f=n.completedIds.value,_=e.value||[];return _.length&&((f?_.find(T=>T?.researchId&&f.has(T.researchId)):null)?.researchId??_[0]?.researchId)||null}),r=he(()=>{const f=n.completedIds.value,_=e.value||[];return _.length?(f?_.find(T=>T?.researchId&&f.has(T.researchId)):null)?.config??_[0]?.config??null:null}),i=he(()=>{const f=r.value;return f?new Set(f.transports||[]):new Set}),o=he(()=>{const f=i.value,_=t.value;return M3.map(E=>{const T=ch[E]||{},C=T.name??E,L=T.icon??"",N=Number(n.unlockedTransportTiers.value?.[E]||0)<1,k=Uu(E,1),G=!!k&&n.activeResearch.value?.id===k;let J=null,b=null;G&&n.activeResearch.value&&(J=new Date(n.activeResearch.value.startedAtMs),b=new Date(n.activeResearch.value.endsAtMs));const v=f.has(E),A=!!_&&!N&&v;return{id:E,name:C,icon:L,locked:N,isResearching:G,researchStartTime:J,researchFinishTime:b,unlockResearchId:k,previewEligible:v,previewActive:A,previewLabel:A?"  ":null}})}),a=he(()=>o.value.filter(f=>f.locked)),l=he(()=>o.value.filter(f=>!f.locked));function u(f){const _=Uu(f,1);_&&n.startResearch(_)}function h(f){const _=Uu(f,1);return _?n.getResearchProgress(_):0}function d(f){const _=Uu(f,1);return _?n.getResearchRemainingTime(_):"00h 00m 00s"}return{transportTypes:o,lockedTransports:a,unlockedTransports:l,unlockTransport:u,getResearchProgress:h,getResearchRemainingTime:d,previewResearchId:s,previewConfig:r,previewStarterFleetUnlocked:t}}const OT=Ae(null);function F3(){return{selectedTransportId:OT,setSelectedTransportId:e=>{OT.value=e}}}const GP="rcts.preview.runs.v2",U3=60,B3=30*U3,q3=3*3600;function $3(n,e){const t=Math.ceil(n),s=Math.floor(e);return Math.floor(Math.random()*(s-t+1))+t}function j3(){try{const n=localStorage.getItem(GP);if(!n)return null;const e=JSON.parse(n);return!e||typeof e!="object"?null:e}catch{return null}}function bl(n){try{localStorage.setItem(GP,JSON.stringify(n))}catch{}}function wr(n,e){const t={transportId:n,status:"idle",startedAtMs:null,endsAtMs:null,durationSec:0,routeName:" "};if(!e||typeof e!="object")return t;const s=e.status==="running"||e.status==="idle"||e.status==="ready"?e.status:"idle";return{...t,...e,transportId:e.transportId||n,status:s,routeName:e.routeName||" "}}function G3(){const n=_o(),{transportTypes:e}=jP(),{formatRemainMs:t}=aP(),s=he(()=>!!n.completedIds.value?.has?.("sys_preview_starter_vehicles")),r=he(()=>!!n.completedIds.value?.has?.("sys_preview_auto_assign")),i=he(()=>{const N=e.value||[];return new Set(N.filter(k=>k?.previewActive).map(k=>k.id))}),o=Ae({}),a=Ae(Date.now()),l=j3();l?.runs&&typeof l.runs=="object"&&(o.value=l.runs),Vl(()=>{const N=o.value||{};let k=!1;for(const[G,J]of Object.entries(N)){const b=wr(G,J);(!J?.status||J.status!==b.status||J.routeName!==b.routeName)&&(N[G]=b,k=!0)}k&&(o.value={...N},bl({runs:o.value}))});function u(N,k=Date.now()){const G=$3(B3,q3),J=wr(N,o.value?.[N]);o.value[N]={...J,transportId:N,status:"running",startedAtMs:k,endsAtMs:k+G*1e3,durationSec:G,routeName:" "}}function h(N=Date.now()){if(!s.value||!r.value)return!1;const k=i.value;if(!k||k.size===0)return!1;let G=!1;for(const J of k){const b=wr(J,o.value?.[J]);if(b.status!=="running")u(J,N),G=!0;else{const v=Number(b.endsAtMs||0);(!v||v<=N)&&(u(J,N),G=!0)}}return G&&bl({runs:o.value}),G}Vl(()=>{if(!s.value)return;const N=i.value;if(!N||N.size===0)return;let k=!1;for(const G of N)o.value?.[G]||(u(G,Date.now()),k=!0);k&&bl({runs:o.value}),h(Date.now())});let d=null;function f(){d||(d=setInterval(()=>{if(a.value=Date.now(),!s.value)return;const N=a.value,k=i.value;let G=!1;r.value&&h(N)&&(G=!0);for(const J of Object.keys(o.value||{})){if(!k.has(J))continue;const b=wr(J,o.value[J]);if(b.status!=="running")continue;const v=Number(b.endsAtMs||0);v&&N>=v&&(r.value?u(J,N):o.value[J]={...b,status:"ready",startedAtMs:null,endsAtMs:v,durationSec:b.durationSec||0,routeName:" "},G=!0)}G&&bl({runs:o.value})},1e3))}function _(){d&&(clearInterval(d),d=null)}Vl(()=>{if(!s.value){_();return}f(),C0(()=>{_()})});function E(N){const k=a.value;if(!i.value.has(N))return 0;const G=wr(N,o.value?.[N]);if(G.status!=="running")return 0;const J=Number(G.endsAtMs||0);return J?Math.max(0,J-k):0}function T(N){return t(E(N))}function C(N){return i.value.has(N)?wr(N,o.value?.[N]).status:"idle"}function L(N){return!s.value||!i.value.has(N)||r.value||wr(N,o.value?.[N]).status!=="ready"?!1:(u(N,Date.now()),bl({runs:o.value}),a.value=Date.now(),!0)}const U=he(()=>{const N=i.value;return Object.values(o.value||{}).map(G=>wr(G.transportId,G)).filter(G=>N.has(G.transportId)).sort((G,J)=>String(G.transportId).localeCompare(String(J.transportId)))});return{previewUnlocked:s,autoAssignUnlocked:r,runs:o,runList:U,remainingOf:T,statusOf:C,startManualRun:L}}const K3={class:"layout-area left-area"},W3={class:"left-panel-wrapper"},z3={class:"panel transport-list-container"},H3={class:"panel-head"},Q3={class:"panel-meta"},Y3={key:0,class:"transport-list"},J3=["onClick"],X3={class:"transport-icon"},Z3={class:"transport-name"},eq={key:1,class:"placeholder-box"},tq={class:"panel transport-details-container"},nq={class:"panel-head"},sq={class:"panel-heading"},rq={key:0,class:"panel-meta"},iq={key:0,class:"placeholder-box"},oq={key:1,class:"details-content"},aq={class:"kv"},lq={class:"kv-row"},cq={class:"v"},uq={class:"kv-row"},hq={class:"v"},dq={class:"kv-row"},fq={class:"v"},pq={key:0,class:"lock-box"},mq={key:0,class:"preview-placeholder"},_q={key:1,class:"preview-box"},gq={class:"box-desc"},yq={key:0,class:"preview-placeholder"},vq={key:1,class:"preview-data"},Eq={class:"preview-left"},Iq={class:"preview-title"},Tq={class:"preview-sub"},wq={key:0,class:"preview-right"},bq={class:"preview-remain mono"},Aq={key:1,class:"preview-right"},Sq={key:0,class:"preview-right"},Rq={class:"preview-remain mono"},Cq={key:1,class:"preview-right"},Pq=["onClick"],Nq={class:"details-footnote"},kq={class:"panel resource-container"},xq={class:"panel-head"},Dq={class:"panel-meta"},Vq={key:0,class:"placeholder-box"},Oq={key:1,class:"resource-content"},Mq={__name:"TheLeftArea",setup(n){const e=_o(),{transportTypes:t,unlockedTransports:s,previewStarterFleetUnlocked:r,previewConfig:i}=jP(),o=he(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),a=he(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),{selectedTransportId:l,setSelectedTransportId:u}=F3(),h=he(()=>s.value||[]),d=he(()=>l.value&&(t.value||[]).find(N=>N.id===l.value)||null),f=he(()=>{const N=new Set((s.value||[]).map(J=>J.id)),k=i.value;return(k&&Array.isArray(k.transports)&&k.transports.length>0?k.transports:["bus","truck","rail"]).some(J=>N.has(J))}),{runList:_,remainingOf:E,statusOf:T,startManualRun:C,autoAssignUnlocked:L}=G3();function U(N){return(t.value||[]).find(G=>G.id===N)?.name??N}return(N,k)=>(Y(),X("aside",K3,[g("div",W3,[g("section",z3,[g("div",H3,[k[0]||(k[0]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",Q3,ye(h.value.length)+"",1)]),h.value.length>0?(Y(),X("ul",Y3,[(Y(!0),X(qe,null,Xt(h.value,G=>(Y(),X("li",{key:G.id,class:Yo(["transport-item",{active:ze(l)===G.id}]),onClick:J=>ze(u)(G.id)},[g("span",X3,ye(G.icon),1),g("span",Z3,ye(G.name),1),k[1]||(k[1]=g("span",{class:"transport-count"},"0",-1))],10,J3))),128))])):(Y(),X("div",eq,[...k[2]||(k[2]=[g("p",{class:"placeholder-text"},"     .   . ",-1)])]))]),g("section",tq,[g("div",nq,[g("h3",sq,ye(d.value?`${d.value.name} `:"  "),1),d.value?(Y(),X("span",rq,"ID: "+ye(d.value.id),1)):At("",!0)]),d.value?(Y(),X("div",oq,[g("div",aq,[g("div",lq,[k[4]||(k[4]=g("span",{class:"k"},"",-1)),g("span",cq,ye(d.value.icon),1)]),g("div",uq,[k[5]||(k[5]=g("span",{class:"k"},"",-1)),g("span",hq,ye(d.value.name),1)]),k[7]||(k[7]=g("div",{class:"kv-row"},[g("span",{class:"k"}," "),g("span",{class:"v"},"0")],-1)),g("div",dq,[k[6]||(k[6]=g("span",{class:"k"}," ",-1)),g("span",fq,ye(d.value.locked?"":""),1)])]),k[19]||(k[19]=g("hr",{class:"divider"},null,-1)),ze(r)?(Y(),X("div",_q,[k[18]||(k[18]=g("p",{class:"box-title"},"   ",-1)),g("p",gq,[k[12]||(k[12]=Qt(" (): ",-1)),g("strong",null,ye(a.value?"":""),1)]),ze(_).length===0?(Y(),X("div",yq,[...k[13]||(k[13]=[g("p",{class:"placeholder-text"},"      . (/   ) ",-1)])])):(Y(),X("div",vq,[(Y(!0),X(qe,null,Xt(ze(_),G=>(Y(),X("div",{class:"preview-row",key:G.transportId},[g("div",Eq,[g("div",Iq,ye(U(G.transportId)),1),g("div",Tq,ye(G.routeName),1)]),ze(L)?(Y(),X(qe,{key:0},[ze(T)(G.transportId)==="running"?(Y(),X("div",wq,[k[14]||(k[14]=g("div",{class:"preview-pill"},"",-1)),g("div",bq,ye(ze(E)(G.transportId)),1)])):(Y(),X("div",Aq,[...k[15]||(k[15]=[g("div",{class:"preview-idle-text"}," ",-1),g("div",{class:"preview-remain mono"},"00:00",-1)])]))],64)):(Y(),X(qe,{key:1},[ze(T)(G.transportId)==="running"?(Y(),X("div",Sq,[k[16]||(k[16]=g("div",{class:"preview-pill"},"",-1)),g("div",Rq,ye(ze(E)(G.transportId)),1)])):(Y(),X("div",Cq,[k[17]||(k[17]=g("div",{class:"preview-idle-text"},"",-1)),g("button",{class:"preview-btn",type:"button",onClick:J=>ze(C)(G.transportId)},"    ",8,Pq)]))],64))]))),128))]))])):(Y(),X("div",pq,[k[9]||(k[9]=g("p",{class:"box-title"},"    ",-1)),k[10]||(k[10]=g("p",{class:"box-desc"},[Qt("  "),g("strong",null,"  "),Qt("  ,  "),g("strong",null," / "),Qt(" . ")],-1)),k[11]||(k[11]=g("p",{class:"box-desc subtle"}," (    .) ",-1)),f.value?At("",!0):(Y(),X("div",mq,[...k[8]||(k[8]=[g("p",{class:"placeholder-text"}," :           . ",-1)])]))])),g("p",Nq,"  "+ye(d.value.name)+"       . ",1)])):(Y(),X("div",iq,[...k[3]||(k[3]=[g("p",{class:"placeholder-text"},"     .",-1)])]))]),g("section",kq,[g("div",xq,[k[20]||(k[20]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",Dq,ye(o.value?"":""),1)]),o.value?(Y(),X("div",Oq,[...k[22]||(k[22]=[g("div",{class:"kv"},[g("div",{class:"kv-row"},[g("span",{class:"k"},""),g("span",{class:"v"},"$10,000")])],-1)])])):(Y(),X("div",Vq,[...k[21]||(k[21]=[g("p",{class:"placeholder-text"}," .",-1)])]))])])]))}},KP=Pn(Mq,[["__scopeId","data-v-c2ac4b92"]]),Lq={class:"layout-area center-area"},Fq={class:"center-content-wrapper"},Uq={class:"main-content-nav desktop-only","aria-label":"Main navigation"},Bq={class:"nav-list"},qq={class:"nav-item"},$q={class:"nav-item"},jq={class:"nav-item"},Gq={class:"nav-item"},Kq={class:"nav-item"},Wq={class:"nav-item"},zq={class:"nav-item"},Hq={class:"mobile-nav mobile-only","aria-label":"Mobile navigation header"},Qq=["aria-expanded"],Yq={class:"mobile-title"},Jq={class:"mobile-title-text"},Xq={class:"drawer",role:"dialog","aria-modal":"true","aria-label":"Main menu"},Zq={class:"drawer-body"},e9={class:"main-content-display"},br="/game/main",t9={__name:"TheCenterArea",setup(n){const e=Ha(),t=w3(),s=Ae(!1);function r(){s.value=!1}function i(){s.value=!s.value}const o={preview:`${br}/preview`,research:`${br}/research`,vehicles:`${br}/vehicles`,line:`${br}/line`,construction:`${br}/construction`,finance:`${br}/finance`,city:`${br}/city`,settings:`${br}/settings`};function a(h){r(),e.push(h)}const l=he(()=>{const h=t.path||"",d=h.includes("/game/main/preview")||h.includes("/home/preview"),f=h.includes("/game/main/research")||h.includes("/home/research"),_=h.includes("/game/main/vehicles")||h.includes("/home/vehicles"),E=h.includes("/game/main/line")||h.includes("/home/line"),T=h.includes("/game/main/construction")||h.includes("/home/construction"),C=h.includes("/game/main/finance")||h.includes("/home/finance"),L=h.includes("/game/main/city")||h.includes("/home/city"),U=h.includes("/game/main/settings")||h.includes("/home/settings");return d?" ":f?"":_?"":E?"":T?"":C?"":L?"":U?"":""});Ks(()=>t.fullPath,()=>r());function u(h){h.key==="Escape"&&r()}return Ks(s,h=>{document.body.style.overflow=h?"hidden":""}),zm(()=>{window.addEventListener("keydown",u)}),vw(()=>{window.removeEventListener("keydown",u),document.body.style.overflow=""}),(h,d)=>{const f=lc("router-link"),_=lc("router-view");return Y(),X("div",Lq,[g("div",Fq,[g("nav",Uq,[g("ul",Bq,[g("li",qq,[He(f,{to:o.research},{default:zn(()=>[...d[8]||(d[8]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",$q,[He(f,{to:o.vehicles},{default:zn(()=>[...d[9]||(d[9]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",jq,[He(f,{to:o.line},{default:zn(()=>[...d[10]||(d[10]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Gq,[He(f,{to:o.construction},{default:zn(()=>[...d[11]||(d[11]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Kq,[He(f,{to:o.finance},{default:zn(()=>[...d[12]||(d[12]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Wq,[He(f,{to:o.city},{default:zn(()=>[...d[13]||(d[13]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",zq,[He(f,{to:o.settings},{default:zn(()=>[...d[14]||(d[14]=[Qt("",-1)])]),_:1},8,["to"])])])]),g("div",Hq,[g("button",{class:"hamburger-btn",type:"button","aria-label":"Open menu","aria-expanded":s.value?"true":"false",onClick:i},[...d[15]||(d[15]=[g("span",{class:"hamburger-icon"},"",-1),g("span",{class:"hamburger-label"},"",-1)])],8,Qq),g("div",Yq,[g("span",Jq,ye(l.value),1)])]),s.value?(Y(),X("div",{key:0,class:"drawer-overlay mobile-only",role:"presentation",onClick:Ww(r,["self"])},[g("aside",Xq,[g("div",{class:"drawer-head"},[d[16]||(d[16]=g("div",{class:"drawer-title"},"RCTS ",-1)),g("button",{class:"drawer-close",type:"button","aria-label":"Close menu",onClick:r},"  ")]),g("div",Zq,[g("button",{class:"drawer-item drawer-item-preview",type:"button",onClick:d[0]||(d[0]=E=>a(o.preview))},"   "),g("button",{class:"drawer-item",type:"button",onClick:d[1]||(d[1]=E=>a(o.research))},""),g("button",{class:"drawer-item",type:"button",onClick:d[2]||(d[2]=E=>a(o.vehicles))},""),g("button",{class:"drawer-item",type:"button",onClick:d[3]||(d[3]=E=>a(o.line))},""),g("button",{class:"drawer-item",type:"button",onClick:d[4]||(d[4]=E=>a(o.construction))},""),g("button",{class:"drawer-item",type:"button",onClick:d[5]||(d[5]=E=>a(o.finance))},""),g("button",{class:"drawer-item",type:"button",onClick:d[6]||(d[6]=E=>a(o.city))},""),g("button",{class:"drawer-item",type:"button",onClick:d[7]||(d[7]=E=>a(o.settings))},"")]),d[17]||(d[17]=g("div",{class:"drawer-foot"},[g("div",{class:"drawer-hint"},"     . ")],-1))])])):At("",!0),g("div",e9,[He(_)])])])}}},n9=Pn(t9,[["__scopeId","data-v-c939df10"]]),s9={class:"game-wrapper"},r9={class:"main-layout"},i9={__name:"HomeView",setup(n){return(e,t)=>(Y(),X("div",s9,[He(O3),g("div",r9,[He(KP,{class:"layout-area left-area desktop-only"}),He(n9,{class:"layout-area center-area"})])]))}},o9=Pn(i9,[["__scopeId","data-v-baa77003"]]),a9={class:"research-page"},l9={class:"research-header"},c9={class:"status-row"},u9={key:0,class:"badge ok"},h9={class:"badge"},d9={class:"panel"},f9={class:"panel-head"},p9={class:"panel-actions"},m9=["disabled"],_9={key:0,class:"empty"},g9={key:1,class:"empty"},y9={key:2,class:"list"},v9={class:"card"},E9={class:"card-mid"},I9={class:"name-row"},T9={class:"name"},w9={class:"meta"},b9={class:"pill time"},A9={key:0,class:"pill fixed"},S9={key:0,class:"hint2"},R9={class:"progress-area"},C9={class:"progress-bar"},P9={class:"progress-info"},N9={class:"mono"},k9={key:1,class:"queue-row"},x9={class:"queue-title"},D9={key:2,class:"queue-list"},V9={class:"mono"},O9=["onClick"],M9={class:"panel"},L9={key:0,class:"empty"},F9={key:1,class:"empty"},U9={key:2,class:"list"},B9={class:"card-left"},q9={class:"icon"},$9={class:"card-mid"},j9={class:"name-row"},G9={class:"name"},K9={class:"meta"},W9={key:0,class:"pill"},z9={key:0,class:"hint2"},H9={class:"card-right"},Q9=["disabled","onClick"],Y9={class:"card-left"},J9={class:"icon"},X9={class:"card-mid"},Z9={class:"name-row"},e$={class:"name"},t$={class:"meta"},n$={class:"pill time"},s$={key:0,class:"pill fixed"},r$={key:1,class:"pill"},i$={key:2,class:"pill"},o$={key:0,class:"hint2"},a$={key:1,class:"hint2"},l$={class:"card-right"},c$=["disabled","onClick"],u$={class:"panel"},h$={key:0,class:"empty"},d$={key:1,class:"empty"},f$={key:2,class:"list"},p$={class:"card-mid"},m$={class:"name-row"},_$={class:"name"},g$={class:"meta"},y$={class:"pill lock"},v$={class:"pill time"},E$={key:0,class:"pill fixed"},I$={key:0,class:"hint2"},T$={key:1,class:"hint2"},w$={key:2,class:"hint2"},b$={__name:"ResearchView",setup(n){const e=_o(),t=he(()=>e.isHydrated.value),s=e.firstUnlockTransportId,r=e.needsFirstUnlockSelection,i=e.firstUnlockCandidates,o=he(()=>e.activeResearch.value),a=he(()=>e.queuedResearchIds.value||[]),l=he(()=>e.queueReserveLevel.value||1),u=he(()=>e.queueLimit.value||1),h=he(()=>e.queueCount.value||0),d=he(()=>e.isQueueFull.value),f=he(()=>!!e.saveEnabled.value&&!!e.isStateLoaded.value&&!e.isSavingFirebaseData.value);function _(ue){return ch[ue]?.name??ue}function E(ue){return e.catalog.find(ie=>ie.id===ue)||null}function T(ue){return E(ue)?.title??ue}function C(ue){return ue?ue.timePolicy==="FIXED"?!0:ue.type==="SYSTEM":!1}function L(ue){return C(E(ue))}function U(ue){const ie=Math.max(0,Number(ue||0));if(!ie)return"";if(ie<3600)return`${Math.max(1,Math.round(ie/60))}`;const le=Math.floor(ie/3600),et=Math.round(ie%3600/60);return et>0?`${le} ${et}`:`${le}`}function N(ue){const ie=Number(ue?.durationSec||0),le=C(ue),et=U(ie);return et===""?"":le?`: ${et}`:`: ${et}`}function k(ue){return N(E(ue))}function G(ue){return(ue.effects||[]).find(le=>le?.type==="UNLOCK_TRANSPORT_TIER"&&Number(le?.tier||1)===1)?.transportId||null}function J(ue,ie){const le=G(ue);return!le||!ie.has(le)?null:{key:`first-${le}`,transportId:le,icon:ch[le]?.icon??"",title:`${ch[le]?.name??le}  `,desc:" 1  ."}}const b=he(()=>{const ue=e.visibleCatalog.value||[];if(s.value)return[];const ie=new Set((i.value||[]).map(le=>le.id));return ue.map(le=>J(le,ie)).filter(Boolean)});function v(ue,ie){const le=String(ue?.title??"").trim(),et=String(ie?.title??"").trim();return le.localeCompare(et,"ko")}function A(ue){return{id:ue.id,title:ue.title??ue.id,desc:ue.desc??"",durationLabel:N(ue),fixed:C(ue),type:ue.type,domain:ue.domain}}const P=he(()=>(e.visibleCatalog.value||[]).filter(ie=>e.getStatus(ie.id)==="available").map(A).sort(v)),R=he(()=>(e.visibleCatalog.value||[]).map(ie=>{const le=e.getStatus(ie.id);return le!=="locked"&&le!=="comingSoon"?null:{...A(ie),status:le,statusLabel:le==="comingSoon"?"":"",lockReason:"  ."}}).filter(Boolean).sort(v));function x(ue){const ie=String(ue?.type||"");return ie==="SYSTEM"?"":ie==="CITY"?"":ie==="TRANSPORT"?"":ie==="EFFICIENCY"?"":String(ue?.id||"").startsWith("sys_preview_")?"":""}function w(ue){return a.value.includes(ue)}function nt(ue){return o.value?w(ue)?"":d.value?" ":"":" "}function Ut(ue){e.setFirstUnlockTransport(ue)}function lt(ue){e.startResearch(ue)}function Fe(ue){e.cancelQueuedResearch(ue)}function se(){e.cancelAllQueuedResearch()}function re(ue){return e.getResearchProgress(ue)}function ft(ue){return e.getResearchRemainingTime(ue)}function pn(ue){e.saveNow(ue)}function xt(){console.log("[ResearchView Debug]"),console.log("queueReserveLevel:",l.value),console.log("queueLimit:",u.value),console.log("queuedResearchIds:",a.value);const ue=(e.visibleCatalog.value||[]).filter(ie=>String(ie?.id||"").startsWith("sys_preview_"));console.log("[Preview durations]",ue.map(ie=>({id:ie.id,sec:ie.durationSec,label:N(ie)})))}return(ue,ie)=>(Y(),X("div",a9,[g("header",l9,[ie[1]||(ie[1]=g("h1",{class:"title"},"",-1)),ie[2]||(ie[2]=g("p",{class:"desc"},"    1 .        . ",-1)),g("div",c9,[g("span",{class:Yo(["badge",{ok:t.value}])},ye(t.value?"  ":"  "),3),g("span",{class:Yo(["badge",{warn:ze(r)}])},ye(ze(r)?"  ()":"  "),3),ze(s)?(Y(),X("span",u9,"  : "+ye(_(ze(s))),1)):At("",!0),g("span",h9," : "+ye(h.value)+"/"+ye(u.value)+" (Lv"+ye(l.value)+") ",1)])]),g("section",d9,[g("div",f9,[ie[3]||(ie[3]=g("h2",{class:"panel-title"}," ",-1)),g("div",p9,[g("button",{class:"btn",disabled:!f.value,onClick:ie[0]||(ie[0]=le=>pn({reason:"manual"}))},"   ",8,m9),g("button",{class:"btn ghost",onClick:xt},"   ")])]),t.value?o.value?(Y(),X("div",y9,[g("article",v9,[ie[6]||(ie[6]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",E9,[g("div",I9,[g("div",T9,ye(T(o.value.id)),1),g("div",w9,[ie[4]||(ie[4]=g("span",{class:"pill"},"",-1)),g("span",b9,ye(k(o.value.id)),1),L(o.value.id)?(Y(),X("span",A9,"")):At("",!0)])]),L(o.value.id)?(Y(),X("div",S9,"    ,     . ")):At("",!0),g("div",R9,[g("div",C9,[g("div",{class:"progress-fill",style:dd({transform:`scaleX(${Math.max(0,Math.min(100,re(o.value.id)))/100})`})},null,4)]),g("div",P9,[g("span",null,ye(re(o.value.id).toFixed(1))+"%",1),g("span",N9,": "+ye(ft(o.value.id)),1)])]),a.value.length>0?(Y(),X("div",k9,[ie[5]||(ie[5]=g("span",{class:"pill"},"",-1)),g("span",x9,ye(a.value.length)+" ",1),g("button",{class:"btn small ghost",onClick:se}," ")])):At("",!0),a.value.length>0?(Y(),X("div",D9,[(Y(!0),X(qe,null,Xt(a.value,le=>(Y(),X("div",{key:le,class:"queue-item"},[g("span",V9,ye(T(le)),1),g("button",{class:"btn small ghost",onClick:et=>Fe(le)},"",8,O9)]))),128))])):At("",!0)]),ie[7]||(ie[7]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))])])):(Y(),X("div",g9,"    .     . ")):(Y(),X("div",_9," "))]),g("section",M9,[ie[9]||(ie[9]=g("h2",{class:"panel-title"}," ( )",-1)),ie[10]||(ie[10]=g("p",{class:"panel-desc"},"     (  )   .       . ",-1)),t.value?P.value.length===0&&b.value.length===0?(Y(),X("div",F9,"     . ")):(Y(),X("div",U9,[(Y(!0),X(qe,null,Xt(b.value,le=>(Y(),X("article",{key:le.key,class:"card"},[g("div",B9,[g("div",q9,ye(le.icon),1)]),g("div",$9,[g("div",j9,[g("div",G9,ye(le.title),1),g("div",K9,[ie[8]||(ie[8]=g("span",{class:"pill time"},"",-1)),ze(r)?(Y(),X("span",W9,"")):At("",!0)])]),le.desc?(Y(),X("div",z9,ye(le.desc),1)):At("",!0)]),g("div",H9,[g("button",{class:"btn primary",disabled:!!o.value||!t.value,onClick:et=>Ut(le.transportId)},"   ",8,Q9)])]))),128)),(Y(!0),X(qe,null,Xt(P.value,le=>(Y(),X("article",{key:le.id,class:"card"},[g("div",Y9,[g("div",J9,ye(x(le)),1)]),g("div",X9,[g("div",Z9,[g("div",e$,ye(le.title),1),g("div",t$,[g("span",n$,ye(le.durationLabel),1),le.fixed?(Y(),X("span",s$,"")):At("",!0),o.value?(Y(),X("span",r$,"")):(Y(),X("span",i$,""))])]),le.desc?(Y(),X("div",o$,ye(le.desc),1)):At("",!0),le.fixed?(Y(),X("div",a$,"        .")):At("",!0)]),g("div",l$,[g("button",{class:"btn primary",disabled:!t.value||o.value&&d.value&&!w(le.id),onClick:et=>lt(le.id)},ye(nt(le.id)),9,c$)])]))),128))])):(Y(),X("div",L9," "))]),g("section",u$,[ie[13]||(ie[13]=g("h2",{class:"panel-title"},"  ",-1)),ie[14]||(ie[14]=g("p",{class:"panel-desc"},"     .        . ",-1)),t.value?R.value.length===0?(Y(),X("div",d$,"/  .")):(Y(),X("div",f$,[(Y(!0),X(qe,null,Xt(R.value,le=>(Y(),X("article",{key:le.id,class:"card"},[ie[11]||(ie[11]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",p$,[g("div",m$,[g("div",_$,ye(le.title),1),g("div",g$,[g("span",y$,ye(le.statusLabel),1),g("span",v$,ye(le.durationLabel),1),le.fixed?(Y(),X("span",E$,"")):At("",!0)])]),le.desc?(Y(),X("div",I$,ye(le.desc),1)):At("",!0),le.status==="comingSoon"?(Y(),X("div",T$,".")):le.status==="locked"?(Y(),X("div",w$,ye(le.lockReason||"  ."),1)):At("",!0)]),ie[12]||(ie[12]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))]))),128))])):(Y(),X("div",h$," "))])]))}},A$=Pn(b$,[["__scopeId","data-v-b9cdda19"]]),S$={class:"page"},R$={class:"panel"},C$={class:"list"},P$={class:"panel"},N$={class:"grid"},k$={class:"table"},x$={__name:"VehiclesView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",S$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"     .      .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",R$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-e2a4d6c8><h2 class="panel-title" data-v-e2a4d6c8> </h2><div class="panel-actions" data-v-e2a4d6c8><button class="btn" disabled data-v-e2a4d6c8> </button><button class="btn" disabled data-v-e2a4d6c8></button><button class="btn ghost" disabled data-v-e2a4d6c8></button></div></div><div class="empty" data-v-e2a4d6c8>   . <span class="mono" data-v-e2a4d6c8> ( 8)</span>     . </div>',2)),g("div",C$,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-e2a4d6c8><div class="icon" data-v-e2a4d6c8></div></div><div class="card-mid" data-v-e2a4d6c8><div class="name-row" data-v-e2a4d6c8><div class="name" data-v-e2a4d6c8>  </div><div class="meta" data-v-e2a4d6c8><span class="pill lock" data-v-e2a4d6c8></span><span class="pill time" data-v-e2a4d6c8></span></div></div><div class="hint2" data-v-e2a4d6c8>  :  ////  UI . </div></div><div class="card-right" data-v-e2a4d6c8><button class="btn primary" disabled data-v-e2a4d6c8></button></div>',3)])])),64))])]),g("section",P$,[r[9]||(r[9]=g("h2",{class:"panel-title"},"",-1)),r[10]||(r[10]=g("p",{class:"panel-desc"},"      .",-1)),g("div",N$,[(Y(),X(qe,null,Xt(4,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",k$,[r[8]||(r[8]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(6,i=>g("div",{class:"table-row",key:i},[...r[7]||(r[7]=[ns('<span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span>',5)])])),64))])])]))}},D$=Pn(x$,[["__scopeId","data-v-e2a4d6c8"]]),V$={class:"page"},O$={class:"panel"},M$={class:"list"},L$={class:"panel"},F$={class:"table"},U$={__name:"LineView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",V$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",O$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-58d6af1b><h2 class="panel-title" data-v-58d6af1b> </h2><div class="panel-actions" data-v-58d6af1b><button class="btn" disabled data-v-58d6af1b> </button><button class="btn" disabled data-v-58d6af1b> </button><button class="btn ghost" disabled data-v-58d6af1b> </button></div></div><div class="empty" data-v-58d6af1b>   .       . </div>',2)),g("div",M$,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-58d6af1b><div class="icon" data-v-58d6af1b></div></div><div class="card-mid" data-v-58d6af1b><div class="name-row" data-v-58d6af1b><div class="name" data-v-58d6af1b>  </div><div class="meta" data-v-58d6af1b><span class="pill lock" data-v-58d6af1b></span><span class="pill time" data-v-58d6af1b></span></div></div><div class="hint2" data-v-58d6af1b>  : ,  , , /  . </div></div><div class="card-right" data-v-58d6af1b><button class="btn primary" disabled data-v-58d6af1b></button></div>',3)])])),64))])]),g("section",L$,[r[8]||(r[8]=g("h2",{class:"panel-title"},"",-1)),r[9]||(r[9]=g("p",{class:"panel-desc"},"    / .",-1)),g("div",F$,[r[7]||(r[7]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(8,i=>g("div",{class:"table-row",key:i},[...r[6]||(r[6]=[ns('<span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span>',5)])])),64))])])]))}},B$=Pn(U$,[["__scopeId","data-v-58d6af1b"]]),q$={class:"page"},$$={class:"panel"},j$={class:"list"},G$={class:"panel"},K$={class:"grid"},W$={__name:"ConstructionView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",q$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," /     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",$$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-f1dc01af><h2 class="panel-title" data-v-f1dc01af> </h2><div class="panel-actions" data-v-f1dc01af><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button></div></div><div class="empty" data-v-f1dc01af>   .       . </div>',2)),g("div",j$,[(Y(),X(qe,null,Xt(10,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-f1dc01af><div class="icon" data-v-f1dc01af></div></div><div class="card-mid" data-v-f1dc01af><div class="name-row" data-v-f1dc01af><div class="name" data-v-f1dc01af>  </div><div class="meta" data-v-f1dc01af><span class="pill lock" data-v-f1dc01af></span><span class="pill time" data-v-f1dc01af></span></div></div><div class="hint2" data-v-f1dc01af>  : //,  ,    UI . </div></div><div class="card-right" data-v-f1dc01af><button class="btn primary" disabled data-v-f1dc01af></button></div>',3)])])),64))])]),g("section",G$,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /   /   .",-1)),g("div",K$,[(Y(),X(qe,null,Xt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},z$=Pn(W$,[["__scopeId","data-v-f1dc01af"]]),H$={class:"page"},Q$={class:"panel"},Y$={class:"grid"},J$={class:"table"},X$={__name:"FinanceView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",H$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//    .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",Q$,[r[7]||(r[7]=ns('<div class="panel-head" data-v-d1892e60><h2 class="panel-title" data-v-d1892e60> </h2><div class="panel-actions" data-v-d1892e60><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn ghost" disabled data-v-d1892e60></button></div></div><div class="empty" data-v-d1892e60>   .       . </div>',2)),g("div",Y$,[(Y(),X(qe,null,Xt(4,i=>g("div",{class:"mini-card",key:i},[...r[4]||(r[4]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",J$,[r[6]||(r[6]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(8,i=>g("div",{class:"table-row",key:i},[...r[5]||(r[5]=[g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1)])])),64))])])]))}},Z$=Pn(X$,[["__scopeId","data-v-d1892e60"]]),e5={class:"page"},t5={class:"panel"},n5={class:"list"},s5={class:"panel"},r5={class:"grid"},i5={__name:"CityView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",e5,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," //     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",t5,[r[5]||(r[5]=ns('<div class="panel-head" data-v-370df6f4><h2 class="panel-title" data-v-370df6f4> </h2><div class="panel-actions" data-v-370df6f4><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn ghost" disabled data-v-370df6f4></button></div></div><div class="empty" data-v-370df6f4>   .  /     . </div>',2)),g("div",n5,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-370df6f4><div class="icon" data-v-370df6f4></div></div><div class="card-mid" data-v-370df6f4><div class="name-row" data-v-370df6f4><div class="name" data-v-370df6f4>  </div><div class="meta" data-v-370df6f4><span class="pill lock" data-v-370df6f4></span><span class="pill time" data-v-370df6f4></span></div></div><div class="hint2" data-v-370df6f4>  : /// ,  , ,   . </div></div><div class="card-right" data-v-370df6f4><button class="btn primary" disabled data-v-370df6f4></button></div>',3)])])),64))])]),g("section",s5,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /  /  .",-1)),g("div",r5,[(Y(),X(qe,null,Xt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},o5=Pn(i5,[["__scopeId","data-v-370df6f4"]]),a5={},l5={class:"settings-shell"},c5={class:"settings-nav"},u5={class:"settings-content"};function h5(n,e){return Y(),X("div",l5,[g("aside",c5,[av(n.$slots,"nav",{},void 0)]),g("section",u5,[av(n.$slots,"content",{},void 0)])])}const d5=Pn(a5,[["render",h5],["__scopeId","data-v-e20a5156"]]),f5={},p5={class:"settings-nav-inner"},m5={class:"menu"};function _5(n,e){const t=lc("router-link");return Y(),X("nav",p5,[e[1]||(e[1]=g("h3",{class:"title"},"",-1)),g("ul",m5,[g("li",null,[He(t,{to:{name:"DataManager"}},{default:zn(()=>[...e[0]||(e[0]=[Qt("   ",-1)])]),_:1})])])])}const g5=Pn(f5,[["render",_5],["__scopeId","data-v-0036c63e"]]),y5={__name:"SettingsView",setup(n){return(e,t)=>{const s=lc("router-view");return Y(),Zo(d5,null,{nav:zn(()=>[He(g5)]),content:zn(()=>[He(s)]),_:1})}}},v5={class:"data-manager"},E5={class:"card"},I5={class:"kv"},T5={class:"v"},w5={class:"kv"},b5={class:"v"},A5={class:"kv"},S5={class:"v"},R5={key:0,class:"hint"},C5={key:1,class:"hint"},P5={class:"card"},N5={class:"row"},k5=["disabled"],x5=["disabled"],D5=["disabled"],V5={class:"autosave"},O5={class:"autosave-controls"},M5={class:"radio"},L5=["disabled"],F5={class:"radio"},U5=["disabled"],B5={class:"radio"},q5=["disabled"],$5={key:0,class:"hint"},j5={key:0,class:"message"},G5={key:1,class:"preview"},K5={class:"preview-head"},W5={class:"summary"},z5={class:"summary-item"},H5={class:"summary-v"},Q5={class:"summary-item"},Y5={class:"summary-v"},J5={class:"summary-item"},X5={class:"summary-v"},Z5={key:0,class:"pre"},ej={key:2,class:"hint"},tj={class:"modal"},nj={class:"check"},sj={class:"row"},rj=["disabled"],ij=["disabled"],oj={__name:"DataManagerPanel",setup(n){const{world:e}=cy(),t=he(()=>!!Yn),s=Xg(),r=he(()=>s?.user?.value?.uid??null),{saveNow:i,isSavingFirebaseData:o,autoSaveEnabled:a,autoSaveBase:l,autoSaveIntervalMin:u,setAutoSaveEnabled:h,setAutoSaveBase:d,setAutoSaveIntervalMin:f,autoSaveRunning:_}=_o(),E=he(()=>o.value),T=Ae(!1),C=Ae(""),L=Ae(!1),U=Ae(null),N=Ae(!1);function k(se){return JSON.stringify(se,null,2)}function G(se){if(!se)return"-";try{return typeof se?.toDate=="function"?se.toDate().toLocaleString():se instanceof Date?se.toLocaleString():typeof se=="number"?new Date(se).toLocaleString():String(se)}catch{return String(se)}}function J(se){return String(se||"").toLowerCase()==="dev"?"dev":"prod"}function b(se,re){if(!t.value)return null;const ft=J(re);return Mg(Yn,"worlds",ft,"users",se,"research","state")}const v=Ae("off");function A(){if(!a.value){v.value="off";return}const se=Number(l.value),re=Number(u.value);se===10&&re===10?v.value="10":se===5&&re===5?v.value="5":se===10?v.value="10":v.value="5"}Ks([a,l,u],()=>A(),{immediate:!0}),Ks(v,se=>{if(r.value&&t.value){if(se==="off"){h(!1);return}if(se==="5"){d(5),f(5),h(!0);return}se==="10"&&(d(10),f(10),h(!0))}});async function P(){if(r.value){if(!t.value){C.value="DEV   .";return}C.value="";try{await i({reason:"manual-ui"}),C.value=" ."}catch(se){console.error("DataManager: save failed",se),C.value=` : ${String(se?.message??se)}`}}}async function R(){if(r.value){if(!t.value){C.value="DEV   .";return}T.value=!0,C.value="",L.value=!1,U.value=null,N.value=!1;try{const se=b(r.value,e.value);if(!se)throw new Error("REMOTE_DISABLED");const re=await QC(se);re.exists()?(U.value=re.data(),L.value=!0,C.value="  ."):C.value="  . ( )"}catch(se){console.error("DataManager: load failed",se),C.value=` : ${String(se?.message??se)}`}finally{T.value=!1}}}const x=Ae(!1),w=Ae(!1),nt=Ae("");function Ut(){if(!t.value){C.value="DEV   .";return}x.value=!0,w.value=!1,nt.value=""}function lt(){x.value=!1}async function Fe(){if(r.value){if(!t.value){C.value="DEV   .";return}T.value=!0,C.value="";try{const se=b(r.value,e.value);if(!se)throw new Error("REMOTE_DISABLED");await YC(se),L.value=!1,U.value=null,N.value=!1,C.value=" .   .",lt()}catch(se){console.error("DataManager: delete failed",se),C.value=` : ${String(se?.message??se)}`}finally{T.value=!1}}}return(se,re)=>(Y(),X("div",v5,[re[24]||(re[24]=g("header",{class:"header"},[g("div",null,[g("h1",{class:"title"}," "),g("p",{class:"desc"},"   ,        . ")])],-1)),g("section",E5,[re[9]||(re[9]=g("h2",{class:"card-title"}," ",-1)),g("div",I5,[re[6]||(re[6]=g("div",{class:"k"}," ",-1)),g("div",T5,ye(r.value?"":"()"),1)]),g("div",w5,[re[7]||(re[7]=g("div",{class:"k"}," ",-1)),g("div",b5,ye(t.value?"(PROD)":"(DEV )"),1)]),g("div",A5,[re[8]||(re[8]=g("div",{class:"k"},"",-1)),g("div",S5,ye(ze(e)==="dev"?"DEV":"PROD"),1)]),r.value?r.value&&!t.value?(Y(),X("p",C5," DEV       /   . ")):At("",!0):(Y(),X("p",R5," Firestore  /   . "))]),g("section",P5,[re[18]||(re[18]=g("h2",{class:"card-title"}," ",-1)),g("div",N5,[g("button",{class:"btn",onClick:P,disabled:!r.value||!t.value||T.value||E.value},"  ",8,k5),g("button",{class:"btn",onClick:R,disabled:!r.value||!t.value||T.value},"   ",8,x5),g("button",{class:"btn danger",onClick:Ut,disabled:!r.value||!t.value||T.value},"   ",8,D5)]),g("div",V5,[re[13]||(re[13]=g("div",{class:"autosave-title"},"",-1)),g("div",O5,[g("label",M5,[hl(g("input",{type:"radio",name:"autosave",value:"off","onUpdate:modelValue":re[0]||(re[0]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,L5),[[Mf,v.value]]),re[10]||(re[10]=g("span",null,"",-1))]),g("label",F5,[hl(g("input",{type:"radio",name:"autosave",value:"5","onUpdate:modelValue":re[1]||(re[1]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,U5),[[Mf,v.value]]),re[11]||(re[11]=g("span",null,"5",-1))]),g("label",B5,[hl(g("input",{type:"radio",name:"autosave",value:"10","onUpdate:modelValue":re[2]||(re[2]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,q5),[[Mf,v.value]]),re[12]||(re[12]=g("span",null,"10",-1))])]),r.value&&t.value&&ze(a)&&ze(_)?(Y(),X("p",$5,"    (KST   ) ")):At("",!0)]),C.value?(Y(),X("p",j5,ye(C.value),1)):At("",!0),L.value?(Y(),X("div",G5,[g("div",K5,[re[14]||(re[14]=g("h3",{class:"preview-title"},"    ",-1)),g("button",{class:"btn small",onClick:re[3]||(re[3]=ft=>N.value=!N.value)},ye(N.value?"":""),1)]),g("div",W5,[g("div",z5,[re[15]||(re[15]=g("div",{class:"summary-k"},"",-1)),g("div",H5,ye(U.value?.version??"-"),1)]),g("div",Q5,[re[16]||(re[16]=g("div",{class:"summary-k"},"  (legacy)",-1)),g("div",Y5,ye(U.value?.transports?.length??0),1)]),g("div",J5,[re[17]||(re[17]=g("div",{class:"summary-k"},"",-1)),g("div",X5,ye(G(U.value?.updatedAt)),1)])]),N.value?(Y(),X("pre",Z5,ye(k(U.value)),1)):At("",!0)])):(Y(),X("p",ej,"   ."))]),x.value?(Y(),X("div",{key:0,class:"modal-backdrop",onClick:Ww(lt,["self"])},[g("div",tj,[re[20]||(re[20]=g("h2",{class:"modal-title"}," ?",-1)),re[21]||(re[21]=g("p",{class:"modal-desc danger-text"},"     .  ? ",-1)),re[22]||(re[22]=g("p",{class:"modal-desc"},[Qt("   ,  "),g("b",null," "),Qt(". ")],-1)),g("label",nj,[hl(g("input",{type:"checkbox","onUpdate:modelValue":re[4]||(re[4]=ft=>w.value=ft)},null,512),[[kN,w.value]]),re[19]||(re[19]=g("span",null,"      .",-1))]),re[23]||(re[23]=g("p",{class:"modal-desc"},[Qt("   "),g("b",null,"DELETE"),Qt(" . ")],-1)),hl(g("input",{class:"input","onUpdate:modelValue":re[5]||(re[5]=ft=>nt.value=ft),placeholder:"DELETE"},null,512),[[NN,nt.value]]),g("div",sj,[g("button",{class:"btn",onClick:lt,disabled:T.value},"",8,rj),g("button",{class:"btn danger",onClick:Fe,disabled:T.value||!w.value||nt.value!=="DELETE"},"   ",8,ij)])])])):At("",!0)]))}},aj=Pn(oj,[["__scopeId","data-v-884a6e72"]]),lj={__name:"DataManagerView",setup(n){return(e,t)=>(Y(),Zo(aj))}},cj={class:"preview-page"},uj={__name:"PreviewRunsView",setup(n){return(e,t)=>(Y(),X("div",cj,[He(KP,{class:"preview-left-as-main"})]))}},hj=Pn(uj,[["__scopeId","data-v-3aa6340f"]]),dj=[{path:"/",redirect:"/home/research"},{path:"/home",component:o9,children:[{path:"",redirect:"/home/research"},{path:"preview",name:"PreviewRuns",component:hj},{path:"research",name:"Research",component:A$},{path:"vehicles",name:"Vehicles",component:D$},{path:"line",name:"Line",component:B$},{path:"construction",name:"Construction",component:z$},{path:"finance",name:"Finance",component:Z$},{path:"city",name:"City",component:o5},{path:"settings",component:y5,children:[{path:"",redirect:{name:"DataManager"}},{path:"data",name:"DataManager",component:lj}]}]}],fj=T3({history:e3("/RCTS/"),routes:dj,scrollBehavior(){return{top:0}}}),WP=MN(_B);WP.use(fj);WP.mount("#app");
