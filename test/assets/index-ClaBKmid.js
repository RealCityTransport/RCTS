(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function Om(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const rt={},Lo=[],Ts=()=>{},UT=()=>!1,ld=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Mm=n=>n.startsWith("onUpdate:"),fn=Object.assign,Lm=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},_0=Object.prototype.hasOwnProperty,We=(n,e)=>_0.call(n,e),we=Array.isArray,Fo=n=>Mc(n)==="[object Map]",cd=n=>Mc(n)==="[object Set]",sv=n=>Mc(n)==="[object Date]",Se=n=>typeof n=="function",kt=n=>typeof n=="string",as=n=>typeof n=="symbol",ot=n=>n!==null&&typeof n=="object",BT=n=>(ot(n)||Se(n))&&Se(n.then)&&Se(n.catch),qT=Object.prototype.toString,Mc=n=>qT.call(n),g0=n=>Mc(n).slice(8,-1),$T=n=>Mc(n)==="[object Object]",Fm=n=>kt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,kl=Om(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ud=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},y0=/-\w/g,Kn=ud(n=>n.replace(y0,e=>e.slice(1).toUpperCase())),v0=/\B([A-Z])/g,oo=ud(n=>n.replace(v0,"-$1").toLowerCase()),hd=ud(n=>n.charAt(0).toUpperCase()+n.slice(1)),Cf=ud(n=>n?`on${hd(n)}`:""),Fr=(n,e)=>!Object.is(n,e),Uu=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},jT=(n,e,t,s=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:s,value:t})},Um=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let rv;const dd=()=>rv||(rv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function fd(n){if(we(n)){const e={};for(let t=0;t<n.length;t++){const s=n[t],r=kt(s)?w0(s):fd(s);if(r)for(const i in r)e[i]=r[i]}return e}else if(kt(n)||ot(n))return n}const E0=/;(?![^(]*\))/g,I0=/:([^]+)/,T0=/\/\*[^]*?\*\//g;function w0(n){const e={};return n.replace(T0,"").split(E0).forEach(t=>{if(t){const s=t.split(I0);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Yo(n){let e="";if(kt(n))e=n;else if(we(n))for(let t=0;t<n.length;t++){const s=Yo(n[t]);s&&(e+=s+" ")}else if(ot(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const b0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",A0=Om(b0);function GT(n){return!!n||n===""}function S0(n,e){if(n.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<n.length;s++)t=Jo(n[s],e[s]);return t}function Jo(n,e){if(n===e)return!0;let t=sv(n),s=sv(e);if(t||s)return t&&s?n.getTime()===e.getTime():!1;if(t=as(n),s=as(e),t||s)return n===e;if(t=we(n),s=we(e),t||s)return t&&s?S0(n,e):!1;if(t=ot(n),s=ot(e),t||s){if(!t||!s)return!1;const r=Object.keys(n).length,i=Object.keys(e).length;if(r!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Jo(n[o],e[o]))return!1}}return String(n)===String(e)}function KT(n,e){return n.findIndex(t=>Jo(t,e))}const WT=n=>!!(n&&n.__v_isRef===!0),ye=n=>kt(n)?n:n==null?"":we(n)||ot(n)&&(n.toString===qT||!Se(n.toString))?WT(n)?ye(n.value):JSON.stringify(n,zT,2):String(n),zT=(n,e)=>WT(e)?zT(n,e.value):Fo(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,r],i)=>(t[Pf(s,i)+" =>"]=r,t),{})}:cd(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Pf(t))}:as(e)?Pf(e):ot(e)&&!we(e)&&!$T(e)?String(e):e,Pf=(n,e="")=>{var t;return as(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let nn;class R0{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=nn,!e&&nn&&(this.index=(nn.scopes||(nn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=nn;try{return nn=this,e()}finally{nn=t}}}on(){++this._on===1&&(this.prevScope=nn,nn=this)}off(){this._on>0&&--this._on===0&&(nn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function C0(){return nn}function P0(n,e=!1){nn&&nn.cleanups.push(n)}let ct;const Nf=new WeakSet;class HT{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,nn&&nn.active&&nn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Nf.has(this)&&(Nf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||YT(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,iv(this),JT(this);const e=ct,t=es;ct=this,es=!0;try{return this.fn()}finally{XT(this),ct=e,es=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)$m(e);this.deps=this.depsTail=void 0,iv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Nf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){pp(this)&&this.run()}get dirty(){return pp(this)}}let QT=0,xl,Dl;function YT(n,e=!1){if(n.flags|=8,e){n.next=Dl,Dl=n;return}n.next=xl,xl=n}function Bm(){QT++}function qm(){if(--QT>0)return;if(Dl){let e=Dl;for(Dl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;xl;){let e=xl;for(xl=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){n||(n=s)}e=t}}if(n)throw n}function JT(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function XT(n){let e,t=n.depsTail,s=t;for(;s;){const r=s.prevDep;s.version===-1?(s===t&&(t=r),$m(s),N0(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=r}n.deps=e,n.depsTail=t}function pp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(ZT(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function ZT(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===rc)||(n.globalVersion=rc,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!pp(n))))return;n.flags|=2;const e=n.dep,t=ct,s=es;ct=n,es=!0;try{JT(n);const r=n.fn(n._value);(e.version===0||Fr(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{ct=t,es=s,XT(n),n.flags&=-3}}function $m(n,e=!1){const{dep:t,prevSub:s,nextSub:r}=n;if(s&&(s.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=s,n.nextSub=void 0),t.subs===n&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)$m(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function N0(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let es=!0;const ew=[];function zs(){ew.push(es),es=!1}function Hs(){const n=ew.pop();es=n===void 0?!0:n}function iv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=ct;ct=void 0;try{e()}finally{ct=t}}}let rc=0;class k0{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class jm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ct||!es||ct===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==ct)t=this.activeLink=new k0(ct,this),ct.deps?(t.prevDep=ct.depsTail,ct.depsTail.nextDep=t,ct.depsTail=t):ct.deps=ct.depsTail=t,tw(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=ct.depsTail,t.nextDep=void 0,ct.depsTail.nextDep=t,ct.depsTail=t,ct.deps===t&&(ct.deps=s)}return t}trigger(e){this.version++,rc++,this.notify(e)}notify(e){Bm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{qm()}}}function tw(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)tw(s)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const mp=new WeakMap,Mi=Symbol(""),_p=Symbol(""),ic=Symbol("");function rn(n,e,t){if(es&&ct){let s=mp.get(n);s||mp.set(n,s=new Map);let r=s.get(t);r||(s.set(t,r=new jm),r.map=s,r.key=t),r.track()}}function Ms(n,e,t,s,r,i){const o=mp.get(n);if(!o){rc++;return}const a=l=>{l&&l.trigger()};if(Bm(),e==="clear")o.forEach(a);else{const l=we(n),u=l&&Fm(t);if(l&&t==="length"){const h=Number(s);o.forEach((d,f)=>{(f==="length"||f===ic||!as(f)&&f>=h)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(ic)),e){case"add":l?u&&a(o.get("length")):(a(o.get(Mi)),Fo(n)&&a(o.get(_p)));break;case"delete":l||(a(o.get(Mi)),Fo(n)&&a(o.get(_p)));break;case"set":Fo(n)&&a(o.get(Mi));break}}qm()}function Io(n){const e=Ke(n);return e===n?e:(rn(e,"iterate",ic),jn(n)?e:e.map(ls))}function pd(n){return rn(n=Ke(n),"iterate",ic),n}function br(n,e){return Qs(n)?Li(n)?Xo(ls(e)):Xo(e):ls(e)}const x0={__proto__:null,[Symbol.iterator](){return kf(this,Symbol.iterator,n=>br(this,n))},concat(...n){return Io(this).concat(...n.map(e=>we(e)?Io(e):e))},entries(){return kf(this,"entries",n=>(n[1]=br(this,n[1]),n))},every(n,e){return ks(this,"every",n,e,void 0,arguments)},filter(n,e){return ks(this,"filter",n,e,t=>t.map(s=>br(this,s)),arguments)},find(n,e){return ks(this,"find",n,e,t=>br(this,t),arguments)},findIndex(n,e){return ks(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ks(this,"findLast",n,e,t=>br(this,t),arguments)},findLastIndex(n,e){return ks(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ks(this,"forEach",n,e,void 0,arguments)},includes(...n){return xf(this,"includes",n)},indexOf(...n){return xf(this,"indexOf",n)},join(n){return Io(this).join(n)},lastIndexOf(...n){return xf(this,"lastIndexOf",n)},map(n,e){return ks(this,"map",n,e,void 0,arguments)},pop(){return ul(this,"pop")},push(...n){return ul(this,"push",n)},reduce(n,...e){return ov(this,"reduce",n,e)},reduceRight(n,...e){return ov(this,"reduceRight",n,e)},shift(){return ul(this,"shift")},some(n,e){return ks(this,"some",n,e,void 0,arguments)},splice(...n){return ul(this,"splice",n)},toReversed(){return Io(this).toReversed()},toSorted(n){return Io(this).toSorted(n)},toSpliced(...n){return Io(this).toSpliced(...n)},unshift(...n){return ul(this,"unshift",n)},values(){return kf(this,"values",n=>br(this,n))}};function kf(n,e,t){const s=pd(n),r=s[e]();return s!==n&&!jn(n)&&(r._next=r.next,r.next=()=>{const i=r._next();return i.done||(i.value=t(i.value)),i}),r}const D0=Array.prototype;function ks(n,e,t,s,r,i){const o=pd(n),a=o!==n&&!jn(n),l=o[e];if(l!==D0[e]){const d=l.apply(n,i);return a?ls(d):d}let u=t;o!==n&&(a?u=function(d,f){return t.call(this,br(n,d),f,n)}:t.length>2&&(u=function(d,f){return t.call(this,d,f,n)}));const h=l.call(o,u,s);return a&&r?r(h):h}function ov(n,e,t,s){const r=pd(n);let i=t;return r!==n&&(jn(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,br(n,a),l,n)}),r[e](i,...s)}function xf(n,e,t){const s=Ke(n);rn(s,"iterate",ic);const r=s[e](...t);return(r===-1||r===!1)&&Wm(t[0])?(t[0]=Ke(t[0]),s[e](...t)):r}function ul(n,e,t=[]){zs(),Bm();const s=Ke(n)[e].apply(n,t);return qm(),Hs(),s}const V0=Om("__proto__,__v_isRef,__isVue"),nw=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(as));function O0(n){as(n)||(n=String(n));const e=Ke(this);return rn(e,"has",n),e.hasOwnProperty(n)}class sw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return i;if(t==="__v_raw")return s===(r?i?K0:aw:i?ow:iw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=we(e);if(!r){let l;if(o&&(l=x0[t]))return l;if(t==="hasOwnProperty")return O0}const a=Reflect.get(e,t,cn(e)?e:s);if((as(t)?nw.has(t):V0(t))||(r||rn(e,"get",t),i))return a;if(cn(a)){const l=o&&Fm(t)?a:a.value;return r&&ot(l)?yp(l):l}return ot(a)?r?yp(a):md(a):a}}class rw extends sw{constructor(e=!1){super(!1,e)}set(e,t,s,r){let i=e[t];const o=we(e)&&Fm(t);if(!this._isShallow){const u=Qs(i);if(!jn(s)&&!Qs(s)&&(i=Ke(i),s=Ke(s)),!o&&cn(i)&&!cn(s))return u||(i.value=s),!0}const a=o?Number(t)<e.length:We(e,t),l=Reflect.set(e,t,s,cn(e)?e:r);return e===Ke(r)&&(a?Fr(s,i)&&Ms(e,"set",t,s):Ms(e,"add",t,s)),l}deleteProperty(e,t){const s=We(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&Ms(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(!as(t)||!nw.has(t))&&rn(e,"has",t),s}ownKeys(e){return rn(e,"iterate",we(e)?"length":Mi),Reflect.ownKeys(e)}}class M0 extends sw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const L0=new rw,F0=new M0,U0=new rw(!0);const gp=n=>n,Tu=n=>Reflect.getPrototypeOf(n);function B0(n,e,t){return function(...s){const r=this.__v_raw,i=Ke(r),o=Fo(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=r[n](...s),h=t?gp:e?Xo:ls;return!e&&rn(i,"iterate",l?_p:Mi),{next(){const{value:d,done:f}=u.next();return f?{value:d,done:f}:{value:a?[h(d[0]),h(d[1])]:h(d),done:f}},[Symbol.iterator](){return this}}}}function wu(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function q0(n,e){const t={get(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);n||(Fr(r,a)&&rn(o,"get",r),rn(o,"get",a));const{has:l}=Tu(o),u=e?gp:n?Xo:ls;if(l.call(o,r))return u(i.get(r));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(r)},get size(){const r=this.__v_raw;return!n&&rn(Ke(r),"iterate",Mi),r.size},has(r){const i=this.__v_raw,o=Ke(i),a=Ke(r);return n||(Fr(r,a)&&rn(o,"has",r),rn(o,"has",a)),r===a?i.has(r):i.has(r)||i.has(a)},forEach(r,i){const o=this,a=o.__v_raw,l=Ke(a),u=e?gp:n?Xo:ls;return!n&&rn(l,"iterate",Mi),a.forEach((h,d)=>r.call(i,u(h),u(d),o))}};return fn(t,n?{add:wu("add"),set:wu("set"),delete:wu("delete"),clear:wu("clear")}:{add(r){!e&&!jn(r)&&!Qs(r)&&(r=Ke(r));const i=Ke(this);return Tu(i).has.call(i,r)||(i.add(r),Ms(i,"add",r,r)),this},set(r,i){!e&&!jn(i)&&!Qs(i)&&(i=Ke(i));const o=Ke(this),{has:a,get:l}=Tu(o);let u=a.call(o,r);u||(r=Ke(r),u=a.call(o,r));const h=l.call(o,r);return o.set(r,i),u?Fr(i,h)&&Ms(o,"set",r,i):Ms(o,"add",r,i),this},delete(r){const i=Ke(this),{has:o,get:a}=Tu(i);let l=o.call(i,r);l||(r=Ke(r),l=o.call(i,r)),a&&a.call(i,r);const u=i.delete(r);return l&&Ms(i,"delete",r,void 0),u},clear(){const r=Ke(this),i=r.size!==0,o=r.clear();return i&&Ms(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=B0(r,n,e)}),t}function Gm(n,e){const t=q0(n,e);return(s,r,i)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?s:Reflect.get(We(t,r)&&r in s?t:s,r,i)}const $0={get:Gm(!1,!1)},j0={get:Gm(!1,!0)},G0={get:Gm(!0,!1)};const iw=new WeakMap,ow=new WeakMap,aw=new WeakMap,K0=new WeakMap;function W0(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function z0(n){return n.__v_skip||!Object.isExtensible(n)?0:W0(g0(n))}function md(n){return Qs(n)?n:Km(n,!1,L0,$0,iw)}function lw(n){return Km(n,!1,U0,j0,ow)}function yp(n){return Km(n,!0,F0,G0,aw)}function Km(n,e,t,s,r){if(!ot(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=z0(n);if(i===0)return n;const o=r.get(n);if(o)return o;const a=new Proxy(n,i===2?s:t);return r.set(n,a),a}function Li(n){return Qs(n)?Li(n.__v_raw):!!(n&&n.__v_isReactive)}function Qs(n){return!!(n&&n.__v_isReadonly)}function jn(n){return!!(n&&n.__v_isShallow)}function Wm(n){return n?!!n.__v_raw:!1}function Ke(n){const e=n&&n.__v_raw;return e?Ke(e):n}function H0(n){return!We(n,"__v_skip")&&Object.isExtensible(n)&&jT(n,"__v_skip",!0),n}const ls=n=>ot(n)?md(n):n,Xo=n=>ot(n)?yp(n):n;function cn(n){return n?n.__v_isRef===!0:!1}function Ae(n){return cw(n,!1)}function Q0(n){return cw(n,!0)}function cw(n,e){return cn(n)?n:new Y0(n,e)}class Y0{constructor(e,t){this.dep=new jm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ke(e),this._value=t?e:ls(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||jn(e)||Qs(e);e=s?e:Ke(e),Fr(e,t)&&(this._rawValue=e,this._value=s?e:ls(e),this.dep.trigger())}}function ze(n){return cn(n)?n.value:n}const J0={get:(n,e,t)=>e==="__v_raw"?n:ze(Reflect.get(n,e,t)),set:(n,e,t,s)=>{const r=n[e];return cn(r)&&!cn(t)?(r.value=t,!0):Reflect.set(n,e,t,s)}};function uw(n){return Li(n)?n:new Proxy(n,J0)}class X0{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new jm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=rc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&ct!==this)return YT(this,!0),!0}get value(){const e=this.dep.track();return ZT(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Z0(n,e,t=!1){let s,r;return Se(n)?s=n:(s=n.get,r=n.set),new X0(s,r,t)}const bu={},uh=new WeakMap;let Ii;function e1(n,e=!1,t=Ii){if(t){let s=uh.get(t);s||uh.set(t,s=[]),s.push(n)}}function t1(n,e,t=rt){const{immediate:s,deep:r,once:i,scheduler:o,augmentJob:a,call:l}=t,u=k=>r?k:jn(k)||r===!1||r===0?Ls(k,1):Ls(k);let h,d,f,_,E=!1,T=!1;if(cn(n)?(d=()=>n.value,E=jn(n)):Li(n)?(d=()=>u(n),E=!0):we(n)?(T=!0,E=n.some(k=>Li(k)||jn(k)),d=()=>n.map(k=>{if(cn(k))return k.value;if(Li(k))return u(k);if(Se(k))return l?l(k,2):k()})):Se(n)?e?d=l?()=>l(n,2):n:d=()=>{if(f){zs();try{f()}finally{Hs()}}const k=Ii;Ii=h;try{return l?l(n,3,[_]):n(_)}finally{Ii=k}}:d=Ts,e&&r){const k=d,G=r===!0?1/0:r;d=()=>Ls(k(),G)}const C=C0(),L=()=>{h.stop(),C&&C.active&&Lm(C.effects,h)};if(i&&e){const k=e;e=(...G)=>{k(...G),L()}}let U=T?new Array(n.length).fill(bu):bu;const N=k=>{if(!(!(h.flags&1)||!h.dirty&&!k))if(e){const G=h.run();if(r||E||(T?G.some((J,b)=>Fr(J,U[b])):Fr(G,U))){f&&f();const J=Ii;Ii=h;try{const b=[G,U===bu?void 0:T&&U[0]===bu?[]:U,_];U=G,l?l(e,3,b):e(...b)}finally{Ii=J}}}else h.run()};return a&&a(N),h=new HT(d),h.scheduler=o?()=>o(N,!1):N,_=k=>e1(k,!1,h),f=h.onStop=()=>{const k=uh.get(h);if(k){if(l)l(k,4);else for(const G of k)G();uh.delete(h)}},e?s?N(!0):U=h.run():o?o(N.bind(null,!0),!0):h.run(),L.pause=h.pause.bind(h),L.resume=h.resume.bind(h),L.stop=L,L}function Ls(n,e=1/0,t){if(e<=0||!ot(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,cn(n))Ls(n.value,e,t);else if(we(n))for(let s=0;s<n.length;s++)Ls(n[s],e,t);else if(cd(n)||Fo(n))n.forEach(s=>{Ls(s,e,t)});else if($T(n)){for(const s in n)Ls(n[s],e,t);for(const s of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,s)&&Ls(n[s],e,t)}return n}function Lc(n,e,t,s){try{return s?n(...s):n()}catch(r){_d(r,e,t)}}function Rs(n,e,t,s){if(Se(n)){const r=Lc(n,e,t,s);return r&&BT(r)&&r.catch(i=>{_d(i,e,t)}),r}if(we(n)){const r=[];for(let i=0;i<n.length;i++)r.push(Rs(n[i],e,t,s));return r}}function _d(n,e,t,s=!0){const r=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||rt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let d=0;d<h.length;d++)if(h[d](n,l,u)===!1)return}a=a.parent}if(i){zs(),Lc(i,null,10,[n,l,u]),Hs();return}}n1(n,t,r,s,o)}function n1(n,e,t,s=!0,r=!1){if(r)throw n;console.error(n)}const vn=[];let ps=-1;const Uo=[];let Ar=null,Po=0;const hw=Promise.resolve();let hh=null;function dw(n){const e=hh||hw;return n?e.then(this?n.bind(this):n):e}function s1(n){let e=ps+1,t=vn.length;for(;e<t;){const s=e+t>>>1,r=vn[s],i=oc(r);i<n||i===n&&r.flags&2?e=s+1:t=s}return e}function zm(n){if(!(n.flags&1)){const e=oc(n),t=vn[vn.length-1];!t||!(n.flags&2)&&e>=oc(t)?vn.push(n):vn.splice(s1(e),0,n),n.flags|=1,fw()}}function fw(){hh||(hh=hw.then(mw))}function r1(n){we(n)?Uo.push(...n):Ar&&n.id===-1?Ar.splice(Po+1,0,n):n.flags&1||(Uo.push(n),n.flags|=1),fw()}function av(n,e,t=ps+1){for(;t<vn.length;t++){const s=vn[t];if(s&&s.flags&2){if(n&&s.id!==n.uid)continue;vn.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function pw(n){if(Uo.length){const e=[...new Set(Uo)].sort((t,s)=>oc(t)-oc(s));if(Uo.length=0,Ar){Ar.push(...e);return}for(Ar=e,Po=0;Po<Ar.length;Po++){const t=Ar[Po];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ar=null,Po=0}}const oc=n=>n.id==null?n.flags&2?-1:1/0:n.id;function mw(n){try{for(ps=0;ps<vn.length;ps++){const e=vn[ps];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Lc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ps<vn.length;ps++){const e=vn[ps];e&&(e.flags&=-2)}ps=-1,vn.length=0,pw(),hh=null,(vn.length||Uo.length)&&mw()}}let Jt=null,_w=null;function dh(n){const e=Jt;return Jt=n,_w=n&&n.type.__scopeId||null,e}function Hn(n,e=Jt,t){if(!e||n._n)return n;const s=(...r)=>{s._d&&mh(-1);const i=dh(e);let o;try{o=n(...r)}finally{dh(i),s._d&&mh(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function hl(n,e){if(Jt===null)return n;const t=Ed(Jt),s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[i,o,a,l=rt]=e[r];i&&(Se(i)&&(i={mounted:i,updated:i}),i.deep&&Ls(o),s.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function yi(n,e,t,s){const r=n.dirs,i=e&&e.dirs;for(let o=0;o<r.length;o++){const a=r[o];i&&(a.oldValue=i[o].value);let l=a.dir[s];l&&(zs(),Rs(l,t,8,[n.el,a,n,e]),Hs())}}function Bu(n,e){if(ln){let t=ln.provides;const s=ln.parent&&ln.parent.provides;s===t&&(t=ln.provides=Object.create(s)),t[n]=e}}function ts(n,e,t=!1){const s=sN();if(s||qo){let r=qo?qo._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&Se(e)?e.call(s&&s.proxy):e}}const i1=Symbol.for("v-scx"),o1=()=>ts(i1);function Vl(n,e){return Hm(n,null,e)}function Gs(n,e,t){return Hm(n,e,t)}function Hm(n,e,t=rt){const{immediate:s,deep:r,flush:i,once:o}=t,a=fn({},t),l=e&&s||!e&&i!=="post";let u;if(uc){if(i==="sync"){const _=o1();u=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=Ts,_.resume=Ts,_.pause=Ts,_}}const h=ln;a.call=(_,E,T)=>Rs(_,h,E,T);let d=!1;i==="post"?a.scheduler=_=>{Vn(_,h&&h.suspense)}:i!=="sync"&&(d=!0,a.scheduler=(_,E)=>{E?_():zm(_)}),a.augmentJob=_=>{e&&(_.flags|=4),d&&(_.flags|=2,h&&(_.id=h.uid,_.i=h))};const f=t1(n,e,a);return uc&&(u?u.push(f):l&&f()),f}function a1(n,e,t){const s=this.proxy,r=kt(n)?n.includes(".")?gw(s,n):()=>s[n]:n.bind(s,s);let i;Se(e)?i=e:(i=e.handler,t=e);const o=Fc(this),a=Hm(r,i.bind(s),t);return o(),a}function gw(n,e){const t=e.split(".");return()=>{let s=n;for(let r=0;r<t.length&&s;r++)s=s[t[r]];return s}}const l1=Symbol("_vte"),c1=n=>n.__isTeleport,u1=Symbol("_leaveCb");function Qm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Qm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function yw(n,e){return Se(n)?fn({name:n.name},e,{setup:n}):n}function vw(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const fh=new WeakMap;function Ol(n,e,t,s,r=!1){if(we(n)){n.forEach((E,T)=>Ol(E,e&&(we(e)?e[T]:e),t,s,r));return}if(Bo(s)&&!r){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Ol(n,e,t,s.component.subTree);return}const i=s.shapeFlag&4?Ed(s.component):s.el,o=r?null:i,{i:a,r:l}=n,u=e&&e.r,h=a.refs===rt?a.refs={}:a.refs,d=a.setupState,f=Ke(d),_=d===rt?UT:E=>We(f,E);if(u!=null&&u!==l){if(lv(e),kt(u))h[u]=null,_(u)&&(d[u]=null);else if(cn(u)){u.value=null;const E=e;E.k&&(h[E.k]=null)}}if(Se(l))Lc(l,a,12,[o,h]);else{const E=kt(l),T=cn(l);if(E||T){const C=()=>{if(n.f){const L=E?_(l)?d[l]:h[l]:l.value;if(r)we(L)&&Lm(L,i);else if(we(L))L.includes(i)||L.push(i);else if(E)h[l]=[i],_(l)&&(d[l]=h[l]);else{const U=[i];l.value=U,n.k&&(h[n.k]=U)}}else E?(h[l]=o,_(l)&&(d[l]=o)):T&&(l.value=o,n.k&&(h[n.k]=o))};if(o){const L=()=>{C(),fh.delete(n)};L.id=-1,fh.set(n,L),Vn(L,t)}else lv(n),C()}}}function lv(n){const e=fh.get(n);e&&(e.flags|=8,fh.delete(n))}dd().requestIdleCallback;dd().cancelIdleCallback;const Bo=n=>!!n.type.__asyncLoader,Ew=n=>n.type.__isKeepAlive;function h1(n,e){Iw(n,"a",e)}function d1(n,e){Iw(n,"da",e)}function Iw(n,e,t=ln){const s=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(gd(e,s,t),t){let r=t.parent;for(;r&&r.parent;)Ew(r.parent.vnode)&&f1(s,e,t,r),r=r.parent}}function f1(n,e,t,s){const r=gd(e,n,s,!0);ww(()=>{Lm(s[e],r)},t)}function gd(n,e,t=ln,s=!1){if(t){const r=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{zs();const a=Fc(t),l=Rs(e,t,n,o);return a(),Hs(),l});return s?r.unshift(i):r.push(i),i}}const nr=n=>(e,t=ln)=>{(!uc||n==="sp")&&gd(n,(...s)=>e(...s),t)},p1=nr("bm"),Ym=nr("m"),m1=nr("bu"),_1=nr("u"),Tw=nr("bum"),ww=nr("um"),g1=nr("sp"),y1=nr("rtg"),v1=nr("rtc");function E1(n,e=ln){gd("ec",n,e)}const I1="components";function ac(n,e){return w1(I1,n,!0,e)||n}const T1=Symbol.for("v-ndc");function w1(n,e,t=!0,s=!1){const r=Jt||ln;if(r){const i=r.type;{const a=lN(i,!1);if(a&&(a===e||a===Kn(e)||a===hd(Kn(e))))return i}const o=cv(r[n]||i[n],e)||cv(r.appContext[n],e);return!o&&s?i:o}}function cv(n,e){return n&&(n[e]||n[Kn(e)]||n[hd(Kn(e))])}function Xt(n,e,t,s){let r;const i=t,o=we(n);if(o||kt(n)){const a=o&&Li(n);let l=!1,u=!1;a&&(l=!jn(n),u=Qs(n),n=pd(n)),r=new Array(n.length);for(let h=0,d=n.length;h<d;h++)r[h]=e(l?u?Xo(ls(n[h])):ls(n[h]):n[h],h,void 0,i)}else if(typeof n=="number"){r=new Array(n);for(let a=0;a<n;a++)r[a]=e(a+1,a,void 0,i)}else if(ot(n))if(n[Symbol.iterator])r=Array.from(n,(a,l)=>e(a,l,void 0,i));else{const a=Object.keys(n);r=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const h=a[l];r[l]=e(n[h],h,l,i)}}else r=[];return r}function uv(n,e,t={},s,r){if(Jt.ce||Jt.parent&&Bo(Jt.parent)&&Jt.parent.ce){const u=Object.keys(t).length>0;return e!=="default"&&(t.name=e),Y(),Zo(qe,null,[He("slot",t,s)],u?-2:64)}let i=n[e];i&&i._c&&(i._d=!1),Y();const o=i&&bw(i(t)),a=t.key||o&&o.key,l=Zo(qe,{key:(a&&!as(a)?a:`_${e}`)+(!o&&s?"_fb":"")},o||[],o&&n._===1?64:-2);return i&&i._c&&(i._d=!0),l}function bw(n){return n.some(e=>cc(e)?!(e.type===Ys||e.type===qe&&!bw(e.children)):!0)?n:null}const vp=n=>n?jw(n)?Ed(n):vp(n.parent):null,Ml=fn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>vp(n.parent),$root:n=>vp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Sw(n),$forceUpdate:n=>n.f||(n.f=()=>{zm(n.update)}),$nextTick:n=>n.n||(n.n=dw.bind(n.proxy)),$watch:n=>a1.bind(n)}),Df=(n,e)=>n!==rt&&!n.__isScriptSetup&&We(n,e),b1={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:r,props:i,accessCache:o,type:a,appContext:l}=n;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return s[e];case 2:return r[e];case 4:return t[e];case 3:return i[e]}else{if(Df(s,e))return o[e]=1,s[e];if(r!==rt&&We(r,e))return o[e]=2,r[e];if(We(i,e))return o[e]=3,i[e];if(t!==rt&&We(t,e))return o[e]=4,t[e];Ep&&(o[e]=0)}}const u=Ml[e];let h,d;if(u)return e==="$attrs"&&rn(n.attrs,"get",""),u(n);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==rt&&We(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,We(d,e))return d[e]},set({_:n},e,t){const{data:s,setupState:r,ctx:i}=n;return Df(r,e)?(r[e]=t,!0):s!==rt&&We(s,e)?(s[e]=t,!0):We(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:s,appContext:r,props:i,type:o}},a){let l;return!!(t[a]||n!==rt&&a[0]!=="$"&&We(n,a)||Df(e,a)||We(i,a)||We(s,a)||We(Ml,a)||We(r.config.globalProperties,a)||(l=o.__cssModules)&&l[a])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:We(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function hv(n){return we(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Ep=!0;function A1(n){const e=Sw(n),t=n.proxy,s=n.ctx;Ep=!1,e.beforeCreate&&dv(e.beforeCreate,n,"bc");const{data:r,computed:i,methods:o,watch:a,provide:l,inject:u,created:h,beforeMount:d,mounted:f,beforeUpdate:_,updated:E,activated:T,deactivated:C,beforeDestroy:L,beforeUnmount:U,destroyed:N,unmounted:k,render:G,renderTracked:J,renderTriggered:b,errorCaptured:v,serverPrefetch:A,expose:P,inheritAttrs:R,components:x,directives:w,filters:nt}=e;if(u&&S1(u,s,null),o)for(const Fe in o){const se=o[Fe];Se(se)&&(s[Fe]=se.bind(t))}if(r){const Fe=r.call(t,t);ot(Fe)&&(n.data=md(Fe))}if(Ep=!0,i)for(const Fe in i){const se=i[Fe],re=Se(se)?se.bind(t,t):Se(se.get)?se.get.bind(t,t):Ts,ft=!Se(se)&&Se(se.set)?se.set.bind(t):Ts,pn=he({get:re,set:ft});Object.defineProperty(s,Fe,{enumerable:!0,configurable:!0,get:()=>pn.value,set:xt=>pn.value=xt})}if(a)for(const Fe in a)Aw(a[Fe],s,t,Fe);if(l){const Fe=Se(l)?l.call(t):l;Reflect.ownKeys(Fe).forEach(se=>{Bu(se,Fe[se])})}h&&dv(h,n,"c");function lt(Fe,se){we(se)?se.forEach(re=>Fe(re.bind(t))):se&&Fe(se.bind(t))}if(lt(p1,d),lt(Ym,f),lt(m1,_),lt(_1,E),lt(h1,T),lt(d1,C),lt(E1,v),lt(v1,J),lt(y1,b),lt(Tw,U),lt(ww,k),lt(g1,A),we(P))if(P.length){const Fe=n.exposed||(n.exposed={});P.forEach(se=>{Object.defineProperty(Fe,se,{get:()=>t[se],set:re=>t[se]=re,enumerable:!0})})}else n.exposed||(n.exposed={});G&&n.render===Ts&&(n.render=G),R!=null&&(n.inheritAttrs=R),x&&(n.components=x),w&&(n.directives=w),A&&vw(n)}function S1(n,e,t=Ts){we(n)&&(n=Ip(n));for(const s in n){const r=n[s];let i;ot(r)?"default"in r?i=ts(r.from||s,r.default,!0):i=ts(r.from||s):i=ts(r),cn(i)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[s]=i}}function dv(n,e,t){Rs(we(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,t)}function Aw(n,e,t,s){let r=s.includes(".")?gw(t,s):()=>t[s];if(kt(n)){const i=e[n];Se(i)&&Gs(r,i)}else if(Se(n))Gs(r,n.bind(t));else if(ot(n))if(we(n))n.forEach(i=>Aw(i,e,t,s));else{const i=Se(n.handler)?n.handler.bind(t):e[n.handler];Se(i)&&Gs(r,i,n)}}function Sw(n){const e=n.type,{mixins:t,extends:s}=e,{mixins:r,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!r.length&&!t&&!s?l=e:(l={},r.length&&r.forEach(u=>ph(l,u,o,!0)),ph(l,e,o)),ot(e)&&i.set(e,l),l}function ph(n,e,t,s=!1){const{mixins:r,extends:i}=e;i&&ph(n,i,t,!0),r&&r.forEach(o=>ph(n,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=R1[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const R1={data:fv,props:pv,emits:pv,methods:Al,computed:Al,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:Al,directives:Al,watch:P1,provide:fv,inject:C1};function fv(n,e){return e?n?function(){return fn(Se(n)?n.call(this,this):n,Se(e)?e.call(this,this):e)}:e:n}function C1(n,e){return Al(Ip(n),Ip(e))}function Ip(n){if(we(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function _n(n,e){return n?[...new Set([].concat(n,e))]:e}function Al(n,e){return n?fn(Object.create(null),n,e):e}function pv(n,e){return n?we(n)&&we(e)?[...new Set([...n,...e])]:fn(Object.create(null),hv(n),hv(e??{})):e}function P1(n,e){if(!n)return e;if(!e)return n;const t=fn(Object.create(null),n);for(const s in e)t[s]=_n(n[s],e[s]);return t}function Rw(){return{app:null,config:{isNativeTag:UT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let N1=0;function k1(n,e){return function(s,r=null){Se(s)||(s=fn({},s)),r!=null&&!ot(r)&&(r=null);const i=Rw(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:N1++,_component:s,_props:r,_container:null,_context:i,_instance:null,version:uN,get config(){return i.config},set config(h){},use(h,...d){return o.has(h)||(h&&Se(h.install)?(o.add(h),h.install(u,...d)):Se(h)&&(o.add(h),h(u,...d))),u},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),u},component(h,d){return d?(i.components[h]=d,u):i.components[h]},directive(h,d){return d?(i.directives[h]=d,u):i.directives[h]},mount(h,d,f){if(!l){const _=u._ceVNode||He(s,r);return _.appContext=i,f===!0?f="svg":f===!1&&(f=void 0),n(_,h,f),l=!0,u._container=h,h.__vue_app__=u,Ed(_.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Rs(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(h,d){return i.provides[h]=d,u},runWithContext(h){const d=qo;qo=u;try{return h()}finally{qo=d}}};return u}}let qo=null;const x1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Kn(e)}Modifiers`]||n[`${oo(e)}Modifiers`];function D1(n,e,...t){if(n.isUnmounted)return;const s=n.vnode.props||rt;let r=t;const i=e.startsWith("update:"),o=i&&x1(s,e.slice(7));o&&(o.trim&&(r=t.map(h=>kt(h)?h.trim():h)),o.number&&(r=t.map(Um)));let a,l=s[a=Cf(e)]||s[a=Cf(Kn(e))];!l&&i&&(l=s[a=Cf(oo(e))]),l&&Rs(l,n,6,r);const u=s[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Rs(u,n,6,r)}}const V1=new WeakMap;function Cw(n,e,t=!1){const s=t?V1:e.emitsCache,r=s.get(n);if(r!==void 0)return r;const i=n.emits;let o={},a=!1;if(!Se(n)){const l=u=>{const h=Cw(u,e,!0);h&&(a=!0,fn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(ot(n)&&s.set(n,null),null):(we(i)?i.forEach(l=>o[l]=null):fn(o,i),ot(n)&&s.set(n,o),o)}function yd(n,e){return!n||!ld(e)?!1:(e=e.slice(2).replace(/Once$/,""),We(n,e[0].toLowerCase()+e.slice(1))||We(n,oo(e))||We(n,e))}function mv(n){const{type:e,vnode:t,proxy:s,withProxy:r,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:h,props:d,data:f,setupState:_,ctx:E,inheritAttrs:T}=n,C=dh(n);let L,U;try{if(t.shapeFlag&4){const k=r||s,G=k;L=_s(u.call(G,k,h,d,_,f,E)),U=a}else{const k=e;L=_s(k.length>1?k(d,{attrs:a,slots:o,emit:l}):k(d,null)),U=e.props?a:O1(a)}}catch(k){Ll.length=0,_d(k,n,1),L=He(Ys)}let N=L;if(U&&T!==!1){const k=Object.keys(U),{shapeFlag:G}=N;k.length&&G&7&&(i&&k.some(Mm)&&(U=M1(U,i)),N=ea(N,U,!1,!0))}return t.dirs&&(N=ea(N,null,!1,!0),N.dirs=N.dirs?N.dirs.concat(t.dirs):t.dirs),t.transition&&Qm(N,t.transition),L=N,dh(C),L}const O1=n=>{let e;for(const t in n)(t==="class"||t==="style"||ld(t))&&((e||(e={}))[t]=n[t]);return e},M1=(n,e)=>{const t={};for(const s in n)(!Mm(s)||!(s.slice(9)in e))&&(t[s]=n[s]);return t};function L1(n,e,t){const{props:s,children:r,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?_v(s,o,u):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const f=h[d];if(o[f]!==s[f]&&!yd(u,f))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?_v(s,o,u):!0:!!o;return!1}function _v(n,e,t){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let r=0;r<s.length;r++){const i=s[r];if(e[i]!==n[i]&&!yd(t,i))return!0}return!1}function F1({vnode:n,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=e.vnode).el=t,e=e.parent;else break}}const Pw={},Nw=()=>Object.create(Pw),kw=n=>Object.getPrototypeOf(n)===Pw;function U1(n,e,t,s=!1){const r={},i=Nw();n.propsDefaults=Object.create(null),xw(n,e,r,i);for(const o in n.propsOptions[0])o in r||(r[o]=void 0);t?n.props=s?r:lw(r):n.type.props?n.props=r:n.props=i,n.attrs=i}function B1(n,e,t,s){const{props:r,attrs:i,vnode:{patchFlag:o}}=n,a=Ke(r),[l]=n.propsOptions;let u=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let f=h[d];if(yd(n.emitsOptions,f))continue;const _=e[f];if(l)if(We(i,f))_!==i[f]&&(i[f]=_,u=!0);else{const E=Kn(f);r[E]=Tp(l,a,E,_,n,!1)}else _!==i[f]&&(i[f]=_,u=!0)}}}else{xw(n,e,r,i)&&(u=!0);let h;for(const d in a)(!e||!We(e,d)&&((h=oo(d))===d||!We(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(r[d]=Tp(l,a,d,void 0,n,!0)):delete r[d]);if(i!==a)for(const d in i)(!e||!We(e,d))&&(delete i[d],u=!0)}u&&Ms(n.attrs,"set","")}function xw(n,e,t,s){const[r,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(kl(l))continue;const u=e[l];let h;r&&We(r,h=Kn(l))?!i||!i.includes(h)?t[h]=u:(a||(a={}))[h]=u:yd(n.emitsOptions,l)||(!(l in s)||u!==s[l])&&(s[l]=u,o=!0)}if(i){const l=Ke(t),u=a||rt;for(let h=0;h<i.length;h++){const d=i[h];t[d]=Tp(r,l,d,u[d],n,!We(u,d))}}return o}function Tp(n,e,t,s,r,i){const o=n[t];if(o!=null){const a=We(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Se(l)){const{propsDefaults:u}=r;if(t in u)s=u[t];else{const h=Fc(r);s=u[t]=l.call(null,e),h()}}else s=l;r.ce&&r.ce._setProp(t,s)}o[0]&&(i&&!a?s=!1:o[1]&&(s===""||s===oo(t))&&(s=!0))}return s}const q1=new WeakMap;function Dw(n,e,t=!1){const s=t?q1:e.propsCache,r=s.get(n);if(r)return r;const i=n.props,o={},a=[];let l=!1;if(!Se(n)){const h=d=>{l=!0;const[f,_]=Dw(d,e,!0);fn(o,f),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return ot(n)&&s.set(n,Lo),Lo;if(we(i))for(let h=0;h<i.length;h++){const d=Kn(i[h]);gv(d)&&(o[d]=rt)}else if(i)for(const h in i){const d=Kn(h);if(gv(d)){const f=i[h],_=o[d]=we(f)||Se(f)?{type:f}:fn({},f),E=_.type;let T=!1,C=!0;if(we(E))for(let L=0;L<E.length;++L){const U=E[L],N=Se(U)&&U.name;if(N==="Boolean"){T=!0;break}else N==="String"&&(C=!1)}else T=Se(E)&&E.name==="Boolean";_[0]=T,_[1]=C,(T||We(_,"default"))&&a.push(d)}}const u=[o,a];return ot(n)&&s.set(n,u),u}function gv(n){return n[0]!=="$"&&!kl(n)}const Jm=n=>n==="_"||n==="_ctx"||n==="$stable",Xm=n=>we(n)?n.map(_s):[_s(n)],$1=(n,e,t)=>{if(e._n)return e;const s=Hn((...r)=>Xm(e(...r)),t);return s._c=!1,s},Vw=(n,e,t)=>{const s=n._ctx;for(const r in n){if(Jm(r))continue;const i=n[r];if(Se(i))e[r]=$1(r,i,s);else if(i!=null){const o=Xm(i);e[r]=()=>o}}},Ow=(n,e)=>{const t=Xm(e);n.slots.default=()=>t},Mw=(n,e,t)=>{for(const s in e)(t||!Jm(s))&&(n[s]=e[s])},j1=(n,e,t)=>{const s=n.slots=Nw();if(n.vnode.shapeFlag&32){const r=e._;r?(Mw(s,e,t),t&&jT(s,"_",r,!0)):Vw(e,s)}else e&&Ow(n,e)},G1=(n,e,t)=>{const{vnode:s,slots:r}=n;let i=!0,o=rt;if(s.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Mw(r,e,t):(i=!e.$stable,Vw(e,r)),o=e}else e&&(Ow(n,e),o={default:1});if(i)for(const a in r)!Jm(a)&&o[a]==null&&delete r[a]},Vn=Q1;function K1(n){return W1(n)}function W1(n,e){const t=dd();t.__VUE__=!0;const{insert:s,remove:r,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:h,parentNode:d,nextSibling:f,setScopeId:_=Ts,insertStaticContent:E}=n,T=(I,S,V,q=null,K=null,$=null,oe=void 0,Q=null,H=!!S.dynamicChildren)=>{if(I===S)return;I&&!dl(I,S)&&(q=j(I),xt(I,K,$,!0),I=null),S.patchFlag===-2&&(H=!1,S.dynamicChildren=null);const{type:z,ref:ve,shapeFlag:ce}=S;switch(z){case vd:C(I,S,V,q);break;case Ys:L(I,S,V,q);break;case qu:I==null&&U(S,V,q,oe);break;case qe:x(I,S,V,q,K,$,oe,Q,H);break;default:ce&1?G(I,S,V,q,K,$,oe,Q,H):ce&6?w(I,S,V,q,K,$,oe,Q,H):(ce&64||ce&128)&&z.process(I,S,V,q,K,$,oe,Q,H,_e)}ve!=null&&K?Ol(ve,I&&I.ref,$,S||I,!S):ve==null&&I&&I.ref!=null&&Ol(I.ref,null,$,I,!0)},C=(I,S,V,q)=>{if(I==null)s(S.el=a(S.children),V,q);else{const K=S.el=I.el;S.children!==I.children&&u(K,S.children)}},L=(I,S,V,q)=>{I==null?s(S.el=l(S.children||""),V,q):S.el=I.el},U=(I,S,V,q)=>{[I.el,I.anchor]=E(I.children,S,V,q,I.el,I.anchor)},N=({el:I,anchor:S},V,q)=>{let K;for(;I&&I!==S;)K=f(I),s(I,V,q),I=K;s(S,V,q)},k=({el:I,anchor:S})=>{let V;for(;I&&I!==S;)V=f(I),r(I),I=V;r(S)},G=(I,S,V,q,K,$,oe,Q,H)=>{if(S.type==="svg"?oe="svg":S.type==="math"&&(oe="mathml"),I==null)J(S,V,q,K,$,oe,Q,H);else{const z=I.el&&I.el._isVueCE?I.el:null;try{z&&z._beginPatch(),A(I,S,K,$,oe,Q,H)}finally{z&&z._endPatch()}}},J=(I,S,V,q,K,$,oe,Q)=>{let H,z;const{props:ve,shapeFlag:ce,transition:ge,dirs:Ee}=I;if(H=I.el=o(I.type,$,ve&&ve.is,ve),ce&8?h(H,I.children):ce&16&&v(I.children,H,null,q,K,Vf(I,$),oe,Q),Ee&&yi(I,null,q,"created"),b(H,I,I.scopeId,oe,q),ve){for(const Ye in ve)Ye!=="value"&&!kl(Ye)&&i(H,Ye,null,ve[Ye],$,q);"value"in ve&&i(H,"value",null,ve.value,$),(z=ve.onVnodeBeforeMount)&&fs(z,q,I)}Ee&&yi(I,null,q,"beforeMount");const xe=z1(K,ge);xe&&ge.beforeEnter(H),s(H,S,V),((z=ve&&ve.onVnodeMounted)||xe||Ee)&&Vn(()=>{z&&fs(z,q,I),xe&&ge.enter(H),Ee&&yi(I,null,q,"mounted")},K)},b=(I,S,V,q,K)=>{if(V&&_(I,V),q)for(let $=0;$<q.length;$++)_(I,q[$]);if(K){let $=K.subTree;if(S===$||Bw($.type)&&($.ssContent===S||$.ssFallback===S)){const oe=K.vnode;b(I,oe,oe.scopeId,oe.slotScopeIds,K.parent)}}},v=(I,S,V,q,K,$,oe,Q,H=0)=>{for(let z=H;z<I.length;z++){const ve=I[z]=Q?Sr(I[z]):_s(I[z]);T(null,ve,S,V,q,K,$,oe,Q)}},A=(I,S,V,q,K,$,oe)=>{const Q=S.el=I.el;let{patchFlag:H,dynamicChildren:z,dirs:ve}=S;H|=I.patchFlag&16;const ce=I.props||rt,ge=S.props||rt;let Ee;if(V&&vi(V,!1),(Ee=ge.onVnodeBeforeUpdate)&&fs(Ee,V,S,I),ve&&yi(S,I,V,"beforeUpdate"),V&&vi(V,!0),(ce.innerHTML&&ge.innerHTML==null||ce.textContent&&ge.textContent==null)&&h(Q,""),z?P(I.dynamicChildren,z,Q,V,q,Vf(S,K),$):oe||se(I,S,Q,null,V,q,Vf(S,K),$,!1),H>0){if(H&16)R(Q,ce,ge,V,K);else if(H&2&&ce.class!==ge.class&&i(Q,"class",null,ge.class,K),H&4&&i(Q,"style",ce.style,ge.style,K),H&8){const xe=S.dynamicProps;for(let Ye=0;Ye<xe.length;Ye++){const Be=xe[Ye],Zt=ce[Be],en=ge[Be];(en!==Zt||Be==="value")&&i(Q,Be,Zt,en,K,V)}}H&1&&I.children!==S.children&&h(Q,S.children)}else!oe&&z==null&&R(Q,ce,ge,V,K);((Ee=ge.onVnodeUpdated)||ve)&&Vn(()=>{Ee&&fs(Ee,V,S,I),ve&&yi(S,I,V,"updated")},q)},P=(I,S,V,q,K,$,oe)=>{for(let Q=0;Q<S.length;Q++){const H=I[Q],z=S[Q],ve=H.el&&(H.type===qe||!dl(H,z)||H.shapeFlag&198)?d(H.el):V;T(H,z,ve,null,q,K,$,oe,!0)}},R=(I,S,V,q,K)=>{if(S!==V){if(S!==rt)for(const $ in S)!kl($)&&!($ in V)&&i(I,$,S[$],null,K,q);for(const $ in V){if(kl($))continue;const oe=V[$],Q=S[$];oe!==Q&&$!=="value"&&i(I,$,Q,oe,K,q)}"value"in V&&i(I,"value",S.value,V.value,K)}},x=(I,S,V,q,K,$,oe,Q,H)=>{const z=S.el=I?I.el:a(""),ve=S.anchor=I?I.anchor:a("");let{patchFlag:ce,dynamicChildren:ge,slotScopeIds:Ee}=S;Ee&&(Q=Q?Q.concat(Ee):Ee),I==null?(s(z,V,q),s(ve,V,q),v(S.children||[],V,ve,K,$,oe,Q,H)):ce>0&&ce&64&&ge&&I.dynamicChildren&&I.dynamicChildren.length===ge.length?(P(I.dynamicChildren,ge,V,K,$,oe,Q),(S.key!=null||K&&S===K.subTree)&&Lw(I,S,!0)):se(I,S,V,ve,K,$,oe,Q,H)},w=(I,S,V,q,K,$,oe,Q,H)=>{S.slotScopeIds=Q,I==null?S.shapeFlag&512?K.ctx.activate(S,V,q,oe,H):nt(S,V,q,K,$,oe,H):Ut(I,S,H)},nt=(I,S,V,q,K,$,oe)=>{const Q=I.component=nN(I,q,K);if(Ew(I)&&(Q.ctx.renderer=_e),rN(Q,!1,oe),Q.asyncDep){if(K&&K.registerDep(Q,lt,oe),!I.el){const H=Q.subTree=He(Ys);L(null,H,S,V),I.placeholder=H.el}}else lt(Q,I,S,V,K,$,oe)},Ut=(I,S,V)=>{const q=S.component=I.component;if(L1(I,S,V))if(q.asyncDep&&!q.asyncResolved){Fe(q,S,V);return}else q.next=S,q.update();else S.el=I.el,q.vnode=S},lt=(I,S,V,q,K,$,oe)=>{const Q=()=>{if(I.isMounted){let{next:ce,bu:ge,u:Ee,parent:xe,vnode:Ye}=I;{const xn=Fw(I);if(xn){ce&&(ce.el=Ye.el,Fe(I,ce,oe)),xn.asyncDep.then(()=>{I.isUnmounted||Q()});return}}let Be=ce,Zt;vi(I,!1),ce?(ce.el=Ye.el,Fe(I,ce,oe)):ce=Ye,ge&&Uu(ge),(Zt=ce.props&&ce.props.onVnodeBeforeUpdate)&&fs(Zt,xe,ce,Ye),vi(I,!0);const en=mv(I),kn=I.subTree;I.subTree=en,T(kn,en,d(kn.el),j(kn),I,K,$),ce.el=en.el,Be===null&&F1(I,en.el),Ee&&Vn(Ee,K),(Zt=ce.props&&ce.props.onVnodeUpdated)&&Vn(()=>fs(Zt,xe,ce,Ye),K)}else{let ce;const{el:ge,props:Ee}=S,{bm:xe,m:Ye,parent:Be,root:Zt,type:en}=I,kn=Bo(S);vi(I,!1),xe&&Uu(xe),!kn&&(ce=Ee&&Ee.onVnodeBeforeMount)&&fs(ce,Be,S),vi(I,!0);{Zt.ce&&Zt.ce._def.shadowRoot!==!1&&Zt.ce._injectChildStyle(en);const xn=I.subTree=mv(I);T(null,xn,V,q,I,K,$),S.el=xn.el}if(Ye&&Vn(Ye,K),!kn&&(ce=Ee&&Ee.onVnodeMounted)){const xn=S;Vn(()=>fs(ce,Be,xn),K)}(S.shapeFlag&256||Be&&Bo(Be.vnode)&&Be.vnode.shapeFlag&256)&&I.a&&Vn(I.a,K),I.isMounted=!0,S=V=q=null}};I.scope.on();const H=I.effect=new HT(Q);I.scope.off();const z=I.update=H.run.bind(H),ve=I.job=H.runIfDirty.bind(H);ve.i=I,ve.id=I.uid,H.scheduler=()=>zm(ve),vi(I,!0),z()},Fe=(I,S,V)=>{S.component=I;const q=I.vnode.props;I.vnode=S,I.next=null,B1(I,S.props,q,V),G1(I,S.children,V),zs(),av(I),Hs()},se=(I,S,V,q,K,$,oe,Q,H=!1)=>{const z=I&&I.children,ve=I?I.shapeFlag:0,ce=S.children,{patchFlag:ge,shapeFlag:Ee}=S;if(ge>0){if(ge&128){ft(z,ce,V,q,K,$,oe,Q,H);return}else if(ge&256){re(z,ce,V,q,K,$,oe,Q,H);return}}Ee&8?(ve&16&&et(z,K,$),ce!==z&&h(V,ce)):ve&16?Ee&16?ft(z,ce,V,q,K,$,oe,Q,H):et(z,K,$,!0):(ve&8&&h(V,""),Ee&16&&v(ce,V,q,K,$,oe,Q,H))},re=(I,S,V,q,K,$,oe,Q,H)=>{I=I||Lo,S=S||Lo;const z=I.length,ve=S.length,ce=Math.min(z,ve);let ge;for(ge=0;ge<ce;ge++){const Ee=S[ge]=H?Sr(S[ge]):_s(S[ge]);T(I[ge],Ee,V,null,K,$,oe,Q,H)}z>ve?et(I,K,$,!0,!1,ce):v(S,V,q,K,$,oe,Q,H,ce)},ft=(I,S,V,q,K,$,oe,Q,H)=>{let z=0;const ve=S.length;let ce=I.length-1,ge=ve-1;for(;z<=ce&&z<=ge;){const Ee=I[z],xe=S[z]=H?Sr(S[z]):_s(S[z]);if(dl(Ee,xe))T(Ee,xe,V,null,K,$,oe,Q,H);else break;z++}for(;z<=ce&&z<=ge;){const Ee=I[ce],xe=S[ge]=H?Sr(S[ge]):_s(S[ge]);if(dl(Ee,xe))T(Ee,xe,V,null,K,$,oe,Q,H);else break;ce--,ge--}if(z>ce){if(z<=ge){const Ee=ge+1,xe=Ee<ve?S[Ee].el:q;for(;z<=ge;)T(null,S[z]=H?Sr(S[z]):_s(S[z]),V,xe,K,$,oe,Q,H),z++}}else if(z>ge)for(;z<=ce;)xt(I[z],K,$,!0),z++;else{const Ee=z,xe=z,Ye=new Map;for(z=xe;z<=ge;z++){const zt=S[z]=H?Sr(S[z]):_s(S[z]);zt.key!=null&&Ye.set(zt.key,z)}let Be,Zt=0;const en=ge-xe+1;let kn=!1,xn=0;const zn=new Array(en);for(z=0;z<en;z++)zn[z]=0;for(z=Ee;z<=ce;z++){const zt=I[z];if(Zt>=en){xt(zt,K,$,!0);continue}let Bt;if(zt.key!=null)Bt=Ye.get(zt.key);else for(Be=xe;Be<=ge;Be++)if(zn[Be-xe]===0&&dl(zt,S[Be])){Bt=Be;break}Bt===void 0?xt(zt,K,$,!0):(zn[Bt-xe]=z+1,Bt>=xn?xn=Bt:kn=!0,T(zt,S[Bt],V,null,K,$,oe,Q,H),Zt++)}const go=kn?H1(zn):Lo;for(Be=go.length-1,z=en-1;z>=0;z--){const zt=xe+z,Bt=S[zt],Qa=S[zt+1],fi=zt+1<ve?Qa.el||Uw(Qa):q;zn[z]===0?T(null,Bt,V,fi,K,$,oe,Q,H):kn&&(Be<0||z!==go[Be]?pn(Bt,V,fi,2):Be--)}}},pn=(I,S,V,q,K=null)=>{const{el:$,type:oe,transition:Q,children:H,shapeFlag:z}=I;if(z&6){pn(I.component.subTree,S,V,q);return}if(z&128){I.suspense.move(S,V,q);return}if(z&64){oe.move(I,S,V,_e);return}if(oe===qe){s($,S,V);for(let ce=0;ce<H.length;ce++)pn(H[ce],S,V,q);s(I.anchor,S,V);return}if(oe===qu){N(I,S,V);return}if(q!==2&&z&1&&Q)if(q===0)Q.beforeEnter($),s($,S,V),Vn(()=>Q.enter($),K);else{const{leave:ce,delayLeave:ge,afterLeave:Ee}=Q,xe=()=>{I.ctx.isUnmounted?r($):s($,S,V)},Ye=()=>{$._isLeaving&&$[u1](!0),ce($,()=>{xe(),Ee&&Ee()})};ge?ge($,xe,Ye):Ye()}else s($,S,V)},xt=(I,S,V,q=!1,K=!1)=>{const{type:$,props:oe,ref:Q,children:H,dynamicChildren:z,shapeFlag:ve,patchFlag:ce,dirs:ge,cacheIndex:Ee}=I;if(ce===-2&&(K=!1),Q!=null&&(zs(),Ol(Q,null,V,I,!0),Hs()),Ee!=null&&(S.renderCache[Ee]=void 0),ve&256){S.ctx.deactivate(I);return}const xe=ve&1&&ge,Ye=!Bo(I);let Be;if(Ye&&(Be=oe&&oe.onVnodeBeforeUnmount)&&fs(Be,S,I),ve&6)le(I.component,V,q);else{if(ve&128){I.suspense.unmount(V,q);return}xe&&yi(I,null,S,"beforeUnmount"),ve&64?I.type.remove(I,S,V,_e,q):z&&!z.hasOnce&&($!==qe||ce>0&&ce&64)?et(z,S,V,!1,!0):($===qe&&ce&384||!K&&ve&16)&&et(H,S,V),q&&ue(I)}(Ye&&(Be=oe&&oe.onVnodeUnmounted)||xe)&&Vn(()=>{Be&&fs(Be,S,I),xe&&yi(I,null,S,"unmounted")},V)},ue=I=>{const{type:S,el:V,anchor:q,transition:K}=I;if(S===qe){ie(V,q);return}if(S===qu){k(I);return}const $=()=>{r(V),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(I.shapeFlag&1&&K&&!K.persisted){const{leave:oe,delayLeave:Q}=K,H=()=>oe(V,$);Q?Q(I.el,$,H):H()}else $()},ie=(I,S)=>{let V;for(;I!==S;)V=f(I),r(I),I=V;r(S)},le=(I,S,V)=>{const{bum:q,scope:K,job:$,subTree:oe,um:Q,m:H,a:z}=I;yv(H),yv(z),q&&Uu(q),K.stop(),$&&($.flags|=8,xt(oe,I,S,V)),Q&&Vn(Q,S),Vn(()=>{I.isUnmounted=!0},S)},et=(I,S,V,q=!1,K=!1,$=0)=>{for(let oe=$;oe<I.length;oe++)xt(I[oe],S,V,q,K)},j=I=>{if(I.shapeFlag&6)return j(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const S=f(I.anchor||I.el),V=S&&S[l1];return V?f(V):S};let fe=!1;const ae=(I,S,V)=>{let q;I==null?S._vnode&&(xt(S._vnode,null,null,!0),q=S._vnode.component):T(S._vnode||null,I,S,null,null,null,V),S._vnode=I,fe||(fe=!0,av(q),pw(),fe=!1)},_e={p:T,um:xt,m:pn,r:ue,mt:nt,mc:v,pc:se,pbc:P,n:j,o:n};return{render:ae,hydrate:void 0,createApp:k1(ae)}}function Vf({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function vi({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function z1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Lw(n,e,t=!1){const s=n.children,r=e.children;if(we(s)&&we(r))for(let i=0;i<s.length;i++){const o=s[i];let a=r[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[i]=Sr(r[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Lw(o,a)),a.type===vd&&(a.patchFlag!==-1?a.el=o.el:a.__elIndex=i+(n.type===qe?1:0)),a.type===Ys&&!a.el&&(a.el=o.el)}}function H1(n){const e=n.slice(),t=[0];let s,r,i,o,a;const l=n.length;for(s=0;s<l;s++){const u=n[s];if(u!==0){if(r=t[t.length-1],n[r]<u){e[s]=r,t.push(s);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[s]=t[i-1]),t[i]=s)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Fw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Fw(e)}function yv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}function Uw(n){if(n.placeholder)return n.placeholder;const e=n.component;return e?Uw(e.subTree):null}const Bw=n=>n.__isSuspense;function Q1(n,e){e&&e.pendingBranch?we(n)?e.effects.push(...n):e.effects.push(n):r1(n)}const qe=Symbol.for("v-fgt"),vd=Symbol.for("v-txt"),Ys=Symbol.for("v-cmt"),qu=Symbol.for("v-stc"),Ll=[];let Ln=null;function Y(n=!1){Ll.push(Ln=n?null:[])}function Y1(){Ll.pop(),Ln=Ll[Ll.length-1]||null}let lc=1;function mh(n,e=!1){lc+=n,n<0&&Ln&&e&&(Ln.hasOnce=!0)}function qw(n){return n.dynamicChildren=lc>0?Ln||Lo:null,Y1(),lc>0&&Ln&&Ln.push(n),n}function X(n,e,t,s,r,i){return qw(g(n,e,t,s,r,i,!0))}function Zo(n,e,t,s,r){return qw(He(n,e,t,s,r,!0))}function cc(n){return n?n.__v_isVNode===!0:!1}function dl(n,e){return n.type===e.type&&n.key===e.key}const $w=({key:n})=>n??null,$u=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?kt(n)||cn(n)||Se(n)?{i:Jt,r:n,k:e,f:!!t}:n:null);function g(n,e=null,t=null,s=0,r=null,i=n===qe?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&$w(e),ref:e&&$u(e),scopeId:_w,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Jt};return a?(Zm(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=kt(t)?8:16),lc>0&&!o&&Ln&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Ln.push(l),l}const He=J1;function J1(n,e=null,t=null,s=0,r=null,i=!1){if((!n||n===T1)&&(n=Ys),cc(n)){const a=ea(n,e,!0);return t&&Zm(a,t),lc>0&&!i&&Ln&&(a.shapeFlag&6?Ln[Ln.indexOf(n)]=a:Ln.push(a)),a.patchFlag=-2,a}if(cN(n)&&(n=n.__vccOpts),e){e=X1(e);let{class:a,style:l}=e;a&&!kt(a)&&(e.class=Yo(a)),ot(l)&&(Wm(l)&&!we(l)&&(l=fn({},l)),e.style=fd(l))}const o=kt(n)?1:Bw(n)?128:c1(n)?64:ot(n)?4:Se(n)?2:0;return g(n,e,t,s,r,o,i,!0)}function X1(n){return n?Wm(n)||kw(n)?fn({},n):n:null}function ea(n,e,t=!1,s=!1){const{props:r,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?Z1(r||{},e):r,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&$w(u),ref:e&&e.ref?t&&i?we(i)?i.concat($u(e)):[i,$u(e)]:$u(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==qe?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ea(n.ssContent),ssFallback:n.ssFallback&&ea(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&Qm(h,l.clone(h)),h}function Qt(n=" ",e=0){return He(vd,null,n,e)}function ns(n,e){const t=He(qu,null,n);return t.staticCount=e,t}function At(n="",e=!1){return e?(Y(),Zo(Ys,null,n)):He(Ys,null,n)}function _s(n){return n==null||typeof n=="boolean"?He(Ys):we(n)?He(qe,null,n.slice()):cc(n)?Sr(n):He(vd,null,String(n))}function Sr(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ea(n)}function Zm(n,e){let t=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(we(e))t=16;else if(typeof e=="object")if(s&65){const r=e.default;r&&(r._c&&(r._d=!1),Zm(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!kw(e)?e._ctx=Jt:r===3&&Jt&&(Jt.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Se(e)?(e={default:e,_ctx:Jt},t=32):(e=String(e),s&64?(t=16,e=[Qt(e)]):t=8);n.children=e,n.shapeFlag|=t}function Z1(...n){const e={};for(let t=0;t<n.length;t++){const s=n[t];for(const r in s)if(r==="class")e.class!==s.class&&(e.class=Yo([e.class,s.class]));else if(r==="style")e.style=fd([e.style,s.style]);else if(ld(r)){const i=e[r],o=s[r];o&&i!==o&&!(we(i)&&i.includes(o))&&(e[r]=i?[].concat(i,o):o)}else r!==""&&(e[r]=s[r])}return e}function fs(n,e,t,s=null){Rs(n,e,7,[t,s])}const eN=Rw();let tN=0;function nN(n,e,t){const s=n.type,r=(e?e.appContext:n.appContext)||eN,i={uid:tN++,vnode:n,type:s,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new R0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Dw(s,r),emitsOptions:Cw(s,r),emit:null,emitted:null,propsDefaults:rt,inheritAttrs:s.inheritAttrs,ctx:rt,data:rt,props:rt,attrs:rt,slots:rt,refs:rt,setupState:rt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=D1.bind(null,i),n.ce&&n.ce(i),i}let ln=null;const sN=()=>ln||Jt;let _h,wp;{const n=dd(),e=(t,s)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(s),i=>{r.length>1?r.forEach(o=>o(i)):r[0](i)}};_h=e("__VUE_INSTANCE_SETTERS__",t=>ln=t),wp=e("__VUE_SSR_SETTERS__",t=>uc=t)}const Fc=n=>{const e=ln;return _h(n),n.scope.on(),()=>{n.scope.off(),_h(e)}},vv=()=>{ln&&ln.scope.off(),_h(null)};function jw(n){return n.vnode.shapeFlag&4}let uc=!1;function rN(n,e=!1,t=!1){e&&wp(e);const{props:s,children:r}=n.vnode,i=jw(n);U1(n,s,i,e),j1(n,r,t||e);const o=i?iN(n,e):void 0;return e&&wp(!1),o}function iN(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,b1);const{setup:s}=t;if(s){zs();const r=n.setupContext=s.length>1?aN(n):null,i=Fc(n),o=Lc(s,n,0,[n.props,r]),a=BT(o);if(Hs(),i(),(a||n.sp)&&!Bo(n)&&vw(n),a){if(o.then(vv,vv),e)return o.then(l=>{Ev(n,l)}).catch(l=>{_d(l,n,0)});n.asyncDep=o}else Ev(n,o)}else Gw(n)}function Ev(n,e,t){Se(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:ot(e)&&(n.setupState=uw(e)),Gw(n)}function Gw(n,e,t){const s=n.type;n.render||(n.render=s.render||Ts);{const r=Fc(n);zs();try{A1(n)}finally{Hs(),r()}}}const oN={get(n,e){return rn(n,"get",""),n[e]}};function aN(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,oN),slots:n.slots,emit:n.emit,expose:e}}function Ed(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(uw(H0(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ml)return Ml[t](n)},has(e,t){return t in e||t in Ml}})):n.proxy}function lN(n,e=!0){return Se(n)?n.displayName||n.name:n.name||e&&n.__name}function cN(n){return Se(n)&&"__vccOpts"in n}const he=(n,e)=>Z0(n,e,uc);function Kw(n,e,t){try{mh(-1);const s=arguments.length;return s===2?ot(e)&&!we(e)?cc(e)?He(n,null,[e]):He(n,e):He(n,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&cc(t)&&(t=[t]),He(n,e,t))}finally{mh(1)}}const uN="3.5.26";let bp;const Iv=typeof window<"u"&&window.trustedTypes;if(Iv)try{bp=Iv.createPolicy("vue",{createHTML:n=>n})}catch{}const Ww=bp?n=>bp.createHTML(n):n=>n,hN="http://www.w3.org/2000/svg",dN="http://www.w3.org/1998/Math/MathML",Ds=typeof document<"u"?document:null,Tv=Ds&&Ds.createElement("template"),fN={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,s)=>{const r=e==="svg"?Ds.createElementNS(hN,n):e==="mathml"?Ds.createElementNS(dN,n):t?Ds.createElement(n,{is:t}):Ds.createElement(n);return n==="select"&&s&&s.multiple!=null&&r.setAttribute("multiple",s.multiple),r},createText:n=>Ds.createTextNode(n),createComment:n=>Ds.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ds.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,s,r,i){const o=t?t.previousSibling:e.lastChild;if(r&&(r===i||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===i||!(r=r.nextSibling)););else{Tv.innerHTML=Ww(s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n);const a=Tv.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},pN=Symbol("_vtc");function mN(n,e,t){const s=n[pN];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const wv=Symbol("_vod"),_N=Symbol("_vsh"),gN=Symbol(""),yN=/(?:^|;)\s*display\s*:/;function vN(n,e,t){const s=n.style,r=kt(t);let i=!1;if(t&&!r){if(e)if(kt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&ju(s,a,"")}else for(const o in e)t[o]==null&&ju(s,o,"");for(const o in t)o==="display"&&(i=!0),ju(s,o,t[o])}else if(r){if(e!==t){const o=s[gN];o&&(t+=";"+o),s.cssText=t,i=yN.test(t)}}else e&&n.removeAttribute("style");wv in n&&(n[wv]=i?s.display:"",n[_N]&&(s.display="none"))}const bv=/\s*!important$/;function ju(n,e,t){if(we(t))t.forEach(s=>ju(n,e,s));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const s=EN(n,e);bv.test(t)?n.setProperty(oo(s),t.replace(bv,""),"important"):n[s]=t}}const Av=["Webkit","Moz","ms"],Of={};function EN(n,e){const t=Of[e];if(t)return t;let s=Kn(e);if(s!=="filter"&&s in n)return Of[e]=s;s=hd(s);for(let r=0;r<Av.length;r++){const i=Av[r]+s;if(i in n)return Of[e]=i}return e}const Sv="http://www.w3.org/1999/xlink";function Rv(n,e,t,s,r,i=A0(e)){s&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Sv,e.slice(6,e.length)):n.setAttributeNS(Sv,e,t):t==null||i&&!GT(t)?n.removeAttribute(e):n.setAttribute(e,i?"":as(t)?String(t):t)}function Cv(n,e,t,s,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Ww(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=GT(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(r||e)}function Cr(n,e,t,s){n.addEventListener(e,t,s)}function IN(n,e,t,s){n.removeEventListener(e,t,s)}const Pv=Symbol("_vei");function TN(n,e,t,s,r=null){const i=n[Pv]||(n[Pv]={}),o=i[e];if(s&&o)o.value=s;else{const[a,l]=wN(e);if(s){const u=i[e]=SN(s,r);Cr(n,a,u,l)}else o&&(IN(n,a,o,l),i[e]=void 0)}}const Nv=/(?:Once|Passive|Capture)$/;function wN(n){let e;if(Nv.test(n)){e={};let s;for(;s=n.match(Nv);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):oo(n.slice(2)),e]}let Mf=0;const bN=Promise.resolve(),AN=()=>Mf||(bN.then(()=>Mf=0),Mf=Date.now());function SN(n,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;Rs(RN(s,t.value),e,5,[s])};return t.value=n,t.attached=AN(),t}function RN(n,e){if(we(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(s=>r=>!r._stopped&&s&&s(r))}else return e}const kv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,CN=(n,e,t,s,r,i)=>{const o=r==="svg";e==="class"?mN(n,s,o):e==="style"?vN(n,t,s):ld(e)?Mm(e)||TN(n,e,t,s,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):PN(n,e,s,o))?(Cv(n,e,s),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Rv(n,e,s,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!kt(s))?Cv(n,Kn(e),s,i,e):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),Rv(n,e,s,o))};function PN(n,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in n&&kv(e)&&Se(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return kv(e)&&kt(t)?!1:e in n}const ta=n=>{const e=n.props["onUpdate:modelValue"]||!1;return we(e)?t=>Uu(e,t):e};function NN(n){n.target.composing=!0}function xv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ks=Symbol("_assign");function Dv(n,e,t){return e&&(n=n.trim()),t&&(n=Um(n)),n}const kN={created(n,{modifiers:{lazy:e,trim:t,number:s}},r){n[Ks]=ta(r);const i=s||r.props&&r.props.type==="number";Cr(n,e?"change":"input",o=>{o.target.composing||n[Ks](Dv(n.value,t,i))}),(t||i)&&Cr(n,"change",()=>{n.value=Dv(n.value,t,i)}),e||(Cr(n,"compositionstart",NN),Cr(n,"compositionend",xv),Cr(n,"change",xv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:s,trim:r,number:i}},o){if(n[Ks]=ta(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Um(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(s&&e===t||r&&n.value.trim()===l)||(n.value=l))}},xN={deep:!0,created(n,e,t){n[Ks]=ta(t),Cr(n,"change",()=>{const s=n._modelValue,r=zw(n),i=n.checked,o=n[Ks];if(we(s)){const a=KT(s,r),l=a!==-1;if(i&&!l)o(s.concat(r));else if(!i&&l){const u=[...s];u.splice(a,1),o(u)}}else if(cd(s)){const a=new Set(s);i?a.add(r):a.delete(r),o(a)}else o(Hw(n,i))})},mounted:Vv,beforeUpdate(n,e,t){n[Ks]=ta(t),Vv(n,e,t)}};function Vv(n,{value:e,oldValue:t},s){n._modelValue=e;let r;if(we(e))r=KT(e,s.props.value)>-1;else if(cd(e))r=e.has(s.props.value);else{if(e===t)return;r=Jo(e,Hw(n,!0))}n.checked!==r&&(n.checked=r)}const Lf={created(n,{value:e},t){n.checked=Jo(e,t.props.value),n[Ks]=ta(t),Cr(n,"change",()=>{n[Ks](zw(n))})},beforeUpdate(n,{value:e,oldValue:t},s){n[Ks]=ta(s),e!==t&&(n.checked=Jo(e,s.props.value))}};function zw(n){return"_value"in n?n._value:n.value}function Hw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const DN=["ctrl","shift","alt","meta"],VN={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>DN.some(t=>n[`${t}Key`]&&!e.includes(t))},Qw=(n,e)=>{const t=n._withMods||(n._withMods={}),s=e.join(".");return t[s]||(t[s]=((r,...i)=>{for(let o=0;o<e.length;o++){const a=VN[e[o]];if(a&&a(r,e))return}return n(r,...i)}))},ON=fn({patchProp:CN},fN);let Ov;function MN(){return Ov||(Ov=K1(ON))}const LN=((...n)=>{const e=MN().createApp(...n),{mount:t}=e;return e.mount=s=>{const r=UN(s);if(!r)return;const i=e._component;!Se(i)&&!i.render&&!i.template&&(i.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=t(r,!1,FN(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},e});function FN(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function UN(n){return kt(n)?document.querySelector(n):n}const BN=()=>{};var Mv={};const Yw={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Z=function(n,e){if(!n)throw Na(e)},Na=function(n){return new Error("Firebase Database ("+Yw.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Jw=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},qN=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},e_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(f=64)),s.push(t[h],t[d],t[f],t[_])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Jw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qN(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const d=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||d==null)throw new $N;const f=i<<2|a>>4;if(s.push(f),u!==64){const _=a<<4&240|u>>2;if(s.push(_),d!==64){const E=u<<6&192|d;s.push(E)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class $N extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Xw=function(n){const e=Jw(n);return e_.encodeByteArray(e,!0)},gh=function(n){return Xw(n).replace(/\./g,"")},yh=function(n){try{return e_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function jN(n){return Zw(void 0,n)}function Zw(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!GN(t)||(n[t]=Zw(n[t],e[t]));return n}function GN(n){return n!=="__proto__"}function eb(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const KN=()=>eb().__FIREBASE_DEFAULTS__,WN=()=>{if(typeof process>"u"||typeof Mv>"u")return;const n=Mv.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zN=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&yh(n[1]);return e&&JSON.parse(e)},Id=()=>{try{return BN()||KN()||WN()||zN()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},tb=n=>Id()?.emulatorHosts?.[n],nb=n=>{const e=tb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},sb=()=>Id()?.config,rb=n=>Id()?.[`_${n}`];class t_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function sr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Td(n){return(await fetch(n,{credentials:"include"})).ok}function ib(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[gh(JSON.stringify(t)),gh(JSON.stringify(o)),""].join(".")}const Fl={};function HN(){const n={prod:[],emulator:[]};for(const e of Object.keys(Fl))Fl[e]?n.emulator.push(e):n.prod.push(e);return n}function QN(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Lv=!1;function n_(n,e){if(typeof window>"u"||typeof document>"u"||!sr(window.location.host)||Fl[n]===e||Fl[n]||Lv)return;Fl[n]=e;function t(f){return`__firebase__banner__${f}`}const s="__firebase__banner",i=HN().prod.length>0;function o(){const f=document.getElementById(s);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,_){f.setAttribute("width","24"),f.setAttribute("id",_),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Lv=!0,o()},f}function h(f,_){f.setAttribute("id",_),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function d(){const f=QN(s),_=t("text"),E=document.getElementById(_)||document.createElement("span"),T=t("learnmore"),C=document.getElementById(T)||document.createElement("a"),L=t("preprendIcon"),U=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const N=f.element;a(N),h(C,T);const k=u();l(U,L),N.append(U,E,C,k),document.body.appendChild(N)}i?(E.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function Mt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function s_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mt())}function ob(){const n=Id()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function YN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function JN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ab(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function XN(){const n=Mt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ZN(){return Yw.NODE_ADMIN===!0}function lb(){return!ob()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cb(){return!ob()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ub(){try{return typeof indexedDB=="object"}catch{return!1}}function ek(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const tk="FirebaseError";class rr extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=tk,Object.setPrototypeOf(this,rr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Uc.prototype.create)}}class Uc{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?nk(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new rr(r,a,s)}}function nk(n,e){return n.replace(sk,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const sk=/\{\$([^}]+)}/g;function hc(n){return JSON.parse(n)}function Kt(n){return JSON.stringify(n)}const hb=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=hc(yh(i[0])||""),t=hc(yh(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},rk=function(n){const e=hb(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},ik=function(n){const e=hb(n).claims;return typeof e=="object"&&e.admin===!0};function ir(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function na(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ap(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function vh(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function Wn(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(Fv(i)&&Fv(o)){if(!Wn(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Fv(n){return n!==null&&typeof n=="object"}function ka(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class ok{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)s[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const f=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(f<<1|f>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let d=0;d<80;d++){d<40?d<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):d<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const f=(r<<5|r>>>27)+u+l+h+s[d]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=f}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function ak(n,e){const t=new lk(n,e);return t.subscribe.bind(t)}class lk{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");ck(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=Ff),r.error===void 0&&(r.error=Ff),r.complete===void 0&&(r.complete=Ff);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ck(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ff(){}function db(n,e){return`${n} failed: ${e} argument `}const uk=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,Z(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},wd=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function je(n){return n&&n._delegate?n._delegate:n}class Kr{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ti="[DEFAULT]";class hk{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new t_;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(fk(e))try{this.getOrInitializeService({instanceIdentifier:Ti})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Ti){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ti){return this.instances.has(e)}getOptions(e=Ti){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:dk(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ti){return this.component?this.component.multipleInstances?e:Ti:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dk(n){return n===Ti?void 0:n}function fk(n){return n.instantiationMode==="EAGER"}class pk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new hk(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var De;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(De||(De={}));const mk={debug:De.DEBUG,verbose:De.VERBOSE,info:De.INFO,warn:De.WARN,error:De.ERROR,silent:De.SILENT},_k=De.INFO,gk={[De.DEBUG]:"log",[De.VERBOSE]:"log",[De.INFO]:"info",[De.WARN]:"warn",[De.ERROR]:"error"},yk=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=gk[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bd{constructor(e){this.name=e,this._logLevel=_k,this._logHandler=yk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in De))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?mk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,De.DEBUG,...e),this._logHandler(this,De.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,De.VERBOSE,...e),this._logHandler(this,De.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,De.INFO,...e),this._logHandler(this,De.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,De.WARN,...e),this._logHandler(this,De.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,De.ERROR,...e),this._logHandler(this,De.ERROR,...e)}}const vk=(n,e)=>e.some(t=>n instanceof t);let Uv,Bv;function Ek(){return Uv||(Uv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ik(){return Bv||(Bv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fb=new WeakMap,Sp=new WeakMap,pb=new WeakMap,Uf=new WeakMap,r_=new WeakMap;function Tk(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ur(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&fb.set(t,n)}).catch(()=>{}),r_.set(e,n),e}function wk(n){if(Sp.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Sp.set(n,e)}let Rp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Sp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||pb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ur(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function bk(n){Rp=n(Rp)}function Ak(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Bf(this),e,...t);return pb.set(s,e.sort?e.sort():[e]),Ur(s)}:Ik().includes(n)?function(...e){return n.apply(Bf(this),e),Ur(fb.get(this))}:function(...e){return Ur(n.apply(Bf(this),e))}}function Sk(n){return typeof n=="function"?Ak(n):(n instanceof IDBTransaction&&wk(n),vk(n,Ek())?new Proxy(n,Rp):n)}function Ur(n){if(n instanceof IDBRequest)return Tk(n);if(Uf.has(n))return Uf.get(n);const e=Sk(n);return e!==n&&(Uf.set(n,e),r_.set(e,n)),e}const Bf=n=>r_.get(n);function Rk(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Ur(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Ur(o.result),l.oldVersion,l.newVersion,Ur(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Ck=["get","getKey","getAll","getAllKeys","count"],Pk=["put","add","delete","clear"],qf=new Map;function qv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(qf.get(e))return qf.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Pk.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Ck.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return qf.set(e,i),i}bk(n=>({...n,get:(e,t,s)=>qv(e,t)||n.get(e,t,s),has:(e,t)=>!!qv(e,t)||n.has(e,t)}));class Nk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(kk(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function kk(n){return n.getComponent()?.type==="VERSION"}const Cp="@firebase/app",$v="0.14.6";const Js=new bd("@firebase/app"),xk="@firebase/app-compat",Dk="@firebase/analytics-compat",Vk="@firebase/analytics",Ok="@firebase/app-check-compat",Mk="@firebase/app-check",Lk="@firebase/auth",Fk="@firebase/auth-compat",Uk="@firebase/database",Bk="@firebase/data-connect",qk="@firebase/database-compat",$k="@firebase/functions",jk="@firebase/functions-compat",Gk="@firebase/installations",Kk="@firebase/installations-compat",Wk="@firebase/messaging",zk="@firebase/messaging-compat",Hk="@firebase/performance",Qk="@firebase/performance-compat",Yk="@firebase/remote-config",Jk="@firebase/remote-config-compat",Xk="@firebase/storage",Zk="@firebase/storage-compat",ex="@firebase/firestore",tx="@firebase/ai",nx="@firebase/firestore-compat",sx="firebase",rx="12.6.0";const Eh="[DEFAULT]",ix={[Cp]:"fire-core",[xk]:"fire-core-compat",[Vk]:"fire-analytics",[Dk]:"fire-analytics-compat",[Mk]:"fire-app-check",[Ok]:"fire-app-check-compat",[Lk]:"fire-auth",[Fk]:"fire-auth-compat",[Uk]:"fire-rtdb",[Bk]:"fire-data-connect",[qk]:"fire-rtdb-compat",[$k]:"fire-fn",[jk]:"fire-fn-compat",[Gk]:"fire-iid",[Kk]:"fire-iid-compat",[Wk]:"fire-fcm",[zk]:"fire-fcm-compat",[Hk]:"fire-perf",[Qk]:"fire-perf-compat",[Yk]:"fire-rc",[Jk]:"fire-rc-compat",[Xk]:"fire-gcs",[Zk]:"fire-gcs-compat",[ex]:"fire-fst",[nx]:"fire-fst-compat",[tx]:"fire-vertex","fire-js":"fire-js",[sx]:"fire-js-all"};const Ih=new Map,ox=new Map,Pp=new Map;function jv(n,e){try{n.container.addComponent(e)}catch(t){Js.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Gi(n){const e=n.name;if(Pp.has(e))return Js.debug(`There were multiple attempts to register component ${e}.`),!1;Pp.set(e,n);for(const t of Ih.values())jv(t,n);for(const t of ox.values())jv(t,n);return!0}function xa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ax(n,e,t=Eh){xa(n,e).clearInstance(t)}function qn(n){return n==null?!1:n.settings!==void 0}const lx={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Br=new Uc("app","Firebase",lx);class cx{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Kr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Br.create("app-deleted",{appName:this._name})}}const ao=rx;function mb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Eh,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Br.create("bad-app-name",{appName:String(r)});if(t||(t=sb()),!t)throw Br.create("no-options");const i=Ih.get(r);if(i){if(Wn(t,i.options)&&Wn(s,i.config))return i;throw Br.create("duplicate-app",{appName:r})}const o=new pk(r);for(const l of Pp.values())o.addComponent(l);const a=new cx(t,s,o);return Ih.set(r,a),a}function i_(n=Eh){const e=Ih.get(n);if(!e&&n===Eh&&sb())return mb();if(!e)throw Br.create("no-app",{appName:n});return e}function ws(n,e,t){let s=ix[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Js.warn(o.join(" "));return}Gi(new Kr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const ux="firebase-heartbeat-database",hx=1,dc="firebase-heartbeat-store";let $f=null;function _b(){return $f||($f=Rk(ux,hx,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(dc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Br.create("idb-open",{originalErrorMessage:n.message})})),$f}async function dx(n){try{const t=(await _b()).transaction(dc),s=await t.objectStore(dc).get(gb(n));return await t.done,s}catch(e){if(e instanceof rr)Js.warn(e.message);else{const t=Br.create("idb-get",{originalErrorMessage:e?.message});Js.warn(t.message)}}}async function Gv(n,e){try{const s=(await _b()).transaction(dc,"readwrite");await s.objectStore(dc).put(e,gb(n)),await s.done}catch(t){if(t instanceof rr)Js.warn(t.message);else{const s=Br.create("idb-set",{originalErrorMessage:t?.message});Js.warn(s.message)}}}function gb(n){return`${n.name}!${n.options.appId}`}const fx=1024,px=30;class mx{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new gx(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Kv();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>px){const r=yx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Js.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Kv(),{heartbeatsToSend:t,unsentEntries:s}=_x(this._heartbeatsCache.heartbeats),r=gh(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Js.warn(e),""}}}function Kv(){return new Date().toISOString().substring(0,10)}function _x(n,e=fx){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),Wv(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Wv(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class gx{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ub()?ek().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await dx(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Gv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Gv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Wv(n){return gh(JSON.stringify({version:2,heartbeats:n})).length}function yx(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function vx(n){Gi(new Kr("platform-logger",e=>new Nk(e),"PRIVATE")),Gi(new Kr("heartbeat",e=>new mx(e),"PRIVATE")),ws(Cp,$v,n),ws(Cp,$v,"esm2020"),ws("fire-js","")}vx("");function yb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ex=yb,vb=new Uc("auth","Firebase",yb());const Th=new bd("@firebase/auth");function Ix(n,...e){Th.logLevel<=De.WARN&&Th.warn(`Auth (${ao}): ${n}`,...e)}function Gu(n,...e){Th.logLevel<=De.ERROR&&Th.error(`Auth (${ao}): ${n}`,...e)}function Cs(n,...e){throw a_(n,...e)}function ss(n,...e){return a_(n,...e)}function o_(n,e,t){const s={...Ex(),[e]:t};return new Uc("auth","Firebase",s).create(e,{appName:n.name})}function Fi(n){return o_(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Tx(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Cs(n,"argument-error"),o_(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function a_(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return vb.create(n,...e)}function be(n,e,...t){if(!n)throw a_(e,...t)}function Us(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Gu(e),new Error(e)}function Xs(n,e){n||Us(e)}function Np(){return typeof self<"u"&&self.location?.href||""}function wx(){return zv()==="http:"||zv()==="https:"}function zv(){return typeof self<"u"&&self.location?.protocol||null}function bx(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(wx()||JN()||"connection"in navigator)?navigator.onLine:!0}function Ax(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Bc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Xs(t>e,"Short delay should be less than long delay!"),this.isMobile=s_()||ab()}get(){return bx()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function l_(n,e){Xs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Eb{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Us("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Us("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Us("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Sx={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Rx=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Cx=new Bc(3e4,6e4);function c_(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Da(n,e,t,s,r={}){return Ib(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=ka({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return YN()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&sr(n.emulatorConfig.host)&&(u.credentials="include"),Eb.fetch()(await Tb(n,n.config.apiHost,t,a),u)})}async function Ib(n,e,t){n._canInitEmulator=!1;const s={...Sx,...e};try{const r=new Nx(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Au(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Au(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Au(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Au(n,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw o_(n,h,u);Cs(n,h)}}catch(r){if(r instanceof rr)throw r;Cs(n,"network-request-failed",{message:String(r)})}}async function Px(n,e,t,s,r={}){const i=await Da(n,e,t,s,r);return"mfaPendingCredential"in i&&Cs(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Tb(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?l_(n.config,r):`${n.config.apiScheme}://${r}`;return Rx.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class Nx{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(ss(this.auth,"network-request-failed")),Cx.get())})}}function Au(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=ss(n,e,s);return r.customData._tokenResponse=t,r}async function kx(n,e){return Da(n,"POST","/v1/accounts:delete",e)}async function wh(n,e){return Da(n,"POST","/v1/accounts:lookup",e)}function Ul(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function xx(n,e=!1){const t=je(n),s=await t.getIdToken(e),r=u_(s);be(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:Ul(jf(r.auth_time)),issuedAtTime:Ul(jf(r.iat)),expirationTime:Ul(jf(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function jf(n){return Number(n)*1e3}function u_(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Gu("JWT malformed, contained fewer than 3 sections"),null;try{const r=yh(t);return r?JSON.parse(r):(Gu("Failed to decode base64 JWT payload"),null)}catch(r){return Gu("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Hv(n){const e=u_(n);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function fc(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof rr&&Dx(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Dx({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Vx{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class kp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ul(this.lastLoginAt),this.creationTime=Ul(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bh(n){const e=n.auth,t=await n.getIdToken(),s=await fc(n,wh(e,{idToken:t}));be(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?wb(r.providerUserInfo):[],o=Mx(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!o?.length,u=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new kp(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Ox(n){const e=je(n);await bh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Mx(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function wb(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Lx(n,e){const t=await Ib(n,{},async()=>{const s=ka({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await Tb(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&sr(n.emulatorConfig.host)&&(l.credentials="include"),Eb.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Fx(n,e){return Da(n,"POST","/v2/accounts:revokeToken",c_(n,e))}class $o{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Hv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){be(e.length!==0,"internal-error");const t=Hv(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Lx(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new $o;return s&&(be(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(be(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $o,this.toJSON())}_performRefresh(){return Us("not implemented")}}function gr(n,e){be(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Jn{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new Vx(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new kp(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await fc(this,this.stsTokenManager.getToken(this.auth,e));return be(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return xx(this,e)}reload(){return Ox(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Jn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await bh(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qn(this.auth.app))return Promise.reject(Fi(this.auth));const e=await this.getIdToken();return await fc(this,kx(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:d,emailVerified:f,isAnonymous:_,providerData:E,stsTokenManager:T}=t;be(d&&T,e,"internal-error");const C=$o.fromJSON(this.name,T);be(typeof d=="string",e,"internal-error"),gr(s,e.name),gr(r,e.name),be(typeof f=="boolean",e,"internal-error"),be(typeof _=="boolean",e,"internal-error"),gr(i,e.name),gr(o,e.name),gr(a,e.name),gr(l,e.name),gr(u,e.name),gr(h,e.name);const L=new Jn({uid:d,auth:e,email:r,emailVerified:f,displayName:s,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:C,createdAt:u,lastLoginAt:h});return E&&Array.isArray(E)&&(L.providerData=E.map(U=>({...U}))),l&&(L._redirectEventId=l),L}static async _fromIdTokenResponse(e,t,s=!1){const r=new $o;r.updateFromServerResponse(t);const i=new Jn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await bh(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];be(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?wb(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!i?.length,a=new $o;a.updateFromIdToken(s);const l=new Jn({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new kp(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,u),l}}const Qv=new Map;function Bs(n){Xs(n instanceof Function,"Expected a class definition");let e=Qv.get(n);return e?(Xs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Qv.set(n,e),e)}class bb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bb.type="NONE";const Yv=bb;function Ku(n,e,t){return`firebase:${n}:${e}:${t}`}class jo{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Ku(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ku("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await wh(this.auth,{idToken:e}).catch(()=>{});return t?Jn._fromGetAccountInfoResponse(this.auth,t,e):null}return Jn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new jo(Bs(Yv),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Bs(Yv);const o=Ku(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let d;if(typeof h=="string"){const f=await wh(e,{idToken:h}).catch(()=>{});if(!f)break;d=await Jn._fromGetAccountInfoResponse(e,f,h)}else d=Jn._fromJSON(e,h);u!==i&&(a=d),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new jo(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new jo(i,e,s))}}function Jv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cb(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ab(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Nb(e))return"Blackberry";if(kb(e))return"Webos";if(Sb(e))return"Safari";if((e.includes("chrome/")||Rb(e))&&!e.includes("edge/"))return"Chrome";if(Pb(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function Ab(n=Mt()){return/firefox\//i.test(n)}function Sb(n=Mt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Rb(n=Mt()){return/crios\//i.test(n)}function Cb(n=Mt()){return/iemobile/i.test(n)}function Pb(n=Mt()){return/android/i.test(n)}function Nb(n=Mt()){return/blackberry/i.test(n)}function kb(n=Mt()){return/webos/i.test(n)}function h_(n=Mt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Ux(n=Mt()){return h_(n)&&!!window.navigator?.standalone}function Bx(){return XN()&&document.documentMode===10}function xb(n=Mt()){return h_(n)||Pb(n)||kb(n)||Nb(n)||/windows phone/i.test(n)||Cb(n)}function Db(n,e=[]){let t;switch(n){case"Browser":t=Jv(Mt());break;case"Worker":t=`${Jv(Mt())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ao}/${s}`}class qx{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function $x(n,e={}){return Da(n,"GET","/v2/passwordPolicy",c_(n,e))}const jx=6;class Gx{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??jx,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Kx{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xv(this),this.idTokenSubscription=new Xv(this),this.beforeStateQueue=new qx(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vb,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bs(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await jo.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await wh(this,{idToken:e}),s=await Jn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(qn(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bh(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Ax()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(qn(this.app))return Promise.reject(Fi(this));const t=e?je(e):null;return t&&be(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return qn(this.app)?Promise.reject(Fi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return qn(this.app)?Promise.reject(Fi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $x(this),t=new Gx(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Uc("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Fx(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Bs(e)||this._popupRedirectResolver;be(t,this,"argument-error"),this.redirectPersistenceManager=await jo.create(this,[Bs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Db(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(qn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Ix(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Ad(n){return je(n)}class Xv{constructor(e){this.auth=e,this.observer=null,this.addObserver=ak(t=>this.observer=t)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let d_={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Wx(n){d_=n}function zx(n){return d_.loadJS(n)}function Hx(){return d_.gapiScript}function Qx(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Yx(n,e){const t=xa(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(Wn(i,e??{}))return r;Cs(r,"already-initialized")}return t.initialize({options:e})}function Jx(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Bs);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Xx(n,e,t){const s=Ad(n);be(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=Vb(e),{host:o,port:a}=Zx(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){be(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),be(Wn(u,s.config.emulator)&&Wn(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,sr(o)?(Td(`${i}//${o}${l}`),n_("Auth",!0)):eD()}function Vb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Zx(n){const e=Vb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:Zv(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:Zv(o)}}}function Zv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function eD(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Ob{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Us("not implemented")}_getIdTokenResponse(e){return Us("not implemented")}_linkToIdToken(e,t){return Us("not implemented")}_getReauthenticationResolver(e){return Us("not implemented")}}async function Go(n,e){return Px(n,"POST","/v1/accounts:signInWithIdp",c_(n,e))}const tD="http://localhost";class Ki extends Ob{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ki(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Cs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new Ki(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Go(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Go(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Go(e,t)}buildRequest(){const e={requestUri:tD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ka(t)}return e}}class f_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qc extends f_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Pr extends qc{constructor(){super("facebook.com")}static credential(e){return Ki._fromParams({providerId:Pr.PROVIDER_ID,signInMethod:Pr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pr.credentialFromTaggedObject(e)}static credentialFromError(e){return Pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pr.credential(e.oauthAccessToken)}catch{return null}}}Pr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Pr.PROVIDER_ID="facebook.com";class Fs extends qc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ki._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Fs.credential(t,s)}catch{return null}}}Fs.GOOGLE_SIGN_IN_METHOD="google.com";Fs.PROVIDER_ID="google.com";class Nr extends qc{constructor(){super("github.com")}static credential(e){return Ki._fromParams({providerId:Nr.PROVIDER_ID,signInMethod:Nr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nr.credentialFromTaggedObject(e)}static credentialFromError(e){return Nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Nr.credential(e.oauthAccessToken)}catch{return null}}}Nr.GITHUB_SIGN_IN_METHOD="github.com";Nr.PROVIDER_ID="github.com";class kr extends qc{constructor(){super("twitter.com")}static credential(e,t){return Ki._fromParams({providerId:kr.PROVIDER_ID,signInMethod:kr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return kr.credentialFromTaggedObject(e)}static credentialFromError(e){return kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return kr.credential(t,s)}catch{return null}}}kr.TWITTER_SIGN_IN_METHOD="twitter.com";kr.PROVIDER_ID="twitter.com";class sa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Jn._fromIdTokenResponse(e,s,r),o=eE(s);return new sa({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=eE(s);return new sa({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function eE(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Ah extends rr{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Ah.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new Ah(e,t,s,r)}}function Mb(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ah._fromErrorAndOperation(n,i,e,s):i})}async function nD(n,e,t=!1){const s=await fc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return sa._forOperation(n,"link",s)}async function sD(n,e,t=!1){const{auth:s}=n;if(qn(s.app))return Promise.reject(Fi(s));const r="reauthenticate";try{const i=await fc(n,Mb(s,r,e,n),t);be(i.idToken,s,"internal-error");const o=u_(i.idToken);be(o,s,"internal-error");const{sub:a}=o;return be(n.uid===a,s,"user-mismatch"),sa._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&Cs(s,"user-mismatch"),i}}async function rD(n,e,t=!1){if(qn(n.app))return Promise.reject(Fi(n));const s="signIn",r=await Mb(n,s,e),i=await sa._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}function iD(n,e,t,s){return je(n).onIdTokenChanged(e,t,s)}function oD(n,e,t){return je(n).beforeAuthStateChanged(e,t)}function aD(n,e,t,s){return je(n).onAuthStateChanged(e,t,s)}function lD(n){return je(n).signOut()}const Sh="__sak";class Lb{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Sh,"1"),this.storage.removeItem(Sh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const cD=1e3,uD=10;class Fb extends Lb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xb(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Bx()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,uD):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},cD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Fb.type="LOCAL";const hD=Fb;class Ub extends Lb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ub.type="SESSION";const Bb=Ub;function dD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Sd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new Sd(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await dD(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sd.receivers=[];function p_(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class fD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=p_("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const f=d;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function bs(){return window}function pD(n){bs().location.href=n}function qb(){return typeof bs().WorkerGlobalScope<"u"&&typeof bs().importScripts=="function"}async function mD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _D(){return navigator?.serviceWorker?.controller||null}function gD(){return qb()?self:null}const $b="firebaseLocalStorageDb",yD=1,Rh="firebaseLocalStorage",jb="fbase_key";class $c{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Rd(n,e){return n.transaction([Rh],e?"readwrite":"readonly").objectStore(Rh)}function vD(){const n=indexedDB.deleteDatabase($b);return new $c(n).toPromise()}function xp(){const n=indexedDB.open($b,yD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Rh,{keyPath:jb})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Rh)?e(s):(s.close(),await vD(),e(await xp()))})})}async function tE(n,e,t){const s=Rd(n,!0).put({[jb]:e,value:t});return new $c(s).toPromise()}async function ED(n,e){const t=Rd(n,!1).get(e),s=await new $c(t).toPromise();return s===void 0?null:s.value}function nE(n,e){const t=Rd(n,!0).delete(e);return new $c(t).toPromise()}const ID=800,TD=3;class Gb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await xp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>TD)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sd._getInstance(gD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await mD(),!this.activeServiceWorker)return;this.sender=new fD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_D()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await xp();return await tE(e,Sh,"1"),await nE(e,Sh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>tE(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>ED(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Rd(r,!1).getAll();return new $c(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ID)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Gb.type="LOCAL";const wD=Gb;new Bc(3e4,6e4);function Kb(n,e){return e?Bs(e):(be(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class m_ extends Ob{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Go(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Go(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Go(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function bD(n){return rD(n.auth,new m_(n),n.bypassAuthState)}function AD(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),sD(t,new m_(n),n.bypassAuthState)}async function SD(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),nD(t,new m_(n),n.bypassAuthState)}class Wb{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bD;case"linkViaPopup":case"linkViaRedirect":return SD;case"reauthViaPopup":case"reauthViaRedirect":return AD;default:Cs(this.auth,"internal-error")}}resolve(e){Xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const RD=new Bc(2e3,1e4);async function CD(n,e,t){if(qn(n.app))return Promise.reject(ss(n,"operation-not-supported-in-this-environment"));const s=Ad(n);Tx(n,e,f_);const r=Kb(s,t);return new ki(s,"signInViaPopup",e,r).executeNotNull()}class ki extends Wb{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,ki.currentPopupAction&&ki.currentPopupAction.cancel(),ki.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){Xs(this.filter.length===1,"Popup operations only handle one event");const e=p_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ss(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ss(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ki.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ss(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,RD.get())};e()}}ki.currentPopupAction=null;const PD="pendingRedirect",Wu=new Map;class ND extends Wb{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Wu.get(this.auth._key());if(!e){try{const s=await kD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Wu.set(this.auth._key(),e)}return this.bypassAuthState||Wu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function kD(n,e){const t=VD(e),s=DD(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function xD(n,e){Wu.set(n._key(),e)}function DD(n){return Bs(n._redirectPersistence)}function VD(n){return Ku(PD,n.config.apiKey,n.name)}async function OD(n,e,t=!1){if(qn(n.app))return Promise.reject(Fi(n));const s=Ad(n),r=Kb(s,e),o=await new ND(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const MD=600*1e3;class LD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!FD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!zb(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ss(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=MD&&this.cachedEventUids.clear(),this.cachedEventUids.has(sE(e))}saveEventToCache(e){this.cachedEventUids.add(sE(e)),this.lastProcessedEventTime=Date.now()}}function sE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function zb({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function FD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zb(n);default:return!1}}async function UD(n,e={}){return Da(n,"GET","/v1/projects",e)}const BD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qD=/^https?/;async function $D(n){if(n.config.emulator)return;const{authorizedDomains:e}=await UD(n);for(const t of e)try{if(jD(t))return}catch{}Cs(n,"unauthorized-domain")}function jD(n){const e=Np(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!qD.test(t))return!1;if(BD.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const GD=new Bc(3e4,6e4);function rE(){const n=bs().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function KD(n){return new Promise((e,t)=>{function s(){rE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rE(),t(ss(n,"network-request-failed"))},timeout:GD.get()})}if(bs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(bs().gapi?.load)s();else{const r=Qx("iframefcb");return bs()[r]=()=>{gapi.load?s():t(ss(n,"network-request-failed"))},zx(`${Hx()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw zu=null,e})}let zu=null;function WD(n){return zu=zu||KD(n),zu}const zD=new Bc(5e3,15e3),HD="__/auth/iframe",QD="emulator/auth/iframe",YD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},JD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function XD(n){const e=n.config;be(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?l_(e,QD):`https://${n.config.authDomain}/${HD}`,s={apiKey:e.apiKey,appName:n.name,v:ao},r=JD.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${ka(s).slice(1)}`}async function ZD(n){const e=await WD(n),t=bs().gapi;return be(t,n,"internal-error"),e.open({where:document.body,url:XD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:YD,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=ss(n,"network-request-failed"),a=bs().setTimeout(()=>{i(o)},zD.get());function l(){bs().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}const eV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},tV=500,nV=600,sV="_blank",rV="http://localhost";class iE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function iV(n,e,t,s=tV,r=nV){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...eV,width:s.toString(),height:r.toString(),top:i,left:o},u=Mt().toLowerCase();t&&(a=Rb(u)?sV:t),Ab(u)&&(e=e||rV,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[_,E])=>`${f}${_}=${E},`,"");if(Ux(u)&&a!=="_self")return oV(e||"",a),new iE(null);const d=window.open(e||"",a,h);be(d,n,"popup-blocked");try{d.focus()}catch{}return new iE(d)}function oV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const aV="__/auth/handler",lV="emulator/auth/handler",cV=encodeURIComponent("fac");async function oE(n,e,t,s,r,i){be(n.config.authDomain,n,"auth-domain-config-required"),be(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:ao,eventId:r};if(e instanceof f_){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ap(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof qc){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${cV}=${encodeURIComponent(l)}`:"";return`${uV(n)}?${ka(a).slice(1)}${u}`}function uV({config:n}){return n.emulator?l_(n,lV):`https://${n.authDomain}/${aV}`}const Gf="webStorageSupport";class hV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Bb,this._completeRedirectFn=OD,this._overrideRedirectResult=xD}async _openPopup(e,t,s,r){Xs(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await oE(e,t,s,Np(),r);return iV(e,i,p_())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await oE(e,t,s,Np(),r);return pD(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Xs(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await ZD(e),s=new LD(e);return t.register("authEvent",r=>(be(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gf,{type:Gf},r=>{const i=r?.[0]?.[Gf];i!==void 0&&t(!!i),Cs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=$D(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xb()||Sb()||h_()}}const dV=hV;var aE="@firebase/auth",lE="1.12.0";class fV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function pV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function mV(n){Gi(new Kr("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;be(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Db(n)},u=new Kx(s,r,i,l);return Jx(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Gi(new Kr("auth-internal",e=>{const t=Ad(e.getProvider("auth").getImmediate());return(s=>new fV(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ws(aE,lE,pV(n)),ws(aE,lE,"esm2020")}const _V=300,gV=rb("authIdTokenMaxAge")||_V;let cE=null;const yV=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>gV)return;const r=t?.token;cE!==r&&(cE=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function vV(n=i_()){const e=xa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Yx(n,{popupRedirectResolver:dV,persistence:[wD,hD,Bb]}),s=rb("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=yV(i.toString());oD(t,o,()=>o(t.currentUser)),iD(t,a=>o(a))}}const r=tb("auth");return r&&Xx(t,`http://${r}`),t}function EV(){return document.getElementsByTagName("head")?.[0]??document}Wx({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=ss("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",EV().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});mV("Browser");var IV="firebase",TV="12.7.0";ws(IV,TV,"app");var uE={};const hE="@firebase/database",dE="1.1.0";let Hb="";function wV(n){Hb=n}class bV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Kt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:hc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class AV{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ir(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Qb=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new bV(e)}}catch{}return new AV},xi=Qb("localStorage"),SV=Qb("sessionStorage");const Ko=new bd("@firebase/database"),RV=(function(){let n=1;return function(){return n++}})(),Yb=function(n){const e=uk(n),t=new ok;t.update(e);const s=t.digest();return e_.encodeByteArray(s)},jc=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=jc.apply(null,s):typeof s=="object"?e+=Kt(s):e+=s,e+=" "}return e};let Bl=null,fE=!0;const CV=function(n,e){Z(!0,"Can't turn on custom loggers persistently."),Ko.logLevel=De.VERBOSE,Bl=Ko.log.bind(Ko)},on=function(...n){if(fE===!0&&(fE=!1,Bl===null&&SV.get("logging_enabled")===!0&&CV()),Bl){const e=jc.apply(null,n);Bl(e)}},Gc=function(n){return function(...e){on(n,...e)}},Dp=function(...n){const e="FIREBASE INTERNAL ERROR: "+jc(...n);Ko.error(e)},Zs=function(...n){const e=`FIREBASE FATAL ERROR: ${jc(...n)}`;throw Ko.error(e),new Error(e)},Fn=function(...n){const e="FIREBASE WARNING: "+jc(...n);Ko.warn(e)},PV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Fn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Jb=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},NV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ra="[MIN_NAME]",Wi="[MAX_NAME]",Va=function(n,e){if(n===e)return 0;if(n===ra||e===Wi)return-1;if(e===ra||n===Wi)return 1;{const t=pE(n),s=pE(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},kV=function(n,e){return n===e?0:n<e?-1:1},fl=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Kt(e))},__=function(n){if(typeof n!="object"||n===null)return Kt(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Kt(e[s]),t+=":",t+=__(n[e[s]]);return t+="}",t},Xb=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function Pn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Zb=function(n){Z(!Jb(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,a,l;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const h=u.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},xV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},DV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function VV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const OV=new RegExp("^-?(0*)\\d{1,10}$"),MV=-2147483648,LV=2147483647,pE=function(n){if(OV.test(n)){const e=Number(n);if(e>=MV&&e<=LV)return e}return null},Kc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Fn("Exception was thrown by user callback.",t),e},Math.floor(0))}},FV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ql=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class UV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,qn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Fn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class BV{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(on("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Fn(e)}}class Hu{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Hu.OWNER="owner";const g_="5",eA="v",tA="s",nA="r",sA="f",rA=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,iA="ls",oA="p",Vp="ac",aA="websocket",lA="long_polling";class cA{constructor(e,t,s,r,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function qV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function uA(n,e,t){Z(typeof e=="string","typeof type must == string"),Z(typeof t=="object","typeof params must == object");let s;if(e===aA)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===lA)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);qV(n)&&(t.ns=n.namespace);const r=[];return Pn(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}class $V{constructor(){this.counters_={}}incrementCounter(e,t=1){ir(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return jN(this.counters_)}}const Kf={},Wf={};function y_(n){const e=n.toString();return Kf[e]||(Kf[e]=new $V),Kf[e]}function jV(n,e){const t=n.toString();return Wf[t]||(Wf[t]=e()),Wf[t]}class GV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Kc(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const mE="start",KV="close",WV="pLPCommand",zV="pRTLPCB",hA="id",dA="pw",fA="ser",HV="cb",QV="seg",YV="ts",JV="d",XV="dframe",pA=1870,mA=30,ZV=pA-mA,eO=25e3,tO=3e4;class Oo{constructor(e,t,s,r,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Gc(e),this.stats_=y_(t),this.urlFn=l=>(this.appCheckToken&&(l[Vp]=this.appCheckToken),uA(t,lA,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new GV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(tO)),NV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new v_((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===mE)this.id=a,this.password=l;else if(o===KV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[mE]="t",s[fA]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[HV]=this.scriptTagHolder.uniqueCallbackIdentifier),s[eA]=g_,this.transportSessionId&&(s[tA]=this.transportSessionId),this.lastSessionId&&(s[iA]=this.lastSessionId),this.applicationId&&(s[oA]=this.applicationId),this.appCheckToken&&(s[Vp]=this.appCheckToken),typeof location<"u"&&location.hostname&&rA.test(location.hostname)&&(s[nA]=sA);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Oo.forceAllow_=!0}static forceDisallow(){Oo.forceDisallow_=!0}static isAvailable(){return Oo.forceAllow_?!0:!Oo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!xV()&&!DV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Xw(t),r=Xb(s,ZV);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[XV]="t",s[hA]=e,s[dA]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Kt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class v_{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=RV(),window[WV+this.uniqueCallbackIdentifier]=e,window[zV+this.uniqueCallbackIdentifier]=t,this.myIFrame=v_.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){on("frame writing exception"),a.stack&&on(a.stack),on(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||on("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[hA]=this.myID,e[dA]=this.myPW,e[fA]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+mA+s.length<=pA;){const o=this.pendingSegs.shift();s=s+"&"+QV+r+"="+o.seg+"&"+YV+r+"="+o.ts+"&"+JV+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(eO)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{on("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const nO=16384,sO=45e3;let Ch=null;typeof MozWebSocket<"u"?Ch=MozWebSocket:typeof WebSocket<"u"&&(Ch=WebSocket);class Yn{constructor(e,t,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Gc(this.connId),this.stats_=y_(t),this.connURL=Yn.connectionURL_(t,o,a,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[eA]=g_,typeof location<"u"&&location.hostname&&rA.test(location.hostname)&&(o[nA]=sA),t&&(o[tA]=t),s&&(o[iA]=s),r&&(o[Vp]=r),i&&(o[oA]=i),uA(e,aA,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xi.set("previous_websocket_failure",!0);try{let s;ZN(),this.mySock=new Ch(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Yn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Ch!==null&&!Yn.forceDisallow_}static previouslyFailed(){return xi.isInMemoryStorage||xi.get("previous_websocket_failure")===!0}markConnectionHealthy(){xi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=hc(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Z(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Kt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Xb(t,nO);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(sO))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Yn.responsesRequiredToBeHealthy=2;Yn.healthyTimeout=3e4;class pc{static get ALL_TRANSPORTS(){return[Oo,Yn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Yn&&Yn.isAvailable();let s=t&&!Yn.previouslyFailed();if(e.webSocketOnly&&(t||Fn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Yn];else{const r=this.transports_=[];for(const i of pc.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);pc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}pc.globalTransportInitialized_=!1;const rO=6e4,iO=5e3,oO=10*1024,aO=100*1024,zf="t",_E="d",lO="s",gE="r",cO="e",yE="o",vE="a",EE="n",IE="p",uO="h";class hO{constructor(e,t,s,r,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Gc("c:"+this.id+":"),this.transportManager_=new pc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ql(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>aO?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>oO?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(zf in e){const t=e[zf];t===vE?this.upgradeIfSecondaryHealthy_():t===gE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===yE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=fl("t",e),s=fl("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:IE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:vE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:EE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=fl("t",e),s=fl("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=fl(zf,e);if(_E in e){const s=e[_E];if(t===uO){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===EE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===lO?this.onConnectionShutdown_(s):t===gE?this.onReset_(s):t===cO?Dp("Server Error: "+s):t===yE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Dp("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),g_!==s&&Fn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),ql(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(rO))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ql(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(iO))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:IE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class _A{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class gA{constructor(e){this.allowedEvents_=e,this.listeners_={},Z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){Z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Ph extends gA{static getInstance(){return new Ph}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!s_()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const TE=32,wE=768;class at{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function $e(){return new at("")}function Ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Wr(n){return n.pieces_.length-n.pieceNum_}function ut(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new at(n.pieces_,e)}function yA(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function dO(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function vA(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function EA(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new at(e,0)}function Ot(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof at)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new at(t,0)}function Oe(n){return n.pieceNum_>=n.pieces_.length}function wn(n,e){const t=Ve(n),s=Ve(e);if(t===null)return e;if(t===s)return wn(ut(n),ut(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function E_(n,e){if(Wr(n)!==Wr(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Xn(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Wr(n)>Wr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class fO{constructor(e,t){this.errorPrefix_=t,this.parts_=vA(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=wd(this.parts_[s]);IA(this)}}function pO(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=wd(e),IA(n)}function mO(n){const e=n.parts_.pop();n.byteLength_-=wd(e),n.parts_.length>0&&(n.byteLength_-=1)}function IA(n){if(n.byteLength_>wE)throw new Error(n.errorPrefix_+"has a key path longer than "+wE+" bytes ("+n.byteLength_+").");if(n.parts_.length>TE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+TE+") or object contains a cycle "+wi(n))}function wi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class I_ extends gA{static getInstance(){return new I_}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return Z(e==="visible","Unknown event type: "+e),[this.visible_]}}const pl=1e3,_O=300*1e3,bE=30*1e3,gO=1.3,yO=3e4,vO="server_kill",AE=3;class Ws extends _A{constructor(e,t,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Ws.nextPersistentConnectionId_++,this.log_=Gc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=pl,this.maxReconnectDelay_=_O,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");I_.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Ph.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Kt(i)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new t_,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Ws.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ir(e,"w")){const s=na(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Fn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ik(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=bE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=rk(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Kt(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Dp("Unrecognized action received from server: "+Kt(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>yO&&(this.reconnectDelay_=pl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gO)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Ws.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(d){Z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?on("getToken() completed but was canceled"):(on("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new hO(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,_=>{Fn(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(vO)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&Fn(d),l())}}}interrupt(e){on("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){on("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ap(this.interruptReasons_)&&(this.reconnectDelay_=pl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>__(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new at(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){on("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=AE&&(this.reconnectDelay_=bE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){on("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=AE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Hb.replace(/\./g,"-")]=1,s_()?e["framework.cordova"]=1:ab()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Ph.getInstance().currentlyOnline();return Ap(this.interruptReasons_)&&e}}Ws.nextPersistentConnectionId_=0;Ws.nextConnectionId_=0;class Pe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Pe(e,t)}}class Cd{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Pe(ra,e),r=new Pe(ra,t);return this.compare(s,r)!==0}minPost(){return Pe.MIN}}let Su;class TA extends Cd{static get __EMPTY_NODE(){return Su}static set __EMPTY_NODE(e){Su=e}compare(e,t){return Va(e.name,t.name)}isDefinedOn(e){throw Na("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Pe.MIN}maxPost(){return new Pe(Wi,Su)}makePost(e,t){return Z(typeof e=="string","KeyIndex indexValue must always be a string."),new Pe(e,Su)}toString(){return".key"}}const Wo=new TA;let Ru=class{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},On=class Sl{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Sl.RED,this.left=r??ys.EMPTY_NODE,this.right=i??ys.EMPTY_NODE}copy(e,t,s,r,i){return new Sl(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ys.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return ys.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};On.RED=!0;On.BLACK=!1;class EO{copy(e,t,s,r,i){return this}insert(e,t,s){return new On(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let ys=class Qu{constructor(e,t=Qu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Qu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,On.BLACK,null,null))}remove(e){return new Qu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,On.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ru(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ru(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ru(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ru(this.root_,null,this.comparator_,!0,e)}};ys.EMPTY_NODE=new EO;function IO(n,e){return Va(n.name,e.name)}function T_(n,e){return Va(n,e)}let Op;function TO(n){Op=n}const wA=function(n){return typeof n=="number"?"number:"+Zb(n):"string:"+n},bA=function(n){if(n.isLeafNode()){const e=n.val();Z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ir(e,".sv"),"Priority must be a string or number.")}else Z(n===Op||n.isEmpty(),"priority of unexpected type.");Z(n===Op||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let SE;class $t{static set __childrenNodeConstructor(e){SE=e}static get __childrenNodeConstructor(){return SE}constructor(e,t=$t.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),bA(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new $t(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:$t.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Oe(e)?this:Ve(e)===".priority"?this.priorityNode_:$t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:$t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Ve(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(Z(s!==".priority"||Wr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,$t.__childrenNodeConstructor.EMPTY_NODE.updateChild(ut(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+wA(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Zb(this.value_):e+=this.value_,this.lazyHash_=Yb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===$t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof $t.__childrenNodeConstructor?-1:(Z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=$t.VALUE_TYPE_ORDER.indexOf(t),i=$t.VALUE_TYPE_ORDER.indexOf(s);return Z(r>=0,"Unknown leaf type: "+t),Z(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}$t.VALUE_TYPE_ORDER=["object","boolean","number","string"];let AA,SA;function wO(n){AA=n}function bO(n){SA=n}class AO extends Cd{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?Va(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Pe.MIN}maxPost(){return new Pe(Wi,new $t("[PRIORITY-POST]",SA))}makePost(e,t){const s=AA(e);return new Pe(t,new $t("[PRIORITY-POST]",s))}toString(){return".priority"}}const bt=new AO;const SO=Math.log(2);class RO{constructor(e){const t=i=>parseInt(Math.log(i)/SO,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Nh=function(n,e,t,s){n.sort(e);const r=function(l,u){const h=u-l;let d,f;if(h===0)return null;if(h===1)return d=n[l],f=t?t(d):d,new On(f,d.node,On.BLACK,null,null);{const _=parseInt(h/2,10)+l,E=r(l,_),T=r(_+1,u);return d=n[_],f=t?t(d):d,new On(f,d.node,On.BLACK,E,T)}},i=function(l){let u=null,h=null,d=n.length;const f=function(E,T){const C=d-E,L=d;d-=E;const U=r(C+1,L),N=n[C],k=t?t(N):N;_(new On(k,N.node,T,null,U))},_=function(E){u?(u.left=E,u=E):(h=E,u=E)};for(let E=0;E<l.count;++E){const T=l.nextBitIsOne(),C=Math.pow(2,l.count-(E+1));T?f(C,On.BLACK):(f(C,On.BLACK),f(C,On.RED))}return h},o=new RO(n.length),a=i(o);return new ys(s||e,a)};let Hf;const To={};class qs{static get Default(){return Z(To&&bt,"ChildrenNode.ts has not been loaded"),Hf=Hf||new qs({".priority":To},{".priority":bt}),Hf}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=na(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ys?t:null}hasIndex(e){return ir(this.indexSet_,e.toString())}addIndex(e,t){Z(e!==Wo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(Pe.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=Nh(s,e.getCompare()):a=To;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new qs(h,u)}addToIndexes(e,t){const s=vh(this.indexes_,(r,i)=>{const o=na(this.indexSet_,i);if(Z(o,"Missing index implementation for "+i),r===To)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Pe.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Nh(a,o.getCompare())}else return To;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new Pe(e.name,a))),l.insert(e,e.node)}});return new qs(s,this.indexSet_)}removeFromIndexes(e,t){const s=vh(this.indexes_,r=>{if(r===To)return r;{const i=t.get(e.name);return i?r.remove(new Pe(e.name,i)):r}});return new qs(s,this.indexSet_)}}let ml;class Te{static get EMPTY_NODE(){return ml||(ml=new Te(new ys(T_),null,qs.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&bA(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ml}updatePriority(e){return this.children_.isEmpty()?this:new Te(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ml:t}}getChild(e){const t=Ve(e);return t===null?this:this.getImmediateChild(t).getChild(ut(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Z(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Pe(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?ml:this.priorityNode_;return new Te(r,o,i)}}updateChild(e,t){const s=Ve(e);if(s===null)return t;{Z(Ve(e)!==".priority"||Wr(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(ut(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(bt,(o,a)=>{t[o]=a.val(e),s++,i&&Te.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+wA(this.getPriority().val())+":"),this.forEachChild(bt,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":Yb(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new Pe(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Pe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Pe(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Pe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Wc?-1:0}withIndex(e){if(e===Wo||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Te(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Wo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(bt),r=t.getIterator(bt);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Wo?null:this.indexMap_.get(e.toString())}}Te.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class CO extends Te{constructor(){super(new ys(T_),Te.EMPTY_NODE,qs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Te.EMPTY_NODE}isEmpty(){return!1}}const Wc=new CO;Object.defineProperties(Pe,{MIN:{value:new Pe(ra,Te.EMPTY_NODE)},MAX:{value:new Pe(Wi,Wc)}});TA.__EMPTY_NODE=Te.EMPTY_NODE;$t.__childrenNodeConstructor=Te;TO(Wc);bO(Wc);const PO=!0;function an(n,e=null){if(n===null)return Te.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new $t(t,an(e))}if(!(n instanceof Array)&&PO){const t=[];let s=!1;if(Pn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=an(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new Pe(o,l)))}}),t.length===0)return Te.EMPTY_NODE;const i=Nh(t,IO,o=>o.name,T_);if(s){const o=Nh(t,bt.getCompare());return new Te(i,an(e),new qs({".priority":o},{".priority":bt}))}else return new Te(i,an(e),qs.Default)}else{let t=Te.EMPTY_NODE;return Pn(n,(s,r)=>{if(ir(n,s)&&s.substring(0,1)!=="."){const i=an(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(an(e))}}wO(an);class NO extends Cd{constructor(e){super(),this.indexPath_=e,Z(!Oe(e)&&Ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?Va(e.name,t.name):i}makePost(e,t){const s=an(e),r=Te.EMPTY_NODE.updateChild(this.indexPath_,s);return new Pe(t,r)}maxPost(){const e=Te.EMPTY_NODE.updateChild(this.indexPath_,Wc);return new Pe(Wi,e)}toString(){return vA(this.indexPath_,0).join("/")}}class kO extends Cd{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Va(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Pe.MIN}maxPost(){return Pe.MAX}makePost(e,t){const s=an(e);return new Pe(t,s)}toString(){return".value"}}const xO=new kO;function RA(n){return{type:"value",snapshotNode:n}}function ia(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function mc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function _c(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function DO(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class w_{constructor(e){this.index_=e}updateChild(e,t,s,r,i,o){Z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(mc(t,a)):Z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ia(t,s)):o.trackChildChange(_c(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(bt,(r,i)=>{t.hasChild(r)||s.trackChildChange(mc(r,i))}),t.isLeafNode()||t.forEachChild(bt,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(_c(r,i,o))}else s.trackChildChange(ia(r,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Te.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class gc{constructor(e){this.indexedFilter_=new w_(e.getIndex()),this.index_=e.getIndex(),this.startPost_=gc.getStartPost_(e),this.endPost_=gc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,r,i,o){return this.matches(new Pe(t,s))||(s=Te.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,r,i,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=Te.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Te.EMPTY_NODE);const i=this;return t.forEachChild(bt,(o,a)=>{i.matches(new Pe(o,a))||(r=r.updateImmediateChild(o,Te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class VO{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new gc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,r,i,o){return this.rangedFilter_.matches(new Pe(t,s))||(s=Te.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,r,i,o):this.fullLimitUpdateChild_(e,t,s,i,o)}updateFullNode(e,t,s){let r;if(t.isLeafNode()||t.isEmpty())r=Te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=Te.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(Te.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,Te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,r,i){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,_)=>d(_,f)}else o=this.index_.getCompare();const a=e;Z(a.numChildren()===this.limit_,"");const l=new Pe(t,s),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const d=a.getImmediateChild(t);let f=r.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===t||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);const _=f==null?1:o(f,l);if(h&&!s.isEmpty()&&_>=0)return i?.trackChildChange(_c(t,s,d)),a.updateImmediateChild(t,s);{i?.trackChildChange(mc(t,d));const T=a.updateImmediateChild(t,Te.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i?.trackChildChange(ia(f.name,f.node)),T.updateImmediateChild(f.name,f.node)):T}}else return s.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(mc(u.name,u.node)),i.trackChildChange(ia(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(u.name,Te.EMPTY_NODE)):e}}class b_{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=bt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ra}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===bt}copy(){const e=new b_;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function OO(n){return n.loadsAllData()?new w_(n.getIndex()):n.hasLimit()?new VO(n):new gc(n)}function RE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===bt?t="$priority":n.index_===xO?t="$value":n.index_===Wo?t="$key":(Z(n.index_ instanceof NO,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Kt(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Kt(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Kt(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Kt(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Kt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function CE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==bt&&(e.i=n.index_.toString()),e}class kh extends _A{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=Gc("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=kh.getListenId_(e,s),a={};this.listens_[o]=a;const l=RE(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let d=h;if(u===404&&(d=null,u=null),u===null&&this.onDataUpdate_(i,d,!1,s),na(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",r(f,null)}})}unlisten(e,t){const s=kh.getListenId_(e,t);delete this.listens_[s]}get(e){const t=RE(e._queryParams),s=e._path.toString(),r=new t_;return this.restRequest_(s+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ka(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=hc(a.responseText)}catch{Fn("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&Fn("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class MO{constructor(){this.rootNode_=Te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function xh(){return{value:null,children:new Map}}function CA(n,e,t){if(Oe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Ve(e);n.children.has(s)||n.children.set(s,xh());const r=n.children.get(s);e=ut(e),CA(r,e,t)}}function Mp(n,e,t){n.value!==null?t(e,n.value):LO(n,(s,r)=>{const i=new at(e.toString()+"/"+s);Mp(r,i,t)})}function LO(n,e){n.children.forEach((t,s)=>{e(s,t)})}class FO{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Pn(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}const PE=10*1e3,UO=30*1e3,BO=300*1e3;class qO{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new FO(e);const s=PE+(UO-PE)*Math.random();ql(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;Pn(e,(r,i)=>{i>0&&ir(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),ql(this.reportStats_.bind(this),Math.floor(Math.random()*2*BO))}}var Zn;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Zn||(Zn={}));function PA(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function A_(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function S_(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Dh{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Zn.ACK_USER_WRITE,this.source=PA()}operationForChild(e){if(Oe(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new at(e));return new Dh($e(),t,this.revert)}}else return Z(Ve(this.path)===e,"operationForChild called for unrelated child."),new Dh(ut(this.path),this.affectedTree,this.revert)}}class yc{constructor(e,t){this.source=e,this.path=t,this.type=Zn.LISTEN_COMPLETE}operationForChild(e){return Oe(this.path)?new yc(this.source,$e()):new yc(this.source,ut(this.path))}}class zi{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Zn.OVERWRITE}operationForChild(e){return Oe(this.path)?new zi(this.source,$e(),this.snap.getImmediateChild(e)):new zi(this.source,ut(this.path),this.snap)}}class vc{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Zn.MERGE}operationForChild(e){if(Oe(this.path)){const t=this.children.subtree(new at(e));return t.isEmpty()?null:t.value?new zi(this.source,$e(),t.value):new vc(this.source,$e(),t)}else return Z(Ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new vc(this.source,ut(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Hi{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Oe(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class $O{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function jO(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(DO(o.childName,o.snapshotNode))}),_l(n,r,"child_removed",e,s,t),_l(n,r,"child_added",e,s,t),_l(n,r,"child_moved",i,s,t),_l(n,r,"child_changed",e,s,t),_l(n,r,"value",e,s,t),r}function _l(n,e,t,s,r,i){const o=s.filter(a=>a.type===t);o.sort((a,l)=>KO(n,a,l)),o.forEach(a=>{const l=GO(n,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function GO(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function KO(n,e,t){if(e.childName==null||t.childName==null)throw Na("Should only compare child_ events.");const s=new Pe(e.childName,e.snapshotNode),r=new Pe(t.childName,t.snapshotNode);return n.index_.compare(s,r)}function Pd(n,e){return{eventCache:n,serverCache:e}}function $l(n,e,t,s){return Pd(new Hi(e,t,s),n.serverCache)}function NA(n,e,t,s){return Pd(n.eventCache,new Hi(e,t,s))}function Lp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Qi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Qf;const WO=()=>(Qf||(Qf=new ys(kV)),Qf);class mt{static fromObject(e){let t=new mt(null);return Pn(e,(s,r)=>{t=t.set(new at(s),r)}),t}constructor(e,t=WO()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:$e(),value:this.value};if(Oe(e))return null;{const s=Ve(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(ut(e),t);return i!=null?{path:Ot(new at(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Oe(e))return this;{const t=Ve(e),s=this.children.get(t);return s!==null?s.subtree(ut(e)):new mt(null)}}set(e,t){if(Oe(e))return new mt(t,this.children);{const s=Ve(e),i=(this.children.get(s)||new mt(null)).set(ut(e),t),o=this.children.insert(s,i);return new mt(this.value,o)}}remove(e){if(Oe(e))return this.children.isEmpty()?new mt(null):new mt(null,this.children);{const t=Ve(e),s=this.children.get(t);if(s){const r=s.remove(ut(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new mt(null):new mt(this.value,i)}else return this}}get(e){if(Oe(e))return this.value;{const t=Ve(e),s=this.children.get(t);return s?s.get(ut(e)):null}}setTree(e,t){if(Oe(e))return t;{const s=Ve(e),i=(this.children.get(s)||new mt(null)).setTree(ut(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new mt(this.value,o)}}fold(e){return this.fold_($e(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(Ot(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,$e(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(Oe(e))return null;{const i=Ve(e),o=this.children.get(i);return o?o.findOnPath_(ut(e),Ot(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,$e(),t)}foreachOnPath_(e,t,s){if(Oe(e))return this;{this.value&&s(t,this.value);const r=Ve(e),i=this.children.get(r);return i?i.foreachOnPath_(ut(e),Ot(t,r),s):new mt(null)}}foreach(e){this.foreach_($e(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(Ot(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class rs{constructor(e){this.writeTree_=e}static empty(){return new rs(new mt(null))}}function jl(n,e,t){if(Oe(e))return new rs(new mt(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=wn(r,e);return i=i.updateChild(o,t),new rs(n.writeTree_.set(r,i))}else{const r=new mt(t),i=n.writeTree_.setTree(e,r);return new rs(i)}}}function NE(n,e,t){let s=n;return Pn(t,(r,i)=>{s=jl(s,Ot(e,r),i)}),s}function kE(n,e){if(Oe(e))return rs.empty();{const t=n.writeTree_.setTree(e,new mt(null));return new rs(t)}}function Fp(n,e){return lo(n,e)!=null}function lo(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(wn(t.path,e)):null}function xE(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(bt,(s,r)=>{e.push(new Pe(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new Pe(s,r.value))}),e}function qr(n,e){if(Oe(e))return n;{const t=lo(n,e);return t!=null?new rs(new mt(t)):new rs(n.writeTree_.subtree(e))}}function Up(n){return n.writeTree_.isEmpty()}function oa(n,e){return kA($e(),n.writeTree_,e)}function kA(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(Z(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=kA(Ot(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(Ot(n,".priority"),s)),t}}function R_(n,e){return OA(e,n)}function zO(n,e,t,s,r){Z(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=jl(n.visibleWrites,e,t)),n.lastWriteId=s}function HO(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function QO(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Z(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&YO(a,s.path)?r=!1:Xn(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return JO(n),!0;if(s.snap)n.visibleWrites=kE(n.visibleWrites,s.path);else{const a=s.children;Pn(a,l=>{n.visibleWrites=kE(n.visibleWrites,Ot(s.path,l))})}return!0}else return!1}function YO(n,e){if(n.snap)return Xn(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Xn(Ot(n.path,t),e))return!0;return!1}function JO(n){n.visibleWrites=xA(n.allWrites,XO,$e()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function XO(n){return n.visible}function xA(n,e,t){let s=rs.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let a;if(i.snap)Xn(t,o)?(a=wn(t,o),s=jl(s,a,i.snap)):Xn(o,t)&&(a=wn(o,t),s=jl(s,$e(),i.snap.getChild(a)));else if(i.children){if(Xn(t,o))a=wn(t,o),s=NE(s,a,i.children);else if(Xn(o,t))if(a=wn(o,t),Oe(a))s=NE(s,$e(),i.children);else{const l=na(i.children,Ve(a));if(l){const u=l.getChild(ut(a));s=jl(s,$e(),u)}}}else throw Na("WriteRecord should have .snap or .children")}}return s}function DA(n,e,t,s,r){if(!s&&!r){const i=lo(n.visibleWrites,e);if(i!=null)return i;{const o=qr(n.visibleWrites,e);if(Up(o))return t;if(t==null&&!Fp(o,$e()))return null;{const a=t||Te.EMPTY_NODE;return oa(o,a)}}}else{const i=qr(n.visibleWrites,e);if(!r&&Up(i))return t;if(!r&&t==null&&!Fp(i,$e()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(Xn(u.path,e)||Xn(e,u.path))},a=xA(n.allWrites,o,e),l=t||Te.EMPTY_NODE;return oa(a,l)}}}function ZO(n,e,t){let s=Te.EMPTY_NODE;const r=lo(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(bt,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=qr(n.visibleWrites,e);return t.forEachChild(bt,(o,a)=>{const l=oa(qr(i,new at(o)),a);s=s.updateImmediateChild(o,l)}),xE(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=qr(n.visibleWrites,e);return xE(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function eM(n,e,t,s,r){Z(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=Ot(e,t);if(Fp(n.visibleWrites,i))return null;{const o=qr(n.visibleWrites,i);return Up(o)?r.getChild(t):oa(o,r.getChild(t))}}function tM(n,e,t,s){const r=Ot(e,t),i=lo(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=qr(n.visibleWrites,r);return oa(o,s.getNode().getImmediateChild(t))}else return null}function nM(n,e){return lo(n.visibleWrites,e)}function sM(n,e,t,s,r,i,o){let a;const l=qr(n.visibleWrites,e),u=lo(l,$e());if(u!=null)a=u;else if(t!=null)a=oa(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),f=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let _=f.getNext();for(;_&&h.length<r;)d(_,s)!==0&&h.push(_),_=f.getNext();return h}else return[]}function rM(){return{visibleWrites:rs.empty(),allWrites:[],lastWriteId:-1}}function Vh(n,e,t,s){return DA(n.writeTree,n.treePath,e,t,s)}function C_(n,e){return ZO(n.writeTree,n.treePath,e)}function DE(n,e,t,s){return eM(n.writeTree,n.treePath,e,t,s)}function Oh(n,e){return nM(n.writeTree,Ot(n.treePath,e))}function iM(n,e,t,s,r,i){return sM(n.writeTree,n.treePath,e,t,s,r,i)}function P_(n,e,t){return tM(n.writeTree,n.treePath,e,t)}function VA(n,e){return OA(Ot(n.treePath,e),n.writeTree)}function OA(n,e){return{treePath:n,writeTree:e}}class oM{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;Z(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Z(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,_c(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,mc(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,ia(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,_c(s,e.snapshotNode,r.oldSnap));else throw Na("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class aM{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const MA=new aM;class N_{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Hi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return P_(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Qi(this.viewCache_),i=iM(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}function lM(n){return{filter:n}}function cM(n,e){Z(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Z(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function uM(n,e,t,s,r){const i=new oM;let o,a;if(t.type===Zn.OVERWRITE){const u=t;u.source.fromUser?o=Bp(n,e,u.path,u.snap,s,r,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Oe(u.path),o=Mh(n,e,u.path,u.snap,s,r,a,i))}else if(t.type===Zn.MERGE){const u=t;u.source.fromUser?o=dM(n,e,u.path,u.children,s,r,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=qp(n,e,u.path,u.children,s,r,a,i))}else if(t.type===Zn.ACK_USER_WRITE){const u=t;u.revert?o=mM(n,e,u.path,s,r,i):o=fM(n,e,u.path,u.affectedTree,s,r,i)}else if(t.type===Zn.LISTEN_COMPLETE)o=pM(n,e,t.path,s,i);else throw Na("Unknown operation type: "+t.type);const l=i.getChanges();return hM(e,o,l),{viewCache:o,changes:l}}function hM(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=Lp(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(RA(Lp(e)))}}function LA(n,e,t,s,r,i){const o=e.eventCache;if(Oh(s,t)!=null)return e;{let a,l;if(Oe(t))if(Z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Qi(e),h=u instanceof Te?u:Te.EMPTY_NODE,d=C_(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const u=Vh(s,Qi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Ve(t);if(u===".priority"){Z(Wr(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=DE(s,t,h,l);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{const h=ut(t);let d;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const f=DE(s,t,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(u).updateChild(h,f):d=o.getNode().getImmediateChild(u)}else d=P_(s,u,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),u,d,h,r,i):a=o.getNode()}}return $l(e,a,o.isFullyInitialized()||Oe(t),n.filter.filtersNodes())}}function Mh(n,e,t,s,r,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Oe(t))u=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,s);u=h.updateFullNode(l.getNode(),_,null)}else{const _=Ve(t);if(!l.isCompleteForPath(t)&&Wr(t)>1)return e;const E=ut(t),C=l.getNode().getImmediateChild(_).updateChild(E,s);_===".priority"?u=h.updatePriority(l.getNode(),C):u=h.updateChild(l.getNode(),_,C,E,MA,null)}const d=NA(e,u,l.isFullyInitialized()||Oe(t),h.filtersNodes()),f=new N_(r,d,i);return LA(n,d,t,r,f,a)}function Bp(n,e,t,s,r,i,o){const a=e.eventCache;let l,u;const h=new N_(r,e,i);if(Oe(t))u=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=$l(e,u,!0,n.filter.filtersNodes());else{const d=Ve(t);if(d===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),s),l=$l(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=ut(t),_=a.getNode().getImmediateChild(d);let E;if(Oe(f))E=s;else{const T=h.getCompleteChild(d);T!=null?yA(f)===".priority"&&T.getChild(EA(f)).isEmpty()?E=T:E=T.updateChild(f,s):E=Te.EMPTY_NODE}if(_.equals(E))l=e;else{const T=n.filter.updateChild(a.getNode(),d,E,f,h,o);l=$l(e,T,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function VE(n,e){return n.eventCache.isCompleteForChild(e)}function dM(n,e,t,s,r,i,o){let a=e;return s.foreach((l,u)=>{const h=Ot(t,l);VE(e,Ve(h))&&(a=Bp(n,a,h,u,r,i,o))}),s.foreach((l,u)=>{const h=Ot(t,l);VE(e,Ve(h))||(a=Bp(n,a,h,u,r,i,o))}),a}function OE(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function qp(n,e,t,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Oe(t)?u=s:u=new mt(null).setTree(t,s);const h=e.serverCache.getNode();return u.children.inorderTraversal((d,f)=>{if(h.hasChild(d)){const _=e.serverCache.getNode().getImmediateChild(d),E=OE(n,_,f);l=Mh(n,l,new at(d),E,r,i,o,a)}}),u.children.inorderTraversal((d,f)=>{const _=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!h.hasChild(d)&&!_){const E=e.serverCache.getNode().getImmediateChild(d),T=OE(n,E,f);l=Mh(n,l,new at(d),T,r,i,o,a)}}),l}function fM(n,e,t,s,r,i,o){if(Oh(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Oe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Mh(n,e,t,l.getNode().getChild(t),r,i,a,o);if(Oe(t)){let u=new mt(null);return l.getNode().forEachChild(Wo,(h,d)=>{u=u.set(new at(h),d)}),qp(n,e,t,u,r,i,a,o)}else return e}else{let u=new mt(null);return s.foreach((h,d)=>{const f=Ot(t,h);l.isCompleteForPath(f)&&(u=u.set(h,l.getNode().getChild(f)))}),qp(n,e,t,u,r,i,a,o)}}function pM(n,e,t,s,r){const i=e.serverCache,o=NA(e,i.getNode(),i.isFullyInitialized()||Oe(t),i.isFiltered());return LA(n,o,t,s,MA,r)}function mM(n,e,t,s,r,i){let o;if(Oh(s,t)!=null)return e;{const a=new N_(s,e,r),l=e.eventCache.getNode();let u;if(Oe(t)||Ve(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Vh(s,Qi(e));else{const d=e.serverCache.getNode();Z(d instanceof Te,"serverChildren would be complete if leaf node"),h=C_(s,d)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Ve(t);let d=P_(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?u=n.filter.updateChild(l,h,d,ut(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Te.EMPTY_NODE,ut(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Vh(s,Qi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Oh(s,$e())!=null,$l(e,u,o,n.filter.filtersNodes())}}class _M{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new w_(s.getIndex()),i=OO(s);this.processor_=lM(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Te.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Te.EMPTY_NODE,a.getNode(),null),h=new Hi(l,o.isFullyInitialized(),r.filtersNodes()),d=new Hi(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Pd(d,h),this.eventGenerator_=new $O(this.query_)}get query(){return this.query_}}function gM(n){return n.viewCache_.serverCache.getNode()}function yM(n,e){const t=Qi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Oe(e)&&!t.getImmediateChild(Ve(e)).isEmpty())?t.getChild(e):null}function ME(n){return n.eventRegistrations_.length===0}function vM(n,e){n.eventRegistrations_.push(e)}function LE(n,e,t){const s=[];if(t){Z(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return s}function FE(n,e,t,s){e.type===Zn.MERGE&&e.source.queryId!==null&&(Z(Qi(n.viewCache_),"We should always have a full cache before handling merges"),Z(Lp(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=uM(n.processor_,r,e,t,s);return cM(n.processor_,i.viewCache),Z(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,FA(n,i.changes,i.viewCache.eventCache.getNode(),null)}function EM(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(bt,(i,o)=>{s.push(ia(i,o))}),t.isFullyInitialized()&&s.push(RA(t.getNode())),FA(n,s,t.getNode(),e)}function FA(n,e,t,s){const r=s?[s]:n.eventRegistrations_;return jO(n.eventGenerator_,e,t,r)}let Lh;class IM{constructor(){this.views=new Map}}function TM(n){Z(!Lh,"__referenceConstructor has already been defined"),Lh=n}function wM(){return Z(Lh,"Reference.ts has not been loaded"),Lh}function bM(n){return n.views.size===0}function k_(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return Z(i!=null,"SyncTree gave us an op for an invalid query."),FE(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat(FE(o,e,t,s));return i}}function AM(n,e,t,s,r){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Vh(t,r?s:null),l=!1;a?l=!0:s instanceof Te?(a=C_(t,s),l=!1):(a=Te.EMPTY_NODE,l=!1);const u=Pd(new Hi(a,l,!1),new Hi(s,r,!1));return new _M(e,u)}return o}function SM(n,e,t,s,r,i){const o=AM(n,e,s,r,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),vM(o,t),EM(o,t)}function RM(n,e,t,s){const r=e._queryIdentifier,i=[];let o=[];const a=zr(n);if(r==="default")for(const[l,u]of n.views.entries())o=o.concat(LE(u,t,s)),ME(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(r);l&&(o=o.concat(LE(l,t,s)),ME(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!zr(n)&&i.push(new(wM())(e._repo,e._path)),{removed:i,events:o}}function UA(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function zo(n,e){let t=null;for(const s of n.views.values())t=t||yM(s,e);return t}function BA(n,e){if(e._queryParams.loadsAllData())return Nd(n);{const s=e._queryIdentifier;return n.views.get(s)}}function qA(n,e){return BA(n,e)!=null}function zr(n){return Nd(n)!=null}function Nd(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Fh;function CM(n){Z(!Fh,"__referenceConstructor has already been defined"),Fh=n}function PM(){return Z(Fh,"Reference.ts has not been loaded"),Fh}let NM=1;class UE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new mt(null),this.pendingWriteTree_=rM(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function kM(n,e,t,s,r){return zO(n.pendingWriteTree_,e,t,s,r),r?zc(n,new zi(PA(),e,t)):[]}function Mo(n,e,t=!1){const s=HO(n.pendingWriteTree_,e);if(QO(n.pendingWriteTree_,e)){let i=new mt(null);return s.snap!=null?i=i.set($e(),!0):Pn(s.children,o=>{i=i.set(new at(o),!0)}),zc(n,new Dh(s.path,i,t))}else return[]}function kd(n,e,t){return zc(n,new zi(A_(),e,t))}function xM(n,e,t){const s=mt.fromObject(t);return zc(n,new vc(A_(),e,s))}function DM(n,e){return zc(n,new yc(A_(),e))}function VM(n,e,t){const s=x_(n,t);if(s){const r=D_(s),i=r.path,o=r.queryId,a=wn(i,e),l=new yc(S_(o),a);return V_(n,i,l)}else return[]}function $p(n,e,t,s,r=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||qA(o,e))){const l=RM(o,e,t,s);bM(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!r){const h=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(i,(f,_)=>zr(_));if(h&&!d){const f=n.syncPointTree_.subtree(i);if(!f.isEmpty()){const _=LM(f);for(let E=0;E<_.length;++E){const T=_[E],C=T.query,L=KA(n,T);n.listenProvider_.startListening(Gl(C),Uh(n,C),L.hashFn,L.onComplete)}}}!d&&u.length>0&&!s&&(h?n.listenProvider_.stopListening(Gl(e),null):u.forEach(f=>{const _=n.queryToTagMap.get(xd(f));n.listenProvider_.stopListening(Gl(f),_)}))}FM(n,u)}return a}function OM(n,e,t,s){const r=x_(n,s);if(r!=null){const i=D_(r),o=i.path,a=i.queryId,l=wn(o,e),u=new zi(S_(a),l,t);return V_(n,o,u)}else return[]}function MM(n,e,t,s){const r=x_(n,s);if(r){const i=D_(r),o=i.path,a=i.queryId,l=wn(o,e),u=mt.fromObject(t),h=new vc(S_(a),l,u);return V_(n,o,h)}else return[]}function BE(n,e,t,s=!1){const r=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(r,(f,_)=>{const E=wn(f,r);i=i||zo(_,E),o=o||zr(_)});let a=n.syncPointTree_.get(r);a?(o=o||zr(a),i=i||zo(a,$e())):(a=new IM,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=Te.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((_,E)=>{const T=zo(E,$e());T&&(i=i.updateImmediateChild(_,T))}));const u=qA(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=xd(e);Z(!n.queryToTagMap.has(f),"View does not exist, but we have a tag");const _=UM();n.queryToTagMap.set(f,_),n.tagToQueryMap.set(_,f)}const h=R_(n.pendingWriteTree_,r);let d=SM(a,e,t,h,i,l);if(!u&&!o&&!s){const f=BA(a,e);d=d.concat(BM(n,e,f))}return d}function $A(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=wn(o,e),u=zo(a,l);if(u)return u});return DA(r,e,i,t,!0)}function zc(n,e){return jA(e,n.syncPointTree_,null,R_(n.pendingWriteTree_,$e()))}function jA(n,e,t,s){if(Oe(n.path))return GA(n,e,t,s);{const r=e.get($e());t==null&&r!=null&&(t=zo(r,$e()));let i=[];const o=Ve(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=VA(s,o);i=i.concat(jA(a,l,u,h))}return r&&(i=i.concat(k_(r,n,s,t))),i}}function GA(n,e,t,s){const r=e.get($e());t==null&&r!=null&&(t=zo(r,$e()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=VA(s,o),h=n.operationForChild(o);h&&(i=i.concat(GA(h,a,l,u)))}),r&&(i=i.concat(k_(r,n,s,t))),i}function KA(n,e){const t=e.query,s=Uh(n,t);return{hashFn:()=>(gM(e)||Te.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?VM(n,t._path,s):DM(n,t._path);{const i=VV(r,t);return $p(n,t,null,i)}}}}function Uh(n,e){const t=xd(e);return n.queryToTagMap.get(t)}function xd(n){return n._path.toString()+"$"+n._queryIdentifier}function x_(n,e){return n.tagToQueryMap.get(e)}function D_(n){const e=n.indexOf("$");return Z(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new at(n.substr(0,e))}}function V_(n,e,t){const s=n.syncPointTree_.get(e);Z(s,"Missing sync point for query tag that we're tracking");const r=R_(n.pendingWriteTree_,e);return k_(s,t,r,null)}function LM(n){return n.fold((e,t,s)=>{if(t&&zr(t))return[Nd(t)];{let r=[];return t&&(r=UA(t)),Pn(s,(i,o)=>{r=r.concat(o)}),r}})}function Gl(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(PM())(n._repo,n._path):n}function FM(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const r=xd(s),i=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(i)}}}function UM(){return NM++}function BM(n,e,t){const s=e._path,r=Uh(n,e),i=KA(n,t),o=n.listenProvider_.startListening(Gl(e),r,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(s);if(r)Z(!zr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,d)=>{if(!Oe(u)&&h&&zr(h))return[Nd(h).query];{let f=[];return h&&(f=f.concat(UA(h).map(_=>_.query))),Pn(d,(_,E)=>{f=f.concat(E)}),f}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Gl(h),Uh(n,h))}}return o}class O_{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new O_(t)}node(){return this.node_}}class M_{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ot(this.path_,e);return new M_(this.syncTree_,t)}node(){return $A(this.syncTree_,this.path_)}}const qM=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},qE=function(n,e,t){if(!n||typeof n!="object")return n;if(Z(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return $M(n[".sv"],e,t);if(typeof n[".sv"]=="object")return jM(n[".sv"],e);Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},$M=function(n,e,t){if(n==="timestamp")return t.timestamp;Z(!1,"Unexpected server value: "+n)},jM=function(n,e,t){n.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&Z(!1,"Unexpected increment value: "+s);const r=e.node();if(Z(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},GM=function(n,e,t,s){return L_(e,new M_(t,n),s)},KM=function(n,e,t){return L_(n,new O_(e),t)};function L_(n,e,t){const s=n.getPriority().val(),r=qE(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=qE(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new $t(a,an(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new $t(r))),o.forEachChild(bt,(a,l)=>{const u=L_(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}class F_{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function U_(n,e){let t=e instanceof at?e:new at(e),s=n,r=Ve(t);for(;r!==null;){const i=na(s.node.children,r)||{children:{},childCount:0};s=new F_(r,s,i),t=ut(t),r=Ve(t)}return s}function Oa(n){return n.node.value}function WA(n,e){n.node.value=e,jp(n)}function zA(n){return n.node.childCount>0}function WM(n){return Oa(n)===void 0&&!zA(n)}function Dd(n,e){Pn(n.node.children,(t,s)=>{e(new F_(t,n,s))})}function HA(n,e,t,s){t&&e(n),Dd(n,r=>{HA(r,e,!0)})}function zM(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Hc(n){return new at(n.parent===null?n.name:Hc(n.parent)+"/"+n.name)}function jp(n){n.parent!==null&&HM(n.parent,n.name,n)}function HM(n,e,t){const s=WM(t),r=ir(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,jp(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,jp(n))}const QM=/[\[\].#$\/\u0000-\u001F\u007F]/,YM=/[\[\].#$\u0000-\u001F\u007F]/,Yf=10*1024*1024,QA=function(n){return typeof n=="string"&&n.length!==0&&!QM.test(n)},YA=function(n){return typeof n=="string"&&n.length!==0&&!YM.test(n)},JM=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),YA(n)},JA=function(n,e,t){const s=t instanceof at?new fO(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+wi(s));if(typeof e=="function")throw new Error(n+"contains a function "+wi(s)+" with contents = "+e.toString());if(Jb(e))throw new Error(n+"contains "+e.toString()+" "+wi(s));if(typeof e=="string"&&e.length>Yf/3&&wd(e)>Yf)throw new Error(n+"contains a string greater than "+Yf+" utf8 bytes "+wi(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Pn(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!QA(o)))throw new Error(n+" contains an invalid key ("+o+") "+wi(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);pO(s,o),JA(n,a,s),mO(s)}),r&&i)throw new Error(n+' contains ".value" child '+wi(s)+" in addition to actual children.")}},XA=function(n,e,t,s){if(!YA(t))throw new Error(db(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},XM=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),XA(n,e,t)},ZM=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!QA(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!JM(t))throw new Error(db(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class eL{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ZA(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!E_(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function eS(n,e,t){ZA(n,t),tS(n,s=>E_(s,e))}function co(n,e,t){ZA(n,t),tS(n,s=>Xn(s,e)||Xn(e,s))}function tS(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(tL(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function tL(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Bl&&on("event: "+t.toString()),Kc(s)}}}const nL="repo_interrupt",sL=25;class rL{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new eL,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xh(),this.transactionQueueTree_=new F_,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function iL(n,e,t){if(n.stats_=y_(n.repoInfo_),n.forceRestClient_||FV())n.server_=new kh(n.repoInfo_,(s,r,i,o)=>{$E(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>jE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Kt(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Ws(n.repoInfo_,e,(s,r,i,o)=>{$E(n,s,r,i,o)},s=>{jE(n,s)},s=>{aL(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=jV(n.repoInfo_,()=>new qO(n.stats_,n.server_)),n.infoData_=new MO,n.infoSyncTree_=new UE({startListening:(s,r,i,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=kd(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),B_(n,"connected",!1),n.serverSyncTree_=new UE({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);co(n.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function oL(n){const t=n.infoData_.getNode(new at(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function nS(n){return qM({timestamp:oL(n)})}function $E(n,e,t,s,r){n.dataUpdateCount++;const i=new at(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const l=vh(t,u=>an(u));o=MM(n.serverSyncTree_,i,l,r)}else{const l=an(t);o=OM(n.serverSyncTree_,i,l,r)}else if(s){const l=vh(t,u=>an(u));o=xM(n.serverSyncTree_,i,l)}else{const l=an(t);o=kd(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=$_(n,i)),co(n.eventQueue_,a,o)}function jE(n,e){B_(n,"connected",e),e===!1&&cL(n)}function aL(n,e){Pn(e,(t,s)=>{B_(n,t,s)})}function B_(n,e,t){const s=new at("/.info/"+e),r=an(t);n.infoData_.updateSnapshot(s,r);const i=kd(n.infoSyncTree_,s,r);co(n.eventQueue_,s,i)}function lL(n){return n.nextWriteId_++}function cL(n){sS(n,"onDisconnectEvents");const e=nS(n),t=xh();Mp(n.onDisconnect_,$e(),(r,i)=>{const o=GM(r,i,n.serverSyncTree_,e);CA(t,r,o)});let s=[];Mp(t,$e(),(r,i)=>{s=s.concat(kd(n.serverSyncTree_,r,i));const o=pL(n,r);$_(n,o)}),n.onDisconnect_=xh(),co(n.eventQueue_,$e(),s)}function uL(n,e,t){let s;Ve(e._path)===".info"?s=BE(n.infoSyncTree_,e,t):s=BE(n.serverSyncTree_,e,t),eS(n.eventQueue_,e._path,s)}function GE(n,e,t){let s;Ve(e._path)===".info"?s=$p(n.infoSyncTree_,e,t):s=$p(n.serverSyncTree_,e,t),eS(n.eventQueue_,e._path,s)}function hL(n){n.persistentConnection_&&n.persistentConnection_.interrupt(nL)}function sS(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),on(t,...e)}function rS(n,e,t){return $A(n.serverSyncTree_,e,t)||Te.EMPTY_NODE}function q_(n,e=n.transactionQueueTree_){if(e||Vd(n,e),Oa(e)){const t=oS(n,e);Z(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&dL(n,Hc(e),t)}else zA(e)&&Dd(e,t=>{q_(n,t)})}function dL(n,e,t){const s=t.map(u=>u.currentWriteId),r=rS(n,e,s);let i=r;const o=r.hash();for(let u=0;u<t.length;u++){const h=t[u];Z(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=wn(e,h.path);i=i.updateChild(d,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{sS(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const d=[];for(let f=0;f<t.length;f++)t[f].status=2,h=h.concat(Mo(n.serverSyncTree_,t[f].currentWriteId)),t[f].onComplete&&d.push(()=>t[f].onComplete(null,!0,t[f].currentOutputSnapshotResolved)),t[f].unwatcher();Vd(n,U_(n.transactionQueueTree_,e)),q_(n,n.transactionQueueTree_),co(n.eventQueue_,e,h);for(let f=0;f<d.length;f++)Kc(d[f])}else{if(u==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{Fn("transaction at "+l.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}$_(n,e)}},o)}function $_(n,e){const t=iS(n,e),s=Hc(t),r=oS(n,t);return fL(n,r,s),s}function fL(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=wn(t,l.path);let h=!1,d;if(Z(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=sL)h=!0,d="maxretry",r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0));else{const f=rS(n,l.path,o);l.currentInputSnapshot=f;const _=e[a].update(f.val());if(_!==void 0){JA("transaction failed: Data returned ",_,l.path);let E=an(_);typeof _=="object"&&_!=null&&ir(_,".priority")||(E=E.updatePriority(f.getPriority()));const C=l.currentWriteId,L=nS(n),U=KM(E,f,L);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=U,l.currentWriteId=lL(n),o.splice(o.indexOf(C),1),r=r.concat(kM(n.serverSyncTree_,l.path,U,l.currentWriteId,l.applyLocally)),r=r.concat(Mo(n.serverSyncTree_,C,!0))}else h=!0,d="nodata",r=r.concat(Mo(n.serverSyncTree_,l.currentWriteId,!0))}co(n.eventQueue_,t,r),r=[],h&&(e[a].status=2,(function(f){setTimeout(f,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Vd(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Kc(s[a]);q_(n,n.transactionQueueTree_)}function iS(n,e){let t,s=n.transactionQueueTree_;for(t=Ve(e);t!==null&&Oa(s)===void 0;)s=U_(s,t),e=ut(e),t=Ve(e);return s}function oS(n,e){const t=[];return aS(n,e,t),t.sort((s,r)=>s.order-r.order),t}function aS(n,e,t){const s=Oa(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);Dd(e,r=>{aS(n,r,t)})}function Vd(n,e){const t=Oa(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,WA(e,t.length>0?t:void 0)}Dd(e,s=>{Vd(n,s)})}function pL(n,e){const t=Hc(iS(n,e)),s=U_(n.transactionQueueTree_,e);return zM(s,r=>{Jf(n,r)}),Jf(n,s),HA(s,r=>{Jf(n,r)}),t}function Jf(n,e){const t=Oa(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Z(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Z(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Mo(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?WA(e,void 0):t.length=i+1,co(n.eventQueue_,Hc(e),r);for(let o=0;o<s.length;o++)Kc(s[o])}}function mL(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function _L(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Fn(`Invalid query segment '${t}' in query '${n}'`)}return e}const KE=function(n,e){const t=gL(n),s=t.namespace;t.domain==="firebase.com"&&Zs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Zs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||PV();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new cA(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new at(t.pathString)}},gL=function(n){let e="",t="",s="",r="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(r=mL(n.substring(h,d)));const f=_L(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{const E=e.indexOf(".");s=e.substring(0,E).toLowerCase(),t=e.substring(E+1),i=s}"ns"in f&&(i=f.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};class yL{constructor(e,t,s,r){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Kt(this.snapshot.exportVal())}}class vL{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class EL{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class j_{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return Oe(this._path)?null:yA(this._path)}get ref(){return new ni(this._repo,this._path)}get _queryIdentifier(){const e=CE(this._queryParams),t=__(e);return t==="{}"?"default":t}get _queryObject(){return CE(this._queryParams)}isEqual(e){if(e=je(e),!(e instanceof j_))return!1;const t=this._repo===e._repo,s=E_(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+dO(this._path)}}class ni extends j_{constructor(e,t){super(e,t,new b_,!1)}get parent(){const e=EA(this._path);return e===null?null:new ni(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Bh{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new at(e),s=Gp(this.ref,e);return new Bh(this._node.getChild(t),s,bt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new Bh(r,Gp(this.ref,s),bt)))}hasChild(e){const t=new at(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function IL(n,e){return n=je(n),n._checkNotDeleted("ref"),e!==void 0?Gp(n._root,e):n._root}function Gp(n,e){return n=je(n),Ve(n._path)===null?XM("child","path",e):XA("child","path",e),new ni(n._repo,Ot(n._path,e))}class G_{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new yL("value",this,new Bh(e.snapshotNode,new ni(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vL(this,e,t):null}matches(e){return e instanceof G_?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function TL(n,e,t,s,r){let i;if(typeof s=="object"&&(i=void 0,r=s),typeof s=="function"&&(i=s),r&&r.onlyOnce){const l=t,u=(h,d)=>{GE(n._repo,n,a),l(h,d)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new EL(t,i||void 0),a=new G_(o);return uL(n._repo,n,a),()=>GE(n._repo,n,a)}function wL(n,e,t,s){return TL(n,"value",e,t,s)}TM(ni);CM(ni);const bL="FIREBASE_DATABASE_EMULATOR_HOST",Kp={};let AL=!1;function SL(n,e,t,s){const r=e.lastIndexOf(":"),i=e.substring(0,r),o=sr(i);n.repoInfo_=new cA(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function RL(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||Zs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),on("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=KE(i,r),a=o.repoInfo,l;typeof process<"u"&&uE&&(l=uE[bL]),l?(i=`http://${l}?ns=${a.namespace}`,o=KE(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new BV(n.name,n.options,e);ZM("Invalid Firebase Database URL",o),Oe(o.path)||Zs("Database URL must point to the root of a Firebase Database (not including a child path).");const h=PL(a,n,u,new UV(n,t));return new NL(h,n)}function CL(n,e){const t=Kp[e];(!t||t[n.key]!==n)&&Zs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),hL(n),delete t[n.key]}function PL(n,e,t,s){let r=Kp[e.name];r||(r={},Kp[e.name]=r);let i=r[n.toURLString()];return i&&Zs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new rL(n,AL,t,s),r[n.toURLString()]=i,i}class NL{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(iL(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ni(this._repo,$e())),this._rootInternal}_delete(){return this._rootInternal!==null&&(CL(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Zs("Cannot call "+e+" on a deleted database.")}}function kL(n=i_(),e){const t=xa(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=nb("database");s&&xL(t,...s)}return t}function xL(n,e,t,s={}){n=je(n),n._checkNotDeleted("useEmulator");const r=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&Wn(s,i.repoInfo_.emulatorOptions))return;Zs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Zs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Hu(Hu.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:ib(s.mockUserToken,n.app.options.projectId);o=new Hu(a)}sr(e)&&(Td(e),n_("Database",!0)),SL(i,r,s,o)}function DL(n){wV(ao),Gi(new Kr("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return RL(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),ws(hE,dE,n),ws(hE,dE,"esm2020")}Ws.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ws.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};DL();var WE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var $r,lS;(function(){var n;function e(b,v){function A(){}A.prototype=v.prototype,b.F=v.prototype,b.prototype=new A,b.prototype.constructor=b,b.D=function(P,R,x){for(var w=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)w[nt-2]=arguments[nt];return v.prototype[R].apply(P,w)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,v,A){A||(A=0);const P=Array(16);if(typeof v=="string")for(var R=0;R<16;++R)P[R]=v.charCodeAt(A++)|v.charCodeAt(A++)<<8|v.charCodeAt(A++)<<16|v.charCodeAt(A++)<<24;else for(R=0;R<16;++R)P[R]=v[A++]|v[A++]<<8|v[A++]<<16|v[A++]<<24;v=b.g[0],A=b.g[1],R=b.g[2];let x=b.g[3],w;w=v+(x^A&(R^x))+P[0]+3614090360&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[1]+3905402710&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[2]+606105819&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[3]+3250441966&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[4]+4118548399&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[5]+1200080426&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[6]+2821735955&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[7]+4249261313&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[8]+1770035416&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[9]+2336552879&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[10]+4294925233&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[11]+2304563134&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(x^A&(R^x))+P[12]+1804603682&4294967295,v=A+(w<<7&4294967295|w>>>25),w=x+(R^v&(A^R))+P[13]+4254626195&4294967295,x=v+(w<<12&4294967295|w>>>20),w=R+(A^x&(v^A))+P[14]+2792965006&4294967295,R=x+(w<<17&4294967295|w>>>15),w=A+(v^R&(x^v))+P[15]+1236535329&4294967295,A=R+(w<<22&4294967295|w>>>10),w=v+(R^x&(A^R))+P[1]+4129170786&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[6]+3225465664&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[11]+643717713&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[0]+3921069994&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[5]+3593408605&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[10]+38016083&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[15]+3634488961&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[4]+3889429448&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[9]+568446438&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[14]+3275163606&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[3]+4107603335&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[8]+1163531501&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(R^x&(A^R))+P[13]+2850285829&4294967295,v=A+(w<<5&4294967295|w>>>27),w=x+(A^R&(v^A))+P[2]+4243563512&4294967295,x=v+(w<<9&4294967295|w>>>23),w=R+(v^A&(x^v))+P[7]+1735328473&4294967295,R=x+(w<<14&4294967295|w>>>18),w=A+(x^v&(R^x))+P[12]+2368359562&4294967295,A=R+(w<<20&4294967295|w>>>12),w=v+(A^R^x)+P[5]+4294588738&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[8]+2272392833&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[11]+1839030562&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[14]+4259657740&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[1]+2763975236&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[4]+1272893353&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[7]+4139469664&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[10]+3200236656&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[13]+681279174&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[0]+3936430074&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[3]+3572445317&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[6]+76029189&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(A^R^x)+P[9]+3654602809&4294967295,v=A+(w<<4&4294967295|w>>>28),w=x+(v^A^R)+P[12]+3873151461&4294967295,x=v+(w<<11&4294967295|w>>>21),w=R+(x^v^A)+P[15]+530742520&4294967295,R=x+(w<<16&4294967295|w>>>16),w=A+(R^x^v)+P[2]+3299628645&4294967295,A=R+(w<<23&4294967295|w>>>9),w=v+(R^(A|~x))+P[0]+4096336452&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[7]+1126891415&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[14]+2878612391&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[5]+4237533241&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[12]+1700485571&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[3]+2399980690&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[10]+4293915773&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[1]+2240044497&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[8]+1873313359&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[15]+4264355552&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[6]+2734768916&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[13]+1309151649&4294967295,A=R+(w<<21&4294967295|w>>>11),w=v+(R^(A|~x))+P[4]+4149444226&4294967295,v=A+(w<<6&4294967295|w>>>26),w=x+(A^(v|~R))+P[11]+3174756917&4294967295,x=v+(w<<10&4294967295|w>>>22),w=R+(v^(x|~A))+P[2]+718787259&4294967295,R=x+(w<<15&4294967295|w>>>17),w=A+(x^(R|~v))+P[9]+3951481745&4294967295,b.g[0]=b.g[0]+v&4294967295,b.g[1]=b.g[1]+(R+(w<<21&4294967295|w>>>11))&4294967295,b.g[2]=b.g[2]+R&4294967295,b.g[3]=b.g[3]+x&4294967295}s.prototype.v=function(b,v){v===void 0&&(v=b.length);const A=v-this.blockSize,P=this.C;let R=this.h,x=0;for(;x<v;){if(R==0)for(;x<=A;)r(this,b,x),x+=this.blockSize;if(typeof b=="string"){for(;x<v;)if(P[R++]=b.charCodeAt(x++),R==this.blockSize){r(this,P),R=0;break}}else for(;x<v;)if(P[R++]=b[x++],R==this.blockSize){r(this,P),R=0;break}}this.h=R,this.o+=v},s.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var v=1;v<b.length-8;++v)b[v]=0;v=this.o*8;for(var A=b.length-8;A<b.length;++A)b[A]=v&255,v/=256;for(this.v(b),b=Array(16),v=0,A=0;A<4;++A)for(let P=0;P<32;P+=8)b[v++]=this.g[A]>>>P&255;return b};function i(b,v){var A=a;return Object.prototype.hasOwnProperty.call(A,b)?A[b]:A[b]=v(b)}function o(b,v){this.h=v;const A=[];let P=!0;for(let R=b.length-1;R>=0;R--){const x=b[R]|0;P&&x==v||(A[R]=x,P=!1)}this.g=A}var a={};function l(b){return-128<=b&&b<128?i(b,function(v){return new o([v|0],v<0?-1:0)}):new o([b|0],b<0?-1:0)}function u(b){if(isNaN(b)||!isFinite(b))return d;if(b<0)return C(u(-b));const v=[];let A=1;for(let P=0;b>=A;P++)v[P]=b/A|0,A*=4294967296;return new o(v,0)}function h(b,v){if(b.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(b.charAt(0)=="-")return C(h(b.substring(1),v));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const A=u(Math.pow(v,8));let P=d;for(let x=0;x<b.length;x+=8){var R=Math.min(8,b.length-x);const w=parseInt(b.substring(x,x+R),v);R<8?(R=u(Math.pow(v,R)),P=P.j(R).add(u(w))):(P=P.j(A),P=P.add(u(w)))}return P}var d=l(0),f=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-C(this).m();let b=0,v=1;for(let A=0;A<this.g.length;A++){const P=this.i(A);b+=(P>=0?P:4294967296+P)*v,v*=4294967296}return b},n.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(E(this))return"0";if(T(this))return"-"+C(this).toString(b);const v=u(Math.pow(b,6));var A=this;let P="";for(;;){const R=k(A,v).g;A=L(A,R.j(v));let x=((A.g.length>0?A.g[0]:A.h)>>>0).toString(b);if(A=R,E(A))return x+P;for(;x.length<6;)x="0"+x;P=x+P}},n.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function E(b){if(b.h!=0)return!1;for(let v=0;v<b.g.length;v++)if(b.g[v]!=0)return!1;return!0}function T(b){return b.h==-1}n.l=function(b){return b=L(this,b),T(b)?-1:E(b)?0:1};function C(b){const v=b.g.length,A=[];for(let P=0;P<v;P++)A[P]=~b.g[P];return new o(A,~b.h).add(f)}n.abs=function(){return T(this)?C(this):this},n.add=function(b){const v=Math.max(this.g.length,b.g.length),A=[];let P=0;for(let R=0;R<=v;R++){let x=P+(this.i(R)&65535)+(b.i(R)&65535),w=(x>>>16)+(this.i(R)>>>16)+(b.i(R)>>>16);P=w>>>16,x&=65535,w&=65535,A[R]=w<<16|x}return new o(A,A[A.length-1]&-2147483648?-1:0)};function L(b,v){return b.add(C(v))}n.j=function(b){if(E(this)||E(b))return d;if(T(this))return T(b)?C(this).j(C(b)):C(C(this).j(b));if(T(b))return C(this.j(C(b)));if(this.l(_)<0&&b.l(_)<0)return u(this.m()*b.m());const v=this.g.length+b.g.length,A=[];for(var P=0;P<2*v;P++)A[P]=0;for(P=0;P<this.g.length;P++)for(let R=0;R<b.g.length;R++){const x=this.i(P)>>>16,w=this.i(P)&65535,nt=b.i(R)>>>16,Ut=b.i(R)&65535;A[2*P+2*R]+=w*Ut,U(A,2*P+2*R),A[2*P+2*R+1]+=x*Ut,U(A,2*P+2*R+1),A[2*P+2*R+1]+=w*nt,U(A,2*P+2*R+1),A[2*P+2*R+2]+=x*nt,U(A,2*P+2*R+2)}for(b=0;b<v;b++)A[b]=A[2*b+1]<<16|A[2*b];for(b=v;b<2*v;b++)A[b]=0;return new o(A,0)};function U(b,v){for(;(b[v]&65535)!=b[v];)b[v+1]+=b[v]>>>16,b[v]&=65535,v++}function N(b,v){this.g=b,this.h=v}function k(b,v){if(E(v))throw Error("division by zero");if(E(b))return new N(d,d);if(T(b))return v=k(C(b),v),new N(C(v.g),C(v.h));if(T(v))return v=k(b,C(v)),new N(C(v.g),v.h);if(b.g.length>30){if(T(b)||T(v))throw Error("slowDivide_ only works with positive integers.");for(var A=f,P=v;P.l(b)<=0;)A=G(A),P=G(P);var R=J(A,1),x=J(P,1);for(P=J(P,2),A=J(A,2);!E(P);){var w=x.add(P);w.l(b)<=0&&(R=R.add(A),x=w),P=J(P,1),A=J(A,1)}return v=L(b,R.j(v)),new N(R,v)}for(R=d;b.l(v)>=0;){for(A=Math.max(1,Math.floor(b.m()/v.m())),P=Math.ceil(Math.log(A)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),x=u(A),w=x.j(v);T(w)||w.l(b)>0;)A-=P,x=u(A),w=x.j(v);E(x)&&(x=f),R=R.add(x),b=L(b,w)}return new N(R,b)}n.B=function(b){return k(this,b).h},n.and=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)&b.i(P);return new o(A,this.h&b.h)},n.or=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)|b.i(P);return new o(A,this.h|b.h)},n.xor=function(b){const v=Math.max(this.g.length,b.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)^b.i(P);return new o(A,this.h^b.h)};function G(b){const v=b.g.length+1,A=[];for(let P=0;P<v;P++)A[P]=b.i(P)<<1|b.i(P-1)>>>31;return new o(A,b.h)}function J(b,v){const A=v>>5;v%=32;const P=b.g.length-A,R=[];for(let x=0;x<P;x++)R[x]=v>0?b.i(x+A)>>>v|b.i(x+A+1)<<32-v:b.i(x+A);return new o(R,b.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,lS=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,$r=o}).apply(typeof WE<"u"?WE:typeof self<"u"?self:typeof window<"u"?window:{});var Cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var cS,Rl,uS,Yu,Wp,hS,dS,fS;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cu=="object"&&Cu];for(var p=0;p<c.length;++p){var m=c[p];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var s=t(this);function r(c,p){if(p)e:{var m=s;c=c.split(".");for(var y=0;y<c.length-1;y++){var O=c[y];if(!(O in m))break e;m=m[O]}c=c[c.length-1],y=m[c],p=p(y),p!=y&&p!=null&&e(m,c,{configurable:!0,writable:!0,value:p})}}r("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(c){return c||function(p){var m=[],y;for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&m.push([y,p[y]]);return m}});var i=i||{},o=this||self;function a(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function l(c,p,m){return c.call.apply(c.bind,arguments)}function u(c,p,m){return u=l,u.apply(null,arguments)}function h(c,p){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function d(c,p){function m(){}m.prototype=p.prototype,c.Z=p.prototype,c.prototype=new m,c.prototype.constructor=c,c.Ob=function(y,O,F){for(var ne=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)ne[Ce-2]=arguments[Ce];return p.prototype[O].apply(y,ne)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function _(c){const p=c.length;if(p>0){const m=Array(p);for(let y=0;y<p;y++)m[y]=c[y];return m}return[]}function E(c,p){for(let y=1;y<arguments.length;y++){const O=arguments[y];var m=typeof O;if(m=m!="object"?m:O?Array.isArray(O)?"array":m:"null",m=="array"||m=="object"&&typeof O.length=="number"){m=c.length||0;const F=O.length||0;c.length=m+F;for(let ne=0;ne<F;ne++)c[m+ne]=O[ne]}else c.push(O)}}class T{constructor(p,m){this.i=p,this.j=m,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function C(c){o.setTimeout(()=>{throw c},0)}function L(){var c=b;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class U{constructor(){this.h=this.g=null}add(p,m){const y=N.get();y.set(p,m),this.h?this.h.next=y:this.g=y,this.h=y}}var N=new T(()=>new k,c=>c.reset());class k{constructor(){this.next=this.g=this.h=null}set(p,m){this.h=p,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let G,J=!1,b=new U,v=()=>{const c=Promise.resolve(void 0);G=()=>{c.then(A)}};function A(){for(var c;c=L();){try{c.h.call(c.g)}catch(m){C(m)}var p=N;p.j(c),p.h<100&&(p.h++,c.next=p.g,p.g=c)}J=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var x=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};o.addEventListener("test",m,p),o.removeEventListener("test",m,p)}catch{}return c})();function w(c){return/^[\s\xa0]*$/.test(c)}function nt(c,p){R.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,p)}d(nt,R),nt.prototype.init=function(c,p){const m=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget,p||(m=="mouseover"?p=c.fromElement:m=="mouseout"&&(p=c.toElement)),this.relatedTarget=p,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&nt.Z.h.call(this)},nt.prototype.h=function(){nt.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ut="closure_listenable_"+(Math.random()*1e6|0),lt=0;function Fe(c,p,m,y,O){this.listener=c,this.proxy=null,this.src=p,this.type=m,this.capture=!!y,this.ha=O,this.key=++lt,this.da=this.fa=!1}function se(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function re(c,p,m){for(const y in c)p.call(m,c[y],y,c)}function ft(c,p){for(const m in c)p.call(void 0,c[m],m,c)}function pn(c){const p={};for(const m in c)p[m]=c[m];return p}const xt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(c,p){let m,y;for(let O=1;O<arguments.length;O++){y=arguments[O];for(m in y)c[m]=y[m];for(let F=0;F<xt.length;F++)m=xt[F],Object.prototype.hasOwnProperty.call(y,m)&&(c[m]=y[m])}}function ie(c){this.src=c,this.g={},this.h=0}ie.prototype.add=function(c,p,m,y,O){const F=c.toString();c=this.g[F],c||(c=this.g[F]=[],this.h++);const ne=et(c,p,y,O);return ne>-1?(p=c[ne],m||(p.fa=!1)):(p=new Fe(p,this.src,F,!!y,O),p.fa=m,c.push(p)),p};function le(c,p){const m=p.type;if(m in c.g){var y=c.g[m],O=Array.prototype.indexOf.call(y,p,void 0),F;(F=O>=0)&&Array.prototype.splice.call(y,O,1),F&&(se(p),c.g[m].length==0&&(delete c.g[m],c.h--))}}function et(c,p,m,y){for(let O=0;O<c.length;++O){const F=c[O];if(!F.da&&F.listener==p&&F.capture==!!m&&F.ha==y)return O}return-1}var j="closure_lm_"+(Math.random()*1e6|0),fe={};function ae(c,p,m,y,O){if(Array.isArray(p)){for(let F=0;F<p.length;F++)ae(c,p[F],m,y,O);return null}return m=oe(m),c&&c[Ut]?c.J(p,m,a(y)?!!y.capture:!1,O):_e(c,p,m,!1,y,O)}function _e(c,p,m,y,O,F){if(!p)throw Error("Invalid event type");const ne=a(O)?!!O.capture:!!O;let Ce=K(c);if(Ce||(c[j]=Ce=new ie(c)),m=Ce.add(p,m,y,ne,F),m.proxy)return m;if(y=Me(),m.proxy=y,y.src=c,y.listener=m,c.addEventListener)x||(O=ne),O===void 0&&(O=!1),c.addEventListener(p.toString(),y,O);else if(c.attachEvent)c.attachEvent(V(p.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Me(){function c(m){return p.call(c.src,c.listener,m)}const p=q;return c}function I(c,p,m,y,O){if(Array.isArray(p))for(var F=0;F<p.length;F++)I(c,p[F],m,y,O);else y=a(y)?!!y.capture:!!y,m=oe(m),c&&c[Ut]?(c=c.i,F=String(p).toString(),F in c.g&&(p=c.g[F],m=et(p,m,y,O),m>-1&&(se(p[m]),Array.prototype.splice.call(p,m,1),p.length==0&&(delete c.g[F],c.h--)))):c&&(c=K(c))&&(p=c.g[p.toString()],c=-1,p&&(c=et(p,m,y,O)),(m=c>-1?p[c]:null)&&S(m))}function S(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[Ut])le(p.i,c);else{var m=c.type,y=c.proxy;p.removeEventListener?p.removeEventListener(m,y,c.capture):p.detachEvent?p.detachEvent(V(m),y):p.addListener&&p.removeListener&&p.removeListener(y),(m=K(p))?(le(m,c),m.h==0&&(m.src=null,p[j]=null)):se(c)}}}function V(c){return c in fe?fe[c]:fe[c]="on"+c}function q(c,p){if(c.da)c=!0;else{p=new nt(p,this);const m=c.listener,y=c.ha||c.src;c.fa&&S(c),c=m.call(y,p)}return c}function K(c){return c=c[j],c instanceof ie?c:null}var $="__closure_events_fn_"+(Math.random()*1e9>>>0);function oe(c){return typeof c=="function"?c:(c[$]||(c[$]=function(p){return c.handleEvent(p)}),c[$])}function Q(){P.call(this),this.i=new ie(this),this.M=this,this.G=null}d(Q,P),Q.prototype[Ut]=!0,Q.prototype.removeEventListener=function(c,p,m,y){I(this,c,p,m,y)};function H(c,p){var m,y=c.G;if(y)for(m=[];y;y=y.G)m.push(y);if(c=c.M,y=p.type||p,typeof p=="string")p=new R(p,c);else if(p instanceof R)p.target=p.target||c;else{var O=p;p=new R(y,c),ue(p,O)}O=!0;let F,ne;if(m)for(ne=m.length-1;ne>=0;ne--)F=p.g=m[ne],O=z(F,y,!0,p)&&O;if(F=p.g=c,O=z(F,y,!0,p)&&O,O=z(F,y,!1,p)&&O,m)for(ne=0;ne<m.length;ne++)F=p.g=m[ne],O=z(F,y,!1,p)&&O}Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var c=this.i;for(const p in c.g){const m=c.g[p];for(let y=0;y<m.length;y++)se(m[y]);delete c.g[p],c.h--}}this.G=null},Q.prototype.J=function(c,p,m,y){return this.i.add(String(c),p,!1,m,y)},Q.prototype.K=function(c,p,m,y){return this.i.add(String(c),p,!0,m,y)};function z(c,p,m,y){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();let O=!0;for(let F=0;F<p.length;++F){const ne=p[F];if(ne&&!ne.da&&ne.capture==m){const Ce=ne.listener,Dt=ne.ha||ne.src;ne.fa&&le(c.i,ne),O=Ce.call(Dt,y)!==!1&&O}}return O&&!y.defaultPrevented}function ve(c,p){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(c,p||0)}function ce(c){c.g=ve(()=>{c.g=null,c.i&&(c.i=!1,ce(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class ge extends P{constructor(p,m){super(),this.m=p,this.l=m,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:ce(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ee(c){P.call(this),this.h=c,this.g={}}d(Ee,P);var xe=[];function Ye(c){re(c.g,function(p,m){this.g.hasOwnProperty(m)&&S(p)},c),c.g={}}Ee.prototype.N=function(){Ee.Z.N.call(this),Ye(this)},Ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Be=o.JSON.stringify,Zt=o.JSON.parse,en=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function kn(){}function xn(){}var zn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function go(){R.call(this,"d")}d(go,R);function zt(){R.call(this,"c")}d(zt,R);var Bt={},Qa=null;function fi(){return Qa=Qa||new Q}Bt.Ia="serverreachability";function my(c){R.call(this,Bt.Ia,c)}d(my,R);function Ya(c){const p=fi();H(p,new my(p))}Bt.STAT_EVENT="statevent";function _y(c,p){R.call(this,Bt.STAT_EVENT,c),this.stat=p}d(_y,R);function mn(c){const p=fi();H(p,new _y(p,c))}Bt.Ja="timingevent";function gy(c,p){R.call(this,Bt.Ja,c),this.size=p}d(gy,R);function Ja(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},p)}function Xa(){this.g=!0}Xa.prototype.ua=function(){this.g=!1};function HP(c,p,m,y,O,F){c.info(function(){if(c.g)if(F){var ne="",Ce=F.split("&");for(let st=0;st<Ce.length;st++){var Dt=Ce[st].split("=");if(Dt.length>1){const qt=Dt[0];Dt=Dt[1];const ds=qt.split("_");ne=ds.length>=2&&ds[1]=="type"?ne+(qt+"="+Dt+"&"):ne+(qt+"=redacted&")}}}else ne=null;else ne=F;return"XMLHTTP REQ ("+y+") [attempt "+O+"]: "+p+`
`+m+`
`+ne})}function QP(c,p,m,y,O,F,ne){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+O+"]: "+p+`
`+m+`
`+F+" "+ne})}function yo(c,p,m,y){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+JP(c,m)+(y?" "+y:"")})}function YP(c,p){c.info(function(){return"TIMEOUT: "+p})}Xa.prototype.info=function(){};function JP(c,p){if(!c.g)return p;if(!p)return null;try{const F=JSON.parse(p);if(F){for(c=0;c<F.length;c++)if(Array.isArray(F[c])){var m=F[c];if(!(m.length<2)){var y=m[1];if(Array.isArray(y)&&!(y.length<1)){var O=y[0];if(O!="noop"&&O!="stop"&&O!="close")for(let ne=1;ne<y.length;ne++)y[ne]=""}}}}return Be(F)}catch{return p}}var du={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yy={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},vy;function pf(){}d(pf,kn),pf.prototype.g=function(){return new XMLHttpRequest},vy=new pf;function Za(c){return encodeURIComponent(String(c))}function XP(c){var p=1;c=c.split(":");const m=[];for(;p>0&&c.length;)m.push(c.shift()),p--;return c.length&&m.push(c.join(":")),m}function hr(c,p,m,y){this.j=c,this.i=p,this.l=m,this.S=y||1,this.V=new Ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ey}function Ey(){this.i=null,this.g="",this.h=!1}var Iy={},mf={};function _f(c,p,m){c.M=1,c.A=pu(hs(p)),c.u=m,c.R=!0,Ty(c,null)}function Ty(c,p){c.F=Date.now(),fu(c),c.B=hs(c.A);var m=c.B,y=c.S;Array.isArray(y)||(y=[String(y)]),Oy(m.i,"t",y),c.C=0,m=c.j.L,c.h=new Ey,c.g=Zy(c.j,m?p:null,!c.u),c.P>0&&(c.O=new ge(u(c.Y,c,c.g),c.P)),p=c.V,m=c.g,y=c.ba;var O="readystatechange";Array.isArray(O)||(O&&(xe[0]=O.toString()),O=xe);for(let F=0;F<O.length;F++){const ne=ae(m,O[F],y||p.handleEvent,!1,p.h||p);if(!ne)break;p.g[ne.key]=ne}p=c.J?pn(c.J):{},c.u?(c.v||(c.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,p)):(c.v="GET",c.g.ea(c.B,c.v,null,p)),Ya(),HP(c.i,c.v,c.B,c.l,c.S,c.u)}hr.prototype.ba=function(c){c=c.target;const p=this.O;p&&pr(c)==3?p.j():this.Y(c)},hr.prototype.Y=function(c){try{if(c==this.g)e:{const Ce=pr(this.g),Dt=this.g.ya(),st=this.g.ca();if(!(Ce<3)&&(Ce!=3||this.g&&(this.h.h||this.g.la()||$y(this.g)))){this.K||Ce!=4||Dt==7||(Dt==8||st<=0?Ya(3):Ya(2)),gf(this);var p=this.g.ca();this.X=p;var m=ZP(this);if(this.o=p==200,QP(this.i,this.v,this.B,this.l,this.S,Ce,p),this.o){if(this.U&&!this.L){t:{if(this.g){var y,O=this.g;if((y=O.g?O.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(y)){var F=y;break t}}F=null}if(c=F)yo(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,yf(this,c);else{this.o=!1,this.m=3,mn(12),pi(this),el(this);break e}}if(this.R){c=!0;let qt;for(;!this.K&&this.C<m.length;)if(qt=e0(this,m),qt==mf){Ce==4&&(this.m=4,mn(14),c=!1),yo(this.i,this.l,null,"[Incomplete Response]");break}else if(qt==Iy){this.m=4,mn(15),yo(this.i,this.l,m,"[Invalid Chunk]"),c=!1;break}else yo(this.i,this.l,qt,null),yf(this,qt);if(wy(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ce!=4||m.length!=0||this.h.h||(this.m=1,mn(16),c=!1),this.o=this.o&&c,!c)yo(this.i,this.l,m,"[Invalid Chunked Response]"),pi(this),el(this);else if(m.length>0&&!this.W){this.W=!0;var ne=this.j;ne.g==this&&ne.aa&&!ne.P&&(ne.j.info("Great, no buffering proxy detected. Bytes received: "+m.length),Sf(ne),ne.P=!0,mn(11))}}else yo(this.i,this.l,m,null),yf(this,m);Ce==4&&pi(this),this.o&&!this.K&&(Ce==4?Qy(this.j,this):(this.o=!1,fu(this)))}else p0(this.g),p==400&&m.indexOf("Unknown SID")>0?(this.m=3,mn(12)):(this.m=0,mn(13)),pi(this),el(this)}}}catch{}};function ZP(c){if(!wy(c))return c.g.la();const p=$y(c.g);if(p==="")return"";let m="";const y=p.length,O=pr(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return pi(c),el(c),"";c.h.i=new o.TextDecoder}for(let F=0;F<y;F++)c.h.h=!0,m+=c.h.i.decode(p[F],{stream:!(O&&F==y-1)});return p.length=0,c.h.g+=m,c.C=0,c.h.g}function wy(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function e0(c,p){var m=c.C,y=p.indexOf(`
`,m);return y==-1?mf:(m=Number(p.substring(m,y)),isNaN(m)?Iy:(y+=1,y+m>p.length?mf:(p=p.slice(y,y+m),c.C=y+m,p)))}hr.prototype.cancel=function(){this.K=!0,pi(this)};function fu(c){c.T=Date.now()+c.H,by(c,c.H)}function by(c,p){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Ja(u(c.aa,c),p)}function gf(c){c.D&&(o.clearTimeout(c.D),c.D=null)}hr.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(YP(this.i,this.B),this.M!=2&&(Ya(),mn(17)),pi(this),this.m=2,el(this)):by(this,this.T-c)};function el(c){c.j.I==0||c.K||Qy(c.j,c)}function pi(c){gf(c);var p=c.O;p&&typeof p.dispose=="function"&&p.dispose(),c.O=null,Ye(c.V),c.g&&(p=c.g,c.g=null,p.abort(),p.dispose())}function yf(c,p){try{var m=c.j;if(m.I!=0&&(m.g==c||vf(m.h,c))){if(!c.L&&vf(m.h,c)&&m.I==3){try{var y=m.Ba.g.parse(p)}catch{y=null}if(Array.isArray(y)&&y.length==3){var O=y;if(O[0]==0){e:if(!m.v){if(m.g)if(m.g.F+3e3<c.F)vu(m),gu(m);else break e;Af(m),mn(18)}}else m.xa=O[1],0<m.xa-m.K&&O[2]<37500&&m.F&&m.A==0&&!m.C&&(m.C=Ja(u(m.Va,m),6e3));Ry(m.h)<=1&&m.ta&&(m.ta=void 0)}else _i(m,11)}else if((c.L||m.g==c)&&vu(m),!w(p))for(O=m.Ba.g.parse(p),p=0;p<O.length;p++){let st=O[p];const qt=st[0];if(!(qt<=m.K))if(m.K=qt,st=st[1],m.I==2)if(st[0]=="c"){m.M=st[1],m.ba=st[2];const ds=st[3];ds!=null&&(m.ka=ds,m.j.info("VER="+m.ka));const gi=st[4];gi!=null&&(m.za=gi,m.j.info("SVER="+m.za));const mr=st[5];mr!=null&&typeof mr=="number"&&mr>0&&(y=1.5*mr,m.O=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const _r=c.g;if(_r){const Iu=_r.g?_r.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Iu){var F=y.h;F.g||Iu.indexOf("spdy")==-1&&Iu.indexOf("quic")==-1&&Iu.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(Ef(F,F.h),F.h=null))}if(y.G){const Rf=_r.g?_r.g.getResponseHeader("X-HTTP-Session-Id"):null;Rf&&(y.wa=Rf,pt(y.J,y.G,Rf))}}m.I=3,m.l&&m.l.ra(),m.aa&&(m.T=Date.now()-c.F,m.j.info("Handshake RTT: "+m.T+"ms")),y=m;var ne=c;if(y.na=Xy(y,y.L?y.ba:null,y.W),ne.L){Cy(y.h,ne);var Ce=ne,Dt=y.O;Dt&&(Ce.H=Dt),Ce.D&&(gf(Ce),fu(Ce)),y.g=ne}else zy(y);m.i.length>0&&yu(m)}else st[0]!="stop"&&st[0]!="close"||_i(m,7);else m.I==3&&(st[0]=="stop"||st[0]=="close"?st[0]=="stop"?_i(m,7):bf(m):st[0]!="noop"&&m.l&&m.l.qa(st),m.A=0)}}Ya(4)}catch{}}var t0=class{constructor(c,p){this.g=c,this.map=p}};function Ay(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Sy(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ry(c){return c.h?1:c.g?c.g.size:0}function vf(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function Ef(c,p){c.g?c.g.add(p):c.h=p}function Cy(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}Ay.prototype.cancel=function(){if(this.i=Py(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Py(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const m of c.g.values())p=p.concat(m.G);return p}return _(c.i)}var Ny=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function n0(c,p){if(c){c=c.split("&");for(let m=0;m<c.length;m++){const y=c[m].indexOf("=");let O,F=null;y>=0?(O=c[m].substring(0,y),F=c[m].substring(y+1)):O=c[m],p(O,F?decodeURIComponent(F.replace(/\+/g," ")):"")}}}function dr(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;c instanceof dr?(this.l=c.l,tl(this,c.j),this.o=c.o,this.g=c.g,nl(this,c.u),this.h=c.h,If(this,My(c.i)),this.m=c.m):c&&(p=String(c).match(Ny))?(this.l=!1,tl(this,p[1]||"",!0),this.o=sl(p[2]||""),this.g=sl(p[3]||"",!0),nl(this,p[4]),this.h=sl(p[5]||"",!0),If(this,p[6]||"",!0),this.m=sl(p[7]||"")):(this.l=!1,this.i=new il(null,this.l))}dr.prototype.toString=function(){const c=[];var p=this.j;p&&c.push(rl(p,ky,!0),":");var m=this.g;return(m||p=="file")&&(c.push("//"),(p=this.o)&&c.push(rl(p,ky,!0),"@"),c.push(Za(m).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.u,m!=null&&c.push(":",String(m))),(m=this.h)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(rl(m,m.charAt(0)=="/"?i0:r0,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",rl(m,a0)),c.join("")},dr.prototype.resolve=function(c){const p=hs(this);let m=!!c.j;m?tl(p,c.j):m=!!c.o,m?p.o=c.o:m=!!c.g,m?p.g=c.g:m=c.u!=null;var y=c.h;if(m)nl(p,c.u);else if(m=!!c.h){if(y.charAt(0)!="/")if(this.g&&!this.h)y="/"+y;else{var O=p.h.lastIndexOf("/");O!=-1&&(y=p.h.slice(0,O+1)+y)}if(O=y,O==".."||O==".")y="";else if(O.indexOf("./")!=-1||O.indexOf("/.")!=-1){y=O.lastIndexOf("/",0)==0,O=O.split("/");const F=[];for(let ne=0;ne<O.length;){const Ce=O[ne++];Ce=="."?y&&ne==O.length&&F.push(""):Ce==".."?((F.length>1||F.length==1&&F[0]!="")&&F.pop(),y&&ne==O.length&&F.push("")):(F.push(Ce),y=!0)}y=F.join("/")}else y=O}return m?p.h=y:m=c.i.toString()!=="",m?If(p,My(c.i)):m=!!c.m,m&&(p.m=c.m),p};function hs(c){return new dr(c)}function tl(c,p,m){c.j=m?sl(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function nl(c,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);c.u=p}else c.u=null}function If(c,p,m){p instanceof il?(c.i=p,l0(c.i,c.l)):(m||(p=rl(p,o0)),c.i=new il(p,c.l))}function pt(c,p,m){c.i.set(p,m)}function pu(c){return pt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function sl(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function rl(c,p,m){return typeof c=="string"?(c=encodeURI(c).replace(p,s0),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function s0(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var ky=/[#\/\?@]/g,r0=/[#\?:]/g,i0=/[#\?]/g,o0=/[#\?@]/g,a0=/#/g;function il(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function mi(c){c.g||(c.g=new Map,c.h=0,c.i&&n0(c.i,function(p,m){c.add(decodeURIComponent(p.replace(/\+/g," ")),m)}))}n=il.prototype,n.add=function(c,p){mi(this),this.i=null,c=vo(this,c);let m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(p),this.h+=1,this};function xy(c,p){mi(c),p=vo(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function Dy(c,p){return mi(c),p=vo(c,p),c.g.has(p)}n.forEach=function(c,p){mi(this),this.g.forEach(function(m,y){m.forEach(function(O){c.call(p,O,y,this)},this)},this)};function Vy(c,p){mi(c);let m=[];if(typeof p=="string")Dy(c,p)&&(m=m.concat(c.g.get(vo(c,p))));else for(c=Array.from(c.g.values()),p=0;p<c.length;p++)m=m.concat(c[p]);return m}n.set=function(c,p){return mi(this),this.i=null,c=vo(this,c),Dy(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=Vy(this,c),c.length>0?String(c[0]):p):p};function Oy(c,p,m){xy(c,p),m.length>0&&(c.i=null,c.g.set(vo(c,p),_(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(let y=0;y<p.length;y++){var m=p[y];const O=Za(m);m=Vy(this,m);for(let F=0;F<m.length;F++){let ne=O;m[F]!==""&&(ne+="="+Za(m[F])),c.push(ne)}}return this.i=c.join("&")};function My(c){const p=new il;return p.i=c.i,c.g&&(p.g=new Map(c.g),p.h=c.h),p}function vo(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function l0(c,p){p&&!c.j&&(mi(c),c.i=null,c.g.forEach(function(m,y){const O=y.toLowerCase();y!=O&&(xy(this,y),Oy(this,O,m))},c)),c.j=p}function c0(c,p){const m=new Xa;if(o.Image){const y=new Image;y.onload=h(fr,m,"TestLoadImage: loaded",!0,p,y),y.onerror=h(fr,m,"TestLoadImage: error",!1,p,y),y.onabort=h(fr,m,"TestLoadImage: abort",!1,p,y),y.ontimeout=h(fr,m,"TestLoadImage: timeout",!1,p,y),o.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else p(!1)}function u0(c,p){const m=new Xa,y=new AbortController,O=setTimeout(()=>{y.abort(),fr(m,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:y.signal}).then(F=>{clearTimeout(O),F.ok?fr(m,"TestPingServer: ok",!0,p):fr(m,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(O),fr(m,"TestPingServer: error",!1,p)})}function fr(c,p,m,y,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),y(m)}catch{}}function h0(){this.g=new en}function Tf(c){this.i=c.Sb||null,this.h=c.ab||!1}d(Tf,kn),Tf.prototype.g=function(){return new mu(this.i,this.h)};function mu(c,p){Q.call(this),this.H=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(mu,Q),n=mu.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=p,this.readyState=1,al(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(p.body=c),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ol(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,al(this)),this.g&&(this.readyState=3,al(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ly(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ly(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?ol(this):al(this),this.readyState==3&&Ly(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,ol(this))},n.Na=function(c){this.g&&(this.response=c,ol(this))},n.ga=function(){this.g&&ol(this)};function ol(c){c.readyState=4,c.l=null,c.j=null,c.B=null,al(c)}n.setRequestHeader=function(c,p){this.A.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var m=p.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=p.next();return c.join(`\r
`)};function al(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(mu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Fy(c){let p="";return re(c,function(m,y){p+=y,p+=":",p+=m,p+=`\r
`}),p}function wf(c,p,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=Fy(m),typeof c=="string"?m!=null&&Za(m):pt(c,p,m))}function Tt(c){Q.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(Tt,Q);var d0=/^https?$/i,f0=["POST","PUT"];n=Tt.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,p,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():vy.g(),this.g.onreadystatechange=f(u(this.Ca,this));try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(F){Uy(this,F);return}if(c=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var O in y)m.set(O,y[O]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const F of y.keys())m.set(F,y.get(F));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(F=>F.toLowerCase()=="content-type"),O=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(f0,p,void 0)>=0)||y||O||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,ne]of m)this.g.setRequestHeader(F,ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(F){Uy(this,F)}};function Uy(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.o=5,By(c),_u(c)}function By(c){c.A||(c.A=!0,H(c,"complete"),H(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,H(this,"complete"),H(this,"abort"),_u(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_u(this,!0)),Tt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?qy(this):this.Xa())},n.Xa=function(){qy(this)};function qy(c){if(c.h&&typeof i<"u"){if(c.v&&pr(c)==4)setTimeout(c.Ca.bind(c),0);else if(H(c,"readystatechange"),pr(c)==4){c.h=!1;try{const F=c.ca();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var m;if(!(m=p)){var y;if(y=F===0){let ne=String(c.D).match(Ny)[1]||null;!ne&&o.self&&o.self.location&&(ne=o.self.location.protocol.slice(0,-1)),y=!d0.test(ne?ne.toLowerCase():"")}m=y}if(m)H(c,"complete"),H(c,"success");else{c.o=6;try{var O=pr(c)>2?c.g.statusText:""}catch{O=""}c.l=O+" ["+c.ca()+"]",By(c)}}finally{_u(c)}}}}function _u(c,p){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const m=c.g;c.g=null,p||H(c,"ready");try{m.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function pr(c){return c.g?c.g.readyState:0}n.ca=function(){try{return pr(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),Zt(p)}};function $y(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function p0(c){const p={};c=(c.g&&pr(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(w(c[y]))continue;var m=XP(c[y]);const O=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const F=p[O]||[];p[O]=F,F.push(m)}ft(p,function(y){return y.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ll(c,p,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||p}function jy(c){this.za=0,this.i=[],this.j=new Xa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ll("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ll("baseRetryDelayMs",5e3,c),this.Za=ll("retryDelaySeedMs",1e4,c),this.Ta=ll("forwardChannelMaxRetries",2,c),this.va=ll("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Ay(c&&c.concurrentRequestLimit),this.Ba=new h0,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=jy.prototype,n.ka=8,n.I=1,n.connect=function(c,p,m,y){mn(0),this.W=c,this.H=p||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.J=Xy(this,null,this.W),yu(this)};function bf(c){if(Gy(c),c.I==3){var p=c.V++,m=hs(c.J);if(pt(m,"SID",c.M),pt(m,"RID",p),pt(m,"TYPE","terminate"),cl(c,m),p=new hr(c,c.j,p),p.M=2,p.A=pu(hs(m)),m=!1,o.navigator&&o.navigator.sendBeacon)try{m=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!m&&o.Image&&(new Image().src=p.A,m=!0),m||(p.g=Zy(p.j,null),p.g.ea(p.A)),p.F=Date.now(),fu(p)}Jy(c)}function gu(c){c.g&&(Sf(c),c.g.cancel(),c.g=null)}function Gy(c){gu(c),c.v&&(o.clearTimeout(c.v),c.v=null),vu(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function yu(c){if(!Sy(c.h)&&!c.m){c.m=!0;var p=c.Ea;G||v(),J||(G(),J=!0),b.add(p,c),c.D=0}}function m0(c,p){return Ry(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=p.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Ja(u(c.Ea,c,p),Yy(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const O=new hr(this,this.j,c);let F=this.o;if(this.U&&(F?(F=pn(F),ue(F,this.U)):F=this.U),this.u!==null||this.R||(O.J=F,F=null),this.S)e:{for(var p=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(p+=y,p>4096){p=m;break e}if(p===4096||m===this.i.length-1){p=m+1;break e}}p=1e3}else p=1e3;p=Wy(this,O,p),m=hs(this.J),pt(m,"RID",c),pt(m,"CVER",22),this.G&&pt(m,"X-HTTP-Session-Id",this.G),cl(this,m),F&&(this.R?p="headers="+Za(Fy(F))+"&"+p:this.u&&wf(m,this.u,F)),Ef(this.h,O),this.Ra&&pt(m,"TYPE","init"),this.S?(pt(m,"$req",p),pt(m,"SID","null"),O.U=!0,_f(O,m,null)):_f(O,m,p),this.I=2}}else this.I==3&&(c?Ky(this,c):this.i.length==0||Sy(this.h)||Ky(this))};function Ky(c,p){var m;p?m=p.l:m=c.V++;const y=hs(c.J);pt(y,"SID",c.M),pt(y,"RID",m),pt(y,"AID",c.K),cl(c,y),c.u&&c.o&&wf(y,c.u,c.o),m=new hr(c,c.j,m,c.D+1),c.u===null&&(m.J=c.o),p&&(c.i=p.G.concat(c.i)),p=Wy(c,m,1e3),m.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),Ef(c.h,m),_f(m,y,p)}function cl(c,p){c.H&&re(c.H,function(m,y){pt(p,y,m)}),c.l&&re({},function(m,y){pt(p,y,m)})}function Wy(c,p,m){m=Math.min(c.i.length,m);const y=c.l?u(c.l.Ka,c.l,c):null;e:{var O=c.i;let Ce=-1;for(;;){const Dt=["count="+m];Ce==-1?m>0?(Ce=O[0].g,Dt.push("ofs="+Ce)):Ce=0:Dt.push("ofs="+Ce);let st=!0;for(let qt=0;qt<m;qt++){var F=O[qt].g;const ds=O[qt].map;if(F-=Ce,F<0)Ce=Math.max(0,O[qt].g-100),st=!1;else try{F="req"+F+"_"||"";try{var ne=ds instanceof Map?ds:Object.entries(ds);for(const[gi,mr]of ne){let _r=mr;a(mr)&&(_r=Be(mr)),Dt.push(F+gi+"="+encodeURIComponent(_r))}}catch(gi){throw Dt.push(F+"type="+encodeURIComponent("_badmap")),gi}}catch{y&&y(ds)}}if(st){ne=Dt.join("&");break e}}ne=void 0}return c=c.i.splice(0,m),p.G=c,ne}function zy(c){if(!c.g&&!c.v){c.Y=1;var p=c.Da;G||v(),J||(G(),J=!0),b.add(p,c),c.A=0}}function Af(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Ja(u(c.Da,c),Yy(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,Hy(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Ja(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,mn(10),gu(this),Hy(this))};function Sf(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function Hy(c){c.g=new hr(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var p=hs(c.na);pt(p,"RID","rpc"),pt(p,"SID",c.M),pt(p,"AID",c.K),pt(p,"CI",c.F?"0":"1"),!c.F&&c.ia&&pt(p,"TO",c.ia),pt(p,"TYPE","xmlhttp"),cl(c,p),c.u&&c.o&&wf(p,c.u,c.o),c.O&&(c.g.H=c.O);var m=c.g;c=c.ba,m.M=1,m.A=pu(hs(p)),m.u=null,m.R=!0,Ty(m,c)}n.Va=function(){this.C!=null&&(this.C=null,gu(this),Af(this),mn(19))};function vu(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Qy(c,p){var m=null;if(c.g==p){vu(c),Sf(c),c.g=null;var y=2}else if(vf(c.h,p))m=p.G,Cy(c.h,p),y=1;else return;if(c.I!=0){if(p.o)if(y==1){m=p.u?p.u.length:0,p=Date.now()-p.F;var O=c.D;y=fi(),H(y,new gy(y,m)),yu(c)}else zy(c);else if(O=p.m,O==3||O==0&&p.X>0||!(y==1&&m0(c,p)||y==2&&Af(c)))switch(m&&m.length>0&&(p=c.h,p.i=p.i.concat(m)),O){case 1:_i(c,5);break;case 4:_i(c,10);break;case 3:_i(c,6);break;default:_i(c,2)}}}function Yy(c,p){let m=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(m*=2),m*p}function _i(c,p){if(c.j.info("Error code "+p),p==2){var m=u(c.bb,c),y=c.Ua;const O=!y;y=new dr(y||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||tl(y,"https"),pu(y),O?c0(y.toString(),m):u0(y.toString(),m)}else mn(2);c.I=0,c.l&&c.l.pa(p),Jy(c),Gy(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),mn(2)):(this.j.info("Failed to ping google.com"),mn(1))};function Jy(c){if(c.I=0,c.ja=[],c.l){const p=Py(c.h);(p.length!=0||c.i.length!=0)&&(E(c.ja,p),E(c.ja,c.i),c.h.i.length=0,_(c.i),c.i.length=0),c.l.oa()}}function Xy(c,p,m){var y=m instanceof dr?hs(m):new dr(m);if(y.g!="")p&&(y.g=p+"."+y.g),nl(y,y.u);else{var O=o.location;y=O.protocol,p=p?p+"."+O.hostname:O.hostname,O=+O.port;const F=new dr(null);y&&tl(F,y),p&&(F.g=p),O&&nl(F,O),m&&(F.h=m),y=F}return m=c.G,p=c.wa,m&&p&&pt(y,m,p),pt(y,"VER",c.ka),cl(c,y),y}function Zy(c,p,m){if(p&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Aa&&!c.ma?new Tt(new Tf({ab:m})):new Tt(c.ma),p.Fa(c.L),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ev(){}n=ev.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Eu(){}Eu.prototype.g=function(c,p){return new Dn(c,p)};function Dn(c,p){Q.call(this),this.g=new jy(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(c?c["X-WebChannel-Client-Profile"]=p.sa:c={"X-WebChannel-Client-Profile":p.sa}),this.g.U=c,(c=p&&p.Qb)&&!w(c)&&(this.g.u=c),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!w(p)&&(this.g.G=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new Eo(this)}d(Dn,Q),Dn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Dn.prototype.close=function(){bf(this.g)},Dn.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.v&&(m={},m.__data__=Be(c),c=m);p.i.push(new t0(p.Ya++,c)),p.I==3&&yu(p)},Dn.prototype.N=function(){this.g.l=null,delete this.j,bf(this.g),delete this.g,Dn.Z.N.call(this)};function tv(c){go.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const m in p){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}d(tv,go);function nv(){zt.call(this),this.status=1}d(nv,zt);function Eo(c){this.g=c}d(Eo,ev),Eo.prototype.ra=function(){H(this.g,"a")},Eo.prototype.qa=function(c){H(this.g,new tv(c))},Eo.prototype.pa=function(c){H(this.g,new nv)},Eo.prototype.oa=function(){H(this.g,"b")},Eu.prototype.createWebChannel=Eu.prototype.g,Dn.prototype.send=Dn.prototype.o,Dn.prototype.open=Dn.prototype.m,Dn.prototype.close=Dn.prototype.close,fS=function(){return new Eu},dS=function(){return fi()},hS=Bt,Wp={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},du.NO_ERROR=0,du.TIMEOUT=8,du.HTTP_ERROR=6,Yu=du,yy.COMPLETE="complete",uS=yy,xn.EventType=zn,zn.OPEN="a",zn.CLOSE="b",zn.ERROR="c",zn.MESSAGE="d",Q.prototype.listen=Q.prototype.J,Rl=xn,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,cS=Tt}).apply(typeof Cu<"u"?Cu:typeof self<"u"?self:typeof window<"u"?window:{});const zE="@firebase/firestore",HE="4.9.3";class Gt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Gt.UNAUTHENTICATED=new Gt(null),Gt.GOOGLE_CREDENTIALS=new Gt("google-credentials-uid"),Gt.FIRST_PARTY=new Gt("first-party-uid"),Gt.MOCK_USER=new Gt("mock-user");let Ma="12.7.0";const Hr=new bd("@firebase/firestore");function No(){return Hr.logLevel}function VL(n){Hr.setLogLevel(n)}function W(n,...e){if(Hr.logLevel<=De.DEBUG){const t=e.map(K_);Hr.debug(`Firestore (${Ma}): ${n}`,...t)}}function St(n,...e){if(Hr.logLevel<=De.ERROR){const t=e.map(K_);Hr.error(`Firestore (${Ma}): ${n}`,...t)}}function Un(n,...e){if(Hr.logLevel<=De.WARN){const t=e.map(K_);Hr.warn(`Firestore (${Ma}): ${n}`,...t)}}function K_(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function de(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,pS(n,s,t)}function pS(n,e,t){let s=`FIRESTORE (${Ma}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw St(s),new Error(s)}function pe(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||pS(e,r,s)}function OL(n,e){n||de(57014,e)}function te(n,e){return n}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends rr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class mS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _S{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Gt.UNAUTHENTICATED)))}shutdown(){}}class ML{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class LL{constructor(e){this.t=e,this.currentUser=Gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pe(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new Wt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Wt,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},a=l=>{W("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(W("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Wt)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(W("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(pe(typeof s.accessToken=="string",31837,{l:s}),new mS(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(e===null||typeof e=="string",2055,{h:e}),new Gt(e)}}class FL{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Gt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class UL{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new FL(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Gt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class zp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class BL{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){pe(this.o===void 0,3512);const s=i=>{i.error!=null&&W("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,W("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{W("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):W("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new zp(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(pe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new zp(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class qL{getToken(){return Promise.resolve(new zp(""))}invalidateToken(){}start(e,t){}shutdown(){}}function $L(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Od{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=$L(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Ie(n,e){return n<e?-1:n>e?1:0}function Hp(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return Xf(r)===Xf(i)?Ie(r,i):Xf(r)?1:-1}return Ie(n.length,e.length)}const jL=55296,GL=57343;function Xf(n){const e=n.charCodeAt(0);return e>=jL&&e<=GL}function aa(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}function gS(n){return n+"\0"}const Qp="__name__";class ms{constructor(e,t,s){t===void 0?t=0:t>e.length&&de(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&de(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return ms.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ms?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=ms.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Ie(e.length,t.length)}static compareSegments(e,t){const s=ms.isNumericId(e),r=ms.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?ms.extractNumericId(e).compare(ms.extractNumericId(t)):Hp(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return $r.fromString(e.substring(4,e.length-2))}}class Ne extends ms{construct(e,t,s){return new Ne(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Ne(t)}static emptyPath(){return new Ne([])}}const KL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gt extends ms{construct(e,t,s){return new gt(e,t,s)}static isValidIdentifier(e){return KL.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Qp}static keyField(){return new gt([Qp])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new B(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new B(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new B(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new gt(t)}static emptyPath(){return new gt([])}}class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Ne.fromString(e))}static fromName(e){return new ee(Ne.fromString(e).popFirst(5))}static empty(){return new ee(Ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Ne(e.slice()))}}function W_(n,e,t){if(!t)throw new B(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function yS(n,e,t,s){if(e===!0&&s===!0)throw new B(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function QE(n){if(!ee.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function YE(n){if(ee.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vS(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Md(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":de(12329,{type:typeof n})}function ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Md(n);throw new B(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ES(n,e){if(e<=0)throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Nt(n,e){const t={typeString:n};return e&&(t.value=e),t}function uo(n,e){if(!vS(n))throw new B(M.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new B(M.INVALID_ARGUMENT,t);return!0}const JE=-62135596800,XE=1e6;class Qe{static now(){return Qe.fromMillis(Date.now())}static fromDate(e){return Qe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*XE);return new Qe(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<JE)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/XE}_compareTo(e){return this.seconds===e.seconds?Ie(this.nanoseconds,e.nanoseconds):Ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(uo(e,Qe._jsonSchema))return new Qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-JE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Qe._jsonSchemaVersion="firestore/timestamp/1.0",Qe._jsonSchema={type:Nt("string",Qe._jsonSchemaVersion),seconds:Nt("number"),nanoseconds:Nt("number")};class me{static fromTimestamp(e){return new me(e)}static min(){return new me(new Qe(0,0))}static max(){return new me(new Qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const la=-1;class ca{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function Yp(n){return n.fields.find((e=>e.kind===2))}function bi(n){return n.fields.filter((e=>e.kind!==2))}function WL(n,e){let t=Ie(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let s=0;s<Math.min(n.fields.length,e.fields.length);++s)if(t=zL(n.fields[s],e.fields[s]),t!==0)return t;return Ie(n.fields.length,e.fields.length)}ca.UNKNOWN_ID=-1;class Ui{constructor(e,t){this.fieldPath=e,this.kind=t}}function zL(n,e){const t=gt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ie(n.kind,e.kind)}class ua{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ua(0,Bn.min())}}function IS(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=me.fromTimestamp(s===1e9?new Qe(t+1,0):new Qe(t,s));return new Bn(r,ee.empty(),e)}function TS(n){return new Bn(n.readTime,n.key,la)}class Bn{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Bn(me.min(),ee.empty(),la)}static max(){return new Bn(me.max(),ee.empty(),la)}}function z_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ee.comparator(n.documentKey,e.documentKey),t!==0?t:Ie(n.largestBatchId,e.largestBatchId))}const wS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function si(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==wS)throw n;W("LocalStore","Unexpectedly lost primary lease")}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&de(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):D.reject(t)}static resolve(e){return new D(((t,s)=>{t(e)}))}static reject(e){return new D(((t,s)=>{s(e)}))}static waitFor(e){return new D(((t,s)=>{let r=0,i=0,o=!1;e.forEach((a=>{++r,a.next((()=>{++i,o&&i===r&&t()}),(l=>s(l)))})),o=!0,i===r&&t()}))}static or(e){let t=D.resolve(!1);for(const s of e)t=t.next((r=>r?D.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new D(((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new D(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}const Mn="SimpleDb";class Ld{static open(e,t,s,r){try{return new Ld(t,e.transaction(r,s))}catch(i){throw new Kl(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Wt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Kl(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=H_(s.target.error);this.S.reject(new Kl(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(W(Mn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new QL(t)}}class As{static delete(e){return W(Mn,"Removing database:",e),Si(eb().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!ub())return!1;if(As.F())return!0;const e=Mt(),t=As.M(e),s=0<t&&t<10,r=AS(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,As.M(Mt())===12.2&&St("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(W(Mn,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{s(new Kl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new B(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new B(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Kl(e,o))},r.onupgradeneeded=i=>{W(Mn,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,r.transaction,i.oldVersion,this.version).next((()=>{W(Mn,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Ld.open(this.db,e,i?"readonly":"readwrite",s),l=r(a).next((u=>(a.C(),u))).catch((u=>(a.abort(u),D.reject(u)))).toPromise();return l.catch((()=>{})),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(W(Mn,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function AS(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class HL{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Si(this.U.delete())}}class Kl extends B{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ri(n){return n.name==="IndexedDbTransactionError"}class QL{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(W(Mn,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(W(Mn,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),Si(s)}add(e){return W(Mn,"ADD",this.store.name,e,e),Si(this.store.add(e))}get(e){return Si(this.store.get(e)).next((t=>(t===void 0&&(t=null),W(Mn,"GET",this.store.name,e,t),t)))}delete(e){return W(Mn,"DELETE",this.store.name,e),Si(this.store.delete(e))}count(){return W(Mn,"COUNT",this.store.name),Si(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new D(((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(s),o=[];return this.H(i,((a,l)=>{o.push(l)})).next((()=>o))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new D(((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}}))}Z(e,t){W(Mn,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,((i,o,a)=>a.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new D(((s,r)=>{t.onerror=i=>{const o=H_(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((a=>{a?o.continue():s()})):s()}}))}H(e,t){const s=[];return new D(((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new HL(a),u=t(a.primaryKey,a.value,l);if(u instanceof D){const h=u.catch((d=>(l.done(),D.reject(d))));s.push(h)}l.isDone?r():l.G===null?a.continue():a.continue(l.G)}})).next((()=>D.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Si(n){return new D(((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=H_(s.target.error);t(r)}}))}let ZE=!1;function H_(n){const e=As.M(Mt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ZE||(ZE=!0,setTimeout((()=>{throw s}),0)),s}}return n}const Wl="IndexBackfiller";class YL{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){W(Wl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();W(Wl,`Documents written: ${t}`)}catch(t){ri(t)?W(Wl,"Ignoring IndexedDB error during index backfill: ",t):await si(t)}await this.re(6e4)}))}}class JL{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let r=t,i=!0;return D.doWhile((()=>i===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!s.has(o))return W(Wl,`Processing collection: ${o}`),this.oe(e,o,r).next((a=>{r-=a,s.add(o)}));i=!1})))).next((()=>t-r))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(r,i))).next((a=>(W(Wl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a)))).next((()=>o.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((r,i)=>{const o=TS(i);z_(o,s)>0&&(s=o)})),new Bn(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}class bn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}bn.ce=-1;const jr=-1;function Qc(n){return n==null}function Ec(n){return n===0&&1/n==-1/0}function SS(n){return typeof n=="number"&&Number.isInteger(n)&&!Ec(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const qh="";function un(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=eI(e)),e=XL(n.get(t),e);return eI(e)}function XL(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case qh:t+="";break;default:t+=i}}return t}function eI(n){return n+qh+""}function vs(n){const e=n.length;if(pe(e>=2,64408,{path:n}),e===2)return pe(n.charAt(0)===qh&&n.charAt(1)==="",56145,{path:n}),Ne.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf(qh,i);switch((o<0||o>t)&&de(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;r.length===0?l=a:(r+=a,l=r,r=""),s.push(l);break;case"":r+=n.substring(i,o),r+="\0";break;case"":r+=n.substring(i,o+1);break;default:de(61167,{path:n})}i=o+2}return new Ne(s)}const Ai="remoteDocuments",Yc="owner",wo="owner",Ic="mutationQueues",ZL="userId",Qn="mutations",tI="batchId",Di="userMutationsIndex",nI=["userId","batchId"];function Ju(n,e){return[n,un(e)]}function RS(n,e,t){return[n,un(e),t]}const eF={},ha="documentMutations",$h="remoteDocumentsV14",tF=["prefixPath","collectionGroup","readTime","documentId"],Xu="documentKeyIndex",nF=["prefixPath","collectionGroup","documentId"],CS="collectionGroupIndex",sF=["collectionGroup","readTime","prefixPath","documentId"],Tc="remoteDocumentGlobal",Jp="remoteDocumentGlobalKey",da="targets",PS="queryTargetsIndex",rF=["canonicalId","targetId"],fa="targetDocuments",iF=["targetId","path"],Q_="documentTargetsIndex",oF=["path","targetId"],jh="targetGlobalKey",Bi="targetGlobal",wc="collectionParents",aF=["collectionId","parent"],pa="clientMetadata",lF="clientId",Fd="bundles",cF="bundleId",Ud="namedQueries",uF="name",Y_="indexConfiguration",hF="indexId",Xp="collectionGroupIndex",dF="collectionGroup",zl="indexState",fF=["indexId","uid"],NS="sequenceNumberIndex",pF=["uid","sequenceNumber"],Hl="indexEntries",mF=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kS="documentKeyIndex",_F=["indexId","uid","orderedDocumentKey"],Bd="documentOverlays",gF=["userId","collectionPath","documentId"],Zp="collectionPathOverlayIndex",yF=["userId","collectionPath","largestBatchId"],xS="collectionGroupOverlayIndex",vF=["userId","collectionGroup","largestBatchId"],J_="globals",EF="name",DS=[Ic,Qn,ha,Ai,da,Yc,Bi,fa,pa,Tc,wc,Fd,Ud],IF=[...DS,Bd],VS=[Ic,Qn,ha,$h,da,Yc,Bi,fa,pa,Tc,wc,Fd,Ud,Bd],OS=VS,X_=[...OS,Y_,zl,Hl],TF=X_,MS=[...X_,J_],wF=MS;class em extends bS{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ft(n,e){const t=te(n);return As.O(t.le,e)}function sI(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ii(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function LS(n,e){const t=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.push(e(n[s],s,n));return t}function FS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class dt{constructor(e,t){this.comparator=e,this.root=t||Ht.EMPTY}insert(e,t){return new dt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(e){return new dt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pu(this.root,e,this.comparator,!0)}}class Pu{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ht{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ht.RED,this.left=r??Ht.EMPTY,this.right=i??Ht.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Ht(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ht.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ht.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ht.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ht.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw de(43730,{key:this.key,value:this.value});if(this.right.isRed())throw de(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw de(27949);return e+(this.isRed()?0:1)}}Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1;Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw de(57766)}get value(){throw de(16141)}get color(){throw de(16727)}get left(){throw de(29726)}get right(){throw de(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ze{constructor(e){this.comparator=e,this.data=new dt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rI(this.data.getIterator())}getIteratorFrom(e){return new rI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ze)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ze(this.comparator);return t.data=e,t}}class rI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function bo(n){return n.hasNext()?n.getNext():void 0}class An{constructor(e){this.fields=e,e.sort(gt.comparator)}static empty(){return new An([])}unionWith(e){let t=new Ze(gt.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new An(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return aa(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class US extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function bF(){return typeof atob<"u"}class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new US("Invalid base64 string: "+i):i}})(e);return new It(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const AF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function er(n){if(pe(!!n,39018),typeof n=="string"){let e=0;const t=AF.exec(n);if(pe(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function tr(n){return typeof n=="string"?It.fromBase64String(n):It.fromUint8Array(n)}const BS="server_timestamp",qS="__type__",$S="__previous_value__",jS="__local_write_time__";function qd(n){return(n?.mapValue?.fields||{})[qS]?.stringValue===BS}function $d(n){const e=n.mapValue.fields[$S];return qd(e)?$d(e):e}function bc(n){const e=er(n.mapValue.fields[jS].timestampValue);return new Qe(e.seconds,e.nanos)}class SF{constructor(e,t,s,r,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Ac="(default)";class Qr{constructor(e,t){this.projectId=e,this.database=t||Ac}static empty(){return new Qr("","")}get isDefaultDatabase(){return this.database===Ac}isEqual(e){return e instanceof Qr&&e.projectId===this.projectId&&e.database===this.database}}const Z_="__type__",GS="__max__",Vr={mapValue:{fields:{__type__:{stringValue:GS}}}},eg="__vector__",ma="value",Zu={nullValue:"NULL_VALUE"};function Yr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qd(n)?4:KS(n)?9007199254740991:jd(n)?10:11:de(28295,{value:n})}function Ps(n,e){if(n===e)return!0;const t=Yr(n);if(t!==Yr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return bc(n).isEqual(bc(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=er(r.timestampValue),a=er(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return tr(r.bytesValue).isEqual(tr(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return yt(r.geoPointValue.latitude)===yt(i.geoPointValue.latitude)&&yt(r.geoPointValue.longitude)===yt(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return yt(r.integerValue)===yt(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=yt(r.doubleValue),a=yt(i.doubleValue);return o===a?Ec(o)===Ec(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return aa(n.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(sI(o)!==sI(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ps(o[l],a[l])))return!1;return!0})(n,e);default:return de(52216,{left:n})}}function Sc(n,e){return(n.values||[]).find((t=>Ps(t,e)))!==void 0}function Jr(n,e){if(n===e)return 0;const t=Yr(n),s=Yr(e);if(t!==s)return Ie(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ie(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=yt(i.integerValue||i.doubleValue),l=yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return iI(n.timestampValue,e.timestampValue);case 4:return iI(bc(n),bc(e));case 5:return Hp(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=tr(i),l=tr(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Ie(a[u],l[u]);if(h!==0)return h}return Ie(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=Ie(yt(i.latitude),yt(o.latitude));return a!==0?a:Ie(yt(i.longitude),yt(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return oI(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const a=i.fields||{},l=o.fields||{},u=a[ma]?.arrayValue,h=l[ma]?.arrayValue,d=Ie(u?.values?.length||0,h?.values?.length||0);return d!==0?d:oI(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===Vr.mapValue&&o===Vr.mapValue)return 0;if(i===Vr.mapValue)return 1;if(o===Vr.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const f=Hp(l[d],h[d]);if(f!==0)return f;const _=Jr(a[l[d]],u[h[d]]);if(_!==0)return _}return Ie(l.length,h.length)})(n.mapValue,e.mapValue);default:throw de(23264,{he:t})}}function iI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ie(n,e);const t=er(n),s=er(e),r=Ie(t.seconds,s.seconds);return r!==0?r:Ie(t.nanos,s.nanos)}function oI(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Jr(t[r],s[r]);if(i)return i}return Ie(t.length,s.length)}function _a(n){return tm(n)}function tm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=er(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return tr(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return ee.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=tm(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${tm(t.fields[o])}`;return r+"}"})(n.mapValue):de(61005,{value:n})}function eh(n){switch(Yr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=$d(n);return e?16+eh(e):16;case 5:return 2*n.stringValue.length;case 6:return tr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+eh(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return ii(s.fields,((i,o)=>{r+=i.length+eh(o)})),r})(n.mapValue);default:throw de(13486,{value:n})}}function Yi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function nm(n){return!!n&&"integerValue"in n}function Rc(n){return!!n&&"arrayValue"in n}function aI(n){return!!n&&"nullValue"in n}function lI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function th(n){return!!n&&"mapValue"in n}function jd(n){return(n?.mapValue?.fields||{})[Z_]?.stringValue===eg}function Ql(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ii(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Ql(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ql(n.arrayValue.values[t]);return e}return{...n}}function KS(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===GS}const WS={mapValue:{fields:{[Z_]:{stringValue:eg},[ma]:{arrayValue:{}}}}};function RF(n){return"nullValue"in n?Zu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Yi(Qr.empty(),ee.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?jd(n)?WS:{mapValue:{}}:de(35942,{value:n})}function CF(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Yi(Qr.empty(),ee.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?WS:"mapValue"in n?jd(n)?{mapValue:{}}:Vr:de(61959,{value:n})}function cI(n,e){const t=Jr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function uI(n,e){const t=Jr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Yt{constructor(e){this.value=e}static empty(){return new Yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!th(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ql(t)}setAll(e){let t=gt.emptyPath(),s={},r=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=Ql(o):r.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());th(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];th(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){ii(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new Yt(Ql(this.value))}}function zS(n){const e=[];return ii(n.fields,((t,s)=>{const r=new gt([t]);if(th(s)){const i=zS(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new An(e)}class _t{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new _t(e,0,me.min(),me.min(),me.min(),Yt.empty(),0)}static newFoundDocument(e,t,s,r){return new _t(e,1,t,me.min(),s,r,0)}static newNoDocument(e,t){return new _t(e,2,t,me.min(),me.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,me.min(),me.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xr{constructor(e,t){this.position=e,this.inclusive=t}}function hI(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=ee.comparator(ee.fromName(o.referenceValue),t.key):s=Jr(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function dI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ps(n.position[t],e.position[t]))return!1;return!0}class Cc{constructor(e,t="asc"){this.field=e,this.dir=t}}function PF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class HS{}class Le extends HS{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new NF(e,t,s):t==="array-contains"?new DF(e,s):t==="in"?new eR(e,s):t==="not-in"?new VF(e,s):t==="array-contains-any"?new OF(e,s):new Le(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new kF(e,s):new xF(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Jr(t,this.value)):t!==null&&Yr(this.value)===Yr(t)&&this.matchesComparison(Jr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Je extends HS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Je(e,t)}matches(e){return ga(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ga(n){return n.op==="and"}function sm(n){return n.op==="or"}function tg(n){return QS(n)&&ga(n)}function QS(n){for(const e of n.filters)if(e instanceof Je)return!1;return!0}function rm(n){if(n instanceof Le)return n.field.canonicalString()+n.op.toString()+_a(n.value);if(tg(n))return n.filters.map((e=>rm(e))).join(",");{const e=n.filters.map((t=>rm(t))).join(",");return`${n.op}(${e})`}}function YS(n,e){return n instanceof Le?(function(s,r){return r instanceof Le&&s.op===r.op&&s.field.isEqual(r.field)&&Ps(s.value,r.value)})(n,e):n instanceof Je?(function(s,r){return r instanceof Je&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,a)=>i&&YS(o,r.filters[a])),!0):!1})(n,e):void de(19439)}function JS(n,e){const t=n.filters.concat(e);return Je.create(t,n.op)}function XS(n){return n instanceof Le?(function(t){return`${t.field.canonicalString()} ${t.op} ${_a(t.value)}`})(n):n instanceof Je?(function(t){return t.op.toString()+" {"+t.getFilters().map(XS).join(" ,")+"}"})(n):"Filter"}class NF extends Le{constructor(e,t,s){super(e,t,s),this.key=ee.fromName(s.referenceValue)}matches(e){const t=ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class kF extends Le{constructor(e,t){super(e,"in",t),this.keys=ZS("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class xF extends Le{constructor(e,t){super(e,"not-in",t),this.keys=ZS("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function ZS(n,e){return(e.arrayValue?.values||[]).map((t=>ee.fromName(t.referenceValue)))}class DF extends Le{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Rc(t)&&Sc(t.arrayValue,this.value)}}class eR extends Le{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Sc(this.value.arrayValue,t)}}class VF extends Le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Sc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Sc(this.value.arrayValue,t)}}class OF extends Le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Rc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Sc(this.value.arrayValue,s)))}}class MF{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function im(n,e=null,t=[],s=[],r=null,i=null,o=null){return new MF(n,e,t,s,r,i,o)}function Ji(n){const e=te(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>rm(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Qc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>_a(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>_a(s))).join(",")),e.Te=t}return e.Te}function Jc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!PF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!YS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!dI(n.startAt,e.startAt)&&dI(n.endAt,e.endAt)}function Gh(n){return ee.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Kh(n,e){return n.filters.filter((t=>t instanceof Le&&t.field.isEqual(e)))}function fI(n,e,t){let s=Zu,r=!0;for(const i of Kh(n,e)){let o=Zu,a=!0;switch(i.op){case"<":case"<=":o=RF(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Zu}cI({value:s,inclusive:r},{value:o,inclusive:a})<0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];cI({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function pI(n,e,t){let s=Vr,r=!0;for(const i of Kh(n,e)){let o=Vr,a=!0;switch(i.op){case">=":case">":o=CF(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Vr}uI({value:s,inclusive:r},{value:o,inclusive:a})>0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];uI({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}class or{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tR(n,e,t,s,r,i,o,a){return new or(n,e,t,s,r,i,o,a)}function La(n){return new or(n)}function mI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ng(n){return n.collectionGroup!==null}function Ho(n){const e=te(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ze(gt.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Cc(i,s))})),t.has(gt.keyField().canonicalString())||e.Ie.push(new Cc(gt.keyField(),s))}return e.Ie}function hn(n){const e=te(n);return e.Ee||(e.Ee=sR(e,Ho(n))),e.Ee}function nR(n){const e=te(n);return e.de||(e.de=sR(e,n.explicitOrderBy)),e.de}function sR(n,e){if(n.limitType==="F")return im(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new Cc(r.field,i)}));const t=n.endAt?new Xr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Xr(n.startAt.position,n.startAt.inclusive):null;return im(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function om(n,e){const t=n.filters.concat([e]);return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Wh(n,e,t){return new or(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Xc(n,e){return Jc(hn(n),hn(e))&&n.limitType===e.limitType}function rR(n){return`${Ji(hn(n))}|lt:${n.limitType}`}function ko(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>XS(r))).join(", ")}]`),Qc(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>_a(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>_a(r))).join(",")),`Target(${s})`})(hn(n))}; limitType=${n.limitType})`}function Zc(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):ee.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of Ho(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,a,l){const u=hI(o,a,l);return o.inclusive?u<=0:u<0})(s.startAt,Ho(s),r)||s.endAt&&!(function(o,a,l){const u=hI(o,a,l);return o.inclusive?u>=0:u>0})(s.endAt,Ho(s),r))})(n,e)}function iR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function oR(n){return(e,t)=>{let s=!1;for(const r of Ho(n)){const i=LF(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function LF(n,e,t){const s=n.field.isKeyField()?ee.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Jr(l,u):de(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return de(19790,{direction:n.dir})}}class ar{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ii(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return FS(this.inner)}size(){return this.innerSize}}const FF=new dt(ee.comparator);function Sn(){return FF}const aR=new dt(ee.comparator);function Cl(...n){let e=aR;for(const t of n)e=e.insert(t.key,t);return e}function lR(n){let e=aR;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Es(){return Yl()}function cR(){return Yl()}function Yl(){return new ar((n=>n.toString()),((n,e)=>n.isEqual(e)))}const UF=new dt(ee.comparator),BF=new Ze(ee.comparator);function Re(...n){let e=BF;for(const t of n)e=e.add(t);return e}const qF=new Ze(Ie);function sg(){return qF}function rg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ec(e)?"-0":e}}function uR(n){return{integerValue:""+n}}function hR(n,e){return SS(e)?uR(e):rg(n,e)}class Gd{constructor(){this._=void 0}}function $F(n,e,t){return n instanceof ya?(function(r,i){const o={fields:{[qS]:{stringValue:BS},[jS]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&qd(i)&&(i=$d(i)),i&&(o.fields[$S]=i),{mapValue:o}})(t,e):n instanceof Xi?fR(n,e):n instanceof Zi?pR(n,e):(function(r,i){const o=dR(r,i),a=_I(o)+_I(r.Ae);return nm(o)&&nm(r.Ae)?uR(a):rg(r.serializer,a)})(n,e)}function jF(n,e,t){return n instanceof Xi?fR(n,e):n instanceof Zi?pR(n,e):t}function dR(n,e){return n instanceof va?(function(s){return nm(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class ya extends Gd{}class Xi extends Gd{constructor(e){super(),this.elements=e}}function fR(n,e){const t=mR(e);for(const s of n.elements)t.some((r=>Ps(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Zi extends Gd{constructor(e){super(),this.elements=e}}function pR(n,e){let t=mR(e);for(const s of n.elements)t=t.filter((r=>!Ps(r,s)));return{arrayValue:{values:t}}}class va extends Gd{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function _I(n){return yt(n.integerValue||n.doubleValue)}function mR(n){return Rc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class eu{constructor(e,t){this.field=e,this.transform=t}}function GF(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Xi&&r instanceof Xi||s instanceof Zi&&r instanceof Zi?aa(s.elements,r.elements,Ps):s instanceof va&&r instanceof va?Ps(s.Ae,r.Ae):s instanceof ya&&r instanceof ya})(n.transform,e.transform)}class KF{constructor(e,t){this.version=e,this.transformResults=t}}class vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vt}static exists(e){return new vt(void 0,e)}static updateTime(e){return new vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Kd{}function _R(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ua(n.key,vt.none()):new Fa(n.key,n.data,vt.none());{const t=n.data,s=Yt.empty();let r=new Ze(gt.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new lr(n.key,s,new An(r.toArray()),vt.none())}}function WF(n,e,t){n instanceof Fa?(function(r,i,o){const a=r.value.clone(),l=yI(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof lr?(function(r,i,o){if(!nh(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=yI(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(gR(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Jl(n,e,t,s){return n instanceof Fa?(function(i,o,a,l){if(!nh(i.precondition,o))return a;const u=i.value.clone(),h=vI(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,s):n instanceof lr?(function(i,o,a,l){if(!nh(i.precondition,o))return a;const u=vI(i.fieldTransforms,l,o),h=o.data;return h.setAll(gR(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((d=>d.field)))})(n,e,t,s):(function(i,o,a){return nh(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function zF(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=dR(s.transform,r||null);i!=null&&(t===null&&(t=Yt.empty()),t.set(s.field,i))}return t||null}function gI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&aa(s,r,((i,o)=>GF(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fa extends Kd{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class lr extends Kd{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function gR(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function yI(n,e,t){const s=new Map;pe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,jF(o,a,t[r]))}return s}function vI(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,$F(i,o,e))}return s}class Ua extends Kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ig extends Kd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class og{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&WF(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Jl(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Jl(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=cR();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=_R(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(me.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Re())}isEqual(e){return this.batchId===e.batchId&&aa(this.mutations,e.mutations,((t,s)=>gI(t,s)))&&aa(this.baseMutations,e.baseMutations,((t,s)=>gI(t,s)))}}class ag{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){pe(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return UF})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new ag(e,t,s,r)}}class lg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class yR{constructor(e,t,s){this.alias=e,this.aggregateType=t,this.fieldPath=s}}class HF{constructor(e,t){this.count=e,this.unchangedNames=t}}var Pt,Ue;function vR(n){switch(n){case M.OK:return de(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return de(15467,{code:n})}}function ER(n){if(n===void 0)return St("GRPC error has no .code"),M.UNKNOWN;switch(n){case Pt.OK:return M.OK;case Pt.CANCELLED:return M.CANCELLED;case Pt.UNKNOWN:return M.UNKNOWN;case Pt.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Pt.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Pt.INTERNAL:return M.INTERNAL;case Pt.UNAVAILABLE:return M.UNAVAILABLE;case Pt.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Pt.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Pt.NOT_FOUND:return M.NOT_FOUND;case Pt.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Pt.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Pt.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Pt.ABORTED:return M.ABORTED;case Pt.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Pt.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Pt.DATA_LOSS:return M.DATA_LOSS;default:return de(39323,{code:n})}}(Ue=Pt||(Pt={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";let am=null;function IR(){return new TextEncoder}const QF=new $r([4294967295,4294967295],0);function EI(n){const e=IR().encode(n),t=new lS;return t.update(e),new Uint8Array(t.digest())}function II(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new $r([t,s],0),new $r([r,i],0)]}class cg{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Pl(`Invalid padding: ${t}`);if(s<0)throw new Pl(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Pl(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Pl(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=$r.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply($r.fromNumber(s)));return r.compare(QF)===1&&(r=new $r([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=EI(e),[s,r]=II(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new cg(i,r,t);return s.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=EI(e),[s,r]=II(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Pl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class tu{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,nu.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new tu(me.min(),r,new dt(Ie),Sn(),Re())}}class nu{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new nu(s,t,Re(),Re(),Re())}}class sh{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class TR{constructor(e,t){this.targetId=e,this.Ce=t}}class wR{constructor(e,t,s=It.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class TI{constructor(){this.ve=0,this.Fe=wI(),this.Me=It.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Re(),t=Re(),s=Re();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:de(38017,{changeType:i})}})),new nu(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=wI()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,pe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class YF{constructor(e){this.Ge=e,this.ze=new Map,this.je=Sn(),this.Je=Nu(),this.He=Nu(),this.Ye=new dt(Ie)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:de(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Gh(i))if(s===0){const o=new ee(i.path);this.et(t,o,_t.newNoDocument(o,me.min()))}else pe(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}am?.lt((function(h,d,f,_,E){const T={localCacheCount:h,existenceFilterCount:d.count,databaseId:f.database,projectId:f.projectId},C=d.unchangedNames;return C&&(T.bloomFilter={applied:E===0,hashCount:C?.hashCount??0,bitmapLength:C?.bits?.bitmap?.length??0,padding:C?.bits?.padding??0,mightContain:L=>_?.mightContain(L)??!1}),T})(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=tr(s).toUint8Array()}catch(l){if(l instanceof US)return Un("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new cg(o,r,i)}catch(l){return Un(l instanceof Pl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Gh(a.target)){const l=new ee(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,_t.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=Re();this.He.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new tu(e,t,this.Ye,this.je,s);return this.je=Sn(),this.Je=Nu(),this.He=Nu(),this.Ye=new dt(Ie),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new TI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ze(Ie),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ze(Ie),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||W("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new TI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Nu(){return new dt(ee.comparator)}function wI(){return new dt(ee.comparator)}const JF={asc:"ASCENDING",desc:"DESCENDING"},XF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZF={and:"AND",or:"OR"};class e2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lm(n,e){return n.useProto3Json||Qc(e)?e:{value:e}}function Ea(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function bR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function t2(n,e){return Ea(n,e.toTimestamp())}function Rt(n){return pe(!!n,49232),me.fromTimestamp((function(t){const s=er(t);return new Qe(s.seconds,s.nanos)})(n))}function ug(n,e){return cm(n,e).canonicalString()}function cm(n,e){const t=(function(r){return new Ne(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function AR(n){const e=Ne.fromString(n);return pe(VR(e),10190,{key:e.toString()}),e}function Pc(n,e){return ug(n.databaseId,e.path)}function Ss(n,e){const t=AR(e);if(t.get(1)!==n.databaseId.projectId)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ee(CR(t))}function SR(n,e){return ug(n.databaseId,e)}function RR(n){const e=AR(n);return e.length===4?Ne.emptyPath():CR(e)}function um(n){return new Ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function CR(n){return pe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function bI(n,e,t){return{name:Pc(n,e),fields:t.value.mapValue.fields}}function Wd(n,e,t){const s=Ss(n,e.name),r=Rt(e.updateTime),i=e.createTime?Rt(e.createTime):me.min(),o=new Yt({mapValue:{fields:e.fields}}),a=_t.newFoundDocument(s,r,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function n2(n,e){return"found"in e?(function(s,r){pe(!!r.found,43571),r.found.name,r.found.updateTime;const i=Ss(s,r.found.name),o=Rt(r.found.updateTime),a=r.found.createTime?Rt(r.found.createTime):me.min(),l=new Yt({mapValue:{fields:r.found.fields}});return _t.newFoundDocument(i,o,a,l)})(n,e):"missing"in e?(function(s,r){pe(!!r.missing,3894),pe(!!r.readTime,22933);const i=Ss(s,r.missing),o=Rt(r.readTime);return _t.newNoDocument(i,o)})(n,e):de(7234,{result:e})}function s2(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:de(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?(pe(h===void 0||typeof h=="string",58123),It.fromBase64String(h||"")):(pe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),It.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?M.UNKNOWN:ER(u.code);return new B(h,u.message||"")})(o);t=new wR(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ss(n,s.document.name),i=Rt(s.document.updateTime),o=s.document.createTime?Rt(s.document.createTime):me.min(),a=new Yt({mapValue:{fields:s.document.fields}}),l=_t.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];t=new sh(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ss(n,s.document),i=s.readTime?Rt(s.readTime):me.min(),o=_t.newNoDocument(r,i),a=s.removedTargetIds||[];t=new sh([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ss(n,s.document),i=s.removedTargetIds||[];t=new sh([],i,r,null)}else{if(!("filter"in e))return de(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new HF(r,i),a=s.targetId;t=new TR(a,o)}}return t}function Nc(n,e){let t;if(e instanceof Fa)t={update:bI(n,e.key,e.value)};else if(e instanceof Ua)t={delete:Pc(n,e.key)};else if(e instanceof lr)t={update:bI(n,e.key,e.data),updateMask:c2(e.fieldMask)};else{if(!(e instanceof ig))return de(16599,{Vt:e.type});t={verify:Pc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const a=o.transform;if(a instanceof ya)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Xi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Zi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof va)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw de(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:t2(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:de(27497)})(n,e.precondition)),t}function hm(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?vt.updateTime(Rt(i.updateTime)):i.exists!==void 0?vt.exists(i.exists):vt.none()})(e.currentDocument):vt.none(),s=e.updateTransforms?e.updateTransforms.map((r=>(function(o,a){let l=null;if("setToServerValue"in a)pe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new ya;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Xi(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Zi(h)}else"increment"in a?l=new va(o,a.increment):de(16584,{proto:a});const u=gt.fromServerFormat(a.fieldPath);return new eu(u,l)})(n,r))):[];if(e.update){e.update.name;const r=Ss(n,e.update.name),i=new Yt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new An(u.map((h=>gt.fromServerFormat(h))))})(e.updateMask);return new lr(r,i,o,t,s)}return new Fa(r,i,t,s)}if(e.delete){const r=Ss(n,e.delete);return new Ua(r,t)}if(e.verify){const r=Ss(n,e.verify);return new ig(r,t)}return de(1463,{proto:e})}function r2(n,e){return n&&n.length>0?(pe(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?Rt(r.updateTime):Rt(i);return o.isEqual(me.min())&&(o=Rt(i)),new KF(o,r.transformResults||[])})(t,e)))):[]}function PR(n,e){return{documents:[SR(n,e.path)]}}function zd(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=SR(n,r);const i=(function(u){if(u.length!==0)return DR(Je.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(f){return{field:xr(f.field),direction:o2(f.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=lm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:r}}function NR(n,e,t,s){const{ft:r,parent:i}=zd(n,e),o={},a=[];let l=0;return t.forEach((u=>{const h=s?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:xr(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:xr(u.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},gt:o,parent:i}}function kR(n){let e=RR(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){pe(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(d){const f=xR(d);return f instanceof Je&&tg(f)?f.getFilters():[f]})(t.where));let o=[];t.orderBy&&(o=(function(d){return d.map((f=>(function(E){return new Cc(xo(E.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(f)))})(t.orderBy));let a=null;t.limit&&(a=(function(d){let f;return f=typeof d=="object"?d.value:d,Qc(f)?null:f})(t.limit));let l=null;t.startAt&&(l=(function(d){const f=!!d.before,_=d.values||[];return new Xr(_,f)})(t.startAt));let u=null;return t.endAt&&(u=(function(d){const f=!d.before,_=d.values||[];return new Xr(_,f)})(t.endAt)),tR(e,r,o,i,a,"F",l,u)}function i2(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xR(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=xo(t.unaryFilter.field);return Le.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=xo(t.unaryFilter.field);return Le.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=xo(t.unaryFilter.field);return Le.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=xo(t.unaryFilter.field);return Le.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return de(61313);default:return de(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Le.create(xo(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return de(58110);default:return de(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Je.create(t.compositeFilter.filters.map((s=>xR(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return de(1026)}})(t.compositeFilter.op))})(n):de(30097,{filter:n})}function o2(n){return JF[n]}function a2(n){return XF[n]}function l2(n){return ZF[n]}function xr(n){return{fieldPath:n.canonicalString()}}function xo(n){return gt.fromServerFormat(n.fieldPath)}function DR(n){return n instanceof Le?(function(t){if(t.op==="=="){if(lI(t.value))return{unaryFilter:{field:xr(t.field),op:"IS_NAN"}};if(aI(t.value))return{unaryFilter:{field:xr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(lI(t.value))return{unaryFilter:{field:xr(t.field),op:"IS_NOT_NAN"}};if(aI(t.value))return{unaryFilter:{field:xr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xr(t.field),op:a2(t.op),value:t.value}}})(n):n instanceof Je?(function(t){const s=t.getFilters().map((r=>DR(r)));return s.length===1?s[0]:{compositeFilter:{op:l2(t.op),filters:s}}})(n):de(54877,{filter:n})}function c2(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function VR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class $s{constructor(e,t,s,r,i=me.min(),o=me.min(),a=It.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new $s(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class OR{constructor(e){this.yt=e}}function u2(n,e){let t;if(e.document)t=Wd(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=ee.fromSegments(e.noDocument.path),r=to(e.noDocument.readTime);t=_t.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return de(56709);{const s=ee.fromSegments(e.unknownDocument.path),r=to(e.unknownDocument.version);t=_t.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime((function(r){const i=new Qe(r[0],r[1]);return me.fromTimestamp(i)})(e.readTime)),t}function AI(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:zh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(i,o){return{name:Pc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ea(i,o.version.toTimestamp()),createTime:Ea(i,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:eo(e.version)};else{if(!e.isUnknownDocument())return de(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:eo(e.version)}}return s}function zh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function eo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function to(n){const e=new Qe(n.seconds,n.nanoseconds);return me.fromTimestamp(e)}function Ri(n,e){const t=(e.baseMutations||[]).map((i=>hm(n.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const s=e.mutations.map((i=>hm(n.yt,i))),r=Qe.fromMillis(e.localWriteTimeMs);return new og(e.batchId,r,t,s)}function Nl(n){const e=to(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?to(n.lastLimboFreeSnapshotVersion):me.min();let s;return s=(function(i){return i.documents!==void 0})(n.query)?(function(i){const o=i.documents.length;return pe(o===1,1966,{count:o}),hn(La(RR(i.documents[0])))})(n.query):(function(i){return hn(kR(i))})(n.query),new $s(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,It.fromBase64String(n.resumeToken))}function MR(n,e){const t=eo(e.snapshotVersion),s=eo(e.lastLimboFreeSnapshotVersion);let r;r=Gh(e.target)?PR(n.yt,e.target):zd(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ji(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function Hd(n){const e=kR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wh(e,e.limit,"L"):e}function Zf(n,e){return new lg(e.largestBatchId,hm(n.yt,e.overlayMutation))}function SI(n,e){const t=e.path.lastSegment();return[n,un(e.path.popLast()),t]}function RI(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:eo(s.readTime),documentKey:un(s.documentKey.path),largestBatchId:s.largestBatchId}}class h2{getBundleMetadata(e,t){return CI(e).get(t).next((s=>{if(s)return(function(i){return{id:i.bundleId,createTime:to(i.createTime),version:i.version}})(s)}))}saveBundleMetadata(e,t){return CI(e).put((function(r){return{bundleId:r.id,createTime:eo(Rt(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return PI(e).get(t).next((s=>{if(s)return(function(i){return{name:i.name,query:Hd(i.bundledQuery),readTime:to(i.readTime)}})(s)}))}saveNamedQuery(e,t){return PI(e).put((function(r){return{name:r.name,readTime:eo(Rt(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function CI(n){return Ft(n,Fd)}function PI(n){return Ft(n,Ud)}class Qd{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new Qd(e,s)}getOverlay(e,t){return gl(e).get(SI(this.userId,t)).next((s=>s?Zf(this.serializer,s):null))}getOverlays(e,t){const s=Es();return D.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){const r=[];return s.forEach(((i,o)=>{const a=new lg(t,o);r.push(this.St(e,a))})),D.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach((o=>r.add(un(o.getCollectionPath()))));const i=[];return r.forEach((o=>{const a=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push(gl(e).Z(Zp,a))})),D.waitFor(i)}getOverlaysForCollection(e,t,s){const r=Es(),i=un(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gl(e).J(Zp,o).next((a=>{for(const l of a){const u=Zf(this.serializer,l);r.set(u.getKey(),u)}return r}))}getOverlaysForCollectionGroup(e,t,s,r){const i=Es();let o;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gl(e).ee({index:xS,range:a},((l,u,h)=>{const d=Zf(this.serializer,u);i.size()<r||d.largestBatchId===o?(i.set(d.getKey(),d),o=d.largestBatchId):h.done()})).next((()=>i))}St(e,t){return gl(e).put((function(r,i,o){const[a,l,u]=SI(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Nc(r.yt,o.mutation)}})(this.serializer,this.userId,t))}}function gl(n){return Ft(n,Bd)}class d2{bt(e){return Ft(e,J_)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?It.fromUint8Array(s):It.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Ci{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(yt(e.integerValue));else if("doubleValue"in e){const s=yt(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),Ec(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=er(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(tr(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?KS(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):jd(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):de(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const r=ma,i=s[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(yt(i)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),ee.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ci.Kt=new Ci;const Ao=255;function f2(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function NI(n){const e=64-(function(s){let r=0;for(let i=0;i<8;++i){const o=f2(255&s[i]);if(r+=o,o!==8)break}return r})(n);return Math.ceil(e/8)}class p2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=NI(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=NI(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Ao),this.sn(255)}_n(){this.an(Ao),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Ao?(this.sn(Ao),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Ao?(this.an(Ao),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class m2{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class _2{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class yl{constructor(){this.cn=new p2,this.ln=new m2(this.cn),this.hn=new _2(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Pi{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Pi(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:rh(this.En),directionalValue:rh(this.dn),orderedDocumentKey:rh(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function yr(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=kI(n.En,e.En),t!==0?t:(t=kI(n.dn,e.dn),t!==0?t:ee.comparator(n.In,e.In)))}function kI(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function rh(n){return cb()?(function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s})(n):n}function xI(n){return typeof n!="string"?n:(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(n)}class DI{constructor(e){this.mn=new Ze(((t,s)=>gt.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(pe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Yp(e);if(t!==void 0&&!this.wn(t))return!1;const s=bi(e);let r=new Set,i=0,o=0;for(;i<s.length&&this.wn(s[i]);++i)r=r.add(s[i].fieldPath.canonicalString());if(i===s.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!r.has(a.field.canonicalString())){const l=s[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<s.length;++i){const a=s[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Ze(gt.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new Ui(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Ui(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Ui(s.field,s.dir==="asc"?0:1)));return new ca(ca.UNKNOWN_ID,this.collectionId,t,ua.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function LR(n){if(pe(n instanceof Le||n instanceof Je,20012),n instanceof Le){if(n instanceof eR){const t=n.value.arrayValue?.values?.map((s=>Le.create(n.field,"==",s)))||[];return Je.create(t,"or")}return n}const e=n.filters.map((t=>LR(t)));return Je.create(e,n.op)}function g2(n){if(n.getFilters().length===0)return[];const e=pm(LR(n));return pe(FR(e),7391),dm(e)||fm(e)?[e]:e.getFilters()}function dm(n){return n instanceof Le}function fm(n){return n instanceof Je&&tg(n)}function FR(n){return dm(n)||fm(n)||(function(t){if(t instanceof Je&&sm(t)){for(const s of t.getFilters())if(!dm(s)&&!fm(s))return!1;return!0}return!1})(n)}function pm(n){if(pe(n instanceof Le||n instanceof Je,34018),n instanceof Le)return n;if(n.filters.length===1)return pm(n.filters[0]);const e=n.filters.map((s=>pm(s)));let t=Je.create(e,n.op);return t=Hh(t),FR(t)?t:(pe(t instanceof Je,64498),pe(ga(t),40251),pe(t.filters.length>1,57927),t.filters.reduce(((s,r)=>hg(s,r))))}function hg(n,e){let t;return pe(n instanceof Le||n instanceof Je,38388),pe(e instanceof Le||e instanceof Je,25473),t=n instanceof Le?e instanceof Le?(function(r,i){return Je.create([r,i],"and")})(n,e):VI(n,e):e instanceof Le?VI(e,n):(function(r,i){if(pe(r.filters.length>0&&i.filters.length>0,48005),ga(r)&&ga(i))return JS(r,i.getFilters());const o=sm(r)?r:i,a=sm(r)?i:r,l=o.filters.map((u=>hg(u,a)));return Je.create(l,"or")})(n,e),Hh(t)}function VI(n,e){if(ga(e))return JS(e,n.getFilters());{const t=e.filters.map((s=>hg(n,s)));return Je.create(t,"or")}}function Hh(n){if(pe(n instanceof Le||n instanceof Je,11850),n instanceof Le)return n;const e=n.getFilters();if(e.length===1)return Hh(e[0]);if(QS(n))return n;const t=e.map((r=>Hh(r))),s=[];return t.forEach((r=>{r instanceof Le?s.push(r):r instanceof Je&&(r.op===n.op?s.push(...r.filters):s.push(r))})),s.length===1?s[0]:Je.create(s,n.op)}class y2{constructor(){this.Cn=new dg}addToCollectionParentIndex(e,t){return this.Cn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Bn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Bn.min())}updateCollectionGroup(e,t,s){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class dg{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ze(Ne.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ze(Ne.comparator)).toArray()}}const OI="IndexedDbIndexManager",ku=new Uint8Array(0);class v2{constructor(e,t){this.databaseId=t,this.vn=new dg,this.Fn=new ar((s=>Ji(s)),((s,r)=>Jc(s,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:s,parent:un(r)};return MI(e).put(i)}return D.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[gS(t),""],!1,!0);return MI(e).J(r).next((i=>{for(const o of i){if(o.collectionId!==t)break;s.push(vs(o.parent))}return s}))}addFieldIndex(e,t){const s=vl(e),r=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete r.indexId;const i=s.add(r);if(t.indexState){const o=Ro(e);return i.next((a=>{o.put(RI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const s=vl(e),r=Ro(e),i=So(e);return s.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=vl(e),s=So(e),r=Ro(e);return t.Z().next((()=>s.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return D.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((r=>{if(r===0||r===1){const i=new DI(s).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const s=So(e);let r=!0;const i=new Map;return D.forEach(this.Mn(t),(o=>this.xn(e,o).next((a=>{r&&(r=!!a),i.set(o,a)})))).next((()=>{if(r){let o=Re();const a=[];return D.forEach(i,((l,u)=>{W(OI,`Using index ${(function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map((k=>`${k.fieldPath}:${k.kind}`)).join(",")}`})(l)} to execute ${Ji(t)}`);const h=(function(N,k){const G=Yp(k);if(G===void 0)return null;for(const J of Kh(N,G.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null})(u,l),d=(function(N,k){const G=new Map;for(const J of bi(k))for(const b of Kh(N,J.fieldPath))switch(b.op){case"==":case"in":G.set(J.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return G.set(J.fieldPath.canonicalString(),b.value),Array.from(G.values())}return null})(u,l),f=(function(N,k){const G=[];let J=!0;for(const b of bi(k)){const v=b.kind===0?fI(N,b.fieldPath,N.startAt):pI(N,b.fieldPath,N.startAt);G.push(v.value),J&&(J=v.inclusive)}return new Xr(G,J)})(u,l),_=(function(N,k){const G=[];let J=!0;for(const b of bi(k)){const v=b.kind===0?pI(N,b.fieldPath,N.endAt):fI(N,b.fieldPath,N.endAt);G.push(v.value),J&&(J=v.inclusive)}return new Xr(G,J)})(u,l),E=this.On(l,u,f),T=this.On(l,u,_),C=this.Nn(l,u,d),L=this.Bn(l.indexId,h,E,f.inclusive,T,_.inclusive,C);return D.forEach(L,(U=>s.Y(U,t.limit).next((N=>{N.forEach((k=>{const G=ee.fromSegments(k.documentKey);o.has(G)||(o=o.add(G),a.push(G))}))}))))})).next((()=>a))}return D.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=g2(Je.create(e.filters,"and")).map((s=>im(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,r,i,o,a){const l=(t!=null?t.length:1)*Math.max(s.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let d=0;d<l;++d){const f=t?this.Ln(t[d/u]):ku,_=this.kn(e,f,s[d%u],r),E=this.qn(e,f,i[d%u],o),T=a.map((C=>this.kn(e,f,C,!0)));h.push(...this.createRange(_,E,T))}return h}kn(e,t,s,r){const i=new Pi(e,ee.empty(),t,s);return r?i:i.An()}qn(e,t,s,r){const i=new Pi(e,ee.empty(),t,s);return r?i.An():i}xn(e,t){const s=new DI(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((i=>{let o=null;for(const a of i)s.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o}))}getIndexType(e,t){let s=2;const r=this.Mn(t);return D.forEach(r,(i=>this.xn(e,i).next((o=>{o?s!==0&&o.fields.length<(function(l){let u=new Ze(gt.comparator),h=!1;for(const d of l.filters)for(const f of d.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?h=!0:u=u.add(f.field));for(const d of l.orderBy)d.field.isKeyField()||(u=u.add(d.field));return u.size+(h?1:0)})(i)&&(s=1):s=0})))).next((()=>(function(o){return o.limit!==null})(t)&&r.length>1&&s===2?1:s))}Qn(e,t){const s=new yl;for(const r of bi(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=s.Pn(r.kind);Ci.Kt.Dt(i,o)}return s.un()}Ln(e){const t=new yl;return Ci.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new yl;return Ci.Kt.Dt(Yi(this.databaseId,t),s.Pn((function(i){const o=bi(i);return o.length===0?0:o[o.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new yl);let i=0;for(const o of bi(e)){const a=s[i++];for(const l of r)if(this.Un(t,o.fieldPath)&&Rc(a))r=this.Kn(r,o,a);else{const u=l.Pn(o.kind);Ci.Kt.Dt(a,u)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const a of r){const l=new yl;l.seed(a.un()),Ci.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find((s=>s instanceof Le&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=vl(e),r=Ro(e);return(t?s.J(Xp,IDBKeyRange.bound(t,t)):s.J()).next((i=>{const o=[];return D.forEach(i,(a=>r.get([a.indexId,this.uid]).next((l=>{o.push((function(h,d){const f=d?new ua(d.sequenceNumber,new Bn(to(d.readTime),new ee(vs(d.documentKey)),d.largestBatchId)):ua.empty(),_=h.fields.map((([E,T])=>new Ui(gt.fromServerFormat(E),T)));return new ca(h.indexId,h.collectionGroup,_,f)})(a,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:Ie(s.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const r=vl(e),i=Ro(e);return this.Gn(e).next((o=>r.J(Xp,IDBKeyRange.bound(t,t)).next((a=>D.forEach(a,(l=>i.put(RI(l.indexId,this.uid,o,s))))))))}updateIndexEntries(e,t){const s=new Map;return D.forEach(t,((r,i)=>{const o=s.get(r.collectionGroup);return(o?D.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next((a=>(s.set(r.collectionGroup,a),D.forEach(a,(l=>this.zn(e,r,l).next((u=>{const h=this.jn(i,l);return u.isEqual(h)?D.resolve():this.Jn(e,i,l,u,h)})))))))}))}Hn(e,t,s,r){return So(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return So(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=So(e);let i=new Ze(yr);return r.ee({index:kS,range:IDBKeyRange.only([s.indexId,this.uid,rh(this.$n(s,t))])},((o,a)=>{i=i.add(new Pi(s.indexId,t,xI(a.arrayValue),xI(a.directionalValue)))})).next((()=>i))}jn(e,t){let s=new Ze(yr);const r=this.Qn(t,e);if(r==null)return s;const i=Yp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Rc(o))for(const a of o.arrayValue.values||[])s=s.add(new Pi(t.indexId,e.key,this.Ln(a),r))}else s=s.add(new Pi(t.indexId,e.key,ku,r));return s}Jn(e,t,s,r,i){W(OI,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,h,d,f){const _=l.getIterator(),E=u.getIterator();let T=bo(_),C=bo(E);for(;T||C;){let L=!1,U=!1;if(T&&C){const N=h(T,C);N<0?U=!0:N>0&&(L=!0)}else T!=null?U=!0:L=!0;L?(d(C),C=bo(E)):U?(f(T),T=bo(_)):(T=bo(_),C=bo(E))}})(r,i,yr,(a=>{o.push(this.Hn(e,t,s,a))}),(a=>{o.push(this.Yn(e,t,s,a))})),D.waitFor(o)}Gn(e){let t=1;return Ro(e).ee({index:NS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,r,i)=>{i.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((o,a)=>yr(o,a))).filter(((o,a,l)=>!a||yr(o,l[a-1])!==0));const r=[];r.push(e);for(const o of s){const a=yr(o,e),l=yr(o,t);if(a===0)r[0]=e.An();else if(a>0&&l<0)r.push(o),r.push(o.An());else if(l>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const a=r[o].Vn(this.uid,ku,ee.empty()),l=r[o+1].Vn(this.uid,ku,ee.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return yr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(LI)}getMinOffset(e,t){return D.mapArray(this.Mn(t),(s=>this.xn(e,s).next((r=>r||de(44426))))).next(LI)}}function MI(n){return Ft(n,wc)}function So(n){return Ft(n,Hl)}function vl(n){return Ft(n,Y_)}function Ro(n){return Ft(n,zl)}function LI(n){pe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;z_(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Bn(e.readTime,e.documentKey,t)}const FI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},UR=41943040;class sn{static withCacheSize(e){return new sn(e,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}function BR(n,e,t){const s=n.store(Qn),r=n.store(ha),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=s.ee({range:o},((h,d,f)=>(a++,f.delete())));i.push(l.next((()=>{pe(a===1,47070,{batchId:t.batchId})})));const u=[];for(const h of t.mutations){const d=RS(e,h.key.path,t.batchId);i.push(r.delete(d)),u.push(h.key)}return D.waitFor(i).next((()=>u))}function Qh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw de(14731);e=n.noDocument}return JSON.stringify(e).length}sn.DEFAULT_COLLECTION_PERCENTILE=10,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sn.DEFAULT=new sn(UR,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sn.DISABLED=new sn(-1,0,0);class Yd{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){pe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Yd(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vr(e).ee({index:Di,range:s},((r,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,s,r){const i=Do(e),o=vr(e);return o.add({}).next((a=>{pe(typeof a=="number",49019);const l=new og(a,t,s,r),u=(function(_,E,T){const C=T.baseMutations.map((U=>Nc(_.yt,U))),L=T.mutations.map((U=>Nc(_.yt,U)));return{userId:E,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:C,mutations:L}})(this.serializer,this.userId,l),h=[];let d=new Ze(((f,_)=>Ie(f.canonicalString(),_.canonicalString())));for(const f of r){const _=RS(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),h.push(o.put(u)),h.push(i.put(_,eF))}return d.forEach((f=>{h.push(this.indexManager.addToCollectionParentIndex(e,f))})),e.addOnCommittedListener((()=>{this.Xn[a]=l.keys()})),D.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return vr(e).get(t).next((s=>s?(pe(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),Ri(this.serializer,s)):null))}er(e,t){return this.Xn[t]?D.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return vr(e).ee({index:Di,range:r},((o,a,l)=>{a.userId===this.userId&&(pe(a.batchId>=s,47524,{tr:s}),i=Ri(this.serializer,a)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=jr;return vr(e).ee({index:Di,range:t,reverse:!0},((r,i,o)=>{s=i.batchId,o.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,jr],[this.userId,Number.POSITIVE_INFINITY]);return vr(e).J(Di,t).next((s=>s.map((r=>Ri(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Ju(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return Do(e).ee({range:r},((o,a,l)=>{const[u,h,d]=o,f=vs(h);if(u===this.userId&&t.path.isEqual(f))return vr(e).get(d).next((_=>{if(!_)throw de(61480,{nr:o,batchId:d});pe(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:d}),i.push(Ri(this.serializer,_))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ze(Ie);const r=[];return t.forEach((i=>{const o=Ju(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Do(e).ee({range:a},((u,h,d)=>{const[f,_,E]=u,T=vs(_);f===this.userId&&i.path.isEqual(T)?s=s.add(E):d.done()}));r.push(l)})),D.waitFor(r).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=Ju(this.userId,s),o=IDBKeyRange.lowerBound(i);let a=new Ze(Ie);return Do(e).ee({range:o},((l,u,h)=>{const[d,f,_]=l,E=vs(f);d===this.userId&&s.isPrefixOf(E)?E.length===r&&(a=a.add(_)):h.done()})).next((()=>this.rr(e,a)))}rr(e,t){const s=[],r=[];return t.forEach((i=>{r.push(vr(e).get(i).next((o=>{if(o===null)throw de(35274,{batchId:i});pe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),s.push(Ri(this.serializer,o))})))})),D.waitFor(r).next((()=>s))}removeMutationBatch(e,t){return BR(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),D.forEach(s,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return D.resolve();const s=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),r=[];return Do(e).ee({range:s},((i,o,a)=>{if(i[0]===this.userId){const l=vs(i[1]);r.push(l)}else a.done()})).next((()=>{pe(r.length===0,56720,{sr:r.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return qR(e,this.userId,t)}_r(e){return $R(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:jr,lastStreamToken:""}))}}function qR(n,e,t){const s=Ju(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Do(n).ee({range:i,X:!0},((a,l,u)=>{const[h,d,f]=a;h===e&&d===r&&(o=!0),u.done()})).next((()=>o))}function vr(n){return Ft(n,Qn)}function Do(n){return Ft(n,ha)}function $R(n){return Ft(n,Ic)}class no{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new no(0)}static cr(){return new no(-1)}}class E2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new no(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>me.fromTimestamp(new Qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Co(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(pe(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let r=0;const i=[];return Co(e).ee(((o,a)=>{const l=Nl(a);l.sequenceNumber<=t&&s.get(l.targetId)===null&&(r++,i.push(this.removeTargetData(e,l)))})).next((()=>D.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Co(e).ee(((s,r)=>{const i=Nl(r);t(i)}))}lr(e){return UI(e).get(jh).next((t=>(pe(t!==null,2888),t)))}hr(e,t){return UI(e).put(jh,t)}Pr(e,t){return Co(e).put(MR(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=Ji(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return Co(e).ee({range:r,index:PS},((o,a,l)=>{const u=Nl(a);Jc(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,s){const r=[],i=Dr(e);return t.forEach((o=>{const a=un(o.path);r.push(i.put({targetId:s,path:a})),r.push(this.referenceDelegate.addReference(e,s,o))})),D.waitFor(r)}removeMatchingKeys(e,t,s){const r=Dr(e);return D.forEach(t,(i=>{const o=un(i.path);return D.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])}))}removeMatchingKeysForTargetId(e,t){const s=Dr(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Dr(e);let i=Re();return r.ee({range:s,X:!0},((o,a,l)=>{const u=vs(o[1]),h=new ee(u);i=i.add(h)})).next((()=>i))}containsKey(e,t){const s=un(t.path),r=IDBKeyRange.bound([s],[gS(s)],!1,!0);let i=0;return Dr(e).ee({index:Q_,X:!0,range:r},(([o,a],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return Co(e).get(t).next((s=>s?Nl(s):null))}}function Co(n){return Ft(n,da)}function UI(n){return Ft(n,Bi)}function Dr(n){return Ft(n,fa)}const BI="LruGarbageCollector",jR=1048576;function qI([n,e],[t,s]){const r=Ie(n,t);return r===0?Ie(e,s):r}class I2{constructor(e){this.Ir=e,this.buffer=new Ze(qI),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();qI(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class GR{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){W(BI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ri(t)?W(BI,"Ignoring IndexedDB error during garbage collection: ",t):await si(t)}await this.Vr(3e5)}))}}class T2{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return D.resolve(bn.ce);const s=new I2(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(W("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(FI)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(W("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),FI):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((d=>(d>this.params.maximumSequenceNumbersToCollect?(W("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r)))).next((d=>(s=d,a=Date.now(),this.removeTargets(e,s,t)))).next((d=>(i=d,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((d=>(u=Date.now(),No()<=De.DEBUG&&W("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:d}))))}}function KR(n,e){return new T2(n,e)}class w2{constructor(e,t){this.db=e,this.garbageCollector=KR(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,r)=>t(r)))}addReference(e,t,s){return xu(e,s)}removeReference(e,t,s){return xu(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return xu(e,t)}br(e,t){return(function(r,i){let o=!1;return $R(r).te((a=>qR(r,a,i).next((l=>(l&&(o=!0),D.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Sr(e,((o,a)=>{if(a<=t){const l=this.br(e,o).next((u=>{if(!u)return i++,s.getEntry(e,o).next((()=>(s.removeEntry(o,me.min()),Dr(e).delete((function(d){return[0,un(d.path)]})(o)))))}));r.push(l)}})).next((()=>D.waitFor(r))).next((()=>s.apply(e))).next((()=>i))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return xu(e,t)}Sr(e,t){const s=Dr(e);let r,i=bn.ce;return s.ee({index:Q_},(([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==bn.ce&&t(new ee(vs(r)),i),i=u,r=l):i=bn.ce})).next((()=>{i!==bn.ce&&t(new ee(vs(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function xu(n,e){return Dr(n).put((function(s,r){return{targetId:0,path:un(s.path),sequenceNumber:r}})(e,n.currentSequenceNumber))}class WR{constructor(){this.changes=new ar((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?D.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class b2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Ei(e).put(s)}removeEntry(e,t,s){return Ei(e).delete((function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],zh(o),a[a.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=_t.newInvalidDocument(t);return Ei(e).ee({index:Xu,range:IDBKeyRange.only(El(t))},((r,i)=>{s=this.Cr(t,i)})).next((()=>s))}vr(e,t){let s={size:0,document:_t.newInvalidDocument(t)};return Ei(e).ee({index:Xu,range:IDBKeyRange.only(El(t))},((r,i)=>{s={document:this.Cr(t,i),size:Qh(i)}})).next((()=>s))}getEntries(e,t){let s=Sn();return this.Fr(e,t,((r,i)=>{const o=this.Cr(r,i);s=s.insert(r,o)})).next((()=>s))}Mr(e,t){let s=Sn(),r=new dt(ee.comparator);return this.Fr(e,t,((i,o)=>{const a=this.Cr(i,o);s=s.insert(i,a),r=r.insert(i,Qh(o))})).next((()=>({documents:s,Or:r})))}Fr(e,t,s){if(t.isEmpty())return D.resolve();let r=new Ze(GI);t.forEach((l=>r=r.add(l)));const i=IDBKeyRange.bound(El(r.first()),El(r.last())),o=r.getIterator();let a=o.getNext();return Ei(e).ee({index:Xu,range:i},((l,u,h)=>{const d=ee.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&GI(a,d)<0;)s(a,null),a=o.getNext();a&&a.isEqual(d)&&(s(a,u),a=o.hasNext()?o.getNext():null),a?h.j(El(a)):h.done()})).next((()=>{for(;a;)s(a,null),a=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,s,r,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),zh(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ei(e).J(IDBKeyRange.bound(a,l,!0)).next((u=>{i?.incrementDocumentReadCount(u.length);let h=Sn();for(const d of u){const f=this.Cr(ee.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(Zc(t,f)||r.has(f.key))&&(h=h.insert(f.key,f))}return h}))}getAllFromCollectionGroup(e,t,s,r){let i=Sn();const o=jI(t,s),a=jI(t,Bn.max());return Ei(e).ee({index:CS,range:IDBKeyRange.bound(o,a,!0)},((l,u,h)=>{const d=this.Cr(ee.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(d.key,d),i.size===r&&h.done()})).next((()=>i))}newChangeBuffer(e){return new A2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return $I(e).get(Jp).next((t=>(pe(!!t,20021),t)))}Dr(e,t){return $I(e).put(Jp,t)}Cr(e,t){if(t){const s=u2(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(me.min())))return s}return _t.newInvalidDocument(e)}}function zR(n){return new b2(n)}class A2 extends WR{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ar((s=>s.toString()),((s,r)=>s.isEqual(r)))}applyChanges(e){const t=[];let s=0,r=new Ze(((i,o)=>Ie(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=AI(this.Nr.serializer,o);r=r.add(i.path.popLast());const u=Qh(l);s+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(s-=a.size,this.trackRemovals){const l=AI(this.Nr.serializer,o.convertToNoDocument(me.min()));t.push(this.Nr.addEntry(e,i,l))}})),r.forEach((i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Nr.updateMetadata(e,s)),D.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:r})=>(r.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:s.get(i).readTime})})),s)))}}function $I(n){return Ft(n,Tc)}function Ei(n){return Ft(n,$h)}function El(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function jI(n,e){const t=e.documentKey.path.toArray();return[n,zh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function GI(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=Ie(t[i],s[i]),r)return r;return r=Ie(t.length,s.length),r||(r=Ie(t[t.length-2],s[s.length-2]),r||Ie(t[t.length-1],s[s.length-1]))}class S2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class HR{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Jl(s.mutation,r,An.empty(),Qe.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Re()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Re()){const r=Es();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=Cl();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=Es();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Re())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,s,r){let i=Sn();const o=Yl(),a=(function(){return Yl()})();return t.forEach(((l,u)=>{const h=s.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof lr)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Jl(h.mutation,u,h.mutation.getFieldMask(),Qe.now())):o.set(u.key,An.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new S2(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const s=Yl();let r=new dt(((o,a)=>o-a)),i=Re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=s.get(l)||An.empty();h=a.applyToLocalView(u,h),s.set(l,h);const d=(r.get(a.batchId)||Re()).add(l);r=r.insert(a.batchId,d)}))})).next((()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=cR();h.forEach((f=>{if(!i.has(f)){const _=_R(t.get(f),s.get(f));_!==null&&d.set(f,_),i=i.add(f)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return D.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return ee.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ng(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):D.resolve(Es());let a=la,l=i;return o.next((u=>D.forEach(u,((h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?D.resolve():this.remoteDocumentCache.getEntry(e,h).next((f=>{l=l.insert(h,f)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Re()))).next((h=>({batchId:a,changes:lR(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ee(t)).next((s=>{let r=Cl();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Cl();return this.indexManager.getCollectionParents(e,i).next((a=>D.forEach(a,(l=>{const u=(function(d,f){return new or(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next((h=>{h.forEach(((d,f)=>{o=o.insert(d,f)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,_t.newInvalidDocument(h)))}));let a=Cl();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&Jl(h.mutation,u,An.empty(),Qe.now()),Zc(t,u)&&(a=a.insert(l,u))})),a}))}}class R2{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return D.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Rt(r.createTime)}})(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:Hd(r.bundledQuery),readTime:Rt(r.readTime)}})(t)),D.resolve()}}class C2{constructor(){this.overlays=new dt(ee.comparator),this.qr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Es();return D.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),D.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),D.resolve()}getOverlaysForCollection(e,t,s){const r=Es(),i=t.length+1,o=new ee(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return D.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new dt(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let h=i.get(u.largestBatchId);h===null&&(h=Es(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Es(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=r)););return D.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new lg(t,s));let i=this.qr.get(t);i===void 0&&(i=Re(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}class P2{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}class fg{constructor(){this.Qr=new Ze(jt.$r),this.Ur=new Ze(jt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new jt(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new jt(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new ee(new Ne([])),s=new jt(t,e),r=new jt(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ee(new Ne([])),s=new jt(t,e),r=new jt(t,e+1);let i=Re();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new jt(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class jt{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ee.comparator(e.key,t.key)||Ie(e.Yr,t.Yr)}static Kr(e,t){return Ie(e.Yr,t.Yr)||ee.comparator(e.key,t.key)}}class N2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ze(jt.$r)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new og(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new jt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return D.resolve(o)}lookupMutationBatch(e,t){return D.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return D.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?jr:this.tr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new jt(t,0),r=new jt(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const a=this.Xr(o.Yr);i.push(a)})),D.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ze(Ie);return t.forEach((r=>{const i=new jt(r,0),o=new jt(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(a=>{s=s.add(a.Yr)}))})),D.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;ee.isDocumentKey(i)||(i=i.child(""));const o=new jt(new ee(i),0);let a=new Ze(Ie);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)}),o),D.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){pe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return D.forEach(t.mutations,(r=>{const i=new jt(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new jt(t,0),r=this.Zr.firstAfterOrEqual(s);return D.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class k2{constructor(e){this.ri=e,this.docs=(function(){return new dt(ee.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return D.resolve(s?s.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let s=Sn();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():_t.newInvalidDocument(r))})),D.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=Sn();const o=t.path,a=new ee(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||z_(TS(h),s)<=0||(r.has(h.key)||Zc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return D.resolve(i)}getAllFromCollectionGroup(e,t,s,r){de(9500)}ii(e,t){return D.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new x2(this)}getSize(e){return D.resolve(this.size)}}class x2 extends WR{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),D.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class D2{constructor(e){this.persistence=e,this.si=new ar((t=>Ji(t)),Jc),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.oi=0,this._i=new fg,this.targetCount=0,this.ai=no.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),D.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new no(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Pr(t),D.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),D.waitFor(i).next((()=>r))}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return D.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),D.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),D.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return D.resolve(s)}containsKey(e,t){return D.resolve(this._i.containsKey(t))}}class pg{constructor(e,t){this.ui={},this.overlays={},this.ci=new bn(0),this.li=!1,this.li=!0,this.hi=new P2,this.referenceDelegate=e(this),this.Pi=new D2(this),this.indexManager=new y2,this.remoteDocumentCache=(function(r){return new k2(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new OR(t),this.Ii=new R2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new C2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new N2(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){W("MemoryPersistence","Starting transaction:",e);const r=new V2(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return D.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class V2 extends bS{constructor(e){super(),this.currentSequenceNumber=e}}class Jd{constructor(e){this.persistence=e,this.Ri=new fg,this.Vi=null}static mi(e){return new Jd(e)}get fi(){if(this.Vi)return this.Vi;throw de(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),D.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.fi,(s=>{const r=ee.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,me.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Yh{constructor(e,t){this.persistence=e,this.pi=new ar((s=>un(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=KR(this,t)}static mi(e,t){return new Yh(e,t)}Ei(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return D.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?D.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((a=>{a||(s++,i.removeEntry(o,me.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=eh(e.data.value)),t}br(e,t,s){return D.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return D.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class O2{constructor(e){this.serializer=e}k(e,t,s,r){const i=new Ld("createOrUpgrade",t);s<1&&r>=1&&((function(l){l.createObjectStore(Yc)})(e),(function(l){l.createObjectStore(Ic,{keyPath:ZL}),l.createObjectStore(Qn,{keyPath:tI,autoIncrement:!0}).createIndex(Di,nI,{unique:!0}),l.createObjectStore(ha)})(e),KI(e),(function(l){l.createObjectStore(Ai)})(e));let o=D.resolve();return s<3&&r>=3&&(s!==0&&((function(l){l.deleteObjectStore(fa),l.deleteObjectStore(da),l.deleteObjectStore(Bi)})(e),KI(e)),o=o.next((()=>(function(l){const u=l.store(Bi),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0};return u.put(jh,h)})(i)))),s<4&&r>=4&&(s!==0&&(o=o.next((()=>(function(l,u){return u.store(Qn).J().next((d=>{l.deleteObjectStore(Qn),l.createObjectStore(Qn,{keyPath:tI,autoIncrement:!0}).createIndex(Di,nI,{unique:!0});const f=u.store(Qn),_=d.map((E=>f.put(E)));return D.waitFor(_)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(pa,{keyPath:lF})})(e)}))),s<5&&r>=5&&(o=o.next((()=>this.yi(i)))),s<6&&r>=6&&(o=o.next((()=>((function(l){l.createObjectStore(Tc)})(e),this.wi(i))))),s<7&&r>=7&&(o=o.next((()=>this.Si(i)))),s<8&&r>=8&&(o=o.next((()=>this.bi(e,i)))),s<9&&r>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&r>=10&&(o=o.next((()=>this.Di(i)))),s<11&&r>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(Fd,{keyPath:cF})})(e),(function(l){l.createObjectStore(Ud,{keyPath:uF})})(e)}))),s<12&&r>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(Bd,{keyPath:gF});u.createIndex(Zp,yF,{unique:!1}),u.createIndex(xS,vF,{unique:!1})})(e)}))),s<13&&r>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore($h,{keyPath:tF});u.createIndex(Xu,nF),u.createIndex(CS,sF)})(e))).next((()=>this.Ci(e,i))).next((()=>e.deleteObjectStore(Ai)))),s<14&&r>=14&&(o=o.next((()=>this.Fi(e,i)))),s<15&&r>=15&&(o=o.next((()=>(function(l){l.createObjectStore(Y_,{keyPath:hF,autoIncrement:!0}).createIndex(Xp,dF,{unique:!1}),l.createObjectStore(zl,{keyPath:fF}).createIndex(NS,pF,{unique:!1}),l.createObjectStore(Hl,{keyPath:mF}).createIndex(kS,_F,{unique:!1})})(e)))),s<16&&r>=16&&(o=o.next((()=>{t.objectStore(zl).clear()})).next((()=>{t.objectStore(Hl).clear()}))),s<17&&r>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(J_,{keyPath:EF})})(e)}))),s<18&&r>=18&&cb()&&(o=o.next((()=>{t.objectStore(zl).clear()})).next((()=>{t.objectStore(Hl).clear()}))),o}wi(e){let t=0;return e.store(Ai).ee(((s,r)=>{t+=Qh(r)})).next((()=>{const s={byteSize:t};return e.store(Tc).put(Jp,s)}))}yi(e){const t=e.store(Ic),s=e.store(Qn);return t.J().next((r=>D.forEach(r,(i=>{const o=IDBKeyRange.bound([i.userId,jr],[i.userId,i.lastAcknowledgedBatchId]);return s.J(Di,o).next((a=>D.forEach(a,(l=>{pe(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=Ri(this.serializer,l);return BR(e,i.userId,u).next((()=>{}))}))))}))))}Si(e){const t=e.store(fa),s=e.store(Ai);return e.store(Bi).get(jh).next((r=>{const i=[];return s.ee(((o,a)=>{const l=new Ne(o),u=(function(d){return[0,un(d)]})(l);i.push(t.get(u).next((h=>h?D.resolve():(d=>t.put({targetId:0,path:un(d),sequenceNumber:r.highestListenSequenceNumber}))(l))))})).next((()=>D.waitFor(i)))}))}bi(e,t){e.createObjectStore(wc,{keyPath:aF});const s=t.store(wc),r=new dg,i=o=>{if(r.add(o)){const a=o.lastSegment(),l=o.popLast();return s.put({collectionId:a,parent:un(l)})}};return t.store(Ai).ee({X:!0},((o,a)=>{const l=new Ne(o);return i(l.popLast())})).next((()=>t.store(ha).ee({X:!0},(([o,a,l],u)=>{const h=vs(a);return i(h.popLast())}))))}Di(e){const t=e.store(da);return t.ee(((s,r)=>{const i=Nl(r),o=MR(this.serializer,i);return t.put(o)}))}Ci(e,t){const s=t.store(Ai),r=[];return s.ee(((i,o)=>{const a=t.store($h),l=(function(d){return d.document?new ee(Ne.fromString(d.document.name).popFirst(5)):d.noDocument?ee.fromSegments(d.noDocument.path):d.unknownDocument?ee.fromSegments(d.unknownDocument.path):de(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))})).next((()=>D.waitFor(r)))}Fi(e,t){const s=t.store(Qn),r=zR(this.serializer),i=new pg(Jd.mi,this.serializer.yt);return s.J().next((o=>{const a=new Map;return o.forEach((l=>{let u=a.get(l.userId)??Re();Ri(this.serializer,l).keys().forEach((h=>u=u.add(h))),a.set(l.userId,u)})),D.forEach(a,((l,u)=>{const h=new Gt(u),d=Qd.wt(this.serializer,h),f=i.getIndexManager(h),_=Yd.wt(h,this.serializer,f,i.referenceDelegate);return new HR(r,_,d,f).recalculateAndSaveOverlaysForDocumentKeys(new em(t,bn.ce),l).next()}))}))}}function KI(n){n.createObjectStore(fa,{keyPath:iF}).createIndex(Q_,oF,{unique:!0}),n.createObjectStore(da,{keyPath:"targetId"}).createIndex(PS,rF,{unique:!0}),n.createObjectStore(Bi)}const Er="IndexedDbPersistence",ep=18e5,tp=5e3,np="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",QR="main";class mg{constructor(e,t,s,r,i,o,a,l,u,h,d=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=d,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=f=>Promise.resolve(),!mg.v())throw new B(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new w2(this,r),this.$i=t+QR,this.serializer=new OR(l),this.Ui=new As(this.$i,this.Ni,new O2(this.serializer)),this.hi=new d2,this.Pi=new E2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=zR(this.serializer),this.Ii=new h2,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&St(Er,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,np);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new bn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Du(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(ri(e))return W(Er,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return W(Er,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Il(e).get(wo).next((t=>D.resolve(this.es(t))))}ts(e){return Du(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,ep)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=Ft(t,pa);return s.J().next((r=>{const i=this.ss(r,ep),o=r.filter((a=>i.indexOf(a)===-1));return D.forEach(o,(a=>s.delete(a.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?D.resolve(!0):Il(e).get(wo).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,tp)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,np);return!1}}return!(!this.networkEnabled||!this.inForeground)||Du(e).J().next((s=>this.ss(s,tp).find((r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(i||o&&a)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&W(Er,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Yc,pa],(e=>{const t=new em(e,bn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Du(e).J().next((t=>this.ss(t,ep).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Yd.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new v2(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Qd.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){W(Er,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?wF:l===17?MS:l===16?TF:l===15?X_:l===14?OS:l===13?VS:l===12?IF:l===11?DS:void de(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,r,i,(a=>(o=new em(a,this.ci?this.ci.next():bn.ce),t==="readwrite-primary"?this.Hi(o).next((l=>!!l||this.Yi(o))).next((l=>{if(!l)throw St(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new B(M.FAILED_PRECONDITION,wS);return s(o)})).next((l=>this.Xi(o).next((()=>l)))):this.Is(o).next((()=>s(o)))))).then((a=>(o.raiseOnCommittedEvent(),a)))}Is(e){return Il(e).get(wo).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,tp)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(M.FAILED_PRECONDITION,np)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Il(e).put(wo,t)}static v(){return As.v()}Zi(e){const t=Il(e);return t.get(wo).next((s=>this.es(s)?(W(Er,"Releasing primary lease."),t.delete(wo)):D.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(St(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;lb()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return W(Er,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return St(Er,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){St("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Il(n){return Ft(n,Yc)}function Du(n){return Ft(n,pa)}function _g(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class gg{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Re(),r=Re();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new gg(e,t.fromCache,s,r)}}class M2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class YR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return lb()?8:AS(Mt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new M2;return this.Ss(e,t,o).next((a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(No()<=De.DEBUG&&W("QueryEngine","SDK will not create cache indexes for query:",ko(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),D.resolve()):(No()<=De.DEBUG&&W("QueryEngine","Query:",ko(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(No()<=De.DEBUG&&W("QueryEngine","The SDK decides to create cache indexes for query:",ko(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hn(t))):D.resolve())}ys(e,t){if(mI(t))return D.resolve(null);let s=hn(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Wh(t,null,"F"),s=hn(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=Re(...i);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,s).next((l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,Wh(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,s,r){return mI(t)||r.isEqual(me.min())?D.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?D.resolve(null):(No()<=De.DEBUG&&W("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ko(t)),this.vs(e,o,t,IS(r,la)).next((a=>a)))}))}Ds(e,t){let s=new Ze(oR(e));return t.forEach(((r,i)=>{Zc(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return No()<=De.DEBUG&&W("QueryEngine","Using full collection scan to execute query:",ko(t)),this.ps.getDocumentsMatchingQuery(e,t,Bn.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const yg="LocalStore",L2=3e8;class F2{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new dt(Ie),this.xs=new ar((i=>Ji(i)),Jc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new HR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function JR(n,e,t,s){return new F2(n,e,t,s)}async function XR(n,e){const t=te(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],a=[];let l=Re();for(const u of r){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function U2(n,e){const t=te(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const d=u.batch,f=d.keys();let _=D.resolve();return f.forEach((E=>{_=_.next((()=>h.getEntry(l,E))).next((T=>{const C=u.docVersions.get(E);pe(C!==null,48541),T.version.compareTo(C)<0&&(d.applyToRemoteDocument(T,u),T.isValidDocument()&&(T.setReadTime(u.commitVersion),h.addEntry(T)))}))})),_.next((()=>a.mutationQueue.removeMutationBatch(l,d)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let l=Re();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function ZR(n){const e=te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function B2(n,e){const t=te(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach(((h,d)=>{const f=r.get(d);if(!f)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,d).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,d))));let _=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?_=_.withResumeToken(It.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,s)),r=r.insert(d,_),(function(T,C,L){return T.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=L2?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(f,_,h)&&a.push(t.Pi.updateTargetData(i,_))}));let l=Sn(),u=Re();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(eC(i,o,e.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!s.isEqual(me.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((d=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));a.push(h)}return D.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function eC(n,e,t){let s=Re(),r=Re();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=Sn();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):W(yg,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:r}}))}function q2(n,e){const t=te(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=jr),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function Ia(n,e){const t=te(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,D.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new $s(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Ta(n,e,t){const s=te(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!ri(o))throw o;W(yg,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Jh(n,e,t){const s=te(n);let r=me.min(),i=Re();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const d=te(l),f=d.xs.get(h);return f!==void 0?D.resolve(d.Ms.get(f)):d.Pi.getTargetData(u,h)})(s,o,hn(e)).next((a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:me.min(),t?i:Re()))).next((a=>(sC(s,iR(e),a),{documents:a,Qs:i})))))}function tC(n,e){const t=te(n),s=te(t.Pi),r=t.Ms.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",(i=>s.At(i,e).next((o=>o?o.target:null))))}function nC(n,e){const t=te(n),s=t.Os.get(e)||me.min();return t.persistence.runTransaction("Get new document changes","readonly",(r=>t.Ns.getAllFromCollectionGroup(r,e,IS(s,la),Number.MAX_SAFE_INTEGER))).then((r=>(sC(t,e,r),r)))}function sC(n,e,t){let s=n.Os.get(e)||me.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}async function $2(n,e,t,s){const r=te(n);let i=Re(),o=Sn();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const d=e.Us(u);d.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,d)}const a=r.Ns.newChangeBuffer({trackRemovals:!0}),l=await Ia(r,(function(h){return hn(La(Ne.fromString(`__bundle__/docs/${h}`)))})(s));return r.persistence.runTransaction("Apply bundle documents","readwrite",(u=>eC(u,a,o).next((h=>(a.apply(u),h))).next((h=>r.Pi.removeMatchingKeysForTargetId(u,l.targetId).next((()=>r.Pi.addMatchingKeys(u,i,l.targetId))).next((()=>r.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs))).next((()=>h.ks))))))}async function j2(n,e,t=Re()){const s=await Ia(n,hn(Hd(e.bundledQuery))),r=te(n);return r.persistence.runTransaction("Save named query","readwrite",(i=>{const o=Rt(e.readTime);if(s.snapshotVersion.compareTo(o)>=0)return r.Ii.saveNamedQuery(i,e);const a=s.withResumeToken(It.EMPTY_BYTE_STRING,o);return r.Ms=r.Ms.insert(a.targetId,a),r.Pi.updateTargetData(i,a).next((()=>r.Pi.removeMatchingKeysForTargetId(i,s.targetId))).next((()=>r.Pi.addMatchingKeys(i,t,s.targetId))).next((()=>r.Ii.saveNamedQuery(i,e)))}))}const rC="firestore_clients";function WI(n,e){return`${rC}_${n}_${e}`}const iC="firestore_mutations";function zI(n,e,t){let s=`${iC}_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const oC="firestore_targets";function sp(n,e){return`${oC}_${n}_${e}`}const gs="SharedClientState";class Xh{constructor(e,t,s,r){this.user=e,this.batchId=t,this.state=s,this.error=r}static Ws(e,t,s){const r=JSON.parse(s);let i,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(i=new B(r.error.code,r.error.message))),o?new Xh(e,t,r.state,i):(St(gs,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xl{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let r,i=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return i&&s.error&&(i=typeof s.error.message=="string"&&typeof s.error.code=="string",i&&(r=new B(s.error.code,s.error.message))),i?new Xl(e,s.state,r):(St(gs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let r=typeof s=="object"&&s.activeTargetIds instanceof Array,i=sg();for(let o=0;r&&o<s.activeTargetIds.length;++o)r=SS(s.activeTargetIds[o]),i=i.add(s.activeTargetIds[o]);return r?new Zh(e,i):(St(gs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class vg{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new vg(t.clientId,t.onlineState):(St(gs,`Failed to parse online state: ${e}`),null)}}class mm{constructor(){this.activeTargetIds=sg()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rp{constructor(e,t,s,r,i){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new dt(Ie),this.started=!1,this.Xs=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=WI(this.persistenceKey,this.Js),this.no=(function(l){return`firestore_sequence_number_${l}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new mm),this.ro=new RegExp(`^${rC}_${o}_([^_]*)$`),this.io=new RegExp(`^${iC}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${oC}_${o}_(\\d+)$`),this.oo=(function(l){return`firestore_online_state_${l}`})(this.persistenceKey),this._o=(function(l){return`firestore_bundle_loaded_v2_${l}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const r=this.getItem(WI(this.persistenceKey,s));if(r){const i=Zh.Ws(s,r);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((s,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(sp(this.persistenceKey,e));if(r){const i=Xl.Ws(e,r);i&&(s=i.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(sp(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach((r=>{this.Po(r)})),this.currentUser=e,s.forEach((r=>{this.addPendingMutation(r)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return W(gs,"READ",e,t),t}setItem(e,t){W(gs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){W(gs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(W(gs,"EVENT",t.key,t.newValue),t.key===this.eo)return void St("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=(function(i){let o=bn.ce;if(i!=null)try{const a=JSON.parse(i);pe(typeof a=="number",30636,{So:i}),o=a}catch(a){St(gs,"Failed to read sequence number from WebStorage",a)}return o})(t.newValue);s!==bn.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map((r=>this.syncEngine.Do(r))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const r=new Xh(this.currentUser,e,t,s),i=zI(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){const t=zI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const r=sp(this.persistenceKey,e),i=new Xl(e,t,s);this.setItem(r,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return Zh.Ws(s,t)}fo(e,t){const s=this.io.exec(e),r=Number(s[1]),i=s[2]!==void 0?s[2]:null;return Xh.Ws(new Gt(i),r,t)}yo(e,t){const s=this.so.exec(e),r=Number(s[1]);return Xl.Ws(r,t)}uo(e){return vg.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);W(gs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(s),o=[],a=[];return i.forEach((l=>{r.has(l)||o.push(l)})),r.forEach((l=>{i.has(l)||a.push(l)})),this.syncEngine.Fo(o,a).then((()=>{this.Zs=s}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=sg();return e.forEach(((s,r)=>{t=t.unionWith(r.activeTargetIds)})),t}}class aC{constructor(){this.Mo=new mm,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new mm,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class G2{Oo(e){}shutdown(){}}const HI="ConnectivityMonitor";class QI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){W(HI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){W(HI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Vu=null;function _m(){return Vu===null?Vu=(function(){return 268435456+Math.round(2147483648*Math.random())})():Vu++,"0x"+Vu.toString(16)}const ip="RestConnection",K2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class W2{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Ac?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=_m(),a=this.zo(e,t.toUriEncodedString());W(ip,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),h=sr(u);return this.Jo(e,a,l,s,h).then((d=>(W(ip,`Received RPC '${e}' ${o}: `,d),d)),(d=>{throw Un(ip,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",s),d}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ma})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=K2[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class z2{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const tn="WebChannelConnection";class H2 extends W2{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=_m();return new Promise(((a,l)=>{const u=new cS;u.setWithCredentials(!0),u.listenOnce(uS.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case Yu.NO_ERROR:const d=u.getResponseJson();W(tn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case Yu.TIMEOUT:W(tn,`RPC '${e}' ${o} timed out`),l(new B(M.DEADLINE_EXCEEDED,"Request time out"));break;case Yu.HTTP_ERROR:const f=u.getStatus();if(W(tn,`RPC '${e}' ${o} failed with status:`,f,"response text:",u.getResponseText()),f>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const E=_?.error;if(E&&E.status&&E.message){const T=(function(L){const U=L.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(U)>=0?U:M.UNKNOWN})(E.status);l(new B(T,E.message))}else l(new B(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(M.UNAVAILABLE,"Connection failed."));break;default:de(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{W(tn,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);W(tn,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=_m(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=fS(),a=dS(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");W(tn,`Creating RPC '${e}' stream ${r}: ${h}`,l);const d=o.createWebChannel(h,l);this.I_(d);let f=!1,_=!1;const E=new z2({Yo:C=>{_?W(tn,`Not sending because RPC '${e}' stream ${r} is closed:`,C):(f||(W(tn,`Opening RPC '${e}' stream ${r} transport.`),d.open(),f=!0),W(tn,`RPC '${e}' stream ${r} sending:`,C),d.send(C))},Zo:()=>d.close()}),T=(C,L,U)=>{C.listen(L,(N=>{try{U(N)}catch(k){setTimeout((()=>{throw k}),0)}}))};return T(d,Rl.EventType.OPEN,(()=>{_||(W(tn,`RPC '${e}' stream ${r} transport opened.`),E.o_())})),T(d,Rl.EventType.CLOSE,(()=>{_||(_=!0,W(tn,`RPC '${e}' stream ${r} transport closed`),E.a_(),this.E_(d))})),T(d,Rl.EventType.ERROR,(C=>{_||(_=!0,Un(tn,`RPC '${e}' stream ${r} transport errored. Name:`,C.name,"Message:",C.message),E.a_(new B(M.UNAVAILABLE,"The operation could not be completed")))})),T(d,Rl.EventType.MESSAGE,(C=>{if(!_){const L=C.data[0];pe(!!L,16349);const U=L,N=U?.error||U[0]?.error;if(N){W(tn,`RPC '${e}' stream ${r} received error:`,N);const k=N.status;let G=(function(v){const A=Pt[v];if(A!==void 0)return ER(A)})(k),J=N.message;G===void 0&&(G=M.INTERNAL,J="Unknown error status: "+k+" with message "+N.message),_=!0,E.a_(new B(G,J)),d.close()}else W(tn,`RPC '${e}' stream ${r} received:`,L),E.u_(L)}})),T(a,hS.STAT_EVENT,(C=>{C.stat===Wp.PROXY?W(tn,`RPC '${e}' stream ${r} detected buffering proxy`):C.stat===Wp.NOPROXY&&W(tn,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function lC(){return typeof window<"u"?window:null}function ih(){return typeof document<"u"?document:null}function ho(n){return new e2(n,!0)}class Eg{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&W("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const YI="PersistentStream";class cC{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Eg(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(St(t.toString()),St("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new B(M.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return W(YI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(W(YI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Q2 extends cC{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=s2(this.serializer,e),s=(function(i){if(!("targetChange"in i))return me.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?me.min():o.readTime?Rt(o.readTime):me.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=um(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=Gh(l)?{documents:PR(i,l)}:{query:zd(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=bR(i,o.resumeToken);const u=lm(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(me.min())>0){a.readTime=Ea(i,o.snapshotVersion.toTimestamp());const u=lm(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const s=i2(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=um(this.serializer),t.removeTarget=e,this.q_(t)}}class Y2 extends cC{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return pe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,pe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){pe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=r2(e.writeResults,e.commitTime),s=Rt(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=um(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>Nc(this.serializer,s)))};this.q_(t)}}class J2{}class X2 extends J2{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,cm(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(M.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,cm(t,s),r,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(M.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Z2{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(St(t),this.aa=!1):W("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const so="RemoteStore";class eU{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{oi(this)&&(W(so,"Restarting streams for network reachability change."),await(async function(l){const u=te(l);u.Ea.add(4),await Ba(u),u.Ra.set("Unknown"),u.Ea.delete(4),await su(u)})(this))}))})),this.Ra=new Z2(s,r)}}async function su(n){if(oi(n))for(const e of n.da)await e(!0)}async function Ba(n){for(const e of n.da)await e(!1)}function Xd(n,e){const t=te(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),wg(t)?Tg(t):$a(t).O_()&&Ig(t,e))}function wa(n,e){const t=te(n),s=$a(t);t.Ia.delete(e),s.O_()&&uC(t,e),t.Ia.size===0&&(s.O_()?s.L_():oi(t)&&t.Ra.set("Unknown"))}function Ig(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$a(n).Y_(e)}function uC(n,e){n.Va.Ue(e),$a(n).Z_(e)}function Tg(n){n.Va=new YF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),$a(n).start(),n.Ra.ua()}function wg(n){return oi(n)&&!$a(n).x_()&&n.Ia.size>0}function oi(n){return te(n).Ea.size===0}function hC(n){n.Va=void 0}async function tU(n){n.Ra.set("Online")}async function nU(n){n.Ia.forEach(((e,t)=>{Ig(n,e)}))}async function sU(n,e){hC(n),wg(n)?(n.Ra.ha(e),Tg(n)):n.Ra.set("Unknown")}async function rU(n,e,t){if(n.Ra.set("Online"),e instanceof wR&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))})(n,e)}catch(s){W(so,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await ed(n,s)}else if(e instanceof sh?n.Va.Ze(e):e instanceof TR?n.Va.st(e):n.Va.tt(e),!t.isEqual(me.min()))try{const s=await ZR(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(It.EMPTY_BYTE_STRING,h.snapshotVersion)),uC(i,l);const d=new $s(h.target,l,u,h.sequenceNumber);Ig(i,d)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(s){W(so,"Failed to raise snapshot:",s),await ed(n,s)}}async function ed(n,e,t){if(!ri(e))throw e;n.Ea.add(1),await Ba(n),n.Ra.set("Offline"),t||(t=()=>ZR(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{W(so,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await su(n)}))}function dC(n,e){return e().catch((t=>ed(n,t,e)))}async function qa(n){const e=te(n),t=Zr(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:jr;for(;iU(e);)try{const r=await q2(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,oU(e,r)}catch(r){await ed(e,r)}fC(e)&&pC(e)}function iU(n){return oi(n)&&n.Ta.length<10}function oU(n,e){n.Ta.push(e);const t=Zr(n);t.O_()&&t.X_&&t.ea(e.mutations)}function fC(n){return oi(n)&&!Zr(n).x_()&&n.Ta.length>0}function pC(n){Zr(n).start()}async function aU(n){Zr(n).ra()}async function lU(n){const e=Zr(n);for(const t of n.Ta)e.ea(t.mutations)}async function cU(n,e,t){const s=n.Ta.shift(),r=ag.from(s,e,t);await dC(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await qa(n)}async function uU(n,e){e&&Zr(n).X_&&await(async function(s,r){if((function(o){return vR(o)&&o!==M.ABORTED})(r.code)){const i=s.Ta.shift();Zr(s).B_(),await dC(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await qa(s)}})(n,e),fC(n)&&pC(n)}async function JI(n,e){const t=te(n);t.asyncQueue.verifyOperationInProgress(),W(so,"RemoteStore received new credentials");const s=oi(t);t.Ea.add(3),await Ba(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await su(t)}async function gm(n,e){const t=te(n);e?(t.Ea.delete(2),await su(t)):e||(t.Ea.add(2),await Ba(t),t.Ra.set("Unknown"))}function $a(n){return n.ma||(n.ma=(function(t,s,r){const i=te(t);return i.sa(),new Q2(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:tU.bind(null,n),t_:nU.bind(null,n),r_:sU.bind(null,n),H_:rU.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),wg(n)?Tg(n):n.Ra.set("Unknown")):(await n.ma.stop(),hC(n))}))),n.ma}function Zr(n){return n.fa||(n.fa=(function(t,s,r){const i=te(t);return i.sa(),new Y2(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:aU.bind(null,n),r_:uU.bind(null,n),ta:lU.bind(null,n),na:cU.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await qa(n)):(await n.fa.stop(),n.Ta.length>0&&(W(so,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class bg{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Wt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new bg(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ja(n,e){if(St("AsyncQueue",`${e}: ${n}`),ri(n))return new B(M.UNAVAILABLE,`${e}: ${n}`);throw n}class qi{static emptySet(e){return new qi(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||ee.comparator(t.key,s.key):(t,s)=>ee.comparator(t.key,s.key),this.keyedMap=Cl(),this.sortedSet=new dt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new qi;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class XI{constructor(){this.ga=new dt(ee.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):de(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class ro{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new ro(e,t,qi.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class hU{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class dU{constructor(){this.queries=ZI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=te(t),i=r.queries;r.queries=ZI(),i.forEach(((o,a)=>{for(const l of a.Sa)l.onError(s)}))})(this,new B(M.ABORTED,"Firestore shutting down"))}}function ZI(){return new ar((n=>rR(n)),Xc)}async function Ag(n,e){const t=te(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new hU,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=ja(o,`Initialization of query '${ko(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Rg(t)}async function Sg(n,e){const t=te(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function fU(n,e){const t=te(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&Rg(t)}function pU(n,e,t){const s=te(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function Rg(n){n.Ca.forEach((e=>{e.next()}))}var ym,eT;(eT=ym||(ym={})).Ma="default",eT.Cache="cache";class Cg{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new ro(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ro.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ym.Cache}}class mC{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class tT{constructor(e){this.serializer=e}$s(e){return Ss(this.serializer,e)}Us(e){return e.metadata.exists?Wd(this.serializer,e.document,!1):_t.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Rt(e)}}class Pg{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=_C(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const s=Ne.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(s.get(s.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,s=new tT(this.serializer);for(const r of e)if(r.metadata.queries){const i=s.$s(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||Re()).add(i);t.set(o,a)}}return t}async ja(e){const t=await $2(e,new tT(this.serializer),this.Wa,this.Ua.id),s=this.za(this.documents);for(const r of this.Ka)await j2(e,r,s.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function _C(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class gC{constructor(e){this.key=e}}class yC{constructor(e){this.key=e}}class vC{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Re(),this.mutatedKeys=Re(),this.eu=oR(e),this.tu=new qi(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new XI,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,d)=>{const f=r.get(h),_=Zc(this.query,d)?d:null,E=!!f&&this.mutatedKeys.has(f.key),T=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let C=!1;f&&_?f.data.isEqual(_.data)?E!==T&&(s.track({type:3,doc:_}),C=!0):this.su(f,_)||(s.track({type:2,doc:_}),C=!0,(l&&this.eu(_,l)>0||u&&this.eu(_,u)<0)&&(a=!0)):!f&&_?(s.track({type:0,doc:_}),C=!0):f&&!_&&(s.track({type:1,doc:f}),C=!0,(l||u)&&(a=!0)),C&&(_?(o=o.add(_),i=T?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,d)=>(function(_,E){const T=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de(20277,{Rt:C})}};return T(_)-T(E)})(h.type,d.type)||this.eu(h.doc,d.doc))),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new ro(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new XI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Re(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new yC(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new gC(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Re();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ro.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ai="SyncEngine";class mU{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class _U{constructor(e){this.key=e,this.hu=!1}}class gU{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ar((a=>rR(a)),Xc),this.Iu=new Map,this.Eu=new Set,this.du=new dt(ee.comparator),this.Au=new Map,this.Ru=new fg,this.Vu={},this.mu=new Map,this.fu=no.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function yU(n,e,t=!0){const s=Zd(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await EC(s,e,t,!0),r}async function vU(n,e){const t=Zd(n);await EC(t,e,!0,!1)}async function EC(n,e,t,s){const r=await Ia(n.localStore,hn(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await Ng(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Xd(n.remoteStore,r),a}async function Ng(n,e,t,s,r){n.pu=(d,f,_)=>(async function(T,C,L,U){let N=C.view.ru(L);N.Cs&&(N=await Jh(T.localStore,C.query,!1).then((({documents:b})=>C.view.ru(b,N))));const k=U&&U.targetChanges.get(C.targetId),G=U&&U.targetMismatches.get(C.targetId)!=null,J=C.view.applyChanges(N,T.isPrimaryClient,k,G);return vm(T,C.targetId,J.au),J.snapshot})(n,d,f,_);const i=await Jh(n.localStore,e,!0),o=new vC(e,i.Qs),a=o.ru(i.documents),l=nu.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);vm(n,t,u.au);const h=new mU(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function EU(n,e,t){const s=te(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Xc(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Ta(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&wa(s.remoteStore,r.targetId),ba(s,r.targetId)})).catch(si)):(ba(s,r.targetId),await Ta(s.localStore,r.targetId,!0))}async function IU(n,e){const t=te(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),wa(t.remoteStore,s.targetId))}async function TU(n,e,t){const s=Vg(n);try{const r=await(function(o,a){const l=te(o),u=Qe.now(),h=a.reduce(((_,E)=>_.add(E.key)),Re());let d,f;return l.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let E=Sn(),T=Re();return l.Ns.getEntries(_,h).next((C=>{E=C,E.forEach(((L,U)=>{U.isValidDocument()||(T=T.add(L))}))})).next((()=>l.localDocuments.getOverlayedDocuments(_,E))).next((C=>{d=C;const L=[];for(const U of a){const N=zF(U,d.get(U.key).overlayedDocument);N!=null&&L.push(new lr(U.key,N,zS(N.value.mapValue),vt.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,L,a)})).next((C=>{f=C;const L=C.applyToLocalDocumentSet(d,T);return l.documentOverlayCache.saveOverlays(_,C.batchId,L)}))})).then((()=>({batchId:f.batchId,changes:lR(d)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new dt(Ie)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(s,r.batchId,t),await cr(s,r.changes),await qa(s.remoteStore)}catch(r){const i=ja(r,"Failed to persist write");t.reject(i)}}async function IC(n,e){const t=te(n);try{const s=await B2(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(pe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?pe(o.hu,14607):r.removedDocuments.size>0&&(pe(o.hu,42227),o.hu=!1))})),await cr(t,s,e)}catch(s){await si(s)}}function nT(n,e,t){const s=te(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)})),(function(o,a){const l=te(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,d)=>{for(const f of d.Sa)f.va(a)&&(u=!0)})),u&&Rg(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function wU(n,e,t){const s=te(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new dt(ee.comparator);o=o.insert(i,_t.newNoDocument(i,me.min()));const a=Re().add(i),l=new tu(me.min(),new Map,new dt(Ie),o,a);await IC(s,l),s.du=s.du.remove(i),s.Au.delete(e),Dg(s)}else await Ta(s.localStore,e,!1).then((()=>ba(s,e,t))).catch(si)}async function bU(n,e){const t=te(n),s=e.batch.batchId;try{const r=await U2(t.localStore,e);xg(t,s,null),kg(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await cr(t,r)}catch(r){await si(r)}}async function AU(n,e,t){const s=te(n);try{const r=await(function(o,a){const l=te(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((d=>(pe(d!==null,37113),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(s.localStore,e);xg(s,e,t),kg(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await cr(s,r)}catch(r){await si(r)}}async function SU(n,e){const t=te(n);oi(t.remoteStore)||W(ai,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await(function(o){const a=te(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l)))})(t.localStore);if(s===jr)return void e.resolve();const r=t.mu.get(s)||[];r.push(e),t.mu.set(s,r)}catch(s){const r=ja(s,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}function kg(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function xg(n,e,t){const s=te(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function ba(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||TC(n,s)}))}function TC(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(wa(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Dg(n))}function vm(n,e,t){for(const s of t)s instanceof gC?(n.Ru.addReference(s.key,e),RU(n,s)):s instanceof yC?(W(ai,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||TC(n,s.key)):de(19791,{wu:s})}function RU(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(W(ai,"New document in limbo: "+t),n.Eu.add(s),Dg(n))}function Dg(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ee(Ne.fromString(e)),s=n.fu.next();n.Au.set(s,new _U(t)),n.du=n.du.insert(t,s),Xd(n.remoteStore,new $s(hn(La(t.path)),s,"TargetPurposeLimboResolution",bn.ce))}}async function cr(n,e,t){const s=te(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,l)=>{o.push(s.pu(l,e,t).then((u=>{if((u||t)&&s.isPrimaryClient){const h=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=gg.As(l.targetId,u);i.push(h)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(l,u){const h=te(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(d=>D.forEach(u,(f=>D.forEach(f.Es,(_=>h.persistence.referenceDelegate.addReference(d,f.targetId,_))).next((()=>D.forEach(f.ds,(_=>h.persistence.referenceDelegate.removeReference(d,f.targetId,_)))))))))}catch(d){if(!ri(d))throw d;W(yg,"Failed to update sequence numbers: "+d)}for(const d of u){const f=d.targetId;if(!d.fromCache){const _=h.Ms.get(f),E=_.snapshotVersion,T=_.withLastLimboFreeSnapshotVersion(E);h.Ms=h.Ms.insert(f,T)}}})(s.localStore,i))}async function CU(n,e){const t=te(n);if(!t.currentUser.isEqual(e)){W(ai,"User change. New user:",e.toKey());const s=await XR(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new B(M.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await cr(t,s.Ls)}}function PU(n,e){const t=te(n),s=t.Au.get(e);if(s&&s.hu)return Re().add(s.key);{let r=Re();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}async function NU(n,e){const t=te(n),s=await Jh(t.localStore,e.query,!0),r=e.view.cu(s);return t.isPrimaryClient&&vm(t,e.targetId,r.au),r}async function kU(n,e){const t=te(n);return nC(t.localStore,e).then((s=>cr(t,s)))}async function xU(n,e,t,s){const r=te(n),i=await(function(a,l){const u=te(a),h=te(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",(d=>h.er(d,l).next((f=>f?u.localDocuments.getDocuments(d,f):D.resolve(null)))))})(r.localStore,e);i!==null?(t==="pending"?await qa(r.remoteStore):t==="acknowledged"||t==="rejected"?(xg(r,e,s||null),kg(r,e),(function(a,l){te(te(a).mutationQueue).ir(l)})(r.localStore,e)):de(6720,"Unknown batchState",{Su:t}),await cr(r,i)):W(ai,"Cannot apply mutation batch with id: "+e)}async function DU(n,e){const t=te(n);if(Zd(t),Vg(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),r=await sT(t,s.toArray());t.gu=!0,await gm(t.remoteStore,!0);for(const i of r)Xd(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const s=[];let r=Promise.resolve();t.Iu.forEach(((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):r=r.then((()=>(ba(t,o),Ta(t.localStore,o,!0)))),wa(t.remoteStore,o)})),await r,await sT(t,s),(function(o){const a=te(o);a.Au.forEach(((l,u)=>{wa(a.remoteStore,u)})),a.Ru.Jr(),a.Au=new Map,a.du=new dt(ee.comparator)})(t),t.gu=!1,await gm(t.remoteStore,!1)}}async function sT(n,e,t){const s=te(n),r=[],i=[];for(const o of e){let a;const l=s.Iu.get(o);if(l&&l.length!==0){a=await Ia(s.localStore,hn(l[0]));for(const u of l){const h=s.Tu.get(u),d=await NU(s,h);d.snapshot&&i.push(d.snapshot)}}else{const u=await tC(s.localStore,o);a=await Ia(s.localStore,u),await Ng(s,wC(u),o,!1,a.resumeToken)}r.push(a)}return s.Pu.H_(i),r}function wC(n){return tR(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function VU(n){return(function(t){return te(te(t).persistence).Ts()})(te(n).localStore)}async function OU(n,e,t,s){const r=te(n);if(r.gu)return void W(ai,"Ignoring unexpected query state notification.");const i=r.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await nC(r.localStore,iR(i[0])),a=tu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",It.EMPTY_BYTE_STRING);await cr(r,o,a);break}case"rejected":await Ta(r.localStore,e,!0),ba(r,e,s);break;default:de(64155,t)}}async function MU(n,e,t){const s=Zd(n);if(s.gu){for(const r of e){if(s.Iu.has(r)&&s.sharedClientState.isActiveQueryTarget(r)){W(ai,"Adding an already active target "+r);continue}const i=await tC(s.localStore,r),o=await Ia(s.localStore,i);await Ng(s,wC(i),o.targetId,!1,o.resumeToken),Xd(s.remoteStore,o)}for(const r of t)s.Iu.has(r)&&await Ta(s.localStore,r,!1).then((()=>{wa(s.remoteStore,r),ba(s,r)})).catch(si)}}function Zd(n){const e=te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=IC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=PU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wU.bind(null,e),e.Pu.H_=fU.bind(null,e.eventManager),e.Pu.yu=pU.bind(null,e.eventManager),e}function Vg(n){const e=te(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=AU.bind(null,e),e}function LU(n,e,t){const s=te(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await(function(_,E){const T=te(_),C=Rt(E.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",(L=>T.Ii.getBundleMetadata(L,E.id))).then((L=>!!L&&L.createTime.compareTo(C)>=0))})(i.localStore,l))return await o.close(),a._completeWith((function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}})(l)),Promise.resolve(new Set);a._updateProgress(_C(l));const u=new Pg(l,o.serializer);let h=await o.bu();for(;h;){const f=await u.Ga(h);f&&a._updateProgress(f),h=await o.bu()}const d=await u.ja(i.localStore);return await cr(i,d.Ha,void 0),await(function(_,E){const T=te(_);return T.persistence.runTransaction("Save bundle","readwrite",(C=>T.Ii.saveBundleMetadata(C,E)))})(i.localStore,l),a._completeWith(d.progress),Promise.resolve(d.Ja)}catch(l){return Un(ai,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(s,e,t).then((r=>{s.sharedClientState.notifyBundleLoaded(r)}))}class Aa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ho(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return JR(this.persistence,new YR,e.initialUser,this.serializer)}Cu(e){return new pg(Jd.mi,this.serializer)}Du(e){return new aC}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Aa.provider={build:()=>new Aa};class Og extends Aa{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){pe(this.persistence.referenceDelegate instanceof Yh,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new GR(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new pg((s=>Yh.mi(s,t)),this.serializer)}}class Mg extends Aa{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Vg(this.xu.syncEngine),await qa(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return JR(this.persistence,new YR,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new GR(s,e.asyncQueue,t)}Mu(e,t){const s=new JL(t,this.persistence);return new YL(e.asyncQueue,s)}Cu(e){const t=_g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new mg(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,lC(),ih(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new aC}}class bC extends Mg{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof rp&&(this.sharedClientState.syncEngine={Co:xU.bind(null,t),vo:OU.bind(null,t),Fo:MU.bind(null,t),Ts:VU.bind(null,t),Do:kU.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async s=>{await DU(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())}))}Du(e){const t=lC();if(!rp.v(t))throw new B(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=_g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rp(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class ei{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>nT(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=CU.bind(null,this.syncEngine),await gm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new dU})()}createDatastore(e){const t=ho(e.databaseInfo.databaseId),s=(function(i){return new H2(i)})(e.databaseInfo);return(function(i,o,a,l){return new X2(i,o,a,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,a){return new eU(s,r,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>nT(this.syncEngine,t,0)),(function(){return QI.v()?new QI:new G2})())}createSyncEngine(e,t){return(function(r,i,o,a,l,u,h){const d=new gU(r,i,o,a,l,u);return h&&(d.gu=!0),d})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=te(t);W(so,"RemoteStore shutting down."),s.Ea.add(5),await Ba(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ei.provider={build:()=>new ei};function rT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class ef{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):St("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class FU{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Wt,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((s=>{s&&s.$a()?this.metadata.resolve(s.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(s?.Qa)}`))}),(s=>this.metadata.reject(s)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),s=Number(t);isNaN(s)&&this.Qu(`length string (${t}) is not valid number`);const r=await this.$u(s);return new mC(JSON.parse(r),e.length+s)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class UU{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let s=this.bu();if(!s||!s.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(s?.Qa)}`);this.metadata=s;do s=this.bu(),s!==null&&this.elements.push(s);while(s!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new mC(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}class BU{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(r,i){const o=te(r),a={documents:i.map((d=>Pc(o.serializer,d)))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ne.emptyPath(),a,i.length),u=new Map;l.forEach((d=>{const f=n2(o.serializer,d);u.set(f.key.toString(),f)}));const h=[];return i.forEach((d=>{const f=u.get(d.toString());pe(!!f,55234,{key:d}),h.push(f)})),h})(this.datastore,e);return t.forEach((s=>this.recordVersion(s))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ua(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,s)=>{const r=ee.fromPath(s);this.mutations.push(new ig(r,this.precondition(r)))})),await(async function(s,r){const i=te(s),o={writes:r.map((a=>Nc(i.serializer,a)))};await i.Go("Commit",i.serializer.databaseId,Ne.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw de(50498,{Gu:e.constructor.name});t=me.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new B(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(me.min())?vt.exists(!1):vt.updateTime(t):vt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(me.min()))throw new B(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vt.updateTime(t)}return vt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class qU{constructor(e,t,s,r,i){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=i,this.zu=s.maxAttempts,this.M_=new Eg(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new BU(this.datastore),t=this.Hu(e);t&&t.then((s=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(s)})).catch((r=>{this.Yu(r)}))))})).catch((s=>{this.Yu(s)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Qc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vR(t)}return!1}}const ti="FirestoreClient";class $U{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Gt.UNAUTHENTICATED,this.clientId=Od.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{W(ti,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(W(ti,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=ja(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function op(n,e){n.asyncQueue.verifyOperationInProgress(),W(ti,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await XR(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function iT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Lg(n);W(ti,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>JI(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>JI(e.remoteStore,r))),n._onlineComponents=e}async function Lg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){W(ti,"Using user provided OfflineComponentProvider");try{await op(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===M.FAILED_PRECONDITION||r.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Un("Error using user provided cache. Falling back to memory cache: "+t),await op(n,new Aa)}}else W(ti,"Using default OfflineComponentProvider"),await op(n,new Og(void 0));return n._offlineComponents}async function tf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(W(ti,"Using user provided OnlineComponentProvider"),await iT(n,n._uninitializedComponentsProvider._online)):(W(ti,"Using default OnlineComponentProvider"),await iT(n,new ei))),n._onlineComponents}function AC(n){return Lg(n).then((e=>e.persistence))}function Ga(n){return Lg(n).then((e=>e.localStore))}function SC(n){return tf(n).then((e=>e.remoteStore))}function Fg(n){return tf(n).then((e=>e.syncEngine))}function RC(n){return tf(n).then((e=>e.datastore))}async function Sa(n){const e=await tf(n),t=e.eventManager;return t.onListen=yU.bind(null,e.syncEngine),t.onUnlisten=EU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=IU.bind(null,e.syncEngine),t}function jU(n){return n.asyncQueue.enqueue((async()=>{const e=await AC(n),t=await SC(n);return e.setNetworkEnabled(!0),(function(r){const i=te(r);return i.Ea.delete(0),su(i)})(t)}))}function GU(n){return n.asyncQueue.enqueue((async()=>{const e=await AC(n),t=await SC(n);return e.setNetworkEnabled(!1),(async function(r){const i=te(r);i.Ea.add(0),await Ba(i),i.Ra.set("Offline")})(t)}))}function KU(n,e){const t=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await(function(u,h){const d=te(u);return d.persistence.runTransaction("read document","readonly",(f=>d.localDocuments.getDocument(f,h)))})(r,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=ja(a,`Failed to get document '${i} from cache`);o.reject(l)}})(await Ga(n),e,t))),t.promise}function CC(n,e,t={}){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new ef({next:f=>{h.Nu(),o.enqueueAndForget((()=>Sg(i,d)));const _=f.docs.has(a);!_&&f.fromCache?u.reject(new B(M.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&f.fromCache&&l&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new Cg(La(a.path),h,{includeMetadataChanges:!0,qa:!0});return Ag(i,d)})(await Sa(n),n.asyncQueue,e,t,s))),s.promise}function WU(n,e){const t=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await Jh(r,i,!0),l=new vC(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=ja(a,`Failed to execute query '${i} against cache`);o.reject(l)}})(await Ga(n),e,t))),t.promise}function PC(n,e,t={}){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new ef({next:f=>{h.Nu(),o.enqueueAndForget((()=>Sg(i,d))),f.fromCache&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),d=new Cg(a,h,{includeMetadataChanges:!0,qa:!0});return Ag(i,d)})(await Sa(n),n.asyncQueue,e,t,s))),s.promise}function zU(n,e,t){const s=new Wt;return n.asyncQueue.enqueueAndForget((async()=>{try{const r=await RC(n);s.resolve((async function(o,a,l){const u=te(o),{request:h,gt:d,parent:f}=NR(u.serializer,nR(a),l);u.connection.$o||delete h.parent;const _=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,f,h,1)).filter((T=>!!T.result));pe(_.length===1,64727);const E=_[0].result?.aggregateFields;return Object.keys(E).reduce(((T,C)=>(T[d[C]]=E[C],T)),{})})(r,e,t))}catch(r){s.reject(r)}})),s.promise}function HU(n,e){const t=new ef(e);return n.asyncQueue.enqueueAndForget((async()=>(function(r,i){te(r).Ca.add(i),i.next()})(await Sa(n),t))),()=>{t.Nu(),n.asyncQueue.enqueueAndForget((async()=>(function(r,i){te(r).Ca.delete(i)})(await Sa(n),t)))}}function QU(n,e,t,s){const r=(function(o,a){let l;return l=typeof o=="string"?IR().encode(o):o,(function(h,d){return new FU(h,d)})((function(h,d){if(h instanceof Uint8Array)return rT(h,d);if(h instanceof ArrayBuffer)return rT(new Uint8Array(h),d);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(l),a)})(t,ho(e));n.asyncQueue.enqueueAndForget((async()=>{LU(await Fg(n),r,s)}))}function YU(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){const i=te(s);return i.persistence.runTransaction("Get named query","readonly",(o=>i.Ii.getNamedQuery(o,r)))})(await Ga(n),e)))}function NC(n,e){return(function(s,r){return new UU(s,r)})(n,e)}function JU(n,e){return n.asyncQueue.enqueue((async()=>(async function(s,r){const i=te(s),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",(l=>o.getFieldIndexes(l).next((u=>(function(d,f,_,E,T){d=[...d],f=[...f],d.sort(_),f.sort(_);const C=d.length,L=f.length;let U=0,N=0;for(;U<L&&N<C;){const k=_(d[N],f[U]);k<0?T(d[N++]):k>0?E(f[U++]):(U++,N++)}for(;U<L;)E(f[U++]);for(;N<C;)T(d[N++])})(u,r,WL,(h=>{a.push(o.addFieldIndex(l,h))}),(h=>{a.push(o.deleteFieldIndex(l,h))})))).next((()=>D.waitFor(a)))))})(await Ga(n),e)))}function XU(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){te(s).Fs.Vs=r})(await Ga(n),e)))}function ZU(n){return n.asyncQueue.enqueue((async()=>(function(t){const s=te(t),r=s.indexManager;return s.persistence.runTransaction("Delete All Indexes","readwrite",(i=>r.deleteAllFieldIndexes(i)))})(await Ga(n))))}function kC(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const oT=new Map;const xC="firestore.googleapis.com",aT=!0;class lT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=xC,this.ssl=aT}else this.host=e.host,this.ssl=e.ssl??aT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=UR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<jR)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}yS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kC(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ru{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new _S;switch(s.type){case"firstParty":return new UL(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new B(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=oT.get(t);s&&(W("ComponentProvider","Removing Datastore"),oT.delete(t),s.terminate())})(this),Promise.resolve()}}function DC(n,e,t,s={}){n=ke(n,ru);const r=sr(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(Td(`https://${a}`),n_("Firestore",!0)),i.host!==xC&&i.host!==a&&Un("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!Wn(l,o)&&(n._setSettings(l),s.mockUserToken)){let u,h;if(typeof s.mockUserToken=="string")u=s.mockUserToken,h=Gt.MOCK_USER;else{u=ib(s.mockUserToken,n._app?.options.projectId);const d=s.mockUserToken.sub||s.mockUserToken.user_id;if(!d)throw new B(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Gt(d)}n._authCredentials=new ML(new mS(u,h))}}class Lt{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Lt(this.firestore,e,this._query)}}class Xe{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xe(this.firestore,e,this._key)}toJSON(){return{type:Xe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(uo(t,Xe._jsonSchema))return new Xe(e,s||null,new ee(Ne.fromString(t.referencePath)))}}Xe._jsonSchemaVersion="firestore/documentReference/1.0",Xe._jsonSchema={type:Nt("string",Xe._jsonSchemaVersion),referencePath:Nt("string")};class is extends Lt{constructor(e,t,s){super(e,t,La(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xe(this.firestore,null,new ee(e))}withConverter(e){return new is(this.firestore,e,this._path)}}function e4(n,e,...t){if(n=je(n),W_("collection","path",e),n instanceof ru){const s=Ne.fromString(e,...t);return YE(s),new is(n,null,s)}{if(!(n instanceof Xe||n instanceof is))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ne.fromString(e,...t));return YE(s),new is(n.firestore,null,s)}}function t4(n,e){if(n=ke(n,ru),W_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Lt(n,null,(function(s){return new or(Ne.emptyPath(),s)})(e))}function Ug(n,e,...t){if(n=je(n),arguments.length===1&&(e=Od.newId()),W_("doc","path",e),n instanceof ru){const s=Ne.fromString(e,...t);return QE(s),new Xe(n,null,new ee(s))}{if(!(n instanceof Xe||n instanceof is))throw new B(M.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ne.fromString(e,...t));return QE(s),new Xe(n.firestore,n instanceof is?n.converter:null,new ee(s))}}function n4(n,e){return n=je(n),e=je(e),(n instanceof Xe||n instanceof is)&&(e instanceof Xe||e instanceof is)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Bg(n,e){return n=je(n),e=je(e),n instanceof Lt&&e instanceof Lt&&n.firestore===e.firestore&&Xc(n._query,e._query)&&n.converter===e.converter}const cT="AsyncQueue";class uT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Eg(this,"async_queue_retry"),this._c=()=>{const s=ih();s&&W(cT,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=ih();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ih();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Wt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ri(e))throw e;W(cT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,St("INTERNAL UNHANDLED ERROR: ",hT(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=bg.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&de(47125,{Pc:hT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function hT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Qo(n){return(function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1})(n,["next","error","complete"])}class VC{constructor(){this._progressObserver={},this._taskCompletionResolver=new Wt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,s){this._progressObserver={next:e,error:t,complete:s}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const s4=-1;class tt extends ru{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new uT,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new uT(e),this._firestoreClient=void 0,await e}}}function Em(n,e,t){t||(t=Ac);const s=xa(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),i=s.getOptions(t);if(Wn(i,e))return r;throw new B(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<jR)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&sr(e.host)&&Td(e.host),s.initialize({options:e,instanceIdentifier:t})}function oh(n,e){const t=typeof n=="object"?n:i_(),s=typeof n=="string"?n:e||Ac,r=xa(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=nb("firestore");i&&DC(r,...i)}return r}function Et(n){if(n._terminated)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||OC(n),n._firestoreClient}function OC(n){const e=n._freezeSettings(),t=(function(r,i,o,a){return new SF(r,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,kC(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new $U(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}function ah(n,e){Un("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return MC(n,ei.provider,{build:s=>new Mg(s,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function Im(n){Un("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();MC(n,ei.provider,{build:t=>new bC(t,e.cacheSizeBytes)})}function MC(n,e,t){if((n=ke(n,tt))._firestoreClient||n._terminated)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(M.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},OC(n)}function r4(n){if(n._initialized&&!n._terminated)throw new B(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Wt;return n._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(s){if(!As.v())return Promise.resolve();const r=s+QR;await As.delete(r)})(_g(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function i4(n){return(function(t){const s=new Wt;return t.asyncQueue.enqueueAndForget((async()=>SU(await Fg(t),s))),s.promise})(Et(n=ke(n,tt)))}function o4(n){return jU(Et(n=ke(n,tt)))}function a4(n){return GU(Et(n=ke(n,tt)))}function l4(n){return ax(n.app,"firestore",n._databaseId.database),n._delete()}function Tm(n,e){const t=Et(n=ke(n,tt)),s=new VC;return QU(t,n._databaseId,e,s),s}function LC(n,e){return YU(Et(n=ke(n,tt)),e).then((t=>t?new Lt(n,null,t.query):null))}class Ra{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class FC{constructor(e,t,s){this._userDataWriter=t,this._data=s,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class Tn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Tn(It.fromBase64String(e))}catch(t){throw new B(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Tn(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Tn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(uo(e,Tn._jsonSchema))return Tn.fromBase64String(e.bytes)}}Tn._jsonSchemaVersion="firestore/bytes/1.0",Tn._jsonSchema={type:Nt("string",Tn._jsonSchemaVersion),bytes:Nt("string")};class li{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function c4(){return new li(Qp)}class ci{constructor(e){this._methodName=e}}class os{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ie(this._lat,e._lat)||Ie(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:os._jsonSchemaVersion}}static fromJSON(e){if(uo(e,os._jsonSchema))return new os(e.latitude,e.longitude)}}os._jsonSchemaVersion="firestore/geoPoint/1.0",os._jsonSchema={type:Nt("string",os._jsonSchemaVersion),latitude:Nt("number"),longitude:Nt("number")};class Gn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(uo(e,Gn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Gn(e.vectorValues);throw new B(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gn._jsonSchemaVersion="firestore/vectorValue/1.0",Gn._jsonSchema={type:Nt("string",Gn._jsonSchemaVersion),vectorValues:Nt("object")};const u4=/^__.*__$/;class h4{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new lr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fa(e,this.data,t,this.fieldTransforms)}}class UC{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new lr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function BC(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de(40011,{Ac:n})}}class nf{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new nf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return td(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(BC(this.Ac)&&u4.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class d4{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||ho(e)}Cc(e,t,s,r=!1){return new nf({Ac:e,methodName:t,Dc:s,path:gt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fo(n){const e=n._freezeSettings(),t=ho(n._databaseId);return new d4(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sf(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);zg("Data must be an object, but it was:",o,s);const a=jC(s,o);let l,u;if(i.merge)l=new An(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const f=kc(e,d,t);if(!o.contains(f))throw new B(M.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);KC(h,f)||h.push(f)}l=new An(h),u=o.fieldTransforms.filter((d=>l.covers(d.field)))}else l=null,u=o.fieldTransforms;return new h4(new Yt(a),l,u)}class iu extends ci{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof iu}}function qC(n,e,t){return new nf({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class qg extends ci{_toFieldTransform(e){return new eu(e.path,new ya)}isEqual(e){return e instanceof qg}}class $g extends ci{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=qC(this,e,!0),s=this.vc.map((i=>po(i,t))),r=new Xi(s);return new eu(e.path,r)}isEqual(e){return e instanceof $g&&Wn(this.vc,e.vc)}}class jg extends ci{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=qC(this,e,!0),s=this.vc.map((i=>po(i,t))),r=new Zi(s);return new eu(e.path,r)}isEqual(e){return e instanceof jg&&Wn(this.vc,e.vc)}}class Gg extends ci{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new va(e.serializer,hR(e.serializer,this.Fc));return new eu(e.path,t)}isEqual(e){return e instanceof Gg&&this.Fc===e.Fc}}function Kg(n,e,t,s){const r=n.Cc(1,e,t);zg("Data must be an object, but it was:",r,s);const i=[],o=Yt.empty();ii(s,((l,u)=>{const h=rf(e,l,t);u=je(u);const d=r.yc(h);if(u instanceof iu)i.push(h);else{const f=po(u,d);f!=null&&(i.push(h),o.set(h,f))}}));const a=new An(i);return new UC(o,a,r.fieldTransforms)}function Wg(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[kc(e,s,t)],l=[r];if(i.length%2!=0)throw new B(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(kc(e,i[f])),l.push(i[f+1]);const u=[],h=Yt.empty();for(let f=a.length-1;f>=0;--f)if(!KC(u,a[f])){const _=a[f];let E=l[f];E=je(E);const T=o.yc(_);if(E instanceof iu)u.push(_);else{const C=po(E,T);C!=null&&(u.push(_),h.set(_,C))}}const d=new An(u);return new UC(h,d,o.fieldTransforms)}function $C(n,e,t,s=!1){return po(t,n.Cc(s?4:3,e))}function po(n,e){if(GC(n=je(n)))return zg("Unsupported field value:",e,n),jC(n,e);if(n instanceof ci)return(function(s,r){if(!BC(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const a of s){let l=po(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=je(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return hR(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Qe.fromDate(s);return{timestampValue:Ea(r.serializer,i)}}if(s instanceof Qe){const i=new Qe(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ea(r.serializer,i)}}if(s instanceof os)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Tn)return{bytesValue:bR(r.serializer,s._byteString)};if(s instanceof Xe){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ug(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Gn)return(function(o,a){return{mapValue:{fields:{[Z_]:{stringValue:eg},[ma]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return rg(a.serializer,u)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${Md(s)}`)})(n,e)}function jC(n,e){const t={};return FS(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ii(n,((s,r)=>{const i=po(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function GC(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Qe||n instanceof os||n instanceof Tn||n instanceof Xe||n instanceof ci||n instanceof Gn)}function zg(n,e,t){if(!GC(t)||!vS(t)){const s=Md(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function kc(n,e,t){if((e=je(e))instanceof li)return e._internalPath;if(typeof e=="string")return rf(n,e);throw td("Field path arguments must be of type string or ",n,!1,void 0,t)}const f4=new RegExp("[~\\*/\\[\\]]");function rf(n,e,t){if(e.search(f4)>=0)throw td(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new li(...e.split("."))._internalPath}catch{throw td(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function td(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new B(M.INVALID_ARGUMENT,a+n+l)}function KC(n,e){return n.some((t=>t.isEqual(e)))}class xc{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new p4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(of("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class p4 extends xc{data(){return super.data()}}function of(n,e){return typeof e=="string"?rf(n,e):e instanceof li?e._internalPath:e._delegate._internalPath}function WC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hg{}class Ka extends Hg{}function m4(n,e,...t){let s=[];e instanceof Hg&&s.push(e),s=s.concat(t),(function(i){const o=i.filter((l=>l instanceof mo)).length,a=i.filter((l=>l instanceof Wa)).length;if(o>1||o>0&&a>0)throw new B(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class Wa extends Ka{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Wa(e,t,s)}_apply(e){const t=this._parse(e);return HC(e._query,t),new Lt(e.firestore,e.converter,om(e._query,t))}_parse(e){const t=fo(e.firestore);return(function(i,o,a,l,u,h,d){let f;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){fT(d,h);const E=[];for(const T of d)E.push(dT(l,i,T));f={arrayValue:{values:E}}}else f=dT(l,i,d)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||fT(d,h),f=$C(a,o,d,h==="in"||h==="not-in");return Le.create(u,h,f)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function _4(n,e,t){const s=e,r=of("where",n);return Wa._create(r,s,t)}class mo extends Hg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new mo(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Je.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)HC(o,l),o=om(o,l)})(e._query,t),new Lt(e.firestore,e.converter,om(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function g4(...n){return n.forEach((e=>QC("or",e))),mo._create("or",n)}function y4(...n){return n.forEach((e=>QC("and",e))),mo._create("and",n)}class af extends Ka{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new af(e,t)}_apply(e){const t=(function(r,i,o){if(r.startAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Cc(i,o)})(e._query,this._field,this._direction);return new Lt(e.firestore,e.converter,(function(r,i){const o=r.explicitOrderBy.concat([i]);return new or(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function v4(n,e="asc"){const t=e,s=of("orderBy",n);return af._create(s,t)}class ou extends Ka{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new ou(e,t,s)}_apply(e){return new Lt(e.firestore,e.converter,Wh(e._query,this._limit,this._limitType))}}function E4(n){return ES("limit",n),ou._create("limit",n,"F")}function I4(n){return ES("limitToLast",n),ou._create("limitToLast",n,"L")}class au extends Ka{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new au(e,t,s)}_apply(e){const t=zC(e,this.type,this._docOrFields,this._inclusive);return new Lt(e.firestore,e.converter,(function(r,i){return new or(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)})(e._query,t))}}function T4(...n){return au._create("startAt",n,!0)}function w4(...n){return au._create("startAfter",n,!1)}class lu extends Ka{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new lu(e,t,s)}_apply(e){const t=zC(e,this.type,this._docOrFields,this._inclusive);return new Lt(e.firestore,e.converter,(function(r,i){return new or(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)})(e._query,t))}}function b4(...n){return lu._create("endBefore",n,!1)}function A4(...n){return lu._create("endAt",n,!0)}function zC(n,e,t,s){if(t[0]=je(t[0]),t[0]instanceof xc)return(function(i,o,a,l,u){if(!l)throw new B(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const d of Ho(i))if(d.field.isKeyField())h.push(Yi(o,l.key));else{const f=l.data.field(d.field);if(qd(f))throw new B(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(f===null){const _=d.field.canonicalString();throw new B(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(f)}return new Xr(h,u)})(n._query,n.firestore._databaseId,e,t[0]._document,s);{const r=fo(n.firestore);return(function(o,a,l,u,h,d){const f=o.explicitOrderBy;if(h.length>f.length)throw new B(M.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let E=0;E<h.length;E++){const T=h[E];if(f[E].field.isKeyField()){if(typeof T!="string")throw new B(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof T}`);if(!ng(o)&&T.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${T}' contains a slash.`);const C=o.path.child(Ne.fromString(T));if(!ee.isDocumentKey(C))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const L=new ee(C);_.push(Yi(a,L))}else{const C=$C(l,u,T);_.push(C)}}return new Xr(_,d)})(n._query,n.firestore._databaseId,r,e,t,s)}}function dT(n,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new B(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ng(e)&&t.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Ne.fromString(t));if(!ee.isDocumentKey(s))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Yi(n,new ee(s))}if(t instanceof Xe)return Yi(n,t._key);throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Md(t)}.`)}function fT(n,e){if(!Array.isArray(n)||n.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HC(n,e){const t=(function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function QC(n,e){if(!(e instanceof Wa||e instanceof mo))throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Qg{convertValue(e,t="none"){switch(Yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw de(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return ii(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[ma].arrayValue?.values?.map((s=>yt(s.doubleValue)));return new Gn(t)}convertGeoPoint(e){return new os(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=$d(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(bc(e));default:return null}}convertTimestamp(e){const t=er(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Ne.fromString(e);pe(VR(s),9688,{name:e});const r=new Qr(s.get(1),s.get(3)),i=new ee(s.popFirst(5));return r.isEqual(t)||St(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function lf(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Yg extends Qg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xe(this.firestore,null,t)}}function S4(n){return new Ra("sum",kc("sum",n))}function R4(n){return new Ra("avg",kc("average",n))}function YC(){return new Ra("count")}function C4(n,e){return n instanceof Ra&&e instanceof Ra&&n.aggregateType===e.aggregateType&&n._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function P4(n,e){return Bg(n.query,e.query)&&Wn(n.data(),e.data())}const JC="NOT SUPPORTED";class js{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rn extends xc{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(of("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Rn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function N4(n,e,t){if(uo(e,Rn._jsonSchema)){if(e.bundle===JC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=ho(n._databaseId),r=NC(e.bundle,s),i=r.Wu(),o=new Pg(r.getMetadata(),s);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Wd(s,a[0].document),u=new ee(Ne.fromString(e.bundleName));return new Rn(n,new Yg(n),u,l,new js(!1,!1),t||null)}}Rn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rn._jsonSchema={type:Nt("string",Rn._jsonSchemaVersion),bundleSource:Nt("string","DocumentSnapshot"),bundleName:Nt("string"),bundle:Nt("string")};class Zl extends Rn{data(e={}){return super.data(e)}}class Cn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new js(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Zl(this._firestore,this._userDataWriter,s.key,s,new js(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((a=>{const l=new Zl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new js(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new Zl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new js(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:x4(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Cn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Od.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function k4(n,e,t){if(uo(e,Cn._jsonSchema)){if(e.bundle===JC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=ho(n._databaseId),r=NC(e.bundle,s),i=r.Wu(),o=new Pg(r.getMetadata(),s);for(const f of i)o.Ga(f);if(o.queries.length!==1)throw new B(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Hd(o.queries[0].bundledQuery),l=o.documents;let u=new qi;l.map((f=>{const _=Wd(s,f.document);u=u.add(_)}));const h=ro.fromInitialDocuments(a,u,Re(),!1,!1),d=new Lt(n,t||null,a);return new Cn(n,new Yg(n),d,h)}}function x4(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de(61501,{type:n})}}function D4(n,e){return n instanceof Rn&&e instanceof Rn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Cn&&e instanceof Cn&&n._firestore===e._firestore&&Bg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function XC(n){n=ke(n,Xe);const e=ke(n.firestore,tt);return CC(Et(e),n._key).then((t=>Jg(e,n,t)))}Cn._jsonSchemaVersion="firestore/querySnapshot/1.0",Cn._jsonSchema={type:Nt("string",Cn._jsonSchemaVersion),bundleSource:Nt("string","QuerySnapshot"),bundleName:Nt("string"),bundle:Nt("string")};class ui extends Qg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xe(this.firestore,null,t)}}function V4(n){n=ke(n,Xe);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return KU(t,n._key).then((r=>new Rn(e,s,n._key,r,new js(r!==null&&r.hasLocalMutations,!0),n.converter)))}function O4(n){n=ke(n,Xe);const e=ke(n.firestore,tt);return CC(Et(e),n._key,{source:"server"}).then((t=>Jg(e,n,t)))}function M4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return WC(n._query),PC(t,n._query).then((r=>new Cn(e,s,n,r)))}function L4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return WU(t,n._query).then((r=>new Cn(e,s,n,r)))}function F4(n){n=ke(n,Lt);const e=ke(n.firestore,tt),t=Et(e),s=new ui(e);return PC(t,n._query,{source:"server"}).then((r=>new Cn(e,s,n,r)))}function U4(n,e,t){n=ke(n,Xe);const s=ke(n.firestore,tt),r=lf(n.converter,e,t);return za(s,[sf(fo(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,vt.none())])}function B4(n,e,t,...s){n=ke(n,Xe);const r=ke(n.firestore,tt),i=fo(r);let o;return o=typeof(e=je(e))=="string"||e instanceof li?Wg(i,"updateDoc",n._key,e,t,s):Kg(i,"updateDoc",n._key,e),za(r,[o.toMutation(n._key,vt.exists(!0))])}function ZC(n){return za(ke(n.firestore,tt),[new Ua(n._key,vt.none())])}function q4(n,e){const t=ke(n.firestore,tt),s=Ug(n),r=lf(n.converter,e);return za(t,[sf(fo(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,vt.exists(!1))]).then((()=>s))}function wm(n,...e){n=je(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||Qo(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Qo(e[s])){const l=e[s];e[s]=l.next?.bind(l),e[s+1]=l.error?.bind(l),e[s+2]=l.complete?.bind(l)}let i,o,a;if(n instanceof Xe)o=ke(n.firestore,tt),a=La(n._key.path),i={next:l=>{e[s]&&e[s](Jg(o,n,l))},error:e[s+1],complete:e[s+2]};else{const l=ke(n,Lt);o=ke(l.firestore,tt),a=l._query;const u=new ui(o);i={next:h=>{e[s]&&e[s](new Cn(o,u,l,h))},error:e[s+1],complete:e[s+2]},WC(n._query)}return(function(u,h,d,f){const _=new ef(f),E=new Cg(h,_,d);return u.asyncQueue.enqueueAndForget((async()=>Ag(await Sa(u),E))),()=>{_.Nu(),u.asyncQueue.enqueueAndForget((async()=>Sg(await Sa(u),E)))}})(Et(o),a,r,i)}function $4(n,e,...t){const s=je(n),r=(function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const d of h){if(!(d in l)){u.error=`snapshotJson missing required field: ${d}`;break}const f=l[d];if(typeof f!="string"){u.error=`snapshotJson field '${d}' must be a string.`;break}if(f.length===0){u.error=`snapshotJson field '${d}' cannot be an empty string.`;break}d==="bundle"?u.bundle=f:d==="bundleName"?u.bundleName=f:d==="bundleSource"&&(u.bundleSource=f)}return u})(e);if(r.error)throw new B(M.INVALID_ARGUMENT,r.error);let i,o=0;if(typeof t[o]!="object"||Qo(t[o])||(i=t[o++]),r.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,f,_){let E,T=!1;return Tm(u,h.bundle).then((()=>LC(u,h.bundleName))).then((L=>{L&&!T&&(_&&L.withConverter(_),E=wm(L,d||{},f))})).catch((L=>(f.error&&f.error(L),()=>{}))),()=>{T||(T=!0,E&&E())}})(s,r,i,a,t[o])}if(r.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,f,_){let E,T=!1;return Tm(u,h.bundle).then((()=>{if(!T){const L=new Xe(u,_||null,ee.fromPath(h.bundleName));E=wm(L,d||{},f)}})).catch((L=>(f.error&&f.error(L),()=>{}))),()=>{T||(T=!0,E&&E())}})(s,r,i,a,t[o])}throw new B(M.INVALID_ARGUMENT,`unsupported bundle source: ${r.bundleSource}`)}function j4(n,e){return HU(Et(n=ke(n,tt)),Qo(e)?e:{next:e})}function za(n,e){return(function(s,r){const i=new Wt;return s.asyncQueue.enqueueAndForget((async()=>TU(await Fg(s),r,i))),i.promise})(Et(n),e)}function Jg(n,e,t){const s=t.docs.get(e._key),r=new ui(n);return new Rn(n,r,e._key,s,new js(t.hasPendingWrites,t.fromCache),e.converter)}function G4(n){return eP(n,{count:YC()})}function eP(n,e){const t=ke(n.firestore,tt),s=Et(t),r=LS(e,((i,o)=>new yR(o,i.aggregateType,i._internalFieldPath)));return zU(s,n._query,r).then((i=>(function(a,l,u){const h=new ui(a);return new FC(l,h,u)})(t,n,i)))}class K4{constructor(e){this.kind="memory",this._onlineComponentProvider=ei.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Og(void 0)}}toJSON(){return{kind:this.kind}}}class W4{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=tP(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class z4{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Aa.provider}toJSON(){return{kind:this.kind}}}class H4{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Og(e)}}toJSON(){return{kind:this.kind}}}function Q4(){return new z4}function Y4(n){return new H4(n?.cacheSizeBytes)}function J4(n){return new K4(n)}function bm(n){return new W4(n)}class X4{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new Mg(t,e?.cacheSizeBytes,this.forceOwnership)}}}class Z4{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new bC(t,e?.cacheSizeBytes)}}}function tP(n){return new X4(n?.forceOwnership)}function Am(){return new Z4}const e6={maxAttempts:5};class nP{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fo(e)}set(e,t,s){this._verifyNotCommitted();const r=Or(e,this._firestore),i=lf(r.converter,t,s),o=sf(this._dataReader,"WriteBatch.set",r._key,i,r.converter!==null,s);return this._mutations.push(o.toMutation(r._key,vt.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=Or(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof li?Wg(this._dataReader,"WriteBatch.update",i._key,t,s,r):Kg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,vt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Or(e,this._firestore);return this._mutations=this._mutations.concat(new Ua(t._key,vt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Or(n,e){if((n=je(n)).firestore!==e)throw new B(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class t6{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=fo(e)}get(e){const t=Or(e,this._firestore),s=new Yg(this._firestore);return this._transaction.lookup([t._key]).then((r=>{if(!r||r.length!==1)return de(24041);const i=r[0];if(i.isFoundDocument())return new xc(this._firestore,s,i.key,i,t.converter);if(i.isNoDocument())return new xc(this._firestore,s,t._key,null,t.converter);throw de(18433,{doc:i})}))}set(e,t,s){const r=Or(e,this._firestore),i=lf(r.converter,t,s),o=sf(this._dataReader,"Transaction.set",r._key,i,r.converter!==null,s);return this._transaction.set(r._key,o),this}update(e,t,s,...r){const i=Or(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof li?Wg(this._dataReader,"Transaction.update",i._key,t,s,r):Kg(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Or(e,this._firestore);return this._transaction.delete(t._key),this}}class sP extends t6{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Or(e,this._firestore),s=new ui(this._firestore);return super.get(e).then((r=>new Rn(this._firestore,s,t._key,r._document,new js(!1,!1),t.converter)))}}function n6(n,e,t){n=ke(n,tt);const s={...e6,...t};return(function(i){if(i.maxAttempts<1)throw new B(M.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s),(function(i,o,a){const l=new Wt;return i.asyncQueue.enqueueAndForget((async()=>{const u=await RC(i);new qU(i.asyncQueue,u,a,o,l).ju()})),l.promise})(Et(n),(r=>e(new sP(n,r))),s)}function s6(){return new iu("deleteField")}function r6(){return new qg("serverTimestamp")}function i6(...n){return new $g("arrayUnion",n)}function o6(...n){return new jg("arrayRemove",n)}function a6(n){return new Gg("increment",n)}function l6(n){return new Gn(n)}function c6(n){return Et(n=ke(n,tt)),new nP(n,(e=>za(n,e)))}function u6(n,e){const t=Et(n=ke(n,tt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Un("Cannot enable indexes when persistence is disabled"),Promise.resolve();const s=(function(i){const o=typeof i=="string"?(function(u){try{return JSON.parse(u)}catch(h){throw new B(M.INVALID_ARGUMENT,"Failed to parse JSON: "+h?.message)}})(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=pT(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const d of l.fields){const f=rf("setIndexConfiguration",pT(d,"fieldPath"));d.arrayConfig==="CONTAINS"?h.push(new Ui(f,2)):d.order==="ASCENDING"?h.push(new Ui(f,0)):d.order==="DESCENDING"&&h.push(new Ui(f,1))}a.push(new ca(ca.UNKNOWN_ID,u,h,ua.empty()))}return a})(e);return JU(t,s)}function pT(n,e){if(typeof n[e]!="string")throw new B(M.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}class rP{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function h6(n){n=ke(n,tt);const e=mT.get(n);if(e)return e;if(Et(n)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const s=new rP(n);return mT.set(n,s),s}function d6(n){iP(n,!0)}function f6(n){iP(n,!1)}function p6(n){ZU(Et(n._firestore)).then((e=>W("deleting all persistent cache indexes succeeded"))).catch((e=>Un("deleting all persistent cache indexes failed",e)))}function iP(n,e){XU(Et(n._firestore),e).then((t=>W(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Un(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const mT=new WeakMap;function m6(n){const e=Et(ke(n.firestore,tt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:zd(t,hn(n._query)).ft}function _6(n,e){const t=LS(e,((i,o)=>new yR(o,i.aggregateType,i._internalFieldPath))),s=Et(ke(n.firestore,tt)),r=s._onlineComponents?.datastore.serializer;return r===void 0?null:NR(r,nR(n._query),t,!0).request}class g6{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Xg.instance.onExistenceFilterMismatch(e)}}class Xg{constructor(){this.Mc=new Map}static get instance(){return Ou||(Ou=new Xg,(function(t){if(am)throw new Error("a TestingHooksSpi instance is already set");am=t})(Ou)),Ou}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),s=this.Mc;return s.set(t,e),()=>s.delete(t)}}let Ou=null;(function(e,t=!0){(function(r){Ma=r})(ao),Gi(new Kr("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new tt(new LL(s.getProvider("auth-internal")),new BL(o,s.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qr(u.options.projectId,h)})(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),ws(zE,HE,e),ws(zE,HE,"esm2020")})();const y6=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Qg,AggregateField:Ra,AggregateQuerySnapshot:FC,Bytes:Tn,CACHE_SIZE_UNLIMITED:s4,CollectionReference:is,DocumentReference:Xe,DocumentSnapshot:Rn,FieldPath:li,FieldValue:ci,Firestore:tt,FirestoreError:B,GeoPoint:os,LoadBundleTask:VC,PersistentCacheIndexManager:rP,Query:Lt,QueryCompositeFilterConstraint:mo,QueryConstraint:Ka,QueryDocumentSnapshot:Zl,QueryEndAtConstraint:lu,QueryFieldFilterConstraint:Wa,QueryLimitConstraint:ou,QueryOrderByConstraint:af,QuerySnapshot:Cn,QueryStartAtConstraint:au,SnapshotMetadata:js,Timestamp:Qe,Transaction:sP,VectorValue:Gn,WriteBatch:nP,_AutoId:Od,_ByteString:It,_DatabaseId:Qr,_DocumentKey:ee,_EmptyAppCheckTokenProvider:qL,_EmptyAuthCredentialsProvider:_S,_FieldPath:gt,_TestingHooks:g6,_cast:ke,_debugAssert:OL,_internalAggregationQueryToProtoRunAggregationQueryRequest:_6,_internalQueryToProtoQueryTarget:m6,_isBase64Available:bF,_logWarn:Un,_validateIsNotUsedTogether:yS,addDoc:q4,aggregateFieldEqual:C4,aggregateQuerySnapshotEqual:P4,and:y4,arrayRemove:o6,arrayUnion:i6,average:R4,clearIndexedDbPersistence:r4,collection:e4,collectionGroup:t4,connectFirestoreEmulator:DC,count:YC,deleteAllPersistentCacheIndexes:p6,deleteDoc:ZC,deleteField:s6,disableNetwork:a4,disablePersistentCacheIndexAutoCreation:f6,doc:Ug,documentId:c4,documentSnapshotFromJSON:N4,enableIndexedDbPersistence:ah,enableMultiTabIndexedDbPersistence:Im,enableNetwork:o4,enablePersistentCacheIndexAutoCreation:d6,endAt:A4,endBefore:b4,ensureFirestoreConfigured:Et,executeWrite:za,getAggregateFromServer:eP,getCountFromServer:G4,getDoc:XC,getDocFromCache:V4,getDocFromServer:O4,getDocs:M4,getDocsFromCache:L4,getDocsFromServer:F4,getFirestore:oh,getPersistentCacheIndexManager:h6,increment:a6,initializeFirestore:Em,limit:E4,limitToLast:I4,loadBundle:Tm,memoryEagerGarbageCollector:Q4,memoryLocalCache:J4,memoryLruGarbageCollector:Y4,namedQuery:LC,onSnapshot:wm,onSnapshotResume:$4,onSnapshotsInSync:j4,or:g4,orderBy:v4,persistentLocalCache:bm,persistentMultipleTabManager:Am,persistentSingleTabManager:tP,query:m4,queryEqual:Bg,querySnapshotFromJSON:k4,refEqual:n4,runTransaction:n6,serverTimestamp:r6,setDoc:U4,setIndexConfiguration:u6,setLogLevel:VL,snapshotEqual:D4,startAfter:w4,startAt:T4,sum:S4,terminate:l4,updateDoc:B4,vector:l6,waitForPendingWrites:i4,where:_4,writeBatch:c6},Symbol.toStringTag,{value:"Module"})),v6=!0,E6=!0,I6=v6,Sm=E6,Mr={apiKey:"...",authDomain:"...",databaseURL:"...",projectId:"...",storageBucket:"...",messagingSenderId:"...",appId:"...",measurementId:"..."},T6=!!Mr.apiKey&&!!Mr.authDomain&&!!Mr.projectId&&!!Mr.appId;let Vs=null,Lr=null,nd=null,yn=null;console.log("[firebase] apiKey=",Mr.apiKey?"(set)":"(missing)");console.log("[firebase] projectId=",Mr.projectId||"(missing)");console.log("[firebase] authDomain=",Mr.authDomain||"(missing)");console.log("[firebase] MODE=","production","PROD=",!0);console.log("[firebase] REMOTE_ENABLED=",I6);console.log("[firebase] FIRESTORE_PERSISTENCE_ENABLED=",Sm);try{T6?(Vs=mb(Mr),Lr=vV(Vs)):console.warn("[firebase] Missing VITE_FB_* env config. Running in guest-safe mode.")}catch(n){console.warn("[firebase] initializeApp failed. Running in guest-safe mode:",n),Vs=null,Lr=null}if(Vs){try{nd=kL(Vs)}catch(n){console.warn("[firebase] getDatabase failed:",n),nd=null}try{typeof Em=="function"?Sm&&(typeof bm=="function"&&typeof Am=="function"?yn=Em(Vs,{localCache:bm({tabManager:Am()})}):yn=oh(Vs)):yn=oh(Vs)}catch(n){console.warn("[firebase] firestore init failed. Fallback to getFirestore:",n);try{yn=oh(Vs)}catch(e){console.warn("[firebase] getFirestore failed:",e),yn=null}}yn&&Sm&&(async()=>{try{if(typeof Im=="function")await Im(yn);else if(typeof ah=="function")try{await ah(yn,{synchronizeTabs:!0})}catch{await ah(yn)}}catch(n){console.warn("[firebase] indexeddb persistence not available:",n)}})()}const Zg=Ae(null),Os=Ae(null),ey=Ae(!1);let ap=!1,Mu=null;const w6=!0;function Rm(){Zg.value=null,Os.value=null,ey.value=!0}function b6(){if(!ap){if(!Lr){Rm(),ap=!0;return}if(typeof Mu=="function"){try{Mu()}catch{}Mu=null}Mu=aD(Lr,n=>{Zg.value=n||null,ey.value=!0,Os.value=null,n?.uid?console.log("   :  ",n.displayName||n.email):console.log("   :  ")},n=>{Os.value=n,Rm(),console.error("onAuthStateChanged error:",n)}),ap=!0}}b6();function ty(){return{user:Zg,authError:Os,authReady:ey,signInWithGoogle:async()=>{if(!Lr){const s=new Error("     .");throw s.code="AUTH_DISABLED",Os.value=s,s}const t=new Fs;try{const s=await CD(Lr,t);return Os.value=null,console.log("useAuth:  !",s.user.displayName||s.user.email),s.user}catch(s){throw Os.value=s,console.error("useAuth:  :",s),s}},signOutUser:async()=>{if(!Lr)return Rm(),!0;try{return await lD(Lr),Os.value=null,console.log("useAuth:  !"),!0}catch(t){throw Os.value=t,console.error("useAuth:  :",t),t}},AUTH_ENABLED:w6}}const A6="modulepreload",S6=function(n){return"/RCTS/"+n},_T={},R6=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};var o=u;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=u(t.map(h=>{if(h=S6(h),h in _T)return;_T[h]=!0;const d=h.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":A6,d||(_.as="script"),_.crossOrigin="",_.href=h,l&&_.setAttribute("nonce",l),document.head.appendChild(_),d)return new Promise((E,T)=>{_.addEventListener("load",E),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return r.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},ec=Ae(0),tc=Ae(!1);let gT=!1,lp=null;function C6(){if(!gT){if(gT=!0,!nd){ec.value=0,tc.value=!0,lp=null;return}lp=IL(nd,"/.info/serverTimeOffset"),wL(lp,n=>{const e=Number(n.val()||0);ec.value=Number.isFinite(e)?e:0,tc.value=!0},n=>{console.warn("ServerTime: offset subscribe failed:",n),ec.value=0,tc.value=!0})}}function P6(){const n=()=>Date.now()+(ec.value||0),e=he(()=>tc.value===!0);return{serverOffsetMs:ec,isServerTimeReady:tc,isServerTimeReadyComputed:e,serverNowMs:n}}const nc=Ae(null),sd=Ae(!1);let Cm=!1;const N6=540*60*1e3;function k6(n){return new Date(n+N6)}function x6(n){if(!(n instanceof Date))return"";const e=t=>String(t).padStart(2,"0");return`${e(n.getHours())}:${e(n.getMinutes())}`}function oP(){if(Cm)return;Cm=!0;let n,e;{const{serverNowMs:s}=P6();n=()=>s(),e=k6}const t=()=>{try{const s=Number(n?.()??Date.now());nc.value=e(s),sd.value=!0}catch(s){nc.value=new Date,sd.value=!0,console.warn("[useKstTime] fallback to local time:",s)}};t(),setInterval(t,6e4)}function aP(){Cm||oP();const n=he(()=>sd.value&&nc.value instanceof Date),e=he(()=>n.value?x6(nc.value):"");return{kstDate:nc,isKstTimeReady:sd,isKstReady:n,kstString:e}}const Ct=3600,yT=60,Tl=8*Ct,hi=[{id:"sys_unlock_vehicle",type:"SYSTEM",domain:"vehicle",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"vehicle"}]},{id:"sys_unlock_route",type:"SYSTEM",domain:"route",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"route"}]},{id:"sys_unlock_construction",type:"SYSTEM",domain:"construction",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"construction"}]},{id:"sys_unlock_finance",type:"SYSTEM",domain:"finance",timePolicy:"FIXED",title:"()  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"finance"}]},{id:"sys_unlock_city",type:"SYSTEM",domain:"city",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:Tl,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"city"}]},{id:"sys_preview_starter_vehicles",type:"REAL",domain:"vehicle",timePolicy:"SCALABLE",title:"  ",desc:' (//)    .   ""  ,     . (30,  )',tier:1,durationSec:30*yT,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_STARTER_FLEET_PREVIEW",transports:["bus","truck","rail"],runTimeMinSec:30*yT,runTimeMaxSec:3*Ct,countPerTransport:1,mode:"MANUAL"}]},{id:"sys_preview_auto_assign",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:"  ",desc:"      . (1,  )",tier:1,durationSec:1*Ct,requires:["sys_preview_starter_vehicles"],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_FEATURE",featureKey:"preview_auto_assign"},{type:"SET_PREVIEW_RUN_MODE",mode:"AUTO"}]},{id:"city_scale_region",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  .',tier:1,durationSec:4*Ct,requires:["sys_unlock_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"REGION"}]},{id:"city_scale_city",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  . (  )',tier:1,durationSec:8*Ct,requires:["city_scale_region"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"CITY"}]},{id:"city_scale_country",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . ( / )',tier:1,durationSec:12*Ct,requires:["city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"COUNTRY"}]},{id:"city_scale_state",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:16*Ct,requires:["city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"STATE"}]},{id:"city_scale_planet",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:24*Ct,requires:["city_scale_state"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"PLANET"}]},{id:"unlock_bus_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"bus",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"bus",tier:1}]},{id:"unlock_truck_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"truck",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"truck",tier:1}]},{id:"unlock_rail_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"rail",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"rail",tier:1}]},{id:"unlock_plane_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Ct,requires:["sys_unlock_city","city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"plane",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"plane",tier:1}]},{id:"unlock_ship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Ct,requires:["sys_unlock_city","city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"ship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"ship",tier:1}]},{id:"unlock_spaceship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:3*Ct,requires:["sys_unlock_city","city_scale_planet"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"spaceship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"spaceship",tier:1}]},{id:"rs_1",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  I",desc:"     5% . (SYSTEM  8 )",tier:1,durationSec:1*Ct,requires:[],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:1}]},{id:"rs_2",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  II",desc:"     10% . (SYSTEM  8 )",tier:1,durationSec:2*Ct,requires:["rs_1"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:2}]},{id:"rs_3",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  III",desc:"     15% . (SYSTEM  8 )",tier:1,durationSec:4*Ct,requires:["rs_2"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:3}]},{id:"rs_4",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  IV",desc:"     20% . (SYSTEM  8 )",tier:1,durationSec:8*Ct,requires:["rs_3"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:4}]},{id:"rs_5",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  V",desc:"     25% . (SYSTEM  8 )",tier:1,durationSec:16*Ct,requires:["rs_4"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:5}]},{id:"t2_transport_foundation",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:" 2  ()",desc:"2   .   .",tier:2,durationSec:12*Ct,requires:[],revealAfter:[],enabled:!1,effects:[]}];function ny(n){return hi.find(e=>e.id===n)||null}function cp(n){return String(Math.max(0,Number(n)||0)).padStart(2,"0")}function vT(n){const e=Math.max(0,Math.floor(Number(n)||0)),t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return{h:t,m:s,sec:r}}function ET({h:n,m:e,sec:t}){return n>0?`${n}h ${cp(e)}m ${cp(t)}s`:e>0?`${e}m ${cp(t)}s`:`${t}s`}function lP(){const n=r=>{const i=Math.max(0,Math.floor(Number(r||0)/1e3));return ET(vT(i))},e=r=>ET(vT(r));return{formatRemainMs:n,formatRemainSec:e,makeRemainLabelFromMs:r=>he(()=>n(r.value)),makeRemainLabelFromSec:r=>he(()=>e(r.value))}}function D6(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="test"?"test":e==="preview"?"preview":e==="prod"?"prod":e==="beta"?"beta":"prod"}function V6(){const n=he(()=>D6("test")),e=he(()=>n.value==="dev"),t=he(()=>n.value==="test"),s=he(()=>n.value==="preview"),r=he(()=>n.value==="prod");return{channel:n,isDev:e,isTest:t,isPreview:s,isProd:r}}const cP="rcts.research.saveEnabled",uP="rcts.research.autosave.enabled",hP="rcts.research.autosave.base",sy="rcts.research.autosave.intervalMin",{kstDate:dP,isKstTimeReady:fP}=aP(),cu=he(()=>fP.value&&dP.value instanceof Date);function cf(){return cu.value?dP.value.getTime():Date.now()}const O6=new Set(["sys_unlock_vehicle","sys_unlock_route","sys_unlock_construction","sys_unlock_finance","sys_unlock_city"]);function rd(n){return!n||!O6.has(n)?!1:ny(n)?.enabled===!1}function pP(n){const e=String(n||"").toLowerCase().trim();return e||"prod"}const{isTest:mP}=V6(),ur=he(()=>mP.value?!1:!!yn),_P=he(()=>mP.value),M6=300;let Lu=null;async function uu(){if(!ur.value)return null;if(Lu)return Lu;const n=await R6(()=>Promise.resolve().then(()=>y6),void 0);return Lu={doc:n.doc,getDoc:n.getDoc,setDoc:n.setDoc,serverTimestamp:n.serverTimestamp,onSnapshot:n.onSnapshot},Lu}async function gP(...n){const e=await uu();return e?e.doc(...n):null}async function L6(n){const e=await uu();return!e||!n?null:e.getDoc(n)}async function ry(n,e,t){const s=await uu();return!s||!n?!1:(await s.setDoc(n,e,t),!0)}async function F6(n,e,t){const s=await uu();return!s||!n?null:s.onSnapshot(n,e,t)}async function iy(){const n=await uu();return n?n.serverTimestamp():null}async function oy(n,e){if(!ur.value)return null;const t=pP(e);return gP(yn,"worlds",t,"users",n,"research","state")}async function U6(n){return ur.value?gP(yn,"users",n,"research","state"):null}const Ns=Ae(null),dn=Ae(new Set),it=Ae(null),ht=Ae([]),yP=Ae({}),vP=Ae(1),ay=Ae(0),uf=Ae(1),io=Ae(1),id=Ae("NONE"),od=Ae({vehicle:!1,route:!1,construction:!1,finance:!1,city:!1}),Ni=Ae(!1),Pm=Ae(!1),$n=Ae(!1),di=Ae(null),$i=Ae("prod");let En=null,Is=!1,lh=null;const ji=Ae(IP(cP,!0)),Dc=Ae(IP(uP,!1)),ly=Ae(TP(hP,5)),Vc=Ae(TP(sy,10)),cy=Ae(!1),EP=Ae(0);let Vi=null;function IP(n,e){const t=localStorage.getItem(n);return t===null?e:t==="1"}function TP(n,e){const t=localStorage.getItem(n),s=t==null?NaN:Number(t);return Number.isFinite(s)?s:e}function wP(n,e){localStorage.setItem(n,e?"1":"0")}function Nm(n,e){localStorage.setItem(n,String(e))}function hf(n){const e=Math.max(1,Math.min(3,Number(n||1)));return e===1?1:e===2?3:5}function B6(n){ji.value=!!n,wP(cP,ji.value),ji.value?hu():(En&&(clearTimeout(En),En=null),In())}function q6(n){Dc.value=!!n,wP(uP,Dc.value),hu()}function $6(n){const e=Number(n)===10?10:5;ly.value=e,Nm(hP,e);const t=Number(Vc.value)||e,s=Math.max(e,Math.round(t/e)*e);Vc.value=s,Nm(sy,s),hu(!0)}function j6(n){const e=Number(ly.value)===10?10:5,t=Number(n);if(!Number.isFinite(t)||t<=0)return;const s=Math.max(e,Math.round(t/e)*e);Vc.value=s,Nm(sy,s),hu(!0)}function G6(n){const e=Number(n);if(!Number.isFinite(e)||e<=0)return 6e4;const t=e*60*1e3,s=540*60*1e3,r=Date.now()+s,o=(Math.floor(r/t)+1)*t-r;return Math.max(1e3,o)}function In(){cy.value=!1,Vi&&(clearTimeout(Vi),Vi=null)}function bP(){if(Vi&&(clearTimeout(Vi),Vi=null),!ur.value||!Dc.value||!ji.value||!di.value||!$n.value||Is)return In();cy.value=!0;const n=Number(Vc.value)||10,e=G6(n);Vi=setTimeout(async()=>{try{await cs({reason:"autosave"}),EP.value=Date.now()}catch(t){console.error("useResearch:  :",t)}finally{bP()}},e)}function hu(n=!1){if(n&&In(),!ur.value)return In();Dc.value&&ji.value&&di.value&&$n.value&&!Is?bP():In()}function K6(){En&&(clearTimeout(En),En=null),In(),di.value=null,$i.value="prod",$n.value=!1,Is=!1}function W6(n){return(Array.isArray(n?.requires)?n.requires:[]).every(t=>dn.value.has(t))}function AP(n){const e=Array.isArray(n?.revealAfter)?n.revealAfter:[];return e.length===0?!0:e.every(t=>dn.value.has(t))}function uy(n){return dn.value.has(n)}function z6(n){return!n||Number(n.tier||1)!==1?!1:(n.effects||[]).some(e=>e?.type==="UNLOCK_TRANSPORT_TIER"&&Number(e?.tier||1)===1&&!!e?.transportId)}function H6(n){return n?n.timePolicy==="FIXED"?!0:n.type==="SYSTEM":!1}function ad(n){switch(String(n||"").toUpperCase()){case"REGION":return 1;case"CITY":return 2;case"COUNTRY":return 3;case"STATE":return 4;case"PLANET":return 5;default:return 0}}function Gr(){const n={};let e=1,t=0,s=1,r="NONE";const i={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1};for(const l of hi)if(dn.value.has(l.id))for(const u of l.effects||[]){if(u.type==="UNLOCK_TRANSPORT_TIER"){const h=u.transportId,d=Number(u.tier||1);if(!h)continue;n[h]=Math.max(Number(n[h]||0),d)}if(u.type==="INCOME_MULTIPLIER"&&(e*=Number(u.value||1)),u.type==="RESEARCH_SPEED_LEVEL"){const h=Number(u.level||0);Number.isFinite(h)&&(t=Math.max(t,h))}if(u.type==="QUEUE_RESERVE_LEVEL"){const h=Number(u.level||1);Number.isFinite(h)&&(s=Math.max(s,h))}if(u.type==="UNLOCK_FEATURE"){const h=String(u.featureKey||"");h&&Object.prototype.hasOwnProperty.call(i,h)&&(i[h]=!0)}if(u.type==="SET_CITY_SCALE"){const h=String(u.scale||"").toUpperCase();ad(h)>ad(r)&&(r=h)}}yP.value=n,vP.value=e,ay.value=t;const o=1-.05*Math.max(0,t);uf.value=Math.max(.2,o),id.value=r,od.value=i,io.value=Math.max(1,Math.min(3,s));const a=hf(io.value);ht.value.length>a&&(ht.value=ht.value.slice(0,a))}const Q6=he(()=>hi.filter(n=>Number(n?.tier||1)>=2?!0:AP(n))),Y6=he(()=>{const n=new Set;for(const e of hi)if(Number(e.tier||1)===1)for(const t of e.effects||[])t.type==="UNLOCK_TRANSPORT_TIER"&&Number(t.tier||1)===1&&t.transportId&&n.add(t.transportId);return Array.from(n)}),J6=he(()=>!Ns.value),X6=he(()=>Y6.value.map(n=>({id:n})));function Z6(){return dn.value.has("unlock_bus_t1")||dn.value.has("unlock_truck_t1")||dn.value.has("unlock_rail_t1")}function hy(n){const e=ny(n);if(!e)return"unknown";const t=Number(e.tier||1);return t===1&&!AP(e)?"hidden":uy(n)?"done":it.value?.id===n?"active":ht.value.includes(n)?"queued":e.enabled===!1?"comingSoon":n==="sys_preview_starter_vehicles"?!Ns.value||!Z6()?"locked":"available":t===1&&z6(e)&&Ns.value||W6(e)?"available":"locked"}function SP(n){return hi.find(t=>t.enabled!==!1&&Number(t.tier||1)===1&&(t.effects||[]).some(s=>s.type==="UNLOCK_TRANSPORT_TIER"&&s.transportId===n&&Number(s.tier||1)===1))?.id??null}function RP(){return!(!ur.value||!di.value||!$n.value||Is)}function eB(){return ji.value?RP():!1}function CP(){const n=hf(io.value);return{version:10,firstUnlockTransportId:Ns.value??null,completedResearchIds:Array.from(dn.value),activeResearch:it.value?{id:it.value.id,startedAtMs:it.value.startedAtMs,endsAtMs:it.value.endsAtMs}:null,queuedResearchIds:Array.isArray(ht.value)?ht.value.slice(0,n):[]}}function tB(n){Ns.value=typeof n?.firstUnlockTransportId=="string"?n.firstUnlockTransportId:typeof n?.firstUnlockId=="string"?n.firstUnlockId:null;const e=Array.isArray(n?.completedResearchIds)?n.completedResearchIds:[];dn.value=new Set(e.filter(o=>typeof o=="string"));const t=n?.activeResearch;t&&typeof t=="object"&&typeof t.id=="string"?it.value={id:t.id,startedAtMs:Number(t.startedAtMs||0),endsAtMs:Number(t.endsAtMs||0)}:it.value=null;const s=Array.isArray(n?.queuedResearchIds)?n.queuedResearchIds.filter(o=>typeof o=="string"):[],r=typeof n?.queuedResearchId=="string"?n.queuedResearchId:null,i=[];for(const o of s)i.includes(o)||i.push(o);if(r&&!i.includes(r)&&i.push(r),ht.value=i,dn.value.size===0&&Array.isArray(n?.transports)){for(const o of n.transports)if(!(!o||typeof o.id!="string")&&o.locked===!1){const a=SP(o.id);a&&dn.value.add(a)}}Gr()}async function cs({reason:n="manual"}={}){if(!RP())return;En&&(clearTimeout(En),En=null);const e=await oy(di.value,$i.value);if(e)try{Pm.value=!0;const t=await iy(),s={...CP(),updatedAt:t,lastSaveReason:n};await ry(e,s,{merge:!0})}catch(t){console.error("useResearch: Firebase  :",t)}finally{Pm.value=!1}}const nB=()=>{eB()&&(En&&clearTimeout(En),En=setTimeout(async()=>{await cs({reason:"debounced"})},800))};function sB(n){if(!n||Ns.value)return;const e=SP(n);e&&(Ns.value=n,dn.value.add(e),Gr(),cs({reason:"firstUnlock"}))}function PP(n){if(rd(n))return{ok:!1,reason:"COMING_SOON"};const e=ny(n);if(!e)return{ok:!1,reason:"UNKNOWN_RESEARCH"};if(!Ns.value)return{ok:!1,reason:"FIRST_UNLOCK_REQUIRED"};if(!cu.value)return{ok:!1,reason:"KST_NOT_READY"};if(uy(n))return{ok:!1,reason:"ALREADY_DONE"};if(e.enabled===!1)return{ok:!1,reason:"COMING_SOON"};const t=hy(n);if(t!=="available")return{ok:!1,reason:t.toUpperCase()};const s=cf(),r=Number(e.durationSec||0);let i=0;return r>0&&(_P.value?i=M6:H6(e)?i=Math.ceil(r):i=Math.ceil(r*uf.value)),i<=0?(dn.value.add(n),Gr(),cs({reason:"instantComplete"}),{ok:!0,instant:!0}):(it.value={id:n,startedAtMs:s,endsAtMs:s+i*1e3},cs({reason:"startResearch"}),{ok:!0,instant:!1})}function rB(n){if(rd(n))return{ok:!1,reason:"COMING_SOON"};const e=hf(io.value);if(uy(n))return{ok:!1,reason:"ALREADY_DONE"};if(it.value?.id===n)return{ok:!1,reason:"ALREADY_ACTIVE"};if(ht.value.includes(n))return{ok:!0,queued:!0,alreadyQueued:!0};if(it.value){if(ht.value.length>=e)return{ok:!1,reason:"QUEUE_FULL"};const t=hy(n);return t!=="available"?{ok:!1,reason:t.toUpperCase()}:(ht.value=[...ht.value,n].slice(0,e),cs({reason:"queueAdd"}),{ok:!0,queued:!0})}return PP(n)}function iB(n){const e=ht.value.slice(),t=e.filter(s=>s!==n);t.length!==e.length&&(ht.value=t,cs({reason:"queueCancel"}))}function oB(){ht.value.length!==0&&(ht.value=[],cs({reason:"queueCancelAll"}))}function aB(n){if(!it.value||it.value.id!==n||!cu.value)return 0;const e=it.value.endsAtMs-it.value.startedAtMs;if(e<=0)return 0;const t=cf()-it.value.startedAtMs;return Math.max(0,Math.min(100,t/e*100))}function lB(n){const{formatRemainSec:e}=lP();if(!it.value||it.value.id!==n||!cu.value)return"0s";const t=Math.max(0,it.value.endsAtMs-cf()),s=Math.floor(t/1e3);return e(s)}function NP(){lh&&(lh(),lh=null),En&&(clearTimeout(En),En=null),In(),di.value=null,$i.value="prod",$n.value=!1,Is=!1,Ni.value=!1}async function cB(n,e){if(!ur.value)return!1;const t=await oy(n,e),s=await U6(n);if(!t||!s)return!1;const r=await L6(s);if(!r||!r.exists())return!1;const i=r.data()||{},o=await iy(),a={...i,migratedFromLegacy:!0,migratedAt:o,updatedAt:o,lastSaveReason:"migrateLegacy"};return await ry(t,a,{merge:!0}),!0}async function kP(n,e="prod"){if(!n)return;if(NP(),di.value=n,$i.value=pP(e),!ur.value){Gr(),Ni.value=!1,$n.value=!0,Is=!1,In();return}Ni.value=!0,$n.value=!1;const t=await oy(n,$i.value);if(!t){Ni.value=!1,$n.value=!1;return}lh=await F6(t,async s=>{Is=!0;try{if(s.exists())tB(s.data());else if(await cB(n,$i.value))Gr();else{Gr();const i=await iy(),o={...CP(),createdAt:i,updatedAt:i,lastSaveReason:"init"};await ry(t,o,{merge:!0})}}catch(r){console.error("useResearch: onSnapshot apply failed:",r)}finally{Is=!1,Ni.value=!1,$n.value=!0,hu(!0)}},s=>{Is=!1,Ni.value=!1,$n.value=!1,In(),console.error("useResearch: onSnapshot error:",s)})}async function uB(n,e="prod"){await kP(n,e)}function hB(){K6(),Ns.value=null,dn.value=new Set,it.value=null,ht.value=[],id.value="NONE",od.value={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1},ay.value=0,uf.value=1,io.value=1,Gr()}Vl(()=>{if(Is)return;let n=!1;if(it.value?.id&&rd(it.value.id)&&(it.value=null,n=!0),Array.isArray(ht.value)&&ht.value.length>0){const e=ht.value.filter(t=>!rd(t));e.length!==ht.value.length&&(ht.value=e,n=!0)}n&&cs({reason:"hardLockCleanup"})});Vl(()=>{if(!cu.value)return;const n=cf();if(it.value&&n>=Number(it.value.endsAtMs||0)){const e=it.value.id;if(it.value=null,dn.value.add(e),Gr(),ht.value.length>0){const[t,...s]=ht.value;ht.value=s;const r=PP(t);r?.ok||console.warn("useResearch: queued next start failed:",t,r?.reason)}cs({reason:"researchComplete"})}});function _o(){const n=he(()=>!di.value||$n.value),e=he(()=>hf(io.value)),t=he(()=>ht.value.length),s=he(()=>t.value>=e.value);return{catalog:hi,visibleCatalog:Q6,firstUnlockTransportId:Ns,needsFirstUnlockSelection:J6,firstUnlockCandidates:X6,setFirstUnlockTransport:sB,completedIds:dn,activeResearch:it,queuedResearchIds:ht,queueReserveLevel:io,queueLimit:e,queueCount:t,isQueueFull:s,unlockedTransportTiers:yP,incomeMultiplier:vP,researchSpeedLevel:ay,researchDurationMultiplier:uf,cityScale:id,unlockedFeatures:od,hasFeature:o=>!!od.value?.[o],cityScaleAtLeast:o=>ad(id.value)>=ad(o),getStatus:hy,startResearch:rB,cancelQueuedResearch:iB,cancelAllQueuedResearch:oB,getResearchProgress:aB,getResearchRemainingTime:lB,isKstTimeReady:fP,subscribeForUser:kP,unsubscribe:NP,loadForUser:uB,clearUserState:hB,saveNow:cs,scheduleSave:nB,saveEnabled:ji,setSaveEnabled:B6,autoSaveEnabled:Dc,autoSaveBase:ly,autoSaveIntervalMin:Vc,setAutoSaveEnabled:q6,setAutoSaveBase:$6,setAutoSaveIntervalMin:j6,autoSaveRunning:cy,lastAutoSaveAtMs:EP,isLoadingFirebaseData:Ni,isSavingFirebaseData:Pm,isStateLoaded:$n,isHydrated:n,currentWorld:$i,REMOTE_OK:ur,FORCE_ALL_5MIN:_P}}function dB(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="stage"?"stage":"prod"}function dy(){return{world:he(()=>dB("prod"))}}let IT=!1;function fB(){const{user:n,authReady:e}=ty(),{world:t}=dy(),s=_o(),r=he(()=>n.value?.uid||null),i=he(()=>!0);return{start:()=>{i.value&&(IT||(Gs([e,r,t],([a,l,u],[h,d,f])=>{if(!a)return;(d&&d!==l||f&&f!==u)&&s.unsubscribe(),l?s.subscribeForUser(l,u):(s.unsubscribe(),s.clearUserState())},{immediate:!0}),IT=!0))}}}const pB={__name:"App",setup(n){return Ym(()=>{oP(),fB().start(),C6()}),(e,t)=>{const s=ac("router-view");return Y(),Zo(s)}}};const Vo=typeof document<"u";function xP(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function mB(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&xP(n.default)}const Ge=Object.assign;function up(n,e){const t={};for(const s in e){const r=e[s];t[s]=us(r)?r.map(n):n(r)}return t}const sc=()=>{},us=Array.isArray;function TT(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}const DP=/#/g,_B=/&/g,gB=/\//g,yB=/=/g,vB=/\?/g,VP=/\+/g,EB=/%5B/g,IB=/%5D/g,OP=/%5E/g,TB=/%60/g,MP=/%7B/g,wB=/%7C/g,LP=/%7D/g,bB=/%20/g;function fy(n){return n==null?"":encodeURI(""+n).replace(wB,"|").replace(EB,"[").replace(IB,"]")}function AB(n){return fy(n).replace(MP,"{").replace(LP,"}").replace(OP,"^")}function km(n){return fy(n).replace(VP,"%2B").replace(bB,"+").replace(DP,"%23").replace(_B,"%26").replace(TB,"`").replace(MP,"{").replace(LP,"}").replace(OP,"^")}function SB(n){return km(n).replace(yB,"%3D")}function RB(n){return fy(n).replace(DP,"%23").replace(vB,"%3F")}function CB(n){return RB(n).replace(gB,"%2F")}function Oc(n){if(n==null)return null;try{return decodeURIComponent(""+n)}catch{}return""+n}const PB=/\/$/,NB=n=>n.replace(PB,"");function hp(n,e,t="/"){let s,r={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return l=a>=0&&l>a?-1:l,l>=0&&(s=e.slice(0,l),i=e.slice(l,a>0?a:e.length),r=n(i.slice(1))),a>=0&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=VB(s??e,t),{fullPath:s+i+o,path:s,query:r,hash:Oc(o)}}function kB(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function wT(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function xB(n,e,t){const s=e.matched.length-1,r=t.matched.length-1;return s>-1&&s===r&&Ca(e.matched[s],t.matched[r])&&FP(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ca(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function FP(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(var t in n)if(!DB(n[t],e[t]))return!1;return!0}function DB(n,e){return us(n)?bT(n,e):us(e)?bT(e,n):n?.valueOf()===e?.valueOf()}function bT(n,e){return us(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function VB(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),r=s[s.length-1];(r===".."||r===".")&&s.push("");let i=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+s.slice(o).join("/")}const Ir={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let xm=(function(n){return n.pop="pop",n.push="push",n})({}),dp=(function(n){return n.back="back",n.forward="forward",n.unknown="",n})({});function OB(n){if(!n)if(Vo){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),NB(n)}const MB=/^[^#]+#/;function LB(n,e){return n.replace(MB,"#")+e}function FB(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const df=()=>({left:window.scrollX,top:window.scrollY});function UB(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),r=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!r)return;e=FB(r,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function AT(n,e){return(history.state?history.state.position-e:-1)+n}const Dm=new Map;function BB(n,e){Dm.set(n,e)}function qB(n){const e=Dm.get(n);return Dm.delete(n),e}function $B(n){return typeof n=="string"||n&&typeof n=="object"}function UP(n){return typeof n=="string"||typeof n=="symbol"}let wt=(function(n){return n[n.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",n[n.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",n[n.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",n[n.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",n[n.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",n})({});const BP=Symbol("");wt.MATCHER_NOT_FOUND+"",wt.NAVIGATION_GUARD_REDIRECT+"",wt.NAVIGATION_ABORTED+"",wt.NAVIGATION_CANCELLED+"",wt.NAVIGATION_DUPLICATED+"";function Pa(n,e){return Ge(new Error,{type:n,[BP]:!0},e)}function xs(n,e){return n instanceof Error&&BP in n&&(e==null||!!(n.type&e))}const jB=["params","query","hash"];function GB(n){if(typeof n=="string")return n;if(n.path!=null)return n.path;const e={};for(const t of jB)t in n&&(e[t]=n[t]);return JSON.stringify(e,null,2)}function KB(n){const e={};if(n===""||n==="?")return e;const t=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<t.length;++s){const r=t[s].replace(VP," "),i=r.indexOf("="),o=Oc(i<0?r:r.slice(0,i)),a=i<0?null:Oc(r.slice(i+1));if(o in e){let l=e[o];us(l)||(l=e[o]=[l]),l.push(a)}else e[o]=a}return e}function ST(n){let e="";for(let t in n){const s=n[t];if(t=SB(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(us(s)?s.map(r=>r&&km(r)):[s&&km(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function WB(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=us(s)?s.map(r=>r==null?null:""+r):s==null?s:""+s)}return e}const zB=Symbol(""),RT=Symbol(""),ff=Symbol(""),py=Symbol(""),Vm=Symbol("");function wl(){let n=[];function e(s){return n.push(s),()=>{const r=n.indexOf(s);r>-1&&n.splice(r,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Rr(n,e,t,s,r,i=o=>o()){const o=s&&(s.enterCallbacks[r]=s.enterCallbacks[r]||[]);return()=>new Promise((a,l)=>{const u=f=>{f===!1?l(Pa(wt.NAVIGATION_ABORTED,{from:t,to:e})):f instanceof Error?l(f):$B(f)?l(Pa(wt.NAVIGATION_GUARD_REDIRECT,{from:e,to:f})):(o&&s.enterCallbacks[r]===o&&typeof f=="function"&&o.push(f),a())},h=i(()=>n.call(s&&s.instances[r],e,t,u));let d=Promise.resolve(h);n.length<3&&(d=d.then(u)),d.catch(f=>l(f))})}function fp(n,e,t,s,r=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(xP(l)){const u=(l.__vccOpts||l)[e];u&&i.push(Rr(u,t,s,o,a,r))}else{let u=l();i.push(()=>u.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const d=mB(h)?h.default:h;o.mods[a]=h,o.components[a]=d;const f=(d.__vccOpts||d)[e];return f&&Rr(f,t,s,o,a,r)()}))}}return i}function HB(n,e){const t=[],s=[],r=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>Ca(u,a))?s.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>Ca(u,l))||r.push(l))}return[t,s,r]}let QB=()=>location.protocol+"//"+location.host;function qP(n,e){const{pathname:t,search:s,hash:r}=e,i=n.indexOf("#");if(i>-1){let o=r.includes(n.slice(i))?n.slice(i).length:1,a=r.slice(o);return a[0]!=="/"&&(a="/"+a),wT(a,"")}return wT(t,n)+s+r}function YB(n,e,t,s){let r=[],i=[],o=null;const a=({state:f})=>{const _=qP(n,location),E=t.value,T=e.value;let C=0;if(f){if(t.value=_,e.value=f,o&&o===E){o=null;return}C=T?f.position-T.position:0}else s(_);r.forEach(L=>{L(t.value,E,{delta:C,type:xm.pop,direction:C?C>0?dp.forward:dp.back:dp.unknown})})};function l(){o=t.value}function u(f){r.push(f);const _=()=>{const E=r.indexOf(f);E>-1&&r.splice(E,1)};return i.push(_),_}function h(){if(document.visibilityState==="hidden"){const{history:f}=window;if(!f.state)return;f.replaceState(Ge({},f.state,{scroll:df()}),"")}}function d(){for(const f of i)f();i=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",h),document.removeEventListener("visibilitychange",h)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",h),document.addEventListener("visibilitychange",h),{pauseListeners:l,listen:u,destroy:d}}function CT(n,e,t,s=!1,r=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:r?df():null}}function JB(n){const{history:e,location:t}=window,s={value:qP(n,t)},r={value:e.state};r.value||i(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,h){const d=n.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:QB()+n+l;try{e[h?"replaceState":"pushState"](u,"",f),r.value=u}catch(_){console.error(_),t[h?"replace":"assign"](f)}}function o(l,u){i(l,Ge({},e.state,CT(r.value.back,l,r.value.forward,!0),u,{position:r.value.position}),!0),s.value=l}function a(l,u){const h=Ge({},r.value,e.state,{forward:l,scroll:df()});i(h.current,h,!0),i(l,Ge({},CT(s.value,l,null),{position:h.position+1},u),!1),s.value=l}return{location:s,state:r,push:a,replace:o}}function XB(n){n=OB(n);const e=JB(n),t=YB(n,e.state,e.location,e.replace);function s(i,o=!0){o||t.pauseListeners(),history.go(i)}const r=Ge({location:"",base:n,go:s,createHref:LB.bind(null,n)},e,t);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>e.state.value}),r}let Oi=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.Group=2]="Group",n})({});var Vt=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.ParamRegExp=2]="ParamRegExp",n[n.ParamRegExpEnd=3]="ParamRegExpEnd",n[n.EscapeNext=4]="EscapeNext",n})(Vt||{});const ZB={type:Oi.Static,value:""},e3=/[a-zA-Z0-9_]/;function t3(n){if(!n)return[[]];if(n==="/")return[[ZB]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${u}": ${_}`)}let t=Vt.Static,s=t;const r=[];let i;function o(){i&&r.push(i),i=[]}let a=0,l,u="",h="";function d(){u&&(t===Vt.Static?i.push({type:Oi.Static,value:u}):t===Vt.Param||t===Vt.ParamRegExp||t===Vt.ParamRegExpEnd?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:Oi.Param,value:u,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function f(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==Vt.ParamRegExp){s=t,t=Vt.EscapeNext;continue}switch(t){case Vt.Static:l==="/"?(u&&d(),o()):l===":"?(d(),t=Vt.Param):f();break;case Vt.EscapeNext:f(),t=s;break;case Vt.Param:l==="("?t=Vt.ParamRegExp:e3.test(l)?f():(d(),t=Vt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case Vt.ParamRegExp:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=Vt.ParamRegExpEnd:h+=l;break;case Vt.ParamRegExpEnd:d(),t=Vt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===Vt.ParamRegExp&&e(`Unfinished custom RegExp for param "${u}"`),d(),o(),r}const PT="[^/]+?",n3={sensitive:!1,strict:!1,start:!0,end:!0};var gn=(function(n){return n[n._multiplier=10]="_multiplier",n[n.Root=90]="Root",n[n.Segment=40]="Segment",n[n.SubSegment=30]="SubSegment",n[n.Static=40]="Static",n[n.Dynamic=20]="Dynamic",n[n.BonusCustomRegExp=10]="BonusCustomRegExp",n[n.BonusWildcard=-50]="BonusWildcard",n[n.BonusRepeatable=-20]="BonusRepeatable",n[n.BonusOptional=-8]="BonusOptional",n[n.BonusStrict=.7000000000000001]="BonusStrict",n[n.BonusCaseSensitive=.25]="BonusCaseSensitive",n})(gn||{});const s3=/[.+*?^${}()[\]/\\]/g;function r3(n,e){const t=Ge({},n3,e),s=[];let r=t.start?"^":"";const i=[];for(const u of n){const h=u.length?[]:[gn.Root];t.strict&&!u.length&&(r+="/");for(let d=0;d<u.length;d++){const f=u[d];let _=gn.Segment+(t.sensitive?gn.BonusCaseSensitive:0);if(f.type===Oi.Static)d||(r+="/"),r+=f.value.replace(s3,"\\$&"),_+=gn.Static;else if(f.type===Oi.Param){const{value:E,repeatable:T,optional:C,regexp:L}=f;i.push({name:E,repeatable:T,optional:C});const U=L||PT;if(U!==PT){_+=gn.BonusCustomRegExp;try{`${U}`}catch(k){throw new Error(`Invalid custom RegExp for param "${E}" (${U}): `+k.message)}}let N=T?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;d||(N=C&&u.length<2?`(?:/${N})`:"/"+N),C&&(N+="?"),r+=N,_+=gn.Dynamic,C&&(_+=gn.BonusOptional),T&&(_+=gn.BonusRepeatable),U===".*"&&(_+=gn.BonusWildcard)}h.push(_)}s.push(h)}if(t.strict&&t.end){const u=s.length-1;s[u][s[u].length-1]+=gn.BonusStrict}t.strict||(r+="/?"),t.end?r+="$":t.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const o=new RegExp(r,t.sensitive?"":"i");function a(u){const h=u.match(o),d={};if(!h)return null;for(let f=1;f<h.length;f++){const _=h[f]||"",E=i[f-1];d[E.name]=_&&E.repeatable?_.split("/"):_}return d}function l(u){let h="",d=!1;for(const f of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const _ of f)if(_.type===Oi.Static)h+=_.value;else if(_.type===Oi.Param){const{value:E,repeatable:T,optional:C}=_,L=E in u?u[E]:"";if(us(L)&&!T)throw new Error(`Provided param "${E}" is an array but it is not repeatable (* or + modifiers)`);const U=us(L)?L.join("/"):L;if(!U)if(C)f.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${E}"`);h+=U}}return h||"/"}return{re:o,score:s,keys:i,parse:a,stringify:l}}function i3(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===gn.Static+gn.Segment?-1:1:n.length>e.length?e.length===1&&e[0]===gn.Static+gn.Segment?1:-1:0}function $P(n,e){let t=0;const s=n.score,r=e.score;for(;t<s.length&&t<r.length;){const i=i3(s[t],r[t]);if(i)return i;t++}if(Math.abs(r.length-s.length)===1){if(NT(s))return 1;if(NT(r))return-1}return r.length-s.length}function NT(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const o3={strict:!1,end:!0,sensitive:!1};function a3(n,e,t){const s=r3(t3(n.path),t),r=Ge(s,{record:n,parent:e,children:[],alias:[]});return e&&!r.record.aliasOf==!e.record.aliasOf&&e.children.push(r),r}function l3(n,e){const t=[],s=new Map;e=TT(o3,e);function r(d){return s.get(d)}function i(d,f,_){const E=!_,T=xT(d);T.aliasOf=_&&_.record;const C=TT(e,d),L=[T];if("alias"in d){const k=typeof d.alias=="string"?[d.alias]:d.alias;for(const G of k)L.push(xT(Ge({},T,{components:_?_.record.components:T.components,path:G,aliasOf:_?_.record:T})))}let U,N;for(const k of L){const{path:G}=k;if(f&&G[0]!=="/"){const J=f.record.path,b=J[J.length-1]==="/"?"":"/";k.path=f.record.path+(G&&b+G)}if(U=a3(k,f,C),_?_.alias.push(U):(N=N||U,N!==U&&N.alias.push(U),E&&d.name&&!DT(U)&&o(d.name)),jP(U)&&l(U),T.children){const J=T.children;for(let b=0;b<J.length;b++)i(J[b],U,_&&_.children[b])}_=_||U}return N?()=>{o(N)}:sc}function o(d){if(UP(d)){const f=s.get(d);f&&(s.delete(d),t.splice(t.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=t.indexOf(d);f>-1&&(t.splice(f,1),d.record.name&&s.delete(d.record.name),d.children.forEach(o),d.alias.forEach(o))}}function a(){return t}function l(d){const f=h3(d,t);t.splice(f,0,d),d.record.name&&!DT(d)&&s.set(d.record.name,d)}function u(d,f){let _,E={},T,C;if("name"in d&&d.name){if(_=s.get(d.name),!_)throw Pa(wt.MATCHER_NOT_FOUND,{location:d});C=_.record.name,E=Ge(kT(f.params,_.keys.filter(N=>!N.optional).concat(_.parent?_.parent.keys.filter(N=>N.optional):[]).map(N=>N.name)),d.params&&kT(d.params,_.keys.map(N=>N.name))),T=_.stringify(E)}else if(d.path!=null)T=d.path,_=t.find(N=>N.re.test(T)),_&&(E=_.parse(T),C=_.record.name);else{if(_=f.name?s.get(f.name):t.find(N=>N.re.test(f.path)),!_)throw Pa(wt.MATCHER_NOT_FOUND,{location:d,currentLocation:f});C=_.record.name,E=Ge({},f.params,d.params),T=_.stringify(E)}const L=[];let U=_;for(;U;)L.unshift(U.record),U=U.parent;return{name:C,path:T,params:E,matched:L,meta:u3(L)}}n.forEach(d=>i(d));function h(){t.length=0,s.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:r}}function kT(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function xT(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:c3(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function c3(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function DT(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function u3(n){return n.reduce((e,t)=>Ge(e,t.meta),{})}function h3(n,e){let t=0,s=e.length;for(;t!==s;){const i=t+s>>1;$P(n,e[i])<0?s=i:t=i+1}const r=d3(n);return r&&(s=e.lastIndexOf(r,s-1)),s}function d3(n){let e=n;for(;e=e.parent;)if(jP(e)&&$P(n,e)===0)return e}function jP({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function VT(n){const e=ts(ff),t=ts(py),s=he(()=>{const l=ze(n.to);return e.resolve(l)}),r=he(()=>{const{matched:l}=s.value,{length:u}=l,h=l[u-1],d=t.matched;if(!h||!d.length)return-1;const f=d.findIndex(Ca.bind(null,h));if(f>-1)return f;const _=OT(l[u-2]);return u>1&&OT(h)===_&&d[d.length-1].path!==_?d.findIndex(Ca.bind(null,l[u-2])):f}),i=he(()=>r.value>-1&&g3(t.params,s.value.params)),o=he(()=>r.value>-1&&r.value===t.matched.length-1&&FP(t.params,s.value.params));function a(l={}){if(_3(l)){const u=e[ze(n.replace)?"replace":"push"](ze(n.to)).catch(sc);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:s,href:he(()=>s.value.href),isActive:i,isExactActive:o,navigate:a}}function f3(n){return n.length===1?n[0]:n}const p3=yw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:VT,setup(n,{slots:e}){const t=md(VT(n)),{options:s}=ts(ff),r=he(()=>({[MT(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[MT(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&f3(e.default(t));return n.custom?i:Kw("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:r.value},i)}}}),m3=p3;function _3(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function g3(n,e){for(const t in e){const s=e[t],r=n[t];if(typeof s=="string"){if(s!==r)return!1}else if(!us(r)||r.length!==s.length||s.some((i,o)=>i.valueOf()!==r[o].valueOf()))return!1}return!0}function OT(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const MT=(n,e,t)=>n??e??t,y3=yw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=ts(Vm),r=he(()=>n.route||s.value),i=ts(RT,0),o=he(()=>{let u=ze(i);const{matched:h}=r.value;let d;for(;(d=h[u])&&!d.components;)u++;return u}),a=he(()=>r.value.matched[o.value]);Bu(RT,he(()=>o.value+1)),Bu(zB,a),Bu(Vm,r);const l=Ae();return Gs(()=>[l.value,a.value,n.name],([u,h,d],[f,_,E])=>{h&&(h.instances[d]=u,_&&_!==h&&u&&u===f&&(h.leaveGuards.size||(h.leaveGuards=_.leaveGuards),h.updateGuards.size||(h.updateGuards=_.updateGuards))),u&&h&&(!_||!Ca(h,_)||!f)&&(h.enterCallbacks[d]||[]).forEach(T=>T(u))},{flush:"post"}),()=>{const u=r.value,h=n.name,d=a.value,f=d&&d.components[h];if(!f)return LT(t.default,{Component:f,route:u});const _=d.props[h],E=_?_===!0?u.params:typeof _=="function"?_(u):_:null,C=Kw(f,Ge({},E,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(d.instances[h]=null)},ref:l}));return LT(t.default,{Component:C,route:u})||C}}});function LT(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const v3=y3;function E3(n){const e=l3(n.routes,n),t=n.parseQuery||KB,s=n.stringifyQuery||ST,r=n.history,i=wl(),o=wl(),a=wl(),l=Q0(Ir);let u=Ir;Vo&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=up.bind(null,j=>""+j),d=up.bind(null,CB),f=up.bind(null,Oc);function _(j,fe){let ae,_e;return UP(j)?(ae=e.getRecordMatcher(j),_e=fe):_e=j,e.addRoute(_e,ae)}function E(j){const fe=e.getRecordMatcher(j);fe&&e.removeRoute(fe)}function T(){return e.getRoutes().map(j=>j.record)}function C(j){return!!e.getRecordMatcher(j)}function L(j,fe){if(fe=Ge({},fe||l.value),typeof j=="string"){const V=hp(t,j,fe.path),q=e.resolve({path:V.path},fe),K=r.createHref(V.fullPath);return Ge(V,q,{params:f(q.params),hash:Oc(V.hash),redirectedFrom:void 0,href:K})}let ae;if(j.path!=null)ae=Ge({},j,{path:hp(t,j.path,fe.path).path});else{const V=Ge({},j.params);for(const q in V)V[q]==null&&delete V[q];ae=Ge({},j,{params:d(V)}),fe.params=d(fe.params)}const _e=e.resolve(ae,fe),Me=j.hash||"";_e.params=h(f(_e.params));const I=kB(s,Ge({},j,{hash:AB(Me),path:_e.path})),S=r.createHref(I);return Ge({fullPath:I,hash:Me,query:s===ST?WB(j.query):j.query||{}},_e,{redirectedFrom:void 0,href:S})}function U(j){return typeof j=="string"?hp(t,j,l.value.path):Ge({},j)}function N(j,fe){if(u!==j)return Pa(wt.NAVIGATION_CANCELLED,{from:fe,to:j})}function k(j){return b(j)}function G(j){return k(Ge(U(j),{replace:!0}))}function J(j,fe){const ae=j.matched[j.matched.length-1];if(ae&&ae.redirect){const{redirect:_e}=ae;let Me=typeof _e=="function"?_e(j,fe):_e;return typeof Me=="string"&&(Me=Me.includes("?")||Me.includes("#")?Me=U(Me):{path:Me},Me.params={}),Ge({query:j.query,hash:j.hash,params:Me.path!=null?{}:j.params},Me)}}function b(j,fe){const ae=u=L(j),_e=l.value,Me=j.state,I=j.force,S=j.replace===!0,V=J(ae,_e);if(V)return b(Ge(U(V),{state:typeof V=="object"?Ge({},Me,V.state):Me,force:I,replace:S}),fe||ae);const q=ae;q.redirectedFrom=fe;let K;return!I&&xB(s,_e,ae)&&(K=Pa(wt.NAVIGATION_DUPLICATED,{to:q,from:_e}),pn(_e,_e,!0,!1)),(K?Promise.resolve(K):P(q,_e)).catch($=>xs($)?xs($,wt.NAVIGATION_GUARD_REDIRECT)?$:ft($):se($,q,_e)).then($=>{if($){if(xs($,wt.NAVIGATION_GUARD_REDIRECT))return b(Ge({replace:S},U($.to),{state:typeof $.to=="object"?Ge({},Me,$.to.state):Me,force:I}),fe||q)}else $=x(q,_e,!0,S,Me);return R(q,_e,$),$})}function v(j,fe){const ae=N(j,fe);return ae?Promise.reject(ae):Promise.resolve()}function A(j){const fe=ie.values().next().value;return fe&&typeof fe.runWithContext=="function"?fe.runWithContext(j):j()}function P(j,fe){let ae;const[_e,Me,I]=HB(j,fe);ae=fp(_e.reverse(),"beforeRouteLeave",j,fe);for(const V of _e)V.leaveGuards.forEach(q=>{ae.push(Rr(q,j,fe))});const S=v.bind(null,j,fe);return ae.push(S),et(ae).then(()=>{ae=[];for(const V of i.list())ae.push(Rr(V,j,fe));return ae.push(S),et(ae)}).then(()=>{ae=fp(Me,"beforeRouteUpdate",j,fe);for(const V of Me)V.updateGuards.forEach(q=>{ae.push(Rr(q,j,fe))});return ae.push(S),et(ae)}).then(()=>{ae=[];for(const V of I)if(V.beforeEnter)if(us(V.beforeEnter))for(const q of V.beforeEnter)ae.push(Rr(q,j,fe));else ae.push(Rr(V.beforeEnter,j,fe));return ae.push(S),et(ae)}).then(()=>(j.matched.forEach(V=>V.enterCallbacks={}),ae=fp(I,"beforeRouteEnter",j,fe,A),ae.push(S),et(ae))).then(()=>{ae=[];for(const V of o.list())ae.push(Rr(V,j,fe));return ae.push(S),et(ae)}).catch(V=>xs(V,wt.NAVIGATION_CANCELLED)?V:Promise.reject(V))}function R(j,fe,ae){a.list().forEach(_e=>A(()=>_e(j,fe,ae)))}function x(j,fe,ae,_e,Me){const I=N(j,fe);if(I)return I;const S=fe===Ir,V=Vo?history.state:{};ae&&(_e||S?r.replace(j.fullPath,Ge({scroll:S&&V&&V.scroll},Me)):r.push(j.fullPath,Me)),l.value=j,pn(j,fe,ae,S),ft()}let w;function nt(){w||(w=r.listen((j,fe,ae)=>{if(!le.listening)return;const _e=L(j),Me=J(_e,le.currentRoute.value);if(Me){b(Ge(Me,{replace:!0,force:!0}),_e).catch(sc);return}u=_e;const I=l.value;Vo&&BB(AT(I.fullPath,ae.delta),df()),P(_e,I).catch(S=>xs(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_CANCELLED)?S:xs(S,wt.NAVIGATION_GUARD_REDIRECT)?(b(Ge(U(S.to),{force:!0}),_e).then(V=>{xs(V,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&!ae.delta&&ae.type===xm.pop&&r.go(-1,!1)}).catch(sc),Promise.reject()):(ae.delta&&r.go(-ae.delta,!1),se(S,_e,I))).then(S=>{S=S||x(_e,I,!1),S&&(ae.delta&&!xs(S,wt.NAVIGATION_CANCELLED)?r.go(-ae.delta,!1):ae.type===xm.pop&&xs(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&r.go(-1,!1)),R(_e,I,S)}).catch(sc)}))}let Ut=wl(),lt=wl(),Fe;function se(j,fe,ae){ft(j);const _e=lt.list();return _e.length?_e.forEach(Me=>Me(j,fe,ae)):console.error(j),Promise.reject(j)}function re(){return Fe&&l.value!==Ir?Promise.resolve():new Promise((j,fe)=>{Ut.add([j,fe])})}function ft(j){return Fe||(Fe=!j,nt(),Ut.list().forEach(([fe,ae])=>j?ae(j):fe()),Ut.reset()),j}function pn(j,fe,ae,_e){const{scrollBehavior:Me}=n;if(!Vo||!Me)return Promise.resolve();const I=!ae&&qB(AT(j.fullPath,0))||(_e||!ae)&&history.state&&history.state.scroll||null;return dw().then(()=>Me(j,fe,I)).then(S=>S&&UB(S)).catch(S=>se(S,j,fe))}const xt=j=>r.go(j);let ue;const ie=new Set,le={currentRoute:l,listening:!0,addRoute:_,removeRoute:E,clearRoutes:e.clearRoutes,hasRoute:C,getRoutes:T,resolve:L,options:n,push:k,replace:G,go:xt,back:()=>xt(-1),forward:()=>xt(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:lt.add,isReady:re,install(j){j.component("RouterLink",m3),j.component("RouterView",v3),j.config.globalProperties.$router=le,Object.defineProperty(j.config.globalProperties,"$route",{enumerable:!0,get:()=>ze(l)}),Vo&&!ue&&l.value===Ir&&(ue=!0,k(r.location).catch(_e=>{}));const fe={};for(const _e in Ir)Object.defineProperty(fe,_e,{get:()=>l.value[_e],enumerable:!0});j.provide(ff,le),j.provide(py,lw(fe)),j.provide(Vm,l);const ae=j.unmount;ie.add(j),j.unmount=function(){ie.delete(j),ie.size<1&&(u=Ir,w&&w(),w=null,l.value=Ir,ue=!1,Fe=!1),ae()}}};function et(j){return j.reduce((fe,ae)=>fe.then(()=>A(ae)),Promise.resolve())}return le}function Ha(){return ts(ff)}function I3(n){return ts(py)}function T3(n){const e=String(n).toLowerCase();return e==="test"?"test":e==="preview"?"preview":"prod"}function w3(){const n=he(()=>T3("test")),e=he(()=>{switch(n.value){case"test":return"";case"preview":return"";case"prod":return"";default:return""}});return{envKey:n,envLabel:e}}const Nn=(n,e)=>{const t=n.__vccOpts||n;for(const[s,r]of e)t[s]=r;return t},b3={class:"top-bar-area"},A3={class:"top-bar-content"},S3={class:"center-area"},R3=["data-ready"],C3={class:"right-area"},P3=["data-env"],N3={class:"auth-text"},k3={class:"auth-icon"},x3={__name:"TheTopBar",setup(n){const{kstString:e,isKstTimeReady:t}=aP(),{user:s,signInWithGoogle:r,signOutUser:i}=ty(),{loadForUser:o,clearUserState:a,unsubscribe:l}=_o(),{world:u}=dy(),{envKey:h,envLabel:d}=w3(),f=he(()=>!!s.value?.uid),_=he(()=>!!yn);async function E(){if(f.value){try{await i()}finally{try{l()}catch{}try{a()}catch{}}return}try{const T=await r();_.value&&T?.uid&&await o(T.uid,u.value)}catch(T){console.error("[auth] login failed",T),alert(` : ${T?.code||T?.message||T}`)}}return(T,C)=>(Y(),X("header",b3,[g("div",A3,[C[1]||(C[1]=g("div",{class:"left-area"},[g("h1",{class:"game-title"},"RCTS")],-1)),g("div",S3,[C[0]||(C[0]=g("span",{class:"time-label"},"KST",-1)),g("span",{class:"time-value","data-ready":ze(t)},ye(ze(t)?ze(e):"SYNC"),9,R3)]),g("div",C3,[g("span",{class:"env-badge","data-env":ze(h)},ye(ze(d)),9,P3),g("button",{class:"auth-btn",type:"button",onClick:E},[g("span",N3,ye(f.value?"":""),1),g("span",k3,ye(f.value?"":""),1)])])])]))}},D3=Nn(x3,[["__scopeId","data-v-bd04a5f0"]]),V3=["bus","truck","rail","plane","ship","spaceship"],ch={bus:{name:"",icon:""},truck:{name:"",icon:""},rail:{name:"",icon:""},plane:{name:"",icon:""},ship:{name:"",icon:""},spaceship:{name:"",icon:""}};function Fu(n,e=1){const t=Number(e||1);return hi.find(r=>(r.effects||[]).some(i=>i.type==="UNLOCK_TRANSPORT_TIER"&&i.transportId===n&&Number(i.tier||1)===t))?.id??null}function O3(){return hi.filter(t=>(t.effects||[]).some(s=>s?.type==="UNLOCK_STARTER_FLEET_PREVIEW")).map(t=>{const s=(t.effects||[]).find(i=>i?.type==="UNLOCK_STARTER_FLEET_PREVIEW")||null,r=s?{transports:Array.isArray(s.transports)?s.transports.filter(Boolean):[],runTimeMinSec:Number(s.runTimeMinSec||0),runTimeMaxSec:Number(s.runTimeMaxSec||0),countPerTransport:Number(s.countPerTransport||1)}:null;return{researchId:t.id,config:r}})}function GP(){const n=_o(),e=he(()=>O3()),t=he(()=>{const f=n.completedIds.value,_=e.value||[];return!f||_.length===0?!1:_.some(E=>E?.researchId&&f.has(E.researchId))}),s=he(()=>{const f=n.completedIds.value,_=e.value||[];return _.length&&((f?_.find(T=>T?.researchId&&f.has(T.researchId)):null)?.researchId??_[0]?.researchId)||null}),r=he(()=>{const f=n.completedIds.value,_=e.value||[];return _.length?(f?_.find(T=>T?.researchId&&f.has(T.researchId)):null)?.config??_[0]?.config??null:null}),i=he(()=>{const f=r.value;return f?new Set(f.transports||[]):new Set}),o=he(()=>{const f=i.value,_=t.value;return V3.map(E=>{const T=ch[E]||{},C=T.name??E,L=T.icon??"",N=Number(n.unlockedTransportTiers.value?.[E]||0)<1,k=Fu(E,1),G=!!k&&n.activeResearch.value?.id===k;let J=null,b=null;G&&n.activeResearch.value&&(J=new Date(n.activeResearch.value.startedAtMs),b=new Date(n.activeResearch.value.endsAtMs));const v=f.has(E),A=!!_&&!N&&v;return{id:E,name:C,icon:L,locked:N,isResearching:G,researchStartTime:J,researchFinishTime:b,unlockResearchId:k,previewEligible:v,previewActive:A,previewLabel:A?"  ":null}})}),a=he(()=>o.value.filter(f=>f.locked)),l=he(()=>o.value.filter(f=>!f.locked));function u(f){const _=Fu(f,1);_&&n.startResearch(_)}function h(f){const _=Fu(f,1);return _?n.getResearchProgress(_):0}function d(f){const _=Fu(f,1);return _?n.getResearchRemainingTime(_):"00h 00m 00s"}return{transportTypes:o,lockedTransports:a,unlockedTransports:l,unlockTransport:u,getResearchProgress:h,getResearchRemainingTime:d,previewResearchId:s,previewConfig:r,previewStarterFleetUnlocked:t}}const FT=Ae(null);function M3(){return{selectedTransportId:FT,setSelectedTransportId:e=>{FT.value=e}}}const KP="rcts.preview.runs.v2",L3=60,F3=30*L3,U3=3*3600;function B3(n,e){const t=Math.ceil(n),s=Math.floor(e);return Math.floor(Math.random()*(s-t+1))+t}function q3(){try{const n=localStorage.getItem(KP);if(!n)return null;const e=JSON.parse(n);return!e||typeof e!="object"?null:e}catch{return null}}function bl(n){try{localStorage.setItem(KP,JSON.stringify(n))}catch{}}function Tr(n,e){const t={transportId:n,status:"idle",startedAtMs:null,endsAtMs:null,durationSec:0,routeName:" "};if(!e||typeof e!="object")return t;const s=e.status==="running"||e.status==="idle"||e.status==="ready"?e.status:"idle";return{...t,...e,transportId:e.transportId||n,status:s,routeName:e.routeName||" "}}function $3(){const n=_o(),{transportTypes:e}=GP(),{formatRemainMs:t}=lP(),s=he(()=>!!n.completedIds.value?.has?.("sys_preview_starter_vehicles")),r=he(()=>!!n.completedIds.value?.has?.("sys_preview_auto_assign")),i=he(()=>{const N=e.value||[];return new Set(N.filter(k=>k?.previewActive).map(k=>k.id))}),o=Ae({}),a=Ae(Date.now()),l=q3();l?.runs&&typeof l.runs=="object"&&(o.value=l.runs),Vl(()=>{const N=o.value||{};let k=!1;for(const[G,J]of Object.entries(N)){const b=Tr(G,J);(!J?.status||J.status!==b.status||J.routeName!==b.routeName)&&(N[G]=b,k=!0)}k&&(o.value={...N},bl({runs:o.value}))});function u(N,k=Date.now()){const G=B3(F3,U3),J=Tr(N,o.value?.[N]);o.value[N]={...J,transportId:N,status:"running",startedAtMs:k,endsAtMs:k+G*1e3,durationSec:G,routeName:" "}}function h(N=Date.now()){if(!s.value||!r.value)return!1;const k=i.value;if(!k||k.size===0)return!1;let G=!1;for(const J of k){const b=Tr(J,o.value?.[J]);if(b.status!=="running")u(J,N),G=!0;else{const v=Number(b.endsAtMs||0);(!v||v<=N)&&(u(J,N),G=!0)}}return G&&bl({runs:o.value}),G}Vl(()=>{if(!s.value)return;const N=i.value;if(!N||N.size===0)return;let k=!1;for(const G of N)o.value?.[G]||(u(G,Date.now()),k=!0);k&&bl({runs:o.value}),h(Date.now())});let d=null;function f(){d||(d=setInterval(()=>{if(a.value=Date.now(),!s.value)return;const N=a.value,k=i.value;let G=!1;r.value&&h(N)&&(G=!0);for(const J of Object.keys(o.value||{})){if(!k.has(J))continue;const b=Tr(J,o.value[J]);if(b.status!=="running")continue;const v=Number(b.endsAtMs||0);v&&N>=v&&(r.value?u(J,N):o.value[J]={...b,status:"ready",startedAtMs:null,endsAtMs:v,durationSec:b.durationSec||0,routeName:" "},G=!0)}G&&bl({runs:o.value})},1e3))}function _(){d&&(clearInterval(d),d=null)}Vl(()=>{if(!s.value){_();return}f(),P0(()=>{_()})});function E(N){const k=a.value;if(!i.value.has(N))return 0;const G=Tr(N,o.value?.[N]);if(G.status!=="running")return 0;const J=Number(G.endsAtMs||0);return J?Math.max(0,J-k):0}function T(N){return t(E(N))}function C(N){return i.value.has(N)?Tr(N,o.value?.[N]).status:"idle"}function L(N){return!s.value||!i.value.has(N)||r.value||Tr(N,o.value?.[N]).status!=="ready"?!1:(u(N,Date.now()),bl({runs:o.value}),a.value=Date.now(),!0)}const U=he(()=>{const N=i.value;return Object.values(o.value||{}).map(G=>Tr(G.transportId,G)).filter(G=>N.has(G.transportId)).sort((G,J)=>String(G.transportId).localeCompare(String(J.transportId)))});return{previewUnlocked:s,autoAssignUnlocked:r,runs:o,runList:U,remainingOf:T,statusOf:C,startManualRun:L}}const j3={class:"layout-area left-area"},G3={class:"left-panel-wrapper"},K3={class:"panel transport-list-container"},W3={class:"panel-head"},z3={class:"panel-meta"},H3={key:0,class:"transport-list"},Q3=["onClick"],Y3={class:"transport-icon"},J3={class:"transport-name"},X3={key:1,class:"placeholder-box"},Z3={class:"panel transport-details-container"},eq={class:"panel-head"},tq={class:"panel-heading"},nq={key:0,class:"panel-meta"},sq={key:0,class:"placeholder-box"},rq={key:1,class:"details-content"},iq={class:"kv"},oq={class:"kv-row"},aq={class:"v"},lq={class:"kv-row"},cq={class:"v"},uq={class:"kv-row"},hq={class:"v"},dq={key:0,class:"lock-box"},fq={key:0,class:"preview-placeholder"},pq={key:1,class:"preview-box"},mq={class:"box-desc"},_q={key:0,class:"preview-placeholder"},gq={key:1,class:"preview-data"},yq={class:"preview-left"},vq={class:"preview-title"},Eq={class:"preview-sub"},Iq={key:0,class:"preview-right"},Tq={class:"preview-remain mono"},wq={key:1,class:"preview-right"},bq={key:0,class:"preview-right"},Aq={class:"preview-remain mono"},Sq={key:1,class:"preview-right"},Rq=["onClick"],Cq={class:"details-footnote"},Pq={class:"panel resource-container"},Nq={class:"panel-head"},kq={class:"panel-meta"},xq={key:0,class:"placeholder-box"},Dq={key:1,class:"resource-content"},Vq={__name:"TheLeftArea",setup(n){const e=_o(),{transportTypes:t,unlockedTransports:s,previewStarterFleetUnlocked:r,previewConfig:i}=GP(),o=he(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),a=he(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),{selectedTransportId:l,setSelectedTransportId:u}=M3(),h=he(()=>s.value||[]),d=he(()=>l.value&&(t.value||[]).find(N=>N.id===l.value)||null),f=he(()=>{const N=new Set((s.value||[]).map(J=>J.id)),k=i.value;return(k&&Array.isArray(k.transports)&&k.transports.length>0?k.transports:["bus","truck","rail"]).some(J=>N.has(J))}),{runList:_,remainingOf:E,statusOf:T,startManualRun:C,autoAssignUnlocked:L}=$3();function U(N){return(t.value||[]).find(G=>G.id===N)?.name??N}return(N,k)=>(Y(),X("aside",j3,[g("div",G3,[g("section",K3,[g("div",W3,[k[0]||(k[0]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",z3,ye(h.value.length)+"",1)]),h.value.length>0?(Y(),X("ul",H3,[(Y(!0),X(qe,null,Xt(h.value,G=>(Y(),X("li",{key:G.id,class:Yo(["transport-item",{active:ze(l)===G.id}]),onClick:J=>ze(u)(G.id)},[g("span",Y3,ye(G.icon),1),g("span",J3,ye(G.name),1),k[1]||(k[1]=g("span",{class:"transport-count"},"0",-1))],10,Q3))),128))])):(Y(),X("div",X3,[...k[2]||(k[2]=[g("p",{class:"placeholder-text"},"     .   . ",-1)])]))]),g("section",Z3,[g("div",eq,[g("h3",tq,ye(d.value?`${d.value.name} `:"  "),1),d.value?(Y(),X("span",nq,"ID: "+ye(d.value.id),1)):At("",!0)]),d.value?(Y(),X("div",rq,[g("div",iq,[g("div",oq,[k[4]||(k[4]=g("span",{class:"k"},"",-1)),g("span",aq,ye(d.value.icon),1)]),g("div",lq,[k[5]||(k[5]=g("span",{class:"k"},"",-1)),g("span",cq,ye(d.value.name),1)]),k[7]||(k[7]=g("div",{class:"kv-row"},[g("span",{class:"k"}," "),g("span",{class:"v"},"0")],-1)),g("div",uq,[k[6]||(k[6]=g("span",{class:"k"}," ",-1)),g("span",hq,ye(d.value.locked?"":""),1)])]),k[19]||(k[19]=g("hr",{class:"divider"},null,-1)),ze(r)?(Y(),X("div",pq,[k[18]||(k[18]=g("p",{class:"box-title"},"   ",-1)),g("p",mq,[k[12]||(k[12]=Qt(" (): ",-1)),g("strong",null,ye(a.value?"":""),1)]),ze(_).length===0?(Y(),X("div",_q,[...k[13]||(k[13]=[g("p",{class:"placeholder-text"},"      . (/   ) ",-1)])])):(Y(),X("div",gq,[(Y(!0),X(qe,null,Xt(ze(_),G=>(Y(),X("div",{class:"preview-row",key:G.transportId},[g("div",yq,[g("div",vq,ye(U(G.transportId)),1),g("div",Eq,ye(G.routeName),1)]),ze(L)?(Y(),X(qe,{key:0},[ze(T)(G.transportId)==="running"?(Y(),X("div",Iq,[k[14]||(k[14]=g("div",{class:"preview-pill"},"",-1)),g("div",Tq,ye(ze(E)(G.transportId)),1)])):(Y(),X("div",wq,[...k[15]||(k[15]=[g("div",{class:"preview-idle-text"}," ",-1),g("div",{class:"preview-remain mono"},"00:00",-1)])]))],64)):(Y(),X(qe,{key:1},[ze(T)(G.transportId)==="running"?(Y(),X("div",bq,[k[16]||(k[16]=g("div",{class:"preview-pill"},"",-1)),g("div",Aq,ye(ze(E)(G.transportId)),1)])):(Y(),X("div",Sq,[k[17]||(k[17]=g("div",{class:"preview-idle-text"},"",-1)),g("button",{class:"preview-btn",type:"button",onClick:J=>ze(C)(G.transportId)},"    ",8,Rq)]))],64))]))),128))]))])):(Y(),X("div",dq,[k[9]||(k[9]=g("p",{class:"box-title"},"    ",-1)),k[10]||(k[10]=g("p",{class:"box-desc"},[Qt("  "),g("strong",null,"  "),Qt("  ,  "),g("strong",null," / "),Qt(" . ")],-1)),k[11]||(k[11]=g("p",{class:"box-desc subtle"}," (    .) ",-1)),f.value?At("",!0):(Y(),X("div",fq,[...k[8]||(k[8]=[g("p",{class:"placeholder-text"}," :           . ",-1)])]))])),g("p",Cq,"  "+ye(d.value.name)+"       . ",1)])):(Y(),X("div",sq,[...k[3]||(k[3]=[g("p",{class:"placeholder-text"},"     .",-1)])]))]),g("section",Pq,[g("div",Nq,[k[20]||(k[20]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",kq,ye(o.value?"":""),1)]),o.value?(Y(),X("div",Dq,[...k[22]||(k[22]=[g("div",{class:"kv"},[g("div",{class:"kv-row"},[g("span",{class:"k"},""),g("span",{class:"v"},"$10,000")])],-1)])])):(Y(),X("div",xq,[...k[21]||(k[21]=[g("p",{class:"placeholder-text"}," .",-1)])]))])])]))}},WP=Nn(Vq,[["__scopeId","data-v-c2ac4b92"]]),Oq={class:"layout-area center-area"},Mq={class:"center-content-wrapper"},Lq={class:"main-content-nav desktop-only","aria-label":"Main navigation"},Fq={class:"nav-list"},Uq={class:"nav-item"},Bq={class:"nav-item"},qq={class:"nav-item"},$q={class:"nav-item"},jq={class:"nav-item"},Gq={class:"nav-item"},Kq={class:"nav-item"},Wq={class:"mobile-nav mobile-only","aria-label":"Mobile navigation header"},zq=["aria-expanded"],Hq={class:"mobile-title"},Qq={class:"mobile-title-text"},Yq={class:"drawer",role:"dialog","aria-modal":"true","aria-label":"Main menu"},Jq={class:"drawer-body"},Xq={class:"main-content-display"},wr="/game/main",Zq={__name:"TheCenterArea",setup(n){const e=Ha(),t=I3(),s=Ae(!1);function r(){s.value=!1}function i(){s.value=!s.value}const o={preview:`${wr}/preview`,research:`${wr}/research`,vehicles:`${wr}/vehicles`,line:`${wr}/line`,construction:`${wr}/construction`,finance:`${wr}/finance`,city:`${wr}/city`,settings:`${wr}/settings`};function a(h){r(),e.push(h)}const l=he(()=>{const h=t.path||"",d=h.includes("/game/main/preview")||h.includes("/home/preview"),f=h.includes("/game/main/research")||h.includes("/home/research"),_=h.includes("/game/main/vehicles")||h.includes("/home/vehicles"),E=h.includes("/game/main/line")||h.includes("/home/line"),T=h.includes("/game/main/construction")||h.includes("/home/construction"),C=h.includes("/game/main/finance")||h.includes("/home/finance"),L=h.includes("/game/main/city")||h.includes("/home/city"),U=h.includes("/game/main/settings")||h.includes("/home/settings");return d?" ":f?"":_?"":E?"":T?"":C?"":L?"":U?"":""});Gs(()=>t.fullPath,()=>r());function u(h){h.key==="Escape"&&r()}return Gs(s,h=>{document.body.style.overflow=h?"hidden":""}),Ym(()=>{window.addEventListener("keydown",u)}),Tw(()=>{window.removeEventListener("keydown",u),document.body.style.overflow=""}),(h,d)=>{const f=ac("router-link"),_=ac("router-view");return Y(),X("div",Oq,[g("div",Mq,[g("nav",Lq,[g("ul",Fq,[g("li",Uq,[He(f,{to:o.research},{default:Hn(()=>[...d[8]||(d[8]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Bq,[He(f,{to:o.vehicles},{default:Hn(()=>[...d[9]||(d[9]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",qq,[He(f,{to:o.line},{default:Hn(()=>[...d[10]||(d[10]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",$q,[He(f,{to:o.construction},{default:Hn(()=>[...d[11]||(d[11]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",jq,[He(f,{to:o.finance},{default:Hn(()=>[...d[12]||(d[12]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Gq,[He(f,{to:o.city},{default:Hn(()=>[...d[13]||(d[13]=[Qt("",-1)])]),_:1},8,["to"])]),g("li",Kq,[He(f,{to:o.settings},{default:Hn(()=>[...d[14]||(d[14]=[Qt("",-1)])]),_:1},8,["to"])])])]),g("div",Wq,[g("button",{class:"hamburger-btn",type:"button","aria-label":"Open menu","aria-expanded":s.value?"true":"false",onClick:i},[...d[15]||(d[15]=[g("span",{class:"hamburger-icon"},"",-1),g("span",{class:"hamburger-label"},"",-1)])],8,zq),g("div",Hq,[g("span",Qq,ye(l.value),1)])]),s.value?(Y(),X("div",{key:0,class:"drawer-overlay mobile-only",role:"presentation",onClick:Qw(r,["self"])},[g("aside",Yq,[g("div",{class:"drawer-head"},[d[16]||(d[16]=g("div",{class:"drawer-title"},"RCTS ",-1)),g("button",{class:"drawer-close",type:"button","aria-label":"Close menu",onClick:r},"  ")]),g("div",Jq,[g("button",{class:"drawer-item drawer-item-preview",type:"button",onClick:d[0]||(d[0]=E=>a(o.preview))},"   "),g("button",{class:"drawer-item",type:"button",onClick:d[1]||(d[1]=E=>a(o.research))},""),g("button",{class:"drawer-item",type:"button",onClick:d[2]||(d[2]=E=>a(o.vehicles))},""),g("button",{class:"drawer-item",type:"button",onClick:d[3]||(d[3]=E=>a(o.line))},""),g("button",{class:"drawer-item",type:"button",onClick:d[4]||(d[4]=E=>a(o.construction))},""),g("button",{class:"drawer-item",type:"button",onClick:d[5]||(d[5]=E=>a(o.finance))},""),g("button",{class:"drawer-item",type:"button",onClick:d[6]||(d[6]=E=>a(o.city))},""),g("button",{class:"drawer-item",type:"button",onClick:d[7]||(d[7]=E=>a(o.settings))},"")]),d[17]||(d[17]=g("div",{class:"drawer-foot"},[g("div",{class:"drawer-hint"},"     . ")],-1))])])):At("",!0),g("div",Xq,[He(_)])])])}}},e9=Nn(Zq,[["__scopeId","data-v-c939df10"]]),t9={class:"game-wrapper"},n9={class:"main-layout"},s9={__name:"HomeView",setup(n){return(e,t)=>(Y(),X("div",t9,[He(D3),g("div",n9,[He(WP,{class:"layout-area left-area desktop-only"}),He(e9,{class:"layout-area center-area"})])]))}},r9=Nn(s9,[["__scopeId","data-v-baa77003"]]),i9={class:"research-page"},o9={class:"research-header"},a9={class:"status-row"},l9={key:0,class:"badge ok"},c9={class:"badge"},u9={class:"panel"},h9={class:"panel-head"},d9={class:"panel-actions"},f9=["disabled"],p9={key:0,class:"empty"},m9={key:1,class:"empty"},_9={key:2,class:"list"},g9={class:"card"},y9={class:"card-mid"},v9={class:"name-row"},E9={class:"name"},I9={class:"meta"},T9={class:"pill time"},w9={key:0,class:"pill fixed"},b9={key:0,class:"hint2"},A9={class:"progress-area"},S9={class:"progress-bar"},R9={class:"progress-info"},C9={class:"mono"},P9={key:1,class:"queue-row"},N9={class:"queue-title"},k9={key:2,class:"queue-list"},x9={class:"mono"},D9=["onClick"],V9={class:"panel"},O9={key:0,class:"empty"},M9={key:1,class:"empty"},L9={key:2,class:"list"},F9={class:"card-left"},U9={class:"icon"},B9={class:"card-mid"},q9={class:"name-row"},$9={class:"name"},j9={class:"meta"},G9={key:0,class:"pill"},K9={key:0,class:"hint2"},W9={class:"card-right"},z9=["disabled","onClick"],H9={class:"card-left"},Q9={class:"icon"},Y9={class:"card-mid"},J9={class:"name-row"},X9={class:"name"},Z9={class:"meta"},e$={class:"pill time"},t$={key:0,class:"pill fixed"},n$={key:1,class:"pill"},s$={key:2,class:"pill"},r$={key:0,class:"hint2"},i$={key:1,class:"hint2"},o$={class:"card-right"},a$=["disabled","onClick"],l$={class:"panel"},c$={key:0,class:"empty"},u$={key:1,class:"empty"},h$={key:2,class:"list"},d$={class:"card-mid"},f$={class:"name-row"},p$={class:"name"},m$={class:"meta"},_$={class:"pill lock"},g$={class:"pill time"},y$={key:0,class:"pill fixed"},v$={key:0,class:"hint2"},E$={key:1,class:"hint2"},I$={key:2,class:"hint2"},T$={__name:"ResearchView",setup(n){const e=_o(),t=he(()=>e.isHydrated.value),s=e.firstUnlockTransportId,r=e.needsFirstUnlockSelection,i=e.firstUnlockCandidates,o=he(()=>e.activeResearch.value),a=he(()=>e.queuedResearchIds.value||[]),l=he(()=>e.queueReserveLevel.value||1),u=he(()=>e.queueLimit.value||1),h=he(()=>e.queueCount.value||0),d=he(()=>e.isQueueFull.value),f=he(()=>!!e.saveEnabled.value&&!!e.isStateLoaded.value&&!e.isSavingFirebaseData.value);function _(ue){return ch[ue]?.name??ue}function E(ue){return e.catalog.find(ie=>ie.id===ue)||null}function T(ue){return E(ue)?.title??ue}function C(ue){return ue?ue.timePolicy==="FIXED"?!0:ue.type==="SYSTEM":!1}function L(ue){return C(E(ue))}function U(ue){const ie=Math.max(0,Number(ue||0));if(!ie)return"";if(ie<3600)return`${Math.max(1,Math.round(ie/60))}`;const le=Math.floor(ie/3600),et=Math.round(ie%3600/60);return et>0?`${le} ${et}`:`${le}`}function N(ue){const ie=Number(ue?.durationSec||0),le=C(ue),et=U(ie);return et===""?"":le?`: ${et}`:`: ${et}`}function k(ue){return N(E(ue))}function G(ue){return(ue.effects||[]).find(le=>le?.type==="UNLOCK_TRANSPORT_TIER"&&Number(le?.tier||1)===1)?.transportId||null}function J(ue,ie){const le=G(ue);return!le||!ie.has(le)?null:{key:`first-${le}`,transportId:le,icon:ch[le]?.icon??"",title:`${ch[le]?.name??le}  `,desc:" 1  ."}}const b=he(()=>{const ue=e.visibleCatalog.value||[];if(s.value)return[];const ie=new Set((i.value||[]).map(le=>le.id));return ue.map(le=>J(le,ie)).filter(Boolean)});function v(ue,ie){const le=String(ue?.title??"").trim(),et=String(ie?.title??"").trim();return le.localeCompare(et,"ko")}function A(ue){return{id:ue.id,title:ue.title??ue.id,desc:ue.desc??"",durationLabel:N(ue),fixed:C(ue),type:ue.type,domain:ue.domain}}const P=he(()=>(e.visibleCatalog.value||[]).filter(ie=>e.getStatus(ie.id)==="available").map(A).sort(v)),R=he(()=>(e.visibleCatalog.value||[]).map(ie=>{const le=e.getStatus(ie.id);return le!=="locked"&&le!=="comingSoon"?null:{...A(ie),status:le,statusLabel:le==="comingSoon"?"":"",lockReason:"  ."}}).filter(Boolean).sort(v));function x(ue){const ie=String(ue?.type||"");return ie==="SYSTEM"?"":ie==="CITY"?"":ie==="TRANSPORT"?"":ie==="EFFICIENCY"?"":String(ue?.id||"").startsWith("sys_preview_")?"":""}function w(ue){return a.value.includes(ue)}function nt(ue){return o.value?w(ue)?"":d.value?" ":"":" "}function Ut(ue){e.setFirstUnlockTransport(ue)}function lt(ue){e.startResearch(ue)}function Fe(ue){e.cancelQueuedResearch(ue)}function se(){e.cancelAllQueuedResearch()}function re(ue){return e.getResearchProgress(ue)}function ft(ue){return e.getResearchRemainingTime(ue)}function pn(ue){e.saveNow(ue)}function xt(){console.log("[ResearchView Debug]"),console.log("queueReserveLevel:",l.value),console.log("queueLimit:",u.value),console.log("queuedResearchIds:",a.value);const ue=(e.visibleCatalog.value||[]).filter(ie=>String(ie?.id||"").startsWith("sys_preview_"));console.log("[Preview durations]",ue.map(ie=>({id:ie.id,sec:ie.durationSec,label:N(ie)})))}return(ue,ie)=>(Y(),X("div",i9,[g("header",o9,[ie[1]||(ie[1]=g("h1",{class:"title"},"",-1)),ie[2]||(ie[2]=g("p",{class:"desc"},"    1 .        . ",-1)),g("div",a9,[g("span",{class:Yo(["badge",{ok:t.value}])},ye(t.value?"  ":"  "),3),g("span",{class:Yo(["badge",{warn:ze(r)}])},ye(ze(r)?"  ()":"  "),3),ze(s)?(Y(),X("span",l9,"  : "+ye(_(ze(s))),1)):At("",!0),g("span",c9," : "+ye(h.value)+"/"+ye(u.value)+" (Lv"+ye(l.value)+") ",1)])]),g("section",u9,[g("div",h9,[ie[3]||(ie[3]=g("h2",{class:"panel-title"}," ",-1)),g("div",d9,[g("button",{class:"btn",disabled:!f.value,onClick:ie[0]||(ie[0]=le=>pn({reason:"manual"}))},"   ",8,f9),g("button",{class:"btn ghost",onClick:xt},"   ")])]),t.value?o.value?(Y(),X("div",_9,[g("article",g9,[ie[6]||(ie[6]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",y9,[g("div",v9,[g("div",E9,ye(T(o.value.id)),1),g("div",I9,[ie[4]||(ie[4]=g("span",{class:"pill"},"",-1)),g("span",T9,ye(k(o.value.id)),1),L(o.value.id)?(Y(),X("span",w9,"")):At("",!0)])]),L(o.value.id)?(Y(),X("div",b9,"    ,     . ")):At("",!0),g("div",A9,[g("div",S9,[g("div",{class:"progress-fill",style:fd({transform:`scaleX(${Math.max(0,Math.min(100,re(o.value.id)))/100})`})},null,4)]),g("div",R9,[g("span",null,ye(re(o.value.id).toFixed(1))+"%",1),g("span",C9,": "+ye(ft(o.value.id)),1)])]),a.value.length>0?(Y(),X("div",P9,[ie[5]||(ie[5]=g("span",{class:"pill"},"",-1)),g("span",N9,ye(a.value.length)+" ",1),g("button",{class:"btn small ghost",onClick:se}," ")])):At("",!0),a.value.length>0?(Y(),X("div",k9,[(Y(!0),X(qe,null,Xt(a.value,le=>(Y(),X("div",{key:le,class:"queue-item"},[g("span",x9,ye(T(le)),1),g("button",{class:"btn small ghost",onClick:et=>Fe(le)},"",8,D9)]))),128))])):At("",!0)]),ie[7]||(ie[7]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))])])):(Y(),X("div",m9,"    .     . ")):(Y(),X("div",p9," "))]),g("section",V9,[ie[9]||(ie[9]=g("h2",{class:"panel-title"}," ( )",-1)),ie[10]||(ie[10]=g("p",{class:"panel-desc"},"     (  )   .       . ",-1)),t.value?P.value.length===0&&b.value.length===0?(Y(),X("div",M9,"     . ")):(Y(),X("div",L9,[(Y(!0),X(qe,null,Xt(b.value,le=>(Y(),X("article",{key:le.key,class:"card"},[g("div",F9,[g("div",U9,ye(le.icon),1)]),g("div",B9,[g("div",q9,[g("div",$9,ye(le.title),1),g("div",j9,[ie[8]||(ie[8]=g("span",{class:"pill time"},"",-1)),ze(r)?(Y(),X("span",G9,"")):At("",!0)])]),le.desc?(Y(),X("div",K9,ye(le.desc),1)):At("",!0)]),g("div",W9,[g("button",{class:"btn primary",disabled:!!o.value||!t.value,onClick:et=>Ut(le.transportId)},"   ",8,z9)])]))),128)),(Y(!0),X(qe,null,Xt(P.value,le=>(Y(),X("article",{key:le.id,class:"card"},[g("div",H9,[g("div",Q9,ye(x(le)),1)]),g("div",Y9,[g("div",J9,[g("div",X9,ye(le.title),1),g("div",Z9,[g("span",e$,ye(le.durationLabel),1),le.fixed?(Y(),X("span",t$,"")):At("",!0),o.value?(Y(),X("span",n$,"")):(Y(),X("span",s$,""))])]),le.desc?(Y(),X("div",r$,ye(le.desc),1)):At("",!0),le.fixed?(Y(),X("div",i$,"        .")):At("",!0)]),g("div",o$,[g("button",{class:"btn primary",disabled:!t.value||o.value&&d.value&&!w(le.id),onClick:et=>lt(le.id)},ye(nt(le.id)),9,a$)])]))),128))])):(Y(),X("div",O9," "))]),g("section",l$,[ie[13]||(ie[13]=g("h2",{class:"panel-title"},"  ",-1)),ie[14]||(ie[14]=g("p",{class:"panel-desc"},"     .        . ",-1)),t.value?R.value.length===0?(Y(),X("div",u$,"/  .")):(Y(),X("div",h$,[(Y(!0),X(qe,null,Xt(R.value,le=>(Y(),X("article",{key:le.id,class:"card"},[ie[11]||(ie[11]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",d$,[g("div",f$,[g("div",p$,ye(le.title),1),g("div",m$,[g("span",_$,ye(le.statusLabel),1),g("span",g$,ye(le.durationLabel),1),le.fixed?(Y(),X("span",y$,"")):At("",!0)])]),le.desc?(Y(),X("div",v$,ye(le.desc),1)):At("",!0),le.status==="comingSoon"?(Y(),X("div",E$,".")):le.status==="locked"?(Y(),X("div",I$,ye(le.lockReason||"  ."),1)):At("",!0)]),ie[12]||(ie[12]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))]))),128))])):(Y(),X("div",c$," "))])]))}},w$=Nn(T$,[["__scopeId","data-v-b9cdda19"]]),b$={class:"page"},A$={class:"panel"},S$={class:"list"},R$={class:"panel"},C$={class:"grid"},P$={class:"table"},N$={__name:"VehiclesView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",b$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"     .      .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",A$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-e2a4d6c8><h2 class="panel-title" data-v-e2a4d6c8> </h2><div class="panel-actions" data-v-e2a4d6c8><button class="btn" disabled data-v-e2a4d6c8> </button><button class="btn" disabled data-v-e2a4d6c8></button><button class="btn ghost" disabled data-v-e2a4d6c8></button></div></div><div class="empty" data-v-e2a4d6c8>   . <span class="mono" data-v-e2a4d6c8> ( 8)</span>     . </div>',2)),g("div",S$,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-e2a4d6c8><div class="icon" data-v-e2a4d6c8></div></div><div class="card-mid" data-v-e2a4d6c8><div class="name-row" data-v-e2a4d6c8><div class="name" data-v-e2a4d6c8>  </div><div class="meta" data-v-e2a4d6c8><span class="pill lock" data-v-e2a4d6c8></span><span class="pill time" data-v-e2a4d6c8></span></div></div><div class="hint2" data-v-e2a4d6c8>  :  ////  UI . </div></div><div class="card-right" data-v-e2a4d6c8><button class="btn primary" disabled data-v-e2a4d6c8></button></div>',3)])])),64))])]),g("section",R$,[r[9]||(r[9]=g("h2",{class:"panel-title"},"",-1)),r[10]||(r[10]=g("p",{class:"panel-desc"},"      .",-1)),g("div",C$,[(Y(),X(qe,null,Xt(4,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",P$,[r[8]||(r[8]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(6,i=>g("div",{class:"table-row",key:i},[...r[7]||(r[7]=[ns('<span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span>',5)])])),64))])])]))}},k$=Nn(N$,[["__scopeId","data-v-e2a4d6c8"]]),x$={class:"page"},D$={class:"panel"},V$={class:"list"},O$={class:"panel"},M$={class:"table"},L$={__name:"LineView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",x$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",D$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-58d6af1b><h2 class="panel-title" data-v-58d6af1b> </h2><div class="panel-actions" data-v-58d6af1b><button class="btn" disabled data-v-58d6af1b> </button><button class="btn" disabled data-v-58d6af1b> </button><button class="btn ghost" disabled data-v-58d6af1b> </button></div></div><div class="empty" data-v-58d6af1b>   .       . </div>',2)),g("div",V$,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-58d6af1b><div class="icon" data-v-58d6af1b></div></div><div class="card-mid" data-v-58d6af1b><div class="name-row" data-v-58d6af1b><div class="name" data-v-58d6af1b>  </div><div class="meta" data-v-58d6af1b><span class="pill lock" data-v-58d6af1b></span><span class="pill time" data-v-58d6af1b></span></div></div><div class="hint2" data-v-58d6af1b>  : ,  , , /  . </div></div><div class="card-right" data-v-58d6af1b><button class="btn primary" disabled data-v-58d6af1b></button></div>',3)])])),64))])]),g("section",O$,[r[8]||(r[8]=g("h2",{class:"panel-title"},"",-1)),r[9]||(r[9]=g("p",{class:"panel-desc"},"    / .",-1)),g("div",M$,[r[7]||(r[7]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(8,i=>g("div",{class:"table-row",key:i},[...r[6]||(r[6]=[ns('<span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span>',5)])])),64))])])]))}},F$=Nn(L$,[["__scopeId","data-v-58d6af1b"]]),U$={class:"page"},B$={class:"panel"},q$={class:"list"},$$={class:"panel"},j$={class:"grid"},G$={__name:"ConstructionView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",U$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," /     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",B$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-f1dc01af><h2 class="panel-title" data-v-f1dc01af> </h2><div class="panel-actions" data-v-f1dc01af><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button></div></div><div class="empty" data-v-f1dc01af>   .       . </div>',2)),g("div",q$,[(Y(),X(qe,null,Xt(10,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-f1dc01af><div class="icon" data-v-f1dc01af></div></div><div class="card-mid" data-v-f1dc01af><div class="name-row" data-v-f1dc01af><div class="name" data-v-f1dc01af>  </div><div class="meta" data-v-f1dc01af><span class="pill lock" data-v-f1dc01af></span><span class="pill time" data-v-f1dc01af></span></div></div><div class="hint2" data-v-f1dc01af>  : //,  ,    UI . </div></div><div class="card-right" data-v-f1dc01af><button class="btn primary" disabled data-v-f1dc01af></button></div>',3)])])),64))])]),g("section",$$,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /   /   .",-1)),g("div",j$,[(Y(),X(qe,null,Xt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},K$=Nn(G$,[["__scopeId","data-v-f1dc01af"]]),W$={class:"page"},z$={class:"panel"},H$={class:"grid"},Q$={class:"table"},Y$={__name:"FinanceView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",W$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//    .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",z$,[r[7]||(r[7]=ns('<div class="panel-head" data-v-d1892e60><h2 class="panel-title" data-v-d1892e60> </h2><div class="panel-actions" data-v-d1892e60><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn ghost" disabled data-v-d1892e60></button></div></div><div class="empty" data-v-d1892e60>   .       . </div>',2)),g("div",H$,[(Y(),X(qe,null,Xt(4,i=>g("div",{class:"mini-card",key:i},[...r[4]||(r[4]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",Q$,[r[6]||(r[6]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(qe,null,Xt(8,i=>g("div",{class:"table-row",key:i},[...r[5]||(r[5]=[g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1)])])),64))])])]))}},J$=Nn(Y$,[["__scopeId","data-v-d1892e60"]]),X$={class:"page"},Z$={class:"panel"},e5={class:"list"},t5={class:"panel"},n5={class:"grid"},s5={__name:"CityView",setup(n){const e=Ha();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",X$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," //     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",Z$,[r[5]||(r[5]=ns('<div class="panel-head" data-v-370df6f4><h2 class="panel-title" data-v-370df6f4> </h2><div class="panel-actions" data-v-370df6f4><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn ghost" disabled data-v-370df6f4></button></div></div><div class="empty" data-v-370df6f4>   .  /     . </div>',2)),g("div",e5,[(Y(),X(qe,null,Xt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[ns('<div class="card-left" data-v-370df6f4><div class="icon" data-v-370df6f4></div></div><div class="card-mid" data-v-370df6f4><div class="name-row" data-v-370df6f4><div class="name" data-v-370df6f4>  </div><div class="meta" data-v-370df6f4><span class="pill lock" data-v-370df6f4></span><span class="pill time" data-v-370df6f4></span></div></div><div class="hint2" data-v-370df6f4>  : /// ,  , ,   . </div></div><div class="card-right" data-v-370df6f4><button class="btn primary" disabled data-v-370df6f4></button></div>',3)])])),64))])]),g("section",t5,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /  /  .",-1)),g("div",n5,[(Y(),X(qe,null,Xt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},r5=Nn(s5,[["__scopeId","data-v-370df6f4"]]),i5={},o5={class:"settings-shell"},a5={class:"settings-nav"},l5={class:"settings-content"};function c5(n,e){return Y(),X("div",o5,[g("aside",a5,[uv(n.$slots,"nav",{},void 0)]),g("section",l5,[uv(n.$slots,"content",{},void 0)])])}const u5=Nn(i5,[["render",c5],["__scopeId","data-v-e20a5156"]]),h5={},d5={class:"settings-nav-inner"},f5={class:"menu"};function p5(n,e){const t=ac("router-link");return Y(),X("nav",d5,[e[1]||(e[1]=g("h3",{class:"title"},"",-1)),g("ul",f5,[g("li",null,[He(t,{to:{name:"DataManager"}},{default:Hn(()=>[...e[0]||(e[0]=[Qt("   ",-1)])]),_:1})])])])}const m5=Nn(h5,[["render",p5],["__scopeId","data-v-0036c63e"]]),_5={__name:"SettingsView",setup(n){return(e,t)=>{const s=ac("router-view");return Y(),Zo(u5,null,{nav:Hn(()=>[He(m5)]),content:Hn(()=>[He(s)]),_:1})}}},g5={class:"data-manager"},y5={class:"card"},v5={class:"kv"},E5={class:"v"},I5={class:"kv"},T5={class:"v"},w5={class:"kv"},b5={class:"v"},A5={key:0,class:"hint"},S5={key:1,class:"hint"},R5={class:"card"},C5={class:"row"},P5=["disabled"],N5=["disabled"],k5=["disabled"],x5={class:"autosave"},D5={class:"autosave-controls"},V5={class:"radio"},O5=["disabled"],M5={class:"radio"},L5=["disabled"],F5={class:"radio"},U5=["disabled"],B5={key:0,class:"hint"},q5={key:0,class:"message"},$5={key:1,class:"preview"},j5={class:"preview-head"},G5={class:"summary"},K5={class:"summary-item"},W5={class:"summary-v"},z5={class:"summary-item"},H5={class:"summary-v"},Q5={class:"summary-item"},Y5={class:"summary-v"},J5={key:0,class:"pre"},X5={key:2,class:"hint"},Z5={class:"modal"},ej={class:"check"},tj={class:"row"},nj=["disabled"],sj=["disabled"],rj={__name:"DataManagerPanel",setup(n){const{world:e}=dy(),t=he(()=>!!yn),s=ty(),r=he(()=>s?.user?.value?.uid??null),{saveNow:i,isSavingFirebaseData:o,autoSaveEnabled:a,autoSaveBase:l,autoSaveIntervalMin:u,setAutoSaveEnabled:h,setAutoSaveBase:d,setAutoSaveIntervalMin:f,autoSaveRunning:_}=_o(),E=he(()=>o.value),T=Ae(!1),C=Ae(""),L=Ae(!1),U=Ae(null),N=Ae(!1);function k(se){return JSON.stringify(se,null,2)}function G(se){if(!se)return"-";try{return typeof se?.toDate=="function"?se.toDate().toLocaleString():se instanceof Date?se.toLocaleString():typeof se=="number"?new Date(se).toLocaleString():String(se)}catch{return String(se)}}function J(se){return String(se||"").toLowerCase()==="dev"?"dev":"prod"}function b(se,re){if(!t.value)return null;const ft=J(re);return Ug(yn,"worlds",ft,"users",se,"research","state")}const v=Ae("off");function A(){if(!a.value){v.value="off";return}const se=Number(l.value),re=Number(u.value);se===10&&re===10?v.value="10":se===5&&re===5?v.value="5":se===10?v.value="10":v.value="5"}Gs([a,l,u],()=>A(),{immediate:!0}),Gs(v,se=>{if(r.value&&t.value){if(se==="off"){h(!1);return}if(se==="5"){d(5),f(5),h(!0);return}se==="10"&&(d(10),f(10),h(!0))}});async function P(){if(r.value){if(!t.value){C.value="DEV   .";return}C.value="";try{await i({reason:"manual-ui"}),C.value=" ."}catch(se){console.error("DataManager: save failed",se),C.value=` : ${String(se?.message??se)}`}}}async function R(){if(r.value){if(!t.value){C.value="DEV   .";return}T.value=!0,C.value="",L.value=!1,U.value=null,N.value=!1;try{const se=b(r.value,e.value);if(!se)throw new Error("REMOTE_DISABLED");const re=await XC(se);re.exists()?(U.value=re.data(),L.value=!0,C.value="  ."):C.value="  . ( )"}catch(se){console.error("DataManager: load failed",se),C.value=` : ${String(se?.message??se)}`}finally{T.value=!1}}}const x=Ae(!1),w=Ae(!1),nt=Ae("");function Ut(){if(!t.value){C.value="DEV   .";return}x.value=!0,w.value=!1,nt.value=""}function lt(){x.value=!1}async function Fe(){if(r.value){if(!t.value){C.value="DEV   .";return}T.value=!0,C.value="";try{const se=b(r.value,e.value);if(!se)throw new Error("REMOTE_DISABLED");await ZC(se),L.value=!1,U.value=null,N.value=!1,C.value=" .   .",lt()}catch(se){console.error("DataManager: delete failed",se),C.value=` : ${String(se?.message??se)}`}finally{T.value=!1}}}return(se,re)=>(Y(),X("div",g5,[re[24]||(re[24]=g("header",{class:"header"},[g("div",null,[g("h1",{class:"title"}," "),g("p",{class:"desc"},"   ,        . ")])],-1)),g("section",y5,[re[9]||(re[9]=g("h2",{class:"card-title"}," ",-1)),g("div",v5,[re[6]||(re[6]=g("div",{class:"k"}," ",-1)),g("div",E5,ye(r.value?"":"()"),1)]),g("div",I5,[re[7]||(re[7]=g("div",{class:"k"}," ",-1)),g("div",T5,ye(t.value?"(PROD)":"(DEV )"),1)]),g("div",w5,[re[8]||(re[8]=g("div",{class:"k"},"",-1)),g("div",b5,ye(ze(e)==="dev"?"DEV":"PROD"),1)]),r.value?r.value&&!t.value?(Y(),X("p",S5," DEV       /   . ")):At("",!0):(Y(),X("p",A5," Firestore  /   . "))]),g("section",R5,[re[18]||(re[18]=g("h2",{class:"card-title"}," ",-1)),g("div",C5,[g("button",{class:"btn",onClick:P,disabled:!r.value||!t.value||T.value||E.value},"  ",8,P5),g("button",{class:"btn",onClick:R,disabled:!r.value||!t.value||T.value},"   ",8,N5),g("button",{class:"btn danger",onClick:Ut,disabled:!r.value||!t.value||T.value},"   ",8,k5)]),g("div",x5,[re[13]||(re[13]=g("div",{class:"autosave-title"},"",-1)),g("div",D5,[g("label",V5,[hl(g("input",{type:"radio",name:"autosave",value:"off","onUpdate:modelValue":re[0]||(re[0]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,O5),[[Lf,v.value]]),re[10]||(re[10]=g("span",null,"",-1))]),g("label",M5,[hl(g("input",{type:"radio",name:"autosave",value:"5","onUpdate:modelValue":re[1]||(re[1]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,L5),[[Lf,v.value]]),re[11]||(re[11]=g("span",null,"5",-1))]),g("label",F5,[hl(g("input",{type:"radio",name:"autosave",value:"10","onUpdate:modelValue":re[2]||(re[2]=ft=>v.value=ft),disabled:!r.value||!t.value||T.value},null,8,U5),[[Lf,v.value]]),re[12]||(re[12]=g("span",null,"10",-1))])]),r.value&&t.value&&ze(a)&&ze(_)?(Y(),X("p",B5,"    (KST   ) ")):At("",!0)]),C.value?(Y(),X("p",q5,ye(C.value),1)):At("",!0),L.value?(Y(),X("div",$5,[g("div",j5,[re[14]||(re[14]=g("h3",{class:"preview-title"},"    ",-1)),g("button",{class:"btn small",onClick:re[3]||(re[3]=ft=>N.value=!N.value)},ye(N.value?"":""),1)]),g("div",G5,[g("div",K5,[re[15]||(re[15]=g("div",{class:"summary-k"},"",-1)),g("div",W5,ye(U.value?.version??"-"),1)]),g("div",z5,[re[16]||(re[16]=g("div",{class:"summary-k"},"  (legacy)",-1)),g("div",H5,ye(U.value?.transports?.length??0),1)]),g("div",Q5,[re[17]||(re[17]=g("div",{class:"summary-k"},"",-1)),g("div",Y5,ye(G(U.value?.updatedAt)),1)])]),N.value?(Y(),X("pre",J5,ye(k(U.value)),1)):At("",!0)])):(Y(),X("p",X5,"   ."))]),x.value?(Y(),X("div",{key:0,class:"modal-backdrop",onClick:Qw(lt,["self"])},[g("div",Z5,[re[20]||(re[20]=g("h2",{class:"modal-title"}," ?",-1)),re[21]||(re[21]=g("p",{class:"modal-desc danger-text"},"     .  ? ",-1)),re[22]||(re[22]=g("p",{class:"modal-desc"},[Qt("   ,  "),g("b",null," "),Qt(". ")],-1)),g("label",ej,[hl(g("input",{type:"checkbox","onUpdate:modelValue":re[4]||(re[4]=ft=>w.value=ft)},null,512),[[xN,w.value]]),re[19]||(re[19]=g("span",null,"      .",-1))]),re[23]||(re[23]=g("p",{class:"modal-desc"},[Qt("   "),g("b",null,"DELETE"),Qt(" . ")],-1)),hl(g("input",{class:"input","onUpdate:modelValue":re[5]||(re[5]=ft=>nt.value=ft),placeholder:"DELETE"},null,512),[[kN,nt.value]]),g("div",tj,[g("button",{class:"btn",onClick:lt,disabled:T.value},"",8,nj),g("button",{class:"btn danger",onClick:Fe,disabled:T.value||!w.value||nt.value!=="DELETE"},"   ",8,sj)])])])):At("",!0)]))}},ij=Nn(rj,[["__scopeId","data-v-884a6e72"]]),oj={__name:"DataManagerView",setup(n){return(e,t)=>(Y(),Zo(ij))}},aj={class:"preview-page"},lj={__name:"PreviewRunsView",setup(n){return(e,t)=>(Y(),X("div",aj,[He(WP,{class:"preview-left-as-main"})]))}},cj=Nn(lj,[["__scopeId","data-v-3aa6340f"]]),uj=[{path:"/",redirect:"/home/research"},{path:"/home",component:r9,children:[{path:"",redirect:"/home/research"},{path:"preview",name:"PreviewRuns",component:cj},{path:"research",name:"Research",component:w$},{path:"vehicles",name:"Vehicles",component:k$},{path:"line",name:"Line",component:F$},{path:"construction",name:"Construction",component:K$},{path:"finance",name:"Finance",component:J$},{path:"city",name:"City",component:r5},{path:"settings",component:_5,children:[{path:"",redirect:{name:"DataManager"}},{path:"data",name:"DataManager",component:oj}]}]}],hj=E3({history:XB("/RCTS/"),routes:uj,scrollBehavior(){return{top:0}}}),zP=LN(pB);zP.use(hj);zP.mount("#app");
