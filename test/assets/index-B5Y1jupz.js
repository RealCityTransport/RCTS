(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function sm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const rt={},ko=[],Is=()=>{},YI=()=>!1,Uh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),rm=n=>n.startsWith("onUpdate:"),fn=Object.assign,im=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},bP=Object.prototype.hasOwnProperty,je=(n,e)=>bP.call(n,e),Te=Array.isArray,Do=n=>Tc(n)==="[object Map]",Bh=n=>Tc(n)==="[object Set]",my=n=>Tc(n)==="[object Date]",Ae=n=>typeof n=="function",Nt=n=>typeof n=="string",rs=n=>typeof n=="symbol",ot=n=>n!==null&&typeof n=="object",JI=n=>(ot(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),XI=Object.prototype.toString,Tc=n=>XI.call(n),AP=n=>Tc(n).slice(8,-1),ZI=n=>Tc(n)==="[object Object]",om=n=>Nt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,bl=sm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),$h=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},SP=/-\w/g,jn=$h(n=>n.replace(SP,e=>e.slice(1).toUpperCase())),RP=/\B([A-Z])/g,eo=$h(n=>n.replace(RP,"-$1").toLowerCase()),qh=$h(n=>n.charAt(0).toUpperCase()+n.slice(1)),tf=$h(n=>n?`on${qh(n)}`:""),xr=(n,e)=>!Object.is(n,e),Au=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},eT=(n,e,t,s=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:s,value:t})},am=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let _y;const jh=()=>_y||(_y=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Gh(n){if(Te(n)){const e={};for(let t=0;t<n.length;t++){const s=n[t],r=Nt(s)?kP(s):Gh(s);if(r)for(const i in r)e[i]=r[i]}return e}else if(Nt(n)||ot(n))return n}const CP=/;(?![^(]*\))/g,PP=/:([^]+)/,NP=/\/\*[^]*?\*\//g;function kP(n){const e={};return n.replace(NP,"").split(CP).forEach(t=>{if(t){const s=t.split(PP);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function jo(n){let e="";if(Nt(n))e=n;else if(Te(n))for(let t=0;t<n.length;t++){const s=jo(n[t]);s&&(e+=s+" ")}else if(ot(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const DP="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",xP=sm(DP);function tT(n){return!!n||n===""}function VP(n,e){if(n.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<n.length;s++)t=Go(n[s],e[s]);return t}function Go(n,e){if(n===e)return!0;let t=my(n),s=my(e);if(t||s)return t&&s?n.getTime()===e.getTime():!1;if(t=rs(n),s=rs(e),t||s)return n===e;if(t=Te(n),s=Te(e),t||s)return t&&s?VP(n,e):!1;if(t=ot(n),s=ot(e),t||s){if(!t||!s)return!1;const r=Object.keys(n).length,i=Object.keys(e).length;if(r!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Go(n[o],e[o]))return!1}}return String(n)===String(e)}function nT(n,e){return n.findIndex(t=>Go(t,e))}const sT=n=>!!(n&&n.__v_isRef===!0),ye=n=>Nt(n)?n:n==null?"":Te(n)||ot(n)&&(n.toString===XI||!Ae(n.toString))?sT(n)?ye(n.value):JSON.stringify(n,rT,2):String(n),rT=(n,e)=>sT(e)?rT(n,e.value):Do(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,r],i)=>(t[nf(s,i)+" =>"]=r,t),{})}:Bh(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>nf(t))}:rs(e)?nf(e):ot(e)&&!Te(e)&&!ZI(e)?String(e):e,nf=(n,e="")=>{var t;return rs(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let tn;class OP{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=tn,!e&&tn&&(this.index=(tn.scopes||(tn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=tn;try{return tn=this,e()}finally{tn=t}}}on(){++this._on===1&&(this.prevScope=tn,tn=this)}off(){this._on>0&&--this._on===0&&(tn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function MP(){return tn}function LP(n,e=!1){tn&&tn.cleanups.push(n)}let lt;const sf=new WeakSet;class iT{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,tn&&tn.active&&tn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sf.has(this)&&(sf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||aT(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,gy(this),lT(this);const e=lt,t=Jn;lt=this,Jn=!0;try{return this.fn()}finally{cT(this),lt=e,Jn=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)um(e);this.deps=this.depsTail=void 0,gy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){qf(this)&&this.run()}get dirty(){return qf(this)}}let oT=0,Al,Sl;function aT(n,e=!1){if(n.flags|=8,e){n.next=Sl,Sl=n;return}n.next=Al,Al=n}function lm(){oT++}function cm(){if(--oT>0)return;if(Sl){let e=Sl;for(Sl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Al;){let e=Al;for(Al=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){n||(n=s)}e=t}}if(n)throw n}function lT(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function cT(n){let e,t=n.depsTail,s=t;for(;s;){const r=s.prevDep;s.version===-1?(s===t&&(t=r),um(s),FP(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=r}n.deps=e,n.depsTail=t}function qf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(uT(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function uT(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Hl)||(n.globalVersion=Hl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!qf(n))))return;n.flags|=2;const e=n.dep,t=lt,s=Jn;lt=n,Jn=!0;try{lT(n);const r=n.fn(n._value);(e.version===0||xr(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{lt=t,Jn=s,cT(n),n.flags&=-3}}function um(n,e=!1){const{dep:t,prevSub:s,nextSub:r}=n;if(s&&(s.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=s,n.nextSub=void 0),t.subs===n&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)um(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function FP(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Jn=!0;const hT=[];function Gs(){hT.push(Jn),Jn=!1}function Ks(){const n=hT.pop();Jn=n===void 0?!0:n}function gy(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=lt;lt=void 0;try{e()}finally{lt=t}}}let Hl=0;class UP{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class hm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!lt||!Jn||lt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==lt)t=this.activeLink=new UP(lt,this),lt.deps?(t.prevDep=lt.depsTail,lt.depsTail.nextDep=t,lt.depsTail=t):lt.deps=lt.depsTail=t,dT(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=lt.depsTail,t.nextDep=void 0,lt.depsTail.nextDep=t,lt.depsTail=t,lt.deps===t&&(lt.deps=s)}return t}trigger(e){this.version++,Hl++,this.notify(e)}notify(e){lm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{cm()}}}function dT(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)dT(s)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const jf=new WeakMap,Ni=Symbol(""),Gf=Symbol(""),Ql=Symbol("");function sn(n,e,t){if(Jn&&lt){let s=jf.get(n);s||jf.set(n,s=new Map);let r=s.get(t);r||(s.set(t,r=new hm),r.map=s,r.key=t),r.track()}}function Vs(n,e,t,s,r,i){const o=jf.get(n);if(!o){Hl++;return}const a=l=>{l&&l.trigger()};if(lm(),e==="clear")o.forEach(a);else{const l=Te(n),u=l&&om(t);if(l&&t==="length"){const h=Number(s);o.forEach((d,p)=>{(p==="length"||p===Ql||!rs(p)&&p>=h)&&a(d)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(Ql)),e){case"add":l?u&&a(o.get("length")):(a(o.get(Ni)),Do(n)&&a(o.get(Gf)));break;case"delete":l||(a(o.get(Ni)),Do(n)&&a(o.get(Gf)));break;case"set":Do(n)&&a(o.get(Ni));break}}cm()}function mo(n){const e=qe(n);return e===n?e:(sn(e,"iterate",Ql),$n(n)?e:e.map(is))}function Kh(n){return sn(n=qe(n),"iterate",Ql),n}function vr(n,e){return Ws(n)?ki(n)?Ko(is(e)):Ko(e):is(e)}const BP={__proto__:null,[Symbol.iterator](){return rf(this,Symbol.iterator,n=>vr(this,n))},concat(...n){return mo(this).concat(...n.map(e=>Te(e)?mo(e):e))},entries(){return rf(this,"entries",n=>(n[1]=vr(this,n[1]),n))},every(n,e){return Ns(this,"every",n,e,void 0,arguments)},filter(n,e){return Ns(this,"filter",n,e,t=>t.map(s=>vr(this,s)),arguments)},find(n,e){return Ns(this,"find",n,e,t=>vr(this,t),arguments)},findIndex(n,e){return Ns(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Ns(this,"findLast",n,e,t=>vr(this,t),arguments)},findLastIndex(n,e){return Ns(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Ns(this,"forEach",n,e,void 0,arguments)},includes(...n){return of(this,"includes",n)},indexOf(...n){return of(this,"indexOf",n)},join(n){return mo(this).join(n)},lastIndexOf(...n){return of(this,"lastIndexOf",n)},map(n,e){return Ns(this,"map",n,e,void 0,arguments)},pop(){return sl(this,"pop")},push(...n){return sl(this,"push",n)},reduce(n,...e){return yy(this,"reduce",n,e)},reduceRight(n,...e){return yy(this,"reduceRight",n,e)},shift(){return sl(this,"shift")},some(n,e){return Ns(this,"some",n,e,void 0,arguments)},splice(...n){return sl(this,"splice",n)},toReversed(){return mo(this).toReversed()},toSorted(n){return mo(this).toSorted(n)},toSpliced(...n){return mo(this).toSpliced(...n)},unshift(...n){return sl(this,"unshift",n)},values(){return rf(this,"values",n=>vr(this,n))}};function rf(n,e,t){const s=Kh(n),r=s[e]();return s!==n&&!$n(n)&&(r._next=r.next,r.next=()=>{const i=r._next();return i.done||(i.value=t(i.value)),i}),r}const $P=Array.prototype;function Ns(n,e,t,s,r,i){const o=Kh(n),a=o!==n&&!$n(n),l=o[e];if(l!==$P[e]){const d=l.apply(n,i);return a?is(d):d}let u=t;o!==n&&(a?u=function(d,p){return t.call(this,vr(n,d),p,n)}:t.length>2&&(u=function(d,p){return t.call(this,d,p,n)}));const h=l.call(o,u,s);return a&&r?r(h):h}function yy(n,e,t,s){const r=Kh(n);let i=t;return r!==n&&($n(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,vr(n,a),l,n)}),r[e](i,...s)}function of(n,e,t){const s=qe(n);sn(s,"iterate",Ql);const r=s[e](...t);return(r===-1||r===!1)&&pm(t[0])?(t[0]=qe(t[0]),s[e](...t)):r}function sl(n,e,t=[]){Gs(),lm();const s=qe(n)[e].apply(n,t);return cm(),Ks(),s}const qP=sm("__proto__,__v_isRef,__isVue"),fT=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(rs));function jP(n){rs(n)||(n=String(n));const e=qe(this);return sn(e,"has",n),e.hasOwnProperty(n)}class pT{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return i;if(t==="__v_raw")return s===(r?i?ZP:yT:i?gT:_T).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=Te(e);if(!r){let l;if(o&&(l=BP[t]))return l;if(t==="hasOwnProperty")return jP}const a=Reflect.get(e,t,cn(e)?e:s);if((rs(t)?fT.has(t):qP(t))||(r||sn(e,"get",t),i))return a;if(cn(a)){const l=o&&om(t)?a:a.value;return r&&ot(l)?Wf(l):l}return ot(a)?r?Wf(a):Wh(a):a}}class mT extends pT{constructor(e=!1){super(!1,e)}set(e,t,s,r){let i=e[t];const o=Te(e)&&om(t);if(!this._isShallow){const u=Ws(i);if(!$n(s)&&!Ws(s)&&(i=qe(i),s=qe(s)),!o&&cn(i)&&!cn(s))return u||(i.value=s),!0}const a=o?Number(t)<e.length:je(e,t),l=Reflect.set(e,t,s,cn(e)?e:r);return e===qe(r)&&(a?xr(s,i)&&Vs(e,"set",t,s):Vs(e,"add",t,s)),l}deleteProperty(e,t){const s=je(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&Vs(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(!rs(t)||!fT.has(t))&&sn(e,"has",t),s}ownKeys(e){return sn(e,"iterate",Te(e)?"length":Ni),Reflect.ownKeys(e)}}class GP extends pT{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const KP=new mT,WP=new GP,zP=new mT(!0);const Kf=n=>n,lu=n=>Reflect.getPrototypeOf(n);function HP(n,e,t){return function(...s){const r=this.__v_raw,i=qe(r),o=Do(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=r[n](...s),h=t?Kf:e?Ko:is;return!e&&sn(i,"iterate",l?Gf:Ni),{next(){const{value:d,done:p}=u.next();return p?{value:d,done:p}:{value:a?[h(d[0]),h(d[1])]:h(d),done:p}},[Symbol.iterator](){return this}}}}function cu(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function QP(n,e){const t={get(r){const i=this.__v_raw,o=qe(i),a=qe(r);n||(xr(r,a)&&sn(o,"get",r),sn(o,"get",a));const{has:l}=lu(o),u=e?Kf:n?Ko:is;if(l.call(o,r))return u(i.get(r));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(r)},get size(){const r=this.__v_raw;return!n&&sn(qe(r),"iterate",Ni),r.size},has(r){const i=this.__v_raw,o=qe(i),a=qe(r);return n||(xr(r,a)&&sn(o,"has",r),sn(o,"has",a)),r===a?i.has(r):i.has(r)||i.has(a)},forEach(r,i){const o=this,a=o.__v_raw,l=qe(a),u=e?Kf:n?Ko:is;return!n&&sn(l,"iterate",Ni),a.forEach((h,d)=>r.call(i,u(h),u(d),o))}};return fn(t,n?{add:cu("add"),set:cu("set"),delete:cu("delete"),clear:cu("clear")}:{add(r){!e&&!$n(r)&&!Ws(r)&&(r=qe(r));const i=qe(this);return lu(i).has.call(i,r)||(i.add(r),Vs(i,"add",r,r)),this},set(r,i){!e&&!$n(i)&&!Ws(i)&&(i=qe(i));const o=qe(this),{has:a,get:l}=lu(o);let u=a.call(o,r);u||(r=qe(r),u=a.call(o,r));const h=l.call(o,r);return o.set(r,i),u?xr(i,h)&&Vs(o,"set",r,i):Vs(o,"add",r,i),this},delete(r){const i=qe(this),{has:o,get:a}=lu(i);let l=o.call(i,r);l||(r=qe(r),l=o.call(i,r)),a&&a.call(i,r);const u=i.delete(r);return l&&Vs(i,"delete",r,void 0),u},clear(){const r=qe(this),i=r.size!==0,o=r.clear();return i&&Vs(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=HP(r,n,e)}),t}function dm(n,e){const t=QP(n,e);return(s,r,i)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?s:Reflect.get(je(t,r)&&r in s?t:s,r,i)}const YP={get:dm(!1,!1)},JP={get:dm(!1,!0)},XP={get:dm(!0,!1)};const _T=new WeakMap,gT=new WeakMap,yT=new WeakMap,ZP=new WeakMap;function e0(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function t0(n){return n.__v_skip||!Object.isExtensible(n)?0:e0(AP(n))}function Wh(n){return Ws(n)?n:fm(n,!1,KP,YP,_T)}function vT(n){return fm(n,!1,zP,JP,gT)}function Wf(n){return fm(n,!0,WP,XP,yT)}function fm(n,e,t,s,r){if(!ot(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=t0(n);if(i===0)return n;const o=r.get(n);if(o)return o;const a=new Proxy(n,i===2?s:t);return r.set(n,a),a}function ki(n){return Ws(n)?ki(n.__v_raw):!!(n&&n.__v_isReactive)}function Ws(n){return!!(n&&n.__v_isReadonly)}function $n(n){return!!(n&&n.__v_isShallow)}function pm(n){return n?!!n.__v_raw:!1}function qe(n){const e=n&&n.__v_raw;return e?qe(e):n}function n0(n){return!je(n,"__v_skip")&&Object.isExtensible(n)&&eT(n,"__v_skip",!0),n}const is=n=>ot(n)?Wh(n):n,Ko=n=>ot(n)?Wf(n):n;function cn(n){return n?n.__v_isRef===!0:!1}function be(n){return ET(n,!1)}function s0(n){return ET(n,!0)}function ET(n,e){return cn(n)?n:new r0(n,e)}class r0{constructor(e,t){this.dep=new hm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:qe(e),this._value=t?e:is(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||$n(e)||Ws(e);e=s?e:qe(e),xr(e,t)&&(this._rawValue=e,this._value=s?e:is(e),this.dep.trigger())}}function Ge(n){return cn(n)?n.value:n}const i0={get:(n,e,t)=>e==="__v_raw"?n:Ge(Reflect.get(n,e,t)),set:(n,e,t,s)=>{const r=n[e];return cn(r)&&!cn(t)?(r.value=t,!0):Reflect.set(n,e,t,s)}};function IT(n){return ki(n)?n:new Proxy(n,i0)}class o0{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new hm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Hl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&lt!==this)return aT(this,!0),!0}get value(){const e=this.dep.track();return uT(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function a0(n,e,t=!1){let s,r;return Ae(n)?s=n:(s=n.get,r=n.set),new o0(s,r,t)}const uu={},zu=new WeakMap;let mi;function l0(n,e=!1,t=mi){if(t){let s=zu.get(t);s||zu.set(t,s=[]),s.push(n)}}function c0(n,e,t=rt){const{immediate:s,deep:r,once:i,scheduler:o,augmentJob:a,call:l}=t,u=k=>r?k:$n(k)||r===!1||r===0?Os(k,1):Os(k);let h,d,p,_,E=!1,b=!1;if(cn(n)?(d=()=>n.value,E=$n(n)):ki(n)?(d=()=>u(n),E=!0):Te(n)?(b=!0,E=n.some(k=>ki(k)||$n(k)),d=()=>n.map(k=>{if(cn(k))return k.value;if(ki(k))return u(k);if(Ae(k))return l?l(k,2):k()})):Ae(n)?e?d=l?()=>l(n,2):n:d=()=>{if(p){Gs();try{p()}finally{Ks()}}const k=mi;mi=h;try{return l?l(n,3,[_]):n(_)}finally{mi=k}}:d=Is,e&&r){const k=d,G=r===!0?1/0:r;d=()=>Os(k(),G)}const C=MP(),F=()=>{h.stop(),C&&C.active&&im(C.effects,h)};if(i&&e){const k=e;e=(...G)=>{k(...G),F()}}let U=b?new Array(n.length).fill(uu):uu;const N=k=>{if(!(!(h.flags&1)||!h.dirty&&!k))if(e){const G=h.run();if(r||E||(b?G.some((J,w)=>xr(J,U[w])):xr(G,U))){p&&p();const J=mi;mi=h;try{const w=[G,U===uu?void 0:b&&U[0]===uu?[]:U,_];U=G,l?l(e,3,w):e(...w)}finally{mi=J}}}else h.run()};return a&&a(N),h=new iT(d),h.scheduler=o?()=>o(N,!1):N,_=k=>l0(k,!1,h),p=h.onStop=()=>{const k=zu.get(h);if(k){if(l)l(k,4);else for(const G of k)G();zu.delete(h)}},e?s?N(!0):U=h.run():o?o(N.bind(null,!0),!0):h.run(),F.pause=h.pause.bind(h),F.resume=h.resume.bind(h),F.stop=F,F}function Os(n,e=1/0,t){if(e<=0||!ot(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,cn(n))Os(n.value,e,t);else if(Te(n))for(let s=0;s<n.length;s++)Os(n[s],e,t);else if(Bh(n)||Do(n))n.forEach(s=>{Os(s,e,t)});else if(ZI(n)){for(const s in n)Os(n[s],e,t);for(const s of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,s)&&Os(n[s],e,t)}return n}function wc(n,e,t,s){try{return s?n(...s):n()}catch(r){zh(r,e,t)}}function Ss(n,e,t,s){if(Ae(n)){const r=wc(n,e,t,s);return r&&JI(r)&&r.catch(i=>{zh(i,e,t)}),r}if(Te(n)){const r=[];for(let i=0;i<n.length;i++)r.push(Ss(n[i],e,t,s));return r}}function zh(n,e,t,s=!0){const r=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||rt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let d=0;d<h.length;d++)if(h[d](n,l,u)===!1)return}a=a.parent}if(i){Gs(),wc(i,null,10,[n,l,u]),Ks();return}}u0(n,t,r,s,o)}function u0(n,e,t,s=!0,r=!1){if(r)throw n;console.error(n)}const yn=[];let ds=-1;const xo=[];let Er=null,wo=0;const TT=Promise.resolve();let Hu=null;function wT(n){const e=Hu||TT;return n?e.then(this?n.bind(this):n):e}function h0(n){let e=ds+1,t=yn.length;for(;e<t;){const s=e+t>>>1,r=yn[s],i=Yl(r);i<n||i===n&&r.flags&2?e=s+1:t=s}return e}function mm(n){if(!(n.flags&1)){const e=Yl(n),t=yn[yn.length-1];!t||!(n.flags&2)&&e>=Yl(t)?yn.push(n):yn.splice(h0(e),0,n),n.flags|=1,bT()}}function bT(){Hu||(Hu=TT.then(ST))}function d0(n){Te(n)?xo.push(...n):Er&&n.id===-1?Er.splice(wo+1,0,n):n.flags&1||(xo.push(n),n.flags|=1),bT()}function vy(n,e,t=ds+1){for(;t<yn.length;t++){const s=yn[t];if(s&&s.flags&2){if(n&&s.id!==n.uid)continue;yn.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function AT(n){if(xo.length){const e=[...new Set(xo)].sort((t,s)=>Yl(t)-Yl(s));if(xo.length=0,Er){Er.push(...e);return}for(Er=e,wo=0;wo<Er.length;wo++){const t=Er[wo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Er=null,wo=0}}const Yl=n=>n.id==null?n.flags&2?-1:1/0:n.id;function ST(n){try{for(ds=0;ds<yn.length;ds++){const e=yn[ds];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),wc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ds<yn.length;ds++){const e=yn[ds];e&&(e.flags&=-2)}ds=-1,yn.length=0,AT(),Hu=null,(yn.length||xo.length)&&ST()}}let Yt=null,RT=null;function Qu(n){const e=Yt;return Yt=n,RT=n&&n.type.__scopeId||null,e}function Wn(n,e=Yt,t){if(!e||n._n)return n;const s=(...r)=>{s._d&&Xu(-1);const i=Qu(e);let o;try{o=n(...r)}finally{Qu(i),s._d&&Xu(1)}return o};return s._n=!0,s._c=!0,s._d=!0,s}function rl(n,e){if(Yt===null)return n;const t=Jh(Yt),s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[i,o,a,l=rt]=e[r];i&&(Ae(i)&&(i={mounted:i,updated:i}),i.deep&&Os(o),s.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function di(n,e,t,s){const r=n.dirs,i=e&&e.dirs;for(let o=0;o<r.length;o++){const a=r[o];i&&(a.oldValue=i[o].value);let l=a.dir[s];l&&(Gs(),Ss(l,t,8,[n.el,a,n,e]),Ks())}}function Su(n,e){if(an){let t=an.provides;const s=an.parent&&an.parent.provides;s===t&&(t=an.provides=Object.create(s)),t[n]=e}}function Xn(n,e,t=!1){const s=h1();if(s||Oo){let r=Oo?Oo._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&Ae(e)?e.call(s&&s.proxy):e}}const f0=Symbol.for("v-scx"),p0=()=>Xn(f0);function Rl(n,e){return _m(n,null,e)}function Vr(n,e,t){return _m(n,e,t)}function _m(n,e,t=rt){const{immediate:s,deep:r,flush:i,once:o}=t,a=fn({},t),l=e&&s||!e&&i!=="post";let u;if(ec){if(i==="sync"){const _=p0();u=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=Is,_.resume=Is,_.pause=Is,_}}const h=an;a.call=(_,E,b)=>Ss(_,h,E,b);let d=!1;i==="post"?a.scheduler=_=>{kn(_,h&&h.suspense)}:i!=="sync"&&(d=!0,a.scheduler=(_,E)=>{E?_():mm(_)}),a.augmentJob=_=>{e&&(_.flags|=4),d&&(_.flags|=2,h&&(_.id=h.uid,_.i=h))};const p=c0(n,e,a);return ec&&(u?u.push(p):l&&p()),p}function m0(n,e,t){const s=this.proxy,r=Nt(n)?n.includes(".")?CT(s,n):()=>s[n]:n.bind(s,s);let i;Ae(e)?i=e:(i=e.handler,t=e);const o=bc(this),a=_m(r,i.bind(s),t);return o(),a}function CT(n,e){const t=e.split(".");return()=>{let s=n;for(let r=0;r<t.length&&s;r++)s=s[t[r]];return s}}const _0=Symbol("_vte"),g0=n=>n.__isTeleport,y0=Symbol("_leaveCb");function gm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,gm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function PT(n,e){return Ae(n)?fn({name:n.name},e,{setup:n}):n}function NT(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const Yu=new WeakMap;function Cl(n,e,t,s,r=!1){if(Te(n)){n.forEach((E,b)=>Cl(E,e&&(Te(e)?e[b]:e),t,s,r));return}if(Vo(s)&&!r){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Cl(n,e,t,s.component.subTree);return}const i=s.shapeFlag&4?Jh(s.component):s.el,o=r?null:i,{i:a,r:l}=n,u=e&&e.r,h=a.refs===rt?a.refs={}:a.refs,d=a.setupState,p=qe(d),_=d===rt?YI:E=>je(p,E);if(u!=null&&u!==l){if(Ey(e),Nt(u))h[u]=null,_(u)&&(d[u]=null);else if(cn(u)){u.value=null;const E=e;E.k&&(h[E.k]=null)}}if(Ae(l))wc(l,a,12,[o,h]);else{const E=Nt(l),b=cn(l);if(E||b){const C=()=>{if(n.f){const F=E?_(l)?d[l]:h[l]:l.value;if(r)Te(F)&&im(F,i);else if(Te(F))F.includes(i)||F.push(i);else if(E)h[l]=[i],_(l)&&(d[l]=h[l]);else{const U=[i];l.value=U,n.k&&(h[n.k]=U)}}else E?(h[l]=o,_(l)&&(d[l]=o)):b&&(l.value=o,n.k&&(h[n.k]=o))};if(o){const F=()=>{C(),Yu.delete(n)};F.id=-1,Yu.set(n,F),kn(F,t)}else Ey(n),C()}}}function Ey(n){const e=Yu.get(n);e&&(e.flags|=8,Yu.delete(n))}jh().requestIdleCallback;jh().cancelIdleCallback;const Vo=n=>!!n.type.__asyncLoader,kT=n=>n.type.__isKeepAlive;function v0(n,e){DT(n,"a",e)}function E0(n,e){DT(n,"da",e)}function DT(n,e,t=an){const s=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(Hh(e,s,t),t){let r=t.parent;for(;r&&r.parent;)kT(r.parent.vnode)&&I0(s,e,t,r),r=r.parent}}function I0(n,e,t,s){const r=Hh(e,n,s,!0);VT(()=>{im(s[e],r)},t)}function Hh(n,e,t=an,s=!1){if(t){const r=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Gs();const a=bc(t),l=Ss(e,t,n,o);return a(),Ks(),l});return s?r.unshift(i):r.push(i),i}}const Xs=n=>(e,t=an)=>{(!ec||n==="sp")&&Hh(n,(...s)=>e(...s),t)},T0=Xs("bm"),ym=Xs("m"),w0=Xs("bu"),b0=Xs("u"),xT=Xs("bum"),VT=Xs("um"),A0=Xs("sp"),S0=Xs("rtg"),R0=Xs("rtc");function C0(n,e=an){Hh("ec",n,e)}const P0="components";function Jl(n,e){return k0(P0,n,!0,e)||n}const N0=Symbol.for("v-ndc");function k0(n,e,t=!0,s=!1){const r=Yt||an;if(r){const i=r.type;{const a=_1(i,!1);if(a&&(a===e||a===jn(e)||a===qh(jn(e))))return i}const o=Iy(r[n]||i[n],e)||Iy(r.appContext[n],e);return!o&&s?i:o}}function Iy(n,e){return n&&(n[e]||n[jn(e)]||n[qh(jn(e))])}function Jt(n,e,t,s){let r;const i=t,o=Te(n);if(o||Nt(n)){const a=o&&ki(n);let l=!1,u=!1;a&&(l=!$n(n),u=Ws(n),n=Kh(n)),r=new Array(n.length);for(let h=0,d=n.length;h<d;h++)r[h]=e(l?u?Ko(is(n[h])):is(n[h]):n[h],h,void 0,i)}else if(typeof n=="number"){r=new Array(n);for(let a=0;a<n;a++)r[a]=e(a+1,a,void 0,i)}else if(ot(n))if(n[Symbol.iterator])r=Array.from(n,(a,l)=>e(a,l,void 0,i));else{const a=Object.keys(n);r=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const h=a[l];r[l]=e(n[h],h,l,i)}}else r=[];return r}function Ty(n,e,t={},s,r){if(Yt.ce||Yt.parent&&Vo(Yt.parent)&&Yt.parent.ce){const u=Object.keys(t).length>0;return e!=="default"&&(t.name=e),Y(),Wo(Be,null,[Ke("slot",t,s)],u?-2:64)}let i=n[e];i&&i._c&&(i._d=!1),Y();const o=i&&OT(i(t)),a=t.key||o&&o.key,l=Wo(Be,{key:(a&&!rs(a)?a:`_${e}`)+(!o&&s?"_fb":"")},o||[],o&&n._===1?64:-2);return i&&i._c&&(i._d=!0),l}function OT(n){return n.some(e=>Zl(e)?!(e.type===zs||e.type===Be&&!OT(e.children)):!0)?n:null}const zf=n=>n?ew(n)?Jh(n):zf(n.parent):null,Pl=fn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>zf(n.parent),$root:n=>zf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>LT(n),$forceUpdate:n=>n.f||(n.f=()=>{mm(n.update)}),$nextTick:n=>n.n||(n.n=wT.bind(n.proxy)),$watch:n=>m0.bind(n)}),af=(n,e)=>n!==rt&&!n.__isScriptSetup&&je(n,e),D0={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:r,props:i,accessCache:o,type:a,appContext:l}=n;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return s[e];case 2:return r[e];case 4:return t[e];case 3:return i[e]}else{if(af(s,e))return o[e]=1,s[e];if(r!==rt&&je(r,e))return o[e]=2,r[e];if(je(i,e))return o[e]=3,i[e];if(t!==rt&&je(t,e))return o[e]=4,t[e];Hf&&(o[e]=0)}}const u=Pl[e];let h,d;if(u)return e==="$attrs"&&sn(n.attrs,"get",""),u(n);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==rt&&je(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,je(d,e))return d[e]},set({_:n},e,t){const{data:s,setupState:r,ctx:i}=n;return af(r,e)?(r[e]=t,!0):s!==rt&&je(s,e)?(s[e]=t,!0):je(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:s,appContext:r,props:i,type:o}},a){let l;return!!(t[a]||n!==rt&&a[0]!=="$"&&je(n,a)||af(e,a)||je(i,a)||je(s,a)||je(Pl,a)||je(r.config.globalProperties,a)||(l=o.__cssModules)&&l[a])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:je(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function wy(n){return Te(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Hf=!0;function x0(n){const e=LT(n),t=n.proxy,s=n.ctx;Hf=!1,e.beforeCreate&&by(e.beforeCreate,n,"bc");const{data:r,computed:i,methods:o,watch:a,provide:l,inject:u,created:h,beforeMount:d,mounted:p,beforeUpdate:_,updated:E,activated:b,deactivated:C,beforeDestroy:F,beforeUnmount:U,destroyed:N,unmounted:k,render:G,renderTracked:J,renderTriggered:w,errorCaptured:v,serverPrefetch:A,expose:P,inheritAttrs:R,components:D,directives:T,filters:nt}=e;if(u&&V0(u,s,null),o)for(const Oe in o){const ne=o[Oe];Ae(ne)&&(s[Oe]=ne.bind(t))}if(r){const Oe=r.call(t,t);ot(Oe)&&(n.data=Wh(Oe))}if(Hf=!0,i)for(const Oe in i){const ne=i[Oe],se=Ae(ne)?ne.bind(t,t):Ae(ne.get)?ne.get.bind(t,t):Is,ht=!Ae(ne)&&Ae(ne.set)?ne.set.bind(t):Is,pn=de({get:se,set:ht});Object.defineProperty(s,Oe,{enumerable:!0,configurable:!0,get:()=>pn.value,set:kt=>pn.value=kt})}if(a)for(const Oe in a)MT(a[Oe],s,t,Oe);if(l){const Oe=Ae(l)?l.call(t):l;Reflect.ownKeys(Oe).forEach(ne=>{Su(ne,Oe[ne])})}h&&by(h,n,"c");function at(Oe,ne){Te(ne)?ne.forEach(se=>Oe(se.bind(t))):ne&&Oe(ne.bind(t))}if(at(T0,d),at(ym,p),at(w0,_),at(b0,E),at(v0,b),at(E0,C),at(C0,v),at(R0,J),at(S0,w),at(xT,U),at(VT,k),at(A0,A),Te(P))if(P.length){const Oe=n.exposed||(n.exposed={});P.forEach(ne=>{Object.defineProperty(Oe,ne,{get:()=>t[ne],set:se=>t[ne]=se,enumerable:!0})})}else n.exposed||(n.exposed={});G&&n.render===Is&&(n.render=G),R!=null&&(n.inheritAttrs=R),D&&(n.components=D),T&&(n.directives=T),A&&NT(n)}function V0(n,e,t=Is){Te(n)&&(n=Qf(n));for(const s in n){const r=n[s];let i;ot(r)?"default"in r?i=Xn(r.from||s,r.default,!0):i=Xn(r.from||s):i=Xn(r),cn(i)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[s]=i}}function by(n,e,t){Ss(Te(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,t)}function MT(n,e,t,s){let r=s.includes(".")?CT(t,s):()=>t[s];if(Nt(n)){const i=e[n];Ae(i)&&Vr(r,i)}else if(Ae(n))Vr(r,n.bind(t));else if(ot(n))if(Te(n))n.forEach(i=>MT(i,e,t,s));else{const i=Ae(n.handler)?n.handler.bind(t):e[n.handler];Ae(i)&&Vr(r,i,n)}}function LT(n){const e=n.type,{mixins:t,extends:s}=e,{mixins:r,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!r.length&&!t&&!s?l=e:(l={},r.length&&r.forEach(u=>Ju(l,u,o,!0)),Ju(l,e,o)),ot(e)&&i.set(e,l),l}function Ju(n,e,t,s=!1){const{mixins:r,extends:i}=e;i&&Ju(n,i,t,!0),r&&r.forEach(o=>Ju(n,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=O0[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const O0={data:Ay,props:Sy,emits:Sy,methods:yl,computed:yl,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:yl,directives:yl,watch:L0,provide:Ay,inject:M0};function Ay(n,e){return e?n?function(){return fn(Ae(n)?n.call(this,this):n,Ae(e)?e.call(this,this):e)}:e:n}function M0(n,e){return yl(Qf(n),Qf(e))}function Qf(n){if(Te(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function _n(n,e){return n?[...new Set([].concat(n,e))]:e}function yl(n,e){return n?fn(Object.create(null),n,e):e}function Sy(n,e){return n?Te(n)&&Te(e)?[...new Set([...n,...e])]:fn(Object.create(null),wy(n),wy(e??{})):e}function L0(n,e){if(!n)return e;if(!e)return n;const t=fn(Object.create(null),n);for(const s in e)t[s]=_n(n[s],e[s]);return t}function FT(){return{app:null,config:{isNativeTag:YI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let F0=0;function U0(n,e){return function(s,r=null){Ae(s)||(s=fn({},s)),r!=null&&!ot(r)&&(r=null);const i=FT(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:F0++,_component:s,_props:r,_container:null,_context:i,_instance:null,version:y1,get config(){return i.config},set config(h){},use(h,...d){return o.has(h)||(h&&Ae(h.install)?(o.add(h),h.install(u,...d)):Ae(h)&&(o.add(h),h(u,...d))),u},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),u},component(h,d){return d?(i.components[h]=d,u):i.components[h]},directive(h,d){return d?(i.directives[h]=d,u):i.directives[h]},mount(h,d,p){if(!l){const _=u._ceVNode||Ke(s,r);return _.appContext=i,p===!0?p="svg":p===!1&&(p=void 0),n(_,h,p),l=!0,u._container=h,h.__vue_app__=u,Jh(_.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Ss(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(h,d){return i.provides[h]=d,u},runWithContext(h){const d=Oo;Oo=u;try{return h()}finally{Oo=d}}};return u}}let Oo=null;const B0=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${jn(e)}Modifiers`]||n[`${eo(e)}Modifiers`];function $0(n,e,...t){if(n.isUnmounted)return;const s=n.vnode.props||rt;let r=t;const i=e.startsWith("update:"),o=i&&B0(s,e.slice(7));o&&(o.trim&&(r=t.map(h=>Nt(h)?h.trim():h)),o.number&&(r=t.map(am)));let a,l=s[a=tf(e)]||s[a=tf(jn(e))];!l&&i&&(l=s[a=tf(eo(e))]),l&&Ss(l,n,6,r);const u=s[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Ss(u,n,6,r)}}const q0=new WeakMap;function UT(n,e,t=!1){const s=t?q0:e.emitsCache,r=s.get(n);if(r!==void 0)return r;const i=n.emits;let o={},a=!1;if(!Ae(n)){const l=u=>{const h=UT(u,e,!0);h&&(a=!0,fn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(ot(n)&&s.set(n,null),null):(Te(i)?i.forEach(l=>o[l]=null):fn(o,i),ot(n)&&s.set(n,o),o)}function Qh(n,e){return!n||!Uh(e)?!1:(e=e.slice(2).replace(/Once$/,""),je(n,e[0].toLowerCase()+e.slice(1))||je(n,eo(e))||je(n,e))}function Ry(n){const{type:e,vnode:t,proxy:s,withProxy:r,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:h,props:d,data:p,setupState:_,ctx:E,inheritAttrs:b}=n,C=Qu(n);let F,U;try{if(t.shapeFlag&4){const k=r||s,G=k;F=ps(u.call(G,k,h,d,_,p,E)),U=a}else{const k=e;F=ps(k.length>1?k(d,{attrs:a,slots:o,emit:l}):k(d,null)),U=e.props?a:j0(a)}}catch(k){Nl.length=0,zh(k,n,1),F=Ke(zs)}let N=F;if(U&&b!==!1){const k=Object.keys(U),{shapeFlag:G}=N;k.length&&G&7&&(i&&k.some(rm)&&(U=G0(U,i)),N=zo(N,U,!1,!0))}return t.dirs&&(N=zo(N,null,!1,!0),N.dirs=N.dirs?N.dirs.concat(t.dirs):t.dirs),t.transition&&gm(N,t.transition),F=N,Qu(C),F}const j0=n=>{let e;for(const t in n)(t==="class"||t==="style"||Uh(t))&&((e||(e={}))[t]=n[t]);return e},G0=(n,e)=>{const t={};for(const s in n)(!rm(s)||!(s.slice(9)in e))&&(t[s]=n[s]);return t};function K0(n,e,t){const{props:s,children:r,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?Cy(s,o,u):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const p=h[d];if(o[p]!==s[p]&&!Qh(u,p))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?Cy(s,o,u):!0:!!o;return!1}function Cy(n,e,t){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let r=0;r<s.length;r++){const i=s[r];if(e[i]!==n[i]&&!Qh(t,i))return!0}return!1}function W0({vnode:n,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=e.vnode).el=t,e=e.parent;else break}}const BT={},$T=()=>Object.create(BT),qT=n=>Object.getPrototypeOf(n)===BT;function z0(n,e,t,s=!1){const r={},i=$T();n.propsDefaults=Object.create(null),jT(n,e,r,i);for(const o in n.propsOptions[0])o in r||(r[o]=void 0);t?n.props=s?r:vT(r):n.type.props?n.props=r:n.props=i,n.attrs=i}function H0(n,e,t,s){const{props:r,attrs:i,vnode:{patchFlag:o}}=n,a=qe(r),[l]=n.propsOptions;let u=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let p=h[d];if(Qh(n.emitsOptions,p))continue;const _=e[p];if(l)if(je(i,p))_!==i[p]&&(i[p]=_,u=!0);else{const E=jn(p);r[E]=Yf(l,a,E,_,n,!1)}else _!==i[p]&&(i[p]=_,u=!0)}}}else{jT(n,e,r,i)&&(u=!0);let h;for(const d in a)(!e||!je(e,d)&&((h=eo(d))===d||!je(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(r[d]=Yf(l,a,d,void 0,n,!0)):delete r[d]);if(i!==a)for(const d in i)(!e||!je(e,d))&&(delete i[d],u=!0)}u&&Vs(n.attrs,"set","")}function jT(n,e,t,s){const[r,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(bl(l))continue;const u=e[l];let h;r&&je(r,h=jn(l))?!i||!i.includes(h)?t[h]=u:(a||(a={}))[h]=u:Qh(n.emitsOptions,l)||(!(l in s)||u!==s[l])&&(s[l]=u,o=!0)}if(i){const l=qe(t),u=a||rt;for(let h=0;h<i.length;h++){const d=i[h];t[d]=Yf(r,l,d,u[d],n,!je(u,d))}}return o}function Yf(n,e,t,s,r,i){const o=n[t];if(o!=null){const a=je(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ae(l)){const{propsDefaults:u}=r;if(t in u)s=u[t];else{const h=bc(r);s=u[t]=l.call(null,e),h()}}else s=l;r.ce&&r.ce._setProp(t,s)}o[0]&&(i&&!a?s=!1:o[1]&&(s===""||s===eo(t))&&(s=!0))}return s}const Q0=new WeakMap;function GT(n,e,t=!1){const s=t?Q0:e.propsCache,r=s.get(n);if(r)return r;const i=n.props,o={},a=[];let l=!1;if(!Ae(n)){const h=d=>{l=!0;const[p,_]=GT(d,e,!0);fn(o,p),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return ot(n)&&s.set(n,ko),ko;if(Te(i))for(let h=0;h<i.length;h++){const d=jn(i[h]);Py(d)&&(o[d]=rt)}else if(i)for(const h in i){const d=jn(h);if(Py(d)){const p=i[h],_=o[d]=Te(p)||Ae(p)?{type:p}:fn({},p),E=_.type;let b=!1,C=!0;if(Te(E))for(let F=0;F<E.length;++F){const U=E[F],N=Ae(U)&&U.name;if(N==="Boolean"){b=!0;break}else N==="String"&&(C=!1)}else b=Ae(E)&&E.name==="Boolean";_[0]=b,_[1]=C,(b||je(_,"default"))&&a.push(d)}}const u=[o,a];return ot(n)&&s.set(n,u),u}function Py(n){return n[0]!=="$"&&!bl(n)}const vm=n=>n==="_"||n==="_ctx"||n==="$stable",Em=n=>Te(n)?n.map(ps):[ps(n)],Y0=(n,e,t)=>{if(e._n)return e;const s=Wn((...r)=>Em(e(...r)),t);return s._c=!1,s},KT=(n,e,t)=>{const s=n._ctx;for(const r in n){if(vm(r))continue;const i=n[r];if(Ae(i))e[r]=Y0(r,i,s);else if(i!=null){const o=Em(i);e[r]=()=>o}}},WT=(n,e)=>{const t=Em(e);n.slots.default=()=>t},zT=(n,e,t)=>{for(const s in e)(t||!vm(s))&&(n[s]=e[s])},J0=(n,e,t)=>{const s=n.slots=$T();if(n.vnode.shapeFlag&32){const r=e._;r?(zT(s,e,t),t&&eT(s,"_",r,!0)):KT(e,s)}else e&&WT(n,e)},X0=(n,e,t)=>{const{vnode:s,slots:r}=n;let i=!0,o=rt;if(s.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:zT(r,e,t):(i=!e.$stable,KT(e,r)),o=e}else e&&(WT(n,e),o={default:1});if(i)for(const a in r)!vm(a)&&o[a]==null&&delete r[a]},kn=s1;function Z0(n){return e1(n)}function e1(n,e){const t=jh();t.__VUE__=!0;const{insert:s,remove:r,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:h,parentNode:d,nextSibling:p,setScopeId:_=Is,insertStaticContent:E}=n,b=(I,S,V,$=null,K=null,q=null,ie=void 0,Q=null,H=!!S.dynamicChildren)=>{if(I===S)return;I&&!il(I,S)&&($=j(I),kt(I,K,q,!0),I=null),S.patchFlag===-2&&(H=!1,S.dynamicChildren=null);const{type:z,ref:ve,shapeFlag:ce}=S;switch(z){case Yh:C(I,S,V,$);break;case zs:F(I,S,V,$);break;case Ru:I==null&&U(S,V,$,ie);break;case Be:D(I,S,V,$,K,q,ie,Q,H);break;default:ce&1?G(I,S,V,$,K,q,ie,Q,H):ce&6?T(I,S,V,$,K,q,ie,Q,H):(ce&64||ce&128)&&z.process(I,S,V,$,K,q,ie,Q,H,_e)}ve!=null&&K?Cl(ve,I&&I.ref,q,S||I,!S):ve==null&&I&&I.ref!=null&&Cl(I.ref,null,q,I,!0)},C=(I,S,V,$)=>{if(I==null)s(S.el=a(S.children),V,$);else{const K=S.el=I.el;S.children!==I.children&&u(K,S.children)}},F=(I,S,V,$)=>{I==null?s(S.el=l(S.children||""),V,$):S.el=I.el},U=(I,S,V,$)=>{[I.el,I.anchor]=E(I.children,S,V,$,I.el,I.anchor)},N=({el:I,anchor:S},V,$)=>{let K;for(;I&&I!==S;)K=p(I),s(I,V,$),I=K;s(S,V,$)},k=({el:I,anchor:S})=>{let V;for(;I&&I!==S;)V=p(I),r(I),I=V;r(S)},G=(I,S,V,$,K,q,ie,Q,H)=>{if(S.type==="svg"?ie="svg":S.type==="math"&&(ie="mathml"),I==null)J(S,V,$,K,q,ie,Q,H);else{const z=I.el&&I.el._isVueCE?I.el:null;try{z&&z._beginPatch(),A(I,S,K,q,ie,Q,H)}finally{z&&z._endPatch()}}},J=(I,S,V,$,K,q,ie,Q)=>{let H,z;const{props:ve,shapeFlag:ce,transition:ge,dirs:Ee}=I;if(H=I.el=o(I.type,q,ve&&ve.is,ve),ce&8?h(H,I.children):ce&16&&v(I.children,H,null,$,K,lf(I,q),ie,Q),Ee&&di(I,null,$,"created"),w(H,I,I.scopeId,ie,$),ve){for(const He in ve)He!=="value"&&!bl(He)&&i(H,He,null,ve[He],q,$);"value"in ve&&i(H,"value",null,ve.value,q),(z=ve.onVnodeBeforeMount)&&hs(z,$,I)}Ee&&di(I,null,$,"beforeMount");const Ne=t1(K,ge);Ne&&ge.beforeEnter(H),s(H,S,V),((z=ve&&ve.onVnodeMounted)||Ne||Ee)&&kn(()=>{z&&hs(z,$,I),Ne&&ge.enter(H),Ee&&di(I,null,$,"mounted")},K)},w=(I,S,V,$,K)=>{if(V&&_(I,V),$)for(let q=0;q<$.length;q++)_(I,$[q]);if(K){let q=K.subTree;if(S===q||JT(q.type)&&(q.ssContent===S||q.ssFallback===S)){const ie=K.vnode;w(I,ie,ie.scopeId,ie.slotScopeIds,K.parent)}}},v=(I,S,V,$,K,q,ie,Q,H=0)=>{for(let z=H;z<I.length;z++){const ve=I[z]=Q?Ir(I[z]):ps(I[z]);b(null,ve,S,V,$,K,q,ie,Q)}},A=(I,S,V,$,K,q,ie)=>{const Q=S.el=I.el;let{patchFlag:H,dynamicChildren:z,dirs:ve}=S;H|=I.patchFlag&16;const ce=I.props||rt,ge=S.props||rt;let Ee;if(V&&fi(V,!1),(Ee=ge.onVnodeBeforeUpdate)&&hs(Ee,V,S,I),ve&&di(S,I,V,"beforeUpdate"),V&&fi(V,!0),(ce.innerHTML&&ge.innerHTML==null||ce.textContent&&ge.textContent==null)&&h(Q,""),z?P(I.dynamicChildren,z,Q,V,$,lf(S,K),q):ie||ne(I,S,Q,null,V,$,lf(S,K),q,!1),H>0){if(H&16)R(Q,ce,ge,V,K);else if(H&2&&ce.class!==ge.class&&i(Q,"class",null,ge.class,K),H&4&&i(Q,"style",ce.style,ge.style,K),H&8){const Ne=S.dynamicProps;for(let He=0;He<Ne.length;He++){const Ue=Ne[He],Xt=ce[Ue],Zt=ge[Ue];(Zt!==Xt||Ue==="value")&&i(Q,Ue,Xt,Zt,K,V)}}H&1&&I.children!==S.children&&h(Q,S.children)}else!ie&&z==null&&R(Q,ce,ge,V,K);((Ee=ge.onVnodeUpdated)||ve)&&kn(()=>{Ee&&hs(Ee,V,S,I),ve&&di(S,I,V,"updated")},$)},P=(I,S,V,$,K,q,ie)=>{for(let Q=0;Q<S.length;Q++){const H=I[Q],z=S[Q],ve=H.el&&(H.type===Be||!il(H,z)||H.shapeFlag&198)?d(H.el):V;b(H,z,ve,null,$,K,q,ie,!0)}},R=(I,S,V,$,K)=>{if(S!==V){if(S!==rt)for(const q in S)!bl(q)&&!(q in V)&&i(I,q,S[q],null,K,$);for(const q in V){if(bl(q))continue;const ie=V[q],Q=S[q];ie!==Q&&q!=="value"&&i(I,q,Q,ie,K,$)}"value"in V&&i(I,"value",S.value,V.value,K)}},D=(I,S,V,$,K,q,ie,Q,H)=>{const z=S.el=I?I.el:a(""),ve=S.anchor=I?I.anchor:a("");let{patchFlag:ce,dynamicChildren:ge,slotScopeIds:Ee}=S;Ee&&(Q=Q?Q.concat(Ee):Ee),I==null?(s(z,V,$),s(ve,V,$),v(S.children||[],V,ve,K,q,ie,Q,H)):ce>0&&ce&64&&ge&&I.dynamicChildren&&I.dynamicChildren.length===ge.length?(P(I.dynamicChildren,ge,V,K,q,ie,Q),(S.key!=null||K&&S===K.subTree)&&HT(I,S,!0)):ne(I,S,V,ve,K,q,ie,Q,H)},T=(I,S,V,$,K,q,ie,Q,H)=>{S.slotScopeIds=Q,I==null?S.shapeFlag&512?K.ctx.activate(S,V,$,ie,H):nt(S,V,$,K,q,ie,H):Lt(I,S,H)},nt=(I,S,V,$,K,q,ie)=>{const Q=I.component=u1(I,$,K);if(kT(I)&&(Q.ctx.renderer=_e),d1(Q,!1,ie),Q.asyncDep){if(K&&K.registerDep(Q,at,ie),!I.el){const H=Q.subTree=Ke(zs);F(null,H,S,V),I.placeholder=H.el}}else at(Q,I,S,V,K,q,ie)},Lt=(I,S,V)=>{const $=S.component=I.component;if(K0(I,S,V))if($.asyncDep&&!$.asyncResolved){Oe($,S,V);return}else $.next=S,$.update();else S.el=I.el,$.vnode=S},at=(I,S,V,$,K,q,ie)=>{const Q=()=>{if(I.isMounted){let{next:ce,bu:ge,u:Ee,parent:Ne,vnode:He}=I;{const Pn=QT(I);if(Pn){ce&&(ce.el=He.el,Oe(I,ce,ie)),Pn.asyncDep.then(()=>{I.isUnmounted||Q()});return}}let Ue=ce,Xt;fi(I,!1),ce?(ce.el=He.el,Oe(I,ce,ie)):ce=He,ge&&Au(ge),(Xt=ce.props&&ce.props.onVnodeBeforeUpdate)&&hs(Xt,Ne,ce,He),fi(I,!0);const Zt=Ry(I),Cn=I.subTree;I.subTree=Zt,b(Cn,Zt,d(Cn.el),j(Cn),I,K,q),ce.el=Zt.el,Ue===null&&W0(I,Zt.el),Ee&&kn(Ee,K),(Xt=ce.props&&ce.props.onVnodeUpdated)&&kn(()=>hs(Xt,Ne,ce,He),K)}else{let ce;const{el:ge,props:Ee}=S,{bm:Ne,m:He,parent:Ue,root:Xt,type:Zt}=I,Cn=Vo(S);fi(I,!1),Ne&&Au(Ne),!Cn&&(ce=Ee&&Ee.onVnodeBeforeMount)&&hs(ce,Ue,S),fi(I,!0);{Xt.ce&&Xt.ce._def.shadowRoot!==!1&&Xt.ce._injectChildStyle(Zt);const Pn=I.subTree=Ry(I);b(null,Pn,V,$,I,K,q),S.el=Pn.el}if(He&&kn(He,K),!Cn&&(ce=Ee&&Ee.onVnodeMounted)){const Pn=S;kn(()=>hs(ce,Ue,Pn),K)}(S.shapeFlag&256||Ue&&Vo(Ue.vnode)&&Ue.vnode.shapeFlag&256)&&I.a&&kn(I.a,K),I.isMounted=!0,S=V=$=null}};I.scope.on();const H=I.effect=new iT(Q);I.scope.off();const z=I.update=H.run.bind(H),ve=I.job=H.runIfDirty.bind(H);ve.i=I,ve.id=I.uid,H.scheduler=()=>mm(ve),fi(I,!0),z()},Oe=(I,S,V)=>{S.component=I;const $=I.vnode.props;I.vnode=S,I.next=null,H0(I,S.props,$,V),X0(I,S.children,V),Gs(),vy(I),Ks()},ne=(I,S,V,$,K,q,ie,Q,H=!1)=>{const z=I&&I.children,ve=I?I.shapeFlag:0,ce=S.children,{patchFlag:ge,shapeFlag:Ee}=S;if(ge>0){if(ge&128){ht(z,ce,V,$,K,q,ie,Q,H);return}else if(ge&256){se(z,ce,V,$,K,q,ie,Q,H);return}}Ee&8?(ve&16&&Xe(z,K,q),ce!==z&&h(V,ce)):ve&16?Ee&16?ht(z,ce,V,$,K,q,ie,Q,H):Xe(z,K,q,!0):(ve&8&&h(V,""),Ee&16&&v(ce,V,$,K,q,ie,Q,H))},se=(I,S,V,$,K,q,ie,Q,H)=>{I=I||ko,S=S||ko;const z=I.length,ve=S.length,ce=Math.min(z,ve);let ge;for(ge=0;ge<ce;ge++){const Ee=S[ge]=H?Ir(S[ge]):ps(S[ge]);b(I[ge],Ee,V,null,K,q,ie,Q,H)}z>ve?Xe(I,K,q,!0,!1,ce):v(S,V,$,K,q,ie,Q,H,ce)},ht=(I,S,V,$,K,q,ie,Q,H)=>{let z=0;const ve=S.length;let ce=I.length-1,ge=ve-1;for(;z<=ce&&z<=ge;){const Ee=I[z],Ne=S[z]=H?Ir(S[z]):ps(S[z]);if(il(Ee,Ne))b(Ee,Ne,V,null,K,q,ie,Q,H);else break;z++}for(;z<=ce&&z<=ge;){const Ee=I[ce],Ne=S[ge]=H?Ir(S[ge]):ps(S[ge]);if(il(Ee,Ne))b(Ee,Ne,V,null,K,q,ie,Q,H);else break;ce--,ge--}if(z>ce){if(z<=ge){const Ee=ge+1,Ne=Ee<ve?S[Ee].el:$;for(;z<=ge;)b(null,S[z]=H?Ir(S[z]):ps(S[z]),V,Ne,K,q,ie,Q,H),z++}}else if(z>ge)for(;z<=ce;)kt(I[z],K,q,!0),z++;else{const Ee=z,Ne=z,He=new Map;for(z=Ne;z<=ge;z++){const Kt=S[z]=H?Ir(S[z]):ps(S[z]);Kt.key!=null&&He.set(Kt.key,z)}let Ue,Xt=0;const Zt=ge-Ne+1;let Cn=!1,Pn=0;const Kn=new Array(Zt);for(z=0;z<Zt;z++)Kn[z]=0;for(z=Ee;z<=ce;z++){const Kt=I[z];if(Xt>=Zt){kt(Kt,K,q,!0);continue}let Ft;if(Kt.key!=null)Ft=He.get(Kt.key);else for(Ue=Ne;Ue<=ge;Ue++)if(Kn[Ue-Ne]===0&&il(Kt,S[Ue])){Ft=Ue;break}Ft===void 0?kt(Kt,K,q,!0):(Kn[Ft-Ne]=z+1,Ft>=Pn?Pn=Ft:Cn=!0,b(Kt,S[Ft],V,null,K,q,ie,Q,H),Xt++)}const uo=Cn?n1(Kn):ko;for(Ue=uo.length-1,z=Zt-1;z>=0;z--){const Kt=Ne+z,Ft=S[Kt],qa=S[Kt+1],ai=Kt+1<ve?qa.el||YT(qa):$;Kn[z]===0?b(null,Ft,V,ai,K,q,ie,Q,H):Cn&&(Ue<0||z!==uo[Ue]?pn(Ft,V,ai,2):Ue--)}}},pn=(I,S,V,$,K=null)=>{const{el:q,type:ie,transition:Q,children:H,shapeFlag:z}=I;if(z&6){pn(I.component.subTree,S,V,$);return}if(z&128){I.suspense.move(S,V,$);return}if(z&64){ie.move(I,S,V,_e);return}if(ie===Be){s(q,S,V);for(let ce=0;ce<H.length;ce++)pn(H[ce],S,V,$);s(I.anchor,S,V);return}if(ie===Ru){N(I,S,V);return}if($!==2&&z&1&&Q)if($===0)Q.beforeEnter(q),s(q,S,V),kn(()=>Q.enter(q),K);else{const{leave:ce,delayLeave:ge,afterLeave:Ee}=Q,Ne=()=>{I.ctx.isUnmounted?r(q):s(q,S,V)},He=()=>{q._isLeaving&&q[y0](!0),ce(q,()=>{Ne(),Ee&&Ee()})};ge?ge(q,Ne,He):He()}else s(q,S,V)},kt=(I,S,V,$=!1,K=!1)=>{const{type:q,props:ie,ref:Q,children:H,dynamicChildren:z,shapeFlag:ve,patchFlag:ce,dirs:ge,cacheIndex:Ee}=I;if(ce===-2&&(K=!1),Q!=null&&(Gs(),Cl(Q,null,V,I,!0),Ks()),Ee!=null&&(S.renderCache[Ee]=void 0),ve&256){S.ctx.deactivate(I);return}const Ne=ve&1&&ge,He=!Vo(I);let Ue;if(He&&(Ue=ie&&ie.onVnodeBeforeUnmount)&&hs(Ue,S,I),ve&6)le(I.component,V,$);else{if(ve&128){I.suspense.unmount(V,$);return}Ne&&di(I,null,S,"beforeUnmount"),ve&64?I.type.remove(I,S,V,_e,$):z&&!z.hasOnce&&(q!==Be||ce>0&&ce&64)?Xe(z,S,V,!1,!0):(q===Be&&ce&384||!K&&ve&16)&&Xe(H,S,V),$&&ue(I)}(He&&(Ue=ie&&ie.onVnodeUnmounted)||Ne)&&kn(()=>{Ue&&hs(Ue,S,I),Ne&&di(I,null,S,"unmounted")},V)},ue=I=>{const{type:S,el:V,anchor:$,transition:K}=I;if(S===Be){re(V,$);return}if(S===Ru){k(I);return}const q=()=>{r(V),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(I.shapeFlag&1&&K&&!K.persisted){const{leave:ie,delayLeave:Q}=K,H=()=>ie(V,q);Q?Q(I.el,q,H):H()}else q()},re=(I,S)=>{let V;for(;I!==S;)V=p(I),r(I),I=V;r(S)},le=(I,S,V)=>{const{bum:$,scope:K,job:q,subTree:ie,um:Q,m:H,a:z}=I;Ny(H),Ny(z),$&&Au($),K.stop(),q&&(q.flags|=8,kt(ie,I,S,V)),Q&&kn(Q,S),kn(()=>{I.isUnmounted=!0},S)},Xe=(I,S,V,$=!1,K=!1,q=0)=>{for(let ie=q;ie<I.length;ie++)kt(I[ie],S,V,$,K)},j=I=>{if(I.shapeFlag&6)return j(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const S=p(I.anchor||I.el),V=S&&S[_0];return V?p(V):S};let fe=!1;const ae=(I,S,V)=>{let $;I==null?S._vnode&&(kt(S._vnode,null,null,!0),$=S._vnode.component):b(S._vnode||null,I,S,null,null,null,V),S._vnode=I,fe||(fe=!0,vy($),AT(),fe=!1)},_e={p:b,um:kt,m:pn,r:ue,mt:nt,mc:v,pc:ne,pbc:P,n:j,o:n};return{render:ae,hydrate:void 0,createApp:U0(ae)}}function lf({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function fi({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function t1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function HT(n,e,t=!1){const s=n.children,r=e.children;if(Te(s)&&Te(r))for(let i=0;i<s.length;i++){const o=s[i];let a=r[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[i]=Ir(r[i]),a.el=o.el),!t&&a.patchFlag!==-2&&HT(o,a)),a.type===Yh&&(a.patchFlag!==-1?a.el=o.el:a.__elIndex=i+(n.type===Be?1:0)),a.type===zs&&!a.el&&(a.el=o.el)}}function n1(n){const e=n.slice(),t=[0];let s,r,i,o,a;const l=n.length;for(s=0;s<l;s++){const u=n[s];if(u!==0){if(r=t[t.length-1],n[r]<u){e[s]=r,t.push(s);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[s]=t[i-1]),t[i]=s)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function QT(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:QT(e)}function Ny(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}function YT(n){if(n.placeholder)return n.placeholder;const e=n.component;return e?YT(e.subTree):null}const JT=n=>n.__isSuspense;function s1(n,e){e&&e.pendingBranch?Te(n)?e.effects.push(...n):e.effects.push(n):d0(n)}const Be=Symbol.for("v-fgt"),Yh=Symbol.for("v-txt"),zs=Symbol.for("v-cmt"),Ru=Symbol.for("v-stc"),Nl=[];let Vn=null;function Y(n=!1){Nl.push(Vn=n?null:[])}function r1(){Nl.pop(),Vn=Nl[Nl.length-1]||null}let Xl=1;function Xu(n,e=!1){Xl+=n,n<0&&Vn&&e&&(Vn.hasOnce=!0)}function XT(n){return n.dynamicChildren=Xl>0?Vn||ko:null,r1(),Xl>0&&Vn&&Vn.push(n),n}function X(n,e,t,s,r,i){return XT(g(n,e,t,s,r,i,!0))}function Wo(n,e,t,s,r){return XT(Ke(n,e,t,s,r,!0))}function Zl(n){return n?n.__v_isVNode===!0:!1}function il(n,e){return n.type===e.type&&n.key===e.key}const ZT=({key:n})=>n??null,Cu=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Nt(n)||cn(n)||Ae(n)?{i:Yt,r:n,k:e,f:!!t}:n:null);function g(n,e=null,t=null,s=0,r=null,i=n===Be?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&ZT(e),ref:e&&Cu(e),scopeId:RT,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Yt};return a?(Im(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Nt(t)?8:16),Xl>0&&!o&&Vn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Vn.push(l),l}const Ke=i1;function i1(n,e=null,t=null,s=0,r=null,i=!1){if((!n||n===N0)&&(n=zs),Zl(n)){const a=zo(n,e,!0);return t&&Im(a,t),Xl>0&&!i&&Vn&&(a.shapeFlag&6?Vn[Vn.indexOf(n)]=a:Vn.push(a)),a.patchFlag=-2,a}if(g1(n)&&(n=n.__vccOpts),e){e=o1(e);let{class:a,style:l}=e;a&&!Nt(a)&&(e.class=jo(a)),ot(l)&&(pm(l)&&!Te(l)&&(l=fn({},l)),e.style=Gh(l))}const o=Nt(n)?1:JT(n)?128:g0(n)?64:ot(n)?4:Ae(n)?2:0;return g(n,e,t,s,r,o,i,!0)}function o1(n){return n?pm(n)||qT(n)?fn({},n):n:null}function zo(n,e,t=!1,s=!1){const{props:r,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?a1(r||{},e):r,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&ZT(u),ref:e&&e.ref?t&&i?Te(i)?i.concat(Cu(e)):[i,Cu(e)]:Cu(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Be?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&zo(n.ssContent),ssFallback:n.ssFallback&&zo(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&gm(h,l.clone(h)),h}function zt(n=" ",e=0){return Ke(Yh,null,n,e)}function Zn(n,e){const t=Ke(Ru,null,n);return t.staticCount=e,t}function bt(n="",e=!1){return e?(Y(),Wo(zs,null,n)):Ke(zs,null,n)}function ps(n){return n==null||typeof n=="boolean"?Ke(zs):Te(n)?Ke(Be,null,n.slice()):Zl(n)?Ir(n):Ke(Yh,null,String(n))}function Ir(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:zo(n)}function Im(n,e){let t=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(Te(e))t=16;else if(typeof e=="object")if(s&65){const r=e.default;r&&(r._c&&(r._d=!1),Im(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!qT(e)?e._ctx=Yt:r===3&&Yt&&(Yt.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ae(e)?(e={default:e,_ctx:Yt},t=32):(e=String(e),s&64?(t=16,e=[zt(e)]):t=8);n.children=e,n.shapeFlag|=t}function a1(...n){const e={};for(let t=0;t<n.length;t++){const s=n[t];for(const r in s)if(r==="class")e.class!==s.class&&(e.class=jo([e.class,s.class]));else if(r==="style")e.style=Gh([e.style,s.style]);else if(Uh(r)){const i=e[r],o=s[r];o&&i!==o&&!(Te(i)&&i.includes(o))&&(e[r]=i?[].concat(i,o):o)}else r!==""&&(e[r]=s[r])}return e}function hs(n,e,t,s=null){Ss(n,e,7,[t,s])}const l1=FT();let c1=0;function u1(n,e,t){const s=n.type,r=(e?e.appContext:n.appContext)||l1,i={uid:c1++,vnode:n,type:s,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new OP(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:GT(s,r),emitsOptions:UT(s,r),emit:null,emitted:null,propsDefaults:rt,inheritAttrs:s.inheritAttrs,ctx:rt,data:rt,props:rt,attrs:rt,slots:rt,refs:rt,setupState:rt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=$0.bind(null,i),n.ce&&n.ce(i),i}let an=null;const h1=()=>an||Yt;let Zu,Jf;{const n=jh(),e=(t,s)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(s),i=>{r.length>1?r.forEach(o=>o(i)):r[0](i)}};Zu=e("__VUE_INSTANCE_SETTERS__",t=>an=t),Jf=e("__VUE_SSR_SETTERS__",t=>ec=t)}const bc=n=>{const e=an;return Zu(n),n.scope.on(),()=>{n.scope.off(),Zu(e)}},ky=()=>{an&&an.scope.off(),Zu(null)};function ew(n){return n.vnode.shapeFlag&4}let ec=!1;function d1(n,e=!1,t=!1){e&&Jf(e);const{props:s,children:r}=n.vnode,i=ew(n);z0(n,s,i,e),J0(n,r,t||e);const o=i?f1(n,e):void 0;return e&&Jf(!1),o}function f1(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,D0);const{setup:s}=t;if(s){Gs();const r=n.setupContext=s.length>1?m1(n):null,i=bc(n),o=wc(s,n,0,[n.props,r]),a=JI(o);if(Ks(),i(),(a||n.sp)&&!Vo(n)&&NT(n),a){if(o.then(ky,ky),e)return o.then(l=>{Dy(n,l)}).catch(l=>{zh(l,n,0)});n.asyncDep=o}else Dy(n,o)}else tw(n)}function Dy(n,e,t){Ae(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:ot(e)&&(n.setupState=IT(e)),tw(n)}function tw(n,e,t){const s=n.type;n.render||(n.render=s.render||Is);{const r=bc(n);Gs();try{x0(n)}finally{Ks(),r()}}}const p1={get(n,e){return sn(n,"get",""),n[e]}};function m1(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,p1),slots:n.slots,emit:n.emit,expose:e}}function Jh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(IT(n0(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Pl)return Pl[t](n)},has(e,t){return t in e||t in Pl}})):n.proxy}function _1(n,e=!0){return Ae(n)?n.displayName||n.name:n.name||e&&n.__name}function g1(n){return Ae(n)&&"__vccOpts"in n}const de=(n,e)=>a0(n,e,ec);function nw(n,e,t){try{Xu(-1);const s=arguments.length;return s===2?ot(e)&&!Te(e)?Zl(e)?Ke(n,null,[e]):Ke(n,e):Ke(n,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&Zl(t)&&(t=[t]),Ke(n,e,t))}finally{Xu(1)}}const y1="3.5.26";let Xf;const xy=typeof window<"u"&&window.trustedTypes;if(xy)try{Xf=xy.createPolicy("vue",{createHTML:n=>n})}catch{}const sw=Xf?n=>Xf.createHTML(n):n=>n,v1="http://www.w3.org/2000/svg",E1="http://www.w3.org/1998/Math/MathML",Ds=typeof document<"u"?document:null,Vy=Ds&&Ds.createElement("template"),I1={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,s)=>{const r=e==="svg"?Ds.createElementNS(v1,n):e==="mathml"?Ds.createElementNS(E1,n):t?Ds.createElement(n,{is:t}):Ds.createElement(n);return n==="select"&&s&&s.multiple!=null&&r.setAttribute("multiple",s.multiple),r},createText:n=>Ds.createTextNode(n),createComment:n=>Ds.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ds.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,s,r,i){const o=t?t.previousSibling:e.lastChild;if(r&&(r===i||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===i||!(r=r.nextSibling)););else{Vy.innerHTML=sw(s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n);const a=Vy.content;if(s==="svg"||s==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},T1=Symbol("_vtc");function w1(n,e,t){const s=n[T1];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Oy=Symbol("_vod"),b1=Symbol("_vsh"),A1=Symbol(""),S1=/(?:^|;)\s*display\s*:/;function R1(n,e,t){const s=n.style,r=Nt(t);let i=!1;if(t&&!r){if(e)if(Nt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Pu(s,a,"")}else for(const o in e)t[o]==null&&Pu(s,o,"");for(const o in t)o==="display"&&(i=!0),Pu(s,o,t[o])}else if(r){if(e!==t){const o=s[A1];o&&(t+=";"+o),s.cssText=t,i=S1.test(t)}}else e&&n.removeAttribute("style");Oy in n&&(n[Oy]=i?s.display:"",n[b1]&&(s.display="none"))}const My=/\s*!important$/;function Pu(n,e,t){if(Te(t))t.forEach(s=>Pu(n,e,s));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const s=C1(n,e);My.test(t)?n.setProperty(eo(s),t.replace(My,""),"important"):n[s]=t}}const Ly=["Webkit","Moz","ms"],cf={};function C1(n,e){const t=cf[e];if(t)return t;let s=jn(e);if(s!=="filter"&&s in n)return cf[e]=s;s=qh(s);for(let r=0;r<Ly.length;r++){const i=Ly[r]+s;if(i in n)return cf[e]=i}return e}const Fy="http://www.w3.org/1999/xlink";function Uy(n,e,t,s,r,i=xP(e)){s&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Fy,e.slice(6,e.length)):n.setAttributeNS(Fy,e,t):t==null||i&&!tT(t)?n.removeAttribute(e):n.setAttribute(e,i?"":rs(t)?String(t):t)}function By(n,e,t,s,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?sw(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=tT(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(r||e)}function wr(n,e,t,s){n.addEventListener(e,t,s)}function P1(n,e,t,s){n.removeEventListener(e,t,s)}const $y=Symbol("_vei");function N1(n,e,t,s,r=null){const i=n[$y]||(n[$y]={}),o=i[e];if(s&&o)o.value=s;else{const[a,l]=k1(e);if(s){const u=i[e]=V1(s,r);wr(n,a,u,l)}else o&&(P1(n,a,o,l),i[e]=void 0)}}const qy=/(?:Once|Passive|Capture)$/;function k1(n){let e;if(qy.test(n)){e={};let s;for(;s=n.match(qy);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):eo(n.slice(2)),e]}let uf=0;const D1=Promise.resolve(),x1=()=>uf||(D1.then(()=>uf=0),uf=Date.now());function V1(n,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;Ss(O1(s,t.value),e,5,[s])};return t.value=n,t.attached=x1(),t}function O1(n,e){if(Te(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(s=>r=>!r._stopped&&s&&s(r))}else return e}const jy=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,M1=(n,e,t,s,r,i)=>{const o=r==="svg";e==="class"?w1(n,s,o):e==="style"?R1(n,t,s):Uh(e)?rm(e)||N1(n,e,t,s,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):L1(n,e,s,o))?(By(n,e,s),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Uy(n,e,s,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Nt(s))?By(n,jn(e),s,i,e):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),Uy(n,e,s,o))};function L1(n,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in n&&jy(e)&&Ae(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return jy(e)&&Nt(t)?!1:e in n}const Ho=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Te(e)?t=>Au(e,t):e};function F1(n){n.target.composing=!0}function Gy(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const qs=Symbol("_assign");function Ky(n,e,t){return e&&(n=n.trim()),t&&(n=am(n)),n}const U1={created(n,{modifiers:{lazy:e,trim:t,number:s}},r){n[qs]=Ho(r);const i=s||r.props&&r.props.type==="number";wr(n,e?"change":"input",o=>{o.target.composing||n[qs](Ky(n.value,t,i))}),(t||i)&&wr(n,"change",()=>{n.value=Ky(n.value,t,i)}),e||(wr(n,"compositionstart",F1),wr(n,"compositionend",Gy),wr(n,"change",Gy))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:s,trim:r,number:i}},o){if(n[qs]=Ho(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?am(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(s&&e===t||r&&n.value.trim()===l)||(n.value=l))}},B1={deep:!0,created(n,e,t){n[qs]=Ho(t),wr(n,"change",()=>{const s=n._modelValue,r=rw(n),i=n.checked,o=n[qs];if(Te(s)){const a=nT(s,r),l=a!==-1;if(i&&!l)o(s.concat(r));else if(!i&&l){const u=[...s];u.splice(a,1),o(u)}}else if(Bh(s)){const a=new Set(s);i?a.add(r):a.delete(r),o(a)}else o(iw(n,i))})},mounted:Wy,beforeUpdate(n,e,t){n[qs]=Ho(t),Wy(n,e,t)}};function Wy(n,{value:e,oldValue:t},s){n._modelValue=e;let r;if(Te(e))r=nT(e,s.props.value)>-1;else if(Bh(e))r=e.has(s.props.value);else{if(e===t)return;r=Go(e,iw(n,!0))}n.checked!==r&&(n.checked=r)}const hf={created(n,{value:e},t){n.checked=Go(e,t.props.value),n[qs]=Ho(t),wr(n,"change",()=>{n[qs](rw(n))})},beforeUpdate(n,{value:e,oldValue:t},s){n[qs]=Ho(s),e!==t&&(n.checked=Go(e,s.props.value))}};function rw(n){return"_value"in n?n._value:n.value}function iw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const $1=["ctrl","shift","alt","meta"],q1={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>$1.some(t=>n[`${t}Key`]&&!e.includes(t))},ow=(n,e)=>{const t=n._withMods||(n._withMods={}),s=e.join(".");return t[s]||(t[s]=((r,...i)=>{for(let o=0;o<e.length;o++){const a=q1[e[o]];if(a&&a(r,e))return}return n(r,...i)}))},j1=fn({patchProp:M1},I1);let zy;function G1(){return zy||(zy=Z0(j1))}const K1=((...n)=>{const e=G1().createApp(...n),{mount:t}=e;return e.mount=s=>{const r=z1(s);if(!r)return;const i=e._component;!Ae(i)&&!i.render&&!i.template&&(i.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=t(r,!1,W1(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},e});function W1(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function z1(n){return Nt(n)?document.querySelector(n):n}const H1=()=>{};var Hy={};const aw={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const oe=function(n,e){if(!n)throw Ta(e)},Ta=function(n){return new Error("Firebase Database ("+aw.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const lw=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Q1=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Tm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(p=64)),s.push(t[h],t[d],t[p],t[_])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(lw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Q1(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const d=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||d==null)throw new Y1;const p=i<<2|a>>4;if(s.push(p),u!==64){const _=a<<4&240|u>>2;if(s.push(_),d!==64){const E=u<<6&192|d;s.push(E)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Y1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cw=function(n){const e=lw(n);return Tm.encodeByteArray(e,!0)},eh=function(n){return cw(n).replace(/\./g,"")},th=function(n){try{return Tm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function J1(n){return uw(void 0,n)}function uw(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!X1(t)||(n[t]=uw(n[t],e[t]));return n}function X1(n){return n!=="__proto__"}function hw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Z1=()=>hw().__FIREBASE_DEFAULTS__,eN=()=>{if(typeof process>"u"||typeof Hy>"u")return;const n=Hy.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},tN=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&th(n[1]);return e&&JSON.parse(e)},Xh=()=>{try{return H1()||Z1()||eN()||tN()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dw=n=>Xh()?.emulatorHosts?.[n],nN=n=>{const e=dw(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},fw=()=>Xh()?.config,pw=n=>Xh()?.[`_${n}`];class wm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function to(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function bm(n){return(await fetch(n,{credentials:"include"})).ok}function sN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[eh(JSON.stringify(t)),eh(JSON.stringify(o)),""].join(".")}const kl={};function rN(){const n={prod:[],emulator:[]};for(const e of Object.keys(kl))kl[e]?n.emulator.push(e):n.prod.push(e);return n}function iN(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Qy=!1;function mw(n,e){if(typeof window>"u"||typeof document>"u"||!to(window.location.host)||kl[n]===e||kl[n]||Qy)return;kl[n]=e;function t(p){return`__firebase__banner__${p}`}const s="__firebase__banner",i=rN().prod.length>0;function o(){const p=document.getElementById(s);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,_){p.setAttribute("width","24"),p.setAttribute("id",_),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Qy=!0,o()},p}function h(p,_){p.setAttribute("id",_),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function d(){const p=iN(s),_=t("text"),E=document.getElementById(_)||document.createElement("span"),b=t("learnmore"),C=document.getElementById(b)||document.createElement("a"),F=t("preprendIcon"),U=document.getElementById(F)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const N=p.element;a(N),h(C,b);const k=u();l(U,F),N.append(U,E,C,k),document.body.appendChild(N)}i?(E.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function Vt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Am(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Vt())}function _w(){const n=Xh()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function oN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function aN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function gw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function lN(){const n=Vt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function cN(){return aw.NODE_ADMIN===!0}function yw(){return!_w()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vw(){return!_w()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ew(){try{return typeof indexedDB=="object"}catch{return!1}}function uN(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const hN="FirebaseError";class Zs extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=hN,Object.setPrototypeOf(this,Zs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ac.prototype.create)}}class Ac{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?dN(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new Zs(r,a,s)}}function dN(n,e){return n.replace(fN,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const fN=/\{\$([^}]+)}/g;function tc(n){return JSON.parse(n)}function Ht(n){return JSON.stringify(n)}const Iw=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=tc(th(i[0])||""),t=tc(th(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},pN=function(n){const e=Iw(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},mN=function(n){const e=Iw(n).claims;return typeof e=="object"&&e.admin===!0};function er(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Qo(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Zf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nh(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function os(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(Yy(i)&&Yy(o)){if(!os(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Yy(n){return n!==null&&typeof n=="object"}function wa(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class _N{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)s[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const p=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(p<<1|p>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let d=0;d<80;d++){d<40?d<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):d<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(r<<5|r>>>27)+u+l+h+s[d]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=p}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function gN(n,e){const t=new yN(n,e);return t.subscribe.bind(t)}class yN{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");vN(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=df),r.error===void 0&&(r.error=df),r.complete===void 0&&(r.complete=df);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vN(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function df(){}function EN(n,e){return`${n} failed: ${e} argument `}const IN=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,oe(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Zh=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function et(n){return n&&n._delegate?n._delegate:n}class $r{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const _i="[DEFAULT]";class TN{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new wm;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bN(e))try{this.getOrInitializeService({instanceIdentifier:_i})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=_i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=_i){return this.instances.has(e)}getOptions(e=_i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:wN(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=_i){return this.component?this.component.multipleInstances?e:_i:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function wN(n){return n===_i?void 0:n}function bN(n){return n.instantiationMode==="EAGER"}class AN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new TN(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var ke;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ke||(ke={}));const SN={debug:ke.DEBUG,verbose:ke.VERBOSE,info:ke.INFO,warn:ke.WARN,error:ke.ERROR,silent:ke.SILENT},RN=ke.INFO,CN={[ke.DEBUG]:"log",[ke.VERBOSE]:"log",[ke.INFO]:"info",[ke.WARN]:"warn",[ke.ERROR]:"error"},PN=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=CN[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ed{constructor(e){this.name=e,this._logLevel=RN,this._logHandler=PN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ke))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?SN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ke.DEBUG,...e),this._logHandler(this,ke.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ke.VERBOSE,...e),this._logHandler(this,ke.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ke.INFO,...e),this._logHandler(this,ke.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ke.WARN,...e),this._logHandler(this,ke.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ke.ERROR,...e),this._logHandler(this,ke.ERROR,...e)}}const NN=(n,e)=>e.some(t=>n instanceof t);let Jy,Xy;function kN(){return Jy||(Jy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DN(){return Xy||(Xy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Tw=new WeakMap,ep=new WeakMap,ww=new WeakMap,ff=new WeakMap,Sm=new WeakMap;function xN(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Or(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Tw.set(t,n)}).catch(()=>{}),Sm.set(e,n),e}function VN(n){if(ep.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});ep.set(n,e)}let tp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ep.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ww.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Or(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ON(n){tp=n(tp)}function MN(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(pf(this),e,...t);return ww.set(s,e.sort?e.sort():[e]),Or(s)}:DN().includes(n)?function(...e){return n.apply(pf(this),e),Or(Tw.get(this))}:function(...e){return Or(n.apply(pf(this),e))}}function LN(n){return typeof n=="function"?MN(n):(n instanceof IDBTransaction&&VN(n),NN(n,kN())?new Proxy(n,tp):n)}function Or(n){if(n instanceof IDBRequest)return xN(n);if(ff.has(n))return ff.get(n);const e=LN(n);return e!==n&&(ff.set(n,e),Sm.set(e,n)),e}const pf=n=>Sm.get(n);function FN(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Or(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Or(o.result),l.oldVersion,l.newVersion,Or(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const UN=["get","getKey","getAll","getAllKeys","count"],BN=["put","add","delete","clear"],mf=new Map;function Zy(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(mf.get(e))return mf.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=BN.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||UN.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return mf.set(e,i),i}ON(n=>({...n,get:(e,t,s)=>Zy(e,t)||n.get(e,t,s),has:(e,t)=>!!Zy(e,t)||n.has(e,t)}));class $N{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(qN(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function qN(n){return n.getComponent()?.type==="VERSION"}const np="@firebase/app",ev="0.14.6";const Hs=new ed("@firebase/app"),jN="@firebase/app-compat",GN="@firebase/analytics-compat",KN="@firebase/analytics",WN="@firebase/app-check-compat",zN="@firebase/app-check",HN="@firebase/auth",QN="@firebase/auth-compat",YN="@firebase/database",JN="@firebase/data-connect",XN="@firebase/database-compat",ZN="@firebase/functions",ek="@firebase/functions-compat",tk="@firebase/installations",nk="@firebase/installations-compat",sk="@firebase/messaging",rk="@firebase/messaging-compat",ik="@firebase/performance",ok="@firebase/performance-compat",ak="@firebase/remote-config",lk="@firebase/remote-config-compat",ck="@firebase/storage",uk="@firebase/storage-compat",hk="@firebase/firestore",dk="@firebase/ai",fk="@firebase/firestore-compat",pk="firebase",mk="12.6.0";const sh="[DEFAULT]",_k={[np]:"fire-core",[jN]:"fire-core-compat",[KN]:"fire-analytics",[GN]:"fire-analytics-compat",[zN]:"fire-app-check",[WN]:"fire-app-check-compat",[HN]:"fire-auth",[QN]:"fire-auth-compat",[YN]:"fire-rtdb",[JN]:"fire-data-connect",[XN]:"fire-rtdb-compat",[ZN]:"fire-fn",[ek]:"fire-fn-compat",[tk]:"fire-iid",[nk]:"fire-iid-compat",[sk]:"fire-fcm",[rk]:"fire-fcm-compat",[ik]:"fire-perf",[ok]:"fire-perf-compat",[ak]:"fire-rc",[lk]:"fire-rc-compat",[ck]:"fire-gcs",[uk]:"fire-gcs-compat",[hk]:"fire-fst",[fk]:"fire-fst-compat",[dk]:"fire-vertex","fire-js":"fire-js",[pk]:"fire-js-all"};const rh=new Map,gk=new Map,sp=new Map;function tv(n,e){try{n.container.addComponent(e)}catch(t){Hs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Fi(n){const e=n.name;if(sp.has(e))return Hs.debug(`There were multiple attempts to register component ${e}.`),!1;sp.set(e,n);for(const t of rh.values())tv(t,n);for(const t of gk.values())tv(t,n);return!0}function Sc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function yk(n,e,t=sh){Sc(n,e).clearInstance(t)}function Fn(n){return n==null?!1:n.settings!==void 0}const vk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Mr=new Ac("app","Firebase",vk);class Ek{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new $r("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mr.create("app-deleted",{appName:this._name})}}const no=mk;function bw(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:sh,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Mr.create("bad-app-name",{appName:String(r)});if(t||(t=fw()),!t)throw Mr.create("no-options");const i=rh.get(r);if(i){if(os(t,i.options)&&os(s,i.config))return i;throw Mr.create("duplicate-app",{appName:r})}const o=new AN(r);for(const l of sp.values())o.addComponent(l);const a=new Ek(t,s,o);return rh.set(r,a),a}function Aw(n=sh){const e=rh.get(n);if(!e&&n===sh&&fw())return bw();if(!e)throw Mr.create("no-app",{appName:n});return e}function Ts(n,e,t){let s=_k[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hs.warn(o.join(" "));return}Fi(new $r(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Ik="firebase-heartbeat-database",Tk=1,nc="firebase-heartbeat-store";let _f=null;function Sw(){return _f||(_f=FN(Ik,Tk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(nc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Mr.create("idb-open",{originalErrorMessage:n.message})})),_f}async function wk(n){try{const t=(await Sw()).transaction(nc),s=await t.objectStore(nc).get(Rw(n));return await t.done,s}catch(e){if(e instanceof Zs)Hs.warn(e.message);else{const t=Mr.create("idb-get",{originalErrorMessage:e?.message});Hs.warn(t.message)}}}async function nv(n,e){try{const s=(await Sw()).transaction(nc,"readwrite");await s.objectStore(nc).put(e,Rw(n)),await s.done}catch(t){if(t instanceof Zs)Hs.warn(t.message);else{const s=Mr.create("idb-set",{originalErrorMessage:t?.message});Hs.warn(s.message)}}}function Rw(n){return`${n.name}!${n.options.appId}`}const bk=1024,Ak=30;class Sk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ck(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=sv();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Ak){const r=Pk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Hs.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=sv(),{heartbeatsToSend:t,unsentEntries:s}=Rk(this._heartbeatsCache.heartbeats),r=eh(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Hs.warn(e),""}}}function sv(){return new Date().toISOString().substring(0,10)}function Rk(n,e=bk){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),rv(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),rv(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Ck{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ew()?uN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await wk(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return nv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return nv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function rv(n){return eh(JSON.stringify({version:2,heartbeats:n})).length}function Pk(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Nk(n){Fi(new $r("platform-logger",e=>new $N(e),"PRIVATE")),Fi(new $r("heartbeat",e=>new Sk(e),"PRIVATE")),Ts(np,ev,n),Ts(np,ev,"esm2020"),Ts("fire-js","")}Nk("");function Cw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const kk=Cw,Pw=new Ac("auth","Firebase",Cw());const ih=new ed("@firebase/auth");function Dk(n,...e){ih.logLevel<=ke.WARN&&ih.warn(`Auth (${no}): ${n}`,...e)}function Nu(n,...e){ih.logLevel<=ke.ERROR&&ih.error(`Auth (${no}): ${n}`,...e)}function Rs(n,...e){throw Cm(n,...e)}function es(n,...e){return Cm(n,...e)}function Rm(n,e,t){const s={...kk(),[e]:t};return new Ac("auth","Firebase",s).create(e,{appName:n.name})}function Di(n){return Rm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xk(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Rs(n,"argument-error"),Rm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Cm(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return Pw.create(n,...e)}function we(n,e,...t){if(!n)throw Cm(e,...t)}function Ls(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Nu(e),new Error(e)}function Qs(n,e){n||Ls(e)}function rp(){return typeof self<"u"&&self.location?.href||""}function Vk(){return iv()==="http:"||iv()==="https:"}function iv(){return typeof self<"u"&&self.location?.protocol||null}function Ok(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Vk()||aN()||"connection"in navigator)?navigator.onLine:!0}function Mk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Rc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qs(t>e,"Short delay should be less than long delay!"),this.isMobile=Am()||gw()}get(){return Ok()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Pm(n,e){Qs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Nw{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ls("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ls("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ls("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Lk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Fk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Uk=new Rc(3e4,6e4);function Nm(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ba(n,e,t,s,r={}){return kw(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=wa({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return oN()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&to(n.emulatorConfig.host)&&(u.credentials="include"),Nw.fetch()(await Dw(n,n.config.apiHost,t,a),u)})}async function kw(n,e,t){n._canInitEmulator=!1;const s={...Lk,...e};try{const r=new $k(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw hu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw hu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw hu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw hu(n,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Rm(n,h,u);Rs(n,h)}}catch(r){if(r instanceof Zs)throw r;Rs(n,"network-request-failed",{message:String(r)})}}async function Bk(n,e,t,s,r={}){const i=await ba(n,e,t,s,r);return"mfaPendingCredential"in i&&Rs(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Dw(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?Pm(n.config,r):`${n.config.apiScheme}://${r}`;return Fk.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class $k{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(es(this.auth,"network-request-failed")),Uk.get())})}}function hu(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=es(n,e,s);return r.customData._tokenResponse=t,r}async function qk(n,e){return ba(n,"POST","/v1/accounts:delete",e)}async function oh(n,e){return ba(n,"POST","/v1/accounts:lookup",e)}function Dl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jk(n,e=!1){const t=et(n),s=await t.getIdToken(e),r=km(s);we(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:Dl(gf(r.auth_time)),issuedAtTime:Dl(gf(r.iat)),expirationTime:Dl(gf(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function gf(n){return Number(n)*1e3}function km(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Nu("JWT malformed, contained fewer than 3 sections"),null;try{const r=th(t);return r?JSON.parse(r):(Nu("Failed to decode base64 JWT payload"),null)}catch(r){return Nu("Caught error parsing JWT payload as JSON",r?.toString()),null}}function ov(n){const e=km(n);return we(e,"internal-error"),we(typeof e.exp<"u","internal-error"),we(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function sc(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof Zs&&Gk(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Gk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Kk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ip{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Dl(this.lastLoginAt),this.creationTime=Dl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ah(n){const e=n.auth,t=await n.getIdToken(),s=await sc(n,oh(e,{idToken:t}));we(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?xw(r.providerUserInfo):[],o=zk(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!o?.length,u=a?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new ip(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Wk(n){const e=et(n);await ah(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function zk(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function xw(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Hk(n,e){const t=await kw(n,{},async()=>{const s=wa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await Dw(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&to(n.emulatorConfig.host)&&(l.credentials="include"),Nw.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Qk(n,e){return ba(n,"POST","/v2/accounts:revokeToken",Nm(n,e))}class Mo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken<"u","internal-error"),we(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ov(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=ov(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Hk(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new Mo;return s&&(we(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(we(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(we(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Mo,this.toJSON())}_performRefresh(){return Ls("not implemented")}}function dr(n,e){we(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Qn{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new Kk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new ip(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await sc(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return jk(this,e)}reload(){return Wk(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Qn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await ah(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fn(this.auth.app))return Promise.reject(Di(this.auth));const e=await this.getIdToken();return await sc(this,qk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:d,emailVerified:p,isAnonymous:_,providerData:E,stsTokenManager:b}=t;we(d&&b,e,"internal-error");const C=Mo.fromJSON(this.name,b);we(typeof d=="string",e,"internal-error"),dr(s,e.name),dr(r,e.name),we(typeof p=="boolean",e,"internal-error"),we(typeof _=="boolean",e,"internal-error"),dr(i,e.name),dr(o,e.name),dr(a,e.name),dr(l,e.name),dr(u,e.name),dr(h,e.name);const F=new Qn({uid:d,auth:e,email:r,emailVerified:p,displayName:s,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:C,createdAt:u,lastLoginAt:h});return E&&Array.isArray(E)&&(F.providerData=E.map(U=>({...U}))),l&&(F._redirectEventId=l),F}static async _fromIdTokenResponse(e,t,s=!1){const r=new Mo;r.updateFromServerResponse(t);const i=new Qn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await ah(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];we(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?xw(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!i?.length,a=new Mo;a.updateFromIdToken(s);const l=new Qn({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new ip(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,u),l}}const av=new Map;function Fs(n){Qs(n instanceof Function,"Expected a class definition");let e=av.get(n);return e?(Qs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,av.set(n,e),e)}class Vw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vw.type="NONE";const lv=Vw;function ku(n,e,t){return`firebase:${n}:${e}:${t}`}class Lo{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=ku(this.userKey,r.apiKey,i),this.fullPersistenceKey=ku("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await oh(this.auth,{idToken:e}).catch(()=>{});return t?Qn._fromGetAccountInfoResponse(this.auth,t,e):null}return Qn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Lo(Fs(lv),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Fs(lv);const o=ku(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let d;if(typeof h=="string"){const p=await oh(e,{idToken:h}).catch(()=>{});if(!p)break;d=await Qn._fromGetAccountInfoResponse(e,p,h)}else d=Qn._fromJSON(e,h);u!==i&&(a=d),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Lo(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Lo(i,e,s))}}function cv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Fw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ow(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Bw(e))return"Blackberry";if($w(e))return"Webos";if(Mw(e))return"Safari";if((e.includes("chrome/")||Lw(e))&&!e.includes("edge/"))return"Chrome";if(Uw(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function Ow(n=Vt()){return/firefox\//i.test(n)}function Mw(n=Vt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Lw(n=Vt()){return/crios\//i.test(n)}function Fw(n=Vt()){return/iemobile/i.test(n)}function Uw(n=Vt()){return/android/i.test(n)}function Bw(n=Vt()){return/blackberry/i.test(n)}function $w(n=Vt()){return/webos/i.test(n)}function Dm(n=Vt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Yk(n=Vt()){return Dm(n)&&!!window.navigator?.standalone}function Jk(){return lN()&&document.documentMode===10}function qw(n=Vt()){return Dm(n)||Uw(n)||$w(n)||Bw(n)||/windows phone/i.test(n)||Fw(n)}function jw(n,e=[]){let t;switch(n){case"Browser":t=cv(Vt());break;case"Worker":t=`${cv(Vt())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${no}/${s}`}class Xk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}async function Zk(n,e={}){return ba(n,"GET","/v2/passwordPolicy",Nm(n,e))}const eD=6;class tD{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??eD,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class nD{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uv(this),this.idTokenSubscription=new uv(this),this.beforeStateQueue=new Xk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Fs(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Lo.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await oh(this,{idToken:e}),s=await Qn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Fn(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ah(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Mk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fn(this.app))return Promise.reject(Di(this));const t=e?et(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fn(this.app)?Promise.reject(Di(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fn(this.app)?Promise.reject(Di(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Fs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Zk(this),t=new tD(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ac("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Qk(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Fs(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=await Lo.create(this,[Fs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(Fn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Dk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function td(n){return et(n)}class uv{constructor(e){this.auth=e,this.observer=null,this.addObserver=gN(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let xm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sD(n){xm=n}function rD(n){return xm.loadJS(n)}function iD(){return xm.gapiScript}function oD(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function aD(n,e){const t=Sc(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(os(i,e??{}))return r;Rs(r,"already-initialized")}return t.initialize({options:e})}function lD(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Fs);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function cD(n,e,t){const s=td(n);we(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=Gw(e),{host:o,port:a}=uD(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){we(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),we(os(u,s.config.emulator)&&os(h,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,to(o)?(bm(`${i}//${o}${l}`),mw("Auth",!0)):hD()}function Gw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function uD(n){const e=Gw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:hv(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:hv(o)}}}function hv(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function hD(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Kw{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ls("not implemented")}_getIdTokenResponse(e){return Ls("not implemented")}_linkToIdToken(e,t){return Ls("not implemented")}_getReauthenticationResolver(e){return Ls("not implemented")}}async function Fo(n,e){return Bk(n,"POST","/v1/accounts:signInWithIdp",Nm(n,e))}const dD="http://localhost";class Ui extends Kw{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ui(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Rs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new Ui(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Fo(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,Fo(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fo(e,t)}buildRequest(){const e={requestUri:dD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=wa(t)}return e}}class Vm{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Cc extends Vm{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class br extends Cc{constructor(){super("facebook.com")}static credential(e){return Ui._fromParams({providerId:br.PROVIDER_ID,signInMethod:br.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return br.credentialFromTaggedObject(e)}static credentialFromError(e){return br.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return br.credential(e.oauthAccessToken)}catch{return null}}}br.FACEBOOK_SIGN_IN_METHOD="facebook.com";br.PROVIDER_ID="facebook.com";class Ms extends Cc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ui._fromParams({providerId:Ms.PROVIDER_ID,signInMethod:Ms.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ms.credentialFromTaggedObject(e)}static credentialFromError(e){return Ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Ms.credential(t,s)}catch{return null}}}Ms.GOOGLE_SIGN_IN_METHOD="google.com";Ms.PROVIDER_ID="google.com";class Ar extends Cc{constructor(){super("github.com")}static credential(e){return Ui._fromParams({providerId:Ar.PROVIDER_ID,signInMethod:Ar.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ar.credentialFromTaggedObject(e)}static credentialFromError(e){return Ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ar.credential(e.oauthAccessToken)}catch{return null}}}Ar.GITHUB_SIGN_IN_METHOD="github.com";Ar.PROVIDER_ID="github.com";class Sr extends Cc{constructor(){super("twitter.com")}static credential(e,t){return Ui._fromParams({providerId:Sr.PROVIDER_ID,signInMethod:Sr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Sr.credentialFromTaggedObject(e)}static credentialFromError(e){return Sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Sr.credential(t,s)}catch{return null}}}Sr.TWITTER_SIGN_IN_METHOD="twitter.com";Sr.PROVIDER_ID="twitter.com";class Yo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Qn._fromIdTokenResponse(e,s,r),o=dv(s);return new Yo({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=dv(s);return new Yo({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function dv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class lh extends Zs{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,lh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new lh(e,t,s,r)}}function Ww(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?lh._fromErrorAndOperation(n,i,e,s):i})}async function fD(n,e,t=!1){const s=await sc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Yo._forOperation(n,"link",s)}async function pD(n,e,t=!1){const{auth:s}=n;if(Fn(s.app))return Promise.reject(Di(s));const r="reauthenticate";try{const i=await sc(n,Ww(s,r,e,n),t);we(i.idToken,s,"internal-error");const o=km(i.idToken);we(o,s,"internal-error");const{sub:a}=o;return we(n.uid===a,s,"user-mismatch"),Yo._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&Rs(s,"user-mismatch"),i}}async function mD(n,e,t=!1){if(Fn(n.app))return Promise.reject(Di(n));const s="signIn",r=await Ww(n,s,e),i=await Yo._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}function _D(n,e,t,s){return et(n).onIdTokenChanged(e,t,s)}function gD(n,e,t){return et(n).beforeAuthStateChanged(e,t)}function yD(n,e,t,s){return et(n).onAuthStateChanged(e,t,s)}function vD(n){return et(n).signOut()}const ch="__sak";class zw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ch,"1"),this.storage.removeItem(ch),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const ED=1e3,ID=10;class Hw extends zw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Jk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,ID):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},ED)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Hw.type="LOCAL";const TD=Hw;class Qw extends zw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Qw.type="SESSION";const Yw=Qw;function wD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class nd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new nd(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await wD(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nd.receivers=[];function Om(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}class bD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Om("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const p=d;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function ws(){return window}function AD(n){ws().location.href=n}function Jw(){return typeof ws().WorkerGlobalScope<"u"&&typeof ws().importScripts=="function"}async function SD(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function RD(){return navigator?.serviceWorker?.controller||null}function CD(){return Jw()?self:null}const Xw="firebaseLocalStorageDb",PD=1,uh="firebaseLocalStorage",Zw="fbase_key";class Pc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function sd(n,e){return n.transaction([uh],e?"readwrite":"readonly").objectStore(uh)}function ND(){const n=indexedDB.deleteDatabase(Xw);return new Pc(n).toPromise()}function op(){const n=indexedDB.open(Xw,PD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(uh,{keyPath:Zw})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(uh)?e(s):(s.close(),await ND(),e(await op()))})})}async function fv(n,e,t){const s=sd(n,!0).put({[Zw]:e,value:t});return new Pc(s).toPromise()}async function kD(n,e){const t=sd(n,!1).get(e),s=await new Pc(t).toPromise();return s===void 0?null:s.value}function pv(n,e){const t=sd(n,!0).delete(e);return new Pc(t).toPromise()}const DD=800,xD=3;class eb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await op(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>xD)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Jw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nd._getInstance(CD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await SD(),!this.activeServiceWorker)return;this.sender=new bD(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||RD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await op();return await fv(e,ch,"1"),await pv(e,ch),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>fv(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>kD(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=sd(r,!1).getAll();return new Pc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),DD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}eb.type="LOCAL";const VD=eb;new Rc(3e4,6e4);function tb(n,e){return e?Fs(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Mm extends Kw{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Fo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Fo(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function OD(n){return mD(n.auth,new Mm(n),n.bypassAuthState)}function MD(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),pD(t,new Mm(n),n.bypassAuthState)}async function LD(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),fD(t,new Mm(n),n.bypassAuthState)}class nb{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return OD;case"linkViaPopup":case"linkViaRedirect":return LD;case"reauthViaPopup":case"reauthViaRedirect":return MD;default:Rs(this.auth,"internal-error")}}resolve(e){Qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const FD=new Rc(2e3,1e4);async function UD(n,e,t){if(Fn(n.app))return Promise.reject(es(n,"operation-not-supported-in-this-environment"));const s=td(n);xk(n,e,Vm);const r=tb(s,t);return new Ai(s,"signInViaPopup",e,r).executeNotNull()}class Ai extends nb{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Ai.currentPopupAction&&Ai.currentPopupAction.cancel(),Ai.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return we(e,this.auth,"internal-error"),e}async onExecution(){Qs(this.filter.length===1,"Popup operations only handle one event");const e=Om();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(es(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(es(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ai.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(es(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,FD.get())};e()}}Ai.currentPopupAction=null;const BD="pendingRedirect",Du=new Map;class $D extends nb{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Du.get(this.auth._key());if(!e){try{const s=await qD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Du.set(this.auth._key(),e)}return this.bypassAuthState||Du.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function qD(n,e){const t=KD(e),s=GD(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function jD(n,e){Du.set(n._key(),e)}function GD(n){return Fs(n._redirectPersistence)}function KD(n){return ku(BD,n.config.apiKey,n.name)}async function WD(n,e,t=!1){if(Fn(n.app))return Promise.reject(Di(n));const s=td(n),r=tb(s,e),o=await new $D(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}const zD=600*1e3;class HD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!QD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!sb(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(es(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zD&&this.cachedEventUids.clear(),this.cachedEventUids.has(mv(e))}saveEventToCache(e){this.cachedEventUids.add(mv(e)),this.lastProcessedEventTime=Date.now()}}function mv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sb({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function QD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sb(n);default:return!1}}async function YD(n,e={}){return ba(n,"GET","/v1/projects",e)}const JD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XD=/^https?/;async function ZD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await YD(n);for(const t of e)try{if(ex(t))return}catch{}Rs(n,"unauthorized-domain")}function ex(n){const e=rp(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!XD.test(t))return!1;if(JD.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const tx=new Rc(3e4,6e4);function _v(){const n=ws().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function nx(n){return new Promise((e,t)=>{function s(){_v(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{_v(),t(es(n,"network-request-failed"))},timeout:tx.get()})}if(ws().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ws().gapi?.load)s();else{const r=oD("iframefcb");return ws()[r]=()=>{gapi.load?s():t(es(n,"network-request-failed"))},rD(`${iD()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw xu=null,e})}let xu=null;function sx(n){return xu=xu||nx(n),xu}const rx=new Rc(5e3,15e3),ix="__/auth/iframe",ox="emulator/auth/iframe",ax={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lx=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cx(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Pm(e,ox):`https://${n.config.authDomain}/${ix}`,s={apiKey:e.apiKey,appName:n.name,v:no},r=lx.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${wa(s).slice(1)}`}async function ux(n){const e=await sx(n),t=ws().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:cx(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ax,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=es(n,"network-request-failed"),a=ws().setTimeout(()=>{i(o)},rx.get());function l(){ws().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}const hx={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dx=500,fx=600,px="_blank",mx="http://localhost";class gv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _x(n,e,t,s=dx,r=fx){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...hx,width:s.toString(),height:r.toString(),top:i,left:o},u=Vt().toLowerCase();t&&(a=Lw(u)?px:t),Ow(u)&&(e=e||mx,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[_,E])=>`${p}${_}=${E},`,"");if(Yk(u)&&a!=="_self")return gx(e||"",a),new gv(null);const d=window.open(e||"",a,h);we(d,n,"popup-blocked");try{d.focus()}catch{}return new gv(d)}function gx(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}const yx="__/auth/handler",vx="emulator/auth/handler",Ex=encodeURIComponent("fac");async function yv(n,e,t,s,r,i){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:no,eventId:r};if(e instanceof Vm){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Zf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof Cc){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${Ex}=${encodeURIComponent(l)}`:"";return`${Ix(n)}?${wa(a).slice(1)}${u}`}function Ix({config:n}){return n.emulator?Pm(n,vx):`https://${n.authDomain}/${yx}`}const yf="webStorageSupport";class Tx{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Yw,this._completeRedirectFn=WD,this._overrideRedirectResult=jD}async _openPopup(e,t,s,r){Qs(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await yv(e,t,s,rp(),r);return _x(e,i,Om())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await yv(e,t,s,rp(),r);return AD(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Qs(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await ux(e),s=new HD(e);return t.register("authEvent",r=>(we(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yf,{type:yf},r=>{const i=r?.[0]?.[yf];i!==void 0&&t(!!i),Rs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ZD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return qw()||Mw()||Dm()}}const wx=Tx;var vv="@firebase/auth",Ev="1.12.0";class bx{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ax(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Sx(n){Fi(new $r("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;we(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jw(n)},u=new nD(s,r,i,l);return lD(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Fi(new $r("auth-internal",e=>{const t=td(e.getProvider("auth").getImmediate());return(s=>new bx(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ts(vv,Ev,Ax(n)),Ts(vv,Ev,"esm2020")}const Rx=300,Cx=pw("authIdTokenMaxAge")||Rx;let Iv=null;const Px=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Cx)return;const r=t?.token;Iv!==r&&(Iv=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function Nx(n=Aw()){const e=Sc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=aD(n,{popupRedirectResolver:wx,persistence:[VD,TD,Yw]}),s=pw("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=Px(i.toString());gD(t,o,()=>o(t.currentUser)),_D(t,a=>o(a))}}const r=dw("auth");return r&&cD(t,`http://${r}`),t}function kx(){return document.getElementsByTagName("head")?.[0]??document}sD({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=es("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",kx().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Sx("Browser");var Dx="firebase",xx="12.7.0";Ts(Dx,xx,"app");var Tv={};const wv="@firebase/database",bv="1.1.0";let rb="";function Vx(n){rb=n}class Ox{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ht(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:tc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Mx{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return er(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ib=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ox(e)}}catch{}return new Mx},Si=ib("localStorage"),Lx=ib("sessionStorage");const Uo=new ed("@firebase/database"),Fx=(function(){let n=1;return function(){return n++}})(),ob=function(n){const e=IN(n),t=new _N;t.update(e);const s=t.digest();return Tm.encodeByteArray(s)},Nc=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Nc.apply(null,s):typeof s=="object"?e+=Ht(s):e+=s,e+=" "}return e};let xl=null,Av=!0;const Ux=function(n,e){oe(!0,"Can't turn on custom loggers persistently."),Uo.logLevel=ke.VERBOSE,xl=Uo.log.bind(Uo)},rn=function(...n){if(Av===!0&&(Av=!1,xl===null&&Lx.get("logging_enabled")===!0&&Ux()),xl){const e=Nc.apply(null,n);xl(e)}},kc=function(n){return function(...e){rn(n,...e)}},ap=function(...n){const e="FIREBASE INTERNAL ERROR: "+Nc(...n);Uo.error(e)},Bi=function(...n){const e=`FIREBASE FATAL ERROR: ${Nc(...n)}`;throw Uo.error(e),new Error(e)},On=function(...n){const e="FIREBASE WARNING: "+Nc(...n);Uo.warn(e)},Bx=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&On("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ab=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},$x=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Jo="[MIN_NAME]",$i="[MAX_NAME]",Aa=function(n,e){if(n===e)return 0;if(n===Jo||e===$i)return-1;if(e===Jo||n===$i)return 1;{const t=Sv(n),s=Sv(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},qx=function(n,e){return n===e?0:n<e?-1:1},ol=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ht(e))},Lm=function(n){if(typeof n!="object"||n===null)return Ht(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Ht(e[s]),t+=":",t+=Lm(n[e[s]]);return t+="}",t},lb=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function Gn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const cb=function(n){oe(!ab(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,a,l;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const h=u.join("");let d="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),d=d+p}return d.toLowerCase()},jx=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Gx=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},Kx=new RegExp("^-?(0*)\\d{1,10}$"),Wx=-2147483648,zx=2147483647,Sv=function(n){if(Kx.test(n)){const e=Number(n);if(e>=Wx&&e<=zx)return e}return null},Dc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw On("Exception was thrown by user callback.",t),e},Math.floor(0))}},Hx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Vl=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Qx{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Fn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){On(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Yx{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(rn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',On(e)}}const Fm="5",ub="v",hb="s",db="r",fb="f",pb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,mb="ls",_b="p",lp="ac",gb="websocket",yb="long_polling";class Jx{constructor(e,t,s,r,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Si.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Si.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Xx(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function vb(n,e,t){oe(typeof e=="string","typeof type must == string"),oe(typeof t=="object","typeof params must == object");let s;if(e===gb)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===yb)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Xx(n)&&(t.ns=n.namespace);const r=[];return Gn(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}class Zx{constructor(){this.counters_={}}incrementCounter(e,t=1){er(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return J1(this.counters_)}}const vf={},Ef={};function Um(n){const e=n.toString();return vf[e]||(vf[e]=new Zx),vf[e]}function eV(n,e){const t=n.toString();return Ef[t]||(Ef[t]=e()),Ef[t]}class tV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Dc(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Rv="start",nV="close",sV="pLPCommand",rV="pRTLPCB",Eb="id",Ib="pw",Tb="ser",iV="cb",oV="seg",aV="ts",lV="d",cV="dframe",wb=1870,bb=30,uV=wb-bb,hV=25e3,dV=3e4;class Po{constructor(e,t,s,r,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=kc(e),this.stats_=Um(t),this.urlFn=l=>(this.appCheckToken&&(l[lp]=this.appCheckToken),vb(t,yb,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(dV)),$x(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bm((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Rv)this.id=a,this.password=l;else if(o===nV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[Rv]="t",s[Tb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[iV]=this.scriptTagHolder.uniqueCallbackIdentifier),s[ub]=Fm,this.transportSessionId&&(s[hb]=this.transportSessionId),this.lastSessionId&&(s[mb]=this.lastSessionId),this.applicationId&&(s[_b]=this.applicationId),this.appCheckToken&&(s[lp]=this.appCheckToken),typeof location<"u"&&location.hostname&&pb.test(location.hostname)&&(s[db]=fb);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Po.forceAllow_=!0}static forceDisallow(){Po.forceDisallow_=!0}static isAvailable(){return Po.forceAllow_?!0:!Po.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!jx()&&!Gx()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ht(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=cw(t),r=lb(s,uV);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[cV]="t",s[Eb]=e,s[Ib]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ht(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Bm{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Fx(),window[sV+this.uniqueCallbackIdentifier]=e,window[rV+this.uniqueCallbackIdentifier]=t,this.myIFrame=Bm.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){rn("frame writing exception"),a.stack&&rn(a.stack),rn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rn("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Eb]=this.myID,e[Ib]=this.myPW,e[Tb]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+bb+s.length<=wb;){const o=this.pendingSegs.shift();s=s+"&"+oV+r+"="+o.seg+"&"+aV+r+"="+o.ts+"&"+lV+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(hV)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{rn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const fV=16384,pV=45e3;let hh=null;typeof MozWebSocket<"u"?hh=MozWebSocket:typeof WebSocket<"u"&&(hh=WebSocket);class Hn{constructor(e,t,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=kc(this.connId),this.stats_=Um(t),this.connURL=Hn.connectionURL_(t,o,a,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[ub]=Fm,typeof location<"u"&&location.hostname&&pb.test(location.hostname)&&(o[db]=fb),t&&(o[hb]=t),s&&(o[mb]=s),r&&(o[lp]=r),i&&(o[_b]=i),vb(e,gb,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Si.set("previous_websocket_failure",!0);try{let s;cN(),this.mySock=new hh(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Hn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&hh!==null&&!Hn.forceDisallow_}static previouslyFailed(){return Si.isInMemoryStorage||Si.get("previous_websocket_failure")===!0}markConnectionHealthy(){Si.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=tc(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(oe(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Ht(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=lb(t,fV);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(pV))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Hn.responsesRequiredToBeHealthy=2;Hn.healthyTimeout=3e4;class rc{static get ALL_TRANSPORTS(){return[Po,Hn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Hn&&Hn.isAvailable();let s=t&&!Hn.previouslyFailed();if(e.webSocketOnly&&(t||On("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Hn];else{const r=this.transports_=[];for(const i of rc.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);rc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rc.globalTransportInitialized_=!1;const mV=6e4,_V=5e3,gV=10*1024,yV=100*1024,If="t",Cv="d",vV="s",Pv="r",EV="e",Nv="o",kv="a",Dv="n",xv="p",IV="h";class TV{constructor(e,t,s,r,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=kc("c:"+this.id+":"),this.transportManager_=new rc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Vl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>yV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>gV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(If in e){const t=e[If];t===kv?this.upgradeIfSecondaryHealthy_():t===Pv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Nv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ol("t",e),s=ol("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:xv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:kv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Dv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ol("t",e),s=ol("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ol(If,e);if(Cv in e){const s=e[Cv];if(t===IV){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===Dv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===vV?this.onConnectionShutdown_(s):t===Pv?this.onReset_(s):t===EV?ap("Server Error: "+s):t===Nv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ap("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Fm!==s&&On("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Vl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(mV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(_V))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:xv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Si.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ab{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class Sb{constructor(e){this.allowedEvents_=e,this.listeners_={},oe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){oe(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class dh extends Sb{static getInstance(){return new dh}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Am()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return oe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Vv=32,Ov=768;class gt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ze(){return new gt("")}function Le(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function qr(n){return n.pieces_.length-n.pieceNum_}function pt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new gt(n.pieces_,e)}function Rb(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function wV(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Cb(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Pb(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new gt(e,0)}function jt(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof gt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new gt(t,0)}function Ve(n){return n.pieceNum_>=n.pieces_.length}function Bn(n,e){const t=Le(n),s=Le(e);if(t===null)return e;if(t===s)return Bn(pt(n),pt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Nb(n,e){if(qr(n)!==qr(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Yn(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(qr(n)>qr(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class bV{constructor(e,t){this.errorPrefix_=t,this.parts_=Cb(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Zh(this.parts_[s]);kb(this)}}function AV(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Zh(e),kb(n)}function SV(n){const e=n.parts_.pop();n.byteLength_-=Zh(e),n.parts_.length>0&&(n.byteLength_-=1)}function kb(n){if(n.byteLength_>Ov)throw new Error(n.errorPrefix_+"has a key path longer than "+Ov+" bytes ("+n.byteLength_+").");if(n.parts_.length>Vv)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Vv+") or object contains a cycle "+gi(n))}function gi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class $m extends Sb{static getInstance(){return new $m}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return oe(e==="visible","Unknown event type: "+e),[this.visible_]}}const al=1e3,RV=300*1e3,Mv=30*1e3,CV=1.3,PV=3e4,NV="server_kill",Lv=3;class js extends Ab{constructor(e,t,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=js.nextPersistentConnectionId_++,this.log_=kc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=al,this.maxReconnectDelay_=RV,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");$m.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&dh.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Ht(i)),oe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new wm,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),oe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;js.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&er(e,"w")){const s=Qo(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();On(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||mN(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Mv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=pN(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ht(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ap("Unrecognized action received from server: "+Ht(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){oe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=al,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=al,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>PV&&(this.reconnectDelay_=al),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*CV)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+js.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(d){oe(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?rn("getToken() completed but was canceled"):(rn("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,a=new TV(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,_=>{On(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(NV)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&On(d),l())}}}interrupt(e){rn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Zf(this.interruptReasons_)&&(this.reconnectDelay_=al,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>Lm(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new gt(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){rn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Lv&&(this.reconnectDelay_=Mv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){rn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Lv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+rb.replace(/\./g,"-")]=1,Am()?e["framework.cordova"]=1:gw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=dh.getInstance().currentlyOnline();return Zf(this.interruptReasons_)&&e}}js.nextPersistentConnectionId_=0;js.nextConnectionId_=0;class Fe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Fe(e,t)}}class rd{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Fe(Jo,e),r=new Fe(Jo,t);return this.compare(s,r)!==0}minPost(){return Fe.MIN}}let du;class Db extends rd{static get __EMPTY_NODE(){return du}static set __EMPTY_NODE(e){du=e}compare(e,t){return Aa(e.name,t.name)}isDefinedOn(e){throw Ta("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Fe.MIN}maxPost(){return new Fe($i,du)}makePost(e,t){return oe(typeof e=="string","KeyIndex indexValue must always be a string."),new Fe(e,du)}toString(){return".key"}}const Bo=new Db;let fu=class{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Dn=class vl{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??vl.RED,this.left=r??_s.EMPTY_NODE,this.right=i??_s.EMPTY_NODE}copy(e,t,s,r,i){return new vl(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return _s.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return _s.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,vl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,vl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Dn.RED=!0;Dn.BLACK=!1;class kV{copy(e,t,s,r,i){return this}insert(e,t,s){return new Dn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let _s=class Vu{constructor(e,t=Vu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Vu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Dn.BLACK,null,null))}remove(e){return new Vu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Dn.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fu(this.root_,null,this.comparator_,!0,e)}};_s.EMPTY_NODE=new kV;function DV(n,e){return Aa(n.name,e.name)}function qm(n,e){return Aa(n,e)}let cp;function xV(n){cp=n}const xb=function(n){return typeof n=="number"?"number:"+cb(n):"string:"+n},Vb=function(n){if(n.isLeafNode()){const e=n.val();oe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&er(e,".sv"),"Priority must be a string or number.")}else oe(n===cp||n.isEmpty(),"priority of unexpected type.");oe(n===cp||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Fv;class Bt{static set __childrenNodeConstructor(e){Fv=e}static get __childrenNodeConstructor(){return Fv}constructor(e,t=Bt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,oe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Vb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Bt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Bt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ve(e)?this:Le(e)===".priority"?this.priorityNode_:Bt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Bt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Le(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(oe(s!==".priority"||qr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Bt.__childrenNodeConstructor.EMPTY_NODE.updateChild(pt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+xb(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=cb(this.value_):e+=this.value_,this.lazyHash_=ob(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Bt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Bt.__childrenNodeConstructor?-1:(oe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=Bt.VALUE_TYPE_ORDER.indexOf(t),i=Bt.VALUE_TYPE_ORDER.indexOf(s);return oe(r>=0,"Unknown leaf type: "+t),oe(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Bt.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Ob,Mb;function VV(n){Ob=n}function OV(n){Mb=n}class MV extends rd{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?Aa(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Fe.MIN}maxPost(){return new Fe($i,new Bt("[PRIORITY-POST]",Mb))}makePost(e,t){const s=Ob(e);return new Fe(t,new Bt("[PRIORITY-POST]",s))}toString(){return".priority"}}const ln=new MV;const LV=Math.log(2);class FV{constructor(e){const t=i=>parseInt(Math.log(i)/LV,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const fh=function(n,e,t,s){n.sort(e);const r=function(l,u){const h=u-l;let d,p;if(h===0)return null;if(h===1)return d=n[l],p=t?t(d):d,new Dn(p,d.node,Dn.BLACK,null,null);{const _=parseInt(h/2,10)+l,E=r(l,_),b=r(_+1,u);return d=n[_],p=t?t(d):d,new Dn(p,d.node,Dn.BLACK,E,b)}},i=function(l){let u=null,h=null,d=n.length;const p=function(E,b){const C=d-E,F=d;d-=E;const U=r(C+1,F),N=n[C],k=t?t(N):N;_(new Dn(k,N.node,b,null,U))},_=function(E){u?(u.left=E,u=E):(h=E,u=E)};for(let E=0;E<l.count;++E){const b=l.nextBitIsOne(),C=Math.pow(2,l.count-(E+1));b?p(C,Dn.BLACK):(p(C,Dn.BLACK),p(C,Dn.RED))}return h},o=new FV(n.length),a=i(o);return new _s(s||e,a)};let Tf;const _o={};class Us{static get Default(){return oe(_o&&ln,"ChildrenNode.ts has not been loaded"),Tf=Tf||new Us({".priority":_o},{".priority":ln}),Tf}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Qo(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof _s?t:null}hasIndex(e){return er(this.indexSet_,e.toString())}addIndex(e,t){oe(e!==Bo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(Fe.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=fh(s,e.getCompare()):a=_o;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new Us(h,u)}addToIndexes(e,t){const s=nh(this.indexes_,(r,i)=>{const o=Qo(this.indexSet_,i);if(oe(o,"Missing index implementation for "+i),r===_o)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Fe.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),fh(a,o.getCompare())}else return _o;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new Fe(e.name,a))),l.insert(e,e.node)}});return new Us(s,this.indexSet_)}removeFromIndexes(e,t){const s=nh(this.indexes_,r=>{if(r===_o)return r;{const i=t.get(e.name);return i?r.remove(new Fe(e.name,i)):r}});return new Us(s,this.indexSet_)}}let ll;class ze{static get EMPTY_NODE(){return ll||(ll=new ze(new _s(qm),null,Us.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Vb(this.priorityNode_),this.children_.isEmpty()&&oe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ll}updatePriority(e){return this.children_.isEmpty()?this:new ze(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ll:t}}getChild(e){const t=Le(e);return t===null?this:this.getImmediateChild(t).getChild(pt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(oe(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Fe(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?ll:this.priorityNode_;return new ze(r,o,i)}}updateChild(e,t){const s=Le(e);if(s===null)return t;{oe(Le(e)!==".priority"||qr(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(pt(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(ln,(o,a)=>{t[o]=a.val(e),s++,i&&ze.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+xb(this.getPriority().val())+":"),this.forEachChild(ln,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":ob(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new Fe(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Fe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Fe(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Fe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Fe.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===xc?-1:0}withIndex(e){if(e===Bo||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ze(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Bo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(ln),r=t.getIterator(ln);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Bo?null:this.indexMap_.get(e.toString())}}ze.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class UV extends ze{constructor(){super(new _s(qm),ze.EMPTY_NODE,Us.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ze.EMPTY_NODE}isEmpty(){return!1}}const xc=new UV;Object.defineProperties(Fe,{MIN:{value:new Fe(Jo,ze.EMPTY_NODE)},MAX:{value:new Fe($i,xc)}});Db.__EMPTY_NODE=ze.EMPTY_NODE;Bt.__childrenNodeConstructor=ze;xV(xc);OV(xc);const BV=!0;function on(n,e=null){if(n===null)return ze.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),oe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Bt(t,on(e))}if(!(n instanceof Array)&&BV){const t=[];let s=!1;if(Gn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=on(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new Fe(o,l)))}}),t.length===0)return ze.EMPTY_NODE;const i=fh(t,DV,o=>o.name,qm);if(s){const o=fh(t,ln.getCompare());return new ze(i,on(e),new Us({".priority":o},{".priority":ln}))}else return new ze(i,on(e),Us.Default)}else{let t=ze.EMPTY_NODE;return Gn(n,(s,r)=>{if(er(n,s)&&s.substring(0,1)!=="."){const i=on(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(on(e))}}VV(on);class $V extends rd{constructor(e){super(),this.indexPath_=e,oe(!Ve(e)&&Le(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?Aa(e.name,t.name):i}makePost(e,t){const s=on(e),r=ze.EMPTY_NODE.updateChild(this.indexPath_,s);return new Fe(t,r)}maxPost(){const e=ze.EMPTY_NODE.updateChild(this.indexPath_,xc);return new Fe($i,e)}toString(){return Cb(this.indexPath_,0).join("/")}}class qV extends rd{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Aa(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Fe.MIN}maxPost(){return Fe.MAX}makePost(e,t){const s=on(e);return new Fe(t,s)}toString(){return".value"}}const jV=new qV;function GV(n){return{type:"value",snapshotNode:n}}function KV(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function WV(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Uv(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function zV(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class jm{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ln}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return oe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return oe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Jo}hasEnd(){return this.endSet_}getIndexEndValue(){return oe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return oe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:$i}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return oe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ln}copy(){const e=new jm;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Bv(n){const e={};if(n.isDefault())return e;let t;if(n.index_===ln?t="$priority":n.index_===jV?t="$value":n.index_===Bo?t="$key":(oe(n.index_ instanceof $V,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ht(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Ht(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Ht(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Ht(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Ht(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function $v(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ln&&(e.i=n.index_.toString()),e}class ph extends Ab{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(oe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=kc("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=ph.getListenId_(e,s),a={};this.listens_[o]=a;const l=Bv(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let d=h;if(u===404&&(d=null,u=null),u===null&&this.onDataUpdate_(i,d,!1,s),Qo(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",r(p,null)}})}unlisten(e,t){const s=ph.getListenId_(e,t);delete this.listens_[s]}get(e){const t=Bv(e._queryParams),s=e._path.toString(),r=new wm;return this.restRequest_(s+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+wa(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=tc(a.responseText)}catch{On("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&On("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class HV{constructor(){this.rootNode_=ze.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function mh(){return{value:null,children:new Map}}function Lb(n,e,t){if(Ve(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Le(e);n.children.has(s)||n.children.set(s,mh());const r=n.children.get(s);e=pt(e),Lb(r,e,t)}}function up(n,e,t){n.value!==null?t(e,n.value):QV(n,(s,r)=>{const i=new gt(e.toString()+"/"+s);up(r,i,t)})}function QV(n,e){n.children.forEach((t,s)=>{e(s,t)})}class YV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Gn(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}const qv=10*1e3,JV=30*1e3,XV=300*1e3;class ZV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new YV(e);const s=qv+(JV-qv)*Math.random();Vl(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;Gn(e,(r,i)=>{i>0&&er(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),Vl(this.reportStats_.bind(this),Math.floor(Math.random()*2*XV))}}var gs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(gs||(gs={}));function Fb(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ub(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Bb(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class _h{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=gs.ACK_USER_WRITE,this.source=Fb()}operationForChild(e){if(Ve(this.path)){if(this.affectedTree.value!=null)return oe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new gt(e));return new _h(Ze(),t,this.revert)}}else return oe(Le(this.path)===e,"operationForChild called for unrelated child."),new _h(pt(this.path),this.affectedTree,this.revert)}}class qi{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=gs.OVERWRITE}operationForChild(e){return Ve(this.path)?new qi(this.source,Ze(),this.snap.getImmediateChild(e)):new qi(this.source,pt(this.path),this.snap)}}class ic{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=gs.MERGE}operationForChild(e){if(Ve(this.path)){const t=this.children.subtree(new gt(e));return t.isEmpty()?null:t.value?new qi(this.source,Ze(),t.value):new ic(this.source,Ze(),t)}else return oe(Le(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ic(this.source,pt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Gm{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ve(e))return this.isFullyInitialized()&&!this.filtered_;const t=Le(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function eO(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(zV(o.childName,o.snapshotNode))}),cl(n,r,"child_removed",e,s,t),cl(n,r,"child_added",e,s,t),cl(n,r,"child_moved",i,s,t),cl(n,r,"child_changed",e,s,t),cl(n,r,"value",e,s,t),r}function cl(n,e,t,s,r,i){const o=s.filter(a=>a.type===t);o.sort((a,l)=>nO(n,a,l)),o.forEach(a=>{const l=tO(n,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function tO(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function nO(n,e,t){if(e.childName==null||t.childName==null)throw Ta("Should only compare child_ events.");const s=new Fe(e.childName,e.snapshotNode),r=new Fe(t.childName,t.snapshotNode);return n.index_.compare(s,r)}function $b(n,e){return{eventCache:n,serverCache:e}}function Ol(n,e,t,s){return $b(new Gm(e,t,s),n.serverCache)}function qb(n,e,t,s){return $b(n.eventCache,new Gm(e,t,s))}function hp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ji(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let wf;const sO=()=>(wf||(wf=new _s(qx)),wf);class ft{static fromObject(e){let t=new ft(null);return Gn(e,(s,r)=>{t=t.set(new gt(s),r)}),t}constructor(e,t=sO()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ze(),value:this.value};if(Ve(e))return null;{const s=Le(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(pt(e),t);return i!=null?{path:jt(new gt(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ve(e))return this;{const t=Le(e),s=this.children.get(t);return s!==null?s.subtree(pt(e)):new ft(null)}}set(e,t){if(Ve(e))return new ft(t,this.children);{const s=Le(e),i=(this.children.get(s)||new ft(null)).set(pt(e),t),o=this.children.insert(s,i);return new ft(this.value,o)}}remove(e){if(Ve(e))return this.children.isEmpty()?new ft(null):new ft(null,this.children);{const t=Le(e),s=this.children.get(t);if(s){const r=s.remove(pt(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new ft(null):new ft(this.value,i)}else return this}}get(e){if(Ve(e))return this.value;{const t=Le(e),s=this.children.get(t);return s?s.get(pt(e)):null}}setTree(e,t){if(Ve(e))return t;{const s=Le(e),i=(this.children.get(s)||new ft(null)).setTree(pt(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new ft(this.value,o)}}fold(e){return this.fold_(Ze(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(jt(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,Ze(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(Ve(e))return null;{const i=Le(e),o=this.children.get(i);return o?o.findOnPath_(pt(e),jt(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ze(),t)}foreachOnPath_(e,t,s){if(Ve(e))return this;{this.value&&s(t,this.value);const r=Le(e),i=this.children.get(r);return i?i.foreachOnPath_(pt(e),jt(t,r),s):new ft(null)}}foreach(e){this.foreach_(Ze(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(jt(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class ts{constructor(e){this.writeTree_=e}static empty(){return new ts(new ft(null))}}function Ml(n,e,t){if(Ve(e))return new ts(new ft(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=Bn(r,e);return i=i.updateChild(o,t),new ts(n.writeTree_.set(r,i))}else{const r=new ft(t),i=n.writeTree_.setTree(e,r);return new ts(i)}}}function jv(n,e,t){let s=n;return Gn(t,(r,i)=>{s=Ml(s,jt(e,r),i)}),s}function Gv(n,e){if(Ve(e))return ts.empty();{const t=n.writeTree_.setTree(e,new ft(null));return new ts(t)}}function dp(n,e){return so(n,e)!=null}function so(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Bn(t.path,e)):null}function Kv(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ln,(s,r)=>{e.push(new Fe(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new Fe(s,r.value))}),e}function Lr(n,e){if(Ve(e))return n;{const t=so(n,e);return t!=null?new ts(new ft(t)):new ts(n.writeTree_.subtree(e))}}function fp(n){return n.writeTree_.isEmpty()}function Xo(n,e){return jb(Ze(),n.writeTree_,e)}function jb(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(oe(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=jb(jt(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(jt(n,".priority"),s)),t}}function Gb(n,e){return Qb(e,n)}function rO(n,e,t,s,r){oe(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=Ml(n.visibleWrites,e,t)),n.lastWriteId=s}function iO(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function oO(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);oe(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&aO(a,s.path)?r=!1:Yn(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return lO(n),!0;if(s.snap)n.visibleWrites=Gv(n.visibleWrites,s.path);else{const a=s.children;Gn(a,l=>{n.visibleWrites=Gv(n.visibleWrites,jt(s.path,l))})}return!0}else return!1}function aO(n,e){if(n.snap)return Yn(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Yn(jt(n.path,t),e))return!0;return!1}function lO(n){n.visibleWrites=Kb(n.allWrites,cO,Ze()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function cO(n){return n.visible}function Kb(n,e,t){let s=ts.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let a;if(i.snap)Yn(t,o)?(a=Bn(t,o),s=Ml(s,a,i.snap)):Yn(o,t)&&(a=Bn(o,t),s=Ml(s,Ze(),i.snap.getChild(a)));else if(i.children){if(Yn(t,o))a=Bn(t,o),s=jv(s,a,i.children);else if(Yn(o,t))if(a=Bn(o,t),Ve(a))s=jv(s,Ze(),i.children);else{const l=Qo(i.children,Le(a));if(l){const u=l.getChild(pt(a));s=Ml(s,Ze(),u)}}}else throw Ta("WriteRecord should have .snap or .children")}}return s}function Wb(n,e,t,s,r){if(!s&&!r){const i=so(n.visibleWrites,e);if(i!=null)return i;{const o=Lr(n.visibleWrites,e);if(fp(o))return t;if(t==null&&!dp(o,Ze()))return null;{const a=t||ze.EMPTY_NODE;return Xo(o,a)}}}else{const i=Lr(n.visibleWrites,e);if(!r&&fp(i))return t;if(!r&&t==null&&!dp(i,Ze()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(Yn(u.path,e)||Yn(e,u.path))},a=Kb(n.allWrites,o,e),l=t||ze.EMPTY_NODE;return Xo(a,l)}}}function uO(n,e,t){let s=ze.EMPTY_NODE;const r=so(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(ln,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=Lr(n.visibleWrites,e);return t.forEachChild(ln,(o,a)=>{const l=Xo(Lr(i,new gt(o)),a);s=s.updateImmediateChild(o,l)}),Kv(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=Lr(n.visibleWrites,e);return Kv(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function hO(n,e,t,s,r){oe(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=jt(e,t);if(dp(n.visibleWrites,i))return null;{const o=Lr(n.visibleWrites,i);return fp(o)?r.getChild(t):Xo(o,r.getChild(t))}}function dO(n,e,t,s){const r=jt(e,t),i=so(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=Lr(n.visibleWrites,r);return Xo(o,s.getNode().getImmediateChild(t))}else return null}function fO(n,e){return so(n.visibleWrites,e)}function pO(n,e,t,s,r,i,o){let a;const l=Lr(n.visibleWrites,e),u=so(l,Ze());if(u!=null)a=u;else if(t!=null)a=Xo(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),p=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let _=p.getNext();for(;_&&h.length<r;)d(_,s)!==0&&h.push(_),_=p.getNext();return h}else return[]}function mO(){return{visibleWrites:ts.empty(),allWrites:[],lastWriteId:-1}}function pp(n,e,t,s){return Wb(n.writeTree,n.treePath,e,t,s)}function zb(n,e){return uO(n.writeTree,n.treePath,e)}function Wv(n,e,t,s){return hO(n.writeTree,n.treePath,e,t,s)}function gh(n,e){return fO(n.writeTree,jt(n.treePath,e))}function _O(n,e,t,s,r,i){return pO(n.writeTree,n.treePath,e,t,s,r,i)}function Km(n,e,t){return dO(n.writeTree,n.treePath,e,t)}function Hb(n,e){return Qb(jt(n.treePath,e),n.writeTree)}function Qb(n,e){return{treePath:n,writeTree:e}}class gO{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;oe(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),oe(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,Uv(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,WV(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,KV(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,Uv(s,e.snapshotNode,r.oldSnap));else throw Ta("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class yO{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const Yb=new yO;class Wm{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Gm(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Km(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ji(this.viewCache_),i=_O(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}function vO(n,e){oe(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),oe(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function EO(n,e,t,s,r){const i=new gO;let o,a;if(t.type===gs.OVERWRITE){const u=t;u.source.fromUser?o=mp(n,e,u.path,u.snap,s,r,i):(oe(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Ve(u.path),o=yh(n,e,u.path,u.snap,s,r,a,i))}else if(t.type===gs.MERGE){const u=t;u.source.fromUser?o=TO(n,e,u.path,u.children,s,r,i):(oe(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=_p(n,e,u.path,u.children,s,r,a,i))}else if(t.type===gs.ACK_USER_WRITE){const u=t;u.revert?o=AO(n,e,u.path,s,r,i):o=wO(n,e,u.path,u.affectedTree,s,r,i)}else if(t.type===gs.LISTEN_COMPLETE)o=bO(n,e,t.path,s,i);else throw Ta("Unknown operation type: "+t.type);const l=i.getChanges();return IO(e,o,l),{viewCache:o,changes:l}}function IO(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=hp(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(GV(hp(e)))}}function Jb(n,e,t,s,r,i){const o=e.eventCache;if(gh(s,t)!=null)return e;{let a,l;if(Ve(t))if(oe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ji(e),h=u instanceof ze?u:ze.EMPTY_NODE,d=zb(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const u=pp(s,ji(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Le(t);if(u===".priority"){oe(qr(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=Wv(s,t,h,l);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{const h=pt(t);let d;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=Wv(s,t,o.getNode(),l);p!=null?d=o.getNode().getImmediateChild(u).updateChild(h,p):d=o.getNode().getImmediateChild(u)}else d=Km(s,u,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),u,d,h,r,i):a=o.getNode()}}return Ol(e,a,o.isFullyInitialized()||Ve(t),n.filter.filtersNodes())}}function yh(n,e,t,s,r,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Ve(t))u=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,s);u=h.updateFullNode(l.getNode(),_,null)}else{const _=Le(t);if(!l.isCompleteForPath(t)&&qr(t)>1)return e;const E=pt(t),C=l.getNode().getImmediateChild(_).updateChild(E,s);_===".priority"?u=h.updatePriority(l.getNode(),C):u=h.updateChild(l.getNode(),_,C,E,Yb,null)}const d=qb(e,u,l.isFullyInitialized()||Ve(t),h.filtersNodes()),p=new Wm(r,d,i);return Jb(n,d,t,r,p,a)}function mp(n,e,t,s,r,i,o){const a=e.eventCache;let l,u;const h=new Wm(r,e,i);if(Ve(t))u=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=Ol(e,u,!0,n.filter.filtersNodes());else{const d=Le(t);if(d===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),s),l=Ol(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=pt(t),_=a.getNode().getImmediateChild(d);let E;if(Ve(p))E=s;else{const b=h.getCompleteChild(d);b!=null?Rb(p)===".priority"&&b.getChild(Pb(p)).isEmpty()?E=b:E=b.updateChild(p,s):E=ze.EMPTY_NODE}if(_.equals(E))l=e;else{const b=n.filter.updateChild(a.getNode(),d,E,p,h,o);l=Ol(e,b,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function zv(n,e){return n.eventCache.isCompleteForChild(e)}function TO(n,e,t,s,r,i,o){let a=e;return s.foreach((l,u)=>{const h=jt(t,l);zv(e,Le(h))&&(a=mp(n,a,h,u,r,i,o))}),s.foreach((l,u)=>{const h=jt(t,l);zv(e,Le(h))||(a=mp(n,a,h,u,r,i,o))}),a}function Hv(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function _p(n,e,t,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Ve(t)?u=s:u=new ft(null).setTree(t,s);const h=e.serverCache.getNode();return u.children.inorderTraversal((d,p)=>{if(h.hasChild(d)){const _=e.serverCache.getNode().getImmediateChild(d),E=Hv(n,_,p);l=yh(n,l,new gt(d),E,r,i,o,a)}}),u.children.inorderTraversal((d,p)=>{const _=!e.serverCache.isCompleteForChild(d)&&p.value===null;if(!h.hasChild(d)&&!_){const E=e.serverCache.getNode().getImmediateChild(d),b=Hv(n,E,p);l=yh(n,l,new gt(d),b,r,i,o,a)}}),l}function wO(n,e,t,s,r,i,o){if(gh(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Ve(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return yh(n,e,t,l.getNode().getChild(t),r,i,a,o);if(Ve(t)){let u=new ft(null);return l.getNode().forEachChild(Bo,(h,d)=>{u=u.set(new gt(h),d)}),_p(n,e,t,u,r,i,a,o)}else return e}else{let u=new ft(null);return s.foreach((h,d)=>{const p=jt(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),_p(n,e,t,u,r,i,a,o)}}function bO(n,e,t,s,r){const i=e.serverCache,o=qb(e,i.getNode(),i.isFullyInitialized()||Ve(t),i.isFiltered());return Jb(n,o,t,s,Yb,r)}function AO(n,e,t,s,r,i){let o;if(gh(s,t)!=null)return e;{const a=new Wm(s,e,r),l=e.eventCache.getNode();let u;if(Ve(t)||Le(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=pp(s,ji(e));else{const d=e.serverCache.getNode();oe(d instanceof ze,"serverChildren would be complete if leaf node"),h=zb(s,d)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=Le(t);let d=Km(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?u=n.filter.updateChild(l,h,d,pt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,ze.EMPTY_NODE,pt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=pp(s,ji(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||gh(s,Ze())!=null,Ol(e,u,o,n.filter.filtersNodes())}}function SO(n,e){const t=ji(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ve(e)&&!t.getImmediateChild(Le(e)).isEmpty())?t.getChild(e):null}function Qv(n,e,t,s){e.type===gs.MERGE&&e.source.queryId!==null&&(oe(ji(n.viewCache_),"We should always have a full cache before handling merges"),oe(hp(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=EO(n.processor_,r,e,t,s);return vO(n.processor_,i.viewCache),oe(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,RO(n,i.changes,i.viewCache.eventCache.getNode())}function RO(n,e,t,s){const r=n.eventRegistrations_;return eO(n.eventGenerator_,e,t,r)}let Yv;function CO(n){oe(!Yv,"__referenceConstructor has already been defined"),Yv=n}function zm(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return oe(i!=null,"SyncTree gave us an op for an invalid query."),Qv(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat(Qv(o,e,t,s));return i}}function Hm(n,e){let t=null;for(const s of n.views.values())t=t||SO(s,e);return t}let Jv;function PO(n){oe(!Jv,"__referenceConstructor has already been defined"),Jv=n}class Xv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ft(null),this.pendingWriteTree_=mO(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function NO(n,e,t,s,r){return rO(n.pendingWriteTree_,e,t,s,r),r?od(n,new qi(Fb(),e,t)):[]}function No(n,e,t=!1){const s=iO(n.pendingWriteTree_,e);if(oO(n.pendingWriteTree_,e)){let i=new ft(null);return s.snap!=null?i=i.set(Ze(),!0):Gn(s.children,o=>{i=i.set(new gt(o),!0)}),od(n,new _h(s.path,i,t))}else return[]}function id(n,e,t){return od(n,new qi(Ub(),e,t))}function kO(n,e,t){const s=ft.fromObject(t);return od(n,new ic(Ub(),e,s))}function DO(n,e,t,s){const r=tA(n,s);if(r!=null){const i=nA(r),o=i.path,a=i.queryId,l=Bn(o,e),u=new qi(Bb(a),l,t);return sA(n,o,u)}else return[]}function xO(n,e,t,s){const r=tA(n,s);if(r){const i=nA(r),o=i.path,a=i.queryId,l=Bn(o,e),u=ft.fromObject(t),h=new ic(Bb(a),l,u);return sA(n,o,h)}else return[]}function Xb(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Bn(o,e),u=Hm(a,l);if(u)return u});return Wb(r,e,i,t,!0)}function od(n,e){return Zb(e,n.syncPointTree_,null,Gb(n.pendingWriteTree_,Ze()))}function Zb(n,e,t,s){if(Ve(n.path))return eA(n,e,t,s);{const r=e.get(Ze());t==null&&r!=null&&(t=Hm(r,Ze()));let i=[];const o=Le(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=Hb(s,o);i=i.concat(Zb(a,l,u,h))}return r&&(i=i.concat(zm(r,n,s,t))),i}}function eA(n,e,t,s){const r=e.get(Ze());t==null&&r!=null&&(t=Hm(r,Ze()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=Hb(s,o),h=n.operationForChild(o);h&&(i=i.concat(eA(h,a,l,u)))}),r&&(i=i.concat(zm(r,n,s,t))),i}function tA(n,e){return n.tagToQueryMap.get(e)}function nA(n){const e=n.indexOf("$");return oe(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new gt(n.substr(0,e))}}function sA(n,e,t){const s=n.syncPointTree_.get(e);oe(s,"Missing sync point for query tag that we're tracking");const r=Gb(n.pendingWriteTree_,e);return zm(s,t,r,null)}class Qm{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Qm(t)}node(){return this.node_}}class Ym{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=jt(this.path_,e);return new Ym(this.syncTree_,t)}node(){return Xb(this.syncTree_,this.path_)}}const VO=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Zv=function(n,e,t){if(!n||typeof n!="object")return n;if(oe(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return OO(n[".sv"],e,t);if(typeof n[".sv"]=="object")return MO(n[".sv"],e);oe(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},OO=function(n,e,t){if(n==="timestamp")return t.timestamp;oe(!1,"Unexpected server value: "+n)},MO=function(n,e,t){n.hasOwnProperty("increment")||oe(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&oe(!1,"Unexpected increment value: "+s);const r=e.node();if(oe(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},LO=function(n,e,t,s){return Jm(e,new Ym(t,n),s)},FO=function(n,e,t){return Jm(n,new Qm(e),t)};function Jm(n,e,t){const s=n.getPriority().val(),r=Zv(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=Zv(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Bt(a,on(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Bt(r))),o.forEachChild(ln,(a,l)=>{const u=Jm(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}class Xm{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function Zm(n,e){let t=e instanceof gt?e:new gt(e),s=n,r=Le(t);for(;r!==null;){const i=Qo(s.node.children,r)||{children:{},childCount:0};s=new Xm(r,s,i),t=pt(t),r=Le(t)}return s}function Sa(n){return n.node.value}function rA(n,e){n.node.value=e,gp(n)}function iA(n){return n.node.childCount>0}function UO(n){return Sa(n)===void 0&&!iA(n)}function ad(n,e){Gn(n.node.children,(t,s)=>{e(new Xm(t,n,s))})}function oA(n,e,t,s){t&&e(n),ad(n,r=>{oA(r,e,!0)})}function BO(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Vc(n){return new gt(n.parent===null?n.name:Vc(n.parent)+"/"+n.name)}function gp(n){n.parent!==null&&$O(n.parent,n.name,n)}function $O(n,e,t){const s=UO(t),r=er(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,gp(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,gp(n))}const qO=/[\[\].#$\/\u0000-\u001F\u007F]/,jO=/[\[\].#$\u0000-\u001F\u007F]/,bf=10*1024*1024,aA=function(n){return typeof n=="string"&&n.length!==0&&!qO.test(n)},GO=function(n){return typeof n=="string"&&n.length!==0&&!jO.test(n)},KO=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),GO(n)},lA=function(n,e,t){const s=t instanceof gt?new bV(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+gi(s));if(typeof e=="function")throw new Error(n+"contains a function "+gi(s)+" with contents = "+e.toString());if(ab(e))throw new Error(n+"contains "+e.toString()+" "+gi(s));if(typeof e=="string"&&e.length>bf/3&&Zh(e)>bf)throw new Error(n+"contains a string greater than "+bf+" utf8 bytes "+gi(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Gn(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!aA(o)))throw new Error(n+" contains an invalid key ("+o+") "+gi(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);AV(s,o),lA(n,a,s),SV(s)}),r&&i)throw new Error(n+' contains ".value" child '+gi(s)+" in addition to actual children.")}},WO=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!aA(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!KO(t))throw new Error(EN(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class zO{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function HO(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!Nb(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function ro(n,e,t){HO(n,t),QO(n,s=>Yn(s,e)||Yn(e,s))}function QO(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(YO(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function YO(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();xl&&rn("event: "+t.toString()),Dc(s)}}}const JO="repo_interrupt",XO=25;class ZO{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new zO,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=mh(),this.transactionQueueTree_=new Xm,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function eM(n,e,t){if(n.stats_=Um(n.repoInfo_),n.forceRestClient_||Hx())n.server_=new ph(n.repoInfo_,(s,r,i,o)=>{eE(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>tE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ht(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new js(n.repoInfo_,e,(s,r,i,o)=>{eE(n,s,r,i,o)},s=>{tE(n,s)},s=>{nM(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=eV(n.repoInfo_,()=>new ZV(n.stats_,n.server_)),n.infoData_=new HV,n.infoSyncTree_=new Xv({startListening:(s,r,i,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=id(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),e_(n,"connected",!1),n.serverSyncTree_=new Xv({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);ro(n.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function tM(n){const t=n.infoData_.getNode(new gt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function cA(n){return VO({timestamp:tM(n)})}function eE(n,e,t,s,r){n.dataUpdateCount++;const i=new gt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const l=nh(t,u=>on(u));o=xO(n.serverSyncTree_,i,l,r)}else{const l=on(t);o=DO(n.serverSyncTree_,i,l,r)}else if(s){const l=nh(t,u=>on(u));o=kO(n.serverSyncTree_,i,l)}else{const l=on(t);o=id(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=n_(n,i)),ro(n.eventQueue_,a,o)}function tE(n,e){e_(n,"connected",e),e===!1&&rM(n)}function nM(n,e){Gn(e,(t,s)=>{e_(n,t,s)})}function e_(n,e,t){const s=new gt("/.info/"+e),r=on(t);n.infoData_.updateSnapshot(s,r);const i=id(n.infoSyncTree_,s,r);ro(n.eventQueue_,s,i)}function sM(n){return n.nextWriteId_++}function rM(n){uA(n,"onDisconnectEvents");const e=cA(n),t=mh();up(n.onDisconnect_,Ze(),(r,i)=>{const o=LO(r,i,n.serverSyncTree_,e);Lb(t,r,o)});let s=[];up(t,Ze(),(r,i)=>{s=s.concat(id(n.serverSyncTree_,r,i));const o=lM(n,r);n_(n,o)}),n.onDisconnect_=mh(),ro(n.eventQueue_,Ze(),s)}function iM(n){n.persistentConnection_&&n.persistentConnection_.interrupt(JO)}function uA(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),rn(t,...e)}function hA(n,e,t){return Xb(n.serverSyncTree_,e,t)||ze.EMPTY_NODE}function t_(n,e=n.transactionQueueTree_){if(e||ld(n,e),Sa(e)){const t=fA(n,e);oe(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&oM(n,Vc(e),t)}else iA(e)&&ad(e,t=>{t_(n,t)})}function oM(n,e,t){const s=t.map(u=>u.currentWriteId),r=hA(n,e,s);let i=r;const o=r.hash();for(let u=0;u<t.length;u++){const h=t[u];oe(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=Bn(e,h.path);i=i.updateChild(d,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{uA(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const d=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(No(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&d.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();ld(n,Zm(n.transactionQueueTree_,e)),t_(n,n.transactionQueueTree_),ro(n.eventQueue_,e,h);for(let p=0;p<d.length;p++)Dc(d[p])}else{if(u==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{On("transaction at "+l.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}n_(n,e)}},o)}function n_(n,e){const t=dA(n,e),s=Vc(t),r=fA(n,t);return aM(n,r,s),s}function aM(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Bn(t,l.path);let h=!1,d;if(oe(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(No(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=XO)h=!0,d="maxretry",r=r.concat(No(n.serverSyncTree_,l.currentWriteId,!0));else{const p=hA(n,l.path,o);l.currentInputSnapshot=p;const _=e[a].update(p.val());if(_!==void 0){lA("transaction failed: Data returned ",_,l.path);let E=on(_);typeof _=="object"&&_!=null&&er(_,".priority")||(E=E.updatePriority(p.getPriority()));const C=l.currentWriteId,F=cA(n),U=FO(E,p,F);l.currentOutputSnapshotRaw=E,l.currentOutputSnapshotResolved=U,l.currentWriteId=sM(n),o.splice(o.indexOf(C),1),r=r.concat(NO(n.serverSyncTree_,l.path,U,l.currentWriteId,l.applyLocally)),r=r.concat(No(n.serverSyncTree_,C,!0))}else h=!0,d="nodata",r=r.concat(No(n.serverSyncTree_,l.currentWriteId,!0))}ro(n.eventQueue_,t,r),r=[],h&&(e[a].status=2,(function(p){setTimeout(p,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}ld(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Dc(s[a]);t_(n,n.transactionQueueTree_)}function dA(n,e){let t,s=n.transactionQueueTree_;for(t=Le(e);t!==null&&Sa(s)===void 0;)s=Zm(s,t),e=pt(e),t=Le(e);return s}function fA(n,e){const t=[];return pA(n,e,t),t.sort((s,r)=>s.order-r.order),t}function pA(n,e,t){const s=Sa(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);ad(e,r=>{pA(n,r,t)})}function ld(n,e){const t=Sa(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,rA(e,t.length>0?t:void 0)}ad(e,s=>{ld(n,s)})}function lM(n,e){const t=Vc(dA(n,e)),s=Zm(n.transactionQueueTree_,e);return BO(s,r=>{Af(n,r)}),Af(n,s),oA(s,r=>{Af(n,r)}),t}function Af(n,e){const t=Sa(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(oe(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(oe(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(No(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?rA(e,void 0):t.length=i+1,ro(n.eventQueue_,Vc(e),r);for(let o=0;o<s.length;o++)Dc(s[o])}}function cM(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function uM(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):On(`Invalid query segment '${t}' in query '${n}'`)}return e}const nE=function(n,e){const t=hM(n),s=t.namespace;t.domain==="firebase.com"&&Bi(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Bi("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Bx();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Jx(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new gt(t.pathString)}},hM=function(n){let e="",t="",s="",r="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(r=cM(n.substring(h,d)));const p=uM(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{const E=e.indexOf(".");s=e.substring(0,E).toLowerCase(),t=e.substring(E+1),i=s}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};class s_{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return Ve(this._path)?null:Rb(this._path)}get ref(){return new Ra(this._repo,this._path)}get _queryIdentifier(){const e=$v(this._queryParams),t=Lm(e);return t==="{}"?"default":t}get _queryObject(){return $v(this._queryParams)}isEqual(e){if(e=et(e),!(e instanceof s_))return!1;const t=this._repo===e._repo,s=Nb(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+wV(this._path)}}class Ra extends s_{constructor(e,t){super(e,t,new jm,!1)}get parent(){const e=Pb(this._path);return e===null?null:new Ra(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}CO(Ra);PO(Ra);const dM="FIREBASE_DATABASE_EMULATOR_HOST",yp={};let fM=!1;function pM(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||Bi("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=nE(i,r),a=o.repoInfo,l;typeof process<"u"&&Tv&&(l=Tv[dM]),l?(i=`http://${l}?ns=${a.namespace}`,o=nE(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new Yx(n.name,n.options,e);WO("Invalid Firebase Database URL",o),Ve(o.path)||Bi("Database URL must point to the root of a Firebase Database (not including a child path).");const h=_M(a,n,u,new Qx(n,t));return new gM(h,n)}function mM(n,e){const t=yp[e];(!t||t[n.key]!==n)&&Bi(`Database ${e}(${n.repoInfo_}) has already been deleted.`),iM(n),delete t[n.key]}function _M(n,e,t,s){let r=yp[e.name];r||(r={},yp[e.name]=r);let i=r[n.toURLString()];return i&&Bi("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new ZO(n,fM,t,s),r[n.toURLString()]=i,i}class gM{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(eM(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ra(this._repo,Ze())),this._rootInternal}_delete(){return this._rootInternal!==null&&(mM(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bi("Cannot call "+e+" on a deleted database.")}}function yM(n){Vx(no),Fi(new $r("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return pM(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),Ts(wv,bv,n),Ts(wv,bv,"esm2020")}js.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};js.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};yM();var sE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Fr,mA;(function(){var n;function e(w,v){function A(){}A.prototype=v.prototype,w.F=v.prototype,w.prototype=new A,w.prototype.constructor=w,w.D=function(P,R,D){for(var T=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)T[nt-2]=arguments[nt];return v.prototype[R].apply(P,T)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(w,v,A){A||(A=0);const P=Array(16);if(typeof v=="string")for(var R=0;R<16;++R)P[R]=v.charCodeAt(A++)|v.charCodeAt(A++)<<8|v.charCodeAt(A++)<<16|v.charCodeAt(A++)<<24;else for(R=0;R<16;++R)P[R]=v[A++]|v[A++]<<8|v[A++]<<16|v[A++]<<24;v=w.g[0],A=w.g[1],R=w.g[2];let D=w.g[3],T;T=v+(D^A&(R^D))+P[0]+3614090360&4294967295,v=A+(T<<7&4294967295|T>>>25),T=D+(R^v&(A^R))+P[1]+3905402710&4294967295,D=v+(T<<12&4294967295|T>>>20),T=R+(A^D&(v^A))+P[2]+606105819&4294967295,R=D+(T<<17&4294967295|T>>>15),T=A+(v^R&(D^v))+P[3]+3250441966&4294967295,A=R+(T<<22&4294967295|T>>>10),T=v+(D^A&(R^D))+P[4]+4118548399&4294967295,v=A+(T<<7&4294967295|T>>>25),T=D+(R^v&(A^R))+P[5]+1200080426&4294967295,D=v+(T<<12&4294967295|T>>>20),T=R+(A^D&(v^A))+P[6]+2821735955&4294967295,R=D+(T<<17&4294967295|T>>>15),T=A+(v^R&(D^v))+P[7]+4249261313&4294967295,A=R+(T<<22&4294967295|T>>>10),T=v+(D^A&(R^D))+P[8]+1770035416&4294967295,v=A+(T<<7&4294967295|T>>>25),T=D+(R^v&(A^R))+P[9]+2336552879&4294967295,D=v+(T<<12&4294967295|T>>>20),T=R+(A^D&(v^A))+P[10]+4294925233&4294967295,R=D+(T<<17&4294967295|T>>>15),T=A+(v^R&(D^v))+P[11]+2304563134&4294967295,A=R+(T<<22&4294967295|T>>>10),T=v+(D^A&(R^D))+P[12]+1804603682&4294967295,v=A+(T<<7&4294967295|T>>>25),T=D+(R^v&(A^R))+P[13]+4254626195&4294967295,D=v+(T<<12&4294967295|T>>>20),T=R+(A^D&(v^A))+P[14]+2792965006&4294967295,R=D+(T<<17&4294967295|T>>>15),T=A+(v^R&(D^v))+P[15]+1236535329&4294967295,A=R+(T<<22&4294967295|T>>>10),T=v+(R^D&(A^R))+P[1]+4129170786&4294967295,v=A+(T<<5&4294967295|T>>>27),T=D+(A^R&(v^A))+P[6]+3225465664&4294967295,D=v+(T<<9&4294967295|T>>>23),T=R+(v^A&(D^v))+P[11]+643717713&4294967295,R=D+(T<<14&4294967295|T>>>18),T=A+(D^v&(R^D))+P[0]+3921069994&4294967295,A=R+(T<<20&4294967295|T>>>12),T=v+(R^D&(A^R))+P[5]+3593408605&4294967295,v=A+(T<<5&4294967295|T>>>27),T=D+(A^R&(v^A))+P[10]+38016083&4294967295,D=v+(T<<9&4294967295|T>>>23),T=R+(v^A&(D^v))+P[15]+3634488961&4294967295,R=D+(T<<14&4294967295|T>>>18),T=A+(D^v&(R^D))+P[4]+3889429448&4294967295,A=R+(T<<20&4294967295|T>>>12),T=v+(R^D&(A^R))+P[9]+568446438&4294967295,v=A+(T<<5&4294967295|T>>>27),T=D+(A^R&(v^A))+P[14]+3275163606&4294967295,D=v+(T<<9&4294967295|T>>>23),T=R+(v^A&(D^v))+P[3]+4107603335&4294967295,R=D+(T<<14&4294967295|T>>>18),T=A+(D^v&(R^D))+P[8]+1163531501&4294967295,A=R+(T<<20&4294967295|T>>>12),T=v+(R^D&(A^R))+P[13]+2850285829&4294967295,v=A+(T<<5&4294967295|T>>>27),T=D+(A^R&(v^A))+P[2]+4243563512&4294967295,D=v+(T<<9&4294967295|T>>>23),T=R+(v^A&(D^v))+P[7]+1735328473&4294967295,R=D+(T<<14&4294967295|T>>>18),T=A+(D^v&(R^D))+P[12]+2368359562&4294967295,A=R+(T<<20&4294967295|T>>>12),T=v+(A^R^D)+P[5]+4294588738&4294967295,v=A+(T<<4&4294967295|T>>>28),T=D+(v^A^R)+P[8]+2272392833&4294967295,D=v+(T<<11&4294967295|T>>>21),T=R+(D^v^A)+P[11]+1839030562&4294967295,R=D+(T<<16&4294967295|T>>>16),T=A+(R^D^v)+P[14]+4259657740&4294967295,A=R+(T<<23&4294967295|T>>>9),T=v+(A^R^D)+P[1]+2763975236&4294967295,v=A+(T<<4&4294967295|T>>>28),T=D+(v^A^R)+P[4]+1272893353&4294967295,D=v+(T<<11&4294967295|T>>>21),T=R+(D^v^A)+P[7]+4139469664&4294967295,R=D+(T<<16&4294967295|T>>>16),T=A+(R^D^v)+P[10]+3200236656&4294967295,A=R+(T<<23&4294967295|T>>>9),T=v+(A^R^D)+P[13]+681279174&4294967295,v=A+(T<<4&4294967295|T>>>28),T=D+(v^A^R)+P[0]+3936430074&4294967295,D=v+(T<<11&4294967295|T>>>21),T=R+(D^v^A)+P[3]+3572445317&4294967295,R=D+(T<<16&4294967295|T>>>16),T=A+(R^D^v)+P[6]+76029189&4294967295,A=R+(T<<23&4294967295|T>>>9),T=v+(A^R^D)+P[9]+3654602809&4294967295,v=A+(T<<4&4294967295|T>>>28),T=D+(v^A^R)+P[12]+3873151461&4294967295,D=v+(T<<11&4294967295|T>>>21),T=R+(D^v^A)+P[15]+530742520&4294967295,R=D+(T<<16&4294967295|T>>>16),T=A+(R^D^v)+P[2]+3299628645&4294967295,A=R+(T<<23&4294967295|T>>>9),T=v+(R^(A|~D))+P[0]+4096336452&4294967295,v=A+(T<<6&4294967295|T>>>26),T=D+(A^(v|~R))+P[7]+1126891415&4294967295,D=v+(T<<10&4294967295|T>>>22),T=R+(v^(D|~A))+P[14]+2878612391&4294967295,R=D+(T<<15&4294967295|T>>>17),T=A+(D^(R|~v))+P[5]+4237533241&4294967295,A=R+(T<<21&4294967295|T>>>11),T=v+(R^(A|~D))+P[12]+1700485571&4294967295,v=A+(T<<6&4294967295|T>>>26),T=D+(A^(v|~R))+P[3]+2399980690&4294967295,D=v+(T<<10&4294967295|T>>>22),T=R+(v^(D|~A))+P[10]+4293915773&4294967295,R=D+(T<<15&4294967295|T>>>17),T=A+(D^(R|~v))+P[1]+2240044497&4294967295,A=R+(T<<21&4294967295|T>>>11),T=v+(R^(A|~D))+P[8]+1873313359&4294967295,v=A+(T<<6&4294967295|T>>>26),T=D+(A^(v|~R))+P[15]+4264355552&4294967295,D=v+(T<<10&4294967295|T>>>22),T=R+(v^(D|~A))+P[6]+2734768916&4294967295,R=D+(T<<15&4294967295|T>>>17),T=A+(D^(R|~v))+P[13]+1309151649&4294967295,A=R+(T<<21&4294967295|T>>>11),T=v+(R^(A|~D))+P[4]+4149444226&4294967295,v=A+(T<<6&4294967295|T>>>26),T=D+(A^(v|~R))+P[11]+3174756917&4294967295,D=v+(T<<10&4294967295|T>>>22),T=R+(v^(D|~A))+P[2]+718787259&4294967295,R=D+(T<<15&4294967295|T>>>17),T=A+(D^(R|~v))+P[9]+3951481745&4294967295,w.g[0]=w.g[0]+v&4294967295,w.g[1]=w.g[1]+(R+(T<<21&4294967295|T>>>11))&4294967295,w.g[2]=w.g[2]+R&4294967295,w.g[3]=w.g[3]+D&4294967295}s.prototype.v=function(w,v){v===void 0&&(v=w.length);const A=v-this.blockSize,P=this.C;let R=this.h,D=0;for(;D<v;){if(R==0)for(;D<=A;)r(this,w,D),D+=this.blockSize;if(typeof w=="string"){for(;D<v;)if(P[R++]=w.charCodeAt(D++),R==this.blockSize){r(this,P),R=0;break}}else for(;D<v;)if(P[R++]=w[D++],R==this.blockSize){r(this,P),R=0;break}}this.h=R,this.o+=v},s.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var v=1;v<w.length-8;++v)w[v]=0;v=this.o*8;for(var A=w.length-8;A<w.length;++A)w[A]=v&255,v/=256;for(this.v(w),w=Array(16),v=0,A=0;A<4;++A)for(let P=0;P<32;P+=8)w[v++]=this.g[A]>>>P&255;return w};function i(w,v){var A=a;return Object.prototype.hasOwnProperty.call(A,w)?A[w]:A[w]=v(w)}function o(w,v){this.h=v;const A=[];let P=!0;for(let R=w.length-1;R>=0;R--){const D=w[R]|0;P&&D==v||(A[R]=D,P=!1)}this.g=A}var a={};function l(w){return-128<=w&&w<128?i(w,function(v){return new o([v|0],v<0?-1:0)}):new o([w|0],w<0?-1:0)}function u(w){if(isNaN(w)||!isFinite(w))return d;if(w<0)return C(u(-w));const v=[];let A=1;for(let P=0;w>=A;P++)v[P]=w/A|0,A*=4294967296;return new o(v,0)}function h(w,v){if(w.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(w.charAt(0)=="-")return C(h(w.substring(1),v));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const A=u(Math.pow(v,8));let P=d;for(let D=0;D<w.length;D+=8){var R=Math.min(8,w.length-D);const T=parseInt(w.substring(D,D+R),v);R<8?(R=u(Math.pow(v,R)),P=P.j(R).add(u(T))):(P=P.j(A),P=P.add(u(T)))}return P}var d=l(0),p=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(b(this))return-C(this).m();let w=0,v=1;for(let A=0;A<this.g.length;A++){const P=this.i(A);w+=(P>=0?P:4294967296+P)*v,v*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(E(this))return"0";if(b(this))return"-"+C(this).toString(w);const v=u(Math.pow(w,6));var A=this;let P="";for(;;){const R=k(A,v).g;A=F(A,R.j(v));let D=((A.g.length>0?A.g[0]:A.h)>>>0).toString(w);if(A=R,E(A))return D+P;for(;D.length<6;)D="0"+D;P=D+P}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function E(w){if(w.h!=0)return!1;for(let v=0;v<w.g.length;v++)if(w.g[v]!=0)return!1;return!0}function b(w){return w.h==-1}n.l=function(w){return w=F(this,w),b(w)?-1:E(w)?0:1};function C(w){const v=w.g.length,A=[];for(let P=0;P<v;P++)A[P]=~w.g[P];return new o(A,~w.h).add(p)}n.abs=function(){return b(this)?C(this):this},n.add=function(w){const v=Math.max(this.g.length,w.g.length),A=[];let P=0;for(let R=0;R<=v;R++){let D=P+(this.i(R)&65535)+(w.i(R)&65535),T=(D>>>16)+(this.i(R)>>>16)+(w.i(R)>>>16);P=T>>>16,D&=65535,T&=65535,A[R]=T<<16|D}return new o(A,A[A.length-1]&-2147483648?-1:0)};function F(w,v){return w.add(C(v))}n.j=function(w){if(E(this)||E(w))return d;if(b(this))return b(w)?C(this).j(C(w)):C(C(this).j(w));if(b(w))return C(this.j(C(w)));if(this.l(_)<0&&w.l(_)<0)return u(this.m()*w.m());const v=this.g.length+w.g.length,A=[];for(var P=0;P<2*v;P++)A[P]=0;for(P=0;P<this.g.length;P++)for(let R=0;R<w.g.length;R++){const D=this.i(P)>>>16,T=this.i(P)&65535,nt=w.i(R)>>>16,Lt=w.i(R)&65535;A[2*P+2*R]+=T*Lt,U(A,2*P+2*R),A[2*P+2*R+1]+=D*Lt,U(A,2*P+2*R+1),A[2*P+2*R+1]+=T*nt,U(A,2*P+2*R+1),A[2*P+2*R+2]+=D*nt,U(A,2*P+2*R+2)}for(w=0;w<v;w++)A[w]=A[2*w+1]<<16|A[2*w];for(w=v;w<2*v;w++)A[w]=0;return new o(A,0)};function U(w,v){for(;(w[v]&65535)!=w[v];)w[v+1]+=w[v]>>>16,w[v]&=65535,v++}function N(w,v){this.g=w,this.h=v}function k(w,v){if(E(v))throw Error("division by zero");if(E(w))return new N(d,d);if(b(w))return v=k(C(w),v),new N(C(v.g),C(v.h));if(b(v))return v=k(w,C(v)),new N(C(v.g),v.h);if(w.g.length>30){if(b(w)||b(v))throw Error("slowDivide_ only works with positive integers.");for(var A=p,P=v;P.l(w)<=0;)A=G(A),P=G(P);var R=J(A,1),D=J(P,1);for(P=J(P,2),A=J(A,2);!E(P);){var T=D.add(P);T.l(w)<=0&&(R=R.add(A),D=T),P=J(P,1),A=J(A,1)}return v=F(w,R.j(v)),new N(R,v)}for(R=d;w.l(v)>=0;){for(A=Math.max(1,Math.floor(w.m()/v.m())),P=Math.ceil(Math.log(A)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),D=u(A),T=D.j(v);b(T)||T.l(w)>0;)A-=P,D=u(A),T=D.j(v);E(D)&&(D=p),R=R.add(D),w=F(w,T)}return new N(R,w)}n.B=function(w){return k(this,w).h},n.and=function(w){const v=Math.max(this.g.length,w.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)&w.i(P);return new o(A,this.h&w.h)},n.or=function(w){const v=Math.max(this.g.length,w.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)|w.i(P);return new o(A,this.h|w.h)},n.xor=function(w){const v=Math.max(this.g.length,w.g.length),A=[];for(let P=0;P<v;P++)A[P]=this.i(P)^w.i(P);return new o(A,this.h^w.h)};function G(w){const v=w.g.length+1,A=[];for(let P=0;P<v;P++)A[P]=w.i(P)<<1|w.i(P-1)>>>31;return new o(A,w.h)}function J(w,v){const A=v>>5;v%=32;const P=w.g.length-A,R=[];for(let D=0;D<P;D++)R[D]=v>0?w.i(D+A)>>>v|w.i(D+A+1)<<32-v:w.i(D+A);return new o(R,w.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,mA=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Fr=o}).apply(typeof sE<"u"?sE:typeof self<"u"?self:typeof window<"u"?window:{});var pu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var _A,El,gA,Ou,vp,yA,vA,EA;(function(){var n,e=Object.defineProperty;function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof pu=="object"&&pu];for(var f=0;f<c.length;++f){var m=c[f];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var s=t(this);function r(c,f){if(f)e:{var m=s;c=c.split(".");for(var y=0;y<c.length-1;y++){var O=c[y];if(!(O in m))break e;m=m[O]}c=c[c.length-1],y=m[c],f=f(y),f!=y&&f!=null&&e(m,c,{configurable:!0,writable:!0,value:f})}}r("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(c){return c||function(f){var m=[],y;for(y in f)Object.prototype.hasOwnProperty.call(f,y)&&m.push([y,f[y]]);return m}});var i=i||{},o=this||self;function a(c){var f=typeof c;return f=="object"&&c!=null||f=="function"}function l(c,f,m){return c.call.apply(c.bind,arguments)}function u(c,f,m){return u=l,u.apply(null,arguments)}function h(c,f){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function d(c,f){function m(){}m.prototype=f.prototype,c.Z=f.prototype,c.prototype=new m,c.prototype.constructor=c,c.Ob=function(y,O,L){for(var te=Array(arguments.length-2),Re=2;Re<arguments.length;Re++)te[Re-2]=arguments[Re];return f.prototype[O].apply(y,te)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function _(c){const f=c.length;if(f>0){const m=Array(f);for(let y=0;y<f;y++)m[y]=c[y];return m}return[]}function E(c,f){for(let y=1;y<arguments.length;y++){const O=arguments[y];var m=typeof O;if(m=m!="object"?m:O?Array.isArray(O)?"array":m:"null",m=="array"||m=="object"&&typeof O.length=="number"){m=c.length||0;const L=O.length||0;c.length=m+L;for(let te=0;te<L;te++)c[m+te]=O[te]}else c.push(O)}}class b{constructor(f,m){this.i=f,this.j=m,this.h=0,this.g=null}get(){let f;return this.h>0?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function C(c){o.setTimeout(()=>{throw c},0)}function F(){var c=w;let f=null;return c.g&&(f=c.g,c.g=c.g.next,c.g||(c.h=null),f.next=null),f}class U{constructor(){this.h=this.g=null}add(f,m){const y=N.get();y.set(f,m),this.h?this.h.next=y:this.g=y,this.h=y}}var N=new b(()=>new k,c=>c.reset());class k{constructor(){this.next=this.g=this.h=null}set(f,m){this.h=f,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let G,J=!1,w=new U,v=()=>{const c=Promise.resolve(void 0);G=()=>{c.then(A)}};function A(){for(var c;c=F();){try{c.h.call(c.g)}catch(m){C(m)}var f=N;f.j(c),f.h<100&&(f.h++,c.next=f.g,f.g=c)}J=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(c,f){this.type=c,this.g=this.target=f,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var D=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,f=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};o.addEventListener("test",m,f),o.removeEventListener("test",m,f)}catch{}return c})();function T(c){return/^[\s\xa0]*$/.test(c)}function nt(c,f){R.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,f)}d(nt,R),nt.prototype.init=function(c,f){const m=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=f,f=c.relatedTarget,f||(m=="mouseover"?f=c.fromElement:m=="mouseout"&&(f=c.toElement)),this.relatedTarget=f,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&nt.Z.h.call(this)},nt.prototype.h=function(){nt.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Lt="closure_listenable_"+(Math.random()*1e6|0),at=0;function Oe(c,f,m,y,O){this.listener=c,this.proxy=null,this.src=f,this.type=m,this.capture=!!y,this.ha=O,this.key=++at,this.da=this.fa=!1}function ne(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function se(c,f,m){for(const y in c)f.call(m,c[y],y,c)}function ht(c,f){for(const m in c)f.call(void 0,c[m],m,c)}function pn(c){const f={};for(const m in c)f[m]=c[m];return f}const kt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(c,f){let m,y;for(let O=1;O<arguments.length;O++){y=arguments[O];for(m in y)c[m]=y[m];for(let L=0;L<kt.length;L++)m=kt[L],Object.prototype.hasOwnProperty.call(y,m)&&(c[m]=y[m])}}function re(c){this.src=c,this.g={},this.h=0}re.prototype.add=function(c,f,m,y,O){const L=c.toString();c=this.g[L],c||(c=this.g[L]=[],this.h++);const te=Xe(c,f,y,O);return te>-1?(f=c[te],m||(f.fa=!1)):(f=new Oe(f,this.src,L,!!y,O),f.fa=m,c.push(f)),f};function le(c,f){const m=f.type;if(m in c.g){var y=c.g[m],O=Array.prototype.indexOf.call(y,f,void 0),L;(L=O>=0)&&Array.prototype.splice.call(y,O,1),L&&(ne(f),c.g[m].length==0&&(delete c.g[m],c.h--))}}function Xe(c,f,m,y){for(let O=0;O<c.length;++O){const L=c[O];if(!L.da&&L.listener==f&&L.capture==!!m&&L.ha==y)return O}return-1}var j="closure_lm_"+(Math.random()*1e6|0),fe={};function ae(c,f,m,y,O){if(Array.isArray(f)){for(let L=0;L<f.length;L++)ae(c,f[L],m,y,O);return null}return m=ie(m),c&&c[Lt]?c.J(f,m,a(y)?!!y.capture:!1,O):_e(c,f,m,!1,y,O)}function _e(c,f,m,y,O,L){if(!f)throw Error("Invalid event type");const te=a(O)?!!O.capture:!!O;let Re=K(c);if(Re||(c[j]=Re=new re(c)),m=Re.add(f,m,y,te,L),m.proxy)return m;if(y=De(),m.proxy=y,y.src=c,y.listener=m,c.addEventListener)D||(O=te),O===void 0&&(O=!1),c.addEventListener(f.toString(),y,O);else if(c.attachEvent)c.attachEvent(V(f.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function De(){function c(m){return f.call(c.src,c.listener,m)}const f=$;return c}function I(c,f,m,y,O){if(Array.isArray(f))for(var L=0;L<f.length;L++)I(c,f[L],m,y,O);else y=a(y)?!!y.capture:!!y,m=ie(m),c&&c[Lt]?(c=c.i,L=String(f).toString(),L in c.g&&(f=c.g[L],m=Xe(f,m,y,O),m>-1&&(ne(f[m]),Array.prototype.splice.call(f,m,1),f.length==0&&(delete c.g[L],c.h--)))):c&&(c=K(c))&&(f=c.g[f.toString()],c=-1,f&&(c=Xe(f,m,y,O)),(m=c>-1?f[c]:null)&&S(m))}function S(c){if(typeof c!="number"&&c&&!c.da){var f=c.src;if(f&&f[Lt])le(f.i,c);else{var m=c.type,y=c.proxy;f.removeEventListener?f.removeEventListener(m,y,c.capture):f.detachEvent?f.detachEvent(V(m),y):f.addListener&&f.removeListener&&f.removeListener(y),(m=K(f))?(le(m,c),m.h==0&&(m.src=null,f[j]=null)):ne(c)}}}function V(c){return c in fe?fe[c]:fe[c]="on"+c}function $(c,f){if(c.da)c=!0;else{f=new nt(f,this);const m=c.listener,y=c.ha||c.src;c.fa&&S(c),c=m.call(y,f)}return c}function K(c){return c=c[j],c instanceof re?c:null}var q="__closure_events_fn_"+(Math.random()*1e9>>>0);function ie(c){return typeof c=="function"?c:(c[q]||(c[q]=function(f){return c.handleEvent(f)}),c[q])}function Q(){P.call(this),this.i=new re(this),this.M=this,this.G=null}d(Q,P),Q.prototype[Lt]=!0,Q.prototype.removeEventListener=function(c,f,m,y){I(this,c,f,m,y)};function H(c,f){var m,y=c.G;if(y)for(m=[];y;y=y.G)m.push(y);if(c=c.M,y=f.type||f,typeof f=="string")f=new R(f,c);else if(f instanceof R)f.target=f.target||c;else{var O=f;f=new R(y,c),ue(f,O)}O=!0;let L,te;if(m)for(te=m.length-1;te>=0;te--)L=f.g=m[te],O=z(L,y,!0,f)&&O;if(L=f.g=c,O=z(L,y,!0,f)&&O,O=z(L,y,!1,f)&&O,m)for(te=0;te<m.length;te++)L=f.g=m[te],O=z(L,y,!1,f)&&O}Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var c=this.i;for(const f in c.g){const m=c.g[f];for(let y=0;y<m.length;y++)ne(m[y]);delete c.g[f],c.h--}}this.G=null},Q.prototype.J=function(c,f,m,y){return this.i.add(String(c),f,!1,m,y)},Q.prototype.K=function(c,f,m,y){return this.i.add(String(c),f,!0,m,y)};function z(c,f,m,y){if(f=c.i.g[String(f)],!f)return!0;f=f.concat();let O=!0;for(let L=0;L<f.length;++L){const te=f[L];if(te&&!te.da&&te.capture==m){const Re=te.listener,Dt=te.ha||te.src;te.fa&&le(c.i,te),O=Re.call(Dt,y)!==!1&&O}}return O&&!y.defaultPrevented}function ve(c,f){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(f)>2147483647?-1:o.setTimeout(c,f||0)}function ce(c){c.g=ve(()=>{c.g=null,c.i&&(c.i=!1,ce(c))},c.l);const f=c.h;c.h=null,c.m.apply(null,f)}class ge extends P{constructor(f,m){super(),this.m=f,this.l=m,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:ce(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ee(c){P.call(this),this.h=c,this.g={}}d(Ee,P);var Ne=[];function He(c){se(c.g,function(f,m){this.g.hasOwnProperty(m)&&S(f)},c),c.g={}}Ee.prototype.N=function(){Ee.Z.N.call(this),He(this)},Ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ue=o.JSON.stringify,Xt=o.JSON.parse,Zt=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function Cn(){}function Pn(){}var Kn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function uo(){R.call(this,"d")}d(uo,R);function Kt(){R.call(this,"c")}d(Kt,R);var Ft={},qa=null;function ai(){return qa=qa||new Q}Ft.Ia="serverreachability";function Rg(c){R.call(this,Ft.Ia,c)}d(Rg,R);function ja(c){const f=ai();H(f,new Rg(f))}Ft.STAT_EVENT="statevent";function Cg(c,f){R.call(this,Ft.STAT_EVENT,c),this.stat=f}d(Cg,R);function mn(c){const f=ai();H(f,new Cg(f,c))}Ft.Ja="timingevent";function Pg(c,f){R.call(this,Ft.Ja,c),this.size=f}d(Pg,R);function Ga(c,f){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},f)}function Ka(){this.g=!0}Ka.prototype.ua=function(){this.g=!1};function nP(c,f,m,y,O,L){c.info(function(){if(c.g)if(L){var te="",Re=L.split("&");for(let st=0;st<Re.length;st++){var Dt=Re[st].split("=");if(Dt.length>1){const Ut=Dt[0];Dt=Dt[1];const us=Ut.split("_");te=us.length>=2&&us[1]=="type"?te+(Ut+"="+Dt+"&"):te+(Ut+"=redacted&")}}}else te=null;else te=L;return"XMLHTTP REQ ("+y+") [attempt "+O+"]: "+f+`
`+m+`
`+te})}function sP(c,f,m,y,O,L,te){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+O+"]: "+f+`
`+m+`
`+L+" "+te})}function ho(c,f,m,y){c.info(function(){return"XMLHTTP TEXT ("+f+"): "+iP(c,m)+(y?" "+y:"")})}function rP(c,f){c.info(function(){return"TIMEOUT: "+f})}Ka.prototype.info=function(){};function iP(c,f){if(!c.g)return f;if(!f)return null;try{const L=JSON.parse(f);if(L){for(c=0;c<L.length;c++)if(Array.isArray(L[c])){var m=L[c];if(!(m.length<2)){var y=m[1];if(Array.isArray(y)&&!(y.length<1)){var O=y[0];if(O!="noop"&&O!="stop"&&O!="close")for(let te=1;te<y.length;te++)y[te]=""}}}}return Ue(L)}catch{return f}}var Xc={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ng={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},kg;function $d(){}d($d,Cn),$d.prototype.g=function(){return new XMLHttpRequest},kg=new $d;function Wa(c){return encodeURIComponent(String(c))}function oP(c){var f=1;c=c.split(":");const m=[];for(;f>0&&c.length;)m.push(c.shift()),f--;return c.length&&m.push(c.join(":")),m}function or(c,f,m,y){this.j=c,this.i=f,this.l=m,this.S=y||1,this.V=new Ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Dg}function Dg(){this.i=null,this.g="",this.h=!1}var xg={},qd={};function jd(c,f,m){c.M=1,c.A=eu(cs(f)),c.u=m,c.R=!0,Vg(c,null)}function Vg(c,f){c.F=Date.now(),Zc(c),c.B=cs(c.A);var m=c.B,y=c.S;Array.isArray(y)||(y=[String(y)]),zg(m.i,"t",y),c.C=0,m=c.j.L,c.h=new Dg,c.g=hy(c.j,m?f:null,!c.u),c.P>0&&(c.O=new ge(u(c.Y,c,c.g),c.P)),f=c.V,m=c.g,y=c.ba;var O="readystatechange";Array.isArray(O)||(O&&(Ne[0]=O.toString()),O=Ne);for(let L=0;L<O.length;L++){const te=ae(m,O[L],y||f.handleEvent,!1,f.h||f);if(!te)break;f.g[te.key]=te}f=c.J?pn(c.J):{},c.u?(c.v||(c.v="POST"),f["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,f)):(c.v="GET",c.g.ea(c.B,c.v,null,f)),ja(),nP(c.i,c.v,c.B,c.l,c.S,c.u)}or.prototype.ba=function(c){c=c.target;const f=this.O;f&&cr(c)==3?f.j():this.Y(c)},or.prototype.Y=function(c){try{if(c==this.g)e:{const Re=cr(this.g),Dt=this.g.ya(),st=this.g.ca();if(!(Re<3)&&(Re!=3||this.g&&(this.h.h||this.g.la()||ey(this.g)))){this.K||Re!=4||Dt==7||(Dt==8||st<=0?ja(3):ja(2)),Gd(this);var f=this.g.ca();this.X=f;var m=aP(this);if(this.o=f==200,sP(this.i,this.v,this.B,this.l,this.S,Re,f),this.o){if(this.U&&!this.L){t:{if(this.g){var y,O=this.g;if((y=O.g?O.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(y)){var L=y;break t}}L=null}if(c=L)ho(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Kd(this,c);else{this.o=!1,this.m=3,mn(12),li(this),za(this);break e}}if(this.R){c=!0;let Ut;for(;!this.K&&this.C<m.length;)if(Ut=lP(this,m),Ut==qd){Re==4&&(this.m=4,mn(14),c=!1),ho(this.i,this.l,null,"[Incomplete Response]");break}else if(Ut==xg){this.m=4,mn(15),ho(this.i,this.l,m,"[Invalid Chunk]"),c=!1;break}else ho(this.i,this.l,Ut,null),Kd(this,Ut);if(Og(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Re!=4||m.length!=0||this.h.h||(this.m=1,mn(16),c=!1),this.o=this.o&&c,!c)ho(this.i,this.l,m,"[Invalid Chunked Response]"),li(this),za(this);else if(m.length>0&&!this.W){this.W=!0;var te=this.j;te.g==this&&te.aa&&!te.P&&(te.j.info("Great, no buffering proxy detected. Bytes received: "+m.length),Zd(te),te.P=!0,mn(11))}}else ho(this.i,this.l,m,null),Kd(this,m);Re==4&&li(this),this.o&&!this.K&&(Re==4?ay(this.j,this):(this.o=!1,Zc(this)))}else TP(this.g),f==400&&m.indexOf("Unknown SID")>0?(this.m=3,mn(12)):(this.m=0,mn(13)),li(this),za(this)}}}catch{}};function aP(c){if(!Og(c))return c.g.la();const f=ey(c.g);if(f==="")return"";let m="";const y=f.length,O=cr(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return li(c),za(c),"";c.h.i=new o.TextDecoder}for(let L=0;L<y;L++)c.h.h=!0,m+=c.h.i.decode(f[L],{stream:!(O&&L==y-1)});return f.length=0,c.h.g+=m,c.C=0,c.h.g}function Og(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function lP(c,f){var m=c.C,y=f.indexOf(`
`,m);return y==-1?qd:(m=Number(f.substring(m,y)),isNaN(m)?xg:(y+=1,y+m>f.length?qd:(f=f.slice(y,y+m),c.C=y+m,f)))}or.prototype.cancel=function(){this.K=!0,li(this)};function Zc(c){c.T=Date.now()+c.H,Mg(c,c.H)}function Mg(c,f){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Ga(u(c.aa,c),f)}function Gd(c){c.D&&(o.clearTimeout(c.D),c.D=null)}or.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(rP(this.i,this.B),this.M!=2&&(ja(),mn(17)),li(this),this.m=2,za(this)):Mg(this,this.T-c)};function za(c){c.j.I==0||c.K||ay(c.j,c)}function li(c){Gd(c);var f=c.O;f&&typeof f.dispose=="function"&&f.dispose(),c.O=null,He(c.V),c.g&&(f=c.g,c.g=null,f.abort(),f.dispose())}function Kd(c,f){try{var m=c.j;if(m.I!=0&&(m.g==c||Wd(m.h,c))){if(!c.L&&Wd(m.h,c)&&m.I==3){try{var y=m.Ba.g.parse(f)}catch{y=null}if(Array.isArray(y)&&y.length==3){var O=y;if(O[0]==0){e:if(!m.v){if(m.g)if(m.g.F+3e3<c.F)iu(m),su(m);else break e;Xd(m),mn(18)}}else m.xa=O[1],0<m.xa-m.K&&O[2]<37500&&m.F&&m.A==0&&!m.C&&(m.C=Ga(u(m.Va,m),6e3));Ug(m.h)<=1&&m.ta&&(m.ta=void 0)}else ui(m,11)}else if((c.L||m.g==c)&&iu(m),!T(f))for(O=m.Ba.g.parse(f),f=0;f<O.length;f++){let st=O[f];const Ut=st[0];if(!(Ut<=m.K))if(m.K=Ut,st=st[1],m.I==2)if(st[0]=="c"){m.M=st[1],m.ba=st[2];const us=st[3];us!=null&&(m.ka=us,m.j.info("VER="+m.ka));const hi=st[4];hi!=null&&(m.za=hi,m.j.info("SVER="+m.za));const ur=st[5];ur!=null&&typeof ur=="number"&&ur>0&&(y=1.5*ur,m.O=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const hr=c.g;if(hr){const au=hr.g?hr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(au){var L=y.h;L.g||au.indexOf("spdy")==-1&&au.indexOf("quic")==-1&&au.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(zd(L,L.h),L.h=null))}if(y.G){const ef=hr.g?hr.g.getResponseHeader("X-HTTP-Session-Id"):null;ef&&(y.wa=ef,dt(y.J,y.G,ef))}}m.I=3,m.l&&m.l.ra(),m.aa&&(m.T=Date.now()-c.F,m.j.info("Handshake RTT: "+m.T+"ms")),y=m;var te=c;if(y.na=uy(y,y.L?y.ba:null,y.W),te.L){Bg(y.h,te);var Re=te,Dt=y.O;Dt&&(Re.H=Dt),Re.D&&(Gd(Re),Zc(Re)),y.g=te}else iy(y);m.i.length>0&&ru(m)}else st[0]!="stop"&&st[0]!="close"||ui(m,7);else m.I==3&&(st[0]=="stop"||st[0]=="close"?st[0]=="stop"?ui(m,7):Jd(m):st[0]!="noop"&&m.l&&m.l.qa(st),m.A=0)}}ja(4)}catch{}}var cP=class{constructor(c,f){this.g=c,this.map=f}};function Lg(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Fg(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ug(c){return c.h?1:c.g?c.g.size:0}function Wd(c,f){return c.h?c.h==f:c.g?c.g.has(f):!1}function zd(c,f){c.g?c.g.add(f):c.h=f}function Bg(c,f){c.h&&c.h==f?c.h=null:c.g&&c.g.has(f)&&c.g.delete(f)}Lg.prototype.cancel=function(){if(this.i=$g(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function $g(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let f=c.i;for(const m of c.g.values())f=f.concat(m.G);return f}return _(c.i)}var qg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function uP(c,f){if(c){c=c.split("&");for(let m=0;m<c.length;m++){const y=c[m].indexOf("=");let O,L=null;y>=0?(O=c[m].substring(0,y),L=c[m].substring(y+1)):O=c[m],f(O,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function ar(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let f;c instanceof ar?(this.l=c.l,Ha(this,c.j),this.o=c.o,this.g=c.g,Qa(this,c.u),this.h=c.h,Hd(this,Hg(c.i)),this.m=c.m):c&&(f=String(c).match(qg))?(this.l=!1,Ha(this,f[1]||"",!0),this.o=Ya(f[2]||""),this.g=Ya(f[3]||"",!0),Qa(this,f[4]),this.h=Ya(f[5]||"",!0),Hd(this,f[6]||"",!0),this.m=Ya(f[7]||"")):(this.l=!1,this.i=new Xa(null,this.l))}ar.prototype.toString=function(){const c=[];var f=this.j;f&&c.push(Ja(f,jg,!0),":");var m=this.g;return(m||f=="file")&&(c.push("//"),(f=this.o)&&c.push(Ja(f,jg,!0),"@"),c.push(Wa(m).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.u,m!=null&&c.push(":",String(m))),(m=this.h)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(Ja(m,m.charAt(0)=="/"?fP:dP,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",Ja(m,mP)),c.join("")},ar.prototype.resolve=function(c){const f=cs(this);let m=!!c.j;m?Ha(f,c.j):m=!!c.o,m?f.o=c.o:m=!!c.g,m?f.g=c.g:m=c.u!=null;var y=c.h;if(m)Qa(f,c.u);else if(m=!!c.h){if(y.charAt(0)!="/")if(this.g&&!this.h)y="/"+y;else{var O=f.h.lastIndexOf("/");O!=-1&&(y=f.h.slice(0,O+1)+y)}if(O=y,O==".."||O==".")y="";else if(O.indexOf("./")!=-1||O.indexOf("/.")!=-1){y=O.lastIndexOf("/",0)==0,O=O.split("/");const L=[];for(let te=0;te<O.length;){const Re=O[te++];Re=="."?y&&te==O.length&&L.push(""):Re==".."?((L.length>1||L.length==1&&L[0]!="")&&L.pop(),y&&te==O.length&&L.push("")):(L.push(Re),y=!0)}y=L.join("/")}else y=O}return m?f.h=y:m=c.i.toString()!=="",m?Hd(f,Hg(c.i)):m=!!c.m,m&&(f.m=c.m),f};function cs(c){return new ar(c)}function Ha(c,f,m){c.j=m?Ya(f,!0):f,c.j&&(c.j=c.j.replace(/:$/,""))}function Qa(c,f){if(f){if(f=Number(f),isNaN(f)||f<0)throw Error("Bad port number "+f);c.u=f}else c.u=null}function Hd(c,f,m){f instanceof Xa?(c.i=f,_P(c.i,c.l)):(m||(f=Ja(f,pP)),c.i=new Xa(f,c.l))}function dt(c,f,m){c.i.set(f,m)}function eu(c){return dt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function Ya(c,f){return c?f?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Ja(c,f,m){return typeof c=="string"?(c=encodeURI(c).replace(f,hP),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function hP(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var jg=/[#\/\?@]/g,dP=/[#\?:]/g,fP=/[#\?]/g,pP=/[#\?@]/g,mP=/#/g;function Xa(c,f){this.h=this.g=null,this.i=c||null,this.j=!!f}function ci(c){c.g||(c.g=new Map,c.h=0,c.i&&uP(c.i,function(f,m){c.add(decodeURIComponent(f.replace(/\+/g," ")),m)}))}n=Xa.prototype,n.add=function(c,f){ci(this),this.i=null,c=fo(this,c);let m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(f),this.h+=1,this};function Gg(c,f){ci(c),f=fo(c,f),c.g.has(f)&&(c.i=null,c.h-=c.g.get(f).length,c.g.delete(f))}function Kg(c,f){return ci(c),f=fo(c,f),c.g.has(f)}n.forEach=function(c,f){ci(this),this.g.forEach(function(m,y){m.forEach(function(O){c.call(f,O,y,this)},this)},this)};function Wg(c,f){ci(c);let m=[];if(typeof f=="string")Kg(c,f)&&(m=m.concat(c.g.get(fo(c,f))));else for(c=Array.from(c.g.values()),f=0;f<c.length;f++)m=m.concat(c[f]);return m}n.set=function(c,f){return ci(this),this.i=null,c=fo(this,c),Kg(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[f]),this.h+=1,this},n.get=function(c,f){return c?(c=Wg(this,c),c.length>0?String(c[0]):f):f};function zg(c,f,m){Gg(c,f),m.length>0&&(c.i=null,c.g.set(fo(c,f),_(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],f=Array.from(this.g.keys());for(let y=0;y<f.length;y++){var m=f[y];const O=Wa(m);m=Wg(this,m);for(let L=0;L<m.length;L++){let te=O;m[L]!==""&&(te+="="+Wa(m[L])),c.push(te)}}return this.i=c.join("&")};function Hg(c){const f=new Xa;return f.i=c.i,c.g&&(f.g=new Map(c.g),f.h=c.h),f}function fo(c,f){return f=String(f),c.j&&(f=f.toLowerCase()),f}function _P(c,f){f&&!c.j&&(ci(c),c.i=null,c.g.forEach(function(m,y){const O=y.toLowerCase();y!=O&&(Gg(this,y),zg(this,O,m))},c)),c.j=f}function gP(c,f){const m=new Ka;if(o.Image){const y=new Image;y.onload=h(lr,m,"TestLoadImage: loaded",!0,f,y),y.onerror=h(lr,m,"TestLoadImage: error",!1,f,y),y.onabort=h(lr,m,"TestLoadImage: abort",!1,f,y),y.ontimeout=h(lr,m,"TestLoadImage: timeout",!1,f,y),o.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else f(!1)}function yP(c,f){const m=new Ka,y=new AbortController,O=setTimeout(()=>{y.abort(),lr(m,"TestPingServer: timeout",!1,f)},1e4);fetch(c,{signal:y.signal}).then(L=>{clearTimeout(O),L.ok?lr(m,"TestPingServer: ok",!0,f):lr(m,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(O),lr(m,"TestPingServer: error",!1,f)})}function lr(c,f,m,y,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),y(m)}catch{}}function vP(){this.g=new Zt}function Qd(c){this.i=c.Sb||null,this.h=c.ab||!1}d(Qd,Cn),Qd.prototype.g=function(){return new tu(this.i,this.h)};function tu(c,f){Q.call(this),this.H=c,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(tu,Q),n=tu.prototype,n.open=function(c,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=f,this.readyState=1,el(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const f={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(f.body=c),(this.H||o).fetch(new Request(this.D,f)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Za(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,el(this)),this.g&&(this.readyState=3,el(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Qg(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Qg(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var f=c.value?c.value:new Uint8Array(0);(f=this.B.decode(f,{stream:!c.done}))&&(this.response=this.responseText+=f)}c.done?Za(this):el(this),this.readyState==3&&Qg(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,Za(this))},n.Na=function(c){this.g&&(this.response=c,Za(this))},n.ga=function(){this.g&&Za(this)};function Za(c){c.readyState=4,c.l=null,c.j=null,c.B=null,el(c)}n.setRequestHeader=function(c,f){this.A.append(c,f)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],f=this.h.entries();for(var m=f.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=f.next();return c.join(`\r
`)};function el(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(tu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Yg(c){let f="";return se(c,function(m,y){f+=y,f+=":",f+=m,f+=`\r
`}),f}function Yd(c,f,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=Yg(m),typeof c=="string"?m!=null&&Wa(m):dt(c,f,m))}function Tt(c){Q.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(Tt,Q);var EP=/^https?$/i,IP=["POST","PUT"];n=Tt.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,f,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);f=f?f.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():kg.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(f,String(c),!0),this.B=!1}catch(L){Jg(this,L);return}if(c=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var O in y)m.set(O,y[O]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const L of y.keys())m.set(L,y.get(L));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(L=>L.toLowerCase()=="content-type"),O=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(IP,f,void 0)>=0)||y||O||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,te]of m)this.g.setRequestHeader(L,te);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(L){Jg(this,L)}};function Jg(c,f){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=f,c.o=5,Xg(c),nu(c)}function Xg(c){c.A||(c.A=!0,H(c,"complete"),H(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,H(this,"complete"),H(this,"abort"),nu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nu(this,!0)),Tt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Zg(this):this.Xa())},n.Xa=function(){Zg(this)};function Zg(c){if(c.h&&typeof i<"u"){if(c.v&&cr(c)==4)setTimeout(c.Ca.bind(c),0);else if(H(c,"readystatechange"),cr(c)==4){c.h=!1;try{const L=c.ca();e:switch(L){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var m;if(!(m=f)){var y;if(y=L===0){let te=String(c.D).match(qg)[1]||null;!te&&o.self&&o.self.location&&(te=o.self.location.protocol.slice(0,-1)),y=!EP.test(te?te.toLowerCase():"")}m=y}if(m)H(c,"complete"),H(c,"success");else{c.o=6;try{var O=cr(c)>2?c.g.statusText:""}catch{O=""}c.l=O+" ["+c.ca()+"]",Xg(c)}}finally{nu(c)}}}}function nu(c,f){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const m=c.g;c.g=null,f||H(c,"ready");try{m.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function cr(c){return c.g?c.g.readyState:0}n.ca=function(){try{return cr(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var f=this.g.responseText;return c&&f.indexOf(c)==0&&(f=f.substring(c.length)),Xt(f)}};function ey(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function TP(c){const f={};c=(c.g&&cr(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(T(c[y]))continue;var m=oP(c[y]);const O=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const L=f[O]||[];f[O]=L,L.push(m)}ht(f,function(y){return y.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function tl(c,f,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||f}function ty(c){this.za=0,this.i=[],this.j=new Ka,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tl("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tl("baseRetryDelayMs",5e3,c),this.Za=tl("retryDelaySeedMs",1e4,c),this.Ta=tl("forwardChannelMaxRetries",2,c),this.va=tl("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new Lg(c&&c.concurrentRequestLimit),this.Ba=new vP,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=ty.prototype,n.ka=8,n.I=1,n.connect=function(c,f,m,y){mn(0),this.W=c,this.H=f||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.J=uy(this,null,this.W),ru(this)};function Jd(c){if(ny(c),c.I==3){var f=c.V++,m=cs(c.J);if(dt(m,"SID",c.M),dt(m,"RID",f),dt(m,"TYPE","terminate"),nl(c,m),f=new or(c,c.j,f),f.M=2,f.A=eu(cs(m)),m=!1,o.navigator&&o.navigator.sendBeacon)try{m=o.navigator.sendBeacon(f.A.toString(),"")}catch{}!m&&o.Image&&(new Image().src=f.A,m=!0),m||(f.g=hy(f.j,null),f.g.ea(f.A)),f.F=Date.now(),Zc(f)}cy(c)}function su(c){c.g&&(Zd(c),c.g.cancel(),c.g=null)}function ny(c){su(c),c.v&&(o.clearTimeout(c.v),c.v=null),iu(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function ru(c){if(!Fg(c.h)&&!c.m){c.m=!0;var f=c.Ea;G||v(),J||(G(),J=!0),w.add(f,c),c.D=0}}function wP(c,f){return Ug(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=f.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Ga(u(c.Ea,c,f),ly(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const O=new or(this,this.j,c);let L=this.o;if(this.U&&(L?(L=pn(L),ue(L,this.U)):L=this.U),this.u!==null||this.R||(O.J=L,L=null),this.S)e:{for(var f=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(f+=y,f>4096){f=m;break e}if(f===4096||m===this.i.length-1){f=m+1;break e}}f=1e3}else f=1e3;f=ry(this,O,f),m=cs(this.J),dt(m,"RID",c),dt(m,"CVER",22),this.G&&dt(m,"X-HTTP-Session-Id",this.G),nl(this,m),L&&(this.R?f="headers="+Wa(Yg(L))+"&"+f:this.u&&Yd(m,this.u,L)),zd(this.h,O),this.Ra&&dt(m,"TYPE","init"),this.S?(dt(m,"$req",f),dt(m,"SID","null"),O.U=!0,jd(O,m,null)):jd(O,m,f),this.I=2}}else this.I==3&&(c?sy(this,c):this.i.length==0||Fg(this.h)||sy(this))};function sy(c,f){var m;f?m=f.l:m=c.V++;const y=cs(c.J);dt(y,"SID",c.M),dt(y,"RID",m),dt(y,"AID",c.K),nl(c,y),c.u&&c.o&&Yd(y,c.u,c.o),m=new or(c,c.j,m,c.D+1),c.u===null&&(m.J=c.o),f&&(c.i=f.G.concat(c.i)),f=ry(c,m,1e3),m.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),zd(c.h,m),jd(m,y,f)}function nl(c,f){c.H&&se(c.H,function(m,y){dt(f,y,m)}),c.l&&se({},function(m,y){dt(f,y,m)})}function ry(c,f,m){m=Math.min(c.i.length,m);const y=c.l?u(c.l.Ka,c.l,c):null;e:{var O=c.i;let Re=-1;for(;;){const Dt=["count="+m];Re==-1?m>0?(Re=O[0].g,Dt.push("ofs="+Re)):Re=0:Dt.push("ofs="+Re);let st=!0;for(let Ut=0;Ut<m;Ut++){var L=O[Ut].g;const us=O[Ut].map;if(L-=Re,L<0)Re=Math.max(0,O[Ut].g-100),st=!1;else try{L="req"+L+"_"||"";try{var te=us instanceof Map?us:Object.entries(us);for(const[hi,ur]of te){let hr=ur;a(ur)&&(hr=Ue(ur)),Dt.push(L+hi+"="+encodeURIComponent(hr))}}catch(hi){throw Dt.push(L+"type="+encodeURIComponent("_badmap")),hi}}catch{y&&y(us)}}if(st){te=Dt.join("&");break e}}te=void 0}return c=c.i.splice(0,m),f.G=c,te}function iy(c){if(!c.g&&!c.v){c.Y=1;var f=c.Da;G||v(),J||(G(),J=!0),w.add(f,c),c.A=0}}function Xd(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Ga(u(c.Da,c),ly(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,oy(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Ga(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,mn(10),su(this),oy(this))};function Zd(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function oy(c){c.g=new or(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var f=cs(c.na);dt(f,"RID","rpc"),dt(f,"SID",c.M),dt(f,"AID",c.K),dt(f,"CI",c.F?"0":"1"),!c.F&&c.ia&&dt(f,"TO",c.ia),dt(f,"TYPE","xmlhttp"),nl(c,f),c.u&&c.o&&Yd(f,c.u,c.o),c.O&&(c.g.H=c.O);var m=c.g;c=c.ba,m.M=1,m.A=eu(cs(f)),m.u=null,m.R=!0,Vg(m,c)}n.Va=function(){this.C!=null&&(this.C=null,su(this),Xd(this),mn(19))};function iu(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function ay(c,f){var m=null;if(c.g==f){iu(c),Zd(c),c.g=null;var y=2}else if(Wd(c.h,f))m=f.G,Bg(c.h,f),y=1;else return;if(c.I!=0){if(f.o)if(y==1){m=f.u?f.u.length:0,f=Date.now()-f.F;var O=c.D;y=ai(),H(y,new Pg(y,m)),ru(c)}else iy(c);else if(O=f.m,O==3||O==0&&f.X>0||!(y==1&&wP(c,f)||y==2&&Xd(c)))switch(m&&m.length>0&&(f=c.h,f.i=f.i.concat(m)),O){case 1:ui(c,5);break;case 4:ui(c,10);break;case 3:ui(c,6);break;default:ui(c,2)}}}function ly(c,f){let m=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(m*=2),m*f}function ui(c,f){if(c.j.info("Error code "+f),f==2){var m=u(c.bb,c),y=c.Ua;const O=!y;y=new ar(y||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Ha(y,"https"),eu(y),O?gP(y.toString(),m):yP(y.toString(),m)}else mn(2);c.I=0,c.l&&c.l.pa(f),cy(c),ny(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),mn(2)):(this.j.info("Failed to ping google.com"),mn(1))};function cy(c){if(c.I=0,c.ja=[],c.l){const f=$g(c.h);(f.length!=0||c.i.length!=0)&&(E(c.ja,f),E(c.ja,c.i),c.h.i.length=0,_(c.i),c.i.length=0),c.l.oa()}}function uy(c,f,m){var y=m instanceof ar?cs(m):new ar(m);if(y.g!="")f&&(y.g=f+"."+y.g),Qa(y,y.u);else{var O=o.location;y=O.protocol,f=f?f+"."+O.hostname:O.hostname,O=+O.port;const L=new ar(null);y&&Ha(L,y),f&&(L.g=f),O&&Qa(L,O),m&&(L.h=m),y=L}return m=c.G,f=c.wa,m&&f&&dt(y,m,f),dt(y,"VER",c.ka),nl(c,y),y}function hy(c,f,m){if(f&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return f=c.Aa&&!c.ma?new Tt(new Qd({ab:m})):new Tt(c.ma),f.Fa(c.L),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dy(){}n=dy.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ou(){}ou.prototype.g=function(c,f){return new Nn(c,f)};function Nn(c,f){Q.call(this),this.g=new ty(f),this.l=c,this.h=f&&f.messageUrlParams||null,c=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(c?c["X-WebChannel-Content-Type"]=f.messageContentType:c={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.sa&&(c?c["X-WebChannel-Client-Profile"]=f.sa:c={"X-WebChannel-Client-Profile":f.sa}),this.g.U=c,(c=f&&f.Qb)&&!T(c)&&(this.g.u=c),this.A=f&&f.supportsCrossDomainXhr||!1,this.v=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!T(f)&&(this.g.G=f,c=this.h,c!==null&&f in c&&(c=this.h,f in c&&delete c[f])),this.j=new po(this)}d(Nn,Q),Nn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Nn.prototype.close=function(){Jd(this.g)},Nn.prototype.o=function(c){var f=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.v&&(m={},m.__data__=Ue(c),c=m);f.i.push(new cP(f.Ya++,c)),f.I==3&&ru(f)},Nn.prototype.N=function(){this.g.l=null,delete this.j,Jd(this.g),delete this.g,Nn.Z.N.call(this)};function fy(c){uo.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var f=c.__sm__;if(f){e:{for(const m in f){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,f=f!==null&&c in f?f[c]:void 0),this.data=f}else this.data=c}d(fy,uo);function py(){Kt.call(this),this.status=1}d(py,Kt);function po(c){this.g=c}d(po,dy),po.prototype.ra=function(){H(this.g,"a")},po.prototype.qa=function(c){H(this.g,new fy(c))},po.prototype.pa=function(c){H(this.g,new py)},po.prototype.oa=function(){H(this.g,"b")},ou.prototype.createWebChannel=ou.prototype.g,Nn.prototype.send=Nn.prototype.o,Nn.prototype.open=Nn.prototype.m,Nn.prototype.close=Nn.prototype.close,EA=function(){return new ou},vA=function(){return ai()},yA=Ft,vp={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Xc.NO_ERROR=0,Xc.TIMEOUT=8,Xc.HTTP_ERROR=6,Ou=Xc,Ng.COMPLETE="complete",gA=Ng,Pn.EventType=Kn,Kn.OPEN="a",Kn.CLOSE="b",Kn.ERROR="c",Kn.MESSAGE="d",Q.prototype.listen=Q.prototype.J,El=Pn,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,_A=Tt}).apply(typeof pu<"u"?pu:typeof self<"u"?self:typeof window<"u"?window:{});const rE="@firebase/firestore",iE="4.9.3";class qt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qt.UNAUTHENTICATED=new qt(null),qt.GOOGLE_CREDENTIALS=new qt("google-credentials-uid"),qt.FIRST_PARTY=new qt("first-party-uid"),qt.MOCK_USER=new qt("mock-user");let Ca="12.7.0";const jr=new ed("@firebase/firestore");function bo(){return jr.logLevel}function vM(n){jr.setLogLevel(n)}function W(n,...e){if(jr.logLevel<=ke.DEBUG){const t=e.map(r_);jr.debug(`Firestore (${Ca}): ${n}`,...t)}}function At(n,...e){if(jr.logLevel<=ke.ERROR){const t=e.map(r_);jr.error(`Firestore (${Ca}): ${n}`,...t)}}function Mn(n,...e){if(jr.logLevel<=ke.WARN){const t=e.map(r_);jr.warn(`Firestore (${Ca}): ${n}`,...t)}}function r_(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function he(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,IA(n,s,t)}function IA(n,e,t){let s=`FIRESTORE (${Ca}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw At(s),new Error(s)}function pe(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||IA(e,r,s)}function EM(n,e){n||he(57014,e)}function ee(n,e){return n}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends Zs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Gt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class TA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(qt.UNAUTHENTICATED)))}shutdown(){}}class IM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class TM{constructor(e){this.t=e,this.currentUser=qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pe(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new Gt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Gt,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const l=i;e.enqueueRetryable((async()=>{await l.promise,await r(this.currentUser)}))},a=l=>{W("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(W("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Gt)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(W("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(pe(typeof s.accessToken=="string",31837,{l:s}),new TA(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(e===null||typeof e=="string",2055,{h:e}),new qt(e)}}class wM{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=qt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class bM{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new wM(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(qt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ep{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class AM{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){pe(this.o===void 0,3512);const s=i=>{i.error!=null&&W("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,W("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{W("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):W("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ep(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(pe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ep(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class SM{getToken(){return Promise.resolve(new Ep(""))}invalidateToken(){}start(e,t){}shutdown(){}}function RM(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class cd{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=RM(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Ie(n,e){return n<e?-1:n>e?1:0}function Ip(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return Sf(r)===Sf(i)?Ie(r,i):Sf(r)?1:-1}return Ie(n.length,e.length)}const CM=55296,PM=57343;function Sf(n){const e=n.charCodeAt(0);return e>=CM&&e<=PM}function Zo(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}function bA(n){return n+"\0"}const Tp="__name__";class fs{constructor(e,t,s){t===void 0?t=0:t>e.length&&he(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&he(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return fs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof fs?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=fs.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Ie(e.length,t.length)}static compareSegments(e,t){const s=fs.isNumericId(e),r=fs.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?fs.extractNumericId(e).compare(fs.extractNumericId(t)):Ip(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Fr.fromString(e.substring(4,e.length-2))}}class Ce extends fs{construct(e,t,s){return new Ce(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new Ce(t)}static emptyPath(){return new Ce([])}}const NM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _t extends fs{construct(e,t,s){return new _t(e,t,s)}static isValidIdentifier(e){return NM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_t.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Tp}static keyField(){return new _t([Tp])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new B(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new B(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new B(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _t(t)}static emptyPath(){return new _t([])}}class Z{constructor(e){this.path=e}static fromPath(e){return new Z(Ce.fromString(e))}static fromName(e){return new Z(Ce.fromString(e).popFirst(5))}static empty(){return new Z(Ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Z(new Ce(e.slice()))}}function i_(n,e,t){if(!t)throw new B(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function AA(n,e,t,s){if(e===!0&&s===!0)throw new B(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function oE(n){if(!Z.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function aE(n){if(Z.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function SA(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ud(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":he(12329,{type:typeof n})}function Pe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ud(n);throw new B(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function RA(n,e){if(e<=0)throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Pt(n,e){const t={typeString:n};return e&&(t.value=e),t}function io(n,e){if(!SA(n))throw new B(M.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new B(M.INVALID_ARGUMENT,t);return!0}const lE=-62135596800,cE=1e6;class We{static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*cE);return new We(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<lE)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/cE}_compareTo(e){return this.seconds===e.seconds?Ie(this.nanoseconds,e.nanoseconds):Ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:We._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(io(e,We._jsonSchema))return new We(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-lE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}We._jsonSchemaVersion="firestore/timestamp/1.0",We._jsonSchema={type:Pt("string",We._jsonSchemaVersion),seconds:Pt("number"),nanoseconds:Pt("number")};class me{static fromTimestamp(e){return new me(e)}static min(){return new me(new We(0,0))}static max(){return new me(new We(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ea=-1;class ta{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function wp(n){return n.fields.find((e=>e.kind===2))}function yi(n){return n.fields.filter((e=>e.kind!==2))}function kM(n,e){let t=Ie(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let s=0;s<Math.min(n.fields.length,e.fields.length);++s)if(t=DM(n.fields[s],e.fields[s]),t!==0)return t;return Ie(n.fields.length,e.fields.length)}ta.UNKNOWN_ID=-1;class xi{constructor(e,t){this.fieldPath=e,this.kind=t}}function DM(n,e){const t=_t.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ie(n.kind,e.kind)}class na{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new na(0,Ln.min())}}function CA(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=me.fromTimestamp(s===1e9?new We(t+1,0):new We(t,s));return new Ln(r,Z.empty(),e)}function PA(n){return new Ln(n.readTime,n.key,ea)}class Ln{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Ln(me.min(),Z.empty(),ea)}static max(){return new Ln(me.max(),Z.empty(),ea)}}function o_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Z.comparator(n.documentKey,e.documentKey),t!==0?t:Ie(n.largestBatchId,e.largestBatchId))}const NA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kA{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Jr(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==NA)throw n;W("LocalStore","Unexpectedly lost primary lease")}class x{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&he(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new x(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof x?t:x.resolve(t)}catch(t){return x.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):x.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):x.reject(t)}static resolve(e){return new x(((t,s)=>{t(e)}))}static reject(e){return new x(((t,s)=>{s(e)}))}static waitFor(e){return new x(((t,s)=>{let r=0,i=0,o=!1;e.forEach((a=>{++r,a.next((()=>{++i,o&&i===r&&t()}),(l=>s(l)))})),o=!0,i===r&&t()}))}static or(e){let t=x.resolve(!1);for(const s of e)t=t.next((r=>r?x.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new x(((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next((h=>{o[u]=h,++a,a===i&&s(o)}),(h=>r(h)))}}))}static doWhile(e,t){return new x(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}const xn="SimpleDb";class hd{static open(e,t,s,r){try{return new hd(t,e.transaction(r,s))}catch(i){throw new Ll(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Gt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Ll(e,t.error)):this.S.resolve()},this.transaction.onerror=s=>{const r=a_(s.target.error);this.S.reject(new Ll(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(W(xn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new VM(t)}}class bs{static delete(e){return W(xn,"Removing database:",e),Ei(hw().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Ew())return!1;if(bs.F())return!0;const e=Vt(),t=bs.M(e),s=0<t&&t<10,r=DA(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,bs.M(Vt())===12.2&&At("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(W(xn,"Opening database:",this.name),this.db=await new Promise(((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{s(new Ll(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?s(new B(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?s(new B(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):s(new Ll(e,o))},r.onupgradeneeded=i=>{W(xn,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,r.transaction,i.oldVersion,this.version).next((()=>{W(xn,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,s,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=hd.open(this.db,e,i?"readonly":"readwrite",s),l=r(a).next((u=>(a.C(),u))).catch((u=>(a.abort(u),x.reject(u)))).toPromise();return l.catch((()=>{})),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(W(xn,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function DA(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class xM{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Ei(this.U.delete())}}class Ll extends B{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Xr(n){return n.name==="IndexedDbTransactionError"}class VM{constructor(e){this.store=e}put(e,t){let s;return t!==void 0?(W(xn,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(W(xn,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),Ei(s)}add(e){return W(xn,"ADD",this.store.name,e,e),Ei(this.store.add(e))}get(e){return Ei(this.store.get(e)).next((t=>(t===void 0&&(t=null),W(xn,"GET",this.store.name,e,t),t)))}delete(e){return W(xn,"DELETE",this.store.name,e),Ei(this.store.delete(e))}count(){return W(xn,"COUNT",this.store.name),Ei(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(s.range);return new x(((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}}))}{const i=this.cursor(s),o=[];return this.H(i,((a,l)=>{o.push(l)})).next((()=>o))}}Y(e,t){const s=this.store.getAll(e,t===null?void 0:t);return new x(((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}}))}Z(e,t){W(xn,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,((i,o,a)=>a.delete()))}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new x(((s,r)=>{t.onerror=i=>{const o=a_(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next((a=>{a?o.continue():s()})):s()}}))}H(e,t){const s=[];return new x(((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new xM(a),u=t(a.primaryKey,a.value,l);if(u instanceof x){const h=u.catch((d=>(l.done(),x.reject(d))));s.push(h)}l.isDone?r():l.G===null?a.continue():a.continue(l.G)}})).next((()=>x.waitFor(s)))}options(e,t){let s;return e!==void 0&&(typeof e=="string"?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ei(n){return new x(((e,t)=>{n.onsuccess=s=>{const r=s.target.result;e(r)},n.onerror=s=>{const r=a_(s.target.error);t(r)}}))}let uE=!1;function a_(n){const e=bs.M(Vt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uE||(uE=!0,setTimeout((()=>{throw s}),0)),s}}return n}const Fl="IndexBackfiller";class OM{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){W(Fl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();W(Fl,`Documents written: ${t}`)}catch(t){Xr(t)?W(Fl,"Ignoring IndexedDB error during index backfill: ",t):await Jr(t)}await this.re(6e4)}))}}class MM{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const s=new Set;let r=t,i=!0;return x.doWhile((()=>i===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!s.has(o))return W(Fl,`Processing collection: ${o}`),this.oe(e,o,r).next((a=>{r-=a,s.add(o)}));i=!1})))).next((()=>t-r))}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next((i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(r,i))).next((a=>(W(Fl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a)))).next((()=>o.size))}))))}_e(e,t){let s=e;return t.changes.forEach(((r,i)=>{const o=PA(i);o_(o,s)>0&&(s=o)})),new Ln(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Tn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Tn.ce=-1;const Ur=-1;function Oc(n){return n==null}function oc(n){return n===0&&1/n==-1/0}function xA(n){return typeof n=="number"&&Number.isInteger(n)&&!oc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const vh="";function un(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=hE(e)),e=LM(n.get(t),e);return hE(e)}function LM(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case vh:t+="";break;default:t+=i}}return t}function hE(n){return n+vh+""}function ys(n){const e=n.length;if(pe(e>=2,64408,{path:n}),e===2)return pe(n.charAt(0)===vh&&n.charAt(1)==="",56145,{path:n}),Ce.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf(vh,i);switch((o<0||o>t)&&he(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;r.length===0?l=a:(r+=a,l=r,r=""),s.push(l);break;case"":r+=n.substring(i,o),r+="\0";break;case"":r+=n.substring(i,o+1);break;default:he(61167,{path:n})}i=o+2}return new Ce(s)}const vi="remoteDocuments",Mc="owner",go="owner",ac="mutationQueues",FM="userId",zn="mutations",dE="batchId",Ri="userMutationsIndex",fE=["userId","batchId"];function Mu(n,e){return[n,un(e)]}function VA(n,e,t){return[n,un(e),t]}const UM={},sa="documentMutations",Eh="remoteDocumentsV14",BM=["prefixPath","collectionGroup","readTime","documentId"],Lu="documentKeyIndex",$M=["prefixPath","collectionGroup","documentId"],OA="collectionGroupIndex",qM=["collectionGroup","readTime","prefixPath","documentId"],lc="remoteDocumentGlobal",bp="remoteDocumentGlobalKey",ra="targets",MA="queryTargetsIndex",jM=["canonicalId","targetId"],ia="targetDocuments",GM=["targetId","path"],l_="documentTargetsIndex",KM=["path","targetId"],Ih="targetGlobalKey",Vi="targetGlobal",cc="collectionParents",WM=["collectionId","parent"],oa="clientMetadata",zM="clientId",dd="bundles",HM="bundleId",fd="namedQueries",QM="name",c_="indexConfiguration",YM="indexId",Ap="collectionGroupIndex",JM="collectionGroup",Ul="indexState",XM=["indexId","uid"],LA="sequenceNumberIndex",ZM=["uid","sequenceNumber"],Bl="indexEntries",eL=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],FA="documentKeyIndex",tL=["indexId","uid","orderedDocumentKey"],pd="documentOverlays",nL=["userId","collectionPath","documentId"],Sp="collectionPathOverlayIndex",sL=["userId","collectionPath","largestBatchId"],UA="collectionGroupOverlayIndex",rL=["userId","collectionGroup","largestBatchId"],u_="globals",iL="name",BA=[ac,zn,sa,vi,ra,Mc,Vi,ia,oa,lc,cc,dd,fd],oL=[...BA,pd],$A=[ac,zn,sa,Eh,ra,Mc,Vi,ia,oa,lc,cc,dd,fd,pd],qA=$A,h_=[...qA,c_,Ul,Bl],aL=h_,jA=[...h_,u_],lL=jA;class Rp extends kA{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Mt(n,e){const t=ee(n);return bs.O(t.le,e)}function pE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function GA(n,e){const t=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.push(e(n[s],s,n));return t}function KA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ut{constructor(e,t){this.comparator=e,this.root=t||Wt.EMPTY}insert(e,t){return new ut(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wt.BLACK,null,null))}remove(e){return new ut(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new mu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new mu(this.root,e,this.comparator,!1)}getReverseIterator(){return new mu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new mu(this.root,e,this.comparator,!0)}}class mu{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wt{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Wt.RED,this.left=r??Wt.EMPTY,this.right=i??Wt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Wt(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Wt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Wt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw he(43730,{key:this.key,value:this.value});if(this.right.isRed())throw he(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw he(27949);return e+(this.isRed()?0:1)}}Wt.EMPTY=null,Wt.RED=!0,Wt.BLACK=!1;Wt.EMPTY=new class{constructor(){this.size=0}get key(){throw he(57766)}get value(){throw he(16141)}get color(){throw he(16727)}get left(){throw he(29726)}get right(){throw he(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Wt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Je{constructor(e){this.comparator=e,this.data=new ut(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mE(this.data.getIterator())}getIteratorFrom(e){return new mE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Je)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Je(this.comparator);return t.data=e,t}}class mE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function yo(n){return n.hasNext()?n.getNext():void 0}class wn{constructor(e){this.fields=e,e.sort(_t.comparator)}static empty(){return new wn([])}unionWith(e){let t=new Je(_t.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new wn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zo(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class WA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function cL(){return typeof atob<"u"}class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new WA("Invalid base64 string: "+i):i}})(e);return new It(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const uL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ys(n){if(pe(!!n,39018),typeof n=="string"){let e=0;const t=uL.exec(n);if(pe(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Js(n){return typeof n=="string"?It.fromBase64String(n):It.fromUint8Array(n)}const zA="server_timestamp",HA="__type__",QA="__previous_value__",YA="__local_write_time__";function md(n){return(n?.mapValue?.fields||{})[HA]?.stringValue===zA}function _d(n){const e=n.mapValue.fields[QA];return md(e)?_d(e):e}function uc(n){const e=Ys(n.mapValue.fields[YA].timestampValue);return new We(e.seconds,e.nanos)}class hL{constructor(e,t,s,r,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const hc="(default)";class Gr{constructor(e,t){this.projectId=e,this.database=t||hc}static empty(){return new Gr("","")}get isDefaultDatabase(){return this.database===hc}isEqual(e){return e instanceof Gr&&e.projectId===this.projectId&&e.database===this.database}}const d_="__type__",JA="__max__",Pr={mapValue:{fields:{__type__:{stringValue:JA}}}},f_="__vector__",aa="value",Fu={nullValue:"NULL_VALUE"};function Kr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?md(n)?4:XA(n)?9007199254740991:gd(n)?10:11:he(28295,{value:n})}function Cs(n,e){if(n===e)return!0;const t=Kr(n);if(t!==Kr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return uc(n).isEqual(uc(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Ys(r.timestampValue),a=Ys(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return Js(r.bytesValue).isEqual(Js(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return yt(r.geoPointValue.latitude)===yt(i.geoPointValue.latitude)&&yt(r.geoPointValue.longitude)===yt(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return yt(r.integerValue)===yt(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=yt(r.doubleValue),a=yt(i.doubleValue);return o===a?oc(o)===oc(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Zo(n.arrayValue.values||[],e.arrayValue.values||[],Cs);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(pE(o)!==pE(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Cs(o[l],a[l])))return!1;return!0})(n,e);default:return he(52216,{left:n})}}function dc(n,e){return(n.values||[]).find((t=>Cs(t,e)))!==void 0}function Wr(n,e){if(n===e)return 0;const t=Kr(n),s=Kr(e);if(t!==s)return Ie(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ie(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const a=yt(i.integerValue||i.doubleValue),l=yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,e);case 3:return _E(n.timestampValue,e.timestampValue);case 4:return _E(uc(n),uc(e));case 5:return Ip(n.stringValue,e.stringValue);case 6:return(function(i,o){const a=Js(i),l=Js(o);return a.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Ie(a[u],l[u]);if(h!==0)return h}return Ie(a.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const a=Ie(yt(i.latitude),yt(o.latitude));return a!==0?a:Ie(yt(i.longitude),yt(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return gE(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const a=i.fields||{},l=o.fields||{},u=a[aa]?.arrayValue,h=l[aa]?.arrayValue,d=Ie(u?.values?.length||0,h?.values?.length||0);return d!==0?d:gE(u,h)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===Pr.mapValue&&o===Pr.mapValue)return 0;if(i===Pr.mapValue)return 1;if(o===Pr.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const p=Ip(l[d],h[d]);if(p!==0)return p;const _=Wr(a[l[d]],u[h[d]]);if(_!==0)return _}return Ie(l.length,h.length)})(n.mapValue,e.mapValue);default:throw he(23264,{he:t})}}function _E(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ie(n,e);const t=Ys(n),s=Ys(e),r=Ie(t.seconds,s.seconds);return r!==0?r:Ie(t.nanos,s.nanos)}function gE(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Wr(t[r],s[r]);if(i)return i}return Ie(t.length,s.length)}function la(n){return Cp(n)}function Cp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Ys(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Js(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Z.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=Cp(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${Cp(t.fields[o])}`;return r+"}"})(n.mapValue):he(61005,{value:n})}function Uu(n){switch(Kr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_d(n);return e?16+Uu(e):16;case 5:return 2*n.stringValue.length;case 6:return Js(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+Uu(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return Zr(s.fields,((i,o)=>{r+=i.length+Uu(o)})),r})(n.mapValue);default:throw he(13486,{value:n})}}function Gi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pp(n){return!!n&&"integerValue"in n}function fc(n){return!!n&&"arrayValue"in n}function yE(n){return!!n&&"nullValue"in n}function vE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Bu(n){return!!n&&"mapValue"in n}function gd(n){return(n?.mapValue?.fields||{})[d_]?.stringValue===f_}function $l(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Zr(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=$l(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$l(n.arrayValue.values[t]);return e}return{...n}}function XA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===JA}const ZA={mapValue:{fields:{[d_]:{stringValue:f_},[aa]:{arrayValue:{}}}}};function dL(n){return"nullValue"in n?Fu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Gi(Gr.empty(),Z.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?gd(n)?ZA:{mapValue:{}}:he(35942,{value:n})}function fL(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Gi(Gr.empty(),Z.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?ZA:"mapValue"in n?gd(n)?{mapValue:{}}:Pr:he(61959,{value:n})}function EE(n,e){const t=Wr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function IE(n,e){const t=Wr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Qt{constructor(e){this.value=e}static empty(){return new Qt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Bu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$l(t)}setAll(e){let t=_t.emptyPath(),s={},r=[];e.forEach(((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=$l(o):r.push(a.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Bu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Bu(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Zr(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new Qt($l(this.value))}}function eS(n){const e=[];return Zr(n.fields,((t,s)=>{const r=new _t([t]);if(Bu(s)){const i=eS(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new wn(e)}class mt{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new mt(e,0,me.min(),me.min(),me.min(),Qt.empty(),0)}static newFoundDocument(e,t,s,r){return new mt(e,1,t,me.min(),s,r,0)}static newNoDocument(e,t){return new mt(e,2,t,me.min(),me.min(),Qt.empty(),0)}static newUnknownDocument(e,t){return new mt(e,3,t,me.min(),me.min(),Qt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zr{constructor(e,t){this.position=e,this.inclusive=t}}function TE(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=Z.comparator(Z.fromName(o.referenceValue),t.key):s=Wr(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function wE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Cs(n.position[t],e.position[t]))return!1;return!0}class pc{constructor(e,t="asc"){this.field=e,this.dir=t}}function pL(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class tS{}class xe extends tS{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new mL(e,t,s):t==="array-contains"?new yL(e,s):t==="in"?new aS(e,s):t==="not-in"?new vL(e,s):t==="array-contains-any"?new EL(e,s):new xe(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new _L(e,s):new gL(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Wr(t,this.value)):t!==null&&Kr(this.value)===Kr(t)&&this.matchesComparison(Wr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qe extends tS{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Qe(e,t)}matches(e){return ca(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ca(n){return n.op==="and"}function Np(n){return n.op==="or"}function p_(n){return nS(n)&&ca(n)}function nS(n){for(const e of n.filters)if(e instanceof Qe)return!1;return!0}function kp(n){if(n instanceof xe)return n.field.canonicalString()+n.op.toString()+la(n.value);if(p_(n))return n.filters.map((e=>kp(e))).join(",");{const e=n.filters.map((t=>kp(t))).join(",");return`${n.op}(${e})`}}function sS(n,e){return n instanceof xe?(function(s,r){return r instanceof xe&&s.op===r.op&&s.field.isEqual(r.field)&&Cs(s.value,r.value)})(n,e):n instanceof Qe?(function(s,r){return r instanceof Qe&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,a)=>i&&sS(o,r.filters[a])),!0):!1})(n,e):void he(19439)}function rS(n,e){const t=n.filters.concat(e);return Qe.create(t,n.op)}function iS(n){return n instanceof xe?(function(t){return`${t.field.canonicalString()} ${t.op} ${la(t.value)}`})(n):n instanceof Qe?(function(t){return t.op.toString()+" {"+t.getFilters().map(iS).join(" ,")+"}"})(n):"Filter"}class mL extends xe{constructor(e,t,s){super(e,t,s),this.key=Z.fromName(s.referenceValue)}matches(e){const t=Z.comparator(e.key,this.key);return this.matchesComparison(t)}}class _L extends xe{constructor(e,t){super(e,"in",t),this.keys=oS("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class gL extends xe{constructor(e,t){super(e,"not-in",t),this.keys=oS("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function oS(n,e){return(e.arrayValue?.values||[]).map((t=>Z.fromName(t.referenceValue)))}class yL extends xe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fc(t)&&dc(t.arrayValue,this.value)}}class aS extends xe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&dc(this.value.arrayValue,t)}}class vL extends xe{constructor(e,t){super(e,"not-in",t)}matches(e){if(dc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!dc(this.value.arrayValue,t)}}class EL extends xe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>dc(this.value.arrayValue,s)))}}class IL{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Dp(n,e=null,t=[],s=[],r=null,i=null,o=null){return new IL(n,e,t,s,r,i,o)}function Ki(n){const e=ee(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>kp(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>la(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>la(s))).join(",")),e.Te=t}return e.Te}function Lc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!pL(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sS(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!wE(n.startAt,e.startAt)&&wE(n.endAt,e.endAt)}function Th(n){return Z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function wh(n,e){return n.filters.filter((t=>t instanceof xe&&t.field.isEqual(e)))}function bE(n,e,t){let s=Fu,r=!0;for(const i of wh(n,e)){let o=Fu,a=!0;switch(i.op){case"<":case"<=":o=dL(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Fu}EE({value:s,inclusive:r},{value:o,inclusive:a})<0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];EE({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}function AE(n,e,t){let s=Pr,r=!0;for(const i of wh(n,e)){let o=Pr,a=!0;switch(i.op){case">=":case">":o=fL(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Pr}IE({value:s,inclusive:r},{value:o,inclusive:a})>0&&(s=o,r=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];IE({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}}return{value:s,inclusive:r}}class tr{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function lS(n,e,t,s,r,i,o,a){return new tr(n,e,t,s,r,i,o,a)}function Pa(n){return new tr(n)}function SE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function m_(n){return n.collectionGroup!==null}function $o(n){const e=ee(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Je(_t.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new pc(i,s))})),t.has(_t.keyField().canonicalString())||e.Ie.push(new pc(_t.keyField(),s))}return e.Ie}function hn(n){const e=ee(n);return e.Ee||(e.Ee=uS(e,$o(n))),e.Ee}function cS(n){const e=ee(n);return e.de||(e.de=uS(e,n.explicitOrderBy)),e.de}function uS(n,e){if(n.limitType==="F")return Dp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new pc(r.field,i)}));const t=n.endAt?new zr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new zr(n.startAt.position,n.startAt.inclusive):null;return Dp(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function xp(n,e){const t=n.filters.concat([e]);return new tr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bh(n,e,t){return new tr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fc(n,e){return Lc(hn(n),hn(e))&&n.limitType===e.limitType}function hS(n){return`${Ki(hn(n))}|lt:${n.limitType}`}function Ao(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>iS(r))).join(", ")}]`),Oc(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>la(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>la(r))).join(",")),`Target(${s})`})(hn(n))}; limitType=${n.limitType})`}function Uc(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):Z.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of $o(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,a,l){const u=TE(o,a,l);return o.inclusive?u<=0:u<0})(s.startAt,$o(s),r)||s.endAt&&!(function(o,a,l){const u=TE(o,a,l);return o.inclusive?u>=0:u>0})(s.endAt,$o(s),r))})(n,e)}function dS(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fS(n){return(e,t)=>{let s=!1;for(const r of $o(n)){const i=TL(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function TL(n,e,t){const s=n.field.isKeyField()?Z.comparator(e.key,t.key):(function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Wr(l,u):he(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return he(19790,{direction:n.dir})}}class nr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Zr(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return KA(this.inner)}size(){return this.innerSize}}const wL=new ut(Z.comparator);function bn(){return wL}const pS=new ut(Z.comparator);function Il(...n){let e=pS;for(const t of n)e=e.insert(t.key,t);return e}function mS(n){let e=pS;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function vs(){return ql()}function _S(){return ql()}function ql(){return new nr((n=>n.toString()),((n,e)=>n.isEqual(e)))}const bL=new ut(Z.comparator),AL=new Je(Z.comparator);function Se(...n){let e=AL;for(const t of n)e=e.add(t);return e}const SL=new Je(Ie);function __(){return SL}function g_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oc(e)?"-0":e}}function gS(n){return{integerValue:""+n}}function yS(n,e){return xA(e)?gS(e):g_(n,e)}class yd{constructor(){this._=void 0}}function RL(n,e,t){return n instanceof ua?(function(r,i){const o={fields:{[HA]:{stringValue:zA},[YA]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&md(i)&&(i=_d(i)),i&&(o.fields[QA]=i),{mapValue:o}})(t,e):n instanceof Wi?ES(n,e):n instanceof zi?IS(n,e):(function(r,i){const o=vS(r,i),a=RE(o)+RE(r.Ae);return Pp(o)&&Pp(r.Ae)?gS(a):g_(r.serializer,a)})(n,e)}function CL(n,e,t){return n instanceof Wi?ES(n,e):n instanceof zi?IS(n,e):t}function vS(n,e){return n instanceof ha?(function(s){return Pp(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class ua extends yd{}class Wi extends yd{constructor(e){super(),this.elements=e}}function ES(n,e){const t=TS(e);for(const s of n.elements)t.some((r=>Cs(r,s)))||t.push(s);return{arrayValue:{values:t}}}class zi extends yd{constructor(e){super(),this.elements=e}}function IS(n,e){let t=TS(e);for(const s of n.elements)t=t.filter((r=>!Cs(r,s)));return{arrayValue:{values:t}}}class ha extends yd{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function RE(n){return yt(n.integerValue||n.doubleValue)}function TS(n){return fc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Bc{constructor(e,t){this.field=e,this.transform=t}}function PL(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Wi&&r instanceof Wi||s instanceof zi&&r instanceof zi?Zo(s.elements,r.elements,Cs):s instanceof ha&&r instanceof ha?Cs(s.Ae,r.Ae):s instanceof ua&&r instanceof ua})(n.transform,e.transform)}class NL{constructor(e,t){this.version=e,this.transformResults=t}}class vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vt}static exists(e){return new vt(void 0,e)}static updateTime(e){return new vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $u(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class vd{}function wS(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ka(n.key,vt.none()):new Na(n.key,n.data,vt.none());{const t=n.data,s=Qt.empty();let r=new Je(_t.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new sr(n.key,s,new wn(r.toArray()),vt.none())}}function kL(n,e,t){n instanceof Na?(function(r,i,o){const a=r.value.clone(),l=PE(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof sr?(function(r,i,o){if(!$u(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=PE(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(bS(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function jl(n,e,t,s){return n instanceof Na?(function(i,o,a,l){if(!$u(i.precondition,o))return a;const u=i.value.clone(),h=NE(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,s):n instanceof sr?(function(i,o,a,l){if(!$u(i.precondition,o))return a;const u=NE(i.fieldTransforms,l,o),h=o.data;return h.setAll(bS(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((d=>d.field)))})(n,e,t,s):(function(i,o,a){return $u(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function DL(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=vS(s.transform,r||null);i!=null&&(t===null&&(t=Qt.empty()),t.set(s.field,i))}return t||null}function CE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Zo(s,r,((i,o)=>PL(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Na extends vd{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class sr extends vd{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function bS(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function PE(n,e,t){const s=new Map;pe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,CL(o,a,t[r]))}return s}function NE(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,RL(i,o,e))}return s}class ka extends vd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class y_ extends vd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class v_{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&kL(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=jl(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=jl(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=_S();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=wS(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(me.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Se())}isEqual(e){return this.batchId===e.batchId&&Zo(this.mutations,e.mutations,((t,s)=>CE(t,s)))&&Zo(this.baseMutations,e.baseMutations,((t,s)=>CE(t,s)))}}class E_{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){pe(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return bL})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new E_(e,t,s,r)}}class I_{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class AS{constructor(e,t,s){this.alias=e,this.aggregateType=t,this.fieldPath=s}}class xL{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ct,Me;function SS(n){switch(n){case M.OK:return he(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return he(15467,{code:n})}}function RS(n){if(n===void 0)return At("GRPC error has no .code"),M.UNKNOWN;switch(n){case Ct.OK:return M.OK;case Ct.CANCELLED:return M.CANCELLED;case Ct.UNKNOWN:return M.UNKNOWN;case Ct.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Ct.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Ct.INTERNAL:return M.INTERNAL;case Ct.UNAVAILABLE:return M.UNAVAILABLE;case Ct.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Ct.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Ct.NOT_FOUND:return M.NOT_FOUND;case Ct.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Ct.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Ct.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Ct.ABORTED:return M.ABORTED;case Ct.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Ct.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Ct.DATA_LOSS:return M.DATA_LOSS;default:return he(39323,{code:n})}}(Me=Ct||(Ct={}))[Me.OK=0]="OK",Me[Me.CANCELLED=1]="CANCELLED",Me[Me.UNKNOWN=2]="UNKNOWN",Me[Me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Me[Me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Me[Me.NOT_FOUND=5]="NOT_FOUND",Me[Me.ALREADY_EXISTS=6]="ALREADY_EXISTS",Me[Me.PERMISSION_DENIED=7]="PERMISSION_DENIED",Me[Me.UNAUTHENTICATED=16]="UNAUTHENTICATED",Me[Me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Me[Me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Me[Me.ABORTED=10]="ABORTED",Me[Me.OUT_OF_RANGE=11]="OUT_OF_RANGE",Me[Me.UNIMPLEMENTED=12]="UNIMPLEMENTED",Me[Me.INTERNAL=13]="INTERNAL",Me[Me.UNAVAILABLE=14]="UNAVAILABLE",Me[Me.DATA_LOSS=15]="DATA_LOSS";let Vp=null;function CS(){return new TextEncoder}const VL=new Fr([4294967295,4294967295],0);function kE(n){const e=CS().encode(n),t=new mA;return t.update(e),new Uint8Array(t.digest())}function DE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Fr([t,s],0),new Fr([r,i],0)]}class T_{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Tl(`Invalid padding: ${t}`);if(s<0)throw new Tl(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Tl(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Tl(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Fr.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Fr.fromNumber(s)));return r.compare(VL)===1&&(r=new Fr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=kE(e),[s,r]=DE(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new T_(i,r,t);return s.forEach((a=>o.insert(a))),o}insert(e){if(this.ge===0)return;const t=kE(e),[s,r]=DE(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Tl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $c{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,qc.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new $c(me.min(),r,new ut(Ie),bn(),Se())}}class qc{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new qc(s,t,Se(),Se(),Se())}}class qu{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class PS{constructor(e,t){this.targetId=e,this.Ce=t}}class NS{constructor(e,t,s=It.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class xE{constructor(){this.ve=0,this.Fe=VE(),this.Me=It.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Se(),t=Se(),s=Se();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:he(38017,{changeType:i})}})),new qc(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=VE()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,pe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class OL{constructor(e){this.Ge=e,this.ze=new Map,this.je=bn(),this.Je=_u(),this.He=_u(),this.Ye=new ut(Ie)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:he(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Th(i))if(s===0){const o=new Z(i.path);this.et(t,o,mt.newNoDocument(o,me.min()))}else pe(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}Vp?.lt((function(h,d,p,_,E){const b={localCacheCount:h,existenceFilterCount:d.count,databaseId:p.database,projectId:p.projectId},C=d.unchangedNames;return C&&(b.bloomFilter={applied:E===0,hashCount:C?.hashCount??0,bitmapLength:C?.bits?.bitmap?.length??0,padding:C?.bits?.padding??0,mightContain:F=>_?.mightContain(F)??!1}),b})(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=Js(s).toUint8Array()}catch(l){if(l instanceof WA)return Mn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new T_(o,r,i)}catch(l){return Mn(l instanceof Tl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Th(a.target)){const l=new Z(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,mt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=Se();this.He.forEach(((i,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new $c(e,t,this.Ye,this.je,s);return this.je=bn(),this.Je=_u(),this.He=_u(),this.Ye=new ut(Ie),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new xE,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Je(Ie),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Je(Ie),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||W("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new xE),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function _u(){return new ut(Z.comparator)}function VE(){return new ut(Z.comparator)}const ML={asc:"ASCENDING",desc:"DESCENDING"},LL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},FL={and:"AND",or:"OR"};class UL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Op(n,e){return n.useProto3Json||Oc(e)?e:{value:e}}function da(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function kS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function BL(n,e){return da(n,e.toTimestamp())}function St(n){return pe(!!n,49232),me.fromTimestamp((function(t){const s=Ys(t);return new We(s.seconds,s.nanos)})(n))}function w_(n,e){return Mp(n,e).canonicalString()}function Mp(n,e){const t=(function(r){return new Ce(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function DS(n){const e=Ce.fromString(n);return pe($S(e),10190,{key:e.toString()}),e}function mc(n,e){return w_(n.databaseId,e.path)}function As(n,e){const t=DS(e);if(t.get(1)!==n.databaseId.projectId)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Z(OS(t))}function xS(n,e){return w_(n.databaseId,e)}function VS(n){const e=DS(n);return e.length===4?Ce.emptyPath():OS(e)}function Lp(n){return new Ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function OS(n){return pe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function OE(n,e,t){return{name:mc(n,e),fields:t.value.mapValue.fields}}function Ed(n,e,t){const s=As(n,e.name),r=St(e.updateTime),i=e.createTime?St(e.createTime):me.min(),o=new Qt({mapValue:{fields:e.fields}}),a=mt.newFoundDocument(s,r,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function $L(n,e){return"found"in e?(function(s,r){pe(!!r.found,43571),r.found.name,r.found.updateTime;const i=As(s,r.found.name),o=St(r.found.updateTime),a=r.found.createTime?St(r.found.createTime):me.min(),l=new Qt({mapValue:{fields:r.found.fields}});return mt.newFoundDocument(i,o,a,l)})(n,e):"missing"in e?(function(s,r){pe(!!r.missing,3894),pe(!!r.readTime,22933);const i=As(s,r.missing),o=St(r.readTime);return mt.newNoDocument(i,o)})(n,e):he(7234,{result:e})}function qL(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:he(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(u,h){return u.useProto3Json?(pe(h===void 0||typeof h=="string",58123),It.fromBase64String(h||"")):(pe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),It.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?M.UNKNOWN:RS(u.code);return new B(h,u.message||"")})(o);t=new NS(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=As(n,s.document.name),i=St(s.document.updateTime),o=s.document.createTime?St(s.document.createTime):me.min(),a=new Qt({mapValue:{fields:s.document.fields}}),l=mt.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];t=new qu(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=As(n,s.document),i=s.readTime?St(s.readTime):me.min(),o=mt.newNoDocument(r,i),a=s.removedTargetIds||[];t=new qu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=As(n,s.document),i=s.removedTargetIds||[];t=new qu([],i,r,null)}else{if(!("filter"in e))return he(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new xL(r,i),a=s.targetId;t=new PS(a,o)}}return t}function _c(n,e){let t;if(e instanceof Na)t={update:OE(n,e.key,e.value)};else if(e instanceof ka)t={delete:mc(n,e.key)};else if(e instanceof sr)t={update:OE(n,e.key,e.data),updateMask:HL(e.fieldMask)};else{if(!(e instanceof y_))return he(16599,{Vt:e.type});t={verify:mc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const a=o.transform;if(a instanceof ua)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Wi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ha)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw he(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:BL(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he(27497)})(n,e.precondition)),t}function Fp(n,e){const t=e.currentDocument?(function(i){return i.updateTime!==void 0?vt.updateTime(St(i.updateTime)):i.exists!==void 0?vt.exists(i.exists):vt.none()})(e.currentDocument):vt.none(),s=e.updateTransforms?e.updateTransforms.map((r=>(function(o,a){let l=null;if("setToServerValue"in a)pe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new ua;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Wi(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new zi(h)}else"increment"in a?l=new ha(o,a.increment):he(16584,{proto:a});const u=_t.fromServerFormat(a.fieldPath);return new Bc(u,l)})(n,r))):[];if(e.update){e.update.name;const r=As(n,e.update.name),i=new Qt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=(function(l){const u=l.fieldPaths||[];return new wn(u.map((h=>_t.fromServerFormat(h))))})(e.updateMask);return new sr(r,i,o,t,s)}return new Na(r,i,t,s)}if(e.delete){const r=As(n,e.delete);return new ka(r,t)}if(e.verify){const r=As(n,e.verify);return new y_(r,t)}return he(1463,{proto:e})}function jL(n,e){return n&&n.length>0?(pe(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?St(r.updateTime):St(i);return o.isEqual(me.min())&&(o=St(i)),new NL(o,r.transformResults||[])})(t,e)))):[]}function MS(n,e){return{documents:[xS(n,e.path)]}}function Id(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=xS(n,r);const i=(function(u){if(u.length!==0)return BS(Qe.create(u,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(u){if(u.length!==0)return u.map((h=>(function(p){return{field:Rr(p.field),direction:KL(p.dir)}})(h)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Op(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:t,parent:r}}function LS(n,e,t,s){const{ft:r,parent:i}=Id(n,e),o={},a=[];let l=0;return t.forEach((u=>{const h=s?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Rr(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Rr(u.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:r.structuredQuery},parent:r.parent},gt:o,parent:i}}function FS(n){let e=VS(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){pe(s===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=(function(d){const p=US(d);return p instanceof Qe&&p_(p)?p.getFilters():[p]})(t.where));let o=[];t.orderBy&&(o=(function(d){return d.map((p=>(function(E){return new pc(So(E.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(p)))})(t.orderBy));let a=null;t.limit&&(a=(function(d){let p;return p=typeof d=="object"?d.value:d,Oc(p)?null:p})(t.limit));let l=null;t.startAt&&(l=(function(d){const p=!!d.before,_=d.values||[];return new zr(_,p)})(t.startAt));let u=null;return t.endAt&&(u=(function(d){const p=!d.before,_=d.values||[];return new zr(_,p)})(t.endAt)),lS(e,r,o,i,a,"F",l,u)}function GL(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function US(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=So(t.unaryFilter.field);return xe.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=So(t.unaryFilter.field);return xe.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=So(t.unaryFilter.field);return xe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=So(t.unaryFilter.field);return xe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return he(61313);default:return he(60726)}})(n):n.fieldFilter!==void 0?(function(t){return xe.create(So(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return he(58110);default:return he(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Qe.create(t.compositeFilter.filters.map((s=>US(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return he(1026)}})(t.compositeFilter.op))})(n):he(30097,{filter:n})}function KL(n){return ML[n]}function WL(n){return LL[n]}function zL(n){return FL[n]}function Rr(n){return{fieldPath:n.canonicalString()}}function So(n){return _t.fromServerFormat(n.fieldPath)}function BS(n){return n instanceof xe?(function(t){if(t.op==="=="){if(vE(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NAN"}};if(yE(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(vE(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NOT_NAN"}};if(yE(t.value))return{unaryFilter:{field:Rr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rr(t.field),op:WL(t.op),value:t.value}}})(n):n instanceof Qe?(function(t){const s=t.getFilters().map((r=>BS(r)));return s.length===1?s[0]:{compositeFilter:{op:zL(t.op),filters:s}}})(n):he(54877,{filter:n})}function HL(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $S(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Bs{constructor(e,t,s,r,i=me.min(),o=me.min(),a=It.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class qS{constructor(e){this.yt=e}}function QL(n,e){let t;if(e.document)t=Ed(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=Z.fromSegments(e.noDocument.path),r=Qi(e.noDocument.readTime);t=mt.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return he(56709);{const s=Z.fromSegments(e.unknownDocument.path),r=Qi(e.unknownDocument.version);t=mt.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime((function(r){const i=new We(r[0],r[1]);return me.fromTimestamp(i)})(e.readTime)),t}function ME(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ah(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=(function(i,o){return{name:mc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:da(i,o.version.toTimestamp()),createTime:da(i,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:Hi(e.version)};else{if(!e.isUnknownDocument())return he(57904,{document:e});s.unknownDocument={path:t.path.toArray(),version:Hi(e.version)}}return s}function Ah(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Qi(n){const e=new We(n.seconds,n.nanoseconds);return me.fromTimestamp(e)}function Ii(n,e){const t=(e.baseMutations||[]).map((i=>Fp(n.yt,i)));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const s=e.mutations.map((i=>Fp(n.yt,i))),r=We.fromMillis(e.localWriteTimeMs);return new v_(e.batchId,r,t,s)}function wl(n){const e=Qi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Qi(n.lastLimboFreeSnapshotVersion):me.min();let s;return s=(function(i){return i.documents!==void 0})(n.query)?(function(i){const o=i.documents.length;return pe(o===1,1966,{count:o}),hn(Pa(VS(i.documents[0])))})(n.query):(function(i){return hn(FS(i))})(n.query),new Bs(s,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,It.fromBase64String(n.resumeToken))}function jS(n,e){const t=Hi(e.snapshotVersion),s=Hi(e.lastLimboFreeSnapshotVersion);let r;r=Th(e.target)?MS(n.yt,e.target):Id(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ki(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function Td(n){const e=FS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bh(e,e.limit,"L"):e}function Rf(n,e){return new I_(e.largestBatchId,Fp(n.yt,e.overlayMutation))}function LE(n,e){const t=e.path.lastSegment();return[n,un(e.path.popLast()),t]}function FE(n,e,t,s){return{indexId:n,uid:e,sequenceNumber:t,readTime:Hi(s.readTime),documentKey:un(s.documentKey.path),largestBatchId:s.largestBatchId}}class YL{getBundleMetadata(e,t){return UE(e).get(t).next((s=>{if(s)return(function(i){return{id:i.bundleId,createTime:Qi(i.createTime),version:i.version}})(s)}))}saveBundleMetadata(e,t){return UE(e).put((function(r){return{bundleId:r.id,createTime:Hi(St(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return BE(e).get(t).next((s=>{if(s)return(function(i){return{name:i.name,query:Td(i.bundledQuery),readTime:Qi(i.readTime)}})(s)}))}saveNamedQuery(e,t){return BE(e).put((function(r){return{name:r.name,readTime:Hi(St(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function UE(n){return Mt(n,dd)}function BE(n){return Mt(n,fd)}class wd{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new wd(e,s)}getOverlay(e,t){return ul(e).get(LE(this.userId,t)).next((s=>s?Rf(this.serializer,s):null))}getOverlays(e,t){const s=vs();return x.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){const r=[];return s.forEach(((i,o)=>{const a=new I_(t,o);r.push(this.St(e,a))})),x.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach((o=>r.add(un(o.getCollectionPath()))));const i=[];return r.forEach((o=>{const a=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push(ul(e).Z(Sp,a))})),x.waitFor(i)}getOverlaysForCollection(e,t,s){const r=vs(),i=un(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ul(e).J(Sp,o).next((a=>{for(const l of a){const u=Rf(this.serializer,l);r.set(u.getKey(),u)}return r}))}getOverlaysForCollectionGroup(e,t,s,r){const i=vs();let o;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ul(e).ee({index:UA,range:a},((l,u,h)=>{const d=Rf(this.serializer,u);i.size()<r||d.largestBatchId===o?(i.set(d.getKey(),d),o=d.largestBatchId):h.done()})).next((()=>i))}St(e,t){return ul(e).put((function(r,i,o){const[a,l,u]=LE(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_c(r.yt,o.mutation)}})(this.serializer,this.userId,t))}}function ul(n){return Mt(n,pd)}class JL{bt(e){return Mt(e,u_)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const s=t?.value;return s?It.fromUint8Array(s):It.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Ti{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(yt(e.integerValue));else if("doubleValue"in e){const s=yt(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),oc(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),typeof s=="string"&&(s=Ys(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Js(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?XA(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):gd(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):he(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){const s=e.fields||{};this.Ft(t,53);const r=aa,i=s[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(yt(i)),this.Ot(r,t),this.Ct(s[r],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Z.fromName(e).path.forEach((s=>{this.Ft(t,60),this.Ut(s,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ti.Kt=new Ti;const vo=255;function XL(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function $E(n){const e=64-(function(s){let r=0;for(let i=0;i<8;++i){const o=XL(255&s[i]);if(r+=o,o!==8)break}return r})(n);return Math.ceil(e/8)}class ZL{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Gt(s);else if(s<2048)this.Gt(960|s>>>6),this.Gt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Jt(s);else if(s<2048)this.Jt(960|s>>>6),this.Jt(128|63&s);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),s=$E(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=$E(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(vo),this.sn(255)}_n(){this.an(vo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)})(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===vo?(this.sn(vo),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===vo?(this.an(vo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class eF{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class tF{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class hl{constructor(){this.cn=new ZL,this.ln=new eF(this.cn),this.hn=new tF(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class wi{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new wi(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:ju(this.En),directionalValue:ju(this.dn),orderedDocumentKey:ju(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function fr(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=qE(n.En,e.En),t!==0?t:(t=qE(n.dn,e.dn),t!==0?t:Z.comparator(n.In,e.In)))}function qE(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(s!==0)return s}return n.length-e.length}function ju(n){return vw()?(function(t){let s="";for(let r=0;r<t.length;r++)s+=String.fromCharCode(t[r]);return s})(n):n}function jE(n){return typeof n!="string"?n:(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(n)}class GE{constructor(e){this.mn=new Je(((t,s)=>_t.comparator(t.field,s.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const s=t;s.isInequality()?this.mn=this.mn.add(s):this.gn.push(s)}}get pn(){return this.mn.size>1}yn(e){if(pe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=wp(e);if(t!==void 0&&!this.wn(t))return!1;const s=yi(e);let r=new Set,i=0,o=0;for(;i<s.length&&this.wn(s[i]);++i)r=r.add(s[i].fieldPath.canonicalString());if(i===s.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!r.has(a.field.canonicalString())){const l=s[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<s.length;++i){const a=s[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Je(_t.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if(s.op==="array-contains"||s.op==="array-contains-any")t.push(new xi(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new xi(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new xi(s.field,s.dir==="asc"?0:1)));return new ta(ta.UNKNOWN_ID,this.collectionId,t,na.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const s=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function GS(n){if(pe(n instanceof xe||n instanceof Qe,20012),n instanceof xe){if(n instanceof aS){const t=n.value.arrayValue?.values?.map((s=>xe.create(n.field,"==",s)))||[];return Qe.create(t,"or")}return n}const e=n.filters.map((t=>GS(t)));return Qe.create(e,n.op)}function nF(n){if(n.getFilters().length===0)return[];const e=$p(GS(n));return pe(KS(e),7391),Up(e)||Bp(e)?[e]:e.getFilters()}function Up(n){return n instanceof xe}function Bp(n){return n instanceof Qe&&p_(n)}function KS(n){return Up(n)||Bp(n)||(function(t){if(t instanceof Qe&&Np(t)){for(const s of t.getFilters())if(!Up(s)&&!Bp(s))return!1;return!0}return!1})(n)}function $p(n){if(pe(n instanceof xe||n instanceof Qe,34018),n instanceof xe)return n;if(n.filters.length===1)return $p(n.filters[0]);const e=n.filters.map((s=>$p(s)));let t=Qe.create(e,n.op);return t=Sh(t),KS(t)?t:(pe(t instanceof Qe,64498),pe(ca(t),40251),pe(t.filters.length>1,57927),t.filters.reduce(((s,r)=>b_(s,r))))}function b_(n,e){let t;return pe(n instanceof xe||n instanceof Qe,38388),pe(e instanceof xe||e instanceof Qe,25473),t=n instanceof xe?e instanceof xe?(function(r,i){return Qe.create([r,i],"and")})(n,e):KE(n,e):e instanceof xe?KE(e,n):(function(r,i){if(pe(r.filters.length>0&&i.filters.length>0,48005),ca(r)&&ca(i))return rS(r,i.getFilters());const o=Np(r)?r:i,a=Np(r)?i:r,l=o.filters.map((u=>b_(u,a)));return Qe.create(l,"or")})(n,e),Sh(t)}function KE(n,e){if(ca(e))return rS(e,n.getFilters());{const t=e.filters.map((s=>b_(n,s)));return Qe.create(t,"or")}}function Sh(n){if(pe(n instanceof xe||n instanceof Qe,11850),n instanceof xe)return n;const e=n.getFilters();if(e.length===1)return Sh(e[0]);if(nS(n))return n;const t=e.map((r=>Sh(r))),s=[];return t.forEach((r=>{r instanceof xe?s.push(r):r instanceof Qe&&(r.op===n.op?s.push(...r.filters):s.push(r))})),s.length===1?s[0]:Qe.create(s,n.op)}class sF{constructor(){this.Cn=new A_}addToCollectionParentIndex(e,t){return this.Cn.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}deleteAllFieldIndexes(e){return x.resolve()}createTargetIndexes(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(Ln.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(Ln.min())}updateCollectionGroup(e,t,s){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}}class A_{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Je(Ce.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Je(Ce.comparator)).toArray()}}const WE="IndexedDbIndexManager",gu=new Uint8Array(0);class rF{constructor(e,t){this.databaseId=t,this.vn=new A_,this.Fn=new nr((s=>Ki(s)),((s,r)=>Lc(s,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const i={collectionId:s,parent:un(r)};return zE(e).put(i)}return x.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[bA(t),""],!1,!0);return zE(e).J(r).next((i=>{for(const o of i){if(o.collectionId!==t)break;s.push(ys(o.parent))}return s}))}addFieldIndex(e,t){const s=dl(e),r=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(t);delete r.indexId;const i=s.add(r);if(t.indexState){const o=Io(e);return i.next((a=>{o.put(FE(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const s=dl(e),r=Io(e),i=Eo(e);return s.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=dl(e),s=Eo(e),r=Io(e);return t.Z().next((()=>s.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return x.forEach(this.Mn(t),(s=>this.getIndexType(e,s).next((r=>{if(r===0||r===1){const i=new GE(s).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))))}getDocumentsMatchingTarget(e,t){const s=Eo(e);let r=!0;const i=new Map;return x.forEach(this.Mn(t),(o=>this.xn(e,o).next((a=>{r&&(r=!!a),i.set(o,a)})))).next((()=>{if(r){let o=Se();const a=[];return x.forEach(i,((l,u)=>{W(WE,`Using index ${(function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map((k=>`${k.fieldPath}:${k.kind}`)).join(",")}`})(l)} to execute ${Ki(t)}`);const h=(function(N,k){const G=wp(k);if(G===void 0)return null;for(const J of wh(N,G.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null})(u,l),d=(function(N,k){const G=new Map;for(const J of yi(k))for(const w of wh(N,J.fieldPath))switch(w.op){case"==":case"in":G.set(J.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return G.set(J.fieldPath.canonicalString(),w.value),Array.from(G.values())}return null})(u,l),p=(function(N,k){const G=[];let J=!0;for(const w of yi(k)){const v=w.kind===0?bE(N,w.fieldPath,N.startAt):AE(N,w.fieldPath,N.startAt);G.push(v.value),J&&(J=v.inclusive)}return new zr(G,J)})(u,l),_=(function(N,k){const G=[];let J=!0;for(const w of yi(k)){const v=w.kind===0?AE(N,w.fieldPath,N.endAt):bE(N,w.fieldPath,N.endAt);G.push(v.value),J&&(J=v.inclusive)}return new zr(G,J)})(u,l),E=this.On(l,u,p),b=this.On(l,u,_),C=this.Nn(l,u,d),F=this.Bn(l.indexId,h,E,p.inclusive,b,_.inclusive,C);return x.forEach(F,(U=>s.Y(U,t.limit).next((N=>{N.forEach((k=>{const G=Z.fromSegments(k.documentKey);o.has(G)||(o=o.add(G),a.push(G))}))}))))})).next((()=>a))}return x.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=nF(Qe.create(e.filters,"and")).map((s=>Dp(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,s,r,i,o,a){const l=(t!=null?t.length:1)*Math.max(s.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let d=0;d<l;++d){const p=t?this.Ln(t[d/u]):gu,_=this.kn(e,p,s[d%u],r),E=this.qn(e,p,i[d%u],o),b=a.map((C=>this.kn(e,p,C,!0)));h.push(...this.createRange(_,E,b))}return h}kn(e,t,s,r){const i=new wi(e,Z.empty(),t,s);return r?i:i.An()}qn(e,t,s,r){const i=new wi(e,Z.empty(),t,s);return r?i.An():i}xn(e,t){const s=new GE(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((i=>{let o=null;for(const a of i)s.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o}))}getIndexType(e,t){let s=2;const r=this.Mn(t);return x.forEach(r,(i=>this.xn(e,i).next((o=>{o?s!==0&&o.fields.length<(function(l){let u=new Je(_t.comparator),h=!1;for(const d of l.filters)for(const p of d.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const d of l.orderBy)d.field.isKeyField()||(u=u.add(d.field));return u.size+(h?1:0)})(i)&&(s=1):s=0})))).next((()=>(function(o){return o.limit!==null})(t)&&r.length>1&&s===2?1:s))}Qn(e,t){const s=new hl;for(const r of yi(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=s.Pn(r.kind);Ti.Kt.Dt(i,o)}return s.un()}Ln(e){const t=new hl;return Ti.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new hl;return Ti.Kt.Dt(Gi(this.databaseId,t),s.Pn((function(i){const o=yi(i);return o.length===0?0:o[o.length-1].kind})(e))),s.un()}Nn(e,t,s){if(s===null)return[];let r=[];r.push(new hl);let i=0;for(const o of yi(e)){const a=s[i++];for(const l of r)if(this.Un(t,o.fieldPath)&&fc(a))r=this.Kn(r,o,a);else{const u=l.Pn(o.kind);Ti.Kt.Dt(a,u)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const a of r){const l=new hl;l.seed(a.un()),Ti.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find((s=>s instanceof xe&&s.field.isEqual(t)&&(s.op==="in"||s.op==="not-in")))}getFieldIndexes(e,t){const s=dl(e),r=Io(e);return(t?s.J(Ap,IDBKeyRange.bound(t,t)):s.J()).next((i=>{const o=[];return x.forEach(i,(a=>r.get([a.indexId,this.uid]).next((l=>{o.push((function(h,d){const p=d?new na(d.sequenceNumber,new Ln(Qi(d.readTime),new Z(ys(d.documentKey)),d.largestBatchId)):na.empty(),_=h.fields.map((([E,b])=>new xi(_t.fromServerFormat(E),b)));return new ta(h.indexId,h.collectionGroup,_,p)})(a,l))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:Ie(s.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,s){const r=dl(e),i=Io(e);return this.Gn(e).next((o=>r.J(Ap,IDBKeyRange.bound(t,t)).next((a=>x.forEach(a,(l=>i.put(FE(l.indexId,this.uid,o,s))))))))}updateIndexEntries(e,t){const s=new Map;return x.forEach(t,((r,i)=>{const o=s.get(r.collectionGroup);return(o?x.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next((a=>(s.set(r.collectionGroup,a),x.forEach(a,(l=>this.zn(e,r,l).next((u=>{const h=this.jn(i,l);return u.isEqual(h)?x.resolve():this.Jn(e,i,l,u,h)})))))))}))}Hn(e,t,s,r){return Eo(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return Eo(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=Eo(e);let i=new Je(fr);return r.ee({index:FA,range:IDBKeyRange.only([s.indexId,this.uid,ju(this.$n(s,t))])},((o,a)=>{i=i.add(new wi(s.indexId,t,jE(a.arrayValue),jE(a.directionalValue)))})).next((()=>i))}jn(e,t){let s=new Je(fr);const r=this.Qn(t,e);if(r==null)return s;const i=wp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(fc(o))for(const a of o.arrayValue.values||[])s=s.add(new wi(t.indexId,e.key,this.Ln(a),r))}else s=s.add(new wi(t.indexId,e.key,gu,r));return s}Jn(e,t,s,r,i){W(WE,"Updating index entries for document '%s'",t.key);const o=[];return(function(l,u,h,d,p){const _=l.getIterator(),E=u.getIterator();let b=yo(_),C=yo(E);for(;b||C;){let F=!1,U=!1;if(b&&C){const N=h(b,C);N<0?U=!0:N>0&&(F=!0)}else b!=null?U=!0:F=!0;F?(d(C),C=yo(E)):U?(p(b),b=yo(_)):(b=yo(_),C=yo(E))}})(r,i,fr,(a=>{o.push(this.Hn(e,t,s,a))}),(a=>{o.push(this.Yn(e,t,s,a))})),x.waitFor(o)}Gn(e){let t=1;return Io(e).ee({index:LA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((s,r,i)=>{i.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,s){s=s.sort(((o,a)=>fr(o,a))).filter(((o,a,l)=>!a||fr(o,l[a-1])!==0));const r=[];r.push(e);for(const o of s){const a=fr(o,e),l=fr(o,t);if(a===0)r[0]=e.An();else if(a>0&&l<0)r.push(o),r.push(o.An());else if(l>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Zn(r[o],r[o+1]))return[];const a=r[o].Vn(this.uid,gu,Z.empty()),l=r[o+1].Vn(this.uid,gu,Z.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return fr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(HE)}getMinOffset(e,t){return x.mapArray(this.Mn(t),(s=>this.xn(e,s).next((r=>r||he(44426))))).next(HE)}}function zE(n){return Mt(n,cc)}function Eo(n){return Mt(n,Bl)}function dl(n){return Mt(n,c_)}function Io(n){return Mt(n,Ul)}function HE(n){pe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;o_(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Ln(e.readTime,e.documentKey,t)}const QE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},WS=41943040;class nn{static withCacheSize(e){return new nn(e,nn.DEFAULT_COLLECTION_PERCENTILE,nn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}function zS(n,e,t){const s=n.store(zn),r=n.store(sa),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=s.ee({range:o},((h,d,p)=>(a++,p.delete())));i.push(l.next((()=>{pe(a===1,47070,{batchId:t.batchId})})));const u=[];for(const h of t.mutations){const d=VA(e,h.key.path,t.batchId);i.push(r.delete(d)),u.push(h.key)}return x.waitFor(i).next((()=>u))}function Rh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw he(14731);e=n.noDocument}return JSON.stringify(e).length}nn.DEFAULT_COLLECTION_PERCENTILE=10,nn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nn.DEFAULT=new nn(WS,nn.DEFAULT_COLLECTION_PERCENTILE,nn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nn.DISABLED=new nn(-1,0,0);class bd{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){pe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new bd(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pr(e).ee({index:Ri,range:s},((r,i,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,s,r){const i=Ro(e),o=pr(e);return o.add({}).next((a=>{pe(typeof a=="number",49019);const l=new v_(a,t,s,r),u=(function(_,E,b){const C=b.baseMutations.map((U=>_c(_.yt,U))),F=b.mutations.map((U=>_c(_.yt,U)));return{userId:E,batchId:b.batchId,localWriteTimeMs:b.localWriteTime.toMillis(),baseMutations:C,mutations:F}})(this.serializer,this.userId,l),h=[];let d=new Je(((p,_)=>Ie(p.canonicalString(),_.canonicalString())));for(const p of r){const _=VA(this.userId,p.key.path,a);d=d.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(_,UM))}return d.forEach((p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))})),e.addOnCommittedListener((()=>{this.Xn[a]=l.keys()})),x.waitFor(h).next((()=>l))}))}lookupMutationBatch(e,t){return pr(e).get(t).next((s=>s?(pe(s.userId===this.userId,48,"Unexpected user for mutation batch",{userId:s.userId,batchId:t}),Ii(this.serializer,s)):null))}er(e,t){return this.Xn[t]?x.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((s=>{if(s){const r=s.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return pr(e).ee({index:Ri,range:r},((o,a,l)=>{a.userId===this.userId&&(pe(a.batchId>=s,47524,{tr:s}),i=Ii(this.serializer,a)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=Ur;return pr(e).ee({index:Ri,range:t,reverse:!0},((r,i,o)=>{s=i.batchId,o.done()})).next((()=>s))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Ur],[this.userId,Number.POSITIVE_INFINITY]);return pr(e).J(Ri,t).next((s=>s.map((r=>Ii(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Mu(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return Ro(e).ee({range:r},((o,a,l)=>{const[u,h,d]=o,p=ys(h);if(u===this.userId&&t.path.isEqual(p))return pr(e).get(d).next((_=>{if(!_)throw he(61480,{nr:o,batchId:d});pe(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:d}),i.push(Ii(this.serializer,_))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Je(Ie);const r=[];return t.forEach((i=>{const o=Mu(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ro(e).ee({range:a},((u,h,d)=>{const[p,_,E]=u,b=ys(_);p===this.userId&&i.path.isEqual(b)?s=s.add(E):d.done()}));r.push(l)})),x.waitFor(r).next((()=>this.rr(e,s)))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=Mu(this.userId,s),o=IDBKeyRange.lowerBound(i);let a=new Je(Ie);return Ro(e).ee({range:o},((l,u,h)=>{const[d,p,_]=l,E=ys(p);d===this.userId&&s.isPrefixOf(E)?E.length===r&&(a=a.add(_)):h.done()})).next((()=>this.rr(e,a)))}rr(e,t){const s=[],r=[];return t.forEach((i=>{r.push(pr(e).get(i).next((o=>{if(o===null)throw he(35274,{batchId:i});pe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),s.push(Ii(this.serializer,o))})))})),x.waitFor(r).next((()=>s))}removeMutationBatch(e,t){return zS(e.le,this.userId,t).next((s=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),x.forEach(s,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return x.resolve();const s=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),r=[];return Ro(e).ee({range:s},((i,o,a)=>{if(i[0]===this.userId){const l=ys(i[1]);r.push(l)}else a.done()})).next((()=>{pe(r.length===0,56720,{sr:r.map((i=>i.canonicalString()))})}))}))}containsKey(e,t){return HS(e,this.userId,t)}_r(e){return QS(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Ur,lastStreamToken:""}))}}function HS(n,e,t){const s=Mu(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Ro(n).ee({range:i,X:!0},((a,l,u)=>{const[h,d,p]=a;h===e&&d===r&&(o=!0),u.done()})).next((()=>o))}function pr(n){return Mt(n,zn)}function Ro(n){return Mt(n,sa)}function QS(n){return Mt(n,ac)}class Yi{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Yi(0)}static cr(){return new Yi(-1)}}class iF{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const s=new Yi(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>me.fromTimestamp(new We(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,s){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>To(e).delete(t.targetId))).next((()=>this.lr(e))).next((s=>(pe(s.targetCount>0,8065),s.targetCount-=1,this.hr(e,s))))}removeTargets(e,t,s){let r=0;const i=[];return To(e).ee(((o,a)=>{const l=wl(a);l.sequenceNumber<=t&&s.get(l.targetId)===null&&(r++,i.push(this.removeTargetData(e,l)))})).next((()=>x.waitFor(i))).next((()=>r))}forEachTarget(e,t){return To(e).ee(((s,r)=>{const i=wl(r);t(i)}))}lr(e){return YE(e).get(Ih).next((t=>(pe(t!==null,2888),t)))}hr(e,t){return YE(e).put(Ih,t)}Pr(e,t){return To(e).put(jS(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const s=Ki(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return To(e).ee({range:r,index:MA},((o,a,l)=>{const u=wl(a);Lc(t,u.target)&&(i=u,l.done())})).next((()=>i))}addMatchingKeys(e,t,s){const r=[],i=Cr(e);return t.forEach((o=>{const a=un(o.path);r.push(i.put({targetId:s,path:a})),r.push(this.referenceDelegate.addReference(e,s,o))})),x.waitFor(r)}removeMatchingKeys(e,t,s){const r=Cr(e);return x.forEach(t,(i=>{const o=un(i.path);return x.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])}))}removeMatchingKeysForTargetId(e,t){const s=Cr(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Cr(e);let i=Se();return r.ee({range:s,X:!0},((o,a,l)=>{const u=ys(o[1]),h=new Z(u);i=i.add(h)})).next((()=>i))}containsKey(e,t){const s=un(t.path),r=IDBKeyRange.bound([s],[bA(s)],!1,!0);let i=0;return Cr(e).ee({index:l_,X:!0,range:r},(([o,a],l,u)=>{o!==0&&(i++,u.done())})).next((()=>i>0))}At(e,t){return To(e).get(t).next((s=>s?wl(s):null))}}function To(n){return Mt(n,ra)}function YE(n){return Mt(n,Vi)}function Cr(n){return Mt(n,ia)}const JE="LruGarbageCollector",YS=1048576;function XE([n,e],[t,s]){const r=Ie(n,t);return r===0?Ie(e,s):r}class oF{constructor(e){this.Ir=e,this.buffer=new Je(XE),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();XE(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class JS{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){W(JE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xr(t)?W(JE,"Ignoring IndexedDB error during garbage collection: ",t):await Jr(t)}await this.Vr(3e5)}))}}class aF{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return x.resolve(Tn.ce);const s=new oF(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(W("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(QE)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(W("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),QE):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((d=>(d>this.params.maximumSequenceNumbersToCollect?(W("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r)))).next((d=>(s=d,a=Date.now(),this.removeTargets(e,s,t)))).next((d=>(i=d,l=Date.now(),this.removeOrphanedDocuments(e,s)))).next((d=>(u=Date.now(),bo()<=ke.DEBUG&&W("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:d}))))}}function XS(n,e){return new aF(n,e)}class lF{constructor(e,t){this.db=e,this.garbageCollector=XS(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((s,r)=>t(r)))}addReference(e,t,s){return yu(e,s)}removeReference(e,t,s){return yu(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return yu(e,t)}br(e,t){return(function(r,i){let o=!1;return QS(r).te((a=>HS(r,a,i).next((l=>(l&&(o=!0),x.resolve(!l)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Sr(e,((o,a)=>{if(a<=t){const l=this.br(e,o).next((u=>{if(!u)return i++,s.getEntry(e,o).next((()=>(s.removeEntry(o,me.min()),Cr(e).delete((function(d){return[0,un(d.path)]})(o)))))}));r.push(l)}})).next((()=>x.waitFor(r))).next((()=>s.apply(e))).next((()=>i))}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return yu(e,t)}Sr(e,t){const s=Cr(e);let r,i=Tn.ce;return s.ee({index:l_},(([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Tn.ce&&t(new Z(ys(r)),i),i=u,r=l):i=Tn.ce})).next((()=>{i!==Tn.ce&&t(new Z(ys(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function yu(n,e){return Cr(n).put((function(s,r){return{targetId:0,path:un(s.path),sequenceNumber:r}})(e,n.currentSequenceNumber))}class ZS{constructor(){this.changes=new nr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?x.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cF{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return pi(e).put(s)}removeEntry(e,t,s){return pi(e).delete((function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ah(o),a[a.length-1]]})(t,s))}updateMetadata(e,t){return this.getMetadata(e).next((s=>(s.byteSize+=t,this.Dr(e,s))))}getEntry(e,t){let s=mt.newInvalidDocument(t);return pi(e).ee({index:Lu,range:IDBKeyRange.only(fl(t))},((r,i)=>{s=this.Cr(t,i)})).next((()=>s))}vr(e,t){let s={size:0,document:mt.newInvalidDocument(t)};return pi(e).ee({index:Lu,range:IDBKeyRange.only(fl(t))},((r,i)=>{s={document:this.Cr(t,i),size:Rh(i)}})).next((()=>s))}getEntries(e,t){let s=bn();return this.Fr(e,t,((r,i)=>{const o=this.Cr(r,i);s=s.insert(r,o)})).next((()=>s))}Mr(e,t){let s=bn(),r=new ut(Z.comparator);return this.Fr(e,t,((i,o)=>{const a=this.Cr(i,o);s=s.insert(i,a),r=r.insert(i,Rh(o))})).next((()=>({documents:s,Or:r})))}Fr(e,t,s){if(t.isEmpty())return x.resolve();let r=new Je(tI);t.forEach((l=>r=r.add(l)));const i=IDBKeyRange.bound(fl(r.first()),fl(r.last())),o=r.getIterator();let a=o.getNext();return pi(e).ee({index:Lu,range:i},((l,u,h)=>{const d=Z.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&tI(a,d)<0;)s(a,null),a=o.getNext();a&&a.isEqual(d)&&(s(a,u),a=o.hasNext()?o.getNext():null),a?h.j(fl(a)):h.done()})).next((()=>{for(;a;)s(a,null),a=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,s,r,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Ah(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return pi(e).J(IDBKeyRange.bound(a,l,!0)).next((u=>{i?.incrementDocumentReadCount(u.length);let h=bn();for(const d of u){const p=this.Cr(Z.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);p.isFoundDocument()&&(Uc(t,p)||r.has(p.key))&&(h=h.insert(p.key,p))}return h}))}getAllFromCollectionGroup(e,t,s,r){let i=bn();const o=eI(t,s),a=eI(t,Ln.max());return pi(e).ee({index:OA,range:IDBKeyRange.bound(o,a,!0)},((l,u,h)=>{const d=this.Cr(Z.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(d.key,d),i.size===r&&h.done()})).next((()=>i))}newChangeBuffer(e){return new uF(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return ZE(e).get(bp).next((t=>(pe(!!t,20021),t)))}Dr(e,t){return ZE(e).put(bp,t)}Cr(e,t){if(t){const s=QL(this.serializer,t);if(!(s.isNoDocument()&&s.version.isEqual(me.min())))return s}return mt.newInvalidDocument(e)}}function eR(n){return new cF(n)}class uF extends ZS{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new nr((s=>s.toString()),((s,r)=>s.isEqual(r)))}applyChanges(e){const t=[];let s=0,r=new Je(((i,o)=>Ie(i.canonicalString(),o.canonicalString())));return this.changes.forEach(((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=ME(this.Nr.serializer,o);r=r.add(i.path.popLast());const u=Rh(l);s+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(s-=a.size,this.trackRemovals){const l=ME(this.Nr.serializer,o.convertToNoDocument(me.min()));t.push(this.Nr.addEntry(e,i,l))}})),r.forEach((i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))})),t.push(this.Nr.updateMetadata(e,s)),x.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((s=>(this.Br.set(t,{size:s.size,readTime:s.document.readTime}),s.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:s,Or:r})=>(r.forEach(((i,o)=>{this.Br.set(i,{size:o,readTime:s.get(i).readTime})})),s)))}}function ZE(n){return Mt(n,lc)}function pi(n){return Mt(n,Eh)}function fl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function eI(n,e){const t=e.documentKey.path.toArray();return[n,Ah(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function tI(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=Ie(t[i],s[i]),r)return r;return r=Ie(t.length,s.length),r||(r=Ie(t[t.length-2],s[s.length-2]),r||Ie(t[t.length-1],s[s.length-1]))}class hF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class tR{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&jl(s.mutation,r,wn.empty(),We.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Se()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Se()){const r=vs();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=Il();return i.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=vs();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Se())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,a)=>{t.set(o,a)}))}))}computeViews(e,t,s,r){let i=bn();const o=ql(),a=(function(){return ql()})();return t.forEach(((l,u)=>{const h=s.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof sr)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),jl(h.mutation,u,h.mutation.getFieldMask(),We.now())):o.set(u.key,wn.empty())})),this.recalculateAndSaveOverlays(e,i).next((l=>(l.forEach(((u,h)=>o.set(u,h))),t.forEach(((u,h)=>a.set(u,new hF(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(e,t){const s=ql();let r=new ut(((o,a)=>o-a)),i=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=t.get(l);if(u===null)return;let h=s.get(l)||wn.empty();h=a.applyToLocalView(u,h),s.set(l,h);const d=(r.get(a.batchId)||Se()).add(l);r=r.insert(a.batchId,d)}))})).next((()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=_S();h.forEach((p=>{if(!i.has(p)){const _=wS(t.get(p),s.get(p));_!==null&&d.set(p,_),i=i.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return x.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return Z.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):m_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):x.resolve(vs());let a=ea,l=i;return o.next((u=>x.forEach(u,((h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?x.resolve():this.remoteDocumentCache.getEntry(e,h).next((p=>{l=l.insert(h,p)}))))).next((()=>this.populateOverlays(e,u,i))).next((()=>this.computeViews(e,l,u,Se()))).next((h=>({batchId:a,changes:mS(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Z(t)).next((s=>{let r=Il();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Il();return this.indexManager.getCollectionParents(e,i).next((a=>x.forEach(a,(l=>{const u=(function(d,p){return new tr(p,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)})(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next((h=>{h.forEach(((d,p)=>{o=o.insert(d,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,mt.newInvalidDocument(h)))}));let a=Il();return o.forEach(((l,u)=>{const h=i.get(l);h!==void 0&&jl(h.mutation,u,wn.empty(),We.now()),Uc(t,u)&&(a=a.insert(l,u))})),a}))}}class dF{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return x.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:St(r.createTime)}})(t)),x.resolve()}getNamedQuery(e,t){return x.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:Td(r.bundledQuery),readTime:St(r.readTime)}})(t)),x.resolve()}}class fF{constructor(){this.overlays=new ut(Z.comparator),this.qr=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){const s=vs();return x.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),x.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),x.resolve()}getOverlaysForCollection(e,t,s){const r=vs(),i=t.length+1,o=new Z(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return x.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new ut(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let h=i.get(u.largestBatchId);h===null&&(h=vs(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=vs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=r)););return x.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new I_(t,s));let i=this.qr.get(t);i===void 0&&(i=Se(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}class pF{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return x.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,x.resolve()}}class S_{constructor(){this.Qr=new Je($t.$r),this.Ur=new Je($t.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new $t(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new $t(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new Z(new Ce([])),s=new $t(t,e),r=new $t(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Z(new Ce([])),s=new $t(t,e),r=new $t(t,e+1);let i=Se();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new $t(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class $t{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Z.comparator(e.key,t.key)||Ie(e.Yr,t.Yr)}static Kr(e,t){return Ie(e.Yr,t.Yr)||Z.comparator(e.key,t.key)}}class mF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Je($t.$r)}checkEmpty(e){return x.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new v_(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new $t(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return x.resolve(o)}lookupMutationBatch(e,t){return x.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return x.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(this.mutationQueue.length===0?Ur:this.tr-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new $t(t,0),r=new $t(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const a=this.Xr(o.Yr);i.push(a)})),x.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Je(Ie);return t.forEach((r=>{const i=new $t(r,0),o=new $t(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(a=>{s=s.add(a.Yr)}))})),x.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;Z.isDocumentKey(i)||(i=i.child(""));const o=new $t(new Z(i),0);let a=new Je(Ie);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)}),o),x.resolve(this.ti(a))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){pe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return x.forEach(t.mutations,(r=>{const i=new $t(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new $t(t,0),r=this.Zr.firstAfterOrEqual(s);return x.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,x.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class _F{constructor(e){this.ri=e,this.docs=(function(){return new ut(Z.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return x.resolve(s?s.document.mutableCopy():mt.newInvalidDocument(t))}getEntries(e,t){let s=bn();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():mt.newInvalidDocument(r))})),x.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=bn();const o=t.path,a=new Z(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||o_(PA(h),s)<=0||(r.has(h.key)||Uc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return x.resolve(i)}getAllFromCollectionGroup(e,t,s,r){he(9500)}ii(e,t){return x.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new gF(this)}getSize(e){return x.resolve(this.size)}}class gF extends ZS{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),x.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class yF{constructor(e){this.persistence=e,this.si=new nr((t=>Ki(t)),Lc),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.oi=0,this._i=new S_,this.targetCount=0,this.ai=Yi.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),x.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Yi(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Pr(t),x.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),x.waitFor(i).next((()=>r))}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return x.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),x.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),x.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),x.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return x.resolve(s)}containsKey(e,t){return x.resolve(this._i.containsKey(t))}}class R_{constructor(e,t){this.ui={},this.overlays={},this.ci=new Tn(0),this.li=!1,this.li=!0,this.hi=new pF,this.referenceDelegate=e(this),this.Pi=new yF(this),this.indexManager=new sF,this.remoteDocumentCache=(function(r){return new _F(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new qS(t),this.Ii=new dF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new mF(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){W("MemoryPersistence","Starting transaction:",e);const r=new vF(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return x.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class vF extends kA{constructor(e){super(),this.currentSequenceNumber=e}}class Ad{constructor(e){this.persistence=e,this.Ri=new S_,this.Vi=null}static mi(e){return new Ad(e)}get fi(){if(this.Vi)return this.Vi;throw he(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),x.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),x.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.fi,(s=>{const r=Z.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,me.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return x.or([()=>x.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ch{constructor(e,t){this.persistence=e,this.pi=new nr((s=>un(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=XS(this,t)}static mi(e,t){return new Ch(e,t)}Ei(){}di(e){return x.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return x.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?x.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((a=>{a||(s++,i.removeEntry(o,me.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),x.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),x.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),x.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),x.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Uu(e.data.value)),t}br(e,t,s){return x.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return x.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class EF{constructor(e){this.serializer=e}k(e,t,s,r){const i=new hd("createOrUpgrade",t);s<1&&r>=1&&((function(l){l.createObjectStore(Mc)})(e),(function(l){l.createObjectStore(ac,{keyPath:FM}),l.createObjectStore(zn,{keyPath:dE,autoIncrement:!0}).createIndex(Ri,fE,{unique:!0}),l.createObjectStore(sa)})(e),nI(e),(function(l){l.createObjectStore(vi)})(e));let o=x.resolve();return s<3&&r>=3&&(s!==0&&((function(l){l.deleteObjectStore(ia),l.deleteObjectStore(ra),l.deleteObjectStore(Vi)})(e),nI(e)),o=o.next((()=>(function(l){const u=l.store(Vi),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0};return u.put(Ih,h)})(i)))),s<4&&r>=4&&(s!==0&&(o=o.next((()=>(function(l,u){return u.store(zn).J().next((d=>{l.deleteObjectStore(zn),l.createObjectStore(zn,{keyPath:dE,autoIncrement:!0}).createIndex(Ri,fE,{unique:!0});const p=u.store(zn),_=d.map((E=>p.put(E)));return x.waitFor(_)}))})(e,i)))),o=o.next((()=>{(function(l){l.createObjectStore(oa,{keyPath:zM})})(e)}))),s<5&&r>=5&&(o=o.next((()=>this.yi(i)))),s<6&&r>=6&&(o=o.next((()=>((function(l){l.createObjectStore(lc)})(e),this.wi(i))))),s<7&&r>=7&&(o=o.next((()=>this.Si(i)))),s<8&&r>=8&&(o=o.next((()=>this.bi(e,i)))),s<9&&r>=9&&(o=o.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)}))),s<10&&r>=10&&(o=o.next((()=>this.Di(i)))),s<11&&r>=11&&(o=o.next((()=>{(function(l){l.createObjectStore(dd,{keyPath:HM})})(e),(function(l){l.createObjectStore(fd,{keyPath:QM})})(e)}))),s<12&&r>=12&&(o=o.next((()=>{(function(l){const u=l.createObjectStore(pd,{keyPath:nL});u.createIndex(Sp,sL,{unique:!1}),u.createIndex(UA,rL,{unique:!1})})(e)}))),s<13&&r>=13&&(o=o.next((()=>(function(l){const u=l.createObjectStore(Eh,{keyPath:BM});u.createIndex(Lu,$M),u.createIndex(OA,qM)})(e))).next((()=>this.Ci(e,i))).next((()=>e.deleteObjectStore(vi)))),s<14&&r>=14&&(o=o.next((()=>this.Fi(e,i)))),s<15&&r>=15&&(o=o.next((()=>(function(l){l.createObjectStore(c_,{keyPath:YM,autoIncrement:!0}).createIndex(Ap,JM,{unique:!1}),l.createObjectStore(Ul,{keyPath:XM}).createIndex(LA,ZM,{unique:!1}),l.createObjectStore(Bl,{keyPath:eL}).createIndex(FA,tL,{unique:!1})})(e)))),s<16&&r>=16&&(o=o.next((()=>{t.objectStore(Ul).clear()})).next((()=>{t.objectStore(Bl).clear()}))),s<17&&r>=17&&(o=o.next((()=>{(function(l){l.createObjectStore(u_,{keyPath:iL})})(e)}))),s<18&&r>=18&&vw()&&(o=o.next((()=>{t.objectStore(Ul).clear()})).next((()=>{t.objectStore(Bl).clear()}))),o}wi(e){let t=0;return e.store(vi).ee(((s,r)=>{t+=Rh(r)})).next((()=>{const s={byteSize:t};return e.store(lc).put(bp,s)}))}yi(e){const t=e.store(ac),s=e.store(zn);return t.J().next((r=>x.forEach(r,(i=>{const o=IDBKeyRange.bound([i.userId,Ur],[i.userId,i.lastAcknowledgedBatchId]);return s.J(Ri,o).next((a=>x.forEach(a,(l=>{pe(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=Ii(this.serializer,l);return zS(e,i.userId,u).next((()=>{}))}))))}))))}Si(e){const t=e.store(ia),s=e.store(vi);return e.store(Vi).get(Ih).next((r=>{const i=[];return s.ee(((o,a)=>{const l=new Ce(o),u=(function(d){return[0,un(d)]})(l);i.push(t.get(u).next((h=>h?x.resolve():(d=>t.put({targetId:0,path:un(d),sequenceNumber:r.highestListenSequenceNumber}))(l))))})).next((()=>x.waitFor(i)))}))}bi(e,t){e.createObjectStore(cc,{keyPath:WM});const s=t.store(cc),r=new A_,i=o=>{if(r.add(o)){const a=o.lastSegment(),l=o.popLast();return s.put({collectionId:a,parent:un(l)})}};return t.store(vi).ee({X:!0},((o,a)=>{const l=new Ce(o);return i(l.popLast())})).next((()=>t.store(sa).ee({X:!0},(([o,a,l],u)=>{const h=ys(a);return i(h.popLast())}))))}Di(e){const t=e.store(ra);return t.ee(((s,r)=>{const i=wl(r),o=jS(this.serializer,i);return t.put(o)}))}Ci(e,t){const s=t.store(vi),r=[];return s.ee(((i,o)=>{const a=t.store(Eh),l=(function(d){return d.document?new Z(Ce.fromString(d.document.name).popFirst(5)):d.noDocument?Z.fromSegments(d.noDocument.path):d.unknownDocument?Z.fromSegments(d.unknownDocument.path):he(36783)})(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(u))})).next((()=>x.waitFor(r)))}Fi(e,t){const s=t.store(zn),r=eR(this.serializer),i=new R_(Ad.mi,this.serializer.yt);return s.J().next((o=>{const a=new Map;return o.forEach((l=>{let u=a.get(l.userId)??Se();Ii(this.serializer,l).keys().forEach((h=>u=u.add(h))),a.set(l.userId,u)})),x.forEach(a,((l,u)=>{const h=new qt(u),d=wd.wt(this.serializer,h),p=i.getIndexManager(h),_=bd.wt(h,this.serializer,p,i.referenceDelegate);return new tR(r,_,d,p).recalculateAndSaveOverlaysForDocumentKeys(new Rp(t,Tn.ce),l).next()}))}))}}function nI(n){n.createObjectStore(ia,{keyPath:GM}).createIndex(l_,KM,{unique:!0}),n.createObjectStore(ra,{keyPath:"targetId"}).createIndex(MA,jM,{unique:!0}),n.createObjectStore(Vi)}const mr="IndexedDbPersistence",Cf=18e5,Pf=5e3,Nf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nR="main";class C_{constructor(e,t,s,r,i,o,a,l,u,h,d=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=d,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!C_.v())throw new B(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lF(this,r),this.$i=t+nR,this.serializer=new qS(l),this.Ui=new bs(this.$i,this.Ni,new EF(this.serializer)),this.hi=new JL,this.Pi=new iF(this.referenceDelegate,this.serializer),this.remoteDocumentCache=eR(this.serializer),this.Ii=new YL,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&At(mr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,Nf);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Tn(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>vu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(Xr(e))return W(mr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return W(mr,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return pl(e).get(go).next((t=>x.resolve(this.es(t))))}ts(e){return vu(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Cf)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const s=Mt(t,oa);return s.J().next((r=>{const i=this.ss(r,Cf),o=r.filter((a=>i.indexOf(a)===-1));return x.forEach(o,(a=>s.delete(a.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?x.resolve(!0):pl(e).get(go).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Pf)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,Nf);return!1}}return!(!this.networkEnabled||!this.inForeground)||vu(e).J().next((s=>this.ss(s,Pf).find((r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(i||o&&a)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&W(mr,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Mc,oa],(e=>{const t=new Rp(e,Tn.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((s=>this.rs(s.updateTimeMs,t)&&!this.us(s.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>vu(e).J().next((t=>this.ss(t,Cf).map((s=>s.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return bd.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rF(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return wd.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){W(mr,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?lL:l===17?jA:l===16?aL:l===15?h_:l===14?qA:l===13?$A:l===12?oL:l===11?BA:void he(60245)})(this.Ni);let o;return this.Ui.runTransaction(e,r,i,(a=>(o=new Rp(a,this.ci?this.ci.next():Tn.ce),t==="readwrite-primary"?this.Hi(o).next((l=>!!l||this.Yi(o))).next((l=>{if(!l)throw At(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new B(M.FAILED_PRECONDITION,NA);return s(o)})).next((l=>this.Xi(o).next((()=>l)))):this.Is(o).next((()=>s(o)))))).then((a=>(o.raiseOnCommittedEvent(),a)))}Is(e){return pl(e).get(go).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Pf)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(M.FAILED_PRECONDITION,Nf)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return pl(e).put(go,t)}static v(){return bs.v()}Zi(e){const t=pl(e);return t.get(go).next((s=>this.es(s)?(W(mr,"Releasing primary lease."),t.delete(go)):x.resolve()))}rs(e,t){const s=Date.now();return!(e<s-t)&&(!(e>s)||(At(`Detected an update time that is in the future: ${e} > ${s}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;yw()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return W(mr,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return At(mr,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){At("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function pl(n){return Mt(n,Mc)}function vu(n){return Mt(n,oa)}function P_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class N_{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Se(),r=Se();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new N_(e,t.fromCache,s,r)}}class IF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return yw()?8:DA(Vt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new IF;return this.Ss(e,t,o).next((a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(bo()<=ke.DEBUG&&W("QueryEngine","SDK will not create cache indexes for query:",Ao(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),x.resolve()):(bo()<=ke.DEBUG&&W("QueryEngine","Query:",Ao(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(bo()<=ke.DEBUG&&W("QueryEngine","The SDK decides to create cache indexes for query:",Ao(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hn(t))):x.resolve())}ys(e,t){if(SE(t))return x.resolve(null);let s=hn(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=bh(t,null,"F"),s=hn(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=Se(...i);return this.ps.getDocuments(e,o).next((a=>this.indexManager.getMinOffset(e,s).next((l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,bh(t,null,"F")):this.vs(e,u,t,l)}))))})))))}ws(e,t,s,r){return SE(t)||r.isEqual(me.min())?x.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?x.resolve(null):(bo()<=ke.DEBUG&&W("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ao(t)),this.vs(e,o,t,CA(r,ea)).next((a=>a)))}))}Ds(e,t){let s=new Je(fS(e));return t.forEach(((r,i)=>{Uc(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return bo()<=ke.DEBUG&&W("QueryEngine","Using full collection scan to execute query:",Ao(t)),this.ps.getDocumentsMatchingQuery(e,t,Ln.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const k_="LocalStore",TF=3e8;class wF{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new ut(Ie),this.xs=new nr((i=>Ki(i)),Lc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function rR(n,e,t,s){return new wF(n,e,t,s)}async function iR(n,e){const t=ee(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],a=[];let l=Se();for(const u of r){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(s,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function bF(n,e){const t=ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const d=u.batch,p=d.keys();let _=x.resolve();return p.forEach((E=>{_=_.next((()=>h.getEntry(l,E))).next((b=>{const C=u.docVersions.get(E);pe(C!==null,48541),b.version.compareTo(C)<0&&(d.applyToRemoteDocument(b,u),b.isValidDocument()&&(b.setReadTime(u.commitVersion),h.addEntry(b)))}))})),_.next((()=>a.mutationQueue.removeMutationBatch(l,d)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(a){let l=Se();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function oR(n){const e=ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function AF(n,e){const t=ee(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach(((h,d)=>{const p=r.get(d);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,d).next((()=>t.Pi.addMatchingKeys(i,h.addedDocuments,d))));let _=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?_=_.withResumeToken(It.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,s)),r=r.insert(d,_),(function(b,C,F){return b.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=TF?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0})(p,_,h)&&a.push(t.Pi.updateTargetData(i,_))}));let l=bn(),u=Se();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))})),a.push(aR(i,o,e.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!s.isEqual(me.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next((d=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));a.push(h)}return x.waitFor(a).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,l,u))).next((()=>l))})).then((i=>(t.Ms=r,i)))}function aR(n,e,t){let s=Se(),r=Se();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=bn();return t.forEach(((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):W(k_,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:r}}))}function SF(n,e){const t=ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=Ur),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function fa(n,e){const t=ee(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,x.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new Bs(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function pa(n,e,t){const s=ee(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Xr(o))throw o;W(k_,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function Ph(n,e,t){const s=ee(n);let r=me.min(),i=Se();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const d=ee(l),p=d.xs.get(h);return p!==void 0?x.resolve(d.Ms.get(p)):d.Pi.getTargetData(u,h)})(s,o,hn(e)).next((a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{i=l}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:me.min(),t?i:Se()))).next((a=>(uR(s,dS(e),a),{documents:a,Qs:i})))))}function lR(n,e){const t=ee(n),s=ee(t.Pi),r=t.Ms.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",(i=>s.At(i,e).next((o=>o?o.target:null))))}function cR(n,e){const t=ee(n),s=t.Os.get(e)||me.min();return t.persistence.runTransaction("Get new document changes","readonly",(r=>t.Ns.getAllFromCollectionGroup(r,e,CA(s,ea),Number.MAX_SAFE_INTEGER))).then((r=>(uR(t,e,r),r)))}function uR(n,e,t){let s=n.Os.get(e)||me.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}async function RF(n,e,t,s){const r=ee(n);let i=Se(),o=bn();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const d=e.Us(u);d.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,d)}const a=r.Ns.newChangeBuffer({trackRemovals:!0}),l=await fa(r,(function(h){return hn(Pa(Ce.fromString(`__bundle__/docs/${h}`)))})(s));return r.persistence.runTransaction("Apply bundle documents","readwrite",(u=>aR(u,a,o).next((h=>(a.apply(u),h))).next((h=>r.Pi.removeMatchingKeysForTargetId(u,l.targetId).next((()=>r.Pi.addMatchingKeys(u,i,l.targetId))).next((()=>r.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs))).next((()=>h.ks))))))}async function CF(n,e,t=Se()){const s=await fa(n,hn(Td(e.bundledQuery))),r=ee(n);return r.persistence.runTransaction("Save named query","readwrite",(i=>{const o=St(e.readTime);if(s.snapshotVersion.compareTo(o)>=0)return r.Ii.saveNamedQuery(i,e);const a=s.withResumeToken(It.EMPTY_BYTE_STRING,o);return r.Ms=r.Ms.insert(a.targetId,a),r.Pi.updateTargetData(i,a).next((()=>r.Pi.removeMatchingKeysForTargetId(i,s.targetId))).next((()=>r.Pi.addMatchingKeys(i,t,s.targetId))).next((()=>r.Ii.saveNamedQuery(i,e)))}))}const hR="firestore_clients";function sI(n,e){return`${hR}_${n}_${e}`}const dR="firestore_mutations";function rI(n,e,t){let s=`${dR}_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}const fR="firestore_targets";function kf(n,e){return`${fR}_${n}_${e}`}const ms="SharedClientState";class Nh{constructor(e,t,s,r){this.user=e,this.batchId=t,this.state=s,this.error=r}static Ws(e,t,s){const r=JSON.parse(s);let i,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(i=new B(r.error.code,r.error.message))),o?new Nh(e,t,r.state,i):(At(ms,`Failed to parse mutation state for ID '${t}': ${s}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Gl{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static Ws(e,t){const s=JSON.parse(t);let r,i=typeof s=="object"&&["not-current","current","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return i&&s.error&&(i=typeof s.error.message=="string"&&typeof s.error.code=="string",i&&(r=new B(s.error.code,s.error.message))),i?new Gl(e,s.state,r):(At(ms,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const s=JSON.parse(t);let r=typeof s=="object"&&s.activeTargetIds instanceof Array,i=__();for(let o=0;r&&o<s.activeTargetIds.length;++o)r=xA(s.activeTargetIds[o]),i=i.add(s.activeTargetIds[o]);return r?new kh(e,i):(At(ms,`Failed to parse client data for instance '${e}': ${t}`),null)}}class D_{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new D_(t.clientId,t.onlineState):(At(ms,`Failed to parse online state: ${e}`),null)}}class qp{constructor(){this.activeTargetIds=__()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Df{constructor(e,t,s,r,i){this.window=e,this.Mi=t,this.persistenceKey=s,this.Js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new ut(Ie),this.started=!1,this.Xs=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=sI(this.persistenceKey,this.Js),this.no=(function(l){return`firestore_sequence_number_${l}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new qp),this.ro=new RegExp(`^${hR}_${o}_([^_]*)$`),this.io=new RegExp(`^${dR}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${fR}_${o}_(\\d+)$`),this.oo=(function(l){return`firestore_online_state_${l}`})(this.persistenceKey),this._o=(function(l){return`firestore_bundle_loaded_v2_${l}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const s of e){if(s===this.Js)continue;const r=this.getItem(sI(this.persistenceKey,s));if(r){const i=kh.Ws(s,r);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const s=this.uo(t);s&&this.co(s)}for(const s of this.Xs)this.Ys(s);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((s,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,s){this.ho(e,t,s),this.Po(e)}addLocalQueryTarget(e,t=!0){let s="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(kf(this.persistenceKey,e));if(r){const i=Gl.Ws(e,r);i&&(s=i.state)}}return t&&this.To.zs(e),this.ao(),s}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(kf(this.persistenceKey,e))}updateQueryState(e,t,s){this.Io(e,t,s)}handleUserChange(e,t,s){t.forEach((r=>{this.Po(r)})),this.currentUser=e,s.forEach((r=>{this.addPendingMutation(r)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return W(ms,"READ",e,t),t}setItem(e,t){W(ms,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){W(ms,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(W(ms,"EVENT",t.key,t.newValue),t.key===this.eo)return void At("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const s=this.Ro(t.key);return this.Vo(s,null)}{const s=this.mo(t.key,t.newValue);if(s)return this.Vo(s.clientId,s)}}else if(this.io.test(t.key)){if(t.newValue!==null){const s=this.fo(t.key,t.newValue);if(s)return this.po(s)}}else if(this.so.test(t.key)){if(t.newValue!==null){const s=this.yo(t.key,t.newValue);if(s)return this.wo(s)}}else if(t.key===this.oo){if(t.newValue!==null){const s=this.uo(t.newValue);if(s)return this.co(s)}}else if(t.key===this.no){const s=(function(i){let o=Tn.ce;if(i!=null)try{const a=JSON.parse(i);pe(typeof a=="number",30636,{So:i}),o=a}catch(a){At(ms,"Failed to read sequence number from WebStorage",a)}return o})(t.newValue);s!==Tn.ce&&this.sequenceNumberHandler(s)}else if(t.key===this._o){const s=this.bo(t.newValue);await Promise.all(s.map((r=>this.syncEngine.Do(r))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,s){const r=new Nh(this.currentUser,e,t,s),i=rI(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Gs())}Po(e){const t=rI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,s){const r=kf(this.persistenceKey,e),i=new Gl(e,t,s);this.setItem(r,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const s=this.Ro(e);return kh.Ws(s,t)}fo(e,t){const s=this.io.exec(e),r=Number(s[1]),i=s[2]!==void 0?s[2]:null;return Nh.Ws(new qt(i),r,t)}yo(e,t){const s=this.so.exec(e),r=Number(s[1]);return Gl.Ws(r,t)}uo(e){return D_.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);W(ms,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const s=t?this.Zs.insert(e,t):this.Zs.remove(e),r=this.lo(this.Zs),i=this.lo(s),o=[],a=[];return i.forEach((l=>{r.has(l)||o.push(l)})),r.forEach((l=>{i.has(l)||a.push(l)})),this.syncEngine.Fo(o,a).then((()=>{this.Zs=s}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=__();return e.forEach(((s,r)=>{t=t.unionWith(r.activeTargetIds)})),t}}class pR{constructor(){this.Mo=new qp,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new qp,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class PF{Oo(e){}shutdown(){}}const iI="ConnectivityMonitor";class oI{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){W(iI,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){W(iI,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Eu=null;function jp(){return Eu===null?Eu=(function(){return 268435456+Math.round(2147483648*Math.random())})():Eu++,"0x"+Eu.toString(16)}const xf="RestConnection",NF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kF{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===hc?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=jp(),a=this.zo(e,t.toUriEncodedString());W(xf,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),h=to(u);return this.Jo(e,a,l,s,h).then((d=>(W(xf,`Received RPC '${e}' ${o}: `,d),d)),(d=>{throw Mn(xf,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",s),d}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ca})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=NF[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class DF{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const en="WebChannelConnection";class xF extends kF{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=jp();return new Promise(((a,l)=>{const u=new _A;u.setWithCredentials(!0),u.listenOnce(gA.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case Ou.NO_ERROR:const d=u.getResponseJson();W(en,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case Ou.TIMEOUT:W(en,`RPC '${e}' ${o} timed out`),l(new B(M.DEADLINE_EXCEEDED,"Request time out"));break;case Ou.HTTP_ERROR:const p=u.getStatus();if(W(en,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);const E=_?.error;if(E&&E.status&&E.message){const b=(function(F){const U=F.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(U)>=0?U:M.UNKNOWN})(E.status);l(new B(b,E.message))}else l(new B(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(M.UNAVAILABLE,"Connection failed."));break;default:he(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{W(en,`RPC '${e}' ${o} completed.`)}}));const h=JSON.stringify(r);W(en,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",h,s,15)}))}T_(e,t,s){const r=jp(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=EA(),a=vA(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const h=i.join("");W(en,`Creating RPC '${e}' stream ${r}: ${h}`,l);const d=o.createWebChannel(h,l);this.I_(d);let p=!1,_=!1;const E=new DF({Yo:C=>{_?W(en,`Not sending because RPC '${e}' stream ${r} is closed:`,C):(p||(W(en,`Opening RPC '${e}' stream ${r} transport.`),d.open(),p=!0),W(en,`RPC '${e}' stream ${r} sending:`,C),d.send(C))},Zo:()=>d.close()}),b=(C,F,U)=>{C.listen(F,(N=>{try{U(N)}catch(k){setTimeout((()=>{throw k}),0)}}))};return b(d,El.EventType.OPEN,(()=>{_||(W(en,`RPC '${e}' stream ${r} transport opened.`),E.o_())})),b(d,El.EventType.CLOSE,(()=>{_||(_=!0,W(en,`RPC '${e}' stream ${r} transport closed`),E.a_(),this.E_(d))})),b(d,El.EventType.ERROR,(C=>{_||(_=!0,Mn(en,`RPC '${e}' stream ${r} transport errored. Name:`,C.name,"Message:",C.message),E.a_(new B(M.UNAVAILABLE,"The operation could not be completed")))})),b(d,El.EventType.MESSAGE,(C=>{if(!_){const F=C.data[0];pe(!!F,16349);const U=F,N=U?.error||U[0]?.error;if(N){W(en,`RPC '${e}' stream ${r} received error:`,N);const k=N.status;let G=(function(v){const A=Ct[v];if(A!==void 0)return RS(A)})(k),J=N.message;G===void 0&&(G=M.INTERNAL,J="Unknown error status: "+k+" with message "+N.message),_=!0,E.a_(new B(G,J)),d.close()}else W(en,`RPC '${e}' stream ${r} received:`,F),E.u_(F)}})),b(a,yA.STAT_EVENT,(C=>{C.stat===vp.PROXY?W(en,`RPC '${e}' stream ${r} detected buffering proxy`):C.stat===vp.NOPROXY&&W(en,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function mR(){return typeof window<"u"?window:null}function Gu(){return typeof document<"u"?document:null}function oo(n){return new UL(n,!0)}class x_{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&W("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const aI="PersistentStream";class _R{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new x_(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(At(t.toString()),At("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new B(M.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return W(aI,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(W(aI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class VF extends _R{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=qL(this.serializer,e),s=(function(i){if(!("targetChange"in i))return me.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?me.min():o.readTime?St(o.readTime):me.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Lp(this.serializer),t.addTarget=(function(i,o){let a;const l=o.target;if(a=Th(l)?{documents:MS(i,l)}:{query:Id(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=kS(i,o.resumeToken);const u=Op(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(me.min())>0){a.readTime=da(i,o.snapshotVersion.toTimestamp());const u=Op(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);const s=GL(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Lp(this.serializer),t.removeTarget=e,this.q_(t)}}class OF extends _R{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return pe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,pe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){pe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=jL(e.writeResults,e.commitTime),s=St(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Lp(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>_c(this.serializer,s)))};this.q_(t)}}class MF{}class LF extends MF{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,Mp(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(M.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(e,Mp(t,s),r,o,a,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(M.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class FF{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(At(t),this.aa=!1):W("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ji="RemoteStore";class UF{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{ei(this)&&(W(Ji,"Restarting streams for network reachability change."),await(async function(l){const u=ee(l);u.Ea.add(4),await Da(u),u.Ra.set("Unknown"),u.Ea.delete(4),await jc(u)})(this))}))})),this.Ra=new FF(s,r)}}async function jc(n){if(ei(n))for(const e of n.da)await e(!0)}async function Da(n){for(const e of n.da)await e(!1)}function Sd(n,e){const t=ee(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),M_(t)?O_(t):Va(t).O_()&&V_(t,e))}function ma(n,e){const t=ee(n),s=Va(t);t.Ia.delete(e),s.O_()&&gR(t,e),t.Ia.size===0&&(s.O_()?s.L_():ei(t)&&t.Ra.set("Unknown"))}function V_(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Va(n).Y_(e)}function gR(n,e){n.Va.Ue(e),Va(n).Z_(e)}function O_(n){n.Va=new OL({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Va(n).start(),n.Ra.ua()}function M_(n){return ei(n)&&!Va(n).x_()&&n.Ia.size>0}function ei(n){return ee(n).Ea.size===0}function yR(n){n.Va=void 0}async function BF(n){n.Ra.set("Online")}async function $F(n){n.Ia.forEach(((e,t)=>{V_(n,e)}))}async function qF(n,e){yR(n),M_(n)?(n.Ra.ha(e),O_(n)):n.Ra.set("Unknown")}async function jF(n,e,t){if(n.Ra.set("Online"),e instanceof NS&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))})(n,e)}catch(s){W(Ji,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Dh(n,s)}else if(e instanceof qu?n.Va.Ze(e):e instanceof PS?n.Va.st(e):n.Va.tt(e),!t.isEqual(me.min()))try{const s=await oR(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(It.EMPTY_BYTE_STRING,h.snapshotVersion)),gR(i,l);const d=new Bs(h.target,l,u,h.sequenceNumber);V_(i,d)})),i.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(s){W(Ji,"Failed to raise snapshot:",s),await Dh(n,s)}}async function Dh(n,e,t){if(!Xr(e))throw e;n.Ea.add(1),await Da(n),n.Ra.set("Offline"),t||(t=()=>oR(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{W(Ji,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await jc(n)}))}function vR(n,e){return e().catch((t=>Dh(n,t,e)))}async function xa(n){const e=ee(n),t=Hr(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ur;for(;GF(e);)try{const r=await SF(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,KF(e,r)}catch(r){await Dh(e,r)}ER(e)&&IR(e)}function GF(n){return ei(n)&&n.Ta.length<10}function KF(n,e){n.Ta.push(e);const t=Hr(n);t.O_()&&t.X_&&t.ea(e.mutations)}function ER(n){return ei(n)&&!Hr(n).x_()&&n.Ta.length>0}function IR(n){Hr(n).start()}async function WF(n){Hr(n).ra()}async function zF(n){const e=Hr(n);for(const t of n.Ta)e.ea(t.mutations)}async function HF(n,e,t){const s=n.Ta.shift(),r=E_.from(s,e,t);await vR(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await xa(n)}async function QF(n,e){e&&Hr(n).X_&&await(async function(s,r){if((function(o){return SS(o)&&o!==M.ABORTED})(r.code)){const i=s.Ta.shift();Hr(s).B_(),await vR(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await xa(s)}})(n,e),ER(n)&&IR(n)}async function lI(n,e){const t=ee(n);t.asyncQueue.verifyOperationInProgress(),W(Ji,"RemoteStore received new credentials");const s=ei(t);t.Ea.add(3),await Da(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await jc(t)}async function Gp(n,e){const t=ee(n);e?(t.Ea.delete(2),await jc(t)):e||(t.Ea.add(2),await Da(t),t.Ra.set("Unknown"))}function Va(n){return n.ma||(n.ma=(function(t,s,r){const i=ee(t);return i.sa(),new VF(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:BF.bind(null,n),t_:$F.bind(null,n),r_:qF.bind(null,n),H_:jF.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),M_(n)?O_(n):n.Ra.set("Unknown")):(await n.ma.stop(),yR(n))}))),n.ma}function Hr(n){return n.fa||(n.fa=(function(t,s,r){const i=ee(t);return i.sa(),new OF(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:WF.bind(null,n),r_:QF.bind(null,n),ta:zF.bind(null,n),na:HF.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await xa(n)):(await n.fa.stop(),n.Ta.length>0&&(W(Ji,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class L_{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Gt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new L_(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Oa(n,e){if(At("AsyncQueue",`${e}: ${n}`),Xr(n))return new B(M.UNAVAILABLE,`${e}: ${n}`);throw n}class Oi{static emptySet(e){return new Oi(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Z.comparator(t.key,s.key):(t,s)=>Z.comparator(t.key,s.key),this.keyedMap=Il(),this.sortedSet=new ut(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Oi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Oi;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class cI{constructor(){this.ga=new ut(Z.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):he(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Xi{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((a=>{o.push({type:0,doc:a})})),new Xi(e,t,Oi.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class YF{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class JF{constructor(){this.queries=uI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=ee(t),i=r.queries;r.queries=uI(),i.forEach(((o,a)=>{for(const l of a.Sa)l.onError(s)}))})(this,new B(M.ABORTED,"Firestore shutting down"))}}function uI(){return new nr((n=>hS(n)),Fc)}async function F_(n,e){const t=ee(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new YF,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=Oa(o,`Initialization of query '${Ao(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&B_(t)}async function U_(n,e){const t=ee(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function XF(n,e){const t=ee(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&B_(t)}function ZF(n,e,t){const s=ee(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function B_(n){n.Ca.forEach((e=>{e.next()}))}var Kp,hI;(hI=Kp||(Kp={})).Ma="default",hI.Cache="cache";class $_{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Xi(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Xi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Kp.Cache}}class TR{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class dI{constructor(e){this.serializer=e}$s(e){return As(this.serializer,e)}Us(e){return e.metadata.exists?Ed(this.serializer,e.document,!1):mt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return St(e)}}class q_{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=wR(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const s=Ce.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(s.get(s.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,s=new dI(this.serializer);for(const r of e)if(r.metadata.queries){const i=s.$s(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||Se()).add(i);t.set(o,a)}}return t}async ja(e){const t=await RF(e,new dI(this.serializer),this.Wa,this.Ua.id),s=this.za(this.documents);for(const r of this.Ka)await CF(e,r,s.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function wR(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class bR{constructor(e){this.key=e}}class AR{constructor(e){this.key=e}}class SR{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Se(),this.mutatedKeys=Se(),this.eu=fS(e),this.tu=new Oi(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new cI,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,d)=>{const p=r.get(h),_=Uc(this.query,d)?d:null,E=!!p&&this.mutatedKeys.has(p.key),b=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let C=!1;p&&_?p.data.isEqual(_.data)?E!==b&&(s.track({type:3,doc:_}),C=!0):this.su(p,_)||(s.track({type:2,doc:_}),C=!0,(l&&this.eu(_,l)>0||u&&this.eu(_,u)<0)&&(a=!0)):!p&&_?(s.track({type:0,doc:_}),C=!0):p&&!_&&(s.track({type:1,doc:p}),C=!0,(l||u)&&(a=!0)),C&&(_?(o=o.add(_),i=b?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((h,d)=>(function(_,E){const b=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he(20277,{Rt:C})}};return b(_)-b(E)})(h.type,d.type)||this.eu(h.doc,d.doc))),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Xi(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cI,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Se(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new AR(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new bR(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=Se();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Xi.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ti="SyncEngine";class e2{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class t2{constructor(e){this.key=e,this.hu=!1}}class n2{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new nr((a=>hS(a)),Fc),this.Iu=new Map,this.Eu=new Set,this.du=new ut(Z.comparator),this.Au=new Map,this.Ru=new S_,this.Vu={},this.mu=new Map,this.fu=Yi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function s2(n,e,t=!0){const s=Rd(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await RR(s,e,t,!0),r}async function r2(n,e){const t=Rd(n);await RR(t,e,!0,!1)}async function RR(n,e,t,s){const r=await fa(n.localStore,hn(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await j_(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&Sd(n.remoteStore,r),a}async function j_(n,e,t,s,r){n.pu=(d,p,_)=>(async function(b,C,F,U){let N=C.view.ru(F);N.Cs&&(N=await Ph(b.localStore,C.query,!1).then((({documents:w})=>C.view.ru(w,N))));const k=U&&U.targetChanges.get(C.targetId),G=U&&U.targetMismatches.get(C.targetId)!=null,J=C.view.applyChanges(N,b.isPrimaryClient,k,G);return Wp(b,C.targetId,J.au),J.snapshot})(n,d,p,_);const i=await Ph(n.localStore,e,!0),o=new SR(e,i.Qs),a=o.ru(i.documents),l=qc.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);Wp(n,t,u.au);const h=new e2(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function i2(n,e,t){const s=ee(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Fc(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await pa(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&ma(s.remoteStore,r.targetId),_a(s,r.targetId)})).catch(Jr)):(_a(s,r.targetId),await pa(s.localStore,r.targetId,!0))}async function o2(n,e){const t=ee(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),ma(t.remoteStore,s.targetId))}async function a2(n,e,t){const s=z_(n);try{const r=await(function(o,a){const l=ee(o),u=We.now(),h=a.reduce(((_,E)=>_.add(E.key)),Se());let d,p;return l.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let E=bn(),b=Se();return l.Ns.getEntries(_,h).next((C=>{E=C,E.forEach(((F,U)=>{U.isValidDocument()||(b=b.add(F))}))})).next((()=>l.localDocuments.getOverlayedDocuments(_,E))).next((C=>{d=C;const F=[];for(const U of a){const N=DL(U,d.get(U.key).overlayedDocument);N!=null&&F.push(new sr(U.key,N,eS(N.value.mapValue),vt.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,F,a)})).next((C=>{p=C;const F=C.applyToLocalDocumentSet(d,b);return l.documentOverlayCache.saveOverlays(_,C.batchId,F)}))})).then((()=>({batchId:p.batchId,changes:mS(d)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new ut(Ie)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(s,r.batchId,t),await rr(s,r.changes),await xa(s.remoteStore)}catch(r){const i=Oa(r,"Failed to persist write");t.reject(i)}}async function CR(n,e){const t=ee(n);try{const s=await AF(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(pe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?pe(o.hu,14607):r.removedDocuments.size>0&&(pe(o.hu,42227),o.hu=!1))})),await rr(t,s,e)}catch(s){await Jr(s)}}function fI(n,e,t){const s=ee(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)})),(function(o,a){const l=ee(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,d)=>{for(const p of d.Sa)p.va(a)&&(u=!0)})),u&&B_(l)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function l2(n,e,t){const s=ee(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new ut(Z.comparator);o=o.insert(i,mt.newNoDocument(i,me.min()));const a=Se().add(i),l=new $c(me.min(),new Map,new ut(Ie),o,a);await CR(s,l),s.du=s.du.remove(i),s.Au.delete(e),W_(s)}else await pa(s.localStore,e,!1).then((()=>_a(s,e,t))).catch(Jr)}async function c2(n,e){const t=ee(n),s=e.batch.batchId;try{const r=await bF(t.localStore,e);K_(t,s,null),G_(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await rr(t,r)}catch(r){await Jr(r)}}async function u2(n,e,t){const s=ee(n);try{const r=await(function(o,a){const l=ee(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((d=>(pe(d!==null,37113),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(s.localStore,e);K_(s,e,t),G_(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await rr(s,r)}catch(r){await Jr(r)}}async function h2(n,e){const t=ee(n);ei(t.remoteStore)||W(ti,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await(function(o){const a=ee(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l)))})(t.localStore);if(s===Ur)return void e.resolve();const r=t.mu.get(s)||[];r.push(e),t.mu.set(s,r)}catch(s){const r=Oa(s,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}function G_(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function K_(n,e,t){const s=ee(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function _a(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||PR(n,s)}))}function PR(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ma(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),W_(n))}function Wp(n,e,t){for(const s of t)s instanceof bR?(n.Ru.addReference(s.key,e),d2(n,s)):s instanceof AR?(W(ti,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||PR(n,s.key)):he(19791,{wu:s})}function d2(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(W(ti,"New document in limbo: "+t),n.Eu.add(s),W_(n))}function W_(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Z(Ce.fromString(e)),s=n.fu.next();n.Au.set(s,new t2(t)),n.du=n.du.insert(t,s),Sd(n.remoteStore,new Bs(hn(Pa(t.path)),s,"TargetPurposeLimboResolution",Tn.ce))}}async function rr(n,e,t){const s=ee(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((a,l)=>{o.push(s.pu(l,e,t).then((u=>{if((u||t)&&s.isPrimaryClient){const h=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=N_.As(l.targetId,u);i.push(h)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(l,u){const h=ee(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(d=>x.forEach(u,(p=>x.forEach(p.Es,(_=>h.persistence.referenceDelegate.addReference(d,p.targetId,_))).next((()=>x.forEach(p.ds,(_=>h.persistence.referenceDelegate.removeReference(d,p.targetId,_)))))))))}catch(d){if(!Xr(d))throw d;W(k_,"Failed to update sequence numbers: "+d)}for(const d of u){const p=d.targetId;if(!d.fromCache){const _=h.Ms.get(p),E=_.snapshotVersion,b=_.withLastLimboFreeSnapshotVersion(E);h.Ms=h.Ms.insert(p,b)}}})(s.localStore,i))}async function f2(n,e){const t=ee(n);if(!t.currentUser.isEqual(e)){W(ti,"User change. New user:",e.toKey());const s=await iR(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((a=>{a.forEach((l=>{l.reject(new B(M.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await rr(t,s.Ls)}}function p2(n,e){const t=ee(n),s=t.Au.get(e);if(s&&s.hu)return Se().add(s.key);{let r=Se();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}async function m2(n,e){const t=ee(n),s=await Ph(t.localStore,e.query,!0),r=e.view.cu(s);return t.isPrimaryClient&&Wp(t,e.targetId,r.au),r}async function _2(n,e){const t=ee(n);return cR(t.localStore,e).then((s=>rr(t,s)))}async function g2(n,e,t,s){const r=ee(n),i=await(function(a,l){const u=ee(a),h=ee(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",(d=>h.er(d,l).next((p=>p?u.localDocuments.getDocuments(d,p):x.resolve(null)))))})(r.localStore,e);i!==null?(t==="pending"?await xa(r.remoteStore):t==="acknowledged"||t==="rejected"?(K_(r,e,s||null),G_(r,e),(function(a,l){ee(ee(a).mutationQueue).ir(l)})(r.localStore,e)):he(6720,"Unknown batchState",{Su:t}),await rr(r,i)):W(ti,"Cannot apply mutation batch with id: "+e)}async function y2(n,e){const t=ee(n);if(Rd(t),z_(t),e===!0&&t.gu!==!0){const s=t.sharedClientState.getAllActiveQueryTargets(),r=await pI(t,s.toArray());t.gu=!0,await Gp(t.remoteStore,!0);for(const i of r)Sd(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const s=[];let r=Promise.resolve();t.Iu.forEach(((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):r=r.then((()=>(_a(t,o),pa(t.localStore,o,!0)))),ma(t.remoteStore,o)})),await r,await pI(t,s),(function(o){const a=ee(o);a.Au.forEach(((l,u)=>{ma(a.remoteStore,u)})),a.Ru.Jr(),a.Au=new Map,a.du=new ut(Z.comparator)})(t),t.gu=!1,await Gp(t.remoteStore,!1)}}async function pI(n,e,t){const s=ee(n),r=[],i=[];for(const o of e){let a;const l=s.Iu.get(o);if(l&&l.length!==0){a=await fa(s.localStore,hn(l[0]));for(const u of l){const h=s.Tu.get(u),d=await m2(s,h);d.snapshot&&i.push(d.snapshot)}}else{const u=await lR(s.localStore,o);a=await fa(s.localStore,u),await j_(s,NR(u),o,!1,a.resumeToken)}r.push(a)}return s.Pu.H_(i),r}function NR(n){return lS(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function v2(n){return(function(t){return ee(ee(t).persistence).Ts()})(ee(n).localStore)}async function E2(n,e,t,s){const r=ee(n);if(r.gu)return void W(ti,"Ignoring unexpected query state notification.");const i=r.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await cR(r.localStore,dS(i[0])),a=$c.createSynthesizedRemoteEventForCurrentChange(e,t==="current",It.EMPTY_BYTE_STRING);await rr(r,o,a);break}case"rejected":await pa(r.localStore,e,!0),_a(r,e,s);break;default:he(64155,t)}}async function I2(n,e,t){const s=Rd(n);if(s.gu){for(const r of e){if(s.Iu.has(r)&&s.sharedClientState.isActiveQueryTarget(r)){W(ti,"Adding an already active target "+r);continue}const i=await lR(s.localStore,r),o=await fa(s.localStore,i);await j_(s,NR(i),o.targetId,!1,o.resumeToken),Sd(s.remoteStore,o)}for(const r of t)s.Iu.has(r)&&await pa(s.localStore,r,!1).then((()=>{ma(s.remoteStore,r),_a(s,r)})).catch(Jr)}}function Rd(n){const e=ee(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=CR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=p2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=l2.bind(null,e),e.Pu.H_=XF.bind(null,e.eventManager),e.Pu.yu=ZF.bind(null,e.eventManager),e}function z_(n){const e=ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=c2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=u2.bind(null,e),e}function T2(n,e,t){const s=ee(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await(function(_,E){const b=ee(_),C=St(E.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",(F=>b.Ii.getBundleMetadata(F,E.id))).then((F=>!!F&&F.createTime.compareTo(C)>=0))})(i.localStore,l))return await o.close(),a._completeWith((function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}})(l)),Promise.resolve(new Set);a._updateProgress(wR(l));const u=new q_(l,o.serializer);let h=await o.bu();for(;h;){const p=await u.Ga(h);p&&a._updateProgress(p),h=await o.bu()}const d=await u.ja(i.localStore);return await rr(i,d.Ha,void 0),await(function(_,E){const b=ee(_);return b.persistence.runTransaction("Save bundle","readwrite",(C=>b.Ii.saveBundleMetadata(C,E)))})(i.localStore,l),a._completeWith(d.progress),Promise.resolve(d.Ja)}catch(l){return Mn(ti,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(s,e,t).then((r=>{s.sharedClientState.notifyBundleLoaded(r)}))}class ga{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=oo(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return rR(this.persistence,new sR,e.initialUser,this.serializer)}Cu(e){return new R_(Ad.mi,this.serializer)}Du(e){return new pR}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ga.provider={build:()=>new ga};class H_ extends ga{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){pe(this.persistence.referenceDelegate instanceof Ch,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new JS(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?nn.withCacheSize(this.cacheSizeBytes):nn.DEFAULT;return new R_((s=>Ch.mi(s,t)),this.serializer)}}class Q_ extends ga{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await z_(this.xu.syncEngine),await xa(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return rR(this.persistence,new sR,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new JS(s,e.asyncQueue,t)}Mu(e,t){const s=new MM(t,this.persistence);return new OM(e.asyncQueue,s)}Cu(e){const t=P_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=this.cacheSizeBytes!==void 0?nn.withCacheSize(this.cacheSizeBytes):nn.DEFAULT;return new C_(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,mR(),Gu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new pR}}class kR extends Q_{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Df&&(this.sharedClientState.syncEngine={Co:g2.bind(null,t),vo:E2.bind(null,t),Fo:I2.bind(null,t),Ts:v2.bind(null,t),Do:_2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async s=>{await y2(this.xu.syncEngine,s),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start():s||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(s&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():s||this.indexBackfillerScheduler.stop())}))}Du(e){const t=mR();if(!Df.v(t))throw new B(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=P_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Df(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class Qr{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>fI(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=f2.bind(null,this.syncEngine),await Gp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new JF})()}createDatastore(e){const t=oo(e.databaseInfo.databaseId),s=(function(i){return new xF(i)})(e.databaseInfo);return(function(i,o,a,l){return new LF(i,o,a,l)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,a){return new UF(s,r,i,o,a)})(this.localStore,this.datastore,e.asyncQueue,(t=>fI(this.syncEngine,t,0)),(function(){return oI.v()?new oI:new PF})())}createSyncEngine(e,t){return(function(r,i,o,a,l,u,h){const d=new n2(r,i,o,a,l,u);return h&&(d.gu=!0),d})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=ee(t);W(Ji,"RemoteStore shutting down."),s.Ea.add(5),await Da(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Qr.provider={build:()=>new Qr};function mI(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):At("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class w2{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Gt,this.buffer=new Uint8Array,this.Lu=(function(){return new TextDecoder("utf-8")})(),this.ku().then((s=>{s&&s.$a()?this.metadata.resolve(s.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(s?.Qa)}`))}),(s=>this.metadata.reject(s)))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),s=Number(t);isNaN(s)&&this.Qu(`length string (${t}) is not valid number`);const r=await this.$u(s);return new TR(JSON.parse(r),e.length+s)}Uu(){return this.buffer.findIndex((e=>e===123))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class b2{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let s=this.bu();if(!s||!s.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(s?.Qa)}`);this.metadata=s;do s=this.bu(),s!==null&&this.elements.push(s);while(s!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new TR(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new B(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}class A2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new B(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await(async function(r,i){const o=ee(r),a={documents:i.map((d=>mc(o.serializer,d)))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ce.emptyPath(),a,i.length),u=new Map;l.forEach((d=>{const p=$L(o.serializer,d);u.set(p.key.toString(),p)}));const h=[];return i.forEach((d=>{const p=u.get(d.toString());pe(!!p,55234,{key:d}),h.push(p)})),h})(this.datastore,e);return t.forEach((s=>this.recordVersion(s))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new ka(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((t,s)=>{const r=Z.fromPath(s);this.mutations.push(new y_(r,this.precondition(r)))})),await(async function(s,r){const i=ee(s),o={writes:r.map((a=>_c(i.serializer,a)))};await i.Go("Commit",i.serializer.databaseId,Ce.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw he(50498,{Gu:e.constructor.name});t=me.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new B(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(me.min())?vt.exists(!1):vt.updateTime(t):vt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(me.min()))throw new B(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vt.updateTime(t)}return vt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class S2{constructor(e,t,s,r,i){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=i,this.zu=s.maxAttempts,this.M_=new x_(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new A2(this.datastore),t=this.Hu(e);t&&t.then((s=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(s)})).catch((r=>{this.Yu(r)}))))})).catch((s=>{this.Yu(s)}))}))}Hu(e){try{const t=this.updateFunction(e);return!Oc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!SS(t)}return!1}}const Yr="FirestoreClient";class R2{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=qt.UNAUTHENTICATED,this.clientId=cd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{W(Yr,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(W(Yr,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Oa(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function Vf(n,e){n.asyncQueue.verifyOperationInProgress(),W(Yr,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await iR(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function _I(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Y_(n);W(Yr,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>lI(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>lI(e.remoteStore,r))),n._onlineComponents=e}async function Y_(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){W(Yr,"Using user provided OfflineComponentProvider");try{await Vf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===M.FAILED_PRECONDITION||r.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Mn("Error using user provided cache. Falling back to memory cache: "+t),await Vf(n,new ga)}}else W(Yr,"Using default OfflineComponentProvider"),await Vf(n,new H_(void 0));return n._offlineComponents}async function Pd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(W(Yr,"Using user provided OnlineComponentProvider"),await _I(n,n._uninitializedComponentsProvider._online)):(W(Yr,"Using default OnlineComponentProvider"),await _I(n,new Qr))),n._onlineComponents}function DR(n){return Y_(n).then((e=>e.persistence))}function Ma(n){return Y_(n).then((e=>e.localStore))}function xR(n){return Pd(n).then((e=>e.remoteStore))}function J_(n){return Pd(n).then((e=>e.syncEngine))}function VR(n){return Pd(n).then((e=>e.datastore))}async function ya(n){const e=await Pd(n),t=e.eventManager;return t.onListen=s2.bind(null,e.syncEngine),t.onUnlisten=i2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=r2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=o2.bind(null,e.syncEngine),t}function C2(n){return n.asyncQueue.enqueue((async()=>{const e=await DR(n),t=await xR(n);return e.setNetworkEnabled(!0),(function(r){const i=ee(r);return i.Ea.delete(0),jc(i)})(t)}))}function P2(n){return n.asyncQueue.enqueue((async()=>{const e=await DR(n),t=await xR(n);return e.setNetworkEnabled(!1),(async function(r){const i=ee(r);i.Ea.add(0),await Da(i),i.Ra.set("Offline")})(t)}))}function N2(n,e){const t=new Gt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await(function(u,h){const d=ee(u);return d.persistence.runTransaction("read document","readonly",(p=>d.localDocuments.getDocument(p,h)))})(r,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new B(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Oa(a,`Failed to get document '${i} from cache`);o.reject(l)}})(await Ma(n),e,t))),t.promise}function OR(n,e,t={}){const s=new Gt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new Cd({next:p=>{h.Nu(),o.enqueueAndForget((()=>U_(i,d)));const _=p.docs.has(a);!_&&p.fromCache?u.reject(new B(M.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&p.fromCache&&l&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new $_(Pa(a.path),h,{includeMetadataChanges:!0,qa:!0});return F_(i,d)})(await ya(n),n.asyncQueue,e,t,s))),s.promise}function k2(n,e){const t=new Gt;return n.asyncQueue.enqueueAndForget((async()=>(async function(r,i,o){try{const a=await Ph(r,i,!0),l=new SR(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=Oa(a,`Failed to execute query '${i} against cache`);o.reject(l)}})(await Ma(n),e,t))),t.promise}function MR(n,e,t={}){const s=new Gt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,a,l,u){const h=new Cd({next:p=>{h.Nu(),o.enqueueAndForget((()=>U_(i,d))),p.fromCache&&l.source==="server"?u.reject(new B(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new $_(a,h,{includeMetadataChanges:!0,qa:!0});return F_(i,d)})(await ya(n),n.asyncQueue,e,t,s))),s.promise}function D2(n,e,t){const s=new Gt;return n.asyncQueue.enqueueAndForget((async()=>{try{const r=await VR(n);s.resolve((async function(o,a,l){const u=ee(o),{request:h,gt:d,parent:p}=LS(u.serializer,cS(a),l);u.connection.$o||delete h.parent;const _=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,p,h,1)).filter((b=>!!b.result));pe(_.length===1,64727);const E=_[0].result?.aggregateFields;return Object.keys(E).reduce(((b,C)=>(b[d[C]]=E[C],b)),{})})(r,e,t))}catch(r){s.reject(r)}})),s.promise}function x2(n,e){const t=new Cd(e);return n.asyncQueue.enqueueAndForget((async()=>(function(r,i){ee(r).Ca.add(i),i.next()})(await ya(n),t))),()=>{t.Nu(),n.asyncQueue.enqueueAndForget((async()=>(function(r,i){ee(r).Ca.delete(i)})(await ya(n),t)))}}function V2(n,e,t,s){const r=(function(o,a){let l;return l=typeof o=="string"?CS().encode(o):o,(function(h,d){return new w2(h,d)})((function(h,d){if(h instanceof Uint8Array)return mI(h,d);if(h instanceof ArrayBuffer)return mI(new Uint8Array(h),d);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(l),a)})(t,oo(e));n.asyncQueue.enqueueAndForget((async()=>{T2(await J_(n),r,s)}))}function O2(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){const i=ee(s);return i.persistence.runTransaction("Get named query","readonly",(o=>i.Ii.getNamedQuery(o,r)))})(await Ma(n),e)))}function LR(n,e){return(function(s,r){return new b2(s,r)})(n,e)}function M2(n,e){return n.asyncQueue.enqueue((async()=>(async function(s,r){const i=ee(s),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",(l=>o.getFieldIndexes(l).next((u=>(function(d,p,_,E,b){d=[...d],p=[...p],d.sort(_),p.sort(_);const C=d.length,F=p.length;let U=0,N=0;for(;U<F&&N<C;){const k=_(d[N],p[U]);k<0?b(d[N++]):k>0?E(p[U++]):(U++,N++)}for(;U<F;)E(p[U++]);for(;N<C;)b(d[N++])})(u,r,kM,(h=>{a.push(o.addFieldIndex(l,h))}),(h=>{a.push(o.deleteFieldIndex(l,h))})))).next((()=>x.waitFor(a)))))})(await Ma(n),e)))}function L2(n,e){return n.asyncQueue.enqueue((async()=>(function(s,r){ee(s).Fs.Vs=r})(await Ma(n),e)))}function F2(n){return n.asyncQueue.enqueue((async()=>(function(t){const s=ee(t),r=s.indexManager;return s.persistence.runTransaction("Delete All Indexes","readwrite",(i=>r.deleteAllFieldIndexes(i)))})(await Ma(n))))}function FR(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const gI=new Map;const UR="firestore.googleapis.com",yI=!0;class vI{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=UR,this.ssl=yI}else this.host=e.host,this.ssl=e.ssl??yI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=WS;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YS)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}AA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FR(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gc{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vI(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new wA;switch(s.type){case"firstParty":return new bM(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new B(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=gI.get(t);s&&(W("ComponentProvider","Removing Datastore"),gI.delete(t),s.terminate())})(this),Promise.resolve()}}function BR(n,e,t,s={}){n=Pe(n,Gc);const r=to(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(bm(`https://${a}`),mw("Firestore",!0)),i.host!==UR&&i.host!==a&&Mn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!os(l,o)&&(n._setSettings(l),s.mockUserToken)){let u,h;if(typeof s.mockUserToken=="string")u=s.mockUserToken,h=qt.MOCK_USER;else{u=sN(s.mockUserToken,n._app?.options.projectId);const d=s.mockUserToken.sub||s.mockUserToken.user_id;if(!d)throw new B(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new qt(d)}n._authCredentials=new IM(new TA(u,h))}}class Ot{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Ot(this.firestore,e,this._query)}}class Ye{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ns(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ye(this.firestore,e,this._key)}toJSON(){return{type:Ye._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(io(t,Ye._jsonSchema))return new Ye(e,s||null,new Z(Ce.fromString(t.referencePath)))}}Ye._jsonSchemaVersion="firestore/documentReference/1.0",Ye._jsonSchema={type:Pt("string",Ye._jsonSchemaVersion),referencePath:Pt("string")};class ns extends Ot{constructor(e,t,s){super(e,t,Pa(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ye(this.firestore,null,new Z(e))}withConverter(e){return new ns(this.firestore,e,this._path)}}function U2(n,e,...t){if(n=et(n),i_("collection","path",e),n instanceof Gc){const s=Ce.fromString(e,...t);return aE(s),new ns(n,null,s)}{if(!(n instanceof Ye||n instanceof ns))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ce.fromString(e,...t));return aE(s),new ns(n.firestore,null,s)}}function B2(n,e){if(n=Pe(n,Gc),i_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ot(n,null,(function(s){return new tr(Ce.emptyPath(),s)})(e))}function X_(n,e,...t){if(n=et(n),arguments.length===1&&(e=cd.newId()),i_("doc","path",e),n instanceof Gc){const s=Ce.fromString(e,...t);return oE(s),new Ye(n,null,new Z(s))}{if(!(n instanceof Ye||n instanceof ns))throw new B(M.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Ce.fromString(e,...t));return oE(s),new Ye(n.firestore,n instanceof ns?n.converter:null,new Z(s))}}function $2(n,e){return n=et(n),e=et(e),(n instanceof Ye||n instanceof ns)&&(e instanceof Ye||e instanceof ns)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Z_(n,e){return n=et(n),e=et(e),n instanceof Ot&&e instanceof Ot&&n.firestore===e.firestore&&Fc(n._query,e._query)&&n.converter===e.converter}const EI="AsyncQueue";class II{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new x_(this,"async_queue_retry"),this._c=()=>{const s=Gu();s&&W(EI,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=Gu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Gu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Gt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Xr(e))throw e;W(EI,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,At("INTERNAL UNHANDLED ERROR: ",TI(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=L_.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&he(47125,{Pc:TI(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function TI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function qo(n){return(function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1})(n,["next","error","complete"])}class $R{constructor(){this._progressObserver={},this._taskCompletionResolver=new Gt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,s){this._progressObserver={next:e,error:t,complete:s}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const q2=-1;class tt extends Gc{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new II,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new II(e),this._firestoreClient=void 0,await e}}}function j2(n,e,t){t||(t=hc);const s=Sc(n,"firestore");if(s.isInitialized(t)){const r=s.getImmediate({identifier:t}),i=s.getOptions(t);if(os(i,e))return r;throw new B(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<YS)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&to(e.host)&&bm(e.host),s.initialize({options:e,instanceIdentifier:t})}function G2(n,e){const t=typeof n=="object"?n:Aw(),s=typeof n=="string"?n:e||hc,r=Sc(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=nN("firestore");i&&BR(r,...i)}return r}function Et(n){if(n._terminated)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||qR(n),n._firestoreClient}function qR(n){const e=n._freezeSettings(),t=(function(r,i,o,a){return new hL(r,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,FR(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new R2(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}function K2(n,e){Mn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return jR(n,Qr.provider,{build:s=>new Q_(s,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function W2(n){Mn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();jR(n,Qr.provider,{build:t=>new kR(t,e.cacheSizeBytes)})}function jR(n,e,t){if((n=Pe(n,tt))._firestoreClient||n._terminated)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new B(M.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},qR(n)}function z2(n){if(n._initialized&&!n._terminated)throw new B(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Gt;return n._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await(async function(s){if(!bs.v())return Promise.resolve();const r=s+nR;await bs.delete(r)})(P_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function H2(n){return(function(t){const s=new Gt;return t.asyncQueue.enqueueAndForget((async()=>h2(await J_(t),s))),s.promise})(Et(n=Pe(n,tt)))}function Q2(n){return C2(Et(n=Pe(n,tt)))}function Y2(n){return P2(Et(n=Pe(n,tt)))}function J2(n){return yk(n.app,"firestore",n._databaseId.database),n._delete()}function zp(n,e){const t=Et(n=Pe(n,tt)),s=new $R;return V2(t,n._databaseId,e,s),s}function GR(n,e){return O2(Et(n=Pe(n,tt)),e).then((t=>t?new Ot(n,null,t.query):null))}class va{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class KR{constructor(e,t,s){this._userDataWriter=t,this._data=s,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class In{constructor(e){this._byteString=e}static fromBase64String(e){try{return new In(It.fromBase64String(e))}catch(t){throw new B(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new In(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:In._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(io(e,In._jsonSchema))return In.fromBase64String(e.bytes)}}In._jsonSchemaVersion="firestore/bytes/1.0",In._jsonSchema={type:Pt("string",In._jsonSchemaVersion),bytes:Pt("string")};class ni{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function X2(){return new ni(Tp)}class si{constructor(e){this._methodName=e}}class ss{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ie(this._lat,e._lat)||Ie(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ss._jsonSchemaVersion}}static fromJSON(e){if(io(e,ss._jsonSchema))return new ss(e.latitude,e.longitude)}}ss._jsonSchemaVersion="firestore/geoPoint/1.0",ss._jsonSchema={type:Pt("string",ss._jsonSchemaVersion),latitude:Pt("number"),longitude:Pt("number")};class qn{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(io(e,qn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new qn(e.vectorValues);throw new B(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qn._jsonSchemaVersion="firestore/vectorValue/1.0",qn._jsonSchema={type:Pt("string",qn._jsonSchemaVersion),vectorValues:Pt("object")};const Z2=/^__.*__$/;class eU{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new sr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Na(e,this.data,t,this.fieldTransforms)}}class WR{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new sr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zR(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he(40011,{Ac:n})}}class Nd{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Nd({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return xh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(zR(this.Ac)&&Z2.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class tU{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||oo(e)}Cc(e,t,s,r=!1){return new Nd({Ac:e,methodName:t,Dc:s,path:_t.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ao(n){const e=n._freezeSettings(),t=oo(n._databaseId);return new tU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function kd(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);og("Data must be an object, but it was:",o,s);const a=YR(s,o);let l,u;if(i.merge)l=new wn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const p=gc(e,d,t);if(!o.contains(p))throw new B(M.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);XR(h,p)||h.push(p)}l=new wn(h),u=o.fieldTransforms.filter((d=>l.covers(d.field)))}else l=null,u=o.fieldTransforms;return new eU(new Qt(a),l,u)}class Kc extends si{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Kc}}function HR(n,e,t){return new Nd({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class eg extends si{_toFieldTransform(e){return new Bc(e.path,new ua)}isEqual(e){return e instanceof eg}}class tg extends si{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=HR(this,e,!0),s=this.vc.map((i=>lo(i,t))),r=new Wi(s);return new Bc(e.path,r)}isEqual(e){return e instanceof tg&&os(this.vc,e.vc)}}class ng extends si{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=HR(this,e,!0),s=this.vc.map((i=>lo(i,t))),r=new zi(s);return new Bc(e.path,r)}isEqual(e){return e instanceof ng&&os(this.vc,e.vc)}}class sg extends si{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new ha(e.serializer,yS(e.serializer,this.Fc));return new Bc(e.path,t)}isEqual(e){return e instanceof sg&&this.Fc===e.Fc}}function rg(n,e,t,s){const r=n.Cc(1,e,t);og("Data must be an object, but it was:",r,s);const i=[],o=Qt.empty();Zr(s,((l,u)=>{const h=Dd(e,l,t);u=et(u);const d=r.yc(h);if(u instanceof Kc)i.push(h);else{const p=lo(u,d);p!=null&&(i.push(h),o.set(h,p))}}));const a=new wn(i);return new WR(o,a,r.fieldTransforms)}function ig(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[gc(e,s,t)],l=[r];if(i.length%2!=0)throw new B(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(gc(e,i[p])),l.push(i[p+1]);const u=[],h=Qt.empty();for(let p=a.length-1;p>=0;--p)if(!XR(u,a[p])){const _=a[p];let E=l[p];E=et(E);const b=o.yc(_);if(E instanceof Kc)u.push(_);else{const C=lo(E,b);C!=null&&(u.push(_),h.set(_,C))}}const d=new wn(u);return new WR(h,d,o.fieldTransforms)}function QR(n,e,t,s=!1){return lo(t,n.Cc(s?4:3,e))}function lo(n,e){if(JR(n=et(n)))return og("Unsupported field value:",e,n),YR(n,e);if(n instanceof si)return(function(s,r){if(!zR(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const a of s){let l=lo(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=et(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return yS(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=We.fromDate(s);return{timestampValue:da(r.serializer,i)}}if(s instanceof We){const i=new We(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:da(r.serializer,i)}}if(s instanceof ss)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof In)return{bytesValue:kS(r.serializer,s._byteString)};if(s instanceof Ye){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:w_(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof qn)return(function(o,a){return{mapValue:{fields:{[d_]:{stringValue:f_},[aa]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return g_(a.serializer,u)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${ud(s)}`)})(n,e)}function YR(n,e){const t={};return KA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zr(n,((s,r)=>{const i=lo(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function JR(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof We||n instanceof ss||n instanceof In||n instanceof Ye||n instanceof si||n instanceof qn)}function og(n,e,t){if(!JR(t)||!SA(t)){const s=ud(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function gc(n,e,t){if((e=et(e))instanceof ni)return e._internalPath;if(typeof e=="string")return Dd(n,e);throw xh("Field path arguments must be of type string or ",n,!1,void 0,t)}const nU=new RegExp("[~\\*/\\[\\]]");function Dd(n,e,t){if(e.search(nU)>=0)throw xh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ni(...e.split("."))._internalPath}catch{throw xh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xh(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new B(M.INVALID_ARGUMENT,a+n+l)}function XR(n,e){return n.some((t=>t.isEqual(e)))}class yc{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new sU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class sU extends yc{data(){return super.data()}}function xd(n,e){return typeof e=="string"?Dd(n,e):e instanceof ni?e._internalPath:e._delegate._internalPath}function ZR(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ag{}class La extends ag{}function rU(n,e,...t){let s=[];e instanceof ag&&s.push(e),s=s.concat(t),(function(i){const o=i.filter((l=>l instanceof co)).length,a=i.filter((l=>l instanceof Fa)).length;if(o>1||o>0&&a>0)throw new B(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class Fa extends La{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Fa(e,t,s)}_apply(e){const t=this._parse(e);return tC(e._query,t),new Ot(e.firestore,e.converter,xp(e._query,t))}_parse(e){const t=ao(e.firestore);return(function(i,o,a,l,u,h,d){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){bI(d,h);const E=[];for(const b of d)E.push(wI(l,i,b));p={arrayValue:{values:E}}}else p=wI(l,i,d)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||bI(d,h),p=QR(a,o,d,h==="in"||h==="not-in");return xe.create(u,h,p)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function iU(n,e,t){const s=e,r=xd("where",n);return Fa._create(r,s,t)}class co extends ag{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new co(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Qe.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)tC(o,l),o=xp(o,l)})(e._query,t),new Ot(e.firestore,e.converter,xp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function oU(...n){return n.forEach((e=>nC("or",e))),co._create("or",n)}function aU(...n){return n.forEach((e=>nC("and",e))),co._create("and",n)}class Vd extends La{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Vd(e,t)}_apply(e){const t=(function(r,i,o){if(r.startAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pc(i,o)})(e._query,this._field,this._direction);return new Ot(e.firestore,e.converter,(function(r,i){const o=r.explicitOrderBy.concat([i]);return new tr(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function lU(n,e="asc"){const t=e,s=xd("orderBy",n);return Vd._create(s,t)}class Wc extends La{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Wc(e,t,s)}_apply(e){return new Ot(e.firestore,e.converter,bh(e._query,this._limit,this._limitType))}}function cU(n){return RA("limit",n),Wc._create("limit",n,"F")}function uU(n){return RA("limitToLast",n),Wc._create("limitToLast",n,"L")}class zc extends La{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new zc(e,t,s)}_apply(e){const t=eC(e,this.type,this._docOrFields,this._inclusive);return new Ot(e.firestore,e.converter,(function(r,i){return new tr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)})(e._query,t))}}function hU(...n){return zc._create("startAt",n,!0)}function dU(...n){return zc._create("startAfter",n,!1)}class Hc extends La{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new Hc(e,t,s)}_apply(e){const t=eC(e,this.type,this._docOrFields,this._inclusive);return new Ot(e.firestore,e.converter,(function(r,i){return new tr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)})(e._query,t))}}function fU(...n){return Hc._create("endBefore",n,!1)}function pU(...n){return Hc._create("endAt",n,!0)}function eC(n,e,t,s){if(t[0]=et(t[0]),t[0]instanceof yc)return(function(i,o,a,l,u){if(!l)throw new B(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const d of $o(i))if(d.field.isKeyField())h.push(Gi(o,l.key));else{const p=l.data.field(d.field);if(md(p))throw new B(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const _=d.field.canonicalString();throw new B(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(p)}return new zr(h,u)})(n._query,n.firestore._databaseId,e,t[0]._document,s);{const r=ao(n.firestore);return(function(o,a,l,u,h,d){const p=o.explicitOrderBy;if(h.length>p.length)throw new B(M.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let E=0;E<h.length;E++){const b=h[E];if(p[E].field.isKeyField()){if(typeof b!="string")throw new B(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof b}`);if(!m_(o)&&b.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${b}' contains a slash.`);const C=o.path.child(Ce.fromString(b));if(!Z.isDocumentKey(C))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const F=new Z(C);_.push(Gi(a,F))}else{const C=QR(l,u,b);_.push(C)}}return new zr(_,d)})(n._query,n.firestore._databaseId,r,e,t,s)}}function wI(n,e,t){if(typeof(t=et(t))=="string"){if(t==="")throw new B(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!m_(e)&&t.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Ce.fromString(t));if(!Z.isDocumentKey(s))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Gi(n,new Z(s))}if(t instanceof Ye)return Gi(n,t._key);throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ud(t)}.`)}function bI(n,e){if(!Array.isArray(n)||n.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tC(n,e){const t=(function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function nC(n,e){if(!(e instanceof Fa||e instanceof co))throw new B(M.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class lg{convertValue(e,t="none"){switch(Kr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Js(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw he(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Zr(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[aa].arrayValue?.values?.map((s=>yt(s.doubleValue)));return new qn(t)}convertGeoPoint(e){return new ss(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=_d(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(uc(e));default:return null}}convertTimestamp(e){const t=Ys(e);return new We(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Ce.fromString(e);pe($S(s),9688,{name:e});const r=new Gr(s.get(1),s.get(3)),i=new Z(s.popFirst(5));return r.isEqual(t)||At(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Od(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class cg extends lg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ye(this.firestore,null,t)}}function mU(n){return new va("sum",gc("sum",n))}function _U(n){return new va("avg",gc("average",n))}function sC(){return new va("count")}function gU(n,e){return n instanceof va&&e instanceof va&&n.aggregateType===e.aggregateType&&n._internalFieldPath?.canonicalString()===e._internalFieldPath?.canonicalString()}function yU(n,e){return Z_(n.query,e.query)&&os(n.data(),e.data())}const rC="NOT SUPPORTED";class $s{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class An extends yc{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Kl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(xd("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=An._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function vU(n,e,t){if(io(e,An._jsonSchema)){if(e.bundle===rC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=oo(n._databaseId),r=LR(e.bundle,s),i=r.Wu(),o=new q_(r.getMetadata(),s);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new B(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Ed(s,a[0].document),u=new Z(Ce.fromString(e.bundleName));return new An(n,new cg(n),u,l,new $s(!1,!1),t||null)}}An._jsonSchemaVersion="firestore/documentSnapshot/1.0",An._jsonSchema={type:Pt("string",An._jsonSchemaVersion),bundleSource:Pt("string","DocumentSnapshot"),bundleName:Pt("string"),bundle:Pt("string")};class Kl extends An{data(e={}){return super.data(e)}}class Sn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new $s(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Kl(this._firestore,this._userDataWriter,s.key,s,new $s(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((a=>{const l=new Kl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new $s(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((a=>i||a.type!==3)).map((a=>{const l=new Kl(r._firestore,r._userDataWriter,a.doc.key,a.doc,new $s(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:IU(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Sn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=cd.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function EU(n,e,t){if(io(e,Sn._jsonSchema)){if(e.bundle===rC)throw new B(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const s=oo(n._databaseId),r=LR(e.bundle,s),i=r.Wu(),o=new q_(r.getMetadata(),s);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new B(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Td(o.queries[0].bundledQuery),l=o.documents;let u=new Oi;l.map((p=>{const _=Ed(s,p.document);u=u.add(_)}));const h=Xi.fromInitialDocuments(a,u,Se(),!1,!1),d=new Ot(n,t||null,a);return new Sn(n,new cg(n),d,h)}}function IU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he(61501,{type:n})}}function TU(n,e){return n instanceof An&&e instanceof An?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Sn&&e instanceof Sn&&n._firestore===e._firestore&&Z_(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function iC(n){n=Pe(n,Ye);const e=Pe(n.firestore,tt);return OR(Et(e),n._key).then((t=>ug(e,n,t)))}Sn._jsonSchemaVersion="firestore/querySnapshot/1.0",Sn._jsonSchema={type:Pt("string",Sn._jsonSchemaVersion),bundleSource:Pt("string","QuerySnapshot"),bundleName:Pt("string"),bundle:Pt("string")};class ri extends lg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ye(this.firestore,null,t)}}function wU(n){n=Pe(n,Ye);const e=Pe(n.firestore,tt),t=Et(e),s=new ri(e);return N2(t,n._key).then((r=>new An(e,s,n._key,r,new $s(r!==null&&r.hasLocalMutations,!0),n.converter)))}function bU(n){n=Pe(n,Ye);const e=Pe(n.firestore,tt);return OR(Et(e),n._key,{source:"server"}).then((t=>ug(e,n,t)))}function AU(n){n=Pe(n,Ot);const e=Pe(n.firestore,tt),t=Et(e),s=new ri(e);return ZR(n._query),MR(t,n._query).then((r=>new Sn(e,s,n,r)))}function SU(n){n=Pe(n,Ot);const e=Pe(n.firestore,tt),t=Et(e),s=new ri(e);return k2(t,n._query).then((r=>new Sn(e,s,n,r)))}function RU(n){n=Pe(n,Ot);const e=Pe(n.firestore,tt),t=Et(e),s=new ri(e);return MR(t,n._query,{source:"server"}).then((r=>new Sn(e,s,n,r)))}function CU(n,e,t){n=Pe(n,Ye);const s=Pe(n.firestore,tt),r=Od(n.converter,e,t);return Ua(s,[kd(ao(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,vt.none())])}function PU(n,e,t,...s){n=Pe(n,Ye);const r=Pe(n.firestore,tt),i=ao(r);let o;return o=typeof(e=et(e))=="string"||e instanceof ni?ig(i,"updateDoc",n._key,e,t,s):rg(i,"updateDoc",n._key,e),Ua(r,[o.toMutation(n._key,vt.exists(!0))])}function oC(n){return Ua(Pe(n.firestore,tt),[new ka(n._key,vt.none())])}function NU(n,e){const t=Pe(n.firestore,tt),s=X_(n),r=Od(n.converter,e);return Ua(t,[kd(ao(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,vt.exists(!1))]).then((()=>s))}function Hp(n,...e){n=et(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||qo(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(qo(e[s])){const l=e[s];e[s]=l.next?.bind(l),e[s+1]=l.error?.bind(l),e[s+2]=l.complete?.bind(l)}let i,o,a;if(n instanceof Ye)o=Pe(n.firestore,tt),a=Pa(n._key.path),i={next:l=>{e[s]&&e[s](ug(o,n,l))},error:e[s+1],complete:e[s+2]};else{const l=Pe(n,Ot);o=Pe(l.firestore,tt),a=l._query;const u=new ri(o);i={next:h=>{e[s]&&e[s](new Sn(o,u,l,h))},error:e[s+1],complete:e[s+2]},ZR(n._query)}return(function(u,h,d,p){const _=new Cd(p),E=new $_(h,_,d);return u.asyncQueue.enqueueAndForget((async()=>F_(await ya(u),E))),()=>{_.Nu(),u.asyncQueue.enqueueAndForget((async()=>U_(await ya(u),E)))}})(Et(o),a,r,i)}function kU(n,e,...t){const s=et(n),r=(function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const d of h){if(!(d in l)){u.error=`snapshotJson missing required field: ${d}`;break}const p=l[d];if(typeof p!="string"){u.error=`snapshotJson field '${d}' must be a string.`;break}if(p.length===0){u.error=`snapshotJson field '${d}' cannot be an empty string.`;break}d==="bundle"?u.bundle=p:d==="bundleName"?u.bundleName=p:d==="bundleSource"&&(u.bundleSource=p)}return u})(e);if(r.error)throw new B(M.INVALID_ARGUMENT,r.error);let i,o=0;if(typeof t[o]!="object"||qo(t[o])||(i=t[o++]),r.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,p,_){let E,b=!1;return zp(u,h.bundle).then((()=>GR(u,h.bundleName))).then((F=>{F&&!b&&(_&&F.withConverter(_),E=Hp(F,d||{},p))})).catch((F=>(p.error&&p.error(F),()=>{}))),()=>{b||(b=!0,E&&E())}})(s,r,i,a,t[o])}if(r.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&qo(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return(function(u,h,d,p,_){let E,b=!1;return zp(u,h.bundle).then((()=>{if(!b){const F=new Ye(u,_||null,Z.fromPath(h.bundleName));E=Hp(F,d||{},p)}})).catch((F=>(p.error&&p.error(F),()=>{}))),()=>{b||(b=!0,E&&E())}})(s,r,i,a,t[o])}throw new B(M.INVALID_ARGUMENT,`unsupported bundle source: ${r.bundleSource}`)}function DU(n,e){return x2(Et(n=Pe(n,tt)),qo(e)?e:{next:e})}function Ua(n,e){return(function(s,r){const i=new Gt;return s.asyncQueue.enqueueAndForget((async()=>a2(await J_(s),r,i))),i.promise})(Et(n),e)}function ug(n,e,t){const s=t.docs.get(e._key),r=new ri(n);return new An(n,r,e._key,s,new $s(t.hasPendingWrites,t.fromCache),e.converter)}function xU(n){return aC(n,{count:sC()})}function aC(n,e){const t=Pe(n.firestore,tt),s=Et(t),r=GA(e,((i,o)=>new AS(o,i.aggregateType,i._internalFieldPath)));return D2(s,n._query,r).then((i=>(function(a,l,u){const h=new ri(a);return new KR(l,h,u)})(t,n,i)))}class VU{constructor(e){this.kind="memory",this._onlineComponentProvider=Qr.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new H_(void 0)}}toJSON(){return{kind:this.kind}}}class OU{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=lC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class MU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ga.provider}toJSON(){return{kind:this.kind}}}class LU{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new H_(e)}}toJSON(){return{kind:this.kind}}}function FU(){return new MU}function UU(n){return new LU(n?.cacheSizeBytes)}function BU(n){return new VU(n)}function $U(n){return new OU(n)}class qU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Qr.provider,this._offlineComponentProvider={build:t=>new Q_(t,e?.cacheSizeBytes,this.forceOwnership)}}}class jU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Qr.provider,this._offlineComponentProvider={build:t=>new kR(t,e?.cacheSizeBytes)}}}function lC(n){return new qU(n?.forceOwnership)}function GU(){return new jU}const KU={maxAttempts:5};class cC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ao(e)}set(e,t,s){this._verifyNotCommitted();const r=Nr(e,this._firestore),i=Od(r.converter,t,s),o=kd(this._dataReader,"WriteBatch.set",r._key,i,r.converter!==null,s);return this._mutations.push(o.toMutation(r._key,vt.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=Nr(e,this._firestore);let o;return o=typeof(t=et(t))=="string"||t instanceof ni?ig(this._dataReader,"WriteBatch.update",i._key,t,s,r):rg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,vt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Nr(e,this._firestore);return this._mutations=this._mutations.concat(new ka(t._key,vt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Nr(n,e){if((n=et(n)).firestore!==e)throw new B(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class WU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ao(e)}get(e){const t=Nr(e,this._firestore),s=new cg(this._firestore);return this._transaction.lookup([t._key]).then((r=>{if(!r||r.length!==1)return he(24041);const i=r[0];if(i.isFoundDocument())return new yc(this._firestore,s,i.key,i,t.converter);if(i.isNoDocument())return new yc(this._firestore,s,t._key,null,t.converter);throw he(18433,{doc:i})}))}set(e,t,s){const r=Nr(e,this._firestore),i=Od(r.converter,t,s),o=kd(this._dataReader,"Transaction.set",r._key,i,r.converter!==null,s);return this._transaction.set(r._key,o),this}update(e,t,s,...r){const i=Nr(e,this._firestore);let o;return o=typeof(t=et(t))=="string"||t instanceof ni?ig(this._dataReader,"Transaction.update",i._key,t,s,r):rg(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Nr(e,this._firestore);return this._transaction.delete(t._key),this}}class uC extends WU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Nr(e,this._firestore),s=new ri(this._firestore);return super.get(e).then((r=>new An(this._firestore,s,t._key,r._document,new $s(!1,!1),t.converter)))}}function zU(n,e,t){n=Pe(n,tt);const s={...KU,...t};return(function(i){if(i.maxAttempts<1)throw new B(M.INVALID_ARGUMENT,"Max attempts must be at least 1")})(s),(function(i,o,a){const l=new Gt;return i.asyncQueue.enqueueAndForget((async()=>{const u=await VR(i);new S2(i.asyncQueue,u,a,o,l).ju()})),l.promise})(Et(n),(r=>e(new uC(n,r))),s)}function HU(){return new Kc("deleteField")}function QU(){return new eg("serverTimestamp")}function YU(...n){return new tg("arrayUnion",n)}function JU(...n){return new ng("arrayRemove",n)}function XU(n){return new sg("increment",n)}function ZU(n){return new qn(n)}function e4(n){return Et(n=Pe(n,tt)),new cC(n,(e=>Ua(n,e)))}function t4(n,e){const t=Et(n=Pe(n,tt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Mn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const s=(function(i){const o=typeof i=="string"?(function(u){try{return JSON.parse(u)}catch(h){throw new B(M.INVALID_ARGUMENT,"Failed to parse JSON: "+h?.message)}})(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=AI(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const d of l.fields){const p=Dd("setIndexConfiguration",AI(d,"fieldPath"));d.arrayConfig==="CONTAINS"?h.push(new xi(p,2)):d.order==="ASCENDING"?h.push(new xi(p,0)):d.order==="DESCENDING"&&h.push(new xi(p,1))}a.push(new ta(ta.UNKNOWN_ID,u,h,na.empty()))}return a})(e);return M2(t,s)}function AI(n,e){if(typeof n[e]!="string")throw new B(M.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}class hC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function n4(n){n=Pe(n,tt);const e=SI.get(n);if(e)return e;if(Et(n)._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;const s=new hC(n);return SI.set(n,s),s}function s4(n){dC(n,!0)}function r4(n){dC(n,!1)}function i4(n){F2(Et(n._firestore)).then((e=>W("deleting all persistent cache indexes succeeded"))).catch((e=>Mn("deleting all persistent cache indexes failed",e)))}function dC(n,e){L2(Et(n._firestore),e).then((t=>W(`setting persistent cache index auto creation isEnabled=${e} succeeded`))).catch((t=>Mn(`setting persistent cache index auto creation isEnabled=${e} failed`,t)))}const SI=new WeakMap;function o4(n){const e=Et(Pe(n.firestore,tt)),t=e._onlineComponents?.datastore.serializer;return t===void 0?null:Id(t,hn(n._query)).ft}function a4(n,e){const t=GA(e,((i,o)=>new AS(o,i.aggregateType,i._internalFieldPath))),s=Et(Pe(n.firestore,tt)),r=s._onlineComponents?.datastore.serializer;return r===void 0?null:LS(r,cS(n._query),t,!0).request}class l4{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return hg.instance.onExistenceFilterMismatch(e)}}class hg{constructor(){this.Mc=new Map}static get instance(){return Iu||(Iu=new hg,(function(t){if(Vp)throw new Error("a TestingHooksSpi instance is already set");Vp=t})(Iu)),Iu}lt(e){this.Mc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),s=this.Mc;return s.set(t,e),()=>s.delete(t)}}let Iu=null;(function(e,t=!0){(function(r){Ca=r})(no),Fi(new $r("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new tt(new TM(s.getProvider("auth-internal")),new AM(o,s.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new B(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gr(u.options.projectId,h)})(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a}),"PUBLIC").setMultipleInstances(!0)),Ts(rE,iE,e),Ts(rE,iE,"esm2020")})();const c4=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:lg,AggregateField:va,AggregateQuerySnapshot:KR,Bytes:In,CACHE_SIZE_UNLIMITED:q2,CollectionReference:ns,DocumentReference:Ye,DocumentSnapshot:An,FieldPath:ni,FieldValue:si,Firestore:tt,FirestoreError:B,GeoPoint:ss,LoadBundleTask:$R,PersistentCacheIndexManager:hC,Query:Ot,QueryCompositeFilterConstraint:co,QueryConstraint:La,QueryDocumentSnapshot:Kl,QueryEndAtConstraint:Hc,QueryFieldFilterConstraint:Fa,QueryLimitConstraint:Wc,QueryOrderByConstraint:Vd,QuerySnapshot:Sn,QueryStartAtConstraint:zc,SnapshotMetadata:$s,Timestamp:We,Transaction:uC,VectorValue:qn,WriteBatch:cC,_AutoId:cd,_ByteString:It,_DatabaseId:Gr,_DocumentKey:Z,_EmptyAppCheckTokenProvider:SM,_EmptyAuthCredentialsProvider:wA,_FieldPath:_t,_TestingHooks:l4,_cast:Pe,_debugAssert:EM,_internalAggregationQueryToProtoRunAggregationQueryRequest:a4,_internalQueryToProtoQueryTarget:o4,_isBase64Available:cL,_logWarn:Mn,_validateIsNotUsedTogether:AA,addDoc:NU,aggregateFieldEqual:gU,aggregateQuerySnapshotEqual:yU,and:aU,arrayRemove:JU,arrayUnion:YU,average:_U,clearIndexedDbPersistence:z2,collection:U2,collectionGroup:B2,connectFirestoreEmulator:BR,count:sC,deleteAllPersistentCacheIndexes:i4,deleteDoc:oC,deleteField:HU,disableNetwork:Y2,disablePersistentCacheIndexAutoCreation:r4,doc:X_,documentId:X2,documentSnapshotFromJSON:vU,enableIndexedDbPersistence:K2,enableMultiTabIndexedDbPersistence:W2,enableNetwork:Q2,enablePersistentCacheIndexAutoCreation:s4,endAt:pU,endBefore:fU,ensureFirestoreConfigured:Et,executeWrite:Ua,getAggregateFromServer:aC,getCountFromServer:xU,getDoc:iC,getDocFromCache:wU,getDocFromServer:bU,getDocs:AU,getDocsFromCache:SU,getDocsFromServer:RU,getFirestore:G2,getPersistentCacheIndexManager:n4,increment:XU,initializeFirestore:j2,limit:cU,limitToLast:uU,loadBundle:zp,memoryEagerGarbageCollector:FU,memoryLocalCache:BU,memoryLruGarbageCollector:UU,namedQuery:GR,onSnapshot:Hp,onSnapshotResume:kU,onSnapshotsInSync:DU,or:oU,orderBy:lU,persistentLocalCache:$U,persistentMultipleTabManager:GU,persistentSingleTabManager:lC,query:rU,queryEqual:Z_,querySnapshotFromJSON:EU,refEqual:$2,runTransaction:zU,serverTimestamp:QU,setDoc:CU,setIndexConfiguration:t4,setLogLevel:vM,snapshotEqual:TU,startAfter:dU,startAt:hU,sum:mU,terminate:J2,updateDoc:PU,vector:ZU,waitForPendingWrites:H2,where:iU,writeBatch:e4},Symbol.toStringTag,{value:"Module"})),u4=!1,kr={apiKey:"...",authDomain:"...",databaseURL:"...",projectId:"...",storageBucket:"...",messagingSenderId:"...",appId:"...",measurementId:"..."},h4=!!kr.apiKey&&!!kr.authDomain&&!!kr.projectId&&!!kr.appId;let Of=null,Dr=null,dg=null;console.log("[firebase] apiKey=",kr.apiKey?"(set)":"(missing)");console.log("[firebase] projectId=",kr.projectId||"(missing)");console.log("[firebase] authDomain=",kr.authDomain||"(missing)");console.log("[firebase] REMOTE_ENABLED=",u4);try{h4?(Of=bw(kr),Dr=Nx(Of)):console.warn("[firebase] Missing VITE_FB_* env config. Running in guest-safe mode.")}catch(n){console.warn("[firebase] initializeApp failed. Running in guest-safe mode:",n),Of=null,Dr=null}const fg=be(null),xs=be(null),pg=be(!1);let Mf=!1,Tu=null;const d4=!0;function Qp(){fg.value=null,xs.value=null,pg.value=!0}function f4(){if(!Mf){if(!Dr){Qp(),Mf=!0;return}if(typeof Tu=="function"){try{Tu()}catch{}Tu=null}Tu=yD(Dr,n=>{fg.value=n||null,pg.value=!0,xs.value=null,n?.uid?console.log("   :  ",n.displayName||n.email):console.log("   :  ")},n=>{xs.value=n,Qp(),console.error("onAuthStateChanged error:",n)}),Mf=!0}}f4();function fC(){return{user:fg,authError:xs,authReady:pg,signInWithGoogle:async()=>{if(!Dr){const s=new Error("     .");throw s.code="AUTH_DISABLED",xs.value=s,s}const t=new Ms;try{const s=await UD(Dr,t);return xs.value=null,console.log("useAuth:  !",s.user.displayName||s.user.email),s.user}catch(s){throw xs.value=s,console.error("useAuth:  :",s),s}},signOutUser:async()=>{if(!Dr)return Qp(),!0;try{return await vD(Dr),xs.value=null,console.log("useAuth:  !"),!0}catch(t){throw xs.value=t,console.error("useAuth:  :",t),t}},AUTH_ENABLED:d4}}const p4="modulepreload",m4=function(n){return"/RCTS/test/"+n},RI={},_4=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};var o=u;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=u(t.map(h=>{if(h=m4(h),h in RI)return;RI[h]=!0;const d=h.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${p}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":p4,d||(_.as="script"),_.crossOrigin="",_.href=h,l&&_.setAttribute("nonce",l),document.head.appendChild(_),d)return new Promise((E,b)=>{_.addEventListener("load",E),_.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return r.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},CI=be(0),PI=be(!1);function g4(){const n=()=>Date.now()+(CI.value||0),e=de(()=>PI.value===!0);return{serverOffsetMs:CI,isServerTimeReady:PI,isServerTimeReadyComputed:e,serverNowMs:n}}const Wl=be(null),Vh=be(!1);let Yp=!1;const y4=540*60*1e3;function v4(n){return new Date(n+y4)}function E4(n){if(!(n instanceof Date))return"";const e=t=>String(t).padStart(2,"0");return`${e(n.getHours())}:${e(n.getMinutes())}`}function pC(){if(Yp)return;Yp=!0;let n,e;{const{serverNowMs:s}=g4();n=()=>s(),e=v4}const t=()=>{try{const s=Number(n?.()??Date.now());Wl.value=e(s),Vh.value=!0}catch(s){Wl.value=new Date,Vh.value=!0,console.warn("[useKstTime] fallback to local time:",s)}};t(),setInterval(t,6e4)}function mC(){Yp||pC();const n=de(()=>Vh.value&&Wl.value instanceof Date),e=de(()=>n.value?E4(Wl.value):"");return{kstDate:Wl,isKstTimeReady:Vh,isKstReady:n,kstString:e}}const Rt=3600,NI=60,ml=8*Rt,ii=[{id:"sys_unlock_vehicle",type:"SYSTEM",domain:"vehicle",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ml,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"vehicle"}]},{id:"sys_unlock_route",type:"SYSTEM",domain:"route",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ml,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"route"}]},{id:"sys_unlock_construction",type:"SYSTEM",domain:"construction",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ml,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"construction"}]},{id:"sys_unlock_finance",type:"SYSTEM",domain:"finance",timePolicy:"FIXED",title:"()  ",desc:"  . (  )",tier:1,durationSec:ml,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"finance"}]},{id:"sys_unlock_city",type:"SYSTEM",domain:"city",timePolicy:"FIXED",title:"  ",desc:"  . (  )",tier:1,durationSec:ml,requires:[],revealAfter:[],enabled:!1,effects:[{type:"UNLOCK_FEATURE",featureKey:"city"}]},{id:"sys_preview_starter_vehicles",type:"REAL",domain:"vehicle",timePolicy:"SCALABLE",title:"  ",desc:' (//)    .   ""  ,     . (30,  )',tier:1,durationSec:30*NI,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_STARTER_FLEET_PREVIEW",transports:["bus","truck","rail"],runTimeMinSec:30*NI,runTimeMaxSec:3*Rt,countPerTransport:1,mode:"MANUAL"}]},{id:"sys_preview_auto_assign",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:"  ",desc:"      . (1,  )",tier:1,durationSec:1*Rt,requires:["sys_preview_starter_vehicles"],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_FEATURE",featureKey:"preview_auto_assign"},{type:"SET_PREVIEW_RUN_MODE",mode:"AUTO"}]},{id:"city_scale_region",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  .',tier:1,durationSec:4*Rt,requires:["sys_unlock_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"REGION"}]},{id:"city_scale_city",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:'  ""  . (  )',tier:1,durationSec:8*Rt,requires:["city_scale_region"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"CITY"}]},{id:"city_scale_country",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . ( / )',tier:1,durationSec:12*Rt,requires:["city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"COUNTRY"}]},{id:"city_scale_state",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:16*Rt,requires:["city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"STATE"}]},{id:"city_scale_planet",type:"CITY",domain:"city",timePolicy:"SCALABLE",title:"  ",desc:' ""  . (   )',tier:1,durationSec:24*Rt,requires:["city_scale_state"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"SET_CITY_SCALE",scale:"PLANET"}]},{id:"unlock_bus_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Rt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"bus",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"bus",tier:1}]},{id:"unlock_truck_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Rt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"truck",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"truck",tier:1}]},{id:"unlock_rail_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) .",tier:1,durationSec:1*Rt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"rail",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"rail",tier:1}]},{id:"unlock_plane_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Rt,requires:["sys_unlock_city","city_scale_city"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"plane",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"plane",tier:1}]},{id:"unlock_ship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:2*Rt,requires:["sys_unlock_city","city_scale_country"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"ship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"ship",tier:1}]},{id:"unlock_spaceship_t1",type:"TRANSPORT",domain:"transport",timePolicy:"SCALABLE",title:"   ",desc:" (1) . ( :   )",tier:1,durationSec:3*Rt,requires:["sys_unlock_city","city_scale_planet"],revealAfter:["sys_unlock_city"],enabled:!0,effects:[{type:"UNLOCK_TRANSPORT_TIER",transportId:"spaceship",tier:1},{type:"GRANT_STARTER_VEHICLE",transportId:"spaceship",tier:1}]},{id:"rs_1",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  I",desc:"     5% . (SYSTEM  8 )",tier:1,durationSec:1*Rt,requires:[],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:1}]},{id:"rs_2",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  II",desc:"     10% . (SYSTEM  8 )",tier:1,durationSec:2*Rt,requires:["rs_1"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:2}]},{id:"rs_3",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  III",desc:"     15% . (SYSTEM  8 )",tier:1,durationSec:4*Rt,requires:["rs_2"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:3}]},{id:"rs_4",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  IV",desc:"     20% . (SYSTEM  8 )",tier:1,durationSec:8*Rt,requires:["rs_3"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:4}]},{id:"rs_5",type:"EFFICIENCY",domain:"research",timePolicy:"SCALABLE",title:"  V",desc:"     25% . (SYSTEM  8 )",tier:1,durationSec:16*Rt,requires:["rs_4"],revealAfter:[],enabled:!0,effects:[{type:"RESEARCH_SPEED_LEVEL",level:5}]},{id:"t2_transport_foundation",type:"REAL",domain:"simulation",timePolicy:"SCALABLE",title:" 2  ()",desc:"2   .   .",tier:2,durationSec:12*Rt,requires:[],revealAfter:[],enabled:!1,effects:[]}];function mg(n){return ii.find(e=>e.id===n)||null}function Lf(n){return String(Math.max(0,Number(n)||0)).padStart(2,"0")}function kI(n){const e=Math.max(0,Math.floor(Number(n)||0)),t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return{h:t,m:s,sec:r}}function DI({h:n,m:e,sec:t}){return n>0?`${n}h ${Lf(e)}m ${Lf(t)}s`:e>0?`${e}m ${Lf(t)}s`:`${t}s`}function _C(){const n=r=>{const i=Math.max(0,Math.floor(Number(r||0)/1e3));return DI(kI(i))},e=r=>DI(kI(r));return{formatRemainMs:n,formatRemainSec:e,makeRemainLabelFromMs:r=>de(()=>n(r.value)),makeRemainLabelFromSec:r=>de(()=>e(r.value))}}function I4(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="test"?"test":e==="preview"?"preview":e==="prod"?"prod":e==="beta"?"beta":"prod"}function T4(){const n=de(()=>I4("test")),e=de(()=>n.value==="dev"),t=de(()=>n.value==="test"),s=de(()=>n.value==="preview"),r=de(()=>n.value==="prod");return{channel:n,isDev:e,isTest:t,isPreview:s,isProd:r}}const gC="rcts.research.saveEnabled",yC="rcts.research.autosave.enabled",vC="rcts.research.autosave.base",_g="rcts.research.autosave.intervalMin",{kstDate:EC,isKstTimeReady:IC}=mC(),Qc=de(()=>IC.value&&EC.value instanceof Date);function Md(){return Qc.value?EC.value.getTime():Date.now()}const w4=new Set(["sys_unlock_vehicle","sys_unlock_route","sys_unlock_construction","sys_unlock_finance","sys_unlock_city"]);function Oh(n){return!n||!w4.has(n)?!1:mg(n)?.enabled===!1}function TC(n){const e=String(n||"").toLowerCase().trim();return e||"prod"}const{isTest:b4}=T4(),ir=de(()=>(b4.value,!1)),wC=de(()=>!0),A4=300;let wu=null;async function Yc(){if(!ir.value)return null;if(wu)return wu;const n=await _4(()=>Promise.resolve().then(()=>c4),void 0);return wu={doc:n.doc,getDoc:n.getDoc,setDoc:n.setDoc,serverTimestamp:n.serverTimestamp,onSnapshot:n.onSnapshot},wu}async function bC(...n){const e=await Yc();return e?e.doc(...n):null}async function S4(n){const e=await Yc();return!e||!n?null:e.getDoc(n)}async function gg(n,e,t){const s=await Yc();return!s||!n?!1:(await s.setDoc(n,e,t),!0)}async function R4(n,e,t){const s=await Yc();return!s||!n?null:s.onSnapshot(n,e,t)}async function yg(){const n=await Yc();return n?n.serverTimestamp():null}async function vg(n,e){if(!ir.value)return null;const t=TC(e);return bC(dg,"worlds",t,"users",n,"research","state")}async function C4(n){return ir.value?bC(dg,"users",n,"research","state"):null}const Ps=be(null),dn=be(new Set),it=be(null),ct=be([]),AC=be({}),SC=be(1),Eg=be(0),Ld=be(1),Zi=be(1),Mh=be("NONE"),Lh=be({vehicle:!1,route:!1,construction:!1,finance:!1,city:!1}),bi=be(!1),Jp=be(!1),Un=be(!1),oi=be(null),Mi=be("stage");let vn=null,Es=!1,Ku=null;const Li=be(CC(gC,!0)),vc=be(CC(yC,!1)),Ig=be(PC(vC,5)),Ec=be(PC(_g,10)),Tg=be(!1),RC=be(0);let Ci=null;function CC(n,e){const t=localStorage.getItem(n);return t===null?e:t==="1"}function PC(n,e){const t=localStorage.getItem(n),s=t==null?NaN:Number(t);return Number.isFinite(s)?s:e}function NC(n,e){localStorage.setItem(n,e?"1":"0")}function Xp(n,e){localStorage.setItem(n,String(e))}function Fd(n){const e=Math.max(1,Math.min(3,Number(n||1)));return e===1?1:e===2?3:5}function P4(n){Li.value=!!n,NC(gC,Li.value),Li.value?Jc():(vn&&(clearTimeout(vn),vn=null),En())}function N4(n){vc.value=!!n,NC(yC,vc.value),Jc()}function k4(n){const e=Number(n)===10?10:5;Ig.value=e,Xp(vC,e);const t=Number(Ec.value)||e,s=Math.max(e,Math.round(t/e)*e);Ec.value=s,Xp(_g,s),Jc(!0)}function D4(n){const e=Number(Ig.value)===10?10:5,t=Number(n);if(!Number.isFinite(t)||t<=0)return;const s=Math.max(e,Math.round(t/e)*e);Ec.value=s,Xp(_g,s),Jc(!0)}function x4(n){const e=Number(n);if(!Number.isFinite(e)||e<=0)return 6e4;const t=e*60*1e3,s=540*60*1e3,r=Date.now()+s,o=(Math.floor(r/t)+1)*t-r;return Math.max(1e3,o)}function En(){Tg.value=!1,Ci&&(clearTimeout(Ci),Ci=null)}function kC(){if(Ci&&(clearTimeout(Ci),Ci=null),!ir.value||!vc.value||!Li.value||!oi.value||!Un.value||Es)return En();Tg.value=!0;const n=Number(Ec.value)||10,e=x4(n);Ci=setTimeout(async()=>{try{await as({reason:"autosave"}),RC.value=Date.now()}catch(t){console.error("useResearch:  :",t)}finally{kC()}},e)}function Jc(n=!1){if(n&&En(),!ir.value)return En();vc.value&&Li.value&&oi.value&&Un.value&&!Es?kC():En()}function V4(){vn&&(clearTimeout(vn),vn=null),En(),oi.value=null,Mi.value="stage",Un.value=!1,Es=!1}function O4(n){return(Array.isArray(n?.requires)?n.requires:[]).every(t=>dn.value.has(t))}function DC(n){const e=Array.isArray(n?.revealAfter)?n.revealAfter:[];return e.length===0?!0:e.every(t=>dn.value.has(t))}function wg(n){return dn.value.has(n)}function M4(n){return!n||Number(n.tier||1)!==1?!1:(n.effects||[]).some(e=>e?.type==="UNLOCK_TRANSPORT_TIER"&&Number(e?.tier||1)===1&&!!e?.transportId)}function L4(n){return n?n.timePolicy==="FIXED"?!0:n.type==="SYSTEM":!1}function Fh(n){switch(String(n||"").toUpperCase()){case"REGION":return 1;case"CITY":return 2;case"COUNTRY":return 3;case"STATE":return 4;case"PLANET":return 5;default:return 0}}function Br(){const n={};let e=1,t=0,s=1,r="NONE";const i={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1};for(const l of ii)if(dn.value.has(l.id))for(const u of l.effects||[]){if(u.type==="UNLOCK_TRANSPORT_TIER"){const h=u.transportId,d=Number(u.tier||1);if(!h)continue;n[h]=Math.max(Number(n[h]||0),d)}if(u.type==="INCOME_MULTIPLIER"&&(e*=Number(u.value||1)),u.type==="RESEARCH_SPEED_LEVEL"){const h=Number(u.level||0);Number.isFinite(h)&&(t=Math.max(t,h))}if(u.type==="QUEUE_RESERVE_LEVEL"){const h=Number(u.level||1);Number.isFinite(h)&&(s=Math.max(s,h))}if(u.type==="UNLOCK_FEATURE"){const h=String(u.featureKey||"");h&&Object.prototype.hasOwnProperty.call(i,h)&&(i[h]=!0)}if(u.type==="SET_CITY_SCALE"){const h=String(u.scale||"").toUpperCase();Fh(h)>Fh(r)&&(r=h)}}AC.value=n,SC.value=e,Eg.value=t;const o=1-.05*Math.max(0,t);Ld.value=Math.max(.2,o),Mh.value=r,Lh.value=i,Zi.value=Math.max(1,Math.min(3,s));const a=Fd(Zi.value);ct.value.length>a&&(ct.value=ct.value.slice(0,a))}const F4=de(()=>ii.filter(n=>Number(n?.tier||1)>=2?!0:DC(n))),U4=de(()=>{const n=new Set;for(const e of ii)if(Number(e.tier||1)===1)for(const t of e.effects||[])t.type==="UNLOCK_TRANSPORT_TIER"&&Number(t.tier||1)===1&&t.transportId&&n.add(t.transportId);return Array.from(n)}),B4=de(()=>!Ps.value),$4=de(()=>U4.value.map(n=>({id:n})));function q4(){return dn.value.has("unlock_bus_t1")||dn.value.has("unlock_truck_t1")||dn.value.has("unlock_rail_t1")}function bg(n){const e=mg(n);if(!e)return"unknown";const t=Number(e.tier||1);return t===1&&!DC(e)?"hidden":wg(n)?"done":it.value?.id===n?"active":ct.value.includes(n)?"queued":e.enabled===!1?"comingSoon":n==="sys_preview_starter_vehicles"?!Ps.value||!q4()?"locked":"available":t===1&&M4(e)&&Ps.value||O4(e)?"available":"locked"}function xC(n){return ii.find(t=>t.enabled!==!1&&Number(t.tier||1)===1&&(t.effects||[]).some(s=>s.type==="UNLOCK_TRANSPORT_TIER"&&s.transportId===n&&Number(s.tier||1)===1))?.id??null}function VC(){return!(!ir.value||!oi.value||!Un.value||Es)}function j4(){return Li.value?VC():!1}function OC(){const n=Fd(Zi.value);return{version:10,firstUnlockTransportId:Ps.value??null,completedResearchIds:Array.from(dn.value),activeResearch:it.value?{id:it.value.id,startedAtMs:it.value.startedAtMs,endsAtMs:it.value.endsAtMs}:null,queuedResearchIds:Array.isArray(ct.value)?ct.value.slice(0,n):[]}}function G4(n){Ps.value=typeof n?.firstUnlockTransportId=="string"?n.firstUnlockTransportId:typeof n?.firstUnlockId=="string"?n.firstUnlockId:null;const e=Array.isArray(n?.completedResearchIds)?n.completedResearchIds:[];dn.value=new Set(e.filter(o=>typeof o=="string"));const t=n?.activeResearch;t&&typeof t=="object"&&typeof t.id=="string"?it.value={id:t.id,startedAtMs:Number(t.startedAtMs||0),endsAtMs:Number(t.endsAtMs||0)}:it.value=null;const s=Array.isArray(n?.queuedResearchIds)?n.queuedResearchIds.filter(o=>typeof o=="string"):[],r=typeof n?.queuedResearchId=="string"?n.queuedResearchId:null,i=[];for(const o of s)i.includes(o)||i.push(o);if(r&&!i.includes(r)&&i.push(r),ct.value=i,dn.value.size===0&&Array.isArray(n?.transports)){for(const o of n.transports)if(!(!o||typeof o.id!="string")&&o.locked===!1){const a=xC(o.id);a&&dn.value.add(a)}}Br()}async function as({reason:n="manual"}={}){if(!VC())return;vn&&(clearTimeout(vn),vn=null);const e=await vg(oi.value,Mi.value);if(e)try{Jp.value=!0;const t=await yg(),s={...OC(),updatedAt:t,lastSaveReason:n};await gg(e,s,{merge:!0})}catch(t){console.error("useResearch: Firebase  :",t)}finally{Jp.value=!1}}const K4=()=>{j4()&&(vn&&clearTimeout(vn),vn=setTimeout(async()=>{await as({reason:"debounced"})},800))};function W4(n){if(!n||Ps.value)return;const e=xC(n);e&&(Ps.value=n,dn.value.add(e),Br(),as({reason:"firstUnlock"}))}function MC(n){if(Oh(n))return{ok:!1,reason:"COMING_SOON"};const e=mg(n);if(!e)return{ok:!1,reason:"UNKNOWN_RESEARCH"};if(!Ps.value)return{ok:!1,reason:"FIRST_UNLOCK_REQUIRED"};if(!Qc.value)return{ok:!1,reason:"KST_NOT_READY"};if(wg(n))return{ok:!1,reason:"ALREADY_DONE"};if(e.enabled===!1)return{ok:!1,reason:"COMING_SOON"};const t=bg(n);if(t!=="available")return{ok:!1,reason:t.toUpperCase()};const s=Md(),r=Number(e.durationSec||0);let i=0;return r>0&&(wC.value?i=A4:L4(e)?i=Math.ceil(r):i=Math.ceil(r*Ld.value)),i<=0?(dn.value.add(n),Br(),as({reason:"instantComplete"}),{ok:!0,instant:!0}):(it.value={id:n,startedAtMs:s,endsAtMs:s+i*1e3},as({reason:"startResearch"}),{ok:!0,instant:!1})}function z4(n){if(Oh(n))return{ok:!1,reason:"COMING_SOON"};const e=Fd(Zi.value);if(wg(n))return{ok:!1,reason:"ALREADY_DONE"};if(it.value?.id===n)return{ok:!1,reason:"ALREADY_ACTIVE"};if(ct.value.includes(n))return{ok:!0,queued:!0,alreadyQueued:!0};if(it.value){if(ct.value.length>=e)return{ok:!1,reason:"QUEUE_FULL"};const t=bg(n);return t!=="available"?{ok:!1,reason:t.toUpperCase()}:(ct.value=[...ct.value,n].slice(0,e),as({reason:"queueAdd"}),{ok:!0,queued:!0})}return MC(n)}function H4(n){const e=ct.value.slice(),t=e.filter(s=>s!==n);t.length!==e.length&&(ct.value=t,as({reason:"queueCancel"}))}function Q4(){ct.value.length!==0&&(ct.value=[],as({reason:"queueCancelAll"}))}function Y4(n){if(!it.value||it.value.id!==n||!Qc.value)return 0;const e=it.value.endsAtMs-it.value.startedAtMs;if(e<=0)return 0;const t=Md()-it.value.startedAtMs;return Math.max(0,Math.min(100,t/e*100))}function J4(n){const{formatRemainSec:e}=_C();if(!it.value||it.value.id!==n||!Qc.value)return"0s";const t=Math.max(0,it.value.endsAtMs-Md()),s=Math.floor(t/1e3);return e(s)}function LC(){Ku&&(Ku(),Ku=null),vn&&(clearTimeout(vn),vn=null),En(),oi.value=null,Mi.value="stage",Un.value=!1,Es=!1,bi.value=!1}async function X4(n,e){if(!ir.value)return!1;const t=await vg(n,e),s=await C4(n);if(!t||!s)return!1;const r=await S4(s);if(!r||!r.exists())return!1;const i=r.data()||{},o=await yg(),a={...i,migratedFromLegacy:!0,migratedAt:o,updatedAt:o,lastSaveReason:"migrateLegacy"};return await gg(t,a,{merge:!0}),!0}async function FC(n,e="stage"){if(!n)return;if(LC(),oi.value=n,Mi.value=TC(e),!ir.value){Br(),bi.value=!1,Un.value=!0,Es=!1,En();return}bi.value=!0,Un.value=!1;const t=await vg(n,Mi.value);if(!t){bi.value=!1,Un.value=!1;return}Ku=await R4(t,async s=>{Es=!0;try{if(s.exists())G4(s.data());else if(await X4(n,Mi.value))Br();else{Br();const i=await yg(),o={...OC(),createdAt:i,updatedAt:i,lastSaveReason:"init"};await gg(t,o,{merge:!0})}}catch(r){console.error("useResearch: onSnapshot apply failed:",r)}finally{Es=!1,bi.value=!1,Un.value=!0,Jc(!0)}},s=>{Es=!1,bi.value=!1,Un.value=!1,En(),console.error("useResearch: onSnapshot error:",s)})}async function Z4(n,e="stage"){await FC(n,e)}function e6(){V4(),Ps.value=null,dn.value=new Set,it.value=null,ct.value=[],Mh.value="NONE",Lh.value={vehicle:!1,route:!1,construction:!1,finance:!1,city:!1},Eg.value=0,Ld.value=1,Zi.value=1,Br()}Rl(()=>{if(Es)return;let n=!1;if(it.value?.id&&Oh(it.value.id)&&(it.value=null,n=!0),Array.isArray(ct.value)&&ct.value.length>0){const e=ct.value.filter(t=>!Oh(t));e.length!==ct.value.length&&(ct.value=e,n=!0)}n&&as({reason:"hardLockCleanup"})});Rl(()=>{if(!Qc.value)return;const n=Md();if(it.value&&n>=Number(it.value.endsAtMs||0)){const e=it.value.id;if(it.value=null,dn.value.add(e),Br(),ct.value.length>0){const[t,...s]=ct.value;ct.value=s;const r=MC(t);r?.ok||console.warn("useResearch: queued next start failed:",t,r?.reason)}as({reason:"researchComplete"})}});function Ba(){const n=de(()=>!oi.value||Un.value),e=de(()=>Fd(Zi.value)),t=de(()=>ct.value.length),s=de(()=>t.value>=e.value);return{catalog:ii,visibleCatalog:F4,firstUnlockTransportId:Ps,needsFirstUnlockSelection:B4,firstUnlockCandidates:$4,setFirstUnlockTransport:W4,completedIds:dn,activeResearch:it,queuedResearchIds:ct,queueReserveLevel:Zi,queueLimit:e,queueCount:t,isQueueFull:s,unlockedTransportTiers:AC,incomeMultiplier:SC,researchSpeedLevel:Eg,researchDurationMultiplier:Ld,cityScale:Mh,unlockedFeatures:Lh,hasFeature:o=>!!Lh.value?.[o],cityScaleAtLeast:o=>Fh(Mh.value)>=Fh(o),getStatus:bg,startResearch:z4,cancelQueuedResearch:H4,cancelAllQueuedResearch:Q4,getResearchProgress:Y4,getResearchRemainingTime:J4,isKstTimeReady:IC,subscribeForUser:FC,unsubscribe:LC,loadForUser:Z4,clearUserState:e6,saveNow:as,scheduleSave:K4,saveEnabled:Li,setSaveEnabled:P4,autoSaveEnabled:vc,autoSaveBase:Ig,autoSaveIntervalMin:Ec,setAutoSaveEnabled:N4,setAutoSaveBase:k4,setAutoSaveIntervalMin:D4,autoSaveRunning:Tg,lastAutoSaveAtMs:RC,isLoadingFirebaseData:bi,isSavingFirebaseData:Jp,isStateLoaded:Un,isHydrated:n,currentWorld:Mi,REMOTE_OK:ir,FORCE_ALL_5MIN:wC}}function t6(n){const e=String(n).toLowerCase();return e==="dev"?"dev":e==="stage"?"stage":"prod"}function UC(){return{world:de(()=>t6("stage"))}}const n6={__name:"App",setup(n){return ym(()=>{pC()}),(e,t)=>{const s=Jl("router-view");return Y(),Wo(s)}}};const Co=typeof document<"u";function BC(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function s6(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&BC(n.default)}const $e=Object.assign;function Ff(n,e){const t={};for(const s in e){const r=e[s];t[s]=ls(r)?r.map(n):n(r)}return t}const zl=()=>{},ls=Array.isArray;function xI(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}const $C=/#/g,r6=/&/g,i6=/\//g,o6=/=/g,a6=/\?/g,qC=/\+/g,l6=/%5B/g,c6=/%5D/g,jC=/%5E/g,u6=/%60/g,GC=/%7B/g,h6=/%7C/g,KC=/%7D/g,d6=/%20/g;function Ag(n){return n==null?"":encodeURI(""+n).replace(h6,"|").replace(l6,"[").replace(c6,"]")}function f6(n){return Ag(n).replace(GC,"{").replace(KC,"}").replace(jC,"^")}function Zp(n){return Ag(n).replace(qC,"%2B").replace(d6,"+").replace($C,"%23").replace(r6,"%26").replace(u6,"`").replace(GC,"{").replace(KC,"}").replace(jC,"^")}function p6(n){return Zp(n).replace(o6,"%3D")}function m6(n){return Ag(n).replace($C,"%23").replace(a6,"%3F")}function _6(n){return m6(n).replace(i6,"%2F")}function Ic(n){if(n==null)return null;try{return decodeURIComponent(""+n)}catch{}return""+n}const g6=/\/$/,y6=n=>n.replace(g6,"");function Uf(n,e,t="/"){let s,r={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return l=a>=0&&l>a?-1:l,l>=0&&(s=e.slice(0,l),i=e.slice(l,a>0?a:e.length),r=n(i.slice(1))),a>=0&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=T6(s??e,t),{fullPath:s+i+o,path:s,query:r,hash:Ic(o)}}function v6(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function VI(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function E6(n,e,t){const s=e.matched.length-1,r=t.matched.length-1;return s>-1&&s===r&&Ea(e.matched[s],t.matched[r])&&WC(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ea(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function WC(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(var t in n)if(!I6(n[t],e[t]))return!1;return!0}function I6(n,e){return ls(n)?OI(n,e):ls(e)?OI(e,n):n?.valueOf()===e?.valueOf()}function OI(n,e){return ls(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function T6(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),r=s[s.length-1];(r===".."||r===".")&&s.push("");let i=t.length-1,o,a;for(o=0;o<s.length;o++)if(a=s[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+s.slice(o).join("/")}const _r={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let em=(function(n){return n.pop="pop",n.push="push",n})({}),Bf=(function(n){return n.back="back",n.forward="forward",n.unknown="",n})({});function w6(n){if(!n)if(Co){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),y6(n)}const b6=/^[^#]+#/;function A6(n,e){return n.replace(b6,"#")+e}function S6(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const Ud=()=>({left:window.scrollX,top:window.scrollY});function R6(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),r=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!r)return;e=S6(r,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function MI(n,e){return(history.state?history.state.position-e:-1)+n}const tm=new Map;function C6(n,e){tm.set(n,e)}function P6(n){const e=tm.get(n);return tm.delete(n),e}function N6(n){return typeof n=="string"||n&&typeof n=="object"}function zC(n){return typeof n=="string"||typeof n=="symbol"}let wt=(function(n){return n[n.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",n[n.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",n[n.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",n[n.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",n[n.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",n})({});const HC=Symbol("");wt.MATCHER_NOT_FOUND+"",wt.NAVIGATION_GUARD_REDIRECT+"",wt.NAVIGATION_ABORTED+"",wt.NAVIGATION_CANCELLED+"",wt.NAVIGATION_DUPLICATED+"";function Ia(n,e){return $e(new Error,{type:n,[HC]:!0},e)}function ks(n,e){return n instanceof Error&&HC in n&&(e==null||!!(n.type&e))}const k6=["params","query","hash"];function D6(n){if(typeof n=="string")return n;if(n.path!=null)return n.path;const e={};for(const t of k6)t in n&&(e[t]=n[t]);return JSON.stringify(e,null,2)}function x6(n){const e={};if(n===""||n==="?")return e;const t=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<t.length;++s){const r=t[s].replace(qC," "),i=r.indexOf("="),o=Ic(i<0?r:r.slice(0,i)),a=i<0?null:Ic(r.slice(i+1));if(o in e){let l=e[o];ls(l)||(l=e[o]=[l]),l.push(a)}else e[o]=a}return e}function LI(n){let e="";for(let t in n){const s=n[t];if(t=p6(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(ls(s)?s.map(r=>r&&Zp(r)):[s&&Zp(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function V6(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=ls(s)?s.map(r=>r==null?null:""+r):s==null?s:""+s)}return e}const O6=Symbol(""),FI=Symbol(""),Bd=Symbol(""),Sg=Symbol(""),nm=Symbol("");function _l(){let n=[];function e(s){return n.push(s),()=>{const r=n.indexOf(s);r>-1&&n.splice(r,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Tr(n,e,t,s,r,i=o=>o()){const o=s&&(s.enterCallbacks[r]=s.enterCallbacks[r]||[]);return()=>new Promise((a,l)=>{const u=p=>{p===!1?l(Ia(wt.NAVIGATION_ABORTED,{from:t,to:e})):p instanceof Error?l(p):N6(p)?l(Ia(wt.NAVIGATION_GUARD_REDIRECT,{from:e,to:p})):(o&&s.enterCallbacks[r]===o&&typeof p=="function"&&o.push(p),a())},h=i(()=>n.call(s&&s.instances[r],e,t,u));let d=Promise.resolve(h);n.length<3&&(d=d.then(u)),d.catch(p=>l(p))})}function $f(n,e,t,s,r=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(BC(l)){const u=(l.__vccOpts||l)[e];u&&i.push(Tr(u,t,s,o,a,r))}else{let u=l();i.push(()=>u.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const d=s6(h)?h.default:h;o.mods[a]=h,o.components[a]=d;const p=(d.__vccOpts||d)[e];return p&&Tr(p,t,s,o,a,r)()}))}}return i}function M6(n,e){const t=[],s=[],r=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>Ea(u,a))?s.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>Ea(u,l))||r.push(l))}return[t,s,r]}let L6=()=>location.protocol+"//"+location.host;function QC(n,e){const{pathname:t,search:s,hash:r}=e,i=n.indexOf("#");if(i>-1){let o=r.includes(n.slice(i))?n.slice(i).length:1,a=r.slice(o);return a[0]!=="/"&&(a="/"+a),VI(a,"")}return VI(t,n)+s+r}function F6(n,e,t,s){let r=[],i=[],o=null;const a=({state:p})=>{const _=QC(n,location),E=t.value,b=e.value;let C=0;if(p){if(t.value=_,e.value=p,o&&o===E){o=null;return}C=b?p.position-b.position:0}else s(_);r.forEach(F=>{F(t.value,E,{delta:C,type:em.pop,direction:C?C>0?Bf.forward:Bf.back:Bf.unknown})})};function l(){o=t.value}function u(p){r.push(p);const _=()=>{const E=r.indexOf(p);E>-1&&r.splice(E,1)};return i.push(_),_}function h(){if(document.visibilityState==="hidden"){const{history:p}=window;if(!p.state)return;p.replaceState($e({},p.state,{scroll:Ud()}),"")}}function d(){for(const p of i)p();i=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",h),document.removeEventListener("visibilitychange",h)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",h),document.addEventListener("visibilitychange",h),{pauseListeners:l,listen:u,destroy:d}}function UI(n,e,t,s=!1,r=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:r?Ud():null}}function U6(n){const{history:e,location:t}=window,s={value:QC(n,t)},r={value:e.state};r.value||i(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,h){const d=n.indexOf("#"),p=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:L6()+n+l;try{e[h?"replaceState":"pushState"](u,"",p),r.value=u}catch(_){console.error(_),t[h?"replace":"assign"](p)}}function o(l,u){i(l,$e({},e.state,UI(r.value.back,l,r.value.forward,!0),u,{position:r.value.position}),!0),s.value=l}function a(l,u){const h=$e({},r.value,e.state,{forward:l,scroll:Ud()});i(h.current,h,!0),i(l,$e({},UI(s.value,l,null),{position:h.position+1},u),!1),s.value=l}return{location:s,state:r,push:a,replace:o}}function B6(n){n=w6(n);const e=U6(n),t=F6(n,e.state,e.location,e.replace);function s(i,o=!0){o||t.pauseListeners(),history.go(i)}const r=$e({location:"",base:n,go:s,createHref:A6.bind(null,n)},e,t);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>e.state.value}),r}let Pi=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.Group=2]="Group",n})({});var xt=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.ParamRegExp=2]="ParamRegExp",n[n.ParamRegExpEnd=3]="ParamRegExpEnd",n[n.EscapeNext=4]="EscapeNext",n})(xt||{});const $6={type:Pi.Static,value:""},q6=/[a-zA-Z0-9_]/;function j6(n){if(!n)return[[]];if(n==="/")return[[$6]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${u}": ${_}`)}let t=xt.Static,s=t;const r=[];let i;function o(){i&&r.push(i),i=[]}let a=0,l,u="",h="";function d(){u&&(t===xt.Static?i.push({type:Pi.Static,value:u}):t===xt.Param||t===xt.ParamRegExp||t===xt.ParamRegExpEnd?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:Pi.Param,value:u,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function p(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==xt.ParamRegExp){s=t,t=xt.EscapeNext;continue}switch(t){case xt.Static:l==="/"?(u&&d(),o()):l===":"?(d(),t=xt.Param):p();break;case xt.EscapeNext:p(),t=s;break;case xt.Param:l==="("?t=xt.ParamRegExp:q6.test(l)?p():(d(),t=xt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case xt.ParamRegExp:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=xt.ParamRegExpEnd:h+=l;break;case xt.ParamRegExpEnd:d(),t=xt.Static,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===xt.ParamRegExp&&e(`Unfinished custom RegExp for param "${u}"`),d(),o(),r}const BI="[^/]+?",G6={sensitive:!1,strict:!1,start:!0,end:!0};var gn=(function(n){return n[n._multiplier=10]="_multiplier",n[n.Root=90]="Root",n[n.Segment=40]="Segment",n[n.SubSegment=30]="SubSegment",n[n.Static=40]="Static",n[n.Dynamic=20]="Dynamic",n[n.BonusCustomRegExp=10]="BonusCustomRegExp",n[n.BonusWildcard=-50]="BonusWildcard",n[n.BonusRepeatable=-20]="BonusRepeatable",n[n.BonusOptional=-8]="BonusOptional",n[n.BonusStrict=.7000000000000001]="BonusStrict",n[n.BonusCaseSensitive=.25]="BonusCaseSensitive",n})(gn||{});const K6=/[.+*?^${}()[\]/\\]/g;function W6(n,e){const t=$e({},G6,e),s=[];let r=t.start?"^":"";const i=[];for(const u of n){const h=u.length?[]:[gn.Root];t.strict&&!u.length&&(r+="/");for(let d=0;d<u.length;d++){const p=u[d];let _=gn.Segment+(t.sensitive?gn.BonusCaseSensitive:0);if(p.type===Pi.Static)d||(r+="/"),r+=p.value.replace(K6,"\\$&"),_+=gn.Static;else if(p.type===Pi.Param){const{value:E,repeatable:b,optional:C,regexp:F}=p;i.push({name:E,repeatable:b,optional:C});const U=F||BI;if(U!==BI){_+=gn.BonusCustomRegExp;try{`${U}`}catch(k){throw new Error(`Invalid custom RegExp for param "${E}" (${U}): `+k.message)}}let N=b?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;d||(N=C&&u.length<2?`(?:/${N})`:"/"+N),C&&(N+="?"),r+=N,_+=gn.Dynamic,C&&(_+=gn.BonusOptional),b&&(_+=gn.BonusRepeatable),U===".*"&&(_+=gn.BonusWildcard)}h.push(_)}s.push(h)}if(t.strict&&t.end){const u=s.length-1;s[u][s[u].length-1]+=gn.BonusStrict}t.strict||(r+="/?"),t.end?r+="$":t.strict&&!r.endsWith("/")&&(r+="(?:/|$)");const o=new RegExp(r,t.sensitive?"":"i");function a(u){const h=u.match(o),d={};if(!h)return null;for(let p=1;p<h.length;p++){const _=h[p]||"",E=i[p-1];d[E.name]=_&&E.repeatable?_.split("/"):_}return d}function l(u){let h="",d=!1;for(const p of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const _ of p)if(_.type===Pi.Static)h+=_.value;else if(_.type===Pi.Param){const{value:E,repeatable:b,optional:C}=_,F=E in u?u[E]:"";if(ls(F)&&!b)throw new Error(`Provided param "${E}" is an array but it is not repeatable (* or + modifiers)`);const U=ls(F)?F.join("/"):F;if(!U)if(C)p.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${E}"`);h+=U}}return h||"/"}return{re:o,score:s,keys:i,parse:a,stringify:l}}function z6(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===gn.Static+gn.Segment?-1:1:n.length>e.length?e.length===1&&e[0]===gn.Static+gn.Segment?1:-1:0}function YC(n,e){let t=0;const s=n.score,r=e.score;for(;t<s.length&&t<r.length;){const i=z6(s[t],r[t]);if(i)return i;t++}if(Math.abs(r.length-s.length)===1){if($I(s))return 1;if($I(r))return-1}return r.length-s.length}function $I(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const H6={strict:!1,end:!0,sensitive:!1};function Q6(n,e,t){const s=W6(j6(n.path),t),r=$e(s,{record:n,parent:e,children:[],alias:[]});return e&&!r.record.aliasOf==!e.record.aliasOf&&e.children.push(r),r}function Y6(n,e){const t=[],s=new Map;e=xI(H6,e);function r(d){return s.get(d)}function i(d,p,_){const E=!_,b=jI(d);b.aliasOf=_&&_.record;const C=xI(e,d),F=[b];if("alias"in d){const k=typeof d.alias=="string"?[d.alias]:d.alias;for(const G of k)F.push(jI($e({},b,{components:_?_.record.components:b.components,path:G,aliasOf:_?_.record:b})))}let U,N;for(const k of F){const{path:G}=k;if(p&&G[0]!=="/"){const J=p.record.path,w=J[J.length-1]==="/"?"":"/";k.path=p.record.path+(G&&w+G)}if(U=Q6(k,p,C),_?_.alias.push(U):(N=N||U,N!==U&&N.alias.push(U),E&&d.name&&!GI(U)&&o(d.name)),JC(U)&&l(U),b.children){const J=b.children;for(let w=0;w<J.length;w++)i(J[w],U,_&&_.children[w])}_=_||U}return N?()=>{o(N)}:zl}function o(d){if(zC(d)){const p=s.get(d);p&&(s.delete(d),t.splice(t.indexOf(p),1),p.children.forEach(o),p.alias.forEach(o))}else{const p=t.indexOf(d);p>-1&&(t.splice(p,1),d.record.name&&s.delete(d.record.name),d.children.forEach(o),d.alias.forEach(o))}}function a(){return t}function l(d){const p=Z6(d,t);t.splice(p,0,d),d.record.name&&!GI(d)&&s.set(d.record.name,d)}function u(d,p){let _,E={},b,C;if("name"in d&&d.name){if(_=s.get(d.name),!_)throw Ia(wt.MATCHER_NOT_FOUND,{location:d});C=_.record.name,E=$e(qI(p.params,_.keys.filter(N=>!N.optional).concat(_.parent?_.parent.keys.filter(N=>N.optional):[]).map(N=>N.name)),d.params&&qI(d.params,_.keys.map(N=>N.name))),b=_.stringify(E)}else if(d.path!=null)b=d.path,_=t.find(N=>N.re.test(b)),_&&(E=_.parse(b),C=_.record.name);else{if(_=p.name?s.get(p.name):t.find(N=>N.re.test(p.path)),!_)throw Ia(wt.MATCHER_NOT_FOUND,{location:d,currentLocation:p});C=_.record.name,E=$e({},p.params,d.params),b=_.stringify(E)}const F=[];let U=_;for(;U;)F.unshift(U.record),U=U.parent;return{name:C,path:b,params:E,matched:F,meta:X6(F)}}n.forEach(d=>i(d));function h(){t.length=0,s.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:r}}function qI(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function jI(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:J6(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function J6(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function GI(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function X6(n){return n.reduce((e,t)=>$e(e,t.meta),{})}function Z6(n,e){let t=0,s=e.length;for(;t!==s;){const i=t+s>>1;YC(n,e[i])<0?s=i:t=i+1}const r=eB(n);return r&&(s=e.lastIndexOf(r,s-1)),s}function eB(n){let e=n;for(;e=e.parent;)if(JC(e)&&YC(n,e)===0)return e}function JC({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function KI(n){const e=Xn(Bd),t=Xn(Sg),s=de(()=>{const l=Ge(n.to);return e.resolve(l)}),r=de(()=>{const{matched:l}=s.value,{length:u}=l,h=l[u-1],d=t.matched;if(!h||!d.length)return-1;const p=d.findIndex(Ea.bind(null,h));if(p>-1)return p;const _=WI(l[u-2]);return u>1&&WI(h)===_&&d[d.length-1].path!==_?d.findIndex(Ea.bind(null,l[u-2])):p}),i=de(()=>r.value>-1&&iB(t.params,s.value.params)),o=de(()=>r.value>-1&&r.value===t.matched.length-1&&WC(t.params,s.value.params));function a(l={}){if(rB(l)){const u=e[Ge(n.replace)?"replace":"push"](Ge(n.to)).catch(zl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:s,href:de(()=>s.value.href),isActive:i,isExactActive:o,navigate:a}}function tB(n){return n.length===1?n[0]:n}const nB=PT({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:KI,setup(n,{slots:e}){const t=Wh(KI(n)),{options:s}=Xn(Bd),r=de(()=>({[zI(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[zI(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&tB(e.default(t));return n.custom?i:nw("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:r.value},i)}}}),sB=nB;function rB(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function iB(n,e){for(const t in e){const s=e[t],r=n[t];if(typeof s=="string"){if(s!==r)return!1}else if(!ls(r)||r.length!==s.length||s.some((i,o)=>i.valueOf()!==r[o].valueOf()))return!1}return!0}function WI(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const zI=(n,e,t)=>n??e??t,oB=PT({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=Xn(nm),r=de(()=>n.route||s.value),i=Xn(FI,0),o=de(()=>{let u=Ge(i);const{matched:h}=r.value;let d;for(;(d=h[u])&&!d.components;)u++;return u}),a=de(()=>r.value.matched[o.value]);Su(FI,de(()=>o.value+1)),Su(O6,a),Su(nm,r);const l=be();return Vr(()=>[l.value,a.value,n.name],([u,h,d],[p,_,E])=>{h&&(h.instances[d]=u,_&&_!==h&&u&&u===p&&(h.leaveGuards.size||(h.leaveGuards=_.leaveGuards),h.updateGuards.size||(h.updateGuards=_.updateGuards))),u&&h&&(!_||!Ea(h,_)||!p)&&(h.enterCallbacks[d]||[]).forEach(b=>b(u))},{flush:"post"}),()=>{const u=r.value,h=n.name,d=a.value,p=d&&d.components[h];if(!p)return HI(t.default,{Component:p,route:u});const _=d.props[h],E=_?_===!0?u.params:typeof _=="function"?_(u):_:null,C=nw(p,$e({},E,e,{onVnodeUnmounted:F=>{F.component.isUnmounted&&(d.instances[h]=null)},ref:l}));return HI(t.default,{Component:C,route:u})||C}}});function HI(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const aB=oB;function lB(n){const e=Y6(n.routes,n),t=n.parseQuery||x6,s=n.stringifyQuery||LI,r=n.history,i=_l(),o=_l(),a=_l(),l=s0(_r);let u=_r;Co&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Ff.bind(null,j=>""+j),d=Ff.bind(null,_6),p=Ff.bind(null,Ic);function _(j,fe){let ae,_e;return zC(j)?(ae=e.getRecordMatcher(j),_e=fe):_e=j,e.addRoute(_e,ae)}function E(j){const fe=e.getRecordMatcher(j);fe&&e.removeRoute(fe)}function b(){return e.getRoutes().map(j=>j.record)}function C(j){return!!e.getRecordMatcher(j)}function F(j,fe){if(fe=$e({},fe||l.value),typeof j=="string"){const V=Uf(t,j,fe.path),$=e.resolve({path:V.path},fe),K=r.createHref(V.fullPath);return $e(V,$,{params:p($.params),hash:Ic(V.hash),redirectedFrom:void 0,href:K})}let ae;if(j.path!=null)ae=$e({},j,{path:Uf(t,j.path,fe.path).path});else{const V=$e({},j.params);for(const $ in V)V[$]==null&&delete V[$];ae=$e({},j,{params:d(V)}),fe.params=d(fe.params)}const _e=e.resolve(ae,fe),De=j.hash||"";_e.params=h(p(_e.params));const I=v6(s,$e({},j,{hash:f6(De),path:_e.path})),S=r.createHref(I);return $e({fullPath:I,hash:De,query:s===LI?V6(j.query):j.query||{}},_e,{redirectedFrom:void 0,href:S})}function U(j){return typeof j=="string"?Uf(t,j,l.value.path):$e({},j)}function N(j,fe){if(u!==j)return Ia(wt.NAVIGATION_CANCELLED,{from:fe,to:j})}function k(j){return w(j)}function G(j){return k($e(U(j),{replace:!0}))}function J(j,fe){const ae=j.matched[j.matched.length-1];if(ae&&ae.redirect){const{redirect:_e}=ae;let De=typeof _e=="function"?_e(j,fe):_e;return typeof De=="string"&&(De=De.includes("?")||De.includes("#")?De=U(De):{path:De},De.params={}),$e({query:j.query,hash:j.hash,params:De.path!=null?{}:j.params},De)}}function w(j,fe){const ae=u=F(j),_e=l.value,De=j.state,I=j.force,S=j.replace===!0,V=J(ae,_e);if(V)return w($e(U(V),{state:typeof V=="object"?$e({},De,V.state):De,force:I,replace:S}),fe||ae);const $=ae;$.redirectedFrom=fe;let K;return!I&&E6(s,_e,ae)&&(K=Ia(wt.NAVIGATION_DUPLICATED,{to:$,from:_e}),pn(_e,_e,!0,!1)),(K?Promise.resolve(K):P($,_e)).catch(q=>ks(q)?ks(q,wt.NAVIGATION_GUARD_REDIRECT)?q:ht(q):ne(q,$,_e)).then(q=>{if(q){if(ks(q,wt.NAVIGATION_GUARD_REDIRECT))return w($e({replace:S},U(q.to),{state:typeof q.to=="object"?$e({},De,q.to.state):De,force:I}),fe||$)}else q=D($,_e,!0,S,De);return R($,_e,q),q})}function v(j,fe){const ae=N(j,fe);return ae?Promise.reject(ae):Promise.resolve()}function A(j){const fe=re.values().next().value;return fe&&typeof fe.runWithContext=="function"?fe.runWithContext(j):j()}function P(j,fe){let ae;const[_e,De,I]=M6(j,fe);ae=$f(_e.reverse(),"beforeRouteLeave",j,fe);for(const V of _e)V.leaveGuards.forEach($=>{ae.push(Tr($,j,fe))});const S=v.bind(null,j,fe);return ae.push(S),Xe(ae).then(()=>{ae=[];for(const V of i.list())ae.push(Tr(V,j,fe));return ae.push(S),Xe(ae)}).then(()=>{ae=$f(De,"beforeRouteUpdate",j,fe);for(const V of De)V.updateGuards.forEach($=>{ae.push(Tr($,j,fe))});return ae.push(S),Xe(ae)}).then(()=>{ae=[];for(const V of I)if(V.beforeEnter)if(ls(V.beforeEnter))for(const $ of V.beforeEnter)ae.push(Tr($,j,fe));else ae.push(Tr(V.beforeEnter,j,fe));return ae.push(S),Xe(ae)}).then(()=>(j.matched.forEach(V=>V.enterCallbacks={}),ae=$f(I,"beforeRouteEnter",j,fe,A),ae.push(S),Xe(ae))).then(()=>{ae=[];for(const V of o.list())ae.push(Tr(V,j,fe));return ae.push(S),Xe(ae)}).catch(V=>ks(V,wt.NAVIGATION_CANCELLED)?V:Promise.reject(V))}function R(j,fe,ae){a.list().forEach(_e=>A(()=>_e(j,fe,ae)))}function D(j,fe,ae,_e,De){const I=N(j,fe);if(I)return I;const S=fe===_r,V=Co?history.state:{};ae&&(_e||S?r.replace(j.fullPath,$e({scroll:S&&V&&V.scroll},De)):r.push(j.fullPath,De)),l.value=j,pn(j,fe,ae,S),ht()}let T;function nt(){T||(T=r.listen((j,fe,ae)=>{if(!le.listening)return;const _e=F(j),De=J(_e,le.currentRoute.value);if(De){w($e(De,{replace:!0,force:!0}),_e).catch(zl);return}u=_e;const I=l.value;Co&&C6(MI(I.fullPath,ae.delta),Ud()),P(_e,I).catch(S=>ks(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_CANCELLED)?S:ks(S,wt.NAVIGATION_GUARD_REDIRECT)?(w($e(U(S.to),{force:!0}),_e).then(V=>{ks(V,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&!ae.delta&&ae.type===em.pop&&r.go(-1,!1)}).catch(zl),Promise.reject()):(ae.delta&&r.go(-ae.delta,!1),ne(S,_e,I))).then(S=>{S=S||D(_e,I,!1),S&&(ae.delta&&!ks(S,wt.NAVIGATION_CANCELLED)?r.go(-ae.delta,!1):ae.type===em.pop&&ks(S,wt.NAVIGATION_ABORTED|wt.NAVIGATION_DUPLICATED)&&r.go(-1,!1)),R(_e,I,S)}).catch(zl)}))}let Lt=_l(),at=_l(),Oe;function ne(j,fe,ae){ht(j);const _e=at.list();return _e.length?_e.forEach(De=>De(j,fe,ae)):console.error(j),Promise.reject(j)}function se(){return Oe&&l.value!==_r?Promise.resolve():new Promise((j,fe)=>{Lt.add([j,fe])})}function ht(j){return Oe||(Oe=!j,nt(),Lt.list().forEach(([fe,ae])=>j?ae(j):fe()),Lt.reset()),j}function pn(j,fe,ae,_e){const{scrollBehavior:De}=n;if(!Co||!De)return Promise.resolve();const I=!ae&&P6(MI(j.fullPath,0))||(_e||!ae)&&history.state&&history.state.scroll||null;return wT().then(()=>De(j,fe,I)).then(S=>S&&R6(S)).catch(S=>ne(S,j,fe))}const kt=j=>r.go(j);let ue;const re=new Set,le={currentRoute:l,listening:!0,addRoute:_,removeRoute:E,clearRoutes:e.clearRoutes,hasRoute:C,getRoutes:b,resolve:F,options:n,push:k,replace:G,go:kt,back:()=>kt(-1),forward:()=>kt(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:at.add,isReady:se,install(j){j.component("RouterLink",sB),j.component("RouterView",aB),j.config.globalProperties.$router=le,Object.defineProperty(j.config.globalProperties,"$route",{enumerable:!0,get:()=>Ge(l)}),Co&&!ue&&l.value===_r&&(ue=!0,k(r.location).catch(_e=>{}));const fe={};for(const _e in _r)Object.defineProperty(fe,_e,{get:()=>l.value[_e],enumerable:!0});j.provide(Bd,le),j.provide(Sg,vT(fe)),j.provide(nm,l);const ae=j.unmount;re.add(j),j.unmount=function(){re.delete(j),re.size<1&&(u=_r,T&&T(),T=null,l.value=_r,ue=!1,Oe=!1),ae()}}};function Xe(j){return j.reduce((fe,ae)=>fe.then(()=>A(ae)),Promise.resolve())}return le}function $a(){return Xn(Bd)}function cB(n){return Xn(Sg)}function uB(n){const e=String(n).toLowerCase();return e==="test"?"test":e==="preview"?"preview":"prod"}function hB(){const n=de(()=>uB("test")),e=de(()=>{switch(n.value){case"test":return"";case"preview":return"";case"prod":return"";default:return""}});return{envKey:n,envLabel:e}}const Rn=(n,e)=>{const t=n.__vccOpts||n;for(const[s,r]of e)t[s]=r;return t},dB={class:"top-bar-area"},fB={class:"top-bar-content"},pB={class:"center-area"},mB=["data-ready"],_B={class:"right-area"},gB=["data-env"],yB={class:"auth-text"},vB={class:"auth-icon"},EB={__name:"TheTopBar",setup(n){const{kstString:e,isKstTimeReady:t}=mC(),{user:s,signInWithGoogle:r,signOutUser:i}=fC(),{loadForUser:o,clearUserState:a,unsubscribe:l}=Ba(),{world:u}=UC(),{envKey:h,envLabel:d}=hB(),p=de(()=>!!s.value?.uid),_=de(()=>!1);async function E(){if(p.value){try{await i()}finally{try{l()}catch{}try{a()}catch{}}return}try{const b=await r();_.value&&b?.uid&&await o(b.uid,u.value)}catch(b){console.error("[auth] login failed",b),alert(` : ${b?.code||b?.message||b}`)}}return(b,C)=>(Y(),X("header",dB,[g("div",fB,[C[1]||(C[1]=g("div",{class:"left-area"},[g("h1",{class:"game-title"},"RCTS")],-1)),g("div",pB,[C[0]||(C[0]=g("span",{class:"time-label"},"KST",-1)),g("span",{class:"time-value","data-ready":Ge(t)},ye(Ge(t)?Ge(e):"SYNC"),9,mB)]),g("div",_B,[g("span",{class:"env-badge","data-env":Ge(h)},ye(Ge(d)),9,gB),g("button",{class:"auth-btn",type:"button",onClick:E},[g("span",yB,ye(p.value?"":""),1),g("span",vB,ye(p.value?"":""),1)])])])]))}},IB=Rn(EB,[["__scopeId","data-v-bd04a5f0"]]),TB=["bus","truck","rail","plane","ship","spaceship"],Wu={bus:{name:"",icon:""},truck:{name:"",icon:""},rail:{name:"",icon:""},plane:{name:"",icon:""},ship:{name:"",icon:""},spaceship:{name:"",icon:""}};function bu(n,e=1){const t=Number(e||1);return ii.find(r=>(r.effects||[]).some(i=>i.type==="UNLOCK_TRANSPORT_TIER"&&i.transportId===n&&Number(i.tier||1)===t))?.id??null}function wB(){return ii.filter(t=>(t.effects||[]).some(s=>s?.type==="UNLOCK_STARTER_FLEET_PREVIEW")).map(t=>{const s=(t.effects||[]).find(i=>i?.type==="UNLOCK_STARTER_FLEET_PREVIEW")||null,r=s?{transports:Array.isArray(s.transports)?s.transports.filter(Boolean):[],runTimeMinSec:Number(s.runTimeMinSec||0),runTimeMaxSec:Number(s.runTimeMaxSec||0),countPerTransport:Number(s.countPerTransport||1)}:null;return{researchId:t.id,config:r}})}function XC(){const n=Ba(),e=de(()=>wB()),t=de(()=>{const p=n.completedIds.value,_=e.value||[];return!p||_.length===0?!1:_.some(E=>E?.researchId&&p.has(E.researchId))}),s=de(()=>{const p=n.completedIds.value,_=e.value||[];return _.length&&((p?_.find(b=>b?.researchId&&p.has(b.researchId)):null)?.researchId??_[0]?.researchId)||null}),r=de(()=>{const p=n.completedIds.value,_=e.value||[];return _.length?(p?_.find(b=>b?.researchId&&p.has(b.researchId)):null)?.config??_[0]?.config??null:null}),i=de(()=>{const p=r.value;return p?new Set(p.transports||[]):new Set}),o=de(()=>{const p=i.value,_=t.value;return TB.map(E=>{const b=Wu[E]||{},C=b.name??E,F=b.icon??"",N=Number(n.unlockedTransportTiers.value?.[E]||0)<1,k=bu(E,1),G=!!k&&n.activeResearch.value?.id===k;let J=null,w=null;G&&n.activeResearch.value&&(J=new Date(n.activeResearch.value.startedAtMs),w=new Date(n.activeResearch.value.endsAtMs));const v=p.has(E),A=!!_&&!N&&v;return{id:E,name:C,icon:F,locked:N,isResearching:G,researchStartTime:J,researchFinishTime:w,unlockResearchId:k,previewEligible:v,previewActive:A,previewLabel:A?"  ":null}})}),a=de(()=>o.value.filter(p=>p.locked)),l=de(()=>o.value.filter(p=>!p.locked));function u(p){const _=bu(p,1);_&&n.startResearch(_)}function h(p){const _=bu(p,1);return _?n.getResearchProgress(_):0}function d(p){const _=bu(p,1);return _?n.getResearchRemainingTime(_):"00h 00m 00s"}return{transportTypes:o,lockedTransports:a,unlockedTransports:l,unlockTransport:u,getResearchProgress:h,getResearchRemainingTime:d,previewResearchId:s,previewConfig:r,previewStarterFleetUnlocked:t}}const QI=be(null);function bB(){return{selectedTransportId:QI,setSelectedTransportId:e=>{QI.value=e}}}const ZC="rcts.preview.runs.v2",AB=60,SB=30*AB,RB=3*3600;function CB(n,e){const t=Math.ceil(n),s=Math.floor(e);return Math.floor(Math.random()*(s-t+1))+t}function PB(){try{const n=localStorage.getItem(ZC);if(!n)return null;const e=JSON.parse(n);return!e||typeof e!="object"?null:e}catch{return null}}function gl(n){try{localStorage.setItem(ZC,JSON.stringify(n))}catch{}}function gr(n,e){const t={transportId:n,status:"idle",startedAtMs:null,endsAtMs:null,durationSec:0,routeName:" "};if(!e||typeof e!="object")return t;const s=e.status==="running"||e.status==="idle"||e.status==="ready"?e.status:"idle";return{...t,...e,transportId:e.transportId||n,status:s,routeName:e.routeName||" "}}function NB(){const n=Ba(),{transportTypes:e}=XC(),{formatRemainMs:t}=_C(),s=de(()=>!!n.completedIds.value?.has?.("sys_preview_starter_vehicles")),r=de(()=>!!n.completedIds.value?.has?.("sys_preview_auto_assign")),i=de(()=>{const N=e.value||[];return new Set(N.filter(k=>k?.previewActive).map(k=>k.id))}),o=be({}),a=be(Date.now()),l=PB();l?.runs&&typeof l.runs=="object"&&(o.value=l.runs),Rl(()=>{const N=o.value||{};let k=!1;for(const[G,J]of Object.entries(N)){const w=gr(G,J);(!J?.status||J.status!==w.status||J.routeName!==w.routeName)&&(N[G]=w,k=!0)}k&&(o.value={...N},gl({runs:o.value}))});function u(N,k=Date.now()){const G=CB(SB,RB),J=gr(N,o.value?.[N]);o.value[N]={...J,transportId:N,status:"running",startedAtMs:k,endsAtMs:k+G*1e3,durationSec:G,routeName:" "}}function h(N=Date.now()){if(!s.value||!r.value)return!1;const k=i.value;if(!k||k.size===0)return!1;let G=!1;for(const J of k){const w=gr(J,o.value?.[J]);if(w.status!=="running")u(J,N),G=!0;else{const v=Number(w.endsAtMs||0);(!v||v<=N)&&(u(J,N),G=!0)}}return G&&gl({runs:o.value}),G}Rl(()=>{if(!s.value)return;const N=i.value;if(!N||N.size===0)return;let k=!1;for(const G of N)o.value?.[G]||(u(G,Date.now()),k=!0);k&&gl({runs:o.value}),h(Date.now())});let d=null;function p(){d||(d=setInterval(()=>{if(a.value=Date.now(),!s.value)return;const N=a.value,k=i.value;let G=!1;r.value&&h(N)&&(G=!0);for(const J of Object.keys(o.value||{})){if(!k.has(J))continue;const w=gr(J,o.value[J]);if(w.status!=="running")continue;const v=Number(w.endsAtMs||0);v&&N>=v&&(r.value?u(J,N):o.value[J]={...w,status:"ready",startedAtMs:null,endsAtMs:v,durationSec:w.durationSec||0,routeName:" "},G=!0)}G&&gl({runs:o.value})},1e3))}function _(){d&&(clearInterval(d),d=null)}Rl(()=>{if(!s.value){_();return}p(),LP(()=>{_()})});function E(N){const k=a.value;if(!i.value.has(N))return 0;const G=gr(N,o.value?.[N]);if(G.status!=="running")return 0;const J=Number(G.endsAtMs||0);return J?Math.max(0,J-k):0}function b(N){return t(E(N))}function C(N){return i.value.has(N)?gr(N,o.value?.[N]).status:"idle"}function F(N){return!s.value||!i.value.has(N)||r.value||gr(N,o.value?.[N]).status!=="ready"?!1:(u(N,Date.now()),gl({runs:o.value}),a.value=Date.now(),!0)}const U=de(()=>{const N=i.value;return Object.values(o.value||{}).map(G=>gr(G.transportId,G)).filter(G=>N.has(G.transportId)).sort((G,J)=>String(G.transportId).localeCompare(String(J.transportId)))});return{previewUnlocked:s,autoAssignUnlocked:r,runs:o,runList:U,remainingOf:b,statusOf:C,startManualRun:F}}const kB={class:"layout-area left-area"},DB={class:"left-panel-wrapper"},xB={class:"panel transport-list-container"},VB={class:"panel-head"},OB={class:"panel-meta"},MB={key:0,class:"transport-list"},LB=["onClick"],FB={class:"transport-icon"},UB={class:"transport-name"},BB={key:1,class:"placeholder-box"},$B={class:"panel transport-details-container"},qB={class:"panel-head"},jB={class:"panel-heading"},GB={key:0,class:"panel-meta"},KB={key:0,class:"placeholder-box"},WB={key:1,class:"details-content"},zB={class:"kv"},HB={class:"kv-row"},QB={class:"v"},YB={class:"kv-row"},JB={class:"v"},XB={class:"kv-row"},ZB={class:"v"},e3={key:0,class:"lock-box"},t3={key:0,class:"preview-placeholder"},n3={key:1,class:"preview-box"},s3={class:"box-desc"},r3={key:0,class:"preview-placeholder"},i3={key:1,class:"preview-data"},o3={class:"preview-left"},a3={class:"preview-title"},l3={class:"preview-sub"},c3={key:0,class:"preview-right"},u3={class:"preview-remain mono"},h3={key:1,class:"preview-right"},d3={key:0,class:"preview-right"},f3={class:"preview-remain mono"},p3={key:1,class:"preview-right"},m3=["onClick"],_3={class:"details-footnote"},g3={class:"panel resource-container"},y3={class:"panel-head"},v3={class:"panel-meta"},E3={key:0,class:"placeholder-box"},I3={key:1,class:"resource-content"},T3={__name:"TheLeftArea",setup(n){const e=Ba(),{transportTypes:t,unlockedTransports:s,previewStarterFleetUnlocked:r,previewConfig:i}=XC(),o=de(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),a=de(()=>!!e.completedIds.value?.has?.("sys_unlock_finance")),{selectedTransportId:l,setSelectedTransportId:u}=bB(),h=de(()=>s.value||[]),d=de(()=>l.value&&(t.value||[]).find(N=>N.id===l.value)||null),p=de(()=>{const N=new Set((s.value||[]).map(J=>J.id)),k=i.value;return(k&&Array.isArray(k.transports)&&k.transports.length>0?k.transports:["bus","truck","rail"]).some(J=>N.has(J))}),{runList:_,remainingOf:E,statusOf:b,startManualRun:C,autoAssignUnlocked:F}=NB();function U(N){return(t.value||[]).find(G=>G.id===N)?.name??N}return(N,k)=>(Y(),X("aside",kB,[g("div",DB,[g("section",xB,[g("div",VB,[k[0]||(k[0]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",OB,ye(h.value.length)+"",1)]),h.value.length>0?(Y(),X("ul",MB,[(Y(!0),X(Be,null,Jt(h.value,G=>(Y(),X("li",{key:G.id,class:jo(["transport-item",{active:Ge(l)===G.id}]),onClick:J=>Ge(u)(G.id)},[g("span",FB,ye(G.icon),1),g("span",UB,ye(G.name),1),k[1]||(k[1]=g("span",{class:"transport-count"},"0",-1))],10,LB))),128))])):(Y(),X("div",BB,[...k[2]||(k[2]=[g("p",{class:"placeholder-text"},"     .   . ",-1)])]))]),g("section",$B,[g("div",qB,[g("h3",jB,ye(d.value?`${d.value.name} `:"  "),1),d.value?(Y(),X("span",GB,"ID: "+ye(d.value.id),1)):bt("",!0)]),d.value?(Y(),X("div",WB,[g("div",zB,[g("div",HB,[k[4]||(k[4]=g("span",{class:"k"},"",-1)),g("span",QB,ye(d.value.icon),1)]),g("div",YB,[k[5]||(k[5]=g("span",{class:"k"},"",-1)),g("span",JB,ye(d.value.name),1)]),k[7]||(k[7]=g("div",{class:"kv-row"},[g("span",{class:"k"}," "),g("span",{class:"v"},"0")],-1)),g("div",XB,[k[6]||(k[6]=g("span",{class:"k"}," ",-1)),g("span",ZB,ye(d.value.locked?"":""),1)])]),k[19]||(k[19]=g("hr",{class:"divider"},null,-1)),Ge(r)?(Y(),X("div",n3,[k[18]||(k[18]=g("p",{class:"box-title"},"   ",-1)),g("p",s3,[k[12]||(k[12]=zt(" (): ",-1)),g("strong",null,ye(a.value?"":""),1)]),Ge(_).length===0?(Y(),X("div",r3,[...k[13]||(k[13]=[g("p",{class:"placeholder-text"},"      . (/   ) ",-1)])])):(Y(),X("div",i3,[(Y(!0),X(Be,null,Jt(Ge(_),G=>(Y(),X("div",{class:"preview-row",key:G.transportId},[g("div",o3,[g("div",a3,ye(U(G.transportId)),1),g("div",l3,ye(G.routeName),1)]),Ge(F)?(Y(),X(Be,{key:0},[Ge(b)(G.transportId)==="running"?(Y(),X("div",c3,[k[14]||(k[14]=g("div",{class:"preview-pill"},"",-1)),g("div",u3,ye(Ge(E)(G.transportId)),1)])):(Y(),X("div",h3,[...k[15]||(k[15]=[g("div",{class:"preview-idle-text"}," ",-1),g("div",{class:"preview-remain mono"},"00:00",-1)])]))],64)):(Y(),X(Be,{key:1},[Ge(b)(G.transportId)==="running"?(Y(),X("div",d3,[k[16]||(k[16]=g("div",{class:"preview-pill"},"",-1)),g("div",f3,ye(Ge(E)(G.transportId)),1)])):(Y(),X("div",p3,[k[17]||(k[17]=g("div",{class:"preview-idle-text"},"",-1)),g("button",{class:"preview-btn",type:"button",onClick:J=>Ge(C)(G.transportId)},"    ",8,m3)]))],64))]))),128))]))])):(Y(),X("div",e3,[k[9]||(k[9]=g("p",{class:"box-title"},"    ",-1)),k[10]||(k[10]=g("p",{class:"box-desc"},[zt("  "),g("strong",null,"  "),zt("  ,  "),g("strong",null," / "),zt(" . ")],-1)),k[11]||(k[11]=g("p",{class:"box-desc subtle"}," (    .) ",-1)),p.value?bt("",!0):(Y(),X("div",t3,[...k[8]||(k[8]=[g("p",{class:"placeholder-text"}," :           . ",-1)])]))])),g("p",_3,"  "+ye(d.value.name)+"       . ",1)])):(Y(),X("div",KB,[...k[3]||(k[3]=[g("p",{class:"placeholder-text"},"     .",-1)])]))]),g("section",g3,[g("div",y3,[k[20]||(k[20]=g("h3",{class:"panel-heading"},"  ",-1)),g("span",v3,ye(o.value?"":""),1)]),o.value?(Y(),X("div",I3,[...k[22]||(k[22]=[g("div",{class:"kv"},[g("div",{class:"kv-row"},[g("span",{class:"k"},""),g("span",{class:"v"},"$10,000")])],-1)])])):(Y(),X("div",E3,[...k[21]||(k[21]=[g("p",{class:"placeholder-text"}," .",-1)])]))])])]))}},eP=Rn(T3,[["__scopeId","data-v-c2ac4b92"]]),w3={class:"layout-area center-area"},b3={class:"center-content-wrapper"},A3={class:"main-content-nav desktop-only","aria-label":"Main navigation"},S3={class:"nav-list"},R3={class:"nav-item"},C3={class:"nav-item"},P3={class:"nav-item"},N3={class:"nav-item"},k3={class:"nav-item"},D3={class:"nav-item"},x3={class:"nav-item"},V3={class:"mobile-nav mobile-only","aria-label":"Mobile navigation header"},O3=["aria-expanded"],M3={class:"mobile-title"},L3={class:"mobile-title-text"},F3={class:"drawer",role:"dialog","aria-modal":"true","aria-label":"Main menu"},U3={class:"drawer-body"},B3={class:"main-content-display"},yr="/game/main",$3={__name:"TheCenterArea",setup(n){const e=$a(),t=cB(),s=be(!1);function r(){s.value=!1}function i(){s.value=!s.value}const o={preview:`${yr}/preview`,research:`${yr}/research`,vehicles:`${yr}/vehicles`,line:`${yr}/line`,construction:`${yr}/construction`,finance:`${yr}/finance`,city:`${yr}/city`,settings:`${yr}/settings`};function a(h){r(),e.push(h)}const l=de(()=>{const h=t.path||"",d=h.includes("/game/main/preview")||h.includes("/home/preview"),p=h.includes("/game/main/research")||h.includes("/home/research"),_=h.includes("/game/main/vehicles")||h.includes("/home/vehicles"),E=h.includes("/game/main/line")||h.includes("/home/line"),b=h.includes("/game/main/construction")||h.includes("/home/construction"),C=h.includes("/game/main/finance")||h.includes("/home/finance"),F=h.includes("/game/main/city")||h.includes("/home/city"),U=h.includes("/game/main/settings")||h.includes("/home/settings");return d?" ":p?"":_?"":E?"":b?"":C?"":F?"":U?"":""});Vr(()=>t.fullPath,()=>r());function u(h){h.key==="Escape"&&r()}return Vr(s,h=>{document.body.style.overflow=h?"hidden":""}),ym(()=>{window.addEventListener("keydown",u)}),xT(()=>{window.removeEventListener("keydown",u),document.body.style.overflow=""}),(h,d)=>{const p=Jl("router-link"),_=Jl("router-view");return Y(),X("div",w3,[g("div",b3,[g("nav",A3,[g("ul",S3,[g("li",R3,[Ke(p,{to:o.research},{default:Wn(()=>[...d[8]||(d[8]=[zt("",-1)])]),_:1},8,["to"])]),g("li",C3,[Ke(p,{to:o.vehicles},{default:Wn(()=>[...d[9]||(d[9]=[zt("",-1)])]),_:1},8,["to"])]),g("li",P3,[Ke(p,{to:o.line},{default:Wn(()=>[...d[10]||(d[10]=[zt("",-1)])]),_:1},8,["to"])]),g("li",N3,[Ke(p,{to:o.construction},{default:Wn(()=>[...d[11]||(d[11]=[zt("",-1)])]),_:1},8,["to"])]),g("li",k3,[Ke(p,{to:o.finance},{default:Wn(()=>[...d[12]||(d[12]=[zt("",-1)])]),_:1},8,["to"])]),g("li",D3,[Ke(p,{to:o.city},{default:Wn(()=>[...d[13]||(d[13]=[zt("",-1)])]),_:1},8,["to"])]),g("li",x3,[Ke(p,{to:o.settings},{default:Wn(()=>[...d[14]||(d[14]=[zt("",-1)])]),_:1},8,["to"])])])]),g("div",V3,[g("button",{class:"hamburger-btn",type:"button","aria-label":"Open menu","aria-expanded":s.value?"true":"false",onClick:i},[...d[15]||(d[15]=[g("span",{class:"hamburger-icon"},"",-1),g("span",{class:"hamburger-label"},"",-1)])],8,O3),g("div",M3,[g("span",L3,ye(l.value),1)])]),s.value?(Y(),X("div",{key:0,class:"drawer-overlay mobile-only",role:"presentation",onClick:ow(r,["self"])},[g("aside",F3,[g("div",{class:"drawer-head"},[d[16]||(d[16]=g("div",{class:"drawer-title"},"RCTS ",-1)),g("button",{class:"drawer-close",type:"button","aria-label":"Close menu",onClick:r},"  ")]),g("div",U3,[g("button",{class:"drawer-item drawer-item-preview",type:"button",onClick:d[0]||(d[0]=E=>a(o.preview))},"   "),g("button",{class:"drawer-item",type:"button",onClick:d[1]||(d[1]=E=>a(o.research))},""),g("button",{class:"drawer-item",type:"button",onClick:d[2]||(d[2]=E=>a(o.vehicles))},""),g("button",{class:"drawer-item",type:"button",onClick:d[3]||(d[3]=E=>a(o.line))},""),g("button",{class:"drawer-item",type:"button",onClick:d[4]||(d[4]=E=>a(o.construction))},""),g("button",{class:"drawer-item",type:"button",onClick:d[5]||(d[5]=E=>a(o.finance))},""),g("button",{class:"drawer-item",type:"button",onClick:d[6]||(d[6]=E=>a(o.city))},""),g("button",{class:"drawer-item",type:"button",onClick:d[7]||(d[7]=E=>a(o.settings))},"")]),d[17]||(d[17]=g("div",{class:"drawer-foot"},[g("div",{class:"drawer-hint"},"     . ")],-1))])])):bt("",!0),g("div",B3,[Ke(_)])])])}}},q3=Rn($3,[["__scopeId","data-v-c939df10"]]),j3={class:"game-wrapper"},G3={class:"main-layout"},K3={__name:"HomeView",setup(n){return(e,t)=>(Y(),X("div",j3,[Ke(IB),g("div",G3,[Ke(eP,{class:"layout-area left-area desktop-only"}),Ke(q3,{class:"layout-area center-area"})])]))}},W3=Rn(K3,[["__scopeId","data-v-baa77003"]]),z3={class:"research-page"},H3={class:"research-header"},Q3={class:"status-row"},Y3={key:0,class:"badge ok"},J3={class:"badge"},X3={class:"panel"},Z3={class:"panel-head"},e9={class:"panel-actions"},t9=["disabled"],n9={key:0,class:"empty"},s9={key:1,class:"empty"},r9={key:2,class:"list"},i9={class:"card"},o9={class:"card-mid"},a9={class:"name-row"},l9={class:"name"},c9={class:"meta"},u9={class:"pill time"},h9={key:0,class:"pill fixed"},d9={key:0,class:"hint2"},f9={class:"progress-area"},p9={class:"progress-bar"},m9={class:"progress-info"},_9={class:"mono"},g9={key:1,class:"queue-row"},y9={class:"queue-title"},v9={key:2,class:"queue-list"},E9={class:"mono"},I9=["onClick"],T9={class:"panel"},w9={key:0,class:"empty"},b9={key:1,class:"empty"},A9={key:2,class:"list"},S9={class:"card-left"},R9={class:"icon"},C9={class:"card-mid"},P9={class:"name-row"},N9={class:"name"},k9={class:"meta"},D9={key:0,class:"pill"},x9={key:0,class:"hint2"},V9={class:"card-right"},O9=["disabled","onClick"],M9={class:"card-left"},L9={class:"icon"},F9={class:"card-mid"},U9={class:"name-row"},B9={class:"name"},$9={class:"meta"},q9={class:"pill time"},j9={key:0,class:"pill fixed"},G9={key:1,class:"pill"},K9={key:2,class:"pill"},W9={key:0,class:"hint2"},z9={key:1,class:"hint2"},H9={class:"card-right"},Q9=["disabled","onClick"],Y9={class:"panel"},J9={key:0,class:"empty"},X9={key:1,class:"empty"},Z9={key:2,class:"list"},e$={class:"card-mid"},t$={class:"name-row"},n$={class:"name"},s$={class:"meta"},r$={class:"pill lock"},i$={class:"pill time"},o$={key:0,class:"pill fixed"},a$={key:0,class:"hint2"},l$={key:1,class:"hint2"},c$={key:2,class:"hint2"},u$={__name:"ResearchView",setup(n){const e=Ba(),t=de(()=>e.isHydrated.value),s=e.firstUnlockTransportId,r=e.needsFirstUnlockSelection,i=e.firstUnlockCandidates,o=de(()=>e.activeResearch.value),a=de(()=>e.queuedResearchIds.value||[]),l=de(()=>e.queueReserveLevel.value||1),u=de(()=>e.queueLimit.value||1),h=de(()=>e.queueCount.value||0),d=de(()=>e.isQueueFull.value),p=de(()=>!!e.saveEnabled.value&&!!e.isStateLoaded.value&&!e.isSavingFirebaseData.value);function _(ue){return Wu[ue]?.name??ue}function E(ue){return e.catalog.find(re=>re.id===ue)||null}function b(ue){return E(ue)?.title??ue}function C(ue){return ue?ue.timePolicy==="FIXED"?!0:ue.type==="SYSTEM":!1}function F(ue){return C(E(ue))}function U(ue){const re=Math.max(0,Number(ue||0));if(!re)return"";if(re<3600)return`${Math.max(1,Math.round(re/60))}`;const le=Math.floor(re/3600),Xe=Math.round(re%3600/60);return Xe>0?`${le} ${Xe}`:`${le}`}function N(ue){const re=Number(ue?.durationSec||0),le=C(ue),Xe=U(re);return Xe===""?"":le?`: ${Xe}`:`: ${Xe}`}function k(ue){return N(E(ue))}function G(ue){return(ue.effects||[]).find(le=>le?.type==="UNLOCK_TRANSPORT_TIER"&&Number(le?.tier||1)===1)?.transportId||null}function J(ue,re){const le=G(ue);return!le||!re.has(le)?null:{key:`first-${le}`,transportId:le,icon:Wu[le]?.icon??"",title:`${Wu[le]?.name??le}  `,desc:" 1  ."}}const w=de(()=>{const ue=e.visibleCatalog.value||[];if(s.value)return[];const re=new Set((i.value||[]).map(le=>le.id));return ue.map(le=>J(le,re)).filter(Boolean)});function v(ue,re){const le=String(ue?.title??"").trim(),Xe=String(re?.title??"").trim();return le.localeCompare(Xe,"ko")}function A(ue){return{id:ue.id,title:ue.title??ue.id,desc:ue.desc??"",durationLabel:N(ue),fixed:C(ue),type:ue.type,domain:ue.domain}}const P=de(()=>(e.visibleCatalog.value||[]).filter(re=>e.getStatus(re.id)==="available").map(A).sort(v)),R=de(()=>(e.visibleCatalog.value||[]).map(re=>{const le=e.getStatus(re.id);return le!=="locked"&&le!=="comingSoon"?null:{...A(re),status:le,statusLabel:le==="comingSoon"?"":"",lockReason:"  ."}}).filter(Boolean).sort(v));function D(ue){const re=String(ue?.type||"");return re==="SYSTEM"?"":re==="CITY"?"":re==="TRANSPORT"?"":re==="EFFICIENCY"?"":String(ue?.id||"").startsWith("sys_preview_")?"":""}function T(ue){return a.value.includes(ue)}function nt(ue){return o.value?T(ue)?"":d.value?" ":"":" "}function Lt(ue){e.setFirstUnlockTransport(ue)}function at(ue){e.startResearch(ue)}function Oe(ue){e.cancelQueuedResearch(ue)}function ne(){e.cancelAllQueuedResearch()}function se(ue){return e.getResearchProgress(ue)}function ht(ue){return e.getResearchRemainingTime(ue)}function pn(ue){e.saveNow(ue)}function kt(){console.log("[ResearchView Debug]"),console.log("queueReserveLevel:",l.value),console.log("queueLimit:",u.value),console.log("queuedResearchIds:",a.value);const ue=(e.visibleCatalog.value||[]).filter(re=>String(re?.id||"").startsWith("sys_preview_"));console.log("[Preview durations]",ue.map(re=>({id:re.id,sec:re.durationSec,label:N(re)})))}return(ue,re)=>(Y(),X("div",z3,[g("header",H3,[re[1]||(re[1]=g("h1",{class:"title"},"",-1)),re[2]||(re[2]=g("p",{class:"desc"},"    1 .        . ",-1)),g("div",Q3,[g("span",{class:jo(["badge",{ok:t.value}])},ye(t.value?"  ":"  "),3),g("span",{class:jo(["badge",{warn:Ge(r)}])},ye(Ge(r)?"  ()":"  "),3),Ge(s)?(Y(),X("span",Y3,"  : "+ye(_(Ge(s))),1)):bt("",!0),g("span",J3," : "+ye(h.value)+"/"+ye(u.value)+" (Lv"+ye(l.value)+") ",1)])]),g("section",X3,[g("div",Z3,[re[3]||(re[3]=g("h2",{class:"panel-title"}," ",-1)),g("div",e9,[g("button",{class:"btn",disabled:!p.value,onClick:re[0]||(re[0]=le=>pn({reason:"manual"}))},"   ",8,t9),g("button",{class:"btn ghost",onClick:kt},"   ")])]),t.value?o.value?(Y(),X("div",r9,[g("article",i9,[re[6]||(re[6]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",o9,[g("div",a9,[g("div",l9,ye(b(o.value.id)),1),g("div",c9,[re[4]||(re[4]=g("span",{class:"pill"},"",-1)),g("span",u9,ye(k(o.value.id)),1),F(o.value.id)?(Y(),X("span",h9,"")):bt("",!0)])]),F(o.value.id)?(Y(),X("div",d9,"    ,     . ")):bt("",!0),g("div",f9,[g("div",p9,[g("div",{class:"progress-fill",style:Gh({transform:`scaleX(${Math.max(0,Math.min(100,se(o.value.id)))/100})`})},null,4)]),g("div",m9,[g("span",null,ye(se(o.value.id).toFixed(1))+"%",1),g("span",_9,": "+ye(ht(o.value.id)),1)])]),a.value.length>0?(Y(),X("div",g9,[re[5]||(re[5]=g("span",{class:"pill"},"",-1)),g("span",y9,ye(a.value.length)+" ",1),g("button",{class:"btn small ghost",onClick:ne}," ")])):bt("",!0),a.value.length>0?(Y(),X("div",v9,[(Y(!0),X(Be,null,Jt(a.value,le=>(Y(),X("div",{key:le,class:"queue-item"},[g("span",E9,ye(b(le)),1),g("button",{class:"btn small ghost",onClick:Xe=>Oe(le)},"",8,I9)]))),128))])):bt("",!0)]),re[7]||(re[7]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))])])):(Y(),X("div",s9,"    .     . ")):(Y(),X("div",n9," "))]),g("section",T9,[re[9]||(re[9]=g("h2",{class:"panel-title"}," ( )",-1)),re[10]||(re[10]=g("p",{class:"panel-desc"},"     (  )   .       . ",-1)),t.value?P.value.length===0&&w.value.length===0?(Y(),X("div",b9,"     . ")):(Y(),X("div",A9,[(Y(!0),X(Be,null,Jt(w.value,le=>(Y(),X("article",{key:le.key,class:"card"},[g("div",S9,[g("div",R9,ye(le.icon),1)]),g("div",C9,[g("div",P9,[g("div",N9,ye(le.title),1),g("div",k9,[re[8]||(re[8]=g("span",{class:"pill time"},"",-1)),Ge(r)?(Y(),X("span",D9,"")):bt("",!0)])]),le.desc?(Y(),X("div",x9,ye(le.desc),1)):bt("",!0)]),g("div",V9,[g("button",{class:"btn primary",disabled:!!o.value||!t.value,onClick:Xe=>Lt(le.transportId)},"   ",8,O9)])]))),128)),(Y(!0),X(Be,null,Jt(P.value,le=>(Y(),X("article",{key:le.id,class:"card"},[g("div",M9,[g("div",L9,ye(D(le)),1)]),g("div",F9,[g("div",U9,[g("div",B9,ye(le.title),1),g("div",$9,[g("span",q9,ye(le.durationLabel),1),le.fixed?(Y(),X("span",j9,"")):bt("",!0),o.value?(Y(),X("span",G9,"")):(Y(),X("span",K9,""))])]),le.desc?(Y(),X("div",W9,ye(le.desc),1)):bt("",!0),le.fixed?(Y(),X("div",z9,"        .")):bt("",!0)]),g("div",H9,[g("button",{class:"btn primary",disabled:!t.value||o.value&&d.value&&!T(le.id),onClick:Xe=>at(le.id)},ye(nt(le.id)),9,Q9)])]))),128))])):(Y(),X("div",w9," "))]),g("section",Y9,[re[13]||(re[13]=g("h2",{class:"panel-title"},"  ",-1)),re[14]||(re[14]=g("p",{class:"panel-desc"},"     .        . ",-1)),t.value?R.value.length===0?(Y(),X("div",X9,"/  .")):(Y(),X("div",Z9,[(Y(!0),X(Be,null,Jt(R.value,le=>(Y(),X("article",{key:le.id,class:"card"},[re[11]||(re[11]=g("div",{class:"card-left"},[g("div",{class:"icon"},"")],-1)),g("div",e$,[g("div",t$,[g("div",n$,ye(le.title),1),g("div",s$,[g("span",r$,ye(le.statusLabel),1),g("span",i$,ye(le.durationLabel),1),le.fixed?(Y(),X("span",o$,"")):bt("",!0)])]),le.desc?(Y(),X("div",a$,ye(le.desc),1)):bt("",!0),le.status==="comingSoon"?(Y(),X("div",l$,".")):le.status==="locked"?(Y(),X("div",c$,ye(le.lockReason||"  ."),1)):bt("",!0)]),re[12]||(re[12]=g("div",{class:"card-right"},[g("button",{class:"btn primary",disabled:""},"")],-1))]))),128))])):(Y(),X("div",J9," "))])]))}},h$=Rn(u$,[["__scopeId","data-v-b9cdda19"]]),d$={class:"page"},f$={class:"panel"},p$={class:"list"},m$={class:"panel"},_$={class:"grid"},g$={class:"table"},y$={__name:"VehiclesView",setup(n){const e=$a();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",d$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"     .      .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",f$,[r[5]||(r[5]=Zn('<div class="panel-head" data-v-e2a4d6c8><h2 class="panel-title" data-v-e2a4d6c8> </h2><div class="panel-actions" data-v-e2a4d6c8><button class="btn" disabled data-v-e2a4d6c8> </button><button class="btn" disabled data-v-e2a4d6c8></button><button class="btn ghost" disabled data-v-e2a4d6c8></button></div></div><div class="empty" data-v-e2a4d6c8>   . <span class="mono" data-v-e2a4d6c8> ( 8)</span>     . </div>',2)),g("div",p$,[(Y(),X(Be,null,Jt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[Zn('<div class="card-left" data-v-e2a4d6c8><div class="icon" data-v-e2a4d6c8></div></div><div class="card-mid" data-v-e2a4d6c8><div class="name-row" data-v-e2a4d6c8><div class="name" data-v-e2a4d6c8>  </div><div class="meta" data-v-e2a4d6c8><span class="pill lock" data-v-e2a4d6c8></span><span class="pill time" data-v-e2a4d6c8></span></div></div><div class="hint2" data-v-e2a4d6c8>  :  ////  UI . </div></div><div class="card-right" data-v-e2a4d6c8><button class="btn primary" disabled data-v-e2a4d6c8></button></div>',3)])])),64))])]),g("section",m$,[r[9]||(r[9]=g("h2",{class:"panel-title"},"",-1)),r[10]||(r[10]=g("p",{class:"panel-desc"},"      .",-1)),g("div",_$,[(Y(),X(Be,null,Jt(4,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",g$,[r[8]||(r[8]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(Be,null,Jt(6,i=>g("div",{class:"table-row",key:i},[...r[7]||(r[7]=[Zn('<span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span><span class="muted" data-v-e2a4d6c8></span>',5)])])),64))])])]))}},v$=Rn(y$,[["__scopeId","data-v-e2a4d6c8"]]),E$={class:"page"},I$={class:"panel"},T$={class:"list"},w$={class:"panel"},b$={class:"table"},A$={__name:"LineView",setup(n){const e=$a();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",E$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",I$,[r[5]||(r[5]=Zn('<div class="panel-head" data-v-58d6af1b><h2 class="panel-title" data-v-58d6af1b> </h2><div class="panel-actions" data-v-58d6af1b><button class="btn" disabled data-v-58d6af1b> </button><button class="btn" disabled data-v-58d6af1b> </button><button class="btn ghost" disabled data-v-58d6af1b> </button></div></div><div class="empty" data-v-58d6af1b>   .       . </div>',2)),g("div",T$,[(Y(),X(Be,null,Jt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[Zn('<div class="card-left" data-v-58d6af1b><div class="icon" data-v-58d6af1b></div></div><div class="card-mid" data-v-58d6af1b><div class="name-row" data-v-58d6af1b><div class="name" data-v-58d6af1b>  </div><div class="meta" data-v-58d6af1b><span class="pill lock" data-v-58d6af1b></span><span class="pill time" data-v-58d6af1b></span></div></div><div class="hint2" data-v-58d6af1b>  : ,  , , /  . </div></div><div class="card-right" data-v-58d6af1b><button class="btn primary" disabled data-v-58d6af1b></button></div>',3)])])),64))])]),g("section",w$,[r[8]||(r[8]=g("h2",{class:"panel-title"},"",-1)),r[9]||(r[9]=g("p",{class:"panel-desc"},"    / .",-1)),g("div",b$,[r[7]||(r[7]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(Be,null,Jt(8,i=>g("div",{class:"table-row",key:i},[...r[6]||(r[6]=[Zn('<span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span><span class="muted" data-v-58d6af1b></span>',5)])])),64))])])]))}},S$=Rn(A$,[["__scopeId","data-v-58d6af1b"]]),R$={class:"page"},C$={class:"panel"},P$={class:"list"},N$={class:"panel"},k$={class:"grid"},D$={__name:"ConstructionView",setup(n){const e=$a();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",R$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," /     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",C$,[r[5]||(r[5]=Zn('<div class="panel-head" data-v-f1dc01af><h2 class="panel-title" data-v-f1dc01af> </h2><div class="panel-actions" data-v-f1dc01af><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button><button class="btn" disabled data-v-f1dc01af></button></div></div><div class="empty" data-v-f1dc01af>   .       . </div>',2)),g("div",P$,[(Y(),X(Be,null,Jt(10,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[Zn('<div class="card-left" data-v-f1dc01af><div class="icon" data-v-f1dc01af></div></div><div class="card-mid" data-v-f1dc01af><div class="name-row" data-v-f1dc01af><div class="name" data-v-f1dc01af>  </div><div class="meta" data-v-f1dc01af><span class="pill lock" data-v-f1dc01af></span><span class="pill time" data-v-f1dc01af></span></div></div><div class="hint2" data-v-f1dc01af>  : //,  ,    UI . </div></div><div class="card-right" data-v-f1dc01af><button class="btn primary" disabled data-v-f1dc01af></button></div>',3)])])),64))])]),g("section",N$,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /   /   .",-1)),g("div",k$,[(Y(),X(Be,null,Jt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},x$=Rn(D$,[["__scopeId","data-v-f1dc01af"]]),V$={class:"page"},O$={class:"panel"},M$={class:"grid"},L$={class:"table"},F$={__name:"FinanceView",setup(n){const e=$a();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",V$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"},"//    .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",O$,[r[7]||(r[7]=Zn('<div class="panel-head" data-v-d1892e60><h2 class="panel-title" data-v-d1892e60> </h2><div class="panel-actions" data-v-d1892e60><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn" disabled data-v-d1892e60></button><button class="btn ghost" disabled data-v-d1892e60></button></div></div><div class="empty" data-v-d1892e60>   .       . </div>',2)),g("div",M$,[(Y(),X(Be,null,Jt(4,i=>g("div",{class:"mini-card",key:i},[...r[4]||(r[4]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))]),g("div",L$,[r[6]||(r[6]=g("div",{class:"table-head"},[g("span",null,""),g("span",null,""),g("span",null,""),g("span",null,"")],-1)),(Y(),X(Be,null,Jt(8,i=>g("div",{class:"table-row",key:i},[...r[5]||(r[5]=[g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1),g("span",{class:"muted"},"",-1)])])),64))])])]))}},U$=Rn(F$,[["__scopeId","data-v-d1892e60"]]),B$={class:"page"},$$={class:"panel"},q$={class:"list"},j$={class:"panel"},G$={class:"grid"},K$={__name:"CityView",setup(n){const e=$a();function t(){e.push("/home/research")}return(s,r)=>(Y(),X("div",B$,[g("header",{class:"page-header"},[r[2]||(r[2]=g("h1",{class:"title"},"",-1)),r[3]||(r[3]=g("p",{class:"desc"}," //     .    .",-1)),g("div",{class:"status-row"},[r[0]||(r[0]=g("span",{class:"badge lock"},"LOCKED",-1)),r[1]||(r[1]=g("span",{class:"badge"}," ",-1)),g("button",{class:"btn primary",onClick:t}," ")])]),g("section",$$,[r[5]||(r[5]=Zn('<div class="panel-head" data-v-370df6f4><h2 class="panel-title" data-v-370df6f4> </h2><div class="panel-actions" data-v-370df6f4><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn" disabled data-v-370df6f4></button><button class="btn ghost" disabled data-v-370df6f4></button></div></div><div class="empty" data-v-370df6f4>   .  /     . </div>',2)),g("div",q$,[(Y(),X(Be,null,Jt(8,i=>g("article",{class:"card",key:i},[...r[4]||(r[4]=[Zn('<div class="card-left" data-v-370df6f4><div class="icon" data-v-370df6f4></div></div><div class="card-mid" data-v-370df6f4><div class="name-row" data-v-370df6f4><div class="name" data-v-370df6f4>  </div><div class="meta" data-v-370df6f4><span class="pill lock" data-v-370df6f4></span><span class="pill time" data-v-370df6f4></span></div></div><div class="hint2" data-v-370df6f4>  : /// ,  , ,   . </div></div><div class="card-right" data-v-370df6f4><button class="btn primary" disabled data-v-370df6f4></button></div>',3)])])),64))])]),g("section",j$,[r[7]||(r[7]=g("h2",{class:"panel-title"},"",-1)),r[8]||(r[8]=g("p",{class:"panel-desc"},"     /  /  .",-1)),g("div",G$,[(Y(),X(Be,null,Jt(3,i=>g("div",{class:"mini-card",key:i},[...r[6]||(r[6]=[g("div",{class:"mini-title"},"",-1),g("div",{class:"mini-value muted"},"",-1),g("div",{class:"mini-sub muted"},"",-1)])])),64))])])]))}},W$=Rn(K$,[["__scopeId","data-v-370df6f4"]]),z$={},H$={class:"settings-shell"},Q$={class:"settings-nav"},Y$={class:"settings-content"};function J$(n,e){return Y(),X("div",H$,[g("aside",Q$,[Ty(n.$slots,"nav",{},void 0)]),g("section",Y$,[Ty(n.$slots,"content",{},void 0)])])}const X$=Rn(z$,[["render",J$],["__scopeId","data-v-e20a5156"]]),Z$={},eq={class:"settings-nav-inner"},tq={class:"menu"};function nq(n,e){const t=Jl("router-link");return Y(),X("nav",eq,[e[1]||(e[1]=g("h3",{class:"title"},"",-1)),g("ul",tq,[g("li",null,[Ke(t,{to:{name:"DataManager"}},{default:Wn(()=>[...e[0]||(e[0]=[zt("   ",-1)])]),_:1})])])])}const sq=Rn(Z$,[["render",nq],["__scopeId","data-v-0036c63e"]]),rq={__name:"SettingsView",setup(n){return(e,t)=>{const s=Jl("router-view");return Y(),Wo(X$,null,{nav:Wn(()=>[Ke(sq)]),content:Wn(()=>[Ke(s)]),_:1})}}},iq={class:"data-manager"},oq={class:"card"},aq={class:"kv"},lq={class:"v"},cq={class:"kv"},uq={class:"v"},hq={class:"kv"},dq={class:"v"},fq={key:0,class:"hint"},pq={key:1,class:"hint"},mq={class:"card"},_q={class:"row"},gq=["disabled"],yq=["disabled"],vq=["disabled"],Eq={class:"autosave"},Iq={class:"autosave-controls"},Tq={class:"radio"},wq=["disabled"],bq={class:"radio"},Aq=["disabled"],Sq={class:"radio"},Rq=["disabled"],Cq={key:0,class:"hint"},Pq={key:0,class:"message"},Nq={key:1,class:"preview"},kq={class:"preview-head"},Dq={class:"summary"},xq={class:"summary-item"},Vq={class:"summary-v"},Oq={class:"summary-item"},Mq={class:"summary-v"},Lq={class:"summary-item"},Fq={class:"summary-v"},Uq={key:0,class:"pre"},Bq={key:2,class:"hint"},$q={class:"modal"},qq={class:"check"},jq={class:"row"},Gq=["disabled"],Kq=["disabled"],Wq={__name:"DataManagerPanel",setup(n){const{world:e}=UC(),t=de(()=>!1),s=fC(),r=de(()=>s?.user?.value?.uid??null),{saveNow:i,isSavingFirebaseData:o,autoSaveEnabled:a,autoSaveBase:l,autoSaveIntervalMin:u,setAutoSaveEnabled:h,setAutoSaveBase:d,setAutoSaveIntervalMin:p,autoSaveRunning:_}=Ba(),E=de(()=>o.value),b=be(!1),C=be(""),F=be(!1),U=be(null),N=be(!1);function k(ne){return JSON.stringify(ne,null,2)}function G(ne){if(!ne)return"-";try{return typeof ne?.toDate=="function"?ne.toDate().toLocaleString():ne instanceof Date?ne.toLocaleString():typeof ne=="number"?new Date(ne).toLocaleString():String(ne)}catch{return String(ne)}}function J(ne){return String(ne||"").toLowerCase()==="dev"?"dev":"prod"}function w(ne,se){if(!t.value)return null;const ht=J(se);return X_(dg,"worlds",ht,"users",ne,"research","state")}const v=be("off");function A(){if(!a.value){v.value="off";return}const ne=Number(l.value),se=Number(u.value);ne===10&&se===10?v.value="10":ne===5&&se===5?v.value="5":ne===10?v.value="10":v.value="5"}Vr([a,l,u],()=>A(),{immediate:!0}),Vr(v,ne=>{if(r.value&&t.value){if(ne==="off"){h(!1);return}if(ne==="5"){d(5),p(5),h(!0);return}ne==="10"&&(d(10),p(10),h(!0))}});async function P(){if(r.value){if(!t.value){C.value="DEV   .";return}C.value="";try{await i({reason:"manual-ui"}),C.value=" ."}catch(ne){console.error("DataManager: save failed",ne),C.value=` : ${String(ne?.message??ne)}`}}}async function R(){if(r.value){if(!t.value){C.value="DEV   .";return}b.value=!0,C.value="",F.value=!1,U.value=null,N.value=!1;try{const ne=w(r.value,e.value);if(!ne)throw new Error("REMOTE_DISABLED");const se=await iC(ne);se.exists()?(U.value=se.data(),F.value=!0,C.value="  ."):C.value="  . ( )"}catch(ne){console.error("DataManager: load failed",ne),C.value=` : ${String(ne?.message??ne)}`}finally{b.value=!1}}}const D=be(!1),T=be(!1),nt=be("");function Lt(){if(!t.value){C.value="DEV   .";return}D.value=!0,T.value=!1,nt.value=""}function at(){D.value=!1}async function Oe(){if(r.value){if(!t.value){C.value="DEV   .";return}b.value=!0,C.value="";try{const ne=w(r.value,e.value);if(!ne)throw new Error("REMOTE_DISABLED");await oC(ne),F.value=!1,U.value=null,N.value=!1,C.value=" .   .",at()}catch(ne){console.error("DataManager: delete failed",ne),C.value=` : ${String(ne?.message??ne)}`}finally{b.value=!1}}}return(ne,se)=>(Y(),X("div",iq,[se[24]||(se[24]=g("header",{class:"header"},[g("div",null,[g("h1",{class:"title"}," "),g("p",{class:"desc"},"   ,        . ")])],-1)),g("section",oq,[se[9]||(se[9]=g("h2",{class:"card-title"}," ",-1)),g("div",aq,[se[6]||(se[6]=g("div",{class:"k"}," ",-1)),g("div",lq,ye(r.value?"":"()"),1)]),g("div",cq,[se[7]||(se[7]=g("div",{class:"k"}," ",-1)),g("div",uq,ye(t.value?"(PROD)":"(DEV )"),1)]),g("div",hq,[se[8]||(se[8]=g("div",{class:"k"},"",-1)),g("div",dq,ye(Ge(e)==="dev"?"DEV":"PROD"),1)]),r.value?r.value&&!t.value?(Y(),X("p",pq," DEV       /   . ")):bt("",!0):(Y(),X("p",fq," Firestore  /   . "))]),g("section",mq,[se[18]||(se[18]=g("h2",{class:"card-title"}," ",-1)),g("div",_q,[g("button",{class:"btn",onClick:P,disabled:!r.value||!t.value||b.value||E.value},"  ",8,gq),g("button",{class:"btn",onClick:R,disabled:!r.value||!t.value||b.value},"   ",8,yq),g("button",{class:"btn danger",onClick:Lt,disabled:!r.value||!t.value||b.value},"   ",8,vq)]),g("div",Eq,[se[13]||(se[13]=g("div",{class:"autosave-title"},"",-1)),g("div",Iq,[g("label",Tq,[rl(g("input",{type:"radio",name:"autosave",value:"off","onUpdate:modelValue":se[0]||(se[0]=ht=>v.value=ht),disabled:!r.value||!t.value||b.value},null,8,wq),[[hf,v.value]]),se[10]||(se[10]=g("span",null,"",-1))]),g("label",bq,[rl(g("input",{type:"radio",name:"autosave",value:"5","onUpdate:modelValue":se[1]||(se[1]=ht=>v.value=ht),disabled:!r.value||!t.value||b.value},null,8,Aq),[[hf,v.value]]),se[11]||(se[11]=g("span",null,"5",-1))]),g("label",Sq,[rl(g("input",{type:"radio",name:"autosave",value:"10","onUpdate:modelValue":se[2]||(se[2]=ht=>v.value=ht),disabled:!r.value||!t.value||b.value},null,8,Rq),[[hf,v.value]]),se[12]||(se[12]=g("span",null,"10",-1))])]),r.value&&t.value&&Ge(a)&&Ge(_)?(Y(),X("p",Cq,"    (KST   ) ")):bt("",!0)]),C.value?(Y(),X("p",Pq,ye(C.value),1)):bt("",!0),F.value?(Y(),X("div",Nq,[g("div",kq,[se[14]||(se[14]=g("h3",{class:"preview-title"},"    ",-1)),g("button",{class:"btn small",onClick:se[3]||(se[3]=ht=>N.value=!N.value)},ye(N.value?"":""),1)]),g("div",Dq,[g("div",xq,[se[15]||(se[15]=g("div",{class:"summary-k"},"",-1)),g("div",Vq,ye(U.value?.version??"-"),1)]),g("div",Oq,[se[16]||(se[16]=g("div",{class:"summary-k"},"  (legacy)",-1)),g("div",Mq,ye(U.value?.transports?.length??0),1)]),g("div",Lq,[se[17]||(se[17]=g("div",{class:"summary-k"},"",-1)),g("div",Fq,ye(G(U.value?.updatedAt)),1)])]),N.value?(Y(),X("pre",Uq,ye(k(U.value)),1)):bt("",!0)])):(Y(),X("p",Bq,"   ."))]),D.value?(Y(),X("div",{key:0,class:"modal-backdrop",onClick:ow(at,["self"])},[g("div",$q,[se[20]||(se[20]=g("h2",{class:"modal-title"}," ?",-1)),se[21]||(se[21]=g("p",{class:"modal-desc danger-text"},"     .  ? ",-1)),se[22]||(se[22]=g("p",{class:"modal-desc"},[zt("   ,  "),g("b",null," "),zt(". ")],-1)),g("label",qq,[rl(g("input",{type:"checkbox","onUpdate:modelValue":se[4]||(se[4]=ht=>T.value=ht)},null,512),[[B1,T.value]]),se[19]||(se[19]=g("span",null,"      .",-1))]),se[23]||(se[23]=g("p",{class:"modal-desc"},[zt("   "),g("b",null,"DELETE"),zt(" . ")],-1)),rl(g("input",{class:"input","onUpdate:modelValue":se[5]||(se[5]=ht=>nt.value=ht),placeholder:"DELETE"},null,512),[[U1,nt.value]]),g("div",jq,[g("button",{class:"btn",onClick:at,disabled:b.value},"",8,Gq),g("button",{class:"btn danger",onClick:Oe,disabled:b.value||!T.value||nt.value!=="DELETE"},"   ",8,Kq)])])])):bt("",!0)]))}},zq=Rn(Wq,[["__scopeId","data-v-884a6e72"]]),Hq={__name:"DataManagerView",setup(n){return(e,t)=>(Y(),Wo(zq))}},Qq={class:"preview-page"},Yq={__name:"PreviewRunsView",setup(n){return(e,t)=>(Y(),X("div",Qq,[Ke(eP,{class:"preview-left-as-main"})]))}},Jq=Rn(Yq,[["__scopeId","data-v-3aa6340f"]]),Xq=[{path:"/",redirect:"/home/research"},{path:"/home",component:W3,children:[{path:"",redirect:"/home/research"},{path:"preview",name:"PreviewRuns",component:Jq},{path:"research",name:"Research",component:h$},{path:"vehicles",name:"Vehicles",component:v$},{path:"line",name:"Line",component:S$},{path:"construction",name:"Construction",component:x$},{path:"finance",name:"Finance",component:U$},{path:"city",name:"City",component:W$},{path:"settings",component:rq,children:[{path:"",redirect:{name:"DataManager"}},{path:"data",name:"DataManager",component:Hq}]}]}],Zq=lB({history:B6("/RCTS/test/"),routes:Xq,scrollBehavior(){return{top:0}}}),tP=K1(n6);tP.use(Zq);tP.mount("#app");
